{"file_contents":{"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --background: hsl(0, 0%, 100%);\n  --foreground: hsl(20, 14.3%, 4.1%);\n  --muted: hsl(60, 4.8%, 95.9%);\n  --muted-foreground: hsl(25, 5.3%, 44.7%);\n  --popover: hsl(0, 0%, 100%);\n  --popover-foreground: hsl(20, 14.3%, 4.1%);\n  --card: hsl(0, 0%, 100%);\n  --card-foreground: hsl(20, 14.3%, 4.1%);\n  --border: hsl(20, 5.9%, 90%);\n  --input: hsl(20, 5.9%, 90%);\n  --primary: hsl(220, 91%, 60%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(60, 4.8%, 95.9%);\n  --secondary-foreground: hsl(24, 9.8%, 10%);\n  --accent: hsl(60, 4.8%, 95.9%);\n  --accent-foreground: hsl(24, 9.8%, 10%);\n  --destructive: hsl(0, 84.2%, 60.2%);\n  --destructive-foreground: hsl(60, 9.1%, 97.8%);\n  --ring: hsl(20, 14.3%, 4.1%);\n  --radius: 0.5rem;\n  \n  /* Brand colors matching the design */\n  --brand-blue: hsl(220, 91%, 60%);\n  --brand-indigo: hsl(239, 84%, 67%);\n  --brand-dark: hsl(224, 76%, 48%);\n}\n\n.dark {\n  --background: hsl(240, 10%, 3.9%);\n  --foreground: hsl(0, 0%, 98%);\n  --muted: hsl(240, 3.7%, 15.9%);\n  --muted-foreground: hsl(240, 5%, 64.9%);\n  --popover: hsl(240, 10%, 3.9%);\n  --popover-foreground: hsl(0, 0%, 98%);\n  --card: hsl(240, 10%, 3.9%);\n  --card-foreground: hsl(0, 0%, 98%);\n  --border: hsl(240, 3.7%, 15.9%);\n  --input: hsl(240, 3.7%, 15.9%);\n  --primary: hsl(220, 91%, 60%);\n  --primary-foreground: hsl(210, 40%, 98%);\n  --secondary: hsl(240, 3.7%, 15.9%);\n  --secondary-foreground: hsl(0, 0%, 98%);\n  --accent: hsl(240, 3.7%, 15.9%);\n  --accent-foreground: hsl(0, 0%, 98%);\n  --destructive: hsl(0, 62.8%, 30.6%);\n  --destructive-foreground: hsl(0, 0%, 98%);\n  --ring: hsl(240, 4.9%, 83.9%);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n  }\n}\n\n@layer components {\n  .brand-gradient {\n    background: linear-gradient(135deg, var(--brand-blue) 0%, var(--brand-indigo) 100%);\n  }\n  \n  .simulation-nav-item {\n    @apply flex items-center space-x-3 px-4 py-3 mx-4 my-1 text-gray-600 rounded-lg text-sm font-medium transition-all duration-200 hover:bg-gray-50 hover:text-gray-900;\n  }\n  \n  .simulation-nav-item.active {\n    @apply bg-blue-50 text-blue-700;\n  }\n  \n  .simulation-nav-item i {\n    @apply w-4 h-4;\n  }\n  \n  .difficulty-btn, .personality-btn {\n    @apply px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-700 text-sm font-medium transition-all duration-200 cursor-pointer hover:border-gray-400 hover:bg-gray-50;\n  }\n  \n  .difficulty-btn.active, .personality-btn.active {\n    @apply border-blue-500 bg-blue-50 text-blue-700;\n  }\n  \n  .scenario-card {\n    @apply p-6 border-2 border-gray-200 rounded-xl bg-white cursor-pointer transition-all duration-200 hover:border-gray-300 hover:shadow-md;\n  }\n  \n  .scenario-card.active {\n    @apply border-green-500 bg-green-50;\n  }\n}\n","path":null,"size_bytes":2862,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport { createRequire } from \"module\";\nconst require = createRequire(import.meta.url);\nconst { PDFParse } = require(\"pdf-parse\");\nimport { storage } from \"./storage\";\nimport { groqService } from \"./services/groq\";\nimport { openaiService } from \"./services/openai\";\nimport { workspaceOrchestrator } from \"./services/workspace-orchestrator\";\nimport { insertSimulationSessionSchema } from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { getSprintPlanningAdapter } from \"@shared/adapters/planning\";\n\n// Configure multer for file uploads\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    // Accept audio and document files\n    if (file.mimetype.startsWith('audio/') || \n        file.mimetype === 'application/pdf' ||\n        file.mimetype === 'application/msword' ||\n        file.mimetype === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {\n      cb(null, true);\n    } else {\n      cb(new Error('Only audio and document files (PDF, DOC, DOCX) are allowed'));\n    }\n  },\n});\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // User authentication (simplified for MVP)\n  app.get(\"/api/user\", async (req, res) => {\n    try {\n      // For MVP, return the default user\n      const user = await storage.getUser(1);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      res.json(user);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get user\" });\n    }\n  });\n\n  // Get user progress\n  app.get(\"/api/user/:userId/progress\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const progress = await storage.getUserProgress(userId);\n      res.json(progress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get user progress\" });\n    }\n  });\n\n  // Get simulation sessions\n  app.get(\"/api/user/:userId/sessions\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const type = req.query.type as string;\n      const sessions = await storage.getUserSimulationSessions(userId, type);\n      res.json(sessions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get sessions\" });\n    }\n  });\n\n  // Create simulation session\n  app.post(\"/api/sessions\", async (req, res) => {\n    try {\n      const sessionData = insertSimulationSessionSchema.parse(req.body);\n      const session = await storage.createSimulationSession(sessionData);\n      \n      // Update user progress\n      let progress = await storage.getUserProgressByType(session.userId, session.type);\n      if (!progress) {\n        progress = await storage.createUserProgress({\n          userId: session.userId,\n          simulationType: session.type,\n          totalSessions: 1,\n          completedSessions: 0,\n          totalTime: 0\n        });\n      } else {\n        await storage.updateUserProgress(session.userId, session.type, {\n          totalSessions: progress.totalSessions + 1,\n          lastSessionAt: new Date()\n        });\n      }\n      \n      res.json(session);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create session\" });\n    }\n  });\n\n  // Get single simulation session\n  app.get(\"/api/sessions/:sessionId\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const session = await storage.getSimulationSession(sessionId);\n      \n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      \n      res.json(session);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get session\" });\n    }\n  });\n\n  // Update simulation session\n  app.patch(\"/api/sessions/:sessionId\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const updates = req.body;\n      const session = await storage.updateSimulationSession(sessionId, updates);\n      \n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      \n      res.json(session);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update session\" });\n    }\n  });\n\n  // Generate interview question\n  app.post(\"/api/interview/question\", async (req, res) => {\n    try {\n      const { profession, interviewType, difficulty, jobPosting, previousQuestions } = req.body;\n      \n      const question = await groqService.generateInterviewQuestion(\n        profession,\n        interviewType,\n        difficulty,\n        jobPosting,\n        previousQuestions\n      );\n      \n      res.json(question);\n    } catch (error) {\n      console.log(\"API error, using fallback:\", (error as Error).message);\n      // If OpenAI fails, provide a fallback response\n      const { difficulty: reqDifficulty } = req.body;\n      const fallbackQuestion = {\n        question: \"What is the difference between let, const, and var in JavaScript?\",\n        category: \"technical\",\n        difficulty: reqDifficulty || \"junior\",\n        expectedAnswer: \"Provide a clear explanation of the scoping and reassignment differences between these variable declaration keywords.\"\n      };\n      res.json(fallbackQuestion);\n    }\n  });\n\n  // Evaluate interview answer\n  app.post(\"/api/interview/evaluate\", async (req, res) => {\n    try {\n      const { question, answer, profession, difficulty } = req.body;\n      \n      const evaluation = await groqService.evaluateInterviewAnswer(\n        question,\n        answer,\n        difficulty\n      );\n      \n      res.json(evaluation);\n    } catch (error) {\n      console.log(\"API error, using fallback evaluation:\", (error as Error).message);\n      // Fallback evaluation\n      const { answer: userAnswer } = req.body;\n      const answerLength = userAnswer?.length || 0;\n      const score = Math.min(85, Math.max(60, 60 + Math.floor(answerLength / 50)));\n      const fallbackEvaluation = {\n        score,\n        feedback: score >= 75 \n          ? \"Good answer! You demonstrated understanding of the topic. Consider adding more specific examples.\"\n          : \"Your response shows basic knowledge. Try to provide more detailed explanations and examples.\",\n        followUp: \"Can you elaborate on how you would implement this in practice?\"\n      };\n      res.json(fallbackEvaluation);\n    }\n  });\n\n  // Generate negotiation response\n  app.post(\"/api/negotiation/respond\", async (req, res) => {\n    try {\n      const { scenario, userMessage, negotiationHistory, counterpartStyle } = req.body;\n      \n      const response = await groqService.generateNegotiationResponse(\n        scenario,\n        userMessage,\n        negotiationHistory,\n        counterpartStyle\n      );\n      \n      res.json(response);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate response: \" + (error as Error).message });\n    }\n  });\n\n  // Generate workspace team message\n  app.post(\"/api/workspace/message\", async (req, res) => {\n    try {\n      const { teamMember, context, userAction } = req.body;\n      \n      const message = await groqService.generateWorkspaceMessage(\n        context,\n        userAction,\n        teamMember,\n        'message'\n      );\n      \n      res.json(message);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate message: \" + (error as Error).message });\n    }\n  });\n\n  // Transcribe audio using Whisper\n  app.post(\"/api/transcribe\", upload.single('audio'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ message: \"No audio file provided\" });\n      }\n\n      const audioBuffer = req.file.buffer;\n      const mimeType = req.file.mimetype;\n\n      const result = await groqService.transcribeAudio(audioBuffer, mimeType);\n      res.json(result);\n    } catch (error) {\n      console.error('Transcription error:', error);\n      res.status(500).json({ message: \"Failed to transcribe audio: \" + (error as Error).message });\n    }\n  });\n\n  // Customer Support API endpoints\n  app.post(\"/api/customer-support/message\", async (req, res) => {\n    try {\n      const { stage, persona, problem, agentMessage, conversationHistory, isInitial, stageTransition } = req.body;\n      \n      const response = await groqService.generateCustomerSupportMessage(\n        stage,\n        persona,\n        problem,\n        agentMessage,\n        conversationHistory,\n        isInitial,\n        stageTransition\n      );\n      \n      res.json(response);\n    } catch (error) {\n      console.error('Customer support message generation error:', error);\n      res.status(500).json({ message: \"Failed to generate customer message\" });\n    }\n  });\n\n  app.post(\"/api/customer-support/evaluate\", async (req, res) => {\n    try {\n      const { stage, agentMessage, customerPersona, problem, conversationHistory } = req.body;\n      \n      const evaluation = await groqService.evaluateCustomerSupportResponse(\n        stage,\n        agentMessage,\n        customerPersona,\n        problem,\n        conversationHistory\n      );\n      \n      res.json(evaluation);\n    } catch (error) {\n      console.error('Customer support evaluation error:', error);\n      res.status(500).json({ message: \"Failed to evaluate response\" });\n    }\n  });\n\n  // Workspace Simulator API endpoints\n  \n  // Get all workspace projects\n  app.get(\"/api/workspace/projects\", async (req, res) => {\n    try {\n      const projects = await storage.getWorkspaceProjects();\n      res.json(projects);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get projects: \" + (error as Error).message });\n    }\n  });\n\n  // Get specific workspace project\n  app.get(\"/api/workspace/projects/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const project = await storage.getWorkspaceProject(id);\n      \n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n      \n      res.json(project);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get project: \" + (error as Error).message });\n    }\n  });\n\n  // Get workspace roles\n  app.get(\"/api/workspace/roles\", async (req, res) => {\n    try {\n      const roles = await storage.getWorkspaceRoles();\n      res.json(roles);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get roles: \" + (error as Error).message });\n    }\n  });\n\n  // Get session tasks\n  app.get(\"/api/workspace/:sessionId/tasks\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const tasks = await storage.getWorkspaceTasks(sessionId);\n      res.json(tasks);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get tasks: \" + (error as Error).message });\n    }\n  });\n\n  // Update task\n  app.patch(\"/api/workspace/tasks/:taskId\", async (req, res) => {\n    try {\n      const taskId = parseInt(req.params.taskId);\n      const updates = req.body;\n      const task = await storage.updateWorkspaceTask(taskId, updates);\n      \n      if (!task) {\n        return res.status(404).json({ message: \"Task not found\" });\n      }\n      \n      res.json(task);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update task: \" + (error as Error).message });\n    }\n  });\n\n  // Get session artifacts\n  app.get(\"/api/workspace/:sessionId/artifacts\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const artifacts = await storage.getWorkspaceArtifacts(sessionId);\n      res.json(artifacts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get artifacts: \" + (error as Error).message });\n    }\n  });\n\n  // Create artifact\n  app.post(\"/api/workspace/:sessionId/artifacts\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const artifactData = { ...req.body, sessionId };\n      const artifact = await storage.createWorkspaceArtifact(artifactData);\n      res.json(artifact);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create artifact: \" + (error as Error).message });\n    }\n  });\n\n  // Get session interactions\n  app.get(\"/api/workspace/:sessionId/interactions\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const channel = req.query.channel as string | undefined;\n      const interactions = await storage.getWorkspaceInteractions(sessionId, channel);\n      res.json(interactions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get interactions: \" + (error as Error).message });\n    }\n  });\n\n  // Create interaction (for auto-messages and direct messages)\n  app.post(\"/api/workspace/:sessionId/interactions\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const interactionData = { ...req.body, sessionId };\n      const interaction = await storage.createWorkspaceInteraction(interactionData);\n      res.json(interaction);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create interaction: \" + (error as Error).message });\n    }\n  });\n\n  // Handle user action (main orchestration endpoint)\n  app.post(\"/api/workspace/:sessionId/action\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const { type, channel, data, currentDay, dayActivities, completedActivities } = req.body;\n      \n      const session = await storage.getSimulationSession(sessionId);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const config = session.configuration as any;\n      const project = await storage.getWorkspaceProject(config.projectId);\n      \n      if (!project) {\n        return res.status(404).json({ message: \"Project not found\" });\n      }\n\n      // Store user interaction\n      await storage.createWorkspaceInteraction({\n        sessionId,\n        channel,\n        sender: 'User',\n        senderRole: config.activeRole,\n        content: data.content || JSON.stringify(data),\n        metadata: { actionType: type }\n      });\n\n      // Build context for orchestrator\n      const context = {\n        projectName: project.name,\n        projectDescription: project.description,\n        currentSprint: config.sprintPhase || 'sprint',\n        teamMembers: project.teamStructure as any[],\n        userRole: config.activeRole,\n        phase: config.sprintPhase || 'sprint',\n        currentDay: currentDay,\n        dayActivities: dayActivities,\n        completedActivities: completedActivities\n      };\n\n      // Evaluate user action\n      const evaluation = await workspaceOrchestrator.evaluateAction(\n        { type, channel, data },\n        context\n      );\n\n      // Orchestrate team member responses\n      let responses: any[] = [];\n      if (type === 'send-message') {\n        responses = await workspaceOrchestrator.orchestrateConversation(\n          data.content,\n          channel,\n          context,\n          sessionId\n        );\n\n        // Store AI responses\n        for (const response of responses) {\n          await storage.createWorkspaceInteraction({\n            sessionId,\n            channel,\n            sender: response.sender,\n            senderRole: response.senderRole,\n            content: response.content,\n            metadata: response.metadata || null\n          });\n        }\n      }\n\n      // Check if any response indicates conversation closed\n      const conversationClosed = responses.some(r => r.metadata?.closed === true);\n\n      res.json({\n        evaluation,\n        responses,\n        conversationClosed,\n        success: true\n      });\n    } catch (error) {\n      console.error('Workspace action error:', error);\n      res.status(500).json({ message: \"Failed to process action: \" + (error as Error).message });\n    }\n  });\n\n  // Reopen a closed channel (for continuing conversation after goodbye)\n  app.post(\"/api/workspace/:sessionId/reopen-channel\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const { channel } = req.body;\n      \n      // Validate required fields\n      if (!channel || typeof channel !== 'string') {\n        return res.status(400).json({ \n          success: false, \n          message: \"Missing or invalid 'channel' field in request body\" \n        });\n      }\n      \n      // Verify session exists\n      const session = await storage.getSimulationSession(sessionId);\n      if (!session) {\n        return res.status(404).json({ \n          success: false, \n          message: \"Session not found\" \n        });\n      }\n      \n      workspaceOrchestrator.reopenChannel(channel);\n      res.json({ success: true, message: `Channel ${channel} reopened` });\n    } catch (error) {\n      res.status(500).json({ \n        success: false, \n        message: \"Failed to reopen channel: \" + (error as Error).message \n      });\n    }\n  });\n\n  // Get session evaluation\n  app.get(\"/api/workspace/:sessionId/evaluation\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const evaluations = await storage.getWorkspaceEvaluations(sessionId);\n      res.json(evaluations);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get evaluation: \" + (error as Error).message });\n    }\n  });\n\n  // Create evaluation\n  app.post(\"/api/workspace/:sessionId/evaluation\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const evaluationData = { ...req.body, sessionId };\n      const evaluation = await storage.createWorkspaceEvaluation(evaluationData);\n      res.json(evaluation);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create evaluation: \" + (error as Error).message });\n    }\n  });\n\n  // ============================================\n  // Workspace Progress API Endpoints\n  // ============================================\n\n  // Get workspace progress for a user\n  app.get(\"/api/workspace/progress/:userId/:mode?\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const mode = req.params.mode as 'practice' | 'journey' | undefined;\n      const progress = await storage.getWorkspaceProgress(userId, mode);\n      res.json(progress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get workspace progress: \" + (error as Error).message });\n    }\n  });\n\n  // Get workspace progress by session\n  app.get(\"/api/workspace/progress/session/:sessionId\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const progress = await storage.getWorkspaceProgressBySession(sessionId);\n      res.json(progress || null);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get workspace progress: \" + (error as Error).message });\n    }\n  });\n\n  // Create or update workspace progress\n  app.post(\"/api/workspace/progress\", async (req, res) => {\n    try {\n      const progressData = req.body;\n      const progress = await storage.createWorkspaceProgress(progressData);\n      res.json(progress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to create workspace progress: \" + (error as Error).message });\n    }\n  });\n\n  // Update workspace progress\n  app.patch(\"/api/workspace/progress/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      const progress = await storage.updateWorkspaceProgress(id, updates);\n      res.json(progress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update workspace progress: \" + (error as Error).message });\n    }\n  });\n\n  // Restart workspace progress (for Full Journey mode)\n  app.post(\"/api/workspace/progress/:sessionId/restart\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const progress = await storage.restartWorkspaceProgress(sessionId);\n      if (!progress) {\n        return res.status(404).json({ message: \"Progress not found\" });\n      }\n      res.json(progress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to restart workspace progress: \" + (error as Error).message });\n    }\n  });\n\n  // Generate session feedback\n  app.post(\"/api/sessions/:sessionId/feedback\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const session = await storage.getSimulationSession(sessionId);\n      \n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      \n      const feedback = await openaiService.generateSessionFeedback(\n        session.type,\n        session.messages as any[],\n        session.configuration as any\n      );\n      \n      // Update session with feedback and mark as completed\n      const duration = session.completedAt \n        ? Math.floor((session.completedAt.getTime() - session.startedAt.getTime()) / 1000)\n        : 0;\n        \n      await storage.updateSimulationSession(sessionId, {\n        status: 'completed',\n        score: feedback.score,\n        feedback: feedback,\n        completedAt: new Date(),\n        duration\n      });\n      \n      // Update user progress\n      const progress = await storage.getUserProgressByType(session.userId, session.type);\n      if (progress) {\n        const newCompletedSessions = progress.completedSessions + 1;\n        const newAverageScore = progress.averageScore \n          ? Math.round((progress.averageScore * progress.completedSessions + feedback.score) / newCompletedSessions)\n          : feedback.score;\n          \n        await storage.updateUserProgress(session.userId, session.type, {\n          completedSessions: newCompletedSessions,\n          averageScore: newAverageScore,\n          totalTime: progress.totalTime + duration,\n          lastSessionAt: new Date()\n        });\n      }\n      \n      res.json(feedback);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to generate feedback: \" + (error as Error).message });\n    }\n  });\n\n  // ============================================\n  // Interview Simulator API Endpoints\n  // ============================================\n\n  // Start a new interview\n  app.post(\"/api/interviews/start\", async (req, res) => {\n    try {\n      const { userId, interviewType, targetRole, difficulty, totalQuestions, applicationStageId } = req.body;\n      \n      if (!userId || !interviewType || !targetRole) {\n        return res.status(400).json({ message: \"userId, interviewType, and targetRole are required\" });\n      }\n\n      // Build job context if this is a Journey mode interview\n      let jobContext: {\n        companyName?: string;\n        companyDescription?: string;\n        jobTitle?: string;\n        jobRequirements?: string;\n        candidateCv?: string;\n      } | undefined;\n      \n      // Extract candidate name for personalized greeting\n      let candidateName: string | undefined;\n      \n      // For journey mode, use the job's seniority as difficulty (e.g., \"intern\", \"junior\")\n      let resolvedDifficulty = difficulty;\n\n      if (applicationStageId) {\n        const stage = await storage.getApplicationStage(applicationStageId);\n        if (stage) {\n          const application = await storage.getJobApplication(stage.applicationId);\n          if (application) {\n            // Get candidate name from user profile\n            const user = await storage.getUser(application.userId);\n            if (user) {\n              candidateName = user.firstName || user.username;\n            }\n            \n            const jobWithCompany = await storage.getJobPostingWithCompany(application.jobPostingId);\n            if (jobWithCompany) {\n              // Use job seniority as difficulty for journey mode (intern, junior, mid, senior, lead)\n              resolvedDifficulty = jobWithCompany.seniority || difficulty;\n              \n              // Build requirements string from job posting\n              const requirements = [];\n              if (jobWithCompany.requirements) {\n                requirements.push(...(jobWithCompany.requirements as string[]));\n              }\n              if (jobWithCompany.responsibilities) {\n                requirements.push(...(jobWithCompany.responsibilities as string[]).map(r => `Responsibility: ${r}`));\n              }\n              \n              jobContext = {\n                companyName: jobWithCompany.company?.name,\n                companyDescription: jobWithCompany.company?.description || `${jobWithCompany.company?.name} is a ${jobWithCompany.company?.size} ${jobWithCompany.company?.industry} company`,\n                jobTitle: jobWithCompany.title,\n                jobRequirements: requirements.length > 0 ? requirements.join('\\n') : undefined,\n                candidateCv: application.cvContent || undefined,\n              };\n            }\n          }\n        }\n      }\n\n      const { interviewOrchestrator } = await import(\"./services/interview-orchestrator\");\n      \n      // Determine default question count based on interview type\n      // HR/behavioral interviews need more questions (7) to properly assess fit\n      // Technical interviews can be shorter (5) as they're more focused\n      const defaultQuestionCount = interviewType === 'behavioral' || interviewType === 'hr' ? 7 : 5;\n      \n      // Determine mode based on whether this is linked to an application stage\n      const mode = applicationStageId ? 'journey' : 'practice';\n      \n      const result = await interviewOrchestrator.startInterview(\n        userId,\n        interviewType,\n        targetRole,\n        resolvedDifficulty || \"medium\",\n        totalQuestions || defaultQuestionCount,\n        jobContext,\n        candidateName,\n        mode,\n        applicationStageId\n      );\n      \n      // If this interview is for an application stage, link them\n      if (applicationStageId) {\n        const stage = await storage.getApplicationStage(applicationStageId);\n        if (stage) {\n          await storage.updateApplicationStage(applicationStageId, {\n            interviewSessionId: result.session.id,\n            status: 'in_progress',\n            scheduledAt: new Date(),\n          });\n        }\n      }\n      \n      res.json({ ...result, applicationStageId });\n    } catch (error) {\n      console.error(\"Failed to start interview:\", error);\n      res.status(500).json({ message: \"Failed to start interview: \" + (error as Error).message });\n    }\n  });\n\n  // Handle prelude responses during conversational interview intro\n  app.post(\"/api/interviews/:sessionId/prelude\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const { response } = req.body;\n      \n      if (!response) {\n        return res.status(400).json({ message: \"response is required\" });\n      }\n\n      const { interviewOrchestrator } = await import(\"./services/interview-orchestrator\");\n      const result = await interviewOrchestrator.handlePreludeResponse(sessionId, response);\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to handle prelude response:\", error);\n      res.status(500).json({ message: \"Failed to handle prelude response: \" + (error as Error).message });\n    }\n  });\n\n  // Submit an answer to a question\n  app.post(\"/api/interviews/:sessionId/answer\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const { questionId, answer } = req.body;\n      \n      if (!questionId || !answer) {\n        return res.status(400).json({ message: \"questionId and answer are required\" });\n      }\n\n      const { interviewOrchestrator } = await import(\"./services/interview-orchestrator\");\n      const result = await interviewOrchestrator.submitAnswer(sessionId, questionId, answer);\n      \n      // If interview is complete and linked to an application stage, update the stage\n      if (result.finalReport) {\n        // Find the application stage linked to this interview session\n        const linkedStage = await storage.getApplicationStageByInterviewSession(sessionId);\n        if (linkedStage) {\n          await storage.updateApplicationStage(linkedStage.id, {\n            status: 'completed',\n            completedAt: new Date(),\n            score: result.finalReport.overallScore,\n            feedback: result.finalReport.summary,\n          });\n          \n          // Update the application's current stage index\n          const application = await storage.getJobApplication(linkedStage.applicationId);\n          if (application) {\n            const stages = await storage.getApplicationStages(application.id);\n            const nextStageIndex = application.currentStageIndex + 1;\n            const totalStages = stages.length;\n            const isLastStage = nextStageIndex >= totalStages;\n            \n            // If this is the last stage, generate a job offer\n            let offerDetails = undefined;\n            if (isLastStage) {\n              const { generateJobOffer } = await import(\"./services/offer-generator\");\n              const jobPosting = await storage.getJobPosting(application.jobPostingId);\n              const company = jobPosting ? await storage.getCompany(jobPosting.companyId) : null;\n              const user = await storage.getUser(application.userId);\n              \n              if (jobPosting && company) {\n                offerDetails = generateJobOffer({\n                  jobPosting,\n                  company,\n                  stages,\n                  candidateName: user ? `${user.firstName} ${user.lastName}` : 'Candidate',\n                });\n              }\n            }\n            \n            await storage.updateJobApplication(application.id, {\n              currentStageIndex: nextStageIndex,\n              status: isLastStage ? 'offer' : 'interviewing',\n              offerDetails: offerDetails || undefined,\n            });\n          }\n        }\n      }\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to submit answer:\", error);\n      res.status(500).json({ message: \"Failed to submit answer: \" + (error as Error).message });\n    }\n  });\n\n  // Get interview status\n  app.get(\"/api/interviews/:sessionId\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      \n      const { interviewOrchestrator } = await import(\"./services/interview-orchestrator\");\n      const status = await interviewOrchestrator.getInterviewStatus(sessionId);\n      \n      res.json(status);\n    } catch (error) {\n      console.error(\"Failed to get interview status:\", error);\n      res.status(500).json({ message: \"Failed to get interview status: \" + (error as Error).message });\n    }\n  });\n\n  // Get interview feedback (for viewing past results)\n  app.get(\"/api/interviews/:sessionId/feedback\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      \n      const feedback = await storage.getInterviewFeedback(sessionId);\n      if (!feedback) {\n        return res.status(404).json({ message: \"Feedback not found for this session\" });\n      }\n      \n      // Also get the session info and questions for context\n      const session = await storage.getInterviewSession(sessionId);\n      const questions = await storage.getInterviewQuestions(sessionId);\n      \n      res.json({\n        feedback,\n        session,\n        questions\n      });\n    } catch (error) {\n      console.error(\"Failed to get interview feedback:\", error);\n      res.status(500).json({ message: \"Failed to get interview feedback: \" + (error as Error).message });\n    }\n  });\n\n  // Get user's interview history (supports mode filtering via query param)\n  app.get(\"/api/users/:userId/interviews\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const mode = req.query.mode as 'practice' | 'journey' | undefined;\n      const sessions = await storage.getUserInterviewSessions(userId, mode);\n      res.json(sessions);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get interview history: \" + (error as Error).message });\n    }\n  });\n\n  // Get interview detail with transcript and feedback\n  app.get(\"/api/interviews/:sessionId/detail\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      \n      const session = await storage.getInterviewSession(sessionId);\n      if (!session) {\n        return res.status(404).json({ message: \"Interview session not found\" });\n      }\n      \n      const rawQuestions = await storage.getInterviewQuestions(sessionId);\n      const feedbackData = await storage.getInterviewFeedback(sessionId);\n      \n      // Ensure questions have proper array types for strengths/improvements\n      const questions = rawQuestions.map(q => ({\n        ...q,\n        strengths: Array.isArray(q.strengths) ? q.strengths : [],\n        improvements: Array.isArray(q.improvements) ? q.improvements : [],\n      }));\n      \n      // Format feedback to match frontend expectations\n      const formattedFeedback = feedbackData ? {\n        overallScore: feedbackData.overallScore,\n        communicationScore: feedbackData.communicationScore,\n        technicalScore: feedbackData.technicalScore,\n        problemSolvingScore: feedbackData.problemSolvingScore,\n        cultureFitScore: feedbackData.cultureFitScore,\n        summary: feedbackData.summary,\n        strengths: Array.isArray(feedbackData.strengths) ? feedbackData.strengths : [],\n        improvements: Array.isArray(feedbackData.improvements) ? feedbackData.improvements : [],\n        recommendations: Array.isArray(feedbackData.recommendations) ? feedbackData.recommendations : [],\n        hiringDecision: feedbackData.hiringDecision,\n      } : null;\n      \n      res.json({\n        session,\n        questions,\n        feedback: formattedFeedback\n      });\n    } catch (error) {\n      console.error(\"Failed to get interview detail:\", error);\n      res.status(500).json({ message: \"Failed to get interview detail: \" + (error as Error).message });\n    }\n  });\n\n  // ==================== JOB JOURNEY ROUTES ====================\n\n  // Get all companies\n  app.get(\"/api/companies\", async (req, res) => {\n    try {\n      const companies = await storage.getCompanies();\n      res.json(companies);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get companies\" });\n    }\n  });\n\n  // Get single company\n  app.get(\"/api/companies/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const company = await storage.getCompany(id);\n      if (!company) {\n        return res.status(404).json({ message: \"Company not found\" });\n      }\n      res.json(company);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get company\" });\n    }\n  });\n\n  // Get job postings with optional filters\n  app.get(\"/api/jobs\", async (req, res) => {\n    try {\n      const filters: { companyId?: number; role?: string; isActive?: boolean } = {};\n      if (req.query.companyId) filters.companyId = parseInt(req.query.companyId as string);\n      if (req.query.role) filters.role = req.query.role as string;\n      if (req.query.isActive !== undefined) filters.isActive = req.query.isActive === 'true';\n      \n      const postings = await storage.getJobPostings(filters);\n      \n      // Attach company info to each posting\n      const postingsWithCompanies = await Promise.all(\n        postings.map(async (posting) => {\n          const company = await storage.getCompany(posting.companyId);\n          return { ...posting, company };\n        })\n      );\n      \n      res.json(postingsWithCompanies);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get job postings\" });\n    }\n  });\n\n  // Get single job posting with company\n  app.get(\"/api/jobs/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const posting = await storage.getJobPostingWithCompany(id);\n      if (!posting) {\n        return res.status(404).json({ message: \"Job posting not found\" });\n      }\n      res.json(posting);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get job posting\" });\n    }\n  });\n\n  // Get glossary terms\n  app.get(\"/api/glossary\", async (req, res) => {\n    try {\n      const terms = await storage.getJobGlossary();\n      res.json(terms);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get glossary\" });\n    }\n  });\n\n  // Get single glossary term\n  app.get(\"/api/glossary/:term\", async (req, res) => {\n    try {\n      const term = decodeURIComponent(req.params.term);\n      const glossaryTerm = await storage.getJobGlossaryTerm(term);\n      if (!glossaryTerm) {\n        return res.status(404).json({ message: \"Term not found\" });\n      }\n      res.json(glossaryTerm);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get glossary term\" });\n    }\n  });\n\n  // Get user's job applications\n  app.get(\"/api/users/:userId/applications\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const applicationsWithDetails = await storage.getJobApplicationsWithDetails(userId);\n      res.json(applicationsWithDetails);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get applications\" });\n    }\n  });\n\n  // Get user's workspace instances\n  app.get(\"/api/users/:userId/workspaces\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const workspaces = await storage.getUserWorkspaceInstances(userId);\n      res.json(workspaces);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get workspaces\" });\n    }\n  });\n\n  // Create job application\n  app.post(\"/api/applications\", upload.single('cv'), async (req, res) => {\n    try {\n      const { userId, jobPostingId, coverLetter } = req.body;\n      \n      if (!userId || !jobPostingId) {\n        return res.status(400).json({ message: \"userId and jobPostingId are required\" });\n      }\n\n      // Parse IDs as integers (FormData sends them as strings)\n      const userIdNum = parseInt(userId);\n      const jobPostingIdNum = parseInt(jobPostingId);\n\n      // Get job posting to determine interview stages\n      const job = await storage.getJobPosting(jobPostingIdNum);\n      if (!job) {\n        return res.status(404).json({ message: \"Job posting not found\" });\n      }\n\n      // Extract CV data if provided\n      let cvFileName: string | null = null;\n      let cvContent: string | null = null;\n      \n      if (req.file) {\n        cvFileName = req.file.originalname;\n        \n        // Extract text content from PDF\n        if (req.file.mimetype === 'application/pdf') {\n          try {\n            const parser = new PDFParse({ data: req.file.buffer });\n            const pdfData = await parser.getText();\n            cvContent = pdfData.text.trim();\n            console.log(`Extracted ${cvContent.length} characters from CV PDF`);\n          } catch (pdfError) {\n            console.error(\"Failed to parse PDF:\", pdfError);\n            cvContent = `[PDF parsing failed] ${req.file.originalname}`;\n          }\n        } else {\n          // For other document types, store metadata\n          cvContent = `[${req.file.mimetype}] ${req.file.originalname} (${req.file.size} bytes)`;\n        }\n      }\n\n      // Create the application\n      const application = await storage.createJobApplication({\n        userId: userIdNum,\n        jobPostingId: jobPostingIdNum,\n        status: 'submitted',\n        coverLetter: coverLetter || null,\n        cvFileName: cvFileName,\n        cvContent: cvContent,\n        appliedAt: new Date(),\n      });\n\n      // Get interview template for this role\n      const templates = await storage.getInterviewTemplates(job.companyId, job.role);\n      const template = templates[0]; // Use first matching template\n      \n      // Create interview stages based on template or defaults\n      if (template && template.stages) {\n        const stages = template.stages as Array<{ order: number; type: string; name: string; duration: number; config: any }>;\n        for (const stage of stages) {\n          await storage.createApplicationStage({\n            applicationId: application.id,\n            stageOrder: stage.order,\n            stageName: stage.name,\n            stageType: stage.type,\n            status: 'pending',\n          });\n        }\n      } else {\n        // Check if this is an intern position (simplified 2-stage pipeline)\n        const isIntern = job.title.toLowerCase().includes('intern');\n        \n        // Default stages based on role and level\n        let defaultStages;\n        \n        if (isIntern) {\n          // Intern positions: 2-stage pipeline with team interview\n          defaultStages = [\n            { order: 1, name: 'Recruiter Screen', type: 'recruiter_call' },\n            { order: 2, name: 'Team Interview', type: 'team' },\n          ];\n        } else if (job.role === 'developer') {\n          defaultStages = [\n            { order: 1, name: 'Recruiter Screen', type: 'recruiter_call' },\n            { order: 2, name: 'Technical Screen', type: 'technical' },\n            { order: 3, name: 'Coding Interview', type: 'technical' },\n            { order: 4, name: 'System Design', type: 'technical' },\n            { order: 5, name: 'Team Fit', type: 'behavioral' },\n          ];\n        } else if (job.role === 'pm') {\n          defaultStages = [\n            { order: 1, name: 'Recruiter Screen', type: 'recruiter_call' },\n            { order: 2, name: 'Hiring Manager', type: 'behavioral' },\n            { order: 3, name: 'Product Case', type: 'case_study' },\n          ];\n        } else {\n          defaultStages = [\n            { order: 1, name: 'Recruiter Screen', type: 'recruiter_call' },\n            { order: 2, name: 'Skills Interview', type: 'behavioral' },\n            { order: 3, name: 'Team Fit', type: 'behavioral' },\n          ];\n        }\n\n        for (const stage of defaultStages) {\n          await storage.createApplicationStage({\n            applicationId: application.id,\n            stageOrder: stage.order,\n            stageName: stage.name,\n            stageType: stage.type,\n            status: 'pending',\n          });\n        }\n      }\n\n      // Get the created stages\n      const stages = await storage.getApplicationStages(application.id);\n      const jobWithCompany = await storage.getJobPostingWithCompany(jobPostingId);\n\n      res.json({ ...application, job: jobWithCompany, stages });\n    } catch (error) {\n      console.error(\"Failed to create application:\", error);\n      res.status(500).json({ message: \"Failed to create application\" });\n    }\n  });\n\n  // Get single application with stages\n  app.get(\"/api/applications/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const application = await storage.getJobApplication(id);\n      \n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n\n      const jobWithCompany = await storage.getJobPostingWithCompany(application.jobPostingId);\n      const stages = await storage.getApplicationStages(id);\n\n      res.json({ ...application, job: jobWithCompany, stages });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get application\" });\n    }\n  });\n\n  // Update application status\n  app.patch(\"/api/applications/:id\", async (req, res) => {\n    try {\n      const id = parseInt(req.params.id);\n      const updates = req.body;\n      \n      const application = await storage.updateJobApplication(id, updates);\n      if (!application) {\n        return res.status(404).json({ message: \"Application not found\" });\n      }\n      \n      if (updates.status === 'accepted') {\n        const posting = await storage.getJobPostingWithCompany(application.jobPostingId);\n        \n        let journeyId: number | null = null;\n        const existingJourney = await storage.getUserActiveJourney(application.userId);\n        \n        if (existingJourney) {\n          journeyId = existingJourney.id;\n          if (!existingJourney.jobApplicationId) {\n            await storage.updateJourney(existingJourney.id, { jobApplicationId: id });\n          }\n        } else {\n          const progressionPaths = await storage.getProgressionPaths({ role: 'developer', entryLevel: 'intern' });\n          const progressionPath = progressionPaths[0];\n          \n          if (progressionPath) {\n            const projectTemplates = await storage.getProjectTemplates({});\n            const projectTemplate = projectTemplates[0];\n            \n            if (projectTemplate) {\n              const newJourney = await storage.createJourney({\n                userId: application.userId,\n                progressionPathId: progressionPath.id,\n                projectTemplateId: projectTemplate.id,\n                jobApplicationId: id,\n                status: 'active',\n                currentSprintNumber: 0,\n                completedSprints: 0,\n              });\n              journeyId = newJourney.id;\n            }\n          }\n        }\n        \n        if (journeyId) {\n          const existingWorkspace = await storage.getWorkspaceInstanceByJourney(journeyId);\n          if (!existingWorkspace) {\n            await storage.createWorkspaceInstance({\n              userId: application.userId,\n              journeyId,\n              jobApplicationId: id,\n              companyName: posting?.company?.name || 'TechCorp',\n              role: posting?.role || 'Developer',\n              currentPhase: 'onboarding',\n            });\n          }\n        }\n      }\n      \n      res.json(application);\n    } catch (error) {\n      console.error(\"Failed to update application:\", error);\n      res.status(500).json({ message: \"Failed to update application\" });\n    }\n  });\n\n  // Update application stage (for interview completion, etc.)\n  app.patch(\"/api/applications/:applicationId/stages/:stageId\", async (req, res) => {\n    try {\n      const stageId = parseInt(req.params.stageId);\n      const updates = req.body;\n      \n      const stage = await storage.updateApplicationStage(stageId, updates);\n      if (!stage) {\n        return res.status(404).json({ message: \"Stage not found\" });\n      }\n      \n      // If stage is completed, update application's current stage index\n      if (updates.status === 'completed') {\n        const applicationId = parseInt(req.params.applicationId);\n        const application = await storage.getJobApplication(applicationId);\n        if (application) {\n          await storage.updateJobApplication(applicationId, {\n            currentStageIndex: application.currentStageIndex + 1,\n          });\n        }\n      }\n      \n      res.json(stage);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update stage\" });\n    }\n  });\n\n  // Get interview templates\n  app.get(\"/api/interview-templates\", async (req, res) => {\n    try {\n      const companyId = req.query.companyId ? parseInt(req.query.companyId as string) : undefined;\n      const role = req.query.role as string | undefined;\n      \n      const templates = await storage.getInterviewTemplates(companyId, role);\n      res.json(templates);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get templates\" });\n    }\n  });\n\n  // ============================================\n  // Phase 1: Catalogue, Competency & Progression APIs\n  // ============================================\n\n  // GET /api/catalogue - List catalogue items with filters\n  app.get(\"/api/catalogue\", async (req, res) => {\n    try {\n      const filters: {\n        simulator?: string;\n        type?: string;\n        role?: string;\n        level?: string;\n        language?: string;\n        day?: number;\n      } = {};\n\n      if (req.query.simulator) filters.simulator = req.query.simulator as string;\n      if (req.query.type) filters.type = req.query.type as string;\n      if (req.query.role) filters.role = req.query.role as string;\n      if (req.query.level) filters.level = req.query.level as string;\n      if (req.query.language) filters.language = req.query.language as string;\n      if (req.query.day) filters.day = parseInt(req.query.day as string);\n\n      const items = await storage.getCatalogueItems(filters);\n      res.json(items);\n    } catch (error) {\n      console.error(\"Failed to get catalogue items:\", error);\n      res.status(500).json({ message: \"Failed to get catalogue items\" });\n    }\n  });\n\n  // GET /api/catalogue/:externalId - Get single catalogue item by external ID\n  app.get(\"/api/catalogue/:externalId\", async (req, res) => {\n    try {\n      const item = await storage.getCatalogueItem(req.params.externalId);\n      if (!item) {\n        return res.status(404).json({ message: \"Catalogue item not found\" });\n      }\n      res.json(item);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get catalogue item\" });\n    }\n  });\n\n  // GET /api/competencies - List all competencies with optional filters\n  app.get(\"/api/competencies\", async (req, res) => {\n    try {\n      const filters: { role?: string; category?: string } = {};\n\n      if (req.query.role) filters.role = req.query.role as string;\n      if (req.query.category) filters.category = req.query.category as string;\n\n      const items = await storage.getCompetencies(filters);\n      res.json(items);\n    } catch (error) {\n      console.error(\"Failed to get competencies:\", error);\n      res.status(500).json({ message: \"Failed to get competencies\" });\n    }\n  });\n\n  // GET /api/competencies/:slug - Get single competency by slug\n  app.get(\"/api/competencies/:slug\", async (req, res) => {\n    try {\n      const competency = await storage.getCompetency(req.params.slug);\n      if (!competency) {\n        return res.status(404).json({ message: \"Competency not found\" });\n      }\n      res.json(competency);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get competency\" });\n    }\n  });\n\n  // GET /api/role-adapters - List all role adapters\n  app.get(\"/api/role-adapters\", async (req, res) => {\n    try {\n      const adapters = await storage.getRoleAdapters();\n      res.json(adapters);\n    } catch (error) {\n      console.error(\"Failed to get role adapters:\", error);\n      res.status(500).json({ message: \"Failed to get role adapters\" });\n    }\n  });\n\n  // GET /api/role-adapters/:role - Get single role adapter\n  app.get(\"/api/role-adapters/:role\", async (req, res) => {\n    try {\n      const adapter = await storage.getRoleAdapter(req.params.role);\n      if (!adapter) {\n        return res.status(404).json({ message: \"Role adapter not found\" });\n      }\n      res.json(adapter);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to get role adapter\" });\n    }\n  });\n\n  // GET /api/user/:id/readiness - Get user's readiness score\n  app.get(\"/api/user/:id/readiness\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n\n      const readiness = await storage.getUserReadiness(userId);\n      res.json(readiness);\n    } catch (error) {\n      console.error(\"Failed to get user readiness:\", error);\n      res.status(500).json({ message: \"Failed to get user readiness\" });\n    }\n  });\n\n  // POST /api/user/:id/competency-delta - Record competency evidence\n  app.post(\"/api/user/:id/competency-delta\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n\n      // Validate the delta payload\n      const deltaSchema = z.object({\n        competencySlug: z.string(),\n        source: z.enum(['workspace', 'interview']),\n        catalogueItemId: z.number().optional(),\n        evidenceType: z.string(),\n        evidenceData: z.record(z.unknown()).optional(),\n        score: z.number().min(0).max(100).optional(),\n      });\n\n      const delta = deltaSchema.parse(req.body);\n\n      // Find the competency by slug\n      const competency = await storage.getCompetency(delta.competencySlug);\n      if (!competency) {\n        return res.status(404).json({ message: `Competency '${delta.competencySlug}' not found` });\n      }\n\n      // Get or create competency ledger entry for this user\n      let entry = await storage.getUserCompetencyEntry(userId, competency.id);\n      \n      if (!entry) {\n        entry = await storage.createCompetencyEntry({\n          userId,\n          competencyId: competency.id,\n          currentBand: 'explorer',\n          evidenceCount: 0,\n          confidence: 0,\n          history: [],\n        });\n      }\n\n      // Calculate new values\n      const newEvidenceCount = entry.evidenceCount + 1;\n      const newConfidence = Math.min(100, entry.confidence + (delta.score ? Math.round(delta.score / 10) : 5));\n      \n      // Determine if band should upgrade\n      let newBand = entry.currentBand;\n      if (newEvidenceCount >= 10 && newConfidence >= 70 && entry.currentBand === 'explorer') {\n        newBand = 'contributor';\n      } else if (newEvidenceCount >= 25 && newConfidence >= 85 && entry.currentBand === 'contributor') {\n        newBand = 'junior_ready';\n      }\n\n      // Build history event\n      const historyEvent = {\n        timestamp: new Date().toISOString(),\n        source: delta.source,\n        evidenceType: delta.evidenceType,\n        catalogueItemId: delta.catalogueItemId,\n        score: delta.score,\n        bandBefore: entry.currentBand,\n        bandAfter: newBand,\n      };\n\n      const existingHistory = Array.isArray(entry.history) ? entry.history : [];\n\n      // Update the entry\n      const updatedEntry = await storage.updateCompetencyEntry(entry.id, {\n        evidenceCount: newEvidenceCount,\n        confidence: newConfidence,\n        currentBand: newBand,\n        lastEvidenceAt: new Date(),\n        history: [...existingHistory, historyEvent],\n      });\n\n      res.json({\n        competencySlug: delta.competencySlug,\n        previousBand: entry.currentBand,\n        currentBand: newBand,\n        evidenceCount: newEvidenceCount,\n        confidence: newConfidence,\n        bandChanged: entry.currentBand !== newBand,\n        entry: updatedEntry,\n      });\n    } catch (error) {\n      console.error(\"Failed to record competency delta:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid request body\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to record competency delta\" });\n    }\n  });\n\n  // GET /api/user/:id/portfolio - Get user's portfolio artifacts\n  app.get(\"/api/user/:id/portfolio\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n\n      const artifacts = await storage.getUserPortfolio(userId);\n      res.json(artifacts);\n    } catch (error) {\n      console.error(\"Failed to get user portfolio:\", error);\n      res.status(500).json({ message: \"Failed to get user portfolio\" });\n    }\n  });\n\n  // POST /api/user/:id/portfolio - Add portfolio artifact\n  app.post(\"/api/user/:id/portfolio\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n\n      const artifactSchema = z.object({\n        source: z.enum(['workspace', 'interview', 'upload']),\n        catalogueItemId: z.number().optional(),\n        title: z.string(),\n        artifactType: z.string(),\n        summary: z.string().optional(),\n        artifactData: z.record(z.unknown()),\n        evidenceCompetencies: z.array(z.string()).optional(),\n      });\n\n      const artifactInput = artifactSchema.parse(req.body);\n\n      const artifact = await storage.createPortfolioArtifact({\n        userId,\n        ...artifactInput,\n      });\n\n      res.status(201).json(artifact);\n    } catch (error) {\n      console.error(\"Failed to create portfolio artifact:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid request body\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create portfolio artifact\" });\n    }\n  });\n\n  // GET /api/user/:id/competency-ledger - Get user's competency ledger entries\n  app.get(\"/api/user/:id/competency-ledger\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.id);\n      if (isNaN(userId)) {\n        return res.status(400).json({ message: \"Invalid user ID\" });\n      }\n\n      const entries = await storage.getUserCompetencyLedger(userId);\n      res.json(entries);\n    } catch (error) {\n      console.error(\"Failed to get user competency ledger:\", error);\n      res.status(500).json({ message: \"Failed to get user competency ledger\" });\n    }\n  });\n\n  // ============================================\n  // Phase 2: Adapter Configuration APIs\n  // ============================================\n\n  // GET /api/adapters/interview-config - Get interview configuration for role/level\n  app.get(\"/api/adapters/interview-config\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole, normalizeLevel } = await import(\"./services/adapter-service\");\n      \n      const role = req.query.role as string;\n      const level = req.query.level as string;\n\n      if (!role || !level) {\n        return res.status(400).json({ message: \"Role and level are required\" });\n      }\n\n      const config = await adapterService.getInterviewConfiguration({\n        role: normalizeRole(role),\n        level: normalizeLevel(level),\n      });\n\n      if (!config) {\n        return res.status(404).json({ message: \"Configuration not found for role/level\" });\n      }\n\n      res.json(config);\n    } catch (error) {\n      console.error(\"Failed to get interview config:\", error);\n      res.status(500).json({ message: \"Failed to get interview configuration\" });\n    }\n  });\n\n  // GET /api/adapters/workspace-config - Get workspace configuration for role/level/language\n  app.get(\"/api/adapters/workspace-config\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole, normalizeLevel } = await import(\"./services/adapter-service\");\n      \n      const role = req.query.role as string;\n      const level = req.query.level as string;\n      const language = (req.query.language as string) || 'javascript';\n\n      if (!role || !level) {\n        return res.status(400).json({ message: \"Role and level are required\" });\n      }\n\n      const config = await adapterService.getWorkspaceConfiguration({\n        role: normalizeRole(role),\n        level: normalizeLevel(level),\n        language: language as 'javascript' | 'python' | 'c_cpp',\n      });\n\n      if (!config) {\n        return res.status(404).json({ message: \"Configuration not found for role/level\" });\n      }\n\n      res.json(config);\n    } catch (error) {\n      console.error(\"Failed to get workspace config:\", error);\n      res.status(500).json({ message: \"Failed to get workspace configuration\" });\n    }\n  });\n\n  // GET /api/adapters/interview-questions - Get interview question configuration\n  app.get(\"/api/adapters/interview-questions\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole, normalizeLevel } = await import(\"./services/adapter-service\");\n      \n      const role = req.query.role as string;\n      const level = req.query.level as string;\n\n      if (!role || !level) {\n        return res.status(400).json({ message: \"Role and level are required\" });\n      }\n\n      const config = await adapterService.getInterviewQuestionConfig({\n        role: normalizeRole(role),\n        level: normalizeLevel(level),\n      });\n\n      if (!config) {\n        return res.status(404).json({ message: \"Configuration not found for role/level\" });\n      }\n\n      res.json(config);\n    } catch (error) {\n      console.error(\"Failed to get interview question config:\", error);\n      res.status(500).json({ message: \"Failed to get interview question configuration\" });\n    }\n  });\n\n  // GET /api/adapters/workspace-problems - Get workspace problem configuration\n  app.get(\"/api/adapters/workspace-problems\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole, normalizeLevel } = await import(\"./services/adapter-service\");\n      \n      const role = req.query.role as string;\n      const level = req.query.level as string;\n      const language = (req.query.language as string) || 'javascript';\n\n      if (!role || !level) {\n        return res.status(400).json({ message: \"Role and level are required\" });\n      }\n\n      const config = await adapterService.getWorkspaceProblemConfig({\n        role: normalizeRole(role),\n        level: normalizeLevel(level),\n        language: language as 'javascript' | 'python' | 'c_cpp',\n      });\n\n      if (!config) {\n        return res.status(404).json({ message: \"Configuration not found for role/level\" });\n      }\n\n      res.json(config);\n    } catch (error) {\n      console.error(\"Failed to get workspace problem config:\", error);\n      res.status(500).json({ message: \"Failed to get workspace problem configuration\" });\n    }\n  });\n\n  // GET /api/adapters/available-roles - Get all available roles\n  app.get(\"/api/adapters/available-roles\", async (req, res) => {\n    try {\n      const { adapterService } = await import(\"./services/adapter-service\");\n      const roles = await adapterService.getAvailableRoles();\n      res.json(roles);\n    } catch (error) {\n      console.error(\"Failed to get available roles:\", error);\n      res.status(500).json({ message: \"Failed to get available roles\" });\n    }\n  });\n\n  // GET /api/adapters/available-levels/:role - Get available levels for a role\n  app.get(\"/api/adapters/available-levels/:role\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole } = await import(\"./services/adapter-service\");\n      const role = normalizeRole(req.params.role);\n      const levels = await adapterService.getAvailableLevels(role);\n      res.json(levels);\n    } catch (error) {\n      console.error(\"Failed to get available levels:\", error);\n      res.status(500).json({ message: \"Failed to get available levels\" });\n    }\n  });\n\n  // GET /api/adapters/available-languages/:role - Get available languages for a role\n  app.get(\"/api/adapters/available-languages/:role\", async (req, res) => {\n    try {\n      const { adapterService, normalizeRole } = await import(\"./services/adapter-service\");\n      const role = normalizeRole(req.params.role);\n      const languages = await adapterService.getAvailableLanguages(role);\n      res.json(languages);\n    } catch (error) {\n      console.error(\"Failed to get available languages:\", error);\n      res.status(500).json({ message: \"Failed to get available languages\" });\n    }\n  });\n\n  // ============================================================================\n  // PHASE 3: NARRATIVE ARCHITECTURE ROUTES\n  // ============================================================================\n\n  // GET /api/progression-paths - Get all progression paths\n  app.get(\"/api/progression-paths\", async (req, res) => {\n    try {\n      const role = req.query.role as string;\n      const entryLevel = req.query.entryLevel as string;\n      const paths = await storage.getProgressionPaths({ role, entryLevel });\n      res.json(paths);\n    } catch (error) {\n      console.error(\"Failed to get progression paths:\", error);\n      res.status(500).json({ message: \"Failed to get progression paths\" });\n    }\n  });\n\n  // GET /api/progression-paths/:slug - Get single progression path\n  app.get(\"/api/progression-paths/:slug\", async (req, res) => {\n    try {\n      const path = await storage.getProgressionPath(req.params.slug);\n      if (!path) {\n        return res.status(404).json({ message: \"Progression path not found\" });\n      }\n      res.json(path);\n    } catch (error) {\n      console.error(\"Failed to get progression path:\", error);\n      res.status(500).json({ message: \"Failed to get progression path\" });\n    }\n  });\n\n  // GET /api/project-templates - Get all project templates\n  app.get(\"/api/project-templates\", async (req, res) => {\n    try {\n      const language = req.query.language as string;\n      const industry = req.query.industry as string;\n      const templates = await storage.getProjectTemplates({ language, industry });\n      res.json(templates);\n    } catch (error) {\n      console.error(\"Failed to get project templates:\", error);\n      res.status(500).json({ message: \"Failed to get project templates\" });\n    }\n  });\n\n  // GET /api/project-templates/:slug - Get single project template\n  app.get(\"/api/project-templates/:slug\", async (req, res) => {\n    try {\n      const template = await storage.getProjectTemplate(req.params.slug);\n      if (!template) {\n        return res.status(404).json({ message: \"Project template not found\" });\n      }\n      res.json(template);\n    } catch (error) {\n      console.error(\"Failed to get project template:\", error);\n      res.status(500).json({ message: \"Failed to get project template\" });\n    }\n  });\n\n  // GET /api/user/:userId/journey - Get user's active journey state\n  app.get(\"/api/user/:userId/journey\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const activeJourney = await storage.getUserActiveJourney(userId);\n      \n      if (!activeJourney) {\n        return res.json({ journey: null, state: null });\n      }\n      \n      const state = await storage.getJourneyState(activeJourney.id);\n      res.json({ journey: activeJourney, state });\n    } catch (error) {\n      console.error(\"Failed to get user journey:\", error);\n      res.status(500).json({ message: \"Failed to get user journey\" });\n    }\n  });\n\n  // GET /api/user/:userId/journeys - Get all user journeys\n  app.get(\"/api/user/:userId/journeys\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const journeys = await storage.getUserJourneys(userId);\n      res.json(journeys);\n    } catch (error) {\n      console.error(\"Failed to get user journeys:\", error);\n      res.status(500).json({ message: \"Failed to get user journeys\" });\n    }\n  });\n\n  // POST /api/user/:userId/journey/start - Start a new journey\n  app.post(\"/api/user/:userId/journey/start\", async (req, res) => {\n    try {\n      const userId = parseInt(req.params.userId);\n      const { progressionPathSlug, projectTemplateSlug, jobApplicationId } = req.body;\n\n      // Check for existing active journey\n      const existingJourney = await storage.getUserActiveJourney(userId);\n      if (existingJourney) {\n        return res.status(400).json({ message: \"User already has an active journey\" });\n      }\n\n      // Get progression path and project template\n      const progressionPath = await storage.getProgressionPath(progressionPathSlug);\n      if (!progressionPath) {\n        return res.status(404).json({ message: \"Progression path not found\" });\n      }\n\n      const projectTemplate = await storage.getProjectTemplate(projectTemplateSlug);\n      if (!projectTemplate) {\n        return res.status(404).json({ message: \"Project template not found\" });\n      }\n\n      // Create journey\n      const journey = await storage.createJourney({\n        userId,\n        progressionPathId: progressionPath.id,\n        projectTemplateId: projectTemplate.id,\n        jobApplicationId: jobApplicationId || null,\n        status: 'active',\n        currentSprintNumber: 0,\n        completedSprints: 0,\n        readinessScore: 0,\n        journeyMetadata: {}\n      });\n\n      // Create onboarding arc\n      const onboardingArc = await storage.createJourneyArc({\n        journeyId: journey.id,\n        arcType: 'onboarding',\n        arcOrder: 1,\n        name: 'Onboarding',\n        description: 'First week at your new job',\n        status: 'active',\n        difficultyBand: 'guided',\n        durationDays: 5,\n        competencyFocus: ['professional-communication', 'codebase-navigation', 'git-workflow'],\n        isFinalArc: false,\n        arcData: {}\n      });\n\n      // Update journey with current arc\n      await storage.updateJourney(journey.id, { currentArcId: onboardingArc.id });\n\n      const state = await storage.getJourneyState(journey.id);\n      res.json({ journey, state });\n    } catch (error) {\n      console.error(\"Failed to start journey:\", error);\n      res.status(500).json({ message: \"Failed to start journey\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId - Get journey details\n  app.get(\"/api/journey/:journeyId\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const journey = await storage.getJourney(journeyId);\n      \n      if (!journey) {\n        return res.status(404).json({ message: \"Journey not found\" });\n      }\n      \n      const state = await storage.getJourneyState(journeyId);\n      res.json({ journey, state });\n    } catch (error) {\n      console.error(\"Failed to get journey:\", error);\n      res.status(500).json({ message: \"Failed to get journey\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId/arcs - Get all arcs for a journey\n  app.get(\"/api/journey/:journeyId/arcs\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const arcs = await storage.getJourneyArcs(journeyId);\n      res.json(arcs);\n    } catch (error) {\n      console.error(\"Failed to get journey arcs:\", error);\n      res.status(500).json({ message: \"Failed to get journey arcs\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId/current-sprint - Get current sprint details\n  app.get(\"/api/journey/:journeyId/current-sprint\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const journey = await storage.getJourney(journeyId);\n      \n      if (!journey) {\n        return res.status(404).json({ message: \"Journey not found\" });\n      }\n\n      const currentArc = await storage.getCurrentArc(journeyId);\n      if (!currentArc || currentArc.arcType !== 'sprint') {\n        return res.json({ sprint: null, activities: [] });\n      }\n\n      const sprint = await storage.getSprintByArc(currentArc.id);\n      if (!sprint) {\n        return res.json({ sprint: null, activities: [] });\n      }\n\n      const activities = await storage.getSprintActivities(sprint.id);\n      res.json({ sprint, activities });\n    } catch (error) {\n      console.error(\"Failed to get current sprint:\", error);\n      res.status(500).json({ message: \"Failed to get current sprint\" });\n    }\n  });\n\n  // POST /api/journey/:journeyId/complete-activity - Complete an activity and record competency delta\n  app.post(\"/api/journey/:journeyId/complete-activity\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const journeyId = parseInt(req.params.journeyId);\n      const { activityId, userResponse, evaluation } = req.body;\n\n      const result = await progressionEngine.completeActivity(\n        journeyId,\n        activityId,\n        userResponse,\n        evaluation\n      );\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to complete activity:\", error);\n      res.status(500).json({ message: \"Failed to complete activity\" });\n    }\n  });\n\n  // POST /api/journey/:journeyId/complete-sprint - Complete current sprint\n  app.post(\"/api/journey/:journeyId/complete-sprint\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const journeyId = parseInt(req.params.journeyId);\n\n      const result = await progressionEngine.completeSprint(journeyId);\n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to complete sprint:\", error);\n      res.status(500).json({ message: \"Failed to complete sprint\" });\n    }\n  });\n\n  // POST /api/journey/:journeyId/start-new-sprint - Start a new sprint with generated backlog\n  app.post(\"/api/journey/:journeyId/start-new-sprint\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const journeyId = parseInt(req.params.journeyId);\n\n      const result = await progressionEngine.startNewSprint(journeyId);\n      res.json({\n        sprint: result.sprint,\n        arc: result.arc,\n        backlog: {\n          tickets: result.generatedBacklog.tickets,\n          softSkillEvents: result.generatedBacklog.softSkillEvents,\n          theme: result.generatedBacklog.theme\n        }\n      });\n    } catch (error) {\n      console.error(\"Failed to start new sprint:\", error);\n      res.status(500).json({ message: \"Failed to start new sprint\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId/exit-eligibility - Check if user can exit/graduate\n  app.get(\"/api/journey/:journeyId/exit-eligibility\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const journeyId = parseInt(req.params.journeyId);\n\n      const eligibility = await progressionEngine.checkExitEligibility(journeyId);\n      res.json(eligibility);\n    } catch (error) {\n      console.error(\"Failed to check exit eligibility:\", error);\n      res.status(500).json({ message: \"Failed to check exit eligibility\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId/summary - Get full progression summary\n  app.get(\"/api/journey/:journeyId/summary\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const journeyId = parseInt(req.params.journeyId);\n\n      const summary = await progressionEngine.getProgressionSummary(journeyId);\n      res.json(summary);\n    } catch (error) {\n      console.error(\"Failed to get progression summary:\", error);\n      res.status(500).json({ message: \"Failed to get progression summary\" });\n    }\n  });\n\n  // POST /api/user/:userId/competency-delta - Record a competency delta\n  app.post(\"/api/user/:userId/competency-delta\", async (req, res) => {\n    try {\n      const { progressionEngine } = await import(\"./services/progression-engine\");\n      const userId = parseInt(req.params.userId);\n      const { journeyId, competencySlug, source, evidenceType, score, activityId } = req.body;\n\n      const result = await progressionEngine.calculateDelta({\n        userId,\n        journeyId,\n        competencySlug,\n        source,\n        evidenceType,\n        score,\n        activityId\n      });\n\n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to record competency delta:\", error);\n      res.status(500).json({ message: \"Failed to record competency delta\" });\n    }\n  });\n\n  // POST /api/journey/:journeyId/graduate - Trigger graduation\n  app.post(\"/api/journey/:journeyId/graduate\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const { exitTrigger } = req.body; // 'user_choice', 'readiness_threshold', 'max_sprints'\n\n      const journey = await storage.getJourney(journeyId);\n      if (!journey) {\n        return res.status(404).json({ message: \"Journey not found\" });\n      }\n\n      // Get progression path for badge\n      const progressionPath = await storage.getProgressionPathById(journey.progressionPathId);\n\n      // Take final competency snapshot\n      const userReadiness = await storage.getUserReadiness(journey.userId);\n      await storage.createCompetencySnapshot({\n        userId: journey.userId,\n        journeyId: journey.id,\n        snapshotType: 'journey_end',\n        readinessScore: userReadiness.overallScore,\n        competencyScores: userReadiness.competencyBreakdown.reduce((acc, c) => {\n          acc[c.slug] = { band: c.band, confidence: c.confidence, score: c.evidenceCount };\n          return acc;\n        }, {} as Record<string, { band: string; confidence: number; score: number }>),\n        strengths: userReadiness.strengths,\n        gaps: userReadiness.gaps\n      });\n\n      // Update journey\n      const updatedJourney = await storage.updateJourney(journeyId, {\n        status: 'graduated',\n        exitTrigger,\n        graduatedAt: new Date(),\n        completedAt: new Date(),\n        badgeAwarded: progressionPath?.exitBadge || null\n      });\n\n      res.json({ journey: updatedJourney, badge: progressionPath?.exitBadge });\n    } catch (error) {\n      console.error(\"Failed to graduate journey:\", error);\n      res.status(500).json({ message: \"Failed to graduate journey\" });\n    }\n  });\n\n  // GET /api/journey/:journeyId/snapshots - Get competency snapshots\n  app.get(\"/api/journey/:journeyId/snapshots\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const snapshots = await storage.getCompetencySnapshots(journeyId);\n      res.json(snapshots);\n    } catch (error) {\n      console.error(\"Failed to get competency snapshots:\", error);\n      res.status(500).json({ message: \"Failed to get competency snapshots\" });\n    }\n  });\n\n  // GET /api/sprint/:sprintId - Get sprint details\n  app.get(\"/api/sprint/:sprintId\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const sprint = await storage.getSprint(sprintId);\n      \n      if (!sprint) {\n        return res.status(404).json({ message: \"Sprint not found\" });\n      }\n      \n      const activities = await storage.getSprintActivities(sprintId);\n      res.json({ sprint, activities });\n    } catch (error) {\n      console.error(\"Failed to get sprint:\", error);\n      res.status(500).json({ message: \"Failed to get sprint\" });\n    }\n  });\n\n  // GET /api/sprint/:sprintId/activities - Get sprint activities\n  app.get(\"/api/sprint/:sprintId/activities\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const dayNumber = req.query.day ? parseInt(req.query.day as string) : undefined;\n      const activities = await storage.getSprintActivities(sprintId, dayNumber);\n      res.json(activities);\n    } catch (error) {\n      console.error(\"Failed to get sprint activities:\", error);\n      res.status(500).json({ message: \"Failed to get sprint activities\" });\n    }\n  });\n\n  // PATCH /api/activity/:activityId - Update activity\n  app.patch(\"/api/activity/:activityId\", async (req, res) => {\n    try {\n      const activityId = parseInt(req.params.activityId);\n      const updates = req.body;\n      const activity = await storage.updateSprintActivity(activityId, updates);\n      \n      if (!activity) {\n        return res.status(404).json({ message: \"Activity not found\" });\n      }\n      \n      res.json(activity);\n    } catch (error) {\n      console.error(\"Failed to update activity:\", error);\n      res.status(500).json({ message: \"Failed to update activity\" });\n    }\n  });\n\n  // =====================================================\n  // Phase 4: Sprint Generator Routes\n  // =====================================================\n\n  // GET /api/sprint-generator/templates - Get all template IDs\n  app.get(\"/api/sprint-generator/templates\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const templates = sprintGenerator.getAllTemplateIds();\n      res.json(templates);\n    } catch (error) {\n      console.error(\"Failed to get templates:\", error);\n      res.status(500).json({ message: \"Failed to get templates\" });\n    }\n  });\n\n  // GET /api/sprint-generator/templates/stats - Get template statistics\n  app.get(\"/api/sprint-generator/templates/stats\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const stats = sprintGenerator.getTemplateStats();\n      res.json(stats);\n    } catch (error) {\n      console.error(\"Failed to get template stats:\", error);\n      res.status(500).json({ message: \"Failed to get template stats\" });\n    }\n  });\n\n  // GET /api/sprint-generator/templates/:category/:id - Get specific template details\n  app.get(\"/api/sprint-generator/templates/:category/:id\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const category = req.params.category as 'bugs' | 'features' | 'soft_skills';\n      const id = req.params.id;\n      \n      const template = sprintGenerator.getTemplateDetails(category, id);\n      \n      if (!template) {\n        return res.status(404).json({ message: \"Template not found\" });\n      }\n      \n      res.json(template);\n    } catch (error) {\n      console.error(\"Failed to get template:\", error);\n      res.status(500).json({ message: \"Failed to get template\" });\n    }\n  });\n\n  // GET /api/sprint-generator/themes - Get all available themes\n  app.get(\"/api/sprint-generator/themes\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const themes = sprintGenerator.getAvailableThemes();\n      res.json(themes);\n    } catch (error) {\n      console.error(\"Failed to get themes:\", error);\n      res.status(500).json({ message: \"Failed to get themes\" });\n    }\n  });\n\n  // GET /api/sprint-generator/themes/:id - Get specific theme\n  app.get(\"/api/sprint-generator/themes/:id\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const theme = sprintGenerator.getTheme(req.params.id);\n      \n      if (!theme) {\n        return res.status(404).json({ message: \"Theme not found\" });\n      }\n      \n      res.json(theme);\n    } catch (error) {\n      console.error(\"Failed to get theme:\", error);\n      res.status(500).json({ message: \"Failed to get theme\" });\n    }\n  });\n\n  // POST /api/sprint-generator/generate - Generate a new sprint backlog\n  app.post(\"/api/sprint-generator/generate\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      \n      const previousSprintSchema = z.object({\n        id: z.number().optional(),\n        theme: z.string().optional(),\n        generationMetadata: z.any().optional(),\n      }).passthrough();\n      \n      const requestSchema = z.object({\n        journeyId: z.number(),\n        sprintNumber: z.number(),\n        difficultyBand: z.enum(['guided', 'supported', 'independent', 'expert']),\n        previousSprints: z.array(previousSprintSchema).default([]),\n        userCompetencyGaps: z.array(z.string()).default([]),\n        avoidThemes: z.array(z.string()).default([]),\n        avoidTemplates: z.array(z.string()).default([]),\n      });\n      \n      const validatedRequest = requestSchema.parse(req.body);\n      \n      const backlog = await sprintGenerator.generateSprint(validatedRequest as any);\n      \n      res.json(backlog);\n    } catch (error) {\n      console.error(\"Failed to generate sprint:\", error);\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid request\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to generate sprint\" });\n    }\n  });\n\n  // GET /api/sprint-generator/templates-by-difficulty/:band - Get templates for a mastery band\n  app.get(\"/api/sprint-generator/templates-by-difficulty/:band\", async (req, res) => {\n    try {\n      const { sprintGenerator } = await import(\"./services/sprint-generator\");\n      const band = req.params.band as 'explorer' | 'contributor' | 'junior_ready';\n      \n      if (!['explorer', 'contributor', 'junior_ready'].includes(band)) {\n        return res.status(400).json({ message: \"Invalid mastery band\" });\n      }\n      \n      const templates = sprintGenerator.getTemplatesByDifficulty(band);\n      res.json(templates);\n    } catch (error) {\n      console.error(\"Failed to get templates by difficulty:\", error);\n      res.status(500).json({ message: \"Failed to get templates by difficulty\" });\n    }\n  });\n\n  // ============================================\n  // Phase 5: Journey & Sprint Management APIs\n  // ============================================\n\n  // GET /api/journeys - Get all journeys for current user\n  app.get(\"/api/journeys\", async (req, res) => {\n    try {\n      // For MVP, use user ID 1\n      const userId = 1;\n      const journeys = await storage.getUserJourneys(userId);\n      res.json(journeys);\n    } catch (error) {\n      console.error(\"Failed to get journeys:\", error);\n      res.status(500).json({ message: \"Failed to get journeys\" });\n    }\n  });\n\n  // GET /api/journeys/:journeyId/dashboard - Get full journey dashboard\n  app.get(\"/api/journeys/:journeyId/dashboard\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const dashboard = await storage.getJourneyDashboard(journeyId);\n      \n      if (!dashboard) {\n        return res.status(404).json({ message: \"Journey not found\" });\n      }\n      \n      res.json(dashboard);\n    } catch (error) {\n      console.error(\"Failed to get journey dashboard:\", error);\n      res.status(500).json({ message: \"Failed to get journey dashboard\" });\n    }\n  });\n\n  // GET /api/journeys/:journeyId/sprints - Get all sprints for a journey\n  app.get(\"/api/journeys/:journeyId/sprints\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const sprints = await storage.getSprintsByJourney(journeyId);\n      res.json(sprints);\n    } catch (error) {\n      console.error(\"Failed to get sprints:\", error);\n      res.status(500).json({ message: \"Failed to get sprints\" });\n    }\n  });\n\n  // GET /api/sprints/:sprintId - Get sprint with overview\n  app.get(\"/api/sprints/:sprintId\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const overview = await storage.getSprintOverview(sprintId);\n      \n      if (!overview) {\n        return res.status(404).json({ message: \"Sprint not found\" });\n      }\n      \n      res.json(overview);\n    } catch (error) {\n      console.error(\"Failed to get sprint:\", error);\n      res.status(500).json({ message: \"Failed to get sprint\" });\n    }\n  });\n\n  // PATCH /api/sprints/:sprintId - Update sprint state\n  app.patch(\"/api/sprints/:sprintId\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const updates = req.body;\n      \n      const sprint = await storage.updateSprint(sprintId, updates);\n      \n      if (!sprint) {\n        return res.status(404).json({ message: \"Sprint not found\" });\n      }\n      \n      res.json(sprint);\n    } catch (error) {\n      console.error(\"Failed to update sprint:\", error);\n      res.status(500).json({ message: \"Failed to update sprint\" });\n    }\n  });\n\n  // ============================================\n  // Sprint Ticket APIs\n  // ============================================\n\n  // GET /api/sprints/:sprintId/tickets - Get all tickets for a sprint\n  app.get(\"/api/sprints/:sprintId/tickets\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const tickets = await storage.getSprintTickets(sprintId);\n      res.json(tickets);\n    } catch (error) {\n      console.error(\"Failed to get tickets:\", error);\n      res.status(500).json({ message: \"Failed to get tickets\" });\n    }\n  });\n\n  // GET /api/tickets/:ticketId - Get single ticket\n  app.get(\"/api/tickets/:ticketId\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      const ticket = await storage.getSprintTicket(ticketId);\n      \n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      \n      res.json(ticket);\n    } catch (error) {\n      console.error(\"Failed to get ticket:\", error);\n      res.status(500).json({ message: \"Failed to get ticket\" });\n    }\n  });\n\n  // POST /api/sprints/:sprintId/tickets - Create ticket\n  app.post(\"/api/sprints/:sprintId/tickets\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const ticketData = { ...req.body, sprintId };\n      \n      const ticket = await storage.createSprintTicket(ticketData);\n      res.status(201).json(ticket);\n    } catch (error) {\n      console.error(\"Failed to create ticket:\", error);\n      res.status(500).json({ message: \"Failed to create ticket\" });\n    }\n  });\n\n  // PATCH /api/tickets/:ticketId - Update ticket status/details\n  app.patch(\"/api/tickets/:ticketId\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      const updates = req.body;\n      \n      const ticket = await storage.updateSprintTicket(ticketId, updates);\n      \n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      \n      res.json(ticket);\n    } catch (error) {\n      console.error(\"Failed to update ticket:\", error);\n      res.status(500).json({ message: \"Failed to update ticket\" });\n    }\n  });\n\n  // PATCH /api/tickets/:ticketId/move - Move ticket between kanban columns\n  app.patch(\"/api/tickets/:ticketId/move\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      const { newStatus } = req.body;\n      \n      const validStatuses = ['todo', 'in_progress', 'in_review', 'done'];\n      if (!validStatuses.includes(newStatus)) {\n        return res.status(400).json({ message: \"Invalid status\" });\n      }\n      \n      const ticket = await storage.getSprintTicket(ticketId);\n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      \n      // Validate git gates based on status transition\n      const gitState = ticket.gitState as { branchCreated?: boolean; hasPR?: boolean; merged?: boolean } || {};\n      \n      if (newStatus === 'in_progress' && ticket.status === 'todo') {\n        // Must have created branch to move to in_progress\n        if (!gitState.branchCreated) {\n          return res.status(400).json({ \n            message: \"Create a branch first before starting work\",\n            gate: \"branch_required\"\n          });\n        }\n      }\n      \n      if (newStatus === 'in_review' && ticket.status === 'in_progress') {\n        // Must have PR to move to in_review\n        if (!gitState.hasPR) {\n          return res.status(400).json({ \n            message: \"Submit a pull request before moving to review\",\n            gate: \"pr_required\"\n          });\n        }\n      }\n      \n      if (newStatus === 'done' && ticket.status === 'in_review') {\n        // Must be merged to move to done\n        if (!gitState.merged) {\n          return res.status(400).json({ \n            message: \"PR must be merged before marking as done\",\n            gate: \"merge_required\"\n          });\n        }\n      }\n      \n      const updatedTicket = await storage.updateSprintTicket(ticketId, { status: newStatus });\n      res.json(updatedTicket);\n    } catch (error) {\n      console.error(\"Failed to move ticket:\", error);\n      res.status(500).json({ message: \"Failed to move ticket\" });\n    }\n  });\n\n  // ============================================\n  // Ceremony Instance APIs\n  // ============================================\n\n  // GET /api/sprints/:sprintId/ceremonies - Get all ceremonies for a sprint\n  app.get(\"/api/sprints/:sprintId/ceremonies\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const ceremonies = await storage.getCeremonyInstances(sprintId);\n      res.json(ceremonies);\n    } catch (error) {\n      console.error(\"Failed to get ceremonies:\", error);\n      res.status(500).json({ message: \"Failed to get ceremonies\" });\n    }\n  });\n\n  // GET /api/ceremonies/:ceremonyId - Get ceremony with messages\n  app.get(\"/api/ceremonies/:ceremonyId\", async (req, res) => {\n    try {\n      const ceremonyId = parseInt(req.params.ceremonyId);\n      const ceremony = await storage.getCeremonyInstance(ceremonyId);\n      \n      if (!ceremony) {\n        return res.status(404).json({ message: \"Ceremony not found\" });\n      }\n      \n      res.json(ceremony);\n    } catch (error) {\n      console.error(\"Failed to get ceremony:\", error);\n      res.status(500).json({ message: \"Failed to get ceremony\" });\n    }\n  });\n\n  // POST /api/sprints/:sprintId/ceremonies - Create ceremony instance\n  app.post(\"/api/sprints/:sprintId/ceremonies\", async (req, res) => {\n    try {\n      const sprintId = parseInt(req.params.sprintId);\n      const ceremonyData = { ...req.body, sprintId };\n      \n      const ceremony = await storage.createCeremonyInstance(ceremonyData);\n      res.status(201).json(ceremony);\n    } catch (error) {\n      console.error(\"Failed to create ceremony:\", error);\n      res.status(500).json({ message: \"Failed to create ceremony\" });\n    }\n  });\n\n  // PATCH /api/ceremonies/:ceremonyId - Update ceremony state\n  app.patch(\"/api/ceremonies/:ceremonyId\", async (req, res) => {\n    try {\n      const ceremonyId = parseInt(req.params.ceremonyId);\n      const updates = req.body;\n      \n      const ceremony = await storage.updateCeremonyInstance(ceremonyId, updates);\n      \n      if (!ceremony) {\n        return res.status(404).json({ message: \"Ceremony not found\" });\n      }\n      \n      res.json(ceremony);\n    } catch (error) {\n      console.error(\"Failed to update ceremony:\", error);\n      res.status(500).json({ message: \"Failed to update ceremony\" });\n    }\n  });\n\n  // POST /api/ceremonies/:ceremonyId/messages - Add message to ceremony\n  app.post(\"/api/ceremonies/:ceremonyId/messages\", async (req, res) => {\n    try {\n      const ceremonyId = parseInt(req.params.ceremonyId);\n      const { message, type = 'team' } = req.body;\n      \n      const ceremony = await storage.getCeremonyInstance(ceremonyId);\n      if (!ceremony) {\n        return res.status(404).json({ message: \"Ceremony not found\" });\n      }\n      \n      const messages = type === 'team' \n        ? [...(ceremony.teamMessages as any[] || []), message]\n        : [...(ceremony.userResponses as any[] || []), message];\n      \n      const updated = await storage.updateCeremonyInstance(ceremonyId, {\n        [type === 'team' ? 'teamMessages' : 'userResponses']: messages\n      });\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Failed to add message:\", error);\n      res.status(500).json({ message: \"Failed to add message\" });\n    }\n  });\n\n  // ============================================\n  // Git Session APIs\n  // ============================================\n\n  // GET /api/tickets/:ticketId/git - Get git session for ticket\n  app.get(\"/api/tickets/:ticketId/git\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      const session = await storage.getGitSession(ticketId);\n      \n      if (!session) {\n        return res.status(404).json({ message: \"Git session not found\" });\n      }\n      \n      const events = await storage.getGitEvents(session.id);\n      res.json({ session, events });\n    } catch (error) {\n      console.error(\"Failed to get git session:\", error);\n      res.status(500).json({ message: \"Failed to get git session\" });\n    }\n  });\n\n  // POST /api/tickets/:ticketId/git - Create git session\n  app.post(\"/api/tickets/:ticketId/git\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      \n      // Check if session already exists\n      const existing = await storage.getGitSession(ticketId);\n      if (existing) {\n        return res.status(400).json({ message: \"Git session already exists for this ticket\" });\n      }\n      \n      const session = await storage.createGitSession({\n        ticketId,\n        ...req.body\n      });\n      \n      res.status(201).json(session);\n    } catch (error) {\n      console.error(\"Failed to create git session:\", error);\n      res.status(500).json({ message: \"Failed to create git session\" });\n    }\n  });\n\n  // POST /api/git/:sessionId/command - Execute git command\n  app.post(\"/api/git/:sessionId/command\", async (req, res) => {\n    try {\n      const sessionId = parseInt(req.params.sessionId);\n      const { command, args } = req.body;\n      \n      const session = await storage.getGitSessionById(sessionId);\n      if (!session) {\n        return res.status(404).json({ message: \"Git session not found\" });\n      }\n      \n      // Record the git event\n      const event = await storage.createGitEvent({\n        sessionId,\n        commandType: command,\n        rawCommand: `git ${command} ${(args || []).join(' ')}`,\n        stateChange: { args },\n        isValid: true\n      });\n      \n      // Update session state based on command\n      let updates: any = {};\n      let ticketUpdates: any = {};\n      \n      switch (command) {\n        case 'clone':\n          updates.isCloned = true;\n          break;\n        case 'checkout':\n        case 'branch':\n          if (args && args.length > 0) {\n            updates.currentBranch = args[args.length - 1];\n            // Update ticket gitState\n            const ticket = await storage.getSprintTicket(session.ticketId);\n            if (ticket) {\n              ticketUpdates.gitState = { \n                ...(ticket.gitState as any || {}), \n                branchCreated: true,\n                branchName: args[args.length - 1]\n              };\n            }\n          }\n          break;\n        case 'add':\n          const currentStaged = session.stagedFiles as string[] || [];\n          updates.stagedFiles = Array.from(new Set([...currentStaged, ...(args || [])]));\n          break;\n        case 'commit':\n          const commits = session.commits as any[] || [];\n          updates.commits = [...commits, { \n            message: args?.find((a: string) => a.startsWith('-m'))?.replace('-m ', '') || args?.[0],\n            timestamp: new Date().toISOString()\n          }];\n          updates.stagedFiles = [];\n          updates.remoteSyncStatus = 'ahead';\n          break;\n        case 'push':\n          updates.remoteSyncStatus = 'synced';\n          break;\n        case 'pull':\n          updates.remoteSyncStatus = 'synced';\n          break;\n      }\n      \n      if (Object.keys(updates).length > 0) {\n        await storage.updateGitSession(sessionId, updates);\n      }\n      \n      if (Object.keys(ticketUpdates).length > 0) {\n        await storage.updateSprintTicket(session.ticketId, ticketUpdates);\n      }\n      \n      res.json({ \n        event, \n        session: await storage.getGitSessionById(sessionId)\n      });\n    } catch (error) {\n      console.error(\"Failed to execute git command:\", error);\n      res.status(500).json({ message: \"Failed to execute git command\" });\n    }\n  });\n\n  // POST /api/tickets/:ticketId/pr - Create pull request\n  app.post(\"/api/tickets/:ticketId/pr\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      const { title, description } = req.body;\n      \n      const ticket = await storage.getSprintTicket(ticketId);\n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      \n      const gitState = ticket.gitState as any || {};\n      if (!gitState.branchCreated) {\n        return res.status(400).json({ message: \"Must create branch before PR\" });\n      }\n      \n      // Update ticket with PR info\n      const updated = await storage.updateSprintTicket(ticketId, {\n        gitState: {\n          ...gitState,\n          hasPR: true,\n          prTitle: title,\n          prDescription: description,\n          prCreatedAt: new Date().toISOString()\n        }\n      });\n      \n      // Record git event\n      const session = await storage.getGitSession(ticketId);\n      if (session) {\n        await storage.createGitEvent({\n          sessionId: session.id,\n          commandType: 'pr_create',\n          rawCommand: `Create PR: ${title}`,\n          stateChange: { title, description },\n          isValid: true\n        });\n      }\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Failed to create PR:\", error);\n      res.status(500).json({ message: \"Failed to create PR\" });\n    }\n  });\n\n  // POST /api/tickets/:ticketId/merge - Merge pull request\n  app.post(\"/api/tickets/:ticketId/merge\", async (req, res) => {\n    try {\n      const ticketId = parseInt(req.params.ticketId);\n      \n      const ticket = await storage.getSprintTicket(ticketId);\n      if (!ticket) {\n        return res.status(404).json({ message: \"Ticket not found\" });\n      }\n      \n      const gitState = ticket.gitState as any || {};\n      if (!gitState.hasPR) {\n        return res.status(400).json({ message: \"No PR exists to merge\" });\n      }\n      \n      // Update ticket with merge info\n      const updated = await storage.updateSprintTicket(ticketId, {\n        gitState: {\n          ...gitState,\n          merged: true,\n          mergedAt: new Date().toISOString()\n        }\n      });\n      \n      // Record git event\n      const session = await storage.getGitSession(ticketId);\n      if (session) {\n        await storage.createGitEvent({\n          sessionId: session.id,\n          commandType: 'merge',\n          rawCommand: `Merge PR: ${gitState.prTitle}`,\n          stateChange: { branchName: gitState.branchName },\n          isValid: true\n        });\n        \n        // Update session branch to main after merge\n        await storage.updateGitSession(session.id, {\n          currentBranch: 'main',\n          remoteSyncStatus: 'synced'\n        });\n      }\n      \n      res.json(updated);\n    } catch (error) {\n      console.error(\"Failed to merge PR:\", error);\n      res.status(500).json({ message: \"Failed to merge PR\" });\n    }\n  });\n\n  // ============================================\n  // Phase 5: Workspace Instance APIs\n  // ============================================\n\n  // GET /api/workspaces - Get all workspaces for current user\n  app.get(\"/api/workspaces\", async (req, res) => {\n    try {\n      const userId = 1;\n      const workspaces = await storage.getUserWorkspaceInstances(userId);\n      res.json(workspaces);\n    } catch (error) {\n      console.error(\"Failed to get workspaces:\", error);\n      res.status(500).json({ message: \"Failed to get workspaces\" });\n    }\n  });\n\n  // GET /api/workspaces/:workspaceId - Get single workspace\n  app.get(\"/api/workspaces/:workspaceId\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      \n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      res.json(workspace);\n    } catch (error) {\n      console.error(\"Failed to get workspace:\", error);\n      res.status(500).json({ message: \"Failed to get workspace\" });\n    }\n  });\n\n  // GET /api/workspaces/:workspaceId/state - Get workspace state with phase info\n  app.get(\"/api/workspaces/:workspaceId/state\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const state = await storage.getWorkspaceState(workspaceId);\n      \n      if (!state) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to get workspace state:\", error);\n      res.status(500).json({ message: \"Failed to get workspace state\" });\n    }\n  });\n\n  // GET /api/journeys/:journeyId/workspace - Get workspace for a journey\n  app.get(\"/api/journeys/:journeyId/workspace\", async (req, res) => {\n    try {\n      const journeyId = parseInt(req.params.journeyId);\n      const workspace = await storage.getWorkspaceInstanceByJourney(journeyId);\n      \n      if (!workspace) {\n        return res.status(404).json({ message: \"No workspace found for this journey\" });\n      }\n      \n      res.json(workspace);\n    } catch (error) {\n      console.error(\"Failed to get journey workspace:\", error);\n      res.status(500).json({ message: \"Failed to get journey workspace\" });\n    }\n  });\n\n  // POST /api/workspaces - Create workspace instance (on offer acceptance)\n  app.post(\"/api/workspaces\", async (req, res) => {\n    try {\n      const { journeyId, jobApplicationId, companyName, role, projectTemplateId } = req.body;\n      \n      if (!journeyId) {\n        return res.status(400).json({ message: \"journeyId is required\" });\n      }\n      \n      const existingWorkspace = await storage.getWorkspaceInstanceByJourney(journeyId);\n      if (existingWorkspace) {\n        return res.status(400).json({ message: \"Workspace already exists for this journey\" });\n      }\n      \n      const journey = await storage.getJourney(journeyId);\n      if (!journey) {\n        return res.status(404).json({ message: \"Journey not found\" });\n      }\n      \n      let workspaceCompanyName = companyName;\n      let workspaceRole = role;\n      \n      if (jobApplicationId) {\n        const application = await storage.getJobApplication(jobApplicationId);\n        if (application) {\n          const posting = await storage.getJobPostingWithCompany(application.jobPostingId);\n          if (posting) {\n            workspaceCompanyName = workspaceCompanyName || posting.company?.name || 'TechCorp';\n            workspaceRole = workspaceRole || posting.role || 'Developer';\n          }\n        }\n      }\n      \n      if (!workspaceCompanyName || !workspaceRole) {\n        return res.status(400).json({ message: \"companyName and role are required if no job application\" });\n      }\n      \n      const workspace = await storage.createWorkspaceInstance({\n        userId: journey.userId,\n        journeyId,\n        jobApplicationId: jobApplicationId || null,\n        projectTemplateId: projectTemplateId || null,\n        companyName: workspaceCompanyName,\n        role: workspaceRole,\n        currentPhase: 'onboarding',\n      });\n      \n      res.status(201).json(workspace);\n    } catch (error) {\n      console.error(\"Failed to create workspace:\", error);\n      res.status(500).json({ message: \"Failed to create workspace\" });\n    }\n  });\n\n  // PATCH /api/workspaces/:workspaceId - Update workspace\n  app.patch(\"/api/workspaces/:workspaceId\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const updates = req.body;\n      \n      const workspace = await storage.updateWorkspaceInstance(workspaceId, updates);\n      \n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      res.json(workspace);\n    } catch (error) {\n      console.error(\"Failed to update workspace:\", error);\n      res.status(500).json({ message: \"Failed to update workspace\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/advance - Advance to next phase\n  app.post(\"/api/workspaces/:workspaceId/advance\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const payload = req.body.payload || {};\n      \n      const workspace = await storage.advanceWorkspacePhase(workspaceId, payload);\n      \n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found or cannot advance\" });\n      }\n      \n      const state = await storage.getWorkspaceState(workspaceId);\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to advance workspace phase:\", error);\n      res.status(500).json({ message: \"Failed to advance workspace phase\" });\n    }\n  });\n\n  // GET /api/workspaces/:workspaceId/events - Get phase events history\n  app.get(\"/api/workspaces/:workspaceId/events\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const events = await storage.getWorkspacePhaseEvents(workspaceId);\n      res.json(events);\n    } catch (error) {\n      console.error(\"Failed to get phase events:\", error);\n      res.status(500).json({ message: \"Failed to get phase events\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/start-sprint - Start a new sprint\n  app.post(\"/api/workspaces/:workspaceId/start-sprint\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { sprintId } = req.body;\n      \n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      if (workspace.currentPhase !== 'planning') {\n        return res.status(400).json({ message: \"Must be in planning phase to start sprint\" });\n      }\n      \n      const updated = await storage.updateWorkspaceInstance(workspaceId, {\n        currentSprintId: sprintId,\n      });\n      \n      const advanced = await storage.advanceWorkspacePhase(workspaceId, { sprintId });\n      \n      res.json(advanced);\n    } catch (error) {\n      console.error(\"Failed to start sprint:\", error);\n      res.status(500).json({ message: \"Failed to start sprint\" });\n    }\n  });\n\n  // ============ Phase 6: Sprint Planning Session Routes ============\n\n  // GET /api/workspaces/:workspaceId/planning - Get planning session state\n  app.get(\"/api/workspaces/:workspaceId/planning\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      \n      // Check if session exists and needs auto-start messages\n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (session && !session.autoStartInitialized) {\n        const adapter = getSprintPlanningAdapter(session.role, session.level);\n        \n        // Check if we need to insert auto-start sequence (using flag for idempotency)\n        if (adapter.engagement?.autoStartConversation) {\n          const sequence = adapter.engagement.autoStartSequence;\n          \n          if (sequence && sequence.length > 0) {\n            // Insert all messages from the sequence until we hit one that requires user response\n            for (const step of sequence) {\n              await storage.createPlanningMessage({\n                sessionId: session.id,\n                sender: step.personaName,\n                senderRole: step.personaRole,\n                message: step.message,\n                phase: step.phase,\n                isUser: false,\n              });\n              \n              // Stop after inserting a message that requires user response\n              if (step.requiresUserResponse) {\n                break;\n              }\n            }\n          } else if (adapter.engagement.autoStartMessage) {\n            // Fallback to single message if no sequence defined\n            await storage.createPlanningMessage({\n              sessionId: session.id,\n              sender: 'Priya',\n              senderRole: 'Product Manager',\n              message: adapter.engagement.autoStartMessage,\n              phase: 'context',\n              isUser: false,\n            });\n          }\n          \n          // Mark auto-start as initialized to prevent duplicates\n          await storage.updatePlanningSession(session.id, { autoStartInitialized: true });\n        }\n      }\n      \n      const state = await storage.getPlanningSessionState(workspaceId);\n      // Prevent browser caching for dynamic planning state\n      res.set('Cache-Control', 'no-store, no-cache, must-revalidate');\n      res.set('Pragma', 'no-cache');\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to get planning session state:\", error);\n      res.status(500).json({ message: \"Failed to get planning session state\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/planning - Create or resume planning session\n  app.post(\"/api/workspaces/:workspaceId/planning\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      \n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      // Check if active session exists\n      let session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      let isNewSession = false;\n      \n      if (!session) {\n        isNewSession = true;\n        \n        // Determine session level (can be enhanced to use workspace level or user preference)\n        const sessionLevel = 'intern'; // Default to intern for now\n        \n        // Get adapter to check auto-start settings for the correct level\n        const adapter = getSprintPlanningAdapter(workspace.role, sessionLevel);\n        const willAutoStart = adapter.engagement?.autoStartConversation ?? false;\n        \n        // Create new session with workspace role/level\n        // Set autoStartInitialized: true upfront if we will auto-start (prevents race condition)\n        session = await storage.createPlanningSession({\n          workspaceId,\n          role: workspace.role,\n          level: sessionLevel,\n          currentPhase: 'context',\n          phaseCompletions: { context: false, discussion: false, commitment: false },\n          selectedItems: [],\n          capacityUsed: 0,\n          status: 'active',\n          knowledgeCheckPassed: false,\n          autoStartInitialized: willAutoStart, // Set true immediately to prevent concurrent duplicates\n        });\n        \n        // Now insert auto-start messages (flag already set, so GET won't duplicate)\n        if (willAutoStart) {\n          // Get user info for personalization\n          const user = await storage.getUser(workspace.userId);\n          const userName = user?.username || 'team member';\n          const userRole = workspace.role === 'developer' ? 'Developer' \n            : workspace.role === 'qa' ? 'QA Engineer'\n            : workspace.role === 'devops' ? 'DevOps Engineer'\n            : workspace.role === 'data_science' ? 'Data Scientist'\n            : workspace.role === 'pm' ? 'Product Manager'\n            : 'team member';\n          \n          // Helper to substitute personalization placeholders\n          const personalize = (text: string): string => {\n            return text\n              .replace(/\\{\\{userName\\}\\}/g, userName)\n              .replace(/\\{\\{userRole\\}\\}/g, userRole);\n          };\n          \n          const sequence = adapter.engagement?.autoStartSequence;\n          \n          if (sequence && sequence.length > 0) {\n            // Insert all messages from the sequence until we hit one that requires user response\n            for (const step of sequence) {\n              await storage.createPlanningMessage({\n                sessionId: session.id,\n                sender: step.personaName,\n                senderRole: step.personaRole,\n                message: personalize(step.message),\n                phase: step.phase,\n                isUser: false,\n              });\n              \n              // Stop after inserting a message that requires user response\n              if (step.requiresUserResponse) {\n                break;\n              }\n            }\n          } else if (adapter.engagement?.autoStartMessage) {\n            // Fallback to single message if no sequence defined\n            await storage.createPlanningMessage({\n              sessionId: session.id,\n              sender: 'Priya',\n              senderRole: 'Product Manager',\n              message: personalize(adapter.engagement.autoStartMessage),\n              phase: 'context',\n              isUser: false,\n            });\n          }\n        }\n      }\n      \n      const state = await storage.getPlanningSessionState(workspaceId);\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to create/resume planning session:\", error);\n      res.status(500).json({ message: \"Failed to create/resume planning session\" });\n    }\n  });\n\n  // PUT /api/workspaces/:workspaceId/planning - Update planning session\n  app.put(\"/api/workspaces/:workspaceId/planning\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const updates = req.body;\n      \n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (!session) {\n        return res.status(404).json({ message: \"No active planning session found\" });\n      }\n      \n      const updated = await storage.updatePlanningSession(session.id, updates);\n      const state = await storage.getPlanningSessionState(workspaceId);\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to update planning session:\", error);\n      res.status(500).json({ message: \"Failed to update planning session\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/planning/message - Send message in planning session\n  app.post(\"/api/workspaces/:workspaceId/planning/message\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { message } = req.body;\n      \n      if (!message) {\n        return res.status(400).json({ message: \"Message is required\" });\n      }\n      \n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (!session) {\n        return res.status(404).json({ message: \"No active planning session found\" });\n      }\n      \n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n      \n      // Save user message\n      const userMessage = await storage.createPlanningMessage({\n        sessionId: session.id,\n        sender: 'You',\n        senderRole: 'user',\n        message,\n        phase: session.currentPhase,\n        isUser: true,\n      });\n      \n      // Get planning adapter for AI response\n      const adapter = getSprintPlanningAdapter(session.role, session.level);\n      \n      // Get appropriate phase prompt\n      let phasePrompt = adapter.prompts.contextPhasePrompt;\n      if (session.currentPhase === 'discussion') {\n        phasePrompt = adapter.prompts.discussionPhasePrompt;\n      } else if (session.currentPhase === 'commitment') {\n        phasePrompt = adapter.prompts.commitmentPhasePrompt;\n      }\n      \n      // Get existing messages for context\n      const existingMessages = await storage.getPlanningMessages(session.id);\n      const conversationHistory = existingMessages.map(m => ({\n        role: m.isUser ? 'user' : 'assistant',\n        content: `${m.sender} (${m.senderRole}): ${m.message}`\n      }));\n      \n      // Determine if this is a phase transition moment (user responded in context phase after auto-start)\n      const userMessagesInContext = existingMessages.filter(m => m.isUser && m.phase === 'context');\n      const isContextTransitionMoment = session.currentPhase === 'context' && userMessagesInContext.length >= 0;\n      \n      // Pick a persona to respond - Priya should respond for transition moments\n      const personas = adapter.prompts.personas;\n      let respondingPersona = personas[Math.floor(Math.random() * personas.length)];\n      \n      // For context phase transition, Priya (PM) should provide the bridging response\n      if (isContextTransitionMoment) {\n        respondingPersona = personas.find(p => p.name === 'Priya') || personas[0];\n      }\n      \n      // Generate AI response using Groq\n      const Groq = require('groq-sdk');\n      const groq = new Groq({ apiKey: process.env.GROQ_API_KEY });\n      \n      // Add bridging instruction for context phase transition\n      let transitionInstruction = '';\n      if (isContextTransitionMoment) {\n        transitionInstruction = `\nIMPORTANT: This is a natural transition point. After addressing the user's message:\n1. Acknowledge their input warmly\n2. Briefly summarize that we've covered the priorities\n3. Naturally bridge to the next step by saying something like \"Alright, let's start looking at specific items\" or \"Great, now let's dive into the backlog and discuss what we can commit to\"\nDo NOT say \"click continue\" or reference any UI buttons. Just naturally transition the conversation.`;\n      }\n      \n      // Build persona instruction with clear guardrails\n      const personaInstruction = `You are responding as ${respondingPersona.name} (${respondingPersona.role}). ${respondingPersona.personality}. Company: ${workspace.companyName}.\n\nCRITICAL RULES:\n- You ARE ${respondingPersona.name}. Speak only as yourself.\n- NEVER refer to yourself in third person (don't say \"${respondingPersona.name}, what do you think?\")\n- NEVER ask questions to yourself\n- Keep responses conversational, 2-4 sentences max\n- No stage directions like \"(nods)\" or \"(thinking)\"\n- No role prefixes in your response (the UI shows your name separately)`;\n\n      const chatCompletion = await groq.chat.completions.create({\n        messages: [\n          { role: 'system', content: adapter.prompts.systemPrompt },\n          { role: 'system', content: `Current phase: ${session.currentPhase}. ${phasePrompt}${transitionInstruction}` },\n          { role: 'system', content: personaInstruction },\n          ...conversationHistory,\n          { role: 'user', content: message }\n        ],\n        model: 'llama-3.3-70b-versatile',\n        temperature: 0.7,\n        max_tokens: 300,\n      });\n      \n      let aiResponseText = chatCompletion.choices[0]?.message?.content || \"I'm thinking about that...\";\n      \n      // Strip any persona prefix the AI might have included (e.g., \"Priya (Product Manager): ...\")\n      const personaPrefixPattern = /^[A-Za-z]+\\s*\\([^)]+\\):\\s*/;\n      const nameOnlyPrefixPattern = /^[A-Za-z]+:\\s*/;\n      aiResponseText = aiResponseText.replace(personaPrefixPattern, '').replace(nameOnlyPrefixPattern, '').trim();\n      \n      // Save AI response\n      const aiMessage = await storage.createPlanningMessage({\n        sessionId: session.id,\n        sender: respondingPersona.name,\n        senderRole: respondingPersona.role,\n        message: aiResponseText,\n        phase: session.currentPhase,\n        isUser: false,\n      });\n      \n      const state = await storage.getPlanningSessionState(workspaceId);\n      res.json({ \n        userMessage, \n        aiMessage,\n        state,\n        isPhaseTransitionCue: isContextTransitionMoment\n      });\n    } catch (error) {\n      console.error(\"Failed to send planning message:\", error);\n      res.status(500).json({ message: \"Failed to send planning message\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/planning/advance - Advance to next planning phase\n  app.post(\"/api/workspaces/:workspaceId/planning/advance\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      \n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (!session) {\n        return res.status(404).json({ message: \"No active planning session found\" });\n      }\n      \n      const phaseOrder = ['context', 'discussion', 'commitment'];\n      const currentIndex = phaseOrder.indexOf(session.currentPhase);\n      \n      if (currentIndex === phaseOrder.length - 1) {\n        // Complete the planning session\n        await storage.updatePlanningSession(session.id, {\n          status: 'completed',\n          completedAt: new Date(),\n          phaseCompletions: { context: true, discussion: true, commitment: true },\n        });\n        \n        // Advance workspace to execution phase\n        await storage.advanceWorkspacePhase(workspaceId, {\n          goalStatement: session.goalStatement,\n          selectedItems: session.selectedItems,\n        });\n        \n        const state = await storage.getPlanningSessionState(workspaceId);\n        res.json({ completed: true, state });\n      } else {\n        // Move to next phase\n        const nextPhase = phaseOrder[currentIndex + 1];\n        const phaseCompletions = session.phaseCompletions as Record<string, boolean>;\n        phaseCompletions[session.currentPhase] = true;\n        \n        await storage.updatePlanningSession(session.id, {\n          currentPhase: nextPhase,\n          phaseCompletions,\n        });\n        \n        // Add phase transition messages from adapter\n        const adapter = getSprintPlanningAdapter(session.role, session.level);\n        const workspace = await storage.getWorkspaceInstance(workspaceId);\n        const user = await storage.getUser(workspace?.userId || 0);\n        \n        // Helper to personalize messages\n        const personalize = (text: string) => {\n          const userName = user?.username || 'team member';\n          const userRole = workspace?.role || 'Developer';\n          return text\n            .replace(/\\{\\{userName\\}\\}/g, userName)\n            .replace(/\\{\\{userRole\\}\\}/g, userRole);\n        };\n        \n        // Handle selection guidance for discussion phase (auto-assign items for interns)\n        const selectionGuidance = adapter.engagement?.selectionGuidance;\n        if (nextPhase === 'discussion' && selectionGuidance?.mode === 'autoAssign' && selectionGuidance.suggestedItemIds) {\n          // Use the same backlog items as defined in getPlanningSessionState\n          const backlogItems = [\n            { id: 'TICK-001', points: 3 },\n            { id: 'TICK-002', points: 5 },\n            { id: 'TICK-003', points: 2 },\n            { id: 'TICK-004', points: 2 },\n            { id: 'TICK-005', points: 3 },\n          ];\n          \n          const validSuggestedIds = selectionGuidance.suggestedItemIds.filter(\n            suggestedId => backlogItems.some(item => item.id === suggestedId)\n          );\n          \n          if (validSuggestedIds.length > 0) {\n            // Calculate actual capacity used from selected item points\n            const capacityUsed = backlogItems\n              .filter(item => validSuggestedIds.includes(item.id))\n              .reduce((sum, item) => sum + (item.points || 0), 0);\n            \n            await storage.updatePlanningSession(session.id, {\n              selectedItems: validSuggestedIds,\n              capacityUsed,\n            });\n          }\n        }\n        \n        // Get the transition sequence for this phase from the adapter\n        const transitionSequence = adapter.engagement?.phaseTransitionSequences?.find(\n          seq => seq.phase === nextPhase\n        );\n        \n        if (transitionSequence && transitionSequence.steps.length > 0) {\n          // Insert all messages from the sequence\n          for (const step of transitionSequence.steps) {\n            await storage.createPlanningMessage({\n              sessionId: session.id,\n              sender: step.personaName,\n              senderRole: step.personaRole,\n              message: personalize(step.message),\n              phase: nextPhase,\n              isUser: false,\n            });\n            \n            // Stop after a message that requires user response\n            if (step.requiresUserResponse) {\n              break;\n            }\n          }\n          \n          // Add selection confirmation message for autoAssign mode in discussion phase\n          if (nextPhase === 'discussion' && selectionGuidance?.mode === 'autoAssign' && selectionGuidance.confirmationPrompt) {\n            await storage.createPlanningMessage({\n              sessionId: session.id,\n              sender: 'Priya',\n              senderRole: 'Product Manager',\n              message: personalize(selectionGuidance.confirmationPrompt),\n              phase: nextPhase,\n              isUser: false,\n            });\n          }\n        } else {\n          // Fallback: simple transition message from Priya\n          let fallbackMessage = '';\n          if (nextPhase === 'discussion') {\n            fallbackMessage = `Alright team, let's dive into the backlog! Take a look at the items and let's discuss what we should tackle this sprint.`;\n          } else if (nextPhase === 'commitment') {\n            fallbackMessage = `Great discussion! Now let's finalize our sprint commitment. What should be our sprint goal?`;\n          }\n          \n          if (fallbackMessage) {\n            await storage.createPlanningMessage({\n              sessionId: session.id,\n              sender: 'Priya',\n              senderRole: 'Product Manager',\n              message: fallbackMessage,\n              phase: nextPhase,\n              isUser: false,\n            });\n          }\n        }\n        \n        const state = await storage.getPlanningSessionState(workspaceId);\n        res.json({ completed: false, state });\n      }\n    } catch (error) {\n      console.error(\"Failed to advance planning phase:\", error);\n      res.status(500).json({ message: \"Failed to advance planning phase\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/planning/select-items - Select backlog items\n  app.post(\"/api/workspaces/:workspaceId/planning/select-items\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { selectedItems, capacityUsed } = req.body;\n      \n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (!session) {\n        return res.status(404).json({ message: \"No active planning session found\" });\n      }\n      \n      await storage.updatePlanningSession(session.id, {\n        selectedItems,\n        capacityUsed: capacityUsed || 0,\n      });\n      \n      const state = await storage.getPlanningSessionState(workspaceId);\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to select planning items:\", error);\n      res.status(500).json({ message: \"Failed to select planning items\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/planning/goal - Set sprint goal\n  app.post(\"/api/workspaces/:workspaceId/planning/goal\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { goalStatement } = req.body;\n      \n      if (!goalStatement) {\n        return res.status(400).json({ message: \"Goal statement is required\" });\n      }\n      \n      const session = await storage.getPlanningSessionByWorkspace(workspaceId);\n      if (!session) {\n        return res.status(404).json({ message: \"No active planning session found\" });\n      }\n      \n      await storage.updatePlanningSession(session.id, { goalStatement });\n      \n      const state = await storage.getPlanningSessionState(workspaceId);\n      res.json(state);\n    } catch (error) {\n      console.error(\"Failed to set sprint goal:\", error);\n      res.status(500).json({ message: \"Failed to set sprint goal\" });\n    }\n  });\n\n  // ============ End Phase 6: Sprint Planning Session Routes ============\n\n  // POST /api/workspaces/:workspaceId/onboarding-chat - Chat with team members during onboarding\n  app.post(\"/api/workspaces/:workspaceId/onboarding-chat\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { teamMemberName, userMessage, conversationHistory } = req.body;\n      \n      if (!teamMemberName || !userMessage) {\n        return res.status(400).json({ message: \"teamMemberName and userMessage are required\" });\n      }\n\n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n\n      // Team member personas for onboarding chat (personal/getting-to-know-you context)\n      const teamPersonas: Record<string, { role: string; personality: string; background: string }> = {\n        'Marcus': {\n          role: 'Senior Developer',\n          personality: 'Detail-oriented, patient, and helpful',\n          background: `Been with ${workspace.companyName} for about 2 years. Previously worked at a large enterprise company doing backend work. Enjoys distributed systems and database optimization. Outside work, tinkers with side projects, plays chess online, and cooks - makes a mean biryani.`\n        },\n        'Priya': {\n          role: 'Product Manager',\n          personality: 'Energetic, clear communicator, approachable',\n          background: `PM at ${workspace.companyName} for about 18 months. Previously a product manager at an e-commerce company. Bridges business needs and technical implementation. Huge boardgame enthusiast - hosts monthly game nights.`\n        },\n        'Alex': {\n          role: 'QA Engineer',\n          personality: 'Thorough, helpful, and friendly',\n          background: `QA engineer for about 18 months. Was a developer before but found they enjoyed testing more. Philosophy is that quality is everyone's responsibility. Into rock climbing and escape rooms in free time.`\n        }\n      };\n\n      const persona = teamPersonas[teamMemberName];\n      if (!persona) {\n        return res.status(400).json({ message: \"Unknown team member\" });\n      }\n\n      // Use Groq to generate response\n      const Groq = require('groq-sdk');\n      const groq = new Groq({ apiKey: process.env.GROQ_API_KEY });\n\n      // Build full conversation text for analysis (conversationHistory already includes current message)\n      const fullConversation = conversationHistory && Array.isArray(conversationHistory) && conversationHistory.length > 0\n        ? conversationHistory.map((m: any) => `${m.sender}: ${m.message}`).join('\\n')\n        : `You: ${userMessage}`;\n\n      // Step 1: Analyze what topics have been covered using LLM\n      let topicsCovered = {\n        userProfessional: false,  // User shared their work/career background\n        userPersonal: false,      // User shared hobbies/interests\n        teammateProfessional: false, // Teammate shared work info\n        teammatePersonal: false   // Teammate shared hobbies/interests\n      };\n\n      try {\n        const analysisResponse = await groq.chat.completions.create({\n          model: \"llama-3.3-70b-versatile\",\n          messages: [\n            {\n              role: \"system\",\n              content: `Analyze this conversation between a new intern (\"You\") and ${teamMemberName} (a ${persona.role}).\n\nDetermine which topics have been ACTUALLY SHARED (not just asked about, but answered/revealed):\n\nPROFESSIONAL EXAMPLES (mark true if ANY of these are shared):\n- Education: \"I'm in a bootcamp\", \"I studied CS\", \"I'm a student at...\"\n- Work history: \"I used to be a data scientist\", \"I worked at...\", \"I have X years experience\"\n- Career goals: \"I want to become a developer\", \"I'm interested in backend\"\n- Current role: \"I'm a senior dev\", \"I've been here 2 years\", \"I work on the payments team\"\n\nPERSONAL EXAMPLES (mark true if ANY of these are shared):\n- Sports: \"I play tennis\", \"I run\", \"I go to the gym\"\n- Games: \"I play chess\", \"I'm into video games\", \"I play online\"\n- Creative: \"I cook\", \"I make music\", \"I paint\"\n- Entertainment: \"I watch movies\", \"I read\", \"I hike\"\n- Family: \"I used to play chess with my dad\", \"I have a dog\"\n\nReturn JSON with these fields:\n- userProfessional: true if intern shared education, work history, career info, or skills\n- userPersonal: true if intern shared hobbies, sports, games, or personal interests\n- teammateProfessional: true if ${teamMemberName} shared their role, experience, or work background\n- teammatePersonal: true if ${teamMemberName} shared hobbies, interests, or personal activities\n\nIMPORTANT: \n- Greetings like \"Hi\", \"How are you\", \"Nice to meet you\" do NOT count as sharing\n- Questions don't count - only answers/statements about oneself\n- Be accurate, not conservative - if they clearly shared something, mark it true\n\nRespond ONLY with valid JSON, no other text.`\n            },\n            { role: \"user\", content: fullConversation }\n          ],\n          temperature: 0.1,\n          max_tokens: 100\n        });\n\n        const analysisText = analysisResponse.choices[0]?.message?.content || '{}';\n        try {\n          const parsed = JSON.parse(analysisText.replace(/```json\\n?|\\n?```/g, '').trim());\n          topicsCovered = {\n            userProfessional: !!parsed.userProfessional,\n            userPersonal: !!parsed.userPersonal,\n            teammateProfessional: !!parsed.teammateProfessional,\n            teammatePersonal: !!parsed.teammatePersonal\n          };\n        } catch (e) {\n          console.log('Could not parse topic analysis, using defaults');\n        }\n      } catch (e) {\n        console.log('Topic analysis failed, continuing with defaults');\n      }\n\n      // Determine conversation state\n      const userComplete = topicsCovered.userProfessional && topicsCovered.userPersonal;\n      const teammateComplete = topicsCovered.teammateProfessional && topicsCovered.teammatePersonal;\n      const allTopicsCovered = userComplete && teammateComplete;\n      \n      // Check if we've offered to answer questions (look for question offer in history)\n      const hasOfferedQuestions = conversationHistory && Array.isArray(conversationHistory) &&\n        conversationHistory.some((m: any) => \n          m.sender !== 'You' && \n          (m.message.toLowerCase().includes('question') && \n           (m.message.toLowerCase().includes('company') || m.message.toLowerCase().includes('role') || m.message.toLowerCase().includes('team')))\n        );\n      \n      const isReadyToClose = allTopicsCovered && hasOfferedQuestions;\n      \n      // Determine what's missing to guide the conversation\n      const missingTopics: string[] = [];\n      if (!topicsCovered.userProfessional) missingTopics.push(\"the intern's professional background\");\n      if (!topicsCovered.userPersonal) missingTopics.push(\"the intern's hobbies or interests\");\n      if (!topicsCovered.teammateProfessional) missingTopics.push(\"your work experience\");\n      if (!topicsCovered.teammatePersonal) missingTopics.push(\"your personal interests\");\n      \n      // Determine conversation turn for scripted flow\n      const turnCount = conversationHistory ? conversationHistory.length : 0;\n      const isFirstResponse = turnCount <= 1; // First user message\n      \n      // Get the last user message for context-aware acknowledgment\n      const lastUserMessage = userMessage.toLowerCase();\n      \n      const systemPrompt = `You are ${teamMemberName}, a ${persona.role} at ${workspace.companyName}. \nPersonality: ${persona.personality}\nYour background: ${persona.background}\n\nThis is a quick getting-to-know-you chat with a new intern on their first day.\n\nCRITICAL RESPONSE RULES:\n- Keep responses SHORT: 1-2 sentences MAX\n- Be warm but concise - you're busy but friendly\n- DO NOT write paragraphs or long explanations\n- DO NOT discuss work tasks beyond brief intro\n- ALWAYS acknowledge what they just said before transitioning to a new topic\n- Vary your language - don't use the same phrases repeatedly\n\nACKNOWLEDGMENT EXAMPLES (use these patterns, vary the wording):\n- \"That's cool!\" / \"Nice!\" / \"Oh interesting!\" / \"That's awesome!\"\n- \"Bootcamp, nice - those can be intense!\" / \"Data science background, that's solid!\"\n- \"Chess with your dad, love that!\" / \"Tennis, nice - great way to stay active!\"\n\n${isReadyToClose ? \n`CONVERSATION IS COMPLETE - You've covered backgrounds, hobbies, and offered to answer questions!\nEND THE CONVERSATION NOW - Reference something specific from the chat, then say you need to run:\n- If they mentioned a hobby: \"Good luck with the [hobby] and the new role! I've got to run to standup, but ping me anytime.\"\n- If they had questions: \"Hope that helps! Anyway, I've got a meeting - but seriously, reach out anytime.\"\n- General: \"Really enjoyed chatting! Got to jump into a call, but my door's always open. Welcome to the team!\"\nMake the goodbye feel personal, not generic. Do NOT ask any more questions.` \n:\nisFirstResponse ?\n`THIS IS YOUR FIRST REPLY - Introduce yourself properly:\n1. Greet them warmly (vary your greeting - \"Hey!\", \"Hi there!\", \"Welcome!\")\n2. Share YOUR role briefly (e.g., \"I'm a ${persona.role} here, been with the company about X years\")\n3. Ask about THEIR background/studies/what brought them here (professional question first!)\nExample: \"Hey, welcome aboard! I'm one of the senior devs here - been around about 2 years now. What's your background - are you studying CS or coming from somewhere else?\"`\n:\nallTopicsCovered && !hasOfferedQuestions ?\n`You've learned about each other! Now offer to answer questions:\nFirst, briefly acknowledge their last message, then ask if they have questions.\nExample: \"That's great! By the way, do you have any questions about the team or how things work around here?\"\nKeep it brief - acknowledge + question offer.`\n:\n`GUIDE THE CONVERSATION - Topics still needed: ${missingTopics.join(', ')}\n\nIMPORTANT: Always start by acknowledging what they just shared before moving on!\n\nCONVERSATION FLOW (follow this order):\n1. First, share YOUR professional background if you haven't\n2. Then, learn about THEIR professional background\n3. Share YOUR hobbies/interests AND ask about theirs in the same message\n4. Finally, offer to answer questions about the company/role\n\n${!topicsCovered.teammateProfessional ? \n  \"You haven't shared your work background yet - briefly mention your role/experience.\" :\n  !topicsCovered.userProfessional ? \n    \"Acknowledge their greeting, then ask about their background, studies, or what got them into this field.\" :\n  !topicsCovered.teammatePersonal ?\n    \"Acknowledge what they shared about their background (be specific!), then share your hobby AND ask about theirs.\" :\n  !topicsCovered.userPersonal ? \n    \"Acknowledge their response, then ASK what they do for fun outside of work/studies!\" :\n    \"Acknowledge their response naturally.\"}\n\nDO NOT say goodbye until you've offered to answer questions about the company/role!`}`;\n\n      const messages: any[] = [\n        { role: \"system\", content: systemPrompt }\n      ];\n\n      // Add conversation history\n      if (conversationHistory && Array.isArray(conversationHistory)) {\n        for (const msg of conversationHistory) {\n          messages.push({\n            role: msg.sender === 'You' ? 'user' : 'assistant',\n            content: msg.message\n          });\n        }\n      }\n\n      // Add current message\n      messages.push({ role: 'user', content: userMessage });\n\n      try {\n        const response = await groq.chat.completions.create({\n          model: \"llama-3.3-70b-versatile\",\n          messages,\n          temperature: 0.8,\n          max_tokens: 150\n        });\n\n        const aiResponse = response.choices[0]?.message?.content || \"Thanks for reaching out! Let me know if you have any questions.\";\n        \n        // Determine completion state for frontend\n        const completionState = isReadyToClose ? 'closed' : \n          (userComplete || teammateComplete) ? 'almostReady' : 'collecting';\n        \n        res.json({ \n          response: aiResponse, \n          sender: teamMemberName,\n          isClosing: isReadyToClose,\n          completionState,\n          topicsCovered,\n          missingTopics\n        });\n      } catch (groqError) {\n        console.error('Groq API error:', groqError);\n        // Fallback responses\n        const fallbacks = [\n          `Hey! Great to meet you. I've been here for a while now and really enjoy the team culture. What brings you to ${workspace.companyName}?`,\n          `Welcome aboard! It's always exciting to have new people join. How are you finding your first day so far?`,\n          `Nice to connect! Feel free to ask me anything - about the team, the company, or just life in general here.`\n        ];\n        res.json({ \n          response: fallbacks[Math.floor(Math.random() * fallbacks.length)], \n          sender: teamMemberName,\n          completionState: 'collecting'\n        });\n      }\n    } catch (error) {\n      console.error(\"Failed to process onboarding chat:\", error);\n      res.status(500).json({ message: \"Failed to process chat message\" });\n    }\n  });\n\n  // POST /api/workspaces/:workspaceId/comprehension-chat - Chat with Sarah for documentation comprehension check\n  app.post(\"/api/workspaces/:workspaceId/comprehension-chat\", async (req, res) => {\n    try {\n      const workspaceId = parseInt(req.params.workspaceId);\n      const { userMessage, conversationHistory } = req.body;\n      \n      if (!userMessage) {\n        return res.status(400).json({ message: \"userMessage is required\" });\n      }\n\n      const workspace = await storage.getWorkspaceInstance(workspaceId);\n      if (!workspace) {\n        return res.status(404).json({ message: \"Workspace not found\" });\n      }\n\n      // Count user messages for conversation state tracking\n      const userMessageCount = conversationHistory \n        ? conversationHistory.filter((m: any) => m.sender === 'You').length \n        : 0;\n      const isFirstResponse = userMessageCount <= 1;\n\n      // Initialize topic tracking\n      let topicsCovered = {\n        userShowedUnderstanding: false,\n        userAskedQuestions: false,\n        sarahAnsweredQuestions: false,\n        sarahOfferedNextSteps: false\n      };\n\n      // Check if Groq API key is available and initialize\n      let groq: any = null;\n      if (process.env.GROQ_API_KEY) {\n        try {\n          const Groq = require('groq-sdk');\n          groq = new Groq({ apiKey: process.env.GROQ_API_KEY });\n        } catch (e) {\n          console.log('Failed to initialize Groq SDK, using fallback');\n        }\n      }\n\n      // Try to analyze conversation with Groq if available\n      if (groq) {\n        try {\n          const fullConversation = conversationHistory && Array.isArray(conversationHistory) && conversationHistory.length > 0\n            ? conversationHistory.map((m: any) => `${m.sender}: ${m.message}`).join('\\n')\n            : `You: ${userMessage}`;\n\n          const analysisResponse = await groq.chat.completions.create({\n            model: \"llama-3.3-70b-versatile\",\n            messages: [\n              {\n                role: \"system\",\n                content: `Analyze this conversation between a new intern (\"You\") and Sarah (Tech Lead) during a documentation comprehension check.\n\nDetermine which topics have been covered:\n\nUSER UNDERSTANDING EXAMPLES (mark userShowedUnderstanding true if ANY of these):\n- Explains what the product does: \"The dashboard helps merchants manage payments\"\n- Describes a feature: \"It handles timezone conversions for merchants\"\n- Shows they read the docs: \"I saw in the docs that it uses React\"\n- Summarizes concepts: \"So basically it's an analytics platform\"\n\nUSER QUESTIONS EXAMPLES (mark userAskedQuestions true if ANY of these):\n- Asks about codebase: \"How is the frontend structured?\", \"What database do you use?\"\n- Asks about team: \"How does the team work together?\", \"Who handles what?\"\n- Asks about processes: \"How do code reviews work?\", \"What's the deploy process?\"\n\nSARAH NEXT STEPS EXAMPLES (mark sarahOfferedNextSteps true if):\n- Sarah mentions moving on: \"ready to move on\", \"get you set up\", \"start working\"\n- Sarah talks about next steps: \"tomorrow we'll\", \"your first ticket\", \"dev environment\"\n\nReturn JSON: {\"userShowedUnderstanding\": boolean, \"userAskedQuestions\": boolean, \"sarahAnsweredQuestions\": boolean, \"sarahOfferedNextSteps\": boolean}\nRespond ONLY with valid JSON.`\n              },\n              { role: \"user\", content: fullConversation }\n            ],\n            temperature: 0.1,\n            max_tokens: 100\n          });\n\n          const analysisText = analysisResponse.choices[0]?.message?.content || '{}';\n          try {\n            const parsed = JSON.parse(analysisText.replace(/```json\\n?|\\n?```/g, '').trim());\n            topicsCovered = {\n              userShowedUnderstanding: !!parsed.userShowedUnderstanding,\n              userAskedQuestions: !!parsed.userAskedQuestions,\n              sarahAnsweredQuestions: !!parsed.sarahAnsweredQuestions,\n              sarahOfferedNextSteps: !!parsed.sarahOfferedNextSteps\n            };\n          } catch (e) {\n            console.log('Could not parse comprehension analysis');\n          }\n        } catch (e) {\n          console.log('Comprehension analysis failed');\n        }\n      }\n\n      // Determine conversation state\n      const userComplete = topicsCovered.userShowedUnderstanding;\n      const shouldOfferNextSteps = userComplete && userMessageCount >= 2 && !topicsCovered.sarahOfferedNextSteps;\n\n      // Generate response\n      let responseText: string;\n      let shouldClose = false;\n\n      if (groq) {\n        // Build system prompt based on conversation state\n        const systemPrompt = `You are Sarah, the Tech Lead at ${workspace.companyName}. \nPersonality: Supportive, encouraging, technically knowledgeable.\nContext: Checking in with a new intern about what they learned from the documentation.\n\nRULES:\n- Keep responses SHORT: 2-3 sentences MAX\n- Be warm and encouraging - this is a casual chat, not a test\n- ALWAYS acknowledge what they said before asking follow-up\n\n${shouldOfferNextSteps || topicsCovered.sarahOfferedNextSteps ? \n`WRAP UP: Acknowledge their understanding, mention you'll get them set up with their dev environment tomorrow, and tell them their first ticket awaits. Offer to answer any questions anytime.` \n:\nisFirstResponse ?\n`FIRST REPLY: Warmly acknowledge what they shared (be specific!), show appreciation, ask if they have questions about the codebase or team.`\n:\n`CONTINUE: ${!userComplete ? \"Encourage them to share more about what they understood\" : \"Acknowledge what they shared and ask if they have questions about the codebase or team.\"}`}`;\n\n        const messages: any[] = [{ role: \"system\", content: systemPrompt }];\n        if (conversationHistory && Array.isArray(conversationHistory)) {\n          for (const msg of conversationHistory) {\n            messages.push({\n              role: msg.sender === 'You' ? 'user' : 'assistant',\n              content: msg.message\n            });\n          }\n        }\n        messages.push({ role: 'user', content: userMessage });\n\n        try {\n          const response = await groq.chat.completions.create({\n            model: \"llama-3.3-70b-versatile\",\n            messages,\n            temperature: 0.8,\n            max_tokens: 200\n          });\n          responseText = response.choices[0]?.message?.content || \"That's great! Any questions about the codebase?\";\n        } catch (e) {\n          // Use fallback if Groq call fails\n          responseText = getFallbackSarahResponse(userMessageCount, shouldOfferNextSteps);\n        }\n      } else {\n        // Use fallback if no Groq available\n        responseText = getFallbackSarahResponse(userMessageCount, shouldOfferNextSteps);\n      }\n\n      // Check if response contains next-step indicators\n      const responseHasNextSteps = responseText.toLowerCase().includes('dev environment') ||\n        responseText.toLowerCase().includes('first ticket') ||\n        responseText.toLowerCase().includes('tomorrow') ||\n        responseText.toLowerCase().includes('set up') ||\n        responseText.toLowerCase().includes('ready to move on');\n\n      // Update topics based on response content\n      const updatedTopics = {\n        ...topicsCovered,\n        userShowedUnderstanding: topicsCovered.userShowedUnderstanding || userMessageCount >= 1,\n        sarahOfferedNextSteps: topicsCovered.sarahOfferedNextSteps || responseHasNextSteps\n      };\n\n      // Determine if conversation should close\n      const sufficientExchanges = userMessageCount >= 3;\n      shouldClose = (updatedTopics.userShowedUnderstanding && updatedTopics.sarahOfferedNextSteps) || \n                   (sufficientExchanges && updatedTopics.sarahOfferedNextSteps);\n\n      const completionState = shouldClose ? 'closed' : \n        updatedTopics.userShowedUnderstanding ? 'almostReady' : 'discussing';\n\n      res.json({ \n        response: responseText, \n        sender: 'Sarah',\n        isClosing: shouldClose,\n        completionState,\n        topicsCovered: updatedTopics\n      });\n\n    } catch (error) {\n      console.error(\"Failed to process comprehension chat:\", error);\n      res.status(500).json({ message: \"Failed to process chat message\" });\n    }\n  });\n\n  // Helper function for fallback Sarah responses\n  function getFallbackSarahResponse(messageCount: number, offerNextSteps: boolean): string {\n    if (offerNextSteps || messageCount >= 3) {\n      const closingFallbacks = [\n        \"That's great! You've got a solid understanding. Tomorrow we'll get your dev environment set up and you'll start on your first ticket. Feel free to reach out anytime!\",\n        \"I can see you've absorbed the key concepts! We'll get you set up with your development environment next. Exciting times!\",\n        \"Perfect! You're ready to move on. Tomorrow we'll set up your dev environment and get you started. Don't hesitate to ping me!\"\n      ];\n      return closingFallbacks[Math.floor(Math.random() * closingFallbacks.length)];\n    } else {\n      const discussingFallbacks = [\n        \"That's great! You've clearly been paying attention to the docs. Any questions about how we work or the codebase?\",\n        \"Good understanding! What questions do you have about the team or how we work?\",\n        \"Nice! I can tell you've absorbed the material well. Feel free to ask anything about the codebase.\"\n      ];\n      return discussingFallbacks[Math.floor(Math.random() * discussingFallbacks.length)];\n    }\n  }\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":152511,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/simulation/interview-session.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\nimport { Send, Mic, MicOff, HelpCircle, Lightbulb, Bus, User, X, Check } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  role: 'interviewer' | 'candidate';\n  content: string;\n  timestamp: Date;\n  score?: number;\n  feedback?: string;\n}\n\ninterface InterviewSessionProps {\n  session: any;\n  onComplete: () => void;\n}\n\nexport default function InterviewSession({ session, onComplete }: InterviewSessionProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [currentResponse, setCurrentResponse] = useState(\"\");\n  const [timeRemaining, setTimeRemaining] = useState(session.configuration.duration * 60);\n  const [currentQuestion, setCurrentQuestion] = useState<any>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioSupported, setAudioSupported] = useState(false);\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\n  const [audioLevel, setAudioLevel] = useState(0);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const audioContextRef = useRef<AudioContext | null>(null);\n  const analyserRef = useRef<AnalyserNode | null>(null);\n  const animationFrameRef = useRef<number | null>(null);\n\n  const generateQuestionMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/interview/question\", data);\n      return response.json();\n    },\n    onSuccess: (question) => {\n      setCurrentQuestion(question);\n      const newMessage: Message = {\n        id: Date.now().toString(),\n        role: 'interviewer',\n        content: question.question,\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, newMessage]);\n    }\n  });\n\n  const evaluateAnswerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/interview/evaluate\", data);\n      return response.json();\n    },\n    onSuccess: (evaluation) => {\n      setMessages(prev => {\n        const updated = [...prev];\n        const lastUserMessageIndex = updated.map(m => m.role).lastIndexOf('candidate');\n        if (lastUserMessageIndex !== -1) {\n          updated[lastUserMessageIndex] = {\n            ...updated[lastUserMessageIndex],\n            score: evaluation.score,\n            feedback: evaluation.feedback\n          };\n        }\n        return updated;\n      });\n\n      // Debug logging to see what we're getting\n      console.log('Evaluation result:', evaluation);\n      \n      // Only show follow-up if it exists, otherwise generate next question\n      if (evaluation.followUp && evaluation.followUp.trim()) {\n        console.log('Showing follow-up question:', evaluation.followUp);\n        setTimeout(() => {\n          const followUpMessage: Message = {\n            id: Date.now().toString(),\n            role: 'interviewer',\n            content: evaluation.followUp,\n            timestamp: new Date()\n          };\n          setMessages(prev => [...prev, followUpMessage]);\n        }, 1500);\n      } else {\n        console.log('Generating next question - no follow-up available');\n        // Generate next question only if no follow-up\n        setTimeout(() => {\n          const previousQuestions = messages\n            .filter(m => m.role === 'interviewer')\n            .map(m => m.content);\n          \n          generateQuestionMutation.mutate({\n            profession: session.configuration.profession,\n            interviewType: session.configuration.interviewType,\n            difficulty: session.configuration.difficulty,\n            jobPosting: session.configuration.jobPosting,\n            previousQuestions\n          });\n        }, 2000);\n      }\n    }\n  });\n\n  const generateFeedbackMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/sessions/${session.id}/feedback`);\n      return response.json();\n    },\n    onSuccess: (feedback) => {\n      console.log('Interview feedback received:', feedback);\n      onComplete();\n    }\n  });\n\n  const transcribeAudioMutation = useMutation({\n    mutationFn: async (audioBlob: Blob) => {\n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'audio.webm');\n      \n      const response = await fetch('/api/transcribe', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Transcription failed: ${response.statusText}`);\n      }\n      \n      return response.json();\n    },\n    onSuccess: (result) => {\n      if (result.text && result.text.trim()) {\n        setCurrentResponse(prev => {\n          const newText = prev ? prev + ' ' + result.text.trim() : result.text.trim();\n          return newText;\n        });\n      }\n    },\n    onError: (error) => {\n      console.error('Transcription error:', error);\n    }\n  });\n\n  // Timer countdown\n  useEffect(() => {\n    if (timeRemaining <= 0) {\n      handleEndInterview();\n      return;\n    }\n\n    const timer = setInterval(() => {\n      setTimeRemaining(prev => prev - 1);\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [timeRemaining]);\n\n  // Generate initial question\n  useEffect(() => {\n    if (messages.length === 0) {\n      generateQuestionMutation.mutate({\n        profession: session.configuration.profession,\n        interviewType: session.configuration.interviewType,\n        difficulty: session.configuration.difficulty,\n        jobPosting: session.configuration.jobPosting,\n        previousQuestions: []\n      });\n    }\n  }, []);\n\n  // Initialize audio recording capabilities\n  useEffect(() => {\n    const initializeAudioRecording = async () => {\n      try {\n        if (!navigator.mediaDevices || !window.MediaRecorder) {\n          console.log('Audio recording not supported');\n          return;\n        }\n\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        stream.getTracks().forEach(track => track.stop());\n        \n        setAudioSupported(true);\n        console.log('Audio recording initialized successfully');\n      } catch (error) {\n        console.error('Failed to initialize audio recording:', error);\n        setAudioSupported(false);\n      }\n    };\n\n    initializeAudioRecording();\n  }, []);\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      streamRef.current = stream;\n\n      // Set up audio context for wave visualization\n      audioContextRef.current = new (window.AudioContext || (window as any).webkitAudioContext)();\n      const source = audioContextRef.current.createMediaStreamSource(stream);\n      analyserRef.current = audioContextRef.current.createAnalyser();\n      analyserRef.current.fftSize = 256;\n      source.connect(analyserRef.current);\n\n      // Start audio level monitoring\n      const updateAudioLevel = () => {\n        if (analyserRef.current && isRecording) {\n          const dataArray = new Uint8Array(analyserRef.current.frequencyBinCount);\n          analyserRef.current.getByteFrequencyData(dataArray);\n          \n          // Calculate average volume level\n          const average = dataArray.reduce((sum, value) => sum + value, 0) / dataArray.length;\n          setAudioLevel(average / 255); // Normalize to 0-1\n          \n          animationFrameRef.current = requestAnimationFrame(updateAudioLevel);\n        }\n      };\n\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm;codecs=opus'\n      });\n      mediaRecorderRef.current = mediaRecorder;\n\n      const chunks: Blob[] = [];\n      setAudioChunks(chunks);\n\n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          chunks.push(event.data);\n        }\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      updateAudioLevel();\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n    }\n  };\n\n  const submitRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });\n        if (audioBlob.size > 0) {\n          transcribeAudioMutation.mutate(audioBlob);\n        }\n        cleanupRecording();\n      };\n      \n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const cancelRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.onstop = () => {\n        cleanupRecording();\n      };\n      \n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      setAudioChunks([]);\n    }\n  };\n\n  const cleanupRecording = () => {\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n      animationFrameRef.current = null;\n    }\n    \n    if (audioContextRef.current) {\n      audioContextRef.current.close();\n      audioContextRef.current = null;\n    }\n    \n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    \n    setAudioLevel(0);\n  };\n\n  const handleSendResponse = async () => {\n    if (!currentResponse.trim() || !currentQuestion || isLoading) return;\n\n    setIsLoading(true);\n    \n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'candidate',\n      content: currentResponse,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    \n    const response = currentResponse;\n    setCurrentResponse(\"\");\n\n    try {\n      await evaluateAnswerMutation.mutateAsync({\n        question: currentQuestion.question,\n        answer: response,\n        profession: session.configuration.profession,\n        difficulty: session.configuration.difficulty\n      });\n      // Question generation is now handled in the evaluation success handler\n    } catch (error) {\n      console.error('Failed to process response:', error);\n    }\n    \n    setIsLoading(false);\n  };\n\n  const handleEndInterview = async () => {\n    await apiRequest(\"PATCH\", `/api/sessions/${session.id}`, {\n      messages: messages,\n      status: 'completed',\n      completedAt: new Date()\n    });\n\n    generateFeedbackMutation.mutate();\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const getInterviewerName = () => {\n    const names = {\n      friendly: \"Sarah Chen\",\n      strict: \"Michael Rodriguez\", \n      casual: \"Alex Thompson\",\n      challenging: \"Dr. Jennifer Wu\"\n    };\n    return names[session.configuration.personality as keyof typeof names] || \"Sarah Chen\";\n  };\n\n  const getInterviewerRole = () => {\n    const roles = {\n      \"Technical Interview\": \"Senior Software Engineer\",\n      \"Behavioral Interview\": \"Engineering Manager\",\n      \"System Design\": \"Principal Architect\", \n      \"HR/Culture Fit\": \"HR Business Partner\"\n    };\n    return roles[session.configuration.interviewType as keyof typeof roles] || \"Senior Engineer\";\n  };\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Card>\n          {/* Session Header */}\n          <div className=\"border-b border-gray-200 p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                <Avatar>\n                  <AvatarFallback className=\"bg-blue-600 text-white\">\n                    <Bus className=\"h-5 w-5\" />\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{getInterviewerName()}</h3>\n                  <p className=\"text-sm text-gray-600\">{getInterviewerRole()}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-600\">Time Remaining</p>\n                  <p className={`font-semibold ${timeRemaining < 300 ? 'text-red-600' : 'text-gray-900'}`}>\n                    {formatTime(timeRemaining)}\n                  </p>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={handleEndInterview}\n                  className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                >\n                  <X className=\"h-4 w-4 mr-1\" />\n                  End Interview\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Chat Interface */}\n          <CardContent className=\"p-6\">\n            <div className=\"h-96 overflow-y-auto border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50 space-y-4\">\n              {messages.length === 0 && generateQuestionMutation.isPending && (\n                <div className=\"flex items-center space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className=\"bg-blue-600 text-white\">\n                      <Bus className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{getInterviewerName()}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">Preparing question...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {messages.map((message) => (\n                <div key={message.id} className=\"flex items-start space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className={\n                      message.role === 'interviewer' \n                        ? \"bg-blue-600 text-white\" \n                        : \"bg-gray-600 text-white\"\n                    }>\n                      {message.role === 'interviewer' ? (\n                        <Bus className=\"h-4 w-4\" />\n                      ) : (\n                        <User className=\"h-4 w-4\" />\n                      )}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {message.role === 'interviewer' ? getInterviewerName() : 'You'}\n                      </p>\n                      {message.score && (\n                        <Badge variant={message.score >= 70 ? \"default\" : \"secondary\"}>\n                          {message.score}/100\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-gray-700 mt-1\">{message.content}</p>\n                    {message.feedback && (\n                      <div className=\"mt-2 p-2 bg-blue-50 rounded border border-blue-200\">\n                        <p className=\"text-sm text-blue-800\">{message.feedback}</p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 mt-2\">\n                      {message.timestamp.toLocaleTimeString()}\n                    </p>\n                  </div>\n                </div>\n              ))}\n\n              {isLoading && (\n                <div className=\"flex items-center space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className=\"bg-blue-600 text-white\">\n                      <Bus className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{getInterviewerName()}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">Evaluating your response...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n\n\n            {/* Voice Input Status */}\n            {audioSupported ? (\n              <div className=\"mb-3 p-3 bg-green-50 border border-green-200 rounded-lg\">\n                <div className=\"flex items-start space-x-2\">\n                  <Mic className=\"h-5 w-5 text-green-600 mt-0.5\" />\n                  <div>\n                    <p className=\"text-green-800 font-medium\">Voice Input Ready</p>\n                    <p className=\"text-green-700 text-sm mt-1\">\n                      Click the microphone button to record your voice, or type your response below.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ) : (\n              <div className=\"mb-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg\">\n                <div className=\"flex items-start space-x-2\">\n                  <HelpCircle className=\"h-5 w-5 text-yellow-600 mt-0.5\" />\n                  <div>\n                    <p className=\"text-yellow-800 font-medium\">Voice Input Unavailable</p>\n                    <p className=\"text-yellow-700 text-sm mt-1\">\n                      Microphone access required for voice input. Please allow permissions when prompted.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Response Input */}\n            <div className=\"flex space-x-3\">\n              <div className=\"flex-1 relative\">\n                <Textarea\n                  className=\"resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-3 pb-16\"\n                  rows={4}\n                  placeholder={isRecording ? \"Recording in progress...\" : \"Type your response here...\"}\n                  value={currentResponse}\n                  onChange={(e) => setCurrentResponse(e.target.value)}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault();\n                      handleSendResponse();\n                    }\n                  }}\n                  disabled={isLoading || generateQuestionMutation.isPending || isRecording}\n                  aria-label=\"Interview response input\"\n                  autoComplete=\"off\"\n                  spellCheck=\"true\"\n                />\n                \n                {/* Integrated Recording Interface */}\n                {isRecording && (\n                  <div className=\"absolute bottom-2 left-2 right-2 bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-3\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <div className=\"flex items-center space-x-2\">\n                        <div className=\"animate-pulse bg-red-500 rounded-full h-2 w-2\"></div>\n                        <span className=\"text-red-800 text-xs font-medium\">Recording...</span>\n                      </div>\n                      <div className=\"flex items-center space-x-1\">\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={cancelRecording}\n                          className=\"text-red-600 border-red-300 hover:bg-red-100 h-6 w-6 p-0\"\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </Button>\n                        <Button\n                          variant=\"outline\"\n                          size=\"sm\"\n                          onClick={submitRecording}\n                          className=\"text-green-600 border-green-300 hover:bg-green-100 h-6 w-6 p-0\"\n                        >\n                          <Check className=\"h-3 w-3\" />\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    {/* Voice Wave Visualization */}\n                    <div className=\"flex items-center justify-center space-x-0.5 h-6\">\n                      {Array.from({ length: 25 }, (_, i) => (\n                        <div\n                          key={i}\n                          className=\"bg-red-400 rounded-full transition-all duration-150\"\n                          style={{\n                            width: '2px',\n                            height: `${Math.max(3, audioLevel * 20 + Math.random() * 8)}px`,\n                            opacity: audioLevel > 0.05 ? 0.8 : 0.3,\n                          }}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Processing Status */}\n                {transcribeAudioMutation.isPending && (\n                  <div className=\"absolute bottom-2 left-2 right-2 bg-blue-50 border border-blue-200 rounded-lg p-2\">\n                    <div className=\"flex items-center justify-center space-x-2\">\n                      <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600\"></div>\n                      <span className=\"text-blue-800 text-xs font-medium\">Converting speech to text...</span>\n                    </div>\n                  </div>\n                )}\n              </div>\n              \n              <div className=\"flex flex-col space-y-2\">\n                <Button \n                  size=\"lg\"\n                  onClick={handleSendResponse}\n                  disabled={!currentResponse.trim() || isLoading || generateQuestionMutation.isPending || isRecording}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n                {audioSupported && !isRecording && (\n                  <Button \n                    variant=\"outline\" \n                    size=\"lg\"\n                    onClick={startRecording}\n                    disabled={isLoading || generateQuestionMutation.isPending || transcribeAudioMutation.isPending}\n                    className=\"hover:bg-blue-50\"\n                    title=\"Start Voice Recording\"\n                  >\n                    <Mic className=\"h-4 w-4\" />\n                  </Button>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":23471,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"server/storage.ts":{"content":"import { \n  users, simulationSessions, userProgress,\n  workspaceProjects, workspaceRoles, workspaceArtifacts, workspaceTasks, workspaceInteractions, workspaceEvaluations,\n  workspaceProgress,\n  interviewSessions, interviewQuestions, interviewFeedback,\n  companies, jobPostings, jobGlossary, jobApplications, interviewTemplates, applicationStages,\n  competencies, simulationCatalogue, roleAdapters, competencyLedger, portfolioArtifacts,\n  progressionPaths, projectTemplates, userJourneys, journeyArcs, sprints, sprintActivities, competencySnapshots,\n  sprintTickets, ceremonyInstances, gitSessions, gitEvents,\n  workspaceInstances, workspacePhaseEvents,\n  planningSessions, planningMessages,\n  type User, type InsertUser, type SimulationSession, type InsertSimulationSession, type UserProgress, type InsertUserProgress,\n  type WorkspaceProject, type InsertWorkspaceProject,\n  type WorkspaceRole, type InsertWorkspaceRole,\n  type WorkspaceArtifact, type InsertWorkspaceArtifact,\n  type WorkspaceTask, type InsertWorkspaceTask,\n  type WorkspaceInteraction, type InsertWorkspaceInteraction,\n  type WorkspaceEvaluation, type InsertWorkspaceEvaluation,\n  type WorkspaceProgress, type InsertWorkspaceProgress,\n  type InterviewSession, type InsertInterviewSession,\n  type InterviewQuestion, type InsertInterviewQuestion,\n  type InterviewFeedback, type InsertInterviewFeedback,\n  type Company, type InsertCompany,\n  type JobPosting, type InsertJobPosting,\n  type JobGlossary, type InsertJobGlossary,\n  type JobApplication, type InsertJobApplication,\n  type InterviewTemplate, type InsertInterviewTemplate,\n  type ApplicationStage, type InsertApplicationStage,\n  type OfferDetails,\n  type Competency, type InsertCompetency,\n  type SimulationCatalogue, type InsertSimulationCatalogue,\n  type RoleAdapter, type InsertRoleAdapter,\n  type CompetencyLedger, type InsertCompetencyLedger,\n  type PortfolioArtifact, type InsertPortfolioArtifact,\n  type ReadinessScore,\n  type ProgressionPath, type InsertProgressionPath,\n  type ProjectTemplate, type InsertProjectTemplate,\n  type UserJourney, type InsertUserJourney,\n  type JourneyArc, type InsertJourneyArc,\n  type Sprint, type InsertSprint,\n  type SprintActivity, type InsertSprintActivity,\n  type CompetencySnapshot, type InsertCompetencySnapshot,\n  type JourneyState,\n  type SprintTicket, type InsertSprintTicket,\n  type CeremonyInstance, type InsertCeremonyInstance,\n  type GitSession, type InsertGitSession,\n  type GitEvent, type InsertGitEvent,\n  type SprintOverview, type JourneyDashboard,\n  type MasteryBand,\n  type WorkspaceInstance, type InsertWorkspaceInstance,\n  type WorkspacePhaseEvent, type InsertWorkspacePhaseEvent,\n  type WorkspaceState, type WorkspacePhase,\n  type PlanningSession, type InsertPlanningSession,\n  type PlanningMessage, type InsertPlanningMessage,\n  type PlanningSessionState,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, desc, and, or, sql, inArray } from \"drizzle-orm\";\nimport { getSprintPlanningAdapter } from \"@shared/adapters/planning\";\n\nexport interface IStorage {\n  // User operations\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  \n  // Simulation session operations\n  getSimulationSession(id: number): Promise<SimulationSession | undefined>;\n  getUserSimulationSessions(userId: number, type?: string): Promise<SimulationSession[]>;\n  createSimulationSession(session: InsertSimulationSession): Promise<SimulationSession>;\n  updateSimulationSession(id: number, updates: Partial<SimulationSession>): Promise<SimulationSession | undefined>;\n  \n  // User progress operations\n  getUserProgress(userId: number): Promise<UserProgress[]>;\n  getUserProgressByType(userId: number, type: string): Promise<UserProgress | undefined>;\n  createUserProgress(progress: InsertUserProgress): Promise<UserProgress>;\n  updateUserProgress(userId: number, type: string, updates: Partial<UserProgress>): Promise<UserProgress | undefined>;\n  \n  // Workspace project operations\n  getWorkspaceProjects(): Promise<WorkspaceProject[]>;\n  getWorkspaceProject(id: number): Promise<WorkspaceProject | undefined>;\n  createWorkspaceProject(project: InsertWorkspaceProject): Promise<WorkspaceProject>;\n  \n  // Workspace role operations\n  getWorkspaceRoles(): Promise<WorkspaceRole[]>;\n  getWorkspaceRole(id: number): Promise<WorkspaceRole | undefined>;\n  createWorkspaceRole(role: InsertWorkspaceRole): Promise<WorkspaceRole>;\n  \n  // Workspace artifact operations\n  getWorkspaceArtifacts(sessionId: number): Promise<WorkspaceArtifact[]>;\n  getWorkspaceArtifact(id: number): Promise<WorkspaceArtifact | undefined>;\n  createWorkspaceArtifact(artifact: InsertWorkspaceArtifact): Promise<WorkspaceArtifact>;\n  updateWorkspaceArtifact(id: number, updates: Partial<WorkspaceArtifact>): Promise<WorkspaceArtifact | undefined>;\n  \n  // Workspace task operations\n  getWorkspaceTasks(sessionId: number): Promise<WorkspaceTask[]>;\n  getWorkspaceTask(id: number): Promise<WorkspaceTask | undefined>;\n  createWorkspaceTask(task: InsertWorkspaceTask): Promise<WorkspaceTask>;\n  updateWorkspaceTask(id: number, updates: Partial<WorkspaceTask>): Promise<WorkspaceTask | undefined>;\n  \n  // Workspace interaction operations\n  getWorkspaceInteractions(sessionId: number, channel?: string): Promise<WorkspaceInteraction[]>;\n  createWorkspaceInteraction(interaction: InsertWorkspaceInteraction): Promise<WorkspaceInteraction>;\n  \n  // Workspace evaluation operations\n  getWorkspaceEvaluations(sessionId: number): Promise<WorkspaceEvaluation[]>;\n  createWorkspaceEvaluation(evaluation: InsertWorkspaceEvaluation): Promise<WorkspaceEvaluation>;\n  \n  // Interview session operations\n  getInterviewSession(id: number): Promise<InterviewSession | undefined>;\n  getUserInterviewSessions(userId: number, mode?: 'practice' | 'journey'): Promise<InterviewSession[]>;\n  createInterviewSession(session: InsertInterviewSession): Promise<InterviewSession>;\n  updateInterviewSession(id: number, updates: Partial<InterviewSession>): Promise<InterviewSession | undefined>;\n  \n  // Interview question operations\n  getInterviewQuestion(id: number): Promise<InterviewQuestion | undefined>;\n  getInterviewQuestions(sessionId: number): Promise<InterviewQuestion[]>;\n  createInterviewQuestion(question: InsertInterviewQuestion): Promise<InterviewQuestion>;\n  updateInterviewQuestion(id: number, updates: Partial<InterviewQuestion>): Promise<InterviewQuestion | undefined>;\n  \n  // Interview feedback operations\n  getInterviewFeedback(sessionId: number): Promise<InterviewFeedback | undefined>;\n  createInterviewFeedback(feedback: InsertInterviewFeedback): Promise<InterviewFeedback>;\n  \n  // Company operations\n  getCompanies(): Promise<Company[]>;\n  getCompany(id: number): Promise<Company | undefined>;\n  createCompany(company: InsertCompany): Promise<Company>;\n  \n  // Job posting operations\n  getJobPostings(filters?: { companyId?: number; role?: string; isActive?: boolean }): Promise<JobPosting[]>;\n  getJobPosting(id: number): Promise<JobPosting | undefined>;\n  getJobPostingWithCompany(id: number): Promise<(JobPosting & { company: Company }) | undefined>;\n  createJobPosting(posting: InsertJobPosting): Promise<JobPosting>;\n  \n  // Job glossary operations\n  getJobGlossary(): Promise<JobGlossary[]>;\n  getJobGlossaryTerm(term: string): Promise<JobGlossary | undefined>;\n  createJobGlossaryTerm(term: InsertJobGlossary): Promise<JobGlossary>;\n  \n  // Job application operations\n  getJobApplications(userId: number): Promise<JobApplication[]>;\n  getJobApplicationsWithDetails(userId: number): Promise<Array<JobApplication & { job: JobPosting & { company: Company }, stages: ApplicationStage[] }>>;\n  getJobApplication(id: number): Promise<JobApplication | undefined>;\n  createJobApplication(application: InsertJobApplication): Promise<JobApplication>;\n  updateJobApplication(id: number, updates: Partial<JobApplication>): Promise<JobApplication | undefined>;\n  \n  // Interview template operations\n  getInterviewTemplates(companyId?: number, role?: string): Promise<InterviewTemplate[]>;\n  getInterviewTemplate(id: number): Promise<InterviewTemplate | undefined>;\n  createInterviewTemplate(template: InsertInterviewTemplate): Promise<InterviewTemplate>;\n  \n  // Application stage operations\n  getApplicationStages(applicationId: number): Promise<ApplicationStage[]>;\n  getApplicationStage(id: number): Promise<ApplicationStage | undefined>;\n  getApplicationStageByInterviewSession(interviewSessionId: number): Promise<ApplicationStage | undefined>;\n  createApplicationStage(stage: InsertApplicationStage): Promise<ApplicationStage>;\n  updateApplicationStage(id: number, updates: Partial<ApplicationStage>): Promise<ApplicationStage | undefined>;\n  \n  // Workspace progress operations\n  getWorkspaceProgress(userId: number, mode?: 'practice' | 'journey'): Promise<WorkspaceProgress[]>;\n  getWorkspaceProgressBySession(sessionId: number): Promise<WorkspaceProgress | undefined>;\n  createWorkspaceProgress(progress: InsertWorkspaceProgress): Promise<WorkspaceProgress>;\n  updateWorkspaceProgress(id: number, updates: Partial<WorkspaceProgress>): Promise<WorkspaceProgress | undefined>;\n  restartWorkspaceProgress(sessionId: number): Promise<WorkspaceProgress | undefined>;\n  \n  // Phase 1: Competency operations\n  getCompetencies(filters?: { role?: string; category?: string }): Promise<Competency[]>;\n  getCompetency(slug: string): Promise<Competency | undefined>;\n  \n  // Phase 1: Simulation Catalogue operations\n  getCatalogueItems(filters?: { \n    simulator?: string; \n    type?: string;\n    role?: string; \n    level?: string; \n    language?: string;\n    day?: number;\n  }): Promise<SimulationCatalogue[]>;\n  getCatalogueItem(externalId: string): Promise<SimulationCatalogue | undefined>;\n  getCatalogueItemById(id: number): Promise<SimulationCatalogue | undefined>;\n  \n  // Phase 1: Role Adapter operations\n  getRoleAdapters(): Promise<RoleAdapter[]>;\n  getRoleAdapter(role: string): Promise<RoleAdapter | undefined>;\n  \n  // Phase 1: Competency Ledger operations\n  getUserCompetencyLedger(userId: number): Promise<CompetencyLedger[]>;\n  getUserCompetencyEntry(userId: number, competencyId: number): Promise<CompetencyLedger | undefined>;\n  createCompetencyEntry(entry: InsertCompetencyLedger): Promise<CompetencyLedger>;\n  updateCompetencyEntry(id: number, updates: Partial<CompetencyLedger>): Promise<CompetencyLedger | undefined>;\n  getUserReadiness(userId: number): Promise<ReadinessScore>;\n  \n  // Phase 1: Portfolio Artifact operations\n  getUserPortfolio(userId: number): Promise<PortfolioArtifact[]>;\n  getPortfolioArtifact(id: number): Promise<PortfolioArtifact | undefined>;\n  createPortfolioArtifact(artifact: InsertPortfolioArtifact): Promise<PortfolioArtifact>;\n  \n  // Phase 3: Progression Path operations\n  getProgressionPaths(filters?: { role?: string; entryLevel?: string }): Promise<ProgressionPath[]>;\n  getProgressionPath(slug: string): Promise<ProgressionPath | undefined>;\n  getProgressionPathById(id: number): Promise<ProgressionPath | undefined>;\n  createProgressionPath(path: InsertProgressionPath): Promise<ProgressionPath>;\n  \n  // Phase 3: Project Template operations\n  getProjectTemplates(filters?: { language?: string; industry?: string }): Promise<ProjectTemplate[]>;\n  getProjectTemplate(slug: string): Promise<ProjectTemplate | undefined>;\n  getProjectTemplateById(id: number): Promise<ProjectTemplate | undefined>;\n  createProjectTemplate(template: InsertProjectTemplate): Promise<ProjectTemplate>;\n  \n  // Phase 3: User Journey operations\n  getUserJourneys(userId: number): Promise<UserJourney[]>;\n  getUserActiveJourney(userId: number): Promise<UserJourney | undefined>;\n  getJourney(id: number): Promise<UserJourney | undefined>;\n  createJourney(journey: InsertUserJourney): Promise<UserJourney>;\n  updateJourney(id: number, updates: Partial<UserJourney>): Promise<UserJourney | undefined>;\n  getJourneyState(journeyId: number): Promise<JourneyState | null>;\n  \n  // Phase 3: Journey Arc operations\n  getJourneyArcs(journeyId: number): Promise<JourneyArc[]>;\n  getJourneyArc(id: number): Promise<JourneyArc | undefined>;\n  getCurrentArc(journeyId: number): Promise<JourneyArc | undefined>;\n  createJourneyArc(arc: InsertJourneyArc): Promise<JourneyArc>;\n  updateJourneyArc(id: number, updates: Partial<JourneyArc>): Promise<JourneyArc | undefined>;\n  \n  // Phase 3: Sprint operations\n  getSprint(id: number): Promise<Sprint | undefined>;\n  getSprintByArc(arcId: number): Promise<Sprint | undefined>;\n  getSprintsByJourney(journeyId: number): Promise<Sprint[]>;\n  createSprint(sprint: InsertSprint): Promise<Sprint>;\n  updateSprint(id: number, updates: Partial<Sprint>): Promise<Sprint | undefined>;\n  \n  // Phase 3: Sprint Activity operations\n  getSprintActivities(sprintId: number, dayNumber?: number): Promise<SprintActivity[]>;\n  getSprintActivity(id: number): Promise<SprintActivity | undefined>;\n  createSprintActivity(activity: InsertSprintActivity): Promise<SprintActivity>;\n  updateSprintActivity(id: number, updates: Partial<SprintActivity>): Promise<SprintActivity | undefined>;\n  \n  // Phase 3: Competency Snapshot operations\n  getCompetencySnapshots(journeyId: number): Promise<CompetencySnapshot[]>;\n  createCompetencySnapshot(snapshot: InsertCompetencySnapshot): Promise<CompetencySnapshot>;\n  \n  // Phase 5: Sprint Ticket operations\n  getSprintTickets(sprintId: number): Promise<SprintTicket[]>;\n  getSprintTicket(id: number): Promise<SprintTicket | undefined>;\n  getSprintTicketByKey(sprintId: number, ticketKey: string): Promise<SprintTicket | undefined>;\n  createSprintTicket(ticket: InsertSprintTicket): Promise<SprintTicket>;\n  updateSprintTicket(id: number, updates: Partial<SprintTicket>): Promise<SprintTicket | undefined>;\n  \n  // Phase 5: Ceremony Instance operations\n  getCeremonyInstances(sprintId: number): Promise<CeremonyInstance[]>;\n  getCeremonyInstance(id: number): Promise<CeremonyInstance | undefined>;\n  getCeremonyByType(sprintId: number, ceremonyType: string, dayNumber?: number): Promise<CeremonyInstance | undefined>;\n  createCeremonyInstance(ceremony: InsertCeremonyInstance): Promise<CeremonyInstance>;\n  updateCeremonyInstance(id: number, updates: Partial<CeremonyInstance>): Promise<CeremonyInstance | undefined>;\n  \n  // Phase 5: Git Session operations\n  getGitSession(ticketId: number): Promise<GitSession | undefined>;\n  getGitSessionById(id: number): Promise<GitSession | undefined>;\n  createGitSession(session: InsertGitSession): Promise<GitSession>;\n  updateGitSession(id: number, updates: Partial<GitSession>): Promise<GitSession | undefined>;\n  \n  // Phase 5: Git Event operations\n  getGitEvents(sessionId: number): Promise<GitEvent[]>;\n  createGitEvent(event: InsertGitEvent): Promise<GitEvent>;\n  \n  // Phase 5: Dashboard data operations\n  getSprintOverview(sprintId: number): Promise<SprintOverview | null>;\n  getJourneyDashboard(journeyId: number): Promise<JourneyDashboard | null>;\n  \n  // Phase 5: Workspace Instance operations\n  getWorkspaceInstance(id: number): Promise<WorkspaceInstance | undefined>;\n  getWorkspaceInstanceByJourney(journeyId: number): Promise<WorkspaceInstance | undefined>;\n  getUserWorkspaceInstances(userId: number): Promise<WorkspaceInstance[]>;\n  createWorkspaceInstance(workspace: InsertWorkspaceInstance): Promise<WorkspaceInstance>;\n  updateWorkspaceInstance(id: number, updates: Partial<WorkspaceInstance>): Promise<WorkspaceInstance | undefined>;\n  \n  // Phase 5: Workspace Phase Event operations\n  getWorkspacePhaseEvents(workspaceId: number): Promise<WorkspacePhaseEvent[]>;\n  createWorkspacePhaseEvent(event: InsertWorkspacePhaseEvent): Promise<WorkspacePhaseEvent>;\n  updateWorkspacePhaseEvent(id: number, updates: Partial<WorkspacePhaseEvent>): Promise<WorkspacePhaseEvent | undefined>;\n  \n  // Phase 5: Workspace State operations\n  getWorkspaceState(workspaceId: number): Promise<WorkspaceState | null>;\n  advanceWorkspacePhase(workspaceId: number, payload?: Record<string, unknown>): Promise<WorkspaceInstance | undefined>;\n  \n  // Phase 6: Planning Session operations\n  getPlanningSession(id: number): Promise<PlanningSession | undefined>;\n  getPlanningSessionByWorkspace(workspaceId: number): Promise<PlanningSession | undefined>;\n  createPlanningSession(session: InsertPlanningSession): Promise<PlanningSession>;\n  updatePlanningSession(id: number, updates: Partial<PlanningSession>): Promise<PlanningSession | undefined>;\n  \n  // Phase 6: Planning Message operations\n  getPlanningMessages(sessionId: number): Promise<PlanningMessage[]>;\n  createPlanningMessage(message: InsertPlanningMessage): Promise<PlanningMessage>;\n  \n  // Phase 6: Planning Session State\n  getPlanningSessionState(workspaceId: number): Promise<PlanningSessionState | null>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<number, User>;\n  private sessions: Map<number, SimulationSession>;\n  private progress: Map<string, UserProgress>; // key: `${userId}-${type}`\n  private workspaceProjects: Map<number, WorkspaceProject>;\n  private workspaceRoles: Map<number, WorkspaceRole>;\n  private workspaceArtifacts: Map<number, WorkspaceArtifact>;\n  private workspaceTasks: Map<number, WorkspaceTask>;\n  private workspaceInteractions: Map<number, WorkspaceInteraction>;\n  private workspaceEvaluations: Map<number, WorkspaceEvaluation>;\n  private interviewSessionsMap: Map<number, InterviewSession>;\n  private interviewQuestionsMap: Map<number, InterviewQuestion>;\n  private interviewFeedbackMap: Map<number, InterviewFeedback>;\n  private companiesMap: Map<number, Company>;\n  private jobPostingsMap: Map<number, JobPosting>;\n  private jobGlossaryMap: Map<number, JobGlossary>;\n  private jobApplicationsMap: Map<number, JobApplication>;\n  private interviewTemplatesMap: Map<number, InterviewTemplate>;\n  private applicationStagesMap: Map<number, ApplicationStage>;\n  private currentUserId: number;\n  private currentSessionId: number;\n  private currentProgressId: number;\n  private currentProjectId: number;\n  private currentRoleId: number;\n  private currentArtifactId: number;\n  private currentTaskId: number;\n  private currentInteractionId: number;\n  private currentEvaluationId: number;\n  private currentInterviewSessionId: number;\n  private currentInterviewQuestionId: number;\n  private currentInterviewFeedbackId: number;\n  private currentCompanyId: number;\n  private currentJobPostingId: number;\n  private currentJobGlossaryId: number;\n  private currentJobApplicationId: number;\n  private currentInterviewTemplateId: number;\n  private currentApplicationStageId: number;\n\n  constructor() {\n    this.users = new Map();\n    this.sessions = new Map();\n    this.progress = new Map();\n    this.workspaceProjects = new Map();\n    this.workspaceRoles = new Map();\n    this.workspaceArtifacts = new Map();\n    this.workspaceTasks = new Map();\n    this.workspaceInteractions = new Map();\n    this.workspaceEvaluations = new Map();\n    this.interviewSessionsMap = new Map();\n    this.interviewQuestionsMap = new Map();\n    this.interviewFeedbackMap = new Map();\n    this.companiesMap = new Map();\n    this.jobPostingsMap = new Map();\n    this.jobGlossaryMap = new Map();\n    this.jobApplicationsMap = new Map();\n    this.interviewTemplatesMap = new Map();\n    this.applicationStagesMap = new Map();\n    this.currentUserId = 1;\n    this.currentSessionId = 1;\n    this.currentProgressId = 1;\n    this.currentProjectId = 1;\n    this.currentRoleId = 1;\n    this.currentArtifactId = 1;\n    this.currentTaskId = 1;\n    this.currentInteractionId = 1;\n    this.currentEvaluationId = 1;\n    this.currentInterviewSessionId = 1;\n    this.currentInterviewQuestionId = 1;\n    this.currentInterviewFeedbackId = 1;\n    this.currentCompanyId = 1;\n    this.currentJobPostingId = 1;\n    this.currentJobGlossaryId = 1;\n    this.currentJobApplicationId = 1;\n    this.currentInterviewTemplateId = 1;\n    this.currentApplicationStageId = 1;\n    \n    // Create a default user\n    this.createUser({\n      username: \"arsen\",\n      password: \"password\",\n      email: \"arsen@edmap.com\",\n      firstName: \"Arsen\",\n      lastName: \"User\"\n    });\n\n    // Seed workspace data\n    this.seedWorkspaceData();\n    \n    // Seed job journey data\n    this.seedJobJourneyData();\n    this.seedSprintWorkflowData();\n  }\n\n  private async seedWorkspaceData() {\n    // Check if workspace projects already exist in database - skip seeding if so\n    const existingProjects = await db.select().from(workspaceProjects).limit(1);\n    if (existingProjects.length > 0) {\n      console.log('Workspace data already exists in database, skipping seed...');\n      return;\n    }\n\n    // Seed roles\n    const roles = [\n      {\n        name: 'Developer',\n        description: 'Build features, write code, and fix bugs',\n        competencies: ['coding', 'problem-solving', 'technical-communication'],\n        availableActions: ['write-code', 'review-code', 'create-ticket', 'update-task', 'ask-question'],\n        evaluationCriteria: ['code-quality', 'technical-accuracy', 'collaboration', 'communication']\n      },\n      {\n        name: 'Product Manager',\n        description: 'Define requirements, prioritize features, and coordinate team',\n        competencies: ['strategic-thinking', 'stakeholder-management', 'prioritization'],\n        availableActions: ['create-ticket', 'prioritize-backlog', 'clarify-requirements', 'run-meeting'],\n        evaluationCriteria: ['clarity', 'prioritization', 'stakeholder-communication', 'decision-making']\n      },\n      {\n        name: 'Designer',\n        description: 'Create designs, conduct user research, and ensure great UX',\n        competencies: ['visual-design', 'user-research', 'prototyping'],\n        availableActions: ['create-design', 'provide-feedback', 'conduct-research', 'update-design-system'],\n        evaluationCriteria: ['design-quality', 'user-focus', 'collaboration', 'communication']\n      },\n      {\n        name: 'QA Engineer',\n        description: 'Write tests, find bugs, and ensure quality',\n        competencies: ['testing', 'attention-to-detail', 'bug-reporting'],\n        availableActions: ['write-test', 'report-bug', 'verify-fix', 'create-test-plan'],\n        evaluationCriteria: ['test-coverage', 'bug-quality', 'thoroughness', 'communication']\n      },\n      {\n        name: 'DevOps Engineer',\n        description: 'Manage infrastructure, deployments, and system reliability',\n        competencies: ['infrastructure', 'automation', 'monitoring'],\n        availableActions: ['configure-deployment', 'monitor-systems', 'optimize-performance', 'fix-infrastructure'],\n        evaluationCriteria: ['reliability', 'automation', 'security', 'problem-solving']\n      }\n    ];\n\n    for (const role of roles) {\n      await this.createWorkspaceRole(role);\n    }\n\n    // Seed projects\n    const projects = [\n      {\n        name: 'Task Management App',\n        description: 'Build a modern task management application for teams',\n        category: 'web-app',\n        teamStructure: [\n          {\n            name: 'Sarah',\n            role: 'Developer',\n            personality: 'experienced and helpful',\n            expertise: ['React', 'Node.js', 'TypeScript'],\n            availability: 'usually'\n          },\n          {\n            name: 'Marcus',\n            role: 'Product Manager',\n            personality: 'strategic and detail-oriented',\n            expertise: ['product-strategy', 'user-research', 'agile'],\n            availability: 'usually'\n          },\n          {\n            name: 'Elena',\n            role: 'Designer',\n            personality: 'creative and user-focused',\n            expertise: ['UI-design', 'UX-research', 'prototyping'],\n            availability: 'sometimes'\n          },\n          {\n            name: 'Raj',\n            role: 'QA Engineer',\n            personality: 'thorough and analytical',\n            expertise: ['automated-testing', 'manual-testing', 'bug-tracking'],\n            availability: 'always'\n          }\n        ],\n        requirements: {\n          features: ['User authentication', 'Task creation and editing', 'Team collaboration', 'Deadline tracking'],\n          techStack: ['React', 'Node.js', 'PostgreSQL', 'TailwindCSS'],\n          milestones: [\n            { name: 'MVP Launch', deadline: '2 weeks', tasks: 8 },\n            { name: 'Beta Release', deadline: '4 weeks', tasks: 12 }\n          ]\n        },\n        scenarioScript: {\n          events: [\n            { trigger: 'task_3_complete', type: 'bug-report', from: 'Raj', severity: 'high' },\n            { trigger: 'day_3', type: 'requirement-change', from: 'Marcus', impact: 'medium' },\n            { trigger: 'review_requested', type: 'design-feedback', from: 'Elena', detail: 'positive' }\n          ]\n        },\n        difficulty: 'mid',\n        estimatedDuration: 45\n      },\n      {\n        name: 'E-commerce Platform API',\n        description: 'Design and build REST APIs for an e-commerce platform',\n        category: 'api',\n        teamStructure: [\n          {\n            name: 'David',\n            role: 'Developer',\n            personality: 'senior and mentoring',\n            expertise: ['API-design', 'database-optimization', 'security'],\n            availability: 'usually'\n          },\n          {\n            name: 'Lisa',\n            role: 'Product Manager',\n            personality: 'business-focused and pragmatic',\n            expertise: ['API-products', 'technical-specs', 'pricing'],\n            availability: 'sometimes'\n          },\n          {\n            name: 'Tom',\n            role: 'DevOps Engineer',\n            personality: 'security-conscious and systematic',\n            expertise: ['cloud-infrastructure', 'CI-CD', 'monitoring'],\n            availability: 'usually'\n          }\n        ],\n        requirements: {\n          features: ['Product catalog API', 'Order management', 'Payment integration', 'Admin dashboard'],\n          techStack: ['Node.js', 'Express', 'MongoDB', 'Redis'],\n          milestones: [\n            { name: 'Core APIs', deadline: '2 weeks', tasks: 6 },\n            { name: 'Integration', deadline: '3 weeks', tasks: 8 }\n          ]\n        },\n        scenarioScript: null,\n        difficulty: 'senior',\n        estimatedDuration: 60\n      },\n      {\n        name: 'Mobile Fitness App',\n        description: 'Create a mobile fitness tracking application',\n        category: 'mobile-app',\n        teamStructure: [\n          {\n            name: 'Alex',\n            role: 'Developer',\n            personality: 'enthusiastic and fast-paced',\n            expertise: ['React-Native', 'mobile-development', 'animations'],\n            availability: 'always'\n          },\n          {\n            name: 'Priya',\n            role: 'Designer',\n            personality: 'detail-oriented and empathetic',\n            expertise: ['mobile-UI', 'micro-interactions', 'accessibility'],\n            availability: 'usually'\n          },\n          {\n            name: 'Jordan',\n            role: 'Product Manager',\n            personality: 'data-driven and collaborative',\n            expertise: ['mobile-products', 'analytics', 'user-retention'],\n            availability: 'usually'\n          },\n          {\n            name: 'Sam',\n            role: 'QA Engineer',\n            personality: 'meticulous and patient',\n            expertise: ['mobile-testing', 'device-testing', 'performance'],\n            availability: 'usually'\n          }\n        ],\n        requirements: {\n          features: ['Workout tracking', 'Progress charts', 'Social features', 'Goal setting'],\n          techStack: ['React Native', 'Firebase', 'TypeScript'],\n          milestones: [\n            { name: 'Core Features', deadline: '3 weeks', tasks: 10 },\n            { name: 'Social Features', deadline: '5 weeks', tasks: 8 }\n          ]\n        },\n        scenarioScript: null,\n        difficulty: 'junior',\n        estimatedDuration: 40\n      },\n      {\n        name: 'PulseOps IQ - Executive Heatmap Feature',\n        description: 'Enterprise incident analytics platform - Add executive incident heatmap and forecasting module',\n        category: 'enterprise-feature',\n        teamStructure: [\n          {\n            name: 'Claire',\n            role: 'Product Manager',\n            personality: 'strategic and stakeholder-focused',\n            expertise: ['enterprise-products', 'analytics', 'SLA-management', 'roadmap-planning'],\n            availability: 'usually'\n          },\n          {\n            name: 'Ravi',\n            role: 'Developer',\n            personality: 'architectural and thorough',\n            expertise: ['TypeScript', 'API-design', 'data-aggregation', 'PostgreSQL', 'performance-optimization'],\n            availability: 'always'\n          },\n          {\n            name: 'Maya',\n            role: 'Designer',\n            personality: 'design-conscious and detail-oriented',\n            expertise: ['data-visualization', 'design-systems', 'enterprise-UI', 'accessibility'],\n            availability: 'usually'\n          },\n          {\n            name: 'Jon',\n            role: 'Data Scientist',\n            personality: 'analytical and collaborative',\n            expertise: ['forecasting-algorithms', 'statistical-analysis', 'trend-detection', 'data-validation'],\n            availability: 'sometimes'\n          },\n          {\n            name: 'Elena',\n            role: 'QA Engineer',\n            personality: 'methodical and regression-aware',\n            expertise: ['test-automation', 'regression-testing', 'data-validation', 'integration-testing'],\n            availability: 'always'\n          },\n          {\n            name: 'Luis',\n            role: 'DevOps Engineer',\n            personality: 'reliability-focused and automation-minded',\n            expertise: ['CI-CD', 'monitoring', 'deployment-automation', 'performance-testing'],\n            availability: 'usually'\n          }\n        ],\n        requirements: {\n          scenario: 'enterprise-existing-codebase',\n          existingProduct: {\n            name: 'PulseOps IQ',\n            description: 'Enterprise incident & service analytics SaaS for ITSM teams',\n            existingFeatures: [\n              'Incident ingestion dashboard',\n              'SLA reporting',\n              'Automation playbooks',\n              'Stakeholder reporting',\n              'Alert management'\n            ],\n            techStack: ['React', 'Vite', 'TypeScript', 'Express', 'PostgreSQL', 'TailwindCSS'],\n            codebaseSize: '~15,000 LOC',\n            architecture: 'Monorepo with client/, server/, shared/ structure'\n          },\n          featureRequest: {\n            title: 'Executive Incident Heatmap & Forecasting',\n            businessContext: 'Enterprise customers need proactive SLA management - visibility into incident patterns and prediction of future hotspots',\n            requirements: [\n              'New API endpoint: /api/analytics/heatmap - aggregates incidents by service & business unit',\n              'Frontend heatmap visualization with color intensity = incident volume',\n              'Trend forecasts (7-day, 30-day) with statistical confidence',\n              'Alert threshold configuration for hotspot detection',\n              'Export functionality (CSV, PDF) for executive reports',\n              'Permission checks - executive role required',\n              'Performance: <2s page load, handle 10k+ incidents'\n            ],\n            acceptanceCriteria: [\n              'Heatmap displays accurate incident counts per service/unit',\n              'Forecasting algorithm validated with historical test data (10% accuracy)',\n              'UI matches existing design system and component patterns',\n              'All existing dashboard tests continue to pass (regression)',\n              'New feature has 80% test coverage',\n              'Documentation updated (API reference, user guide)'\n            ]\n          },\n          productDocumentation: {\n            executiveSummary: 'The Executive Heatmap & Forecasting feature enables C-level executives and IT directors to proactively identify incident patterns and predict future service hotspots. This strategic capability transforms PulseOps IQ from a reactive monitoring tool into a proactive SLA management platform, directly addressing our enterprise customers\\' #1 feature request (mentioned in 73% of Q3 customer interviews).',\n            stakeholders: [\n              {\n                name: 'Sarah Chen',\n                title: 'VP of Product',\n                priority: 'Critical - Q4 strategic initiative',\n                concerns: ['Market differentiation', 'Enterprise upsell opportunity', 'Competitive parity with ServiceNow'],\n                successMetrics: ['30% increase in enterprise tier conversions', 'Feature mentioned in 80% of sales demos']\n              },\n              {\n                name: 'Michael Torres',\n                title: 'Head of Customer Success',\n                priority: 'High - reduces escalations',\n                concerns: ['Ease of use for executives', 'Actionable insights', 'Reduces \"firefighting\" support'],\n                successMetrics: ['50% reduction in SLA breach escalations', '4.5+ satisfaction rating']\n              },\n              {\n                name: 'Enterprise Customer Council',\n                title: 'Beta testers (5 Fortune 500 companies)',\n                priority: 'Critical - retention risk',\n                concerns: ['Accuracy of forecasts', 'Performance with large datasets', 'Export for board presentations'],\n                successMetrics: ['10% forecast accuracy', '<2s load time', 'PDF export used weekly']\n              }\n            ],\n            userStories: [\n              {\n                persona: 'IT Director (Emily)',\n                goal: 'Prevent SLA breaches before they happen',\n                story: 'As an IT Director managing 200+ services, I want to see which services are trending toward incidents so that I can proactively allocate resources and avoid costly SLA breaches.',\n                painPoint: 'Currently reacts to incidents after they occur - wants to be proactive',\n                jobs: ['Weekly exec report preparation', 'Budget planning for support team', 'Vendor management']\n              },\n              {\n                persona: 'CTO (David)',\n                goal: 'Strategic visibility into operational health',\n                story: 'As a CTO reporting to the board, I want exportable heatmaps showing incident trends so that I can demonstrate we\\'re managing technical debt and service reliability strategically.',\n                painPoint: 'Board asks \"why so many incidents?\" - needs data-driven answer',\n                jobs: ['Monthly board presentations', 'Strategic planning', 'Technology investment decisions']\n              },\n              {\n                persona: 'Service Owner (Priya)',\n                goal: 'Understand impact of my service on business units',\n                story: 'As a Service Owner for the payments API, I want to see incident distribution across business units so that I can prioritize fixes for the most critical customers.',\n                painPoint: 'Doesn\\'t know which incidents matter most to the business',\n                jobs: ['Sprint planning', 'Incident post-mortems', 'Stakeholder communication']\n              }\n            ],\n            successMetrics: {\n              primary: [\n                'Enterprise tier conversion rate: +30% (baseline: 12% of trials)',\n                'Feature adoption: 70% of enterprise users within 60 days',\n                'Forecast accuracy: 10% of actual incident volume',\n                'Customer satisfaction: 4.5/5.0 rating for feature'\n              ],\n              secondary: [\n                'Page load performance: <2 seconds (95th percentile)',\n                'Export usage: 40% of users export weekly',\n                'Support ticket reduction: -25% SLA-related escalations',\n                'Sales cycle impact: -15% time to close for enterprise'\n              ],\n              technical: [\n                'API response time: <500ms for 10k incidents',\n                'Test coverage: 80% for new code',\n                'Zero regression bugs in existing dashboards',\n                'Accessibility: WCAG 2.1 AA compliance'\n              ]\n            },\n            roadmapContext: {\n              quarterlyTheme: 'Q4 2024: Enterprise Proactive Operations',\n              positioning: 'Flagship feature for enterprise tier - enables pricing increase from $499 to $799/month',\n              dependencies: [\n                'Q3: Analytics engine optimization (completed)',\n                'Q4: Executive dashboard redesign (in parallel)',\n                'Q1 2025: Machine learning model refinement (follow-up)'\n              ],\n              futureEnhancements: [\n                'Q1 2025: Anomaly detection with ML',\n                'Q2 2025: Predictive resource auto-scaling recommendations',\n                'Q3 2025: Integration with PagerDuty for auto-escalation'\n              ]\n            },\n            competitiveAnalysis: [\n              {\n                competitor: 'ServiceNow',\n                theirCapability: 'Incident trending with basic visualization',\n                ourDifferentiator: 'Statistical forecasting + business unit segmentation + executive export',\n                gap: 'They lack predictive capabilities - reactive only'\n              },\n              {\n                competitor: 'Datadog',\n                theirCapability: 'APM monitoring with alerts',\n                ourDifferentiator: 'Business-context layered heatmaps (not just technical metrics)',\n                gap: 'Dev-focused, not exec-friendly. No business unit view.'\n              },\n              {\n                competitor: 'PagerDuty',\n                theirCapability: 'On-call scheduling and incident response',\n                ourDifferentiator: 'Strategic analytics vs. tactical response - prevention vs. reaction',\n                gap: 'Doesn\\'t answer \"where should we invest to prevent incidents?\"'\n              }\n            ],\n            goToMarketStrategy: {\n              launchDate: 'December 15, 2024',\n              targetSegment: 'Enterprise customers (500+ employees) with complex service architectures',\n              messagingPillars: [\n                'Transform from reactive to proactive - predict incidents before they happen',\n                'Executive visibility - board-ready insights in minutes, not hours',\n                'ROI proof - prevent costly SLA breaches with data-driven forecasting'\n              ],\n              salesEnablement: [\n                'Demo video showing 2-minute executive workflow (produce by Dec 1)',\n                'ROI calculator: \"If you prevent 3 SLA breaches/month = $X saved\"',\n                'Competitive battlecard vs. ServiceNow (highlight forecast gap)',\n                'Customer testimonial video from beta program (schedule Dec 10)'\n              ],\n              pricing: 'Enterprise tier exclusive - justifies $799/mo price point',\n              launchActivities: [\n                'Product Hunt launch (Dec 16)',\n                'Webinar: \"Proactive SLA Management\" (Dec 18, 200 registrants goal)',\n                'Blog post: \"How Fortune 500 Companies Predict Incidents\" (Dec 15)',\n                'LinkedIn ad campaign targeting IT Directors (2-week campaign, $5k budget)'\n              ]\n            },\n            riskAssessment: [\n              {\n                risk: 'Forecast accuracy below 10% threshold',\n                probability: 'Medium',\n                impact: 'High - erodes trust in feature',\n                mitigation: 'Extensive testing with historical data, phased rollout with beta customers, clearly communicate confidence intervals in UI'\n              },\n              {\n                risk: 'Performance degrades with enterprise-scale data (>50k incidents)',\n                probability: 'Low',\n                impact: 'Critical - unusable for largest customers',\n                mitigation: 'Load testing with 100k incident dataset, implement data aggregation caching, query optimization review with Jon (Data Scientist)'\n              },\n              {\n                risk: 'Sales team lacks confidence to demo feature',\n                probability: 'Medium',\n                impact: 'Medium - slow adoption, missed revenue',\n                mitigation: 'Dedicated training session Dec 8, simple demo script, pre-recorded video backup, involve sales in beta testing'\n              },\n              {\n                risk: 'Feature too complex for target users',\n                probability: 'Low',\n                impact: 'High - low adoption despite development effort',\n                mitigation: 'User testing with 3 customer personas, built-in tooltips, guided onboarding tour, \"Quick Start\" template presets'\n              }\n            ],\n            resourcePlanning: {\n              teamAllocation: {\n                engineering: '2 backend (Ravi, Jon for forecasting), 1 frontend (Maya), 1 QA (Elena), 0.5 DevOps (Luis)',\n                design: '0.5 FTE (Maya - UI design)',\n                pm: '0.8 FTE (Claire - coordinate, stakeholder mgmt, launch prep)',\n                dataScience: '0.3 FTE (Jon - forecasting model)'\n              },\n              timeline: '5 sprints (10 weeks) - Dec 15 target launch',\n              budget: {\n                development: '$85k (team time)',\n                infrastructure: '$2k/month (increased analytics compute)',\n                marketing: '$5k (launch campaign)',\n                total: '$92k estimated'\n              },\n              dependencies: [\n                'Analytics DB optimization (must complete by Nov 20)',\n                'Design system v2 (parallel track, low risk)',\n                'Sales enablement materials (Dec 1-8 window)'\n              ]\n            }\n          },\n          phases: [\n            {\n              name: 'onboarding',\n              duration: 5,\n              objectives: [\n                'Welcome to PulseOps IQ team',\n                'Review product overview and architecture',\n                'Explore existing codebase structure',\n                'Understand feature requirements and business context'\n              ],\n              deliverables: ['Understanding of codebase', 'Questions answered by team']\n            },\n            {\n              name: 'planning',\n              duration: 5,\n              objectives: [\n                'Break down feature into implementation tasks',\n                'Discuss technical approach with team',\n                'Identify dependencies and potential risks',\n                'Define timeline and milestones'\n              ],\n              deliverables: ['Task breakdown', 'Technical design decisions', 'Sprint plan']\n            },\n            {\n              name: 'implementation',\n              duration: 30,\n              objectives: [\n                'Implement backend aggregation API',\n                'Build frontend heatmap visualization',\n                'Add forecasting algorithm integration',\n                'Write unit and integration tests',\n                'Update documentation'\n              ],\n              deliverables: ['Working code', 'Tests passing', 'PR ready for review']\n            },\n            {\n              name: 'review',\n              duration: 10,\n              objectives: [\n                'Submit PR for team review',\n                'Address code review feedback',\n                'Ensure all tests pass',\n                'Verify no regression on existing features'\n              ],\n              deliverables: ['PR approved', 'All feedback addressed', 'CI passing']\n            },\n            {\n              name: 'release',\n              duration: 5,\n              objectives: [\n                'Merge feature to main branch',\n                'Deploy to staging environment',\n                'Sprint retrospective with team',\n                'Receive performance evaluation'\n              ],\n              deliverables: ['Feature deployed', 'Release notes', 'Team feedback']\n            }\n          ],\n          simulatedCodebase: {\n            structure: {\n              'client/src/pages/dashboard': ['incident-dashboard.tsx', 'sla-reports.tsx', 'automation-playbooks.tsx'],\n              'client/src/pages/analytics': ['overview.tsx', 'service-health.tsx'],\n              'client/src/components/charts': ['line-chart.tsx', 'bar-chart.tsx', 'pie-chart.tsx'],\n              'server/routes': ['incidents.ts', 'reports.ts', 'analytics.ts', 'playbooks.ts'],\n              'server/services': ['incident-service.ts', 'sla-calculator.ts', 'analytics-engine.ts'],\n              'shared': ['schema.ts', 'types.ts', 'validation.ts'],\n              'docs': ['README.md', 'ARCHITECTURE.md', 'API_REFERENCE.md']\n            },\n            keyFiles: [\n              {\n                path: 'server/routes/analytics.ts',\n                description: 'Analytics API endpoints - you\\'ll add heatmap endpoint here',\n                snippet: 'export async function analyticsRoutes(app: Express) {\\n  app.get(\"/api/analytics/overview\", ...);\\n  app.get(\"/api/analytics/service-health\", ...);\\n  // Add heatmap endpoint here\\n}'\n              },\n              {\n                path: 'client/src/pages/analytics/overview.tsx',\n                description: 'Analytics dashboard page - good reference for adding heatmap',\n                snippet: 'export default function AnalyticsOverview() {\\n  const { data: metrics } = useQuery({ queryKey: [\\'/api/analytics/overview\\'] });\\n  return <div>...</div>;\\n}'\n              },\n              {\n                path: 'shared/schema.ts',\n                description: 'Data models and types - check incident schema',\n                snippet: 'export const incidents = pgTable(\"incidents\", {\\n  id: serial(\"id\"),\\n  serviceId: integer(\"service_id\"),\\n  severity: text(\"severity\"),\\n  status: text(\"status\"),\\n  ...\\n});'\n              }\n            ]\n          }\n        },\n        scenarioScript: {\n          phases: {\n            onboarding: [\n              { from: 'Claire', time: 1, message: 'Welcome to PulseOps IQ! Excited to have you on the team. We\\'re building the Executive Heatmap feature - it\\'s a high-priority request from our enterprise customers.' },\n              { from: 'Ravi', time: 2, message: 'Hey! I can give you a quick tour of the codebase. We use a monorepo structure - client/ for React frontend, server/ for Express backend, shared/ for types.' },\n              { from: 'Maya', time: 3, message: 'From a design perspective, we have an established design system in client/src/components. The heatmap should follow our existing chart patterns.' },\n              { from: 'Claire', time: 4, message: 'Just to clarify - you\\'re taking the lead on this feature. I\\'ll be here to help with onboarding and then step back to a standby role. Feel free to @mention me anytime you need guidance or get stuck!' }\n            ],\n            planning: [\n              { from: 'Jon', time: 1, message: 'For forecasting, I can provide a statistical model API you can call. We\\'ll use exponential smoothing for trend prediction.' },\n              { from: 'Elena', time: 2, message: 'Make sure we have test coverage for the new endpoints and regression tests for existing dashboards. I\\'ll help with test strategy.' }\n            ],\n            implementation: [\n              { from: 'Ravi', time: 10, message: 'How\\'s the implementation going? Let me know if you hit any roadblocks with the aggregation logic.' },\n              { from: 'Maya', time: 15, message: 'I\\'d love to review the heatmap UI once you have something visual. Make sure it\\'s responsive and accessible!' },\n              { from: 'Luis', time: 20, message: 'FYI - deployment process is automated via GitHub Actions. Just make sure your tests pass locally first.' }\n            ]\n          }\n        },\n        difficulty: 'senior',\n        estimatedDuration: 55\n      },\n      // NovaPay Intern Onboarding - 42 London Block 1\n      {\n        name: 'NovaPay - Intern Onboarding',\n        description: 'Your first week as a software engineering intern at NovaPay, a fintech startup building payment solutions for small businesses.',\n        category: 'intern-onboarding',\n        teamStructure: [\n          {\n            name: 'Sarah',\n            role: 'Engineering Lead',\n            personality: 'calm, thorough, high standards but supportive',\n            expertise: ['React', 'Node.js', 'TypeScript', 'code-review', 'mentoring'],\n            availability: 'usually',\n            bio: 'Sarah has been at NovaPay for 3 years and built most of the Merchant Dashboard. She loves mentoring new engineers and believes everyone deserves patient guidance.'\n          },\n          {\n            name: 'Marcus',\n            role: 'Senior Developer',\n            personality: 'friendly, slightly impatient, pragmatic',\n            expertise: ['Node.js', 'PostgreSQL', 'API-design', 'debugging'],\n            availability: 'usually',\n            bio: 'Marcus is a senior dev who joined from a big tech company. He\\'s direct and efficient - sometimes his Slack messages feel terse, but he means well.'\n          },\n          {\n            name: 'Priya',\n            role: 'Product Manager',\n            personality: 'organized, clear communicator, deadline-aware',\n            expertise: ['product-strategy', 'agile', 'stakeholder-management', 'sprint-planning'],\n            availability: 'usually',\n            bio: 'Priya runs the daily standups and keeps the team on track. She\\'s great at explaining why features matter to the business.'\n          },\n          {\n            name: 'Alex',\n            role: 'QA Engineer',\n            personality: 'detail-oriented, finds edge cases, helpful',\n            expertise: ['testing', 'bug-reporting', 'edge-cases', 'user-flows'],\n            availability: 'always',\n            bio: 'Alex catches bugs before they reach production. They\\'ll give you detailed bug reports and help you understand what went wrong.'\n          },\n          {\n            name: 'Jordan',\n            role: 'Fellow Intern',\n            personality: 'eager, occasionally asks for help, peer support',\n            expertise: ['React', 'learning', 'asking-questions'],\n            availability: 'always',\n            bio: 'Jordan started 2 weeks before you. They remember what it\\'s like to be new and are happy to share what they\\'ve learned.'\n          }\n        ],\n        requirements: {\n          scenario: 'intern-first-week',\n          project: {\n            name: 'Merchant Dashboard',\n            description: 'Admin panel where small business owners view their transactions, payouts, and account settings',\n            techStack: ['React', 'Node.js', 'PostgreSQL', 'TypeScript']\n          },\n          learningObjectives: [\n            'Navigate async communication (Slack, standups)',\n            'Understand team roles and who to ask for what',\n            'Follow a ticket from assignment to merge',\n            'Handle code review feedback gracefully',\n            'Ask good questions'\n          ],\n          dailyStructure: [\n            {\n              day: 1,\n              theme: 'Welcome aboard',\n              activities: ['Read onboarding docs', 'Meet the team in 1:1 chats', 'Comprehension check with Sarah'],\n              overnightEvent: 'Priya assigns first ticket'\n            },\n            {\n              day: 2,\n              theme: 'Your first ticket',\n              activities: ['Read ticket', 'Ask clarifying questions', 'Start working', 'Push initial commit'],\n              overnightEvent: 'Sarah leaves code review comments'\n            },\n            {\n              day: 3,\n              theme: 'Code review culture',\n              activities: ['Address PR feedback', 'Learn review etiquette', 'Push revision'],\n              overnightEvent: 'Alex reports edge case bug'\n            },\n            {\n              day: 4,\n              theme: 'Documentation',\n              activities: ['Write README section', 'Submit for review', 'Revise based on feedback'],\n              overnightEvent: 'Alex assigns bug ticket'\n            },\n            {\n              day: 5,\n              theme: 'Bug fix + wrap-up',\n              activities: ['Debug and fix issue', 'Get feedback from Alex', 'Final 1:1 evaluation with Sarah'],\n              overnightEvent: null\n            }\n          ]\n        },\n        scenarioScript: {\n          onboarding: [\n            { from: 'Priya', time: 1, message: 'Welcome to NovaPay!  I\\'m Priya, the PM for the Merchant Dashboard team. Take your time getting settled - Sarah will walk you through everything.' },\n            { from: 'Sarah', time: 2, message: 'Hey! Welcome aboard. I\\'ll be your main point of contact this week. Let\\'s do quick 1:1s with everyone so you can put faces to names. Start by reading the project README, and then we\\'ll chat about what you understood.' },\n            { from: 'Jordan', time: 3, message: 'Hey! I\\'m Jordan, also an intern here. Started 2 weeks ago. If you have any \"dumb questions\" you don\\'t want to ask Sarah, feel free to ping me ' }\n          ],\n          firstTicket: [\n            { from: 'Priya', time: 1, message: 'Good morning! I\\'ve assigned your first ticket: fixing a timezone display bug in the transaction list. It\\'s a small one - perfect for getting familiar with the codebase.' },\n            { from: 'Marcus', time: 5, message: 'The timezone logic is in utils/formatDate.js if you need it. Let me know if you get stuck.' }\n          ],\n          codeReview: [\n            { from: 'Sarah', time: 1, message: 'Nice work on the fix! I left a couple of comments on your PR. Nothing major - just some suggestions for optimization. Take a look when you get a chance.' }\n          ],\n          documentation: [\n            { from: 'Sarah', time: 1, message: 'Today I\\'d like you to update the README with local testing instructions. It\\'s a great way to solidify your understanding of the dev environment.' }\n          ],\n          bugFix: [\n            { from: 'Alex', time: 1, message: 'Found an edge case! When merchants select \"Last 7 days\" in UTC+12, we\\'re showing 8 days. Screenshot attached. Can you take a look?' }\n          ]\n        },\n        difficulty: 'intern',\n        estimatedDuration: 30\n      }\n    ];\n\n    for (const project of projects) {\n      await this.createWorkspaceProject(project);\n    }\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.username === username);\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.email === email);\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = this.currentUserId++;\n    const user: User = { \n      ...insertUser, \n      id,\n      createdAt: new Date()\n    };\n    this.users.set(id, user);\n    \n    // Also sync user to database for foreign key constraints (interview_sessions, etc.)\n    try {\n      await db.insert(users).values({\n        id: user.id,\n        username: user.username,\n        password: user.password,\n        email: user.email,\n        firstName: user.firstName,\n        lastName: user.lastName,\n      }).onConflictDoNothing();\n    } catch (error) {\n      console.log('User already exists in database or sync failed:', error);\n    }\n    \n    return user;\n  }\n\n  async getSimulationSession(id: number): Promise<SimulationSession | undefined> {\n    // Check memory first\n    const memorySession = this.sessions.get(id);\n    if (memorySession) return memorySession;\n    \n    // Fallback to database\n    try {\n      const [dbSession] = await db.select().from(simulationSessions).where(eq(simulationSessions.id, id));\n      if (dbSession) {\n        // Cache in memory\n        this.sessions.set(dbSession.id, dbSession);\n        return dbSession;\n      }\n    } catch (error) {\n      console.error('Failed to fetch session from database:', error);\n    }\n    return undefined;\n  }\n\n  async getUserSimulationSessions(userId: number, type?: string): Promise<SimulationSession[]> {\n    return Array.from(this.sessions.values())\n      .filter(session => session.userId === userId && (!type || session.type === type))\n      .sort((a, b) => b.startedAt.getTime() - a.startedAt.getTime());\n  }\n\n  async createSimulationSession(insertSession: InsertSimulationSession): Promise<SimulationSession> {\n    // Insert into database first to get a valid ID for foreign key references\n    try {\n      const [dbSession] = await db.insert(simulationSessions).values({\n        userId: insertSession.userId,\n        type: insertSession.type,\n        status: insertSession.status || 'active',\n        configuration: insertSession.configuration,\n        messages: insertSession.messages || [],\n      }).returning();\n      \n      const session: SimulationSession = {\n        ...dbSession,\n        startedAt: dbSession.startedAt,\n        completedAt: dbSession.completedAt,\n        score: dbSession.score,\n        feedback: dbSession.feedback,\n        duration: dbSession.duration\n      };\n      \n      // Also store in memory for fast access\n      this.sessions.set(session.id, session);\n      return session;\n    } catch (error) {\n      console.error('Failed to create session in database:', error);\n      // Fallback to memory-only (will break FK constraints for workspace_progress)\n      const id = this.currentSessionId++;\n      const session: SimulationSession = {\n        ...insertSession,\n        id,\n        startedAt: new Date(),\n        completedAt: null,\n        score: null,\n        feedback: null,\n        duration: null,\n        status: insertSession.status || 'active',\n        messages: insertSession.messages || []\n      };\n      this.sessions.set(id, session);\n      return session;\n    }\n  }\n\n  async updateSimulationSession(id: number, updates: Partial<SimulationSession>): Promise<SimulationSession | undefined> {\n    const session = await this.getSimulationSession(id);\n    if (!session) return undefined;\n    \n    const updatedSession = { ...session, ...updates };\n    this.sessions.set(id, updatedSession);\n    \n    // Also update in database\n    try {\n      await db.update(simulationSessions).set(updates).where(eq(simulationSessions.id, id));\n    } catch (error) {\n      console.error('Failed to update session in database:', error);\n    }\n    \n    return updatedSession;\n  }\n\n  async getUserProgress(userId: number): Promise<UserProgress[]> {\n    return Array.from(this.progress.values())\n      .filter(p => p.userId === userId);\n  }\n\n  async getUserProgressByType(userId: number, type: string): Promise<UserProgress | undefined> {\n    return this.progress.get(`${userId}-${type}`);\n  }\n\n  async createUserProgress(insertProgress: InsertUserProgress): Promise<UserProgress> {\n    const id = this.currentProgressId++;\n    const progress: UserProgress = {\n      ...insertProgress,\n      id,\n      totalSessions: insertProgress.totalSessions || 0,\n      completedSessions: insertProgress.completedSessions || 0,\n      totalTime: insertProgress.totalTime || 0,\n      averageScore: insertProgress.averageScore || null,\n      lastSessionAt: null\n    };\n    this.progress.set(`${progress.userId}-${progress.simulationType}`, progress);\n    return progress;\n  }\n\n  async updateUserProgress(userId: number, type: string, updates: Partial<UserProgress>): Promise<UserProgress | undefined> {\n    const key = `${userId}-${type}`;\n    const progress = this.progress.get(key);\n    if (!progress) return undefined;\n    \n    const updatedProgress = { ...progress, ...updates };\n    this.progress.set(key, updatedProgress);\n    return updatedProgress;\n  }\n\n  // Workspace project operations\n  async getWorkspaceProjects(): Promise<WorkspaceProject[]> {\n    // Query from database to ensure we get all projects\n    try {\n      const dbProjects = await db.select().from(workspaceProjects);\n      return dbProjects;\n    } catch (error) {\n      console.error('Failed to get workspace projects from database:', error);\n      return Array.from(this.workspaceProjects.values());\n    }\n  }\n\n  async getWorkspaceProject(id: number): Promise<WorkspaceProject | undefined> {\n    // Query from database first\n    try {\n      const [dbProject] = await db.select().from(workspaceProjects).where(eq(workspaceProjects.id, id));\n      return dbProject;\n    } catch (error) {\n      console.error('Failed to get workspace project from database:', error);\n      return this.workspaceProjects.get(id);\n    }\n  }\n\n  async createWorkspaceProject(insertProject: InsertWorkspaceProject): Promise<WorkspaceProject> {\n    // Insert into database first to get a valid ID for foreign key references\n    try {\n      const [dbProject] = await db.insert(workspaceProjects).values({\n        name: insertProject.name,\n        description: insertProject.description,\n        difficulty: insertProject.difficulty,\n        category: insertProject.category,\n        estimatedDuration: insertProject.estimatedDuration,\n        techStack: insertProject.techStack,\n        teamStructure: insertProject.teamStructure,\n        requirements: insertProject.requirements,\n        scenarioScript: insertProject.scenarioScript || null\n      }).returning();\n      \n      // Also store in memory for fast access\n      this.workspaceProjects.set(dbProject.id, dbProject);\n      return dbProject;\n    } catch (error) {\n      console.error('Failed to create workspace project in database:', error);\n      // Fallback to memory-only\n      const id = this.currentProjectId++;\n      const project: WorkspaceProject = {\n        ...insertProject,\n        id,\n        scenarioScript: insertProject.scenarioScript || null,\n        createdAt: new Date()\n      };\n      this.workspaceProjects.set(id, project);\n      return project;\n    }\n  }\n\n  // Workspace role operations\n  async getWorkspaceRoles(): Promise<WorkspaceRole[]> {\n    return Array.from(this.workspaceRoles.values());\n  }\n\n  async getWorkspaceRole(id: number): Promise<WorkspaceRole | undefined> {\n    return this.workspaceRoles.get(id);\n  }\n\n  async createWorkspaceRole(insertRole: InsertWorkspaceRole): Promise<WorkspaceRole> {\n    const id = this.currentRoleId++;\n    const role: WorkspaceRole = {\n      ...insertRole,\n      id,\n      createdAt: new Date()\n    };\n    this.workspaceRoles.set(id, role);\n    return role;\n  }\n\n  // Workspace artifact operations\n  async getWorkspaceArtifacts(sessionId: number): Promise<WorkspaceArtifact[]> {\n    return Array.from(this.workspaceArtifacts.values())\n      .filter(artifact => artifact.sessionId === sessionId)\n      .sort((a, b) => b.updatedAt.getTime() - a.updatedAt.getTime());\n  }\n\n  async getWorkspaceArtifact(id: number): Promise<WorkspaceArtifact | undefined> {\n    return this.workspaceArtifacts.get(id);\n  }\n\n  async createWorkspaceArtifact(insertArtifact: InsertWorkspaceArtifact): Promise<WorkspaceArtifact> {\n    const id = this.currentArtifactId++;\n    const artifact: WorkspaceArtifact = {\n      ...insertArtifact,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n      assignedRole: insertArtifact.assignedRole || null,\n      metadata: insertArtifact.metadata || null,\n      versionHistory: insertArtifact.versionHistory || []\n    };\n    this.workspaceArtifacts.set(id, artifact);\n    return artifact;\n  }\n\n  async updateWorkspaceArtifact(id: number, updates: Partial<WorkspaceArtifact>): Promise<WorkspaceArtifact | undefined> {\n    const artifact = this.workspaceArtifacts.get(id);\n    if (!artifact) return undefined;\n    \n    const updatedArtifact = { \n      ...artifact, \n      ...updates,\n      updatedAt: new Date()\n    };\n    this.workspaceArtifacts.set(id, updatedArtifact);\n    return updatedArtifact;\n  }\n\n  // Workspace task operations\n  async getWorkspaceTasks(sessionId: number): Promise<WorkspaceTask[]> {\n    return Array.from(this.workspaceTasks.values())\n      .filter(task => task.sessionId === sessionId)\n      .sort((a, b) => b.updatedAt.getTime() - a.updatedAt.getTime());\n  }\n\n  async getWorkspaceTask(id: number): Promise<WorkspaceTask | undefined> {\n    return this.workspaceTasks.get(id);\n  }\n\n  async createWorkspaceTask(insertTask: InsertWorkspaceTask): Promise<WorkspaceTask> {\n    const id = this.currentTaskId++;\n    const task: WorkspaceTask = {\n      ...insertTask,\n      id,\n      status: insertTask.status || 'todo',\n      priority: insertTask.priority || 'medium',\n      assignedRole: insertTask.assignedRole || null,\n      complexity: insertTask.complexity || null,\n      dependencies: insertTask.dependencies || [],\n      artifactId: insertTask.artifactId || null,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.workspaceTasks.set(id, task);\n    return task;\n  }\n\n  async updateWorkspaceTask(id: number, updates: Partial<WorkspaceTask>): Promise<WorkspaceTask | undefined> {\n    const task = this.workspaceTasks.get(id);\n    if (!task) return undefined;\n    \n    const updatedTask = { \n      ...task, \n      ...updates,\n      updatedAt: new Date()\n    };\n    this.workspaceTasks.set(id, updatedTask);\n    return updatedTask;\n  }\n\n  // Workspace interaction operations - Using PostgreSQL database for persistence\n  async getWorkspaceInteractions(sessionId: number, channel?: string): Promise<WorkspaceInteraction[]> {\n    if (channel) {\n      return await db.select()\n        .from(workspaceInteractions)\n        .where(and(\n          eq(workspaceInteractions.sessionId, sessionId),\n          eq(workspaceInteractions.channel, channel)\n        ))\n        .orderBy(workspaceInteractions.createdAt);\n    }\n    return await db.select()\n      .from(workspaceInteractions)\n      .where(eq(workspaceInteractions.sessionId, sessionId))\n      .orderBy(workspaceInteractions.createdAt);\n  }\n\n  async createWorkspaceInteraction(insertInteraction: InsertWorkspaceInteraction): Promise<WorkspaceInteraction> {\n    const [interaction] = await db.insert(workspaceInteractions)\n      .values({\n        sessionId: insertInteraction.sessionId,\n        channel: insertInteraction.channel,\n        sender: insertInteraction.sender,\n        senderRole: insertInteraction.senderRole,\n        content: insertInteraction.content,\n        metadata: insertInteraction.metadata || null,\n        threadId: insertInteraction.threadId || null\n      })\n      .returning();\n    return interaction;\n  }\n\n  // Workspace evaluation operations\n  async getWorkspaceEvaluations(sessionId: number): Promise<WorkspaceEvaluation[]> {\n    return Array.from(this.workspaceEvaluations.values())\n      .filter(evaluation => evaluation.sessionId === sessionId)\n      .sort((a, b) => a.createdAt.getTime() - b.createdAt.getTime());\n  }\n\n  async createWorkspaceEvaluation(insertEvaluation: InsertWorkspaceEvaluation): Promise<WorkspaceEvaluation> {\n    const id = this.currentEvaluationId++;\n    const evaluation: WorkspaceEvaluation = {\n      ...insertEvaluation,\n      id,\n      collaborationScore: insertEvaluation.collaborationScore || null,\n      deliveryScore: insertEvaluation.deliveryScore || null,\n      communicationScore: insertEvaluation.communicationScore || null,\n      feedback: insertEvaluation.feedback || null,\n      createdAt: new Date()\n    };\n    this.workspaceEvaluations.set(id, evaluation);\n    return evaluation;\n  }\n\n  // Interview session operations - Using PostgreSQL database for persistence\n  async getInterviewSession(id: number): Promise<InterviewSession | undefined> {\n    const [session] = await db.select().from(interviewSessions).where(eq(interviewSessions.id, id));\n    return session || undefined;\n  }\n\n  async getUserInterviewSessions(userId: number, mode?: 'practice' | 'journey'): Promise<InterviewSession[]> {\n    if (mode) {\n      return await db.select()\n        .from(interviewSessions)\n        .where(and(\n          eq(interviewSessions.userId, userId),\n          eq(interviewSessions.mode, mode)\n        ))\n        .orderBy(desc(interviewSessions.startedAt));\n    }\n    return await db.select()\n      .from(interviewSessions)\n      .where(eq(interviewSessions.userId, userId))\n      .orderBy(desc(interviewSessions.startedAt));\n  }\n\n  async createInterviewSession(insertSession: InsertInterviewSession): Promise<InterviewSession> {\n    const [session] = await db.insert(interviewSessions)\n      .values({\n        ...insertSession,\n        difficulty: insertSession.difficulty || \"medium\",\n        status: insertSession.status || \"in_progress\",\n        currentQuestionIndex: insertSession.currentQuestionIndex || 0,\n        totalQuestions: insertSession.totalQuestions || 5,\n      })\n      .returning();\n    return session;\n  }\n\n  async updateInterviewSession(id: number, updates: Partial<InterviewSession>): Promise<InterviewSession | undefined> {\n    const [updated] = await db.update(interviewSessions)\n      .set(updates)\n      .where(eq(interviewSessions.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  // Interview question operations - Using PostgreSQL database for persistence\n  async getInterviewQuestion(id: number): Promise<InterviewQuestion | undefined> {\n    const [question] = await db.select().from(interviewQuestions).where(eq(interviewQuestions.id, id));\n    if (!question) return undefined;\n    // Normalize jsonb arrays to ensure they're always arrays\n    return {\n      ...question,\n      strengths: Array.isArray(question.strengths) ? question.strengths : [],\n      improvements: Array.isArray(question.improvements) ? question.improvements : [],\n    };\n  }\n\n  async getInterviewQuestions(sessionId: number): Promise<InterviewQuestion[]> {\n    const questions = await db.select()\n      .from(interviewQuestions)\n      .where(eq(interviewQuestions.sessionId, sessionId))\n      .orderBy(interviewQuestions.questionIndex);\n    \n    // Normalize jsonb arrays to ensure they're always arrays\n    return questions.map(q => ({\n      ...q,\n      strengths: Array.isArray(q.strengths) ? q.strengths : [],\n      improvements: Array.isArray(q.improvements) ? q.improvements : [],\n    }));\n  }\n\n  async createInterviewQuestion(insertQuestion: InsertInterviewQuestion): Promise<InterviewQuestion> {\n    const [question] = await db.insert(interviewQuestions)\n      .values({\n        ...insertQuestion,\n        strengths: insertQuestion.strengths || [],\n        improvements: insertQuestion.improvements || [],\n      })\n      .returning();\n    return question;\n  }\n\n  async updateInterviewQuestion(id: number, updates: Partial<InterviewQuestion>): Promise<InterviewQuestion | undefined> {\n    const [updated] = await db.update(interviewQuestions)\n      .set(updates)\n      .where(eq(interviewQuestions.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  // Interview feedback operations - Using PostgreSQL database for persistence\n  async getInterviewFeedback(sessionId: number): Promise<InterviewFeedback | undefined> {\n    const [feedback] = await db.select()\n      .from(interviewFeedback)\n      .where(eq(interviewFeedback.sessionId, sessionId));\n    if (!feedback) return undefined;\n    // Normalize jsonb arrays to ensure they're always arrays\n    return {\n      ...feedback,\n      strengths: Array.isArray(feedback.strengths) ? feedback.strengths : [],\n      improvements: Array.isArray(feedback.improvements) ? feedback.improvements : [],\n      recommendations: Array.isArray(feedback.recommendations) ? feedback.recommendations : [],\n    };\n  }\n\n  async createInterviewFeedback(insertFeedback: InsertInterviewFeedback): Promise<InterviewFeedback> {\n    const [feedback] = await db.insert(interviewFeedback)\n      .values(insertFeedback)\n      .returning();\n    return feedback;\n  }\n\n  // Company operations - DATABASE PERSISTED\n  async getCompanies(): Promise<Company[]> {\n    return await db.select().from(companies);\n  }\n\n  async getCompany(id: number): Promise<Company | undefined> {\n    const results = await db.select().from(companies)\n      .where(eq(companies.id, id));\n    return results[0];\n  }\n\n  async createCompany(insertCompany: InsertCompany): Promise<Company> {\n    const results = await db.insert(companies).values({\n      ...insertCompany,\n      logo: insertCompany.logo || null,\n      values: insertCompany.values || [],\n      benefits: insertCompany.benefits || [],\n      interviewStyle: insertCompany.interviewStyle || 'balanced',\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // Job posting operations - DATABASE PERSISTED\n  async getJobPostings(filters?: { companyId?: number; role?: string; isActive?: boolean }): Promise<JobPosting[]> {\n    let results = await db.select().from(jobPostings);\n    if (filters?.companyId) {\n      results = results.filter(p => p.companyId === filters.companyId);\n    }\n    if (filters?.role) {\n      results = results.filter(p => p.role === filters.role);\n    }\n    if (filters?.isActive !== undefined) {\n      results = results.filter(p => p.isActive === filters.isActive);\n    }\n    return results;\n  }\n\n  async getJobPosting(id: number): Promise<JobPosting | undefined> {\n    const results = await db.select().from(jobPostings)\n      .where(eq(jobPostings.id, id));\n    return results[0];\n  }\n\n  async getJobPostingWithCompany(id: number): Promise<(JobPosting & { company: Company }) | undefined> {\n    const postingResults = await db.select().from(jobPostings)\n      .where(eq(jobPostings.id, id));\n    const posting = postingResults[0];\n    if (!posting) return undefined;\n    const company = await this.getCompany(posting.companyId);\n    if (!company) return undefined;\n    return { ...posting, company };\n  }\n\n  async createJobPosting(insertPosting: InsertJobPosting): Promise<JobPosting> {\n    const results = await db.insert(jobPostings).values({\n      ...insertPosting,\n      employmentType: insertPosting.employmentType || 'full-time',\n      salaryMin: insertPosting.salaryMin || null,\n      salaryMax: insertPosting.salaryMax || null,\n      responsibilities: insertPosting.responsibilities || [],\n      requirements: insertPosting.requirements || [],\n      niceToHave: insertPosting.niceToHave || [],\n      highlightedTerms: insertPosting.highlightedTerms || [],\n      interviewStages: insertPosting.interviewStages || 3,\n      isActive: insertPosting.isActive !== false,\n      postedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // Job glossary operations\n  async getJobGlossary(): Promise<JobGlossary[]> {\n    return Array.from(this.jobGlossaryMap.values());\n  }\n\n  async getJobGlossaryTerm(term: string): Promise<JobGlossary | undefined> {\n    return Array.from(this.jobGlossaryMap.values()).find(t => t.term.toLowerCase() === term.toLowerCase());\n  }\n\n  async createJobGlossaryTerm(insertTerm: InsertJobGlossary): Promise<JobGlossary> {\n    const id = this.currentJobGlossaryId++;\n    const glossaryTerm: JobGlossary = {\n      ...insertTerm,\n      id,\n      category: insertTerm.category || null,\n      relatedTerms: insertTerm.relatedTerms || []\n    };\n    this.jobGlossaryMap.set(id, glossaryTerm);\n    return glossaryTerm;\n  }\n\n  // Job application operations - DATABASE PERSISTED\n  async getJobApplications(userId: number): Promise<JobApplication[]> {\n    const results = await db.select().from(jobApplications)\n      .where(eq(jobApplications.userId, userId))\n      .orderBy(desc(jobApplications.createdAt));\n    return results;\n  }\n\n  async getJobApplicationsWithDetails(userId: number): Promise<Array<JobApplication & { job: JobPosting & { company: Company }, stages: ApplicationStage[] }>> {\n    const applications = await db.select().from(jobApplications)\n      .where(eq(jobApplications.userId, userId))\n      .orderBy(desc(jobApplications.createdAt));\n    \n    if (applications.length === 0) {\n      return [];\n    }\n\n    const applicationIds = applications.map(app => app.id);\n    const jobPostingIds = applications.map(app => app.jobPostingId);\n\n    const [jobPostingsResults, stagesResults] = await Promise.all([\n      db.select().from(jobPostings)\n        .innerJoin(companies, eq(jobPostings.companyId, companies.id))\n        .where(inArray(jobPostings.id, jobPostingIds)),\n      db.select().from(applicationStages)\n        .where(inArray(applicationStages.applicationId, applicationIds))\n        .orderBy(applicationStages.stageOrder)\n    ]);\n\n    const jobPostingsMap = new Map(\n      jobPostingsResults.map(result => [\n        result.job_postings.id,\n        { ...result.job_postings, company: result.companies }\n      ])\n    );\n\n    const stagesByApplicationId = new Map<number, ApplicationStage[]>();\n    for (const stage of stagesResults) {\n      const stages = stagesByApplicationId.get(stage.applicationId) || [];\n      stages.push(stage);\n      stagesByApplicationId.set(stage.applicationId, stages);\n    }\n\n    return applications.map(app => ({\n      ...app,\n      job: jobPostingsMap.get(app.jobPostingId)!,\n      stages: stagesByApplicationId.get(app.id) || []\n    }));\n  }\n\n  async getJobApplication(id: number): Promise<JobApplication | undefined> {\n    const results = await db.select().from(jobApplications)\n      .where(eq(jobApplications.id, id));\n    return results[0];\n  }\n\n  async createJobApplication(insertApplication: InsertJobApplication): Promise<JobApplication> {\n    const results = await db.insert(jobApplications).values({\n      ...insertApplication,\n      status: insertApplication.status || 'draft',\n      cvFileName: insertApplication.cvFileName || null,\n      cvContent: insertApplication.cvContent || null,\n      coverLetter: insertApplication.coverLetter || null,\n      currentStageIndex: insertApplication.currentStageIndex || 0,\n      hrContactedAt: insertApplication.hrContactedAt || null,\n      offerDetails: insertApplication.offerDetails || null,\n      notes: insertApplication.notes || null,\n      appliedAt: insertApplication.appliedAt || null,\n      updatedAt: new Date(),\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateJobApplication(id: number, updates: Partial<JobApplication>): Promise<JobApplication | undefined> {\n    const results = await db.update(jobApplications)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(jobApplications.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Interview template operations\n  async getInterviewTemplates(companyId?: number, role?: string): Promise<InterviewTemplate[]> {\n    let templates = Array.from(this.interviewTemplatesMap.values());\n    if (companyId) {\n      templates = templates.filter(t => t.companyId === companyId || t.companyId === null);\n    }\n    if (role) {\n      templates = templates.filter(t => t.role === role || t.role === null);\n    }\n    return templates;\n  }\n\n  async getInterviewTemplate(id: number): Promise<InterviewTemplate | undefined> {\n    return this.interviewTemplatesMap.get(id);\n  }\n\n  async createInterviewTemplate(insertTemplate: InsertInterviewTemplate): Promise<InterviewTemplate> {\n    const id = this.currentInterviewTemplateId++;\n    const template: InterviewTemplate = {\n      ...insertTemplate,\n      id,\n      companyId: insertTemplate.companyId || null,\n      role: insertTemplate.role || null,\n      totalDuration: insertTemplate.totalDuration || null,\n      createdAt: new Date()\n    };\n    this.interviewTemplatesMap.set(id, template);\n    return template;\n  }\n\n  // Application stage operations - DATABASE PERSISTED\n  async getApplicationStages(applicationId: number): Promise<ApplicationStage[]> {\n    const results = await db.select().from(applicationStages)\n      .where(eq(applicationStages.applicationId, applicationId))\n      .orderBy(applicationStages.stageOrder);\n    return results;\n  }\n\n  async getApplicationStage(id: number): Promise<ApplicationStage | undefined> {\n    const results = await db.select().from(applicationStages)\n      .where(eq(applicationStages.id, id));\n    return results[0];\n  }\n\n  async getApplicationStageByInterviewSession(interviewSessionId: number): Promise<ApplicationStage | undefined> {\n    const results = await db.select().from(applicationStages)\n      .where(eq(applicationStages.interviewSessionId, interviewSessionId));\n    return results[0];\n  }\n\n  async createApplicationStage(insertStage: InsertApplicationStage): Promise<ApplicationStage> {\n    const results = await db.insert(applicationStages).values({\n      ...insertStage,\n      status: insertStage.status || 'pending',\n      interviewSessionId: insertStage.interviewSessionId || null,\n      scheduledAt: insertStage.scheduledAt || null,\n      completedAt: insertStage.completedAt || null,\n      score: insertStage.score || null,\n      feedback: insertStage.feedback || null,\n      recruiterNotes: insertStage.recruiterNotes || null,\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateApplicationStage(id: number, updates: Partial<ApplicationStage>): Promise<ApplicationStage | undefined> {\n    const results = await db.update(applicationStages)\n      .set(updates)\n      .where(eq(applicationStages.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Workspace progress operations\n  async getWorkspaceProgress(userId: number, mode?: 'practice' | 'journey'): Promise<WorkspaceProgress[]> {\n    if (mode) {\n      const results = await db.select().from(workspaceProgress)\n        .where(and(\n          eq(workspaceProgress.userId, userId),\n          eq(workspaceProgress.mode, mode)\n        ))\n        .orderBy(desc(workspaceProgress.lastActivityAt));\n      return results;\n    }\n    const results = await db.select().from(workspaceProgress)\n      .where(eq(workspaceProgress.userId, userId))\n      .orderBy(desc(workspaceProgress.lastActivityAt));\n    return results;\n  }\n\n  async getWorkspaceProgressBySession(sessionId: number): Promise<WorkspaceProgress | undefined> {\n    const results = await db.select().from(workspaceProgress)\n      .where(eq(workspaceProgress.sessionId, sessionId));\n    return results[0];\n  }\n\n  async createWorkspaceProgress(insertProgress: InsertWorkspaceProgress): Promise<WorkspaceProgress> {\n    const results = await db.insert(workspaceProgress).values({\n      ...insertProgress,\n      mode: insertProgress.mode || 'journey',\n      currentDay: insertProgress.currentDay || 1,\n      dayProgress: insertProgress.dayProgress || {},\n      overallProgress: insertProgress.overallProgress || 0,\n      status: insertProgress.status || 'in_progress',\n      startedAt: new Date(),\n      lastActivityAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateWorkspaceProgress(id: number, updates: Partial<WorkspaceProgress>): Promise<WorkspaceProgress | undefined> {\n    const results = await db.update(workspaceProgress)\n      .set({\n        ...updates,\n        lastActivityAt: new Date()\n      })\n      .where(eq(workspaceProgress.id, id))\n      .returning();\n    return results[0];\n  }\n\n  async restartWorkspaceProgress(sessionId: number): Promise<WorkspaceProgress | undefined> {\n    const results = await db.update(workspaceProgress)\n      .set({\n        currentDay: 1,\n        dayProgress: {},\n        overallProgress: 0,\n        status: 'in_progress',\n        score: null,\n        completedAt: null,\n        lastActivityAt: new Date()\n      })\n      .where(eq(workspaceProgress.sessionId, sessionId))\n      .returning();\n    return results[0];\n  }\n\n  private async seedJobJourneyData() {\n    // Check if data already exists in database - skip seeding if so\n    const existingCompanies = await this.getCompanies();\n    if (existingCompanies.length > 0) {\n      console.log('Job journey data already exists in database, skipping seed...');\n      return;\n    }\n    \n    console.log('Seeding job journey data to database...');\n    \n    // Seed companies\n    const companySeedData = [\n      {\n        name: 'QuantumSphere Innovations',\n        logo: '',\n        industry: 'tech',\n        size: 'mid-size',\n        description: 'QuantumSphere Innovations is a cutting-edge AI and machine learning company building the next generation of intelligent enterprise solutions.',\n        culture: 'Innovation-driven culture with emphasis on experimentation and learning. We believe in failing fast and iterating quickly.',\n        values: ['Innovation', 'Collaboration', 'Transparency', 'Growth Mindset'],\n        benefits: ['Unlimited PTO', 'Remote-first', 'Learning budget $2,000/year', 'Health + dental', 'Stock options'],\n        interviewStyle: 'rigorous'\n      },\n      {\n        name: 'CyberVortex Technologies',\n        logo: '',\n        industry: 'tech',\n        size: 'startup',\n        description: 'CyberVortex Technologies is a fast-growing cybersecurity startup protecting enterprises from emerging digital threats.',\n        culture: 'Fast-paced, mission-driven team focused on making the internet safer. We work hard and celebrate wins together.',\n        values: ['Security First', 'Speed', 'Customer Obsession', 'Integrity'],\n        benefits: ['Competitive salary', 'Equity package', 'Flexible hours', 'Team offsites', 'Latest MacBook'],\n        interviewStyle: 'balanced'\n      },\n      {\n        name: 'NanoByte Dynamics',\n        logo: '',\n        industry: 'healthtech',\n        size: 'enterprise',\n        description: 'NanoByte Dynamics leverages nanotechnology and AI to revolutionize healthcare diagnostics and treatment.',\n        culture: 'Scientific rigor meets startup agility. Our diverse team includes PhDs, engineers, and healthcare professionals.',\n        values: ['Scientific Excellence', 'Patient Impact', 'Diversity', 'Ethical Innovation'],\n        benefits: ['Comprehensive healthcare', '401k matching', 'Parental leave', 'On-site gym', 'Research publications'],\n        interviewStyle: 'rigorous'\n      },\n      {\n        name: 'HyperSynth Innovations',\n        logo: '',\n        industry: 'fintech',\n        size: 'mid-size',\n        description: 'HyperSynth Innovations is transforming financial services with AI-powered trading and risk management solutions.',\n        culture: 'Data-driven decision making with a focus on continuous improvement. We value both individual excellence and team collaboration.',\n        values: ['Excellence', 'Data-Driven', 'Accountability', 'Innovation'],\n        benefits: ['Bonus structure', 'Stock options', 'Premium insurance', 'Gym membership', 'Conference budget'],\n        interviewStyle: 'rigorous'\n      },\n      {\n        name: 'NebulaForge Solutions',\n        logo: '',\n        industry: 'tech',\n        size: 'startup',\n        description: 'NebulaForge Solutions builds developer tools and cloud infrastructure that makes deploying applications effortless.',\n        culture: 'Developer-first company built by developers. We use our own tools daily and obsess over developer experience.',\n        values: ['Developer Experience', 'Simplicity', 'Open Source', 'Community'],\n        benefits: ['Remote-first', 'Unlimited PTO', 'Conference sponsorship', 'Home office budget', 'Async-friendly'],\n        interviewStyle: 'casual'\n      },\n      {\n        name: 'DataViz Pro',\n        logo: '',\n        industry: 'tech',\n        size: 'mid-size',\n        description: 'Enterprise-grade data analytics and visualization platform helping companies turn data chaos into actionable insights. DataViz Pro connects to 100+ data sources with real-time dashboards, AI-powered anomaly detection, and predictive forecasting.',\n        culture: 'Data-driven decision making with a focus on continuous improvement. We value both individual excellence and team collaboration. Fast-moving, innovative environment where ideas matter.',\n        values: ['Empower data democratization', 'Customer obsession', 'Bias for speed', 'Continuous learning', 'Inclusive excellence'],\n        benefits: ['Competitive salary + equity', 'Unlimited PTO', 'Health insurance (medical, dental, vision)', 'Learning budget $2k/year', 'Remote work flexibility', 'Team offsites 2x/year'],\n        interviewStyle: 'balanced'\n      },\n      // 42 London Block 1 Companies\n      {\n        name: 'NovaPay',\n        logo: '',\n        industry: 'fintech',\n        size: 'startup',\n        description: 'NovaPay is a fast-growing fintech startup building a payment platform for small businesses. We help merchants accept payments, manage transactions, and grow their business with simple, powerful tools.',\n        culture: 'Fast-paced but supportive. We move quickly but never break payments. Great place to learn - seniors love mentoring and everyone\\'s voice matters.',\n        values: ['Move fast, don\\'t break payments', 'Mentorship matters', 'Simple beats clever', 'Customer empathy'],\n        benefits: ['Competitive salary', 'Equity for all', 'Flexible hours', 'Learning budget', 'Team lunches'],\n        interviewStyle: 'casual'\n      }\n    ];\n\n    const createdCompanies: Company[] = [];\n    for (const company of companySeedData) {\n      createdCompanies.push(await this.createCompany(company));\n    }\n\n    // Seed job postings\n    const jobPostingSeedData = [\n      // QuantumSphere Innovations\n      {\n        companyId: createdCompanies[0].id,\n        title: 'Junior Project Manager',\n        role: 'pm',\n        seniority: 'junior',\n        department: 'Product',\n        location: 'Remote',\n        salaryMin: 70000,\n        salaryMax: 90000,\n        description: 'As an Associate Product Manager, you\\'ll support the end-to-end product development process, collaborating with cross-functional teams. Your role involves market research, roadmap maintenance, and coordination to ensure timely product delivery.',\n        responsibilities: [\n          'Collaborate with cross-functional teams to assist in the development and execution of product strategies',\n          'Conduct market research to identify trends, customer needs, and competitor activities',\n          'Assist in creating and maintaining product roadmaps, ensuring alignment with company objectives',\n          'Support the product lifecycle from ideation to launch, including product planning, development, and post-launch analysis'\n        ],\n        requirements: [\n          '1-2 years of experience in product management or related field',\n          'Strong analytical and problem-solving skills',\n          'Excellent communication and interpersonal abilities',\n          'Familiarity with agile methodologies'\n        ],\n        niceToHave: [\n          'MBA or relevant certification',\n          'Experience with product analytics tools',\n          'Technical background'\n        ],\n        highlightedTerms: ['cross-functional teams', 'product development process', 'roadmap'],\n        interviewStages: 3\n      },\n      // CyberVortex Technologies\n      {\n        companyId: createdCompanies[1].id,\n        title: 'Junior Project Manager',\n        role: 'pm',\n        seniority: 'junior',\n        department: 'Product',\n        location: 'San Francisco, CA (Hybrid)',\n        salaryMin: 75000,\n        salaryMax: 95000,\n        description: 'Join our growing product team to help shape the future of cybersecurity. You\\'ll work closely with engineering and design to deliver features that protect millions of users.',\n        responsibilities: [\n          'Define and prioritize product features based on customer feedback and market analysis',\n          'Work with UX designers to create intuitive security interfaces',\n          'Coordinate with engineering on sprint planning and delivery',\n          'Track product metrics and report on KPIs'\n        ],\n        requirements: [\n          'Bachelor\\'s degree in Business, Computer Science, or related field',\n          'Understanding of software development lifecycle',\n          'Strong written and verbal communication skills',\n          'Ability to work in a fast-paced startup environment'\n        ],\n        highlightedTerms: ['sprint planning', 'KPIs', 'product metrics'],\n        interviewStages: 3\n      },\n      // NanoByte Dynamics\n      {\n        companyId: createdCompanies[2].id,\n        title: 'Mid Project Manager',\n        role: 'pm',\n        seniority: 'mid',\n        department: 'Product',\n        location: 'Boston, MA',\n        salaryMin: 100000,\n        salaryMax: 130000,\n        description: 'Lead product initiatives at the intersection of healthcare and technology. Drive products that have direct impact on patient outcomes.',\n        responsibilities: [\n          'Own product strategy for key diagnostic platform features',\n          'Partner with clinical and engineering teams to ensure regulatory compliance',\n          'Conduct user research with healthcare professionals',\n          'Define success metrics and monitor product performance'\n        ],\n        requirements: [\n          '3-5 years of product management experience',\n          'Experience in healthcare or regulated industries preferred',\n          'Strong stakeholder management skills',\n          'Data-driven decision making approach'\n        ],\n        highlightedTerms: ['regulatory compliance', 'stakeholder management', 'product strategy'],\n        interviewStages: 4\n      },\n      // HyperSynth Innovations\n      {\n        companyId: createdCompanies[3].id,\n        title: 'Senior Project Manager',\n        role: 'pm',\n        seniority: 'senior',\n        department: 'Product',\n        location: 'New York, NY',\n        salaryMin: 140000,\n        salaryMax: 180000,\n        description: 'Lead product strategy for our flagship AI trading platform. You\\'ll work with quants, engineers, and business stakeholders to define the future of algorithmic trading.',\n        responsibilities: [\n          'Define product vision and roadmap for trading platform features',\n          'Partner with quantitative research team on feature prioritization',\n          'Lead cross-functional teams through complex product launches',\n          'Present to C-level executives on product strategy and performance'\n        ],\n        requirements: [\n          '5+ years of product management experience',\n          'Fintech or trading platform experience strongly preferred',\n          'Strong analytical and quantitative skills',\n          'Experience with agile methodologies at scale'\n        ],\n        highlightedTerms: ['product vision', 'C-level', 'algorithmic trading'],\n        interviewStages: 5\n      },\n      // NebulaForge Solutions\n      {\n        companyId: createdCompanies[4].id,\n        title: 'Junior Project Manager',\n        role: 'pm',\n        seniority: 'junior',\n        department: 'Product',\n        location: 'Remote',\n        salaryMin: 65000,\n        salaryMax: 85000,\n        description: 'Help shape developer tools that thousands of engineers use daily. Perfect for someone who loves developer experience and wants to learn product management.',\n        responsibilities: [\n          'Gather and synthesize feedback from developer community',\n          'Write product specs and user stories',\n          'Work with engineering to ship features iteratively',\n          'Contribute to product documentation and changelog'\n        ],\n        requirements: [\n          'Technical background or strong technical aptitude',\n          'Passion for developer tools and experience',\n          'Strong writing skills',\n          'Self-motivated and comfortable with ambiguity'\n        ],\n        highlightedTerms: ['user stories', 'developer experience', 'product specs'],\n        interviewStages: 3\n      },\n      // Software Developer positions\n      {\n        companyId: createdCompanies[0].id,\n        title: 'Senior Software Engineer',\n        role: 'developer',\n        seniority: 'senior',\n        department: 'Engineering',\n        location: 'Remote',\n        salaryMin: 150000,\n        salaryMax: 200000,\n        description: 'Build the core AI infrastructure powering our enterprise solutions. Work with cutting-edge ML technologies and distributed systems.',\n        responsibilities: [\n          'Design and implement scalable backend services',\n          'Lead technical architecture decisions',\n          'Mentor junior engineers',\n          'Collaborate with ML team on model deployment'\n        ],\n        requirements: [\n          '5+ years of software engineering experience',\n          'Strong experience with Python, Go, or Java',\n          'Experience with distributed systems',\n          'Cloud platform experience (AWS/GCP/Azure)'\n        ],\n        highlightedTerms: ['distributed systems', 'ML technologies', 'technical architecture'],\n        interviewStages: 5\n      },\n      {\n        companyId: createdCompanies[1].id,\n        title: 'Mid-Level Software Engineer',\n        role: 'developer',\n        seniority: 'mid',\n        department: 'Engineering',\n        location: 'San Francisco, CA (Hybrid)',\n        salaryMin: 120000,\n        salaryMax: 160000,\n        description: 'Build secure, reliable systems that protect our customers from cyber threats. Work on challenging problems in network security and threat detection.',\n        responsibilities: [\n          'Develop and maintain security monitoring systems',\n          'Implement threat detection algorithms',\n          'Participate in code reviews and security audits',\n          'On-call rotation for critical security incidents'\n        ],\n        requirements: [\n          '3-5 years of software development experience',\n          'Experience with security tools and practices',\n          'Proficiency in Python or Rust',\n          'Understanding of network protocols'\n        ],\n        highlightedTerms: ['threat detection', 'security monitoring', 'code reviews'],\n        interviewStages: 4\n      },\n      // DataViz Pro - Product Manager\n      {\n        companyId: createdCompanies[5].id,\n        title: 'Senior Product Manager',\n        role: 'pm',\n        seniority: 'senior',\n        department: 'Product',\n        location: 'San Francisco, CA (Remote-friendly)',\n        salaryMin: 180000,\n        salaryMax: 250000,\n        description: 'Lead product strategy for DataViz Pro\\'s core platform. Work across AI/ML-powered analytics features, connecting 100+ data sources, and real-time dashboards. Drive decisions that impact thousands of enterprise customers.',\n        responsibilities: [\n          'Own product roadmap for AI Insights v2.0 and data connector ecosystem',\n          'Conduct user research with enterprise data teams and executives',\n          'Define success metrics and track feature adoption',\n          'Lead cross-functional collaboration with engineering, data science, and design'\n        ],\n        requirements: [\n          '5+ years of product management in SaaS/enterprise',\n          'Experience with data products or analytics platforms',\n          'Strong business acumen and metrics-driven thinking',\n          'Ability to communicate complex technical concepts'\n        ],\n        niceToHave: [\n          'Experience with machine learning or data science',\n          'Background in data analytics or business intelligence',\n          'Knowledge of enterprise sales cycles'\n        ],\n        highlightedTerms: ['enterprise customers', 'AI-powered analytics', 'data-driven', 'product roadmap', 'cross-functional'],\n        interviewStages: 5\n      },\n      // DataViz Pro - Senior Backend Engineer\n      {\n        companyId: createdCompanies[5].id,\n        title: 'Senior Backend Engineer',\n        role: 'developer',\n        seniority: 'senior',\n        department: 'Engineering',\n        location: 'Remote',\n        salaryMin: 180000,\n        salaryMax: 250000,\n        description: 'Design and build scalable backend infrastructure for real-time data processing. Lead technical decisions on our data connector APIs, aggregation engine, and analytics pipeline handling 100+ concurrent customers.',\n        responsibilities: [\n          'Architect API infrastructure for 100+ data source connectors',\n          'Optimize query performance and data aggregation at scale',\n          'Lead system design decisions and technical reviews',\n          'Mentor junior engineers and establish best practices'\n        ],\n        requirements: [\n          '5+ years backend development at scale',\n          'Proficiency in TypeScript/Node.js, Go, or Python',\n          'Experience with PostgreSQL, caching layers, and distributed systems',\n          'Strong understanding of data pipeline architecture'\n        ],\n        niceToHave: [\n          'Experience building data connectors or ETL pipelines',\n          'Knowledge of analytics databases (ClickHouse, Snowflake)',\n          'Experience with Kubernetes or container orchestration'\n        ],\n        highlightedTerms: ['distributed systems', 'data pipeline', 'API architecture', 'PostgreSQL', 'system design'],\n        interviewStages: 5\n      },\n      // DataViz Pro - Data Scientist\n      {\n        companyId: createdCompanies[5].id,\n        title: 'Senior Data Scientist',\n        role: 'data-scientist',\n        seniority: 'senior',\n        department: 'Data Science',\n        location: 'Remote',\n        salaryMin: 180000,\n        salaryMax: 250000,\n        description: 'Lead development of AI/ML features for anomaly detection and predictive forecasting. Build models that help enterprises find insights in their data and predict future trends.',\n        responsibilities: [\n          'Design and train machine learning models for anomaly detection and forecasting',\n          'Collaborate with engineers to integrate models into production systems',\n          'Conduct A/B tests and measure model performance in production',\n          'Research and evaluate emerging AI/ML techniques for analytics'\n        ],\n        requirements: [\n          '5+ years experience in machine learning and data science',\n          'Strong expertise in Python, scikit-learn, TensorFlow, or PyTorch',\n          'Experience with statistical analysis and hypothesis testing',\n          'Ability to communicate findings to non-technical stakeholders'\n        ],\n        niceToHave: [\n          'Experience with time-series forecasting models',\n          'Knowledge of production ML systems and MLOps',\n          'Background in data engineering or analytics',\n          'Familiarity with real-time model serving'\n        ],\n        highlightedTerms: ['machine learning', 'anomaly detection', 'forecasting', 'A/B testing', 'model training'],\n        interviewStages: 5\n      },\n      // NovaPay - Software Engineering Intern (42 London Block 1)\n      {\n        companyId: createdCompanies[6].id,\n        title: 'Software Engineering Intern',\n        role: 'developer',\n        seniority: 'intern',\n        department: 'Engineering',\n        location: 'London, UK (Hybrid)',\n        salaryMin: 25000,\n        salaryMax: 30000,\n        description: 'Join NovaPay\\'s engineering team as an intern and get hands-on experience building payment infrastructure. You\\'ll work alongside senior engineers, participate in code reviews, and contribute to real features used by thousands of merchants. Perfect for coding bootcamp students ready to experience professional software development.',\n        responsibilities: [\n          'Contribute to the Merchant Dashboard - our React-based admin panel',\n          'Fix bugs and implement small features with guidance from senior engineers',\n          'Participate in daily standups and team rituals',\n          'Write clean, tested code following our engineering standards',\n          'Learn Git workflows, code review practices, and agile development'\n        ],\n        requirements: [\n          'Currently enrolled in a coding bootcamp or computer science program',\n          'Basic understanding of programming concepts (variables, loops, functions)',\n          'Familiarity with Git and command line basics',\n          'Eagerness to learn and receive feedback',\n          'Strong communication skills'\n        ],\n        niceToHave: [\n          'Experience with C or shell scripting',\n          'Personal projects on GitHub',\n          'Interest in fintech or payments'\n        ],\n        highlightedTerms: ['code reviews', 'Git workflows', 'agile development', 'Merchant Dashboard', 'standups'],\n        interviewStages: 2\n      }\n    ];\n\n    for (const posting of jobPostingSeedData) {\n      await this.createJobPosting(posting);\n    }\n\n    // Seed glossary terms\n    const glossaryTerms = [\n      { term: 'cross-functional teams', definition: 'Groups of people with different functional expertise working toward a common goal. In tech companies, this typically includes engineers, designers, product managers, and other specialists collaborating on projects.', category: 'business' },\n      { term: 'product development process', definition: 'The complete journey of creating a product from initial idea through launch and iteration. Includes discovery, design, development, testing, and release phases.', category: 'product' },\n      { term: 'roadmap', definition: 'A strategic document that outlines the vision, direction, and progress of a product over time. Shows planned features, milestones, and timelines.', category: 'product' },\n      { term: 'sprint planning', definition: 'An agile ceremony where the team decides what work to commit to during an upcoming sprint (typically 2 weeks). Involves breaking down user stories into tasks.', category: 'engineering' },\n      { term: 'KPIs', definition: 'Key Performance Indicators - measurable values that demonstrate how effectively a company or team is achieving key business objectives.', category: 'business' },\n      { term: 'product metrics', definition: 'Quantitative data points used to track product performance, user behavior, and business outcomes. Examples include DAU, retention rate, and conversion rate.', category: 'product' },\n      { term: 'regulatory compliance', definition: 'Ensuring products and processes adhere to relevant laws, regulations, and guidelines. Critical in industries like healthcare, finance, and security.', category: 'business' },\n      { term: 'stakeholder management', definition: 'The process of managing expectations and communication with people who have an interest in a project\\'s outcome, including executives, customers, and team members.', category: 'business' },\n      { term: 'product strategy', definition: 'A high-level plan that defines what a product will achieve and how it supports business goals. Includes target market, value proposition, and competitive positioning.', category: 'product' },\n      { term: 'user stories', definition: 'Short, simple descriptions of a feature told from the user\\'s perspective. Format: \"As a [user], I want [goal] so that [benefit].\"', category: 'product' },\n      { term: 'developer experience', definition: 'The overall experience developers have when using tools, APIs, or platforms. Includes documentation quality, ease of use, and developer productivity.', category: 'engineering' },\n      { term: 'product specs', definition: 'Detailed documents that describe what a product or feature should do, including requirements, user flows, and acceptance criteria.', category: 'product' },\n      { term: 'distributed systems', definition: 'Computer systems where components are located on different networked computers and communicate by passing messages. Designed for scalability and fault tolerance.', category: 'engineering' },\n      { term: 'ML technologies', definition: 'Machine Learning technologies - tools, frameworks, and techniques for building systems that can learn from data. Includes neural networks, deep learning, and NLP.', category: 'engineering' },\n      { term: 'technical architecture', definition: 'The structure and design of a software system, including components, their relationships, and the principles guiding its design and evolution.', category: 'engineering' },\n      { term: 'product vision', definition: 'A long-term aspirational description of what a product aims to achieve and the impact it will have on users and the market.', category: 'product' },\n      { term: 'C-level', definition: 'Top executives in an organization, typically including CEO (Chief Executive Officer), CTO (Chief Technology Officer), CFO (Chief Financial Officer), etc.', category: 'business' },\n      { term: 'algorithmic trading', definition: 'Using computer algorithms to automatically execute trading strategies. Involves analyzing market data and executing trades at high speeds.', category: 'fintech' },\n      { term: 'enterprise customers', definition: 'Large organizations (typically 500+ employees) that use software solutions for business operations. Usually require advanced features, security, and support.', category: 'business' },\n      { term: 'AI-powered analytics', definition: 'Using artificial intelligence and machine learning to automatically analyze data, detect patterns, and provide insights without manual analysis.', category: 'engineering' },\n      { term: 'data-driven', definition: 'Making decisions based on analysis of data rather than intuition. Involves measuring results and using metrics to guide strategy.', category: 'business' },\n      { term: 'product roadmap', definition: 'A strategic timeline showing planned features, improvements, and releases. Communicates product direction to engineering, marketing, and customers.', category: 'product' },\n      { term: 'API architecture', definition: 'The design and structure of APIs (Application Programming Interfaces) that define how external systems interact with your software.', category: 'engineering' },\n      { term: 'data pipeline', definition: 'The series of processes that collect, transform, and move data from source systems to analysis tools. Core to data engineering.', category: 'engineering' },\n      { term: 'machine learning', definition: 'Branch of AI where systems learn patterns from data to make predictions or decisions without explicit programming for each case.', category: 'engineering' },\n      { term: 'anomaly detection', definition: 'Identifying unusual patterns or outliers in data that deviate significantly from normal behavior. Important for fraud detection and quality monitoring.', category: 'engineering' },\n      { term: 'forecasting', definition: 'Using historical data and statistical/ML models to predict future values or trends. Common in sales, demand planning, and financial analysis.', category: 'business' },\n      { term: 'A/B testing', definition: 'Comparing two versions of a product or feature (A and B) with different user groups to determine which performs better based on metrics.', category: 'product' },\n      { term: 'model training', definition: 'The process of teaching machine learning models to recognize patterns by feeding them historical data and adjusting parameters.', category: 'engineering' },\n      { term: 'data connector', definition: 'Software that links external data sources (databases, APIs, cloud services) to your analytics platform to enable data import.', category: 'engineering' },\n      { term: 'real-time processing', definition: 'Processing and analyzing data as it arrives, rather than in batches. Enables immediate insights and quick responses to events.', category: 'engineering' },\n      { term: 'dashboard', definition: 'A visual interface displaying key metrics, charts, and data visualizations. Helps users monitor performance and understand data at a glance.', category: 'product' },\n      { term: 'data democratization', definition: 'Making data accessible to all employees, not just analysts. Empowers teams across the organization to make data-driven decisions.', category: 'business' },\n      { term: 'SaaS', definition: 'Software as a Service - cloud-based software delivered over the internet by subscription. Users access via browser instead of installing locally.', category: 'business' }\n    ];\n\n    for (const term of glossaryTerms) {\n      await this.createJobGlossaryTerm(term);\n    }\n\n    // Seed interview templates\n    const interviewTemplateSeedData = [\n      {\n        name: 'Standard PM Interview (3 rounds)',\n        role: 'pm',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'behavioral', name: 'Hiring Manager Interview', duration: 45, config: { interviewType: 'behavioral' } },\n          { order: 3, type: 'case_study', name: 'Product Case Study', duration: 60, config: { interviewType: 'case_study' } }\n        ],\n        totalDuration: 135\n      },\n      {\n        name: 'Standard Developer Interview (5 rounds)',\n        role: 'developer',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'technical', name: 'Technical Phone Screen', duration: 45, config: { interviewType: 'technical' } },\n          { order: 3, type: 'technical', name: 'Coding Interview', duration: 60, config: { interviewType: 'technical' } },\n          { order: 4, type: 'technical', name: 'System Design', duration: 60, config: { interviewType: 'system-design' } },\n          { order: 5, type: 'behavioral', name: 'Team Fit', duration: 45, config: { interviewType: 'behavioral' } }\n        ],\n        totalDuration: 240\n      },\n      {\n        name: 'Standard Designer Interview (4 rounds)',\n        role: 'designer',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'portfolio', name: 'Portfolio Review', duration: 60, config: { interviewType: 'behavioral' } },\n          { order: 3, type: 'case_study', name: 'Design Challenge', duration: 90, config: { interviewType: 'case_study' } },\n          { order: 4, type: 'behavioral', name: 'Team Fit', duration: 45, config: { interviewType: 'behavioral' } }\n        ],\n        totalDuration: 225\n      },\n      {\n        companyId: createdCompanies[5].id,\n        name: 'DataViz Pro - Product Manager Interview',\n        role: 'pm',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'behavioral', name: 'PM Case Study Round', duration: 60, config: { interviewType: 'case_study' } },\n          { order: 3, type: 'behavioral', name: 'Metrics & Analytics Round', duration: 45, config: { interviewType: 'behavioral' } },\n          { order: 4, type: 'behavioral', name: 'Cross-functional Collaboration', duration: 60, config: { interviewType: 'behavioral' } },\n          { order: 5, type: 'behavioral', name: 'VP Product Interview', duration: 45, config: { interviewType: 'behavioral' } }\n        ],\n        totalDuration: 240\n      },\n      {\n        companyId: createdCompanies[5].id,\n        name: 'DataViz Pro - Backend Engineer Interview',\n        role: 'developer',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'technical', name: 'Technical Screening', duration: 45, config: { interviewType: 'technical' } },\n          { order: 3, type: 'technical', name: 'Coding Interview', duration: 75, config: { interviewType: 'technical' } },\n          { order: 4, type: 'technical', name: 'System Design (Data Pipeline)', duration: 90, config: { interviewType: 'system-design' } },\n          { order: 5, type: 'behavioral', name: 'Team Fit & Leadership', duration: 60, config: { interviewType: 'behavioral' } }\n        ],\n        totalDuration: 300\n      },\n      {\n        companyId: createdCompanies[5].id,\n        name: 'DataViz Pro - Data Scientist Interview',\n        role: 'data-scientist',\n        stages: [\n          { order: 1, type: 'recruiter_call', name: 'Recruiter Screen', duration: 30, config: { interviewType: 'behavioral' } },\n          { order: 2, type: 'technical', name: 'Statistics & ML Fundamentals', duration: 60, config: { interviewType: 'technical' } },\n          { order: 3, type: 'case_study', name: 'ML Case Study', duration: 90, config: { interviewType: 'case_study' } },\n          { order: 4, type: 'behavioral', name: 'Experimentation & Metrics', duration: 60, config: { interviewType: 'behavioral' } },\n          { order: 5, type: 'behavioral', name: 'Head of Data Science Interview', duration: 45, config: { interviewType: 'behavioral' } }\n        ],\n        totalDuration: 285\n      }\n    ];\n\n    for (const template of interviewTemplateSeedData) {\n      await this.createInterviewTemplate(template);\n    }\n\n    // Seed a completed Data Scientist application with all stages passed\n    // Find the Data Scientist job posting at DataViz Pro from database\n    const allPostings = await this.getJobPostings();\n    const dataSciPosting = allPostings.find(p => p.title === 'Senior Data Scientist' && p.role === 'data-scientist');\n    \n    if (dataSciPosting) {\n      // Use user ID 1 (the first registered user - typically \"arsen\")\n      // This ensures the seeded application shows up for the logged-in user\n      const userId = 1;\n\n      // Generate dates for the offer\n      const today = new Date();\n      const startDate = new Date(today);\n      startDate.setDate(startDate.getDate() + 21);\n      const deadline = new Date(today);\n      deadline.setDate(deadline.getDate() + 7);\n      \n      const formatDate = (date: Date) => date.toLocaleDateString('en-US', {\n        weekday: 'long',\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric',\n      });\n\n      // Create the job application with offer status and realistic offer details\n      const application = await this.createJobApplication({\n        userId: userId,\n        jobPostingId: dataSciPosting.id,\n        status: 'offer',\n        cvFileName: 'alex_chen_resume.pdf',\n        cvContent: `ALEX CHEN - Senior Data Scientist\nContact: alex.chen@email.com | San Francisco, CA\n\nSUMMARY\nExperienced data scientist with 7+ years leading ML initiatives at Fortune 500 companies. \nPhD in Computer Science from Stanford. Published researcher with expertise in predictive modeling and NLP.\n\nEXPERIENCE\nLead Data Scientist | TechCorp Inc. | 2020-Present\n- Led team of 5 data scientists building predictive models for customer churn\n- Improved prediction accuracy by 35% using ensemble methods\n- Built real-time ML pipeline processing 10M+ events daily\n\nSenior Data Scientist | DataDriven Labs | 2018-2020\n- Developed NLP models for sentiment analysis with 92% accuracy\n- Created automated reporting dashboards saving 20 hours/week\n\nEDUCATION\nPhD Computer Science - Stanford University | 2018\nBS Computer Science - MIT | 2014\n\nSKILLS\nPython, TensorFlow, PyTorch, SQL, Spark, AWS, Kubernetes`,\n        coverLetter: 'I am thrilled to apply for the Senior Data Scientist position at DataViz Pro. With my extensive background in machine learning and data visualization, I believe I can contribute significantly to your mission of helping enterprises make sense of complex data.',\n        currentStageIndex: 5,\n        offerDetails: {\n          baseSalary: 155000,\n          salaryFrequency: 'annual',\n          signingBonus: 15000,\n          annualBonus: {\n            targetPercent: 15,\n            description: 'Based on individual and company performance, paid annually'\n          },\n          equity: {\n            type: 'rsu',\n            amount: 40000,\n            vestingSchedule: '4-year vesting with 1-year cliff',\n            cliffMonths: 12,\n            totalVestingMonths: 48\n          },\n          benefits: {\n            healthInsurance: 'Premium PPO medical, including family coverage (100% employer paid for employee)',\n            dentalVision: true,\n            retirement401k: {\n              available: true,\n              matchPercent: 4,\n              maxMatch: 8000\n            },\n            pto: {\n              days: 20,\n              type: 'accrued'\n            },\n            remote: 'hybrid',\n            otherBenefits: [\n              'Life and disability insurance',\n              'Employee Assistance Program (EAP)',\n              'Professional development budget ($2,000/year)',\n              'Home office stipend ($500)',\n              'Wellness program'\n            ]\n          },\n          startDate: formatDate(startDate),\n          responseDeadline: formatDate(deadline),\n          reportingTo: 'Head of Data Science',\n          teamSize: 6,\n          offerDate: formatDate(today),\n          offerLetterSignatory: 'Amanda Rodriguez',\n          offerLetterSignatoryTitle: 'Chief People Officer'\n        }\n      });\n\n      // Create all 5 interview stages as passed\n      const stagesData = [\n        { order: 1, name: 'Recruiter Screen', type: 'recruiter_call', score: 88, feedback: 'Excellent communication skills. Very enthusiastic about the role and company mission. Strong background evident.' },\n        { order: 2, name: 'Statistics & ML Fundamentals', type: 'technical', score: 92, feedback: 'Demonstrated deep understanding of ML algorithms. Excellent problem-solving approach. Explained complex concepts clearly.' },\n        { order: 3, name: 'ML Case Study', type: 'case_study', score: 90, feedback: 'Presented compelling approach to anomaly detection problem. Strong analytical thinking and creative solutions.' },\n        { order: 4, name: 'Experimentation & Metrics', type: 'behavioral', score: 87, feedback: 'Great understanding of A/B testing and experimentation. Solid approach to defining and tracking metrics.' },\n        { order: 5, name: 'Head of Data Science Interview', type: 'behavioral', score: 94, feedback: 'Culture fit is excellent. Strong leadership potential. Team player with clear vision for advancing data science at DataViz Pro.' }\n      ];\n\n      for (const stage of stagesData) {\n        await this.createApplicationStage({\n          applicationId: application.id,\n          stageOrder: stage.order,\n          stageName: stage.name,\n          stageType: stage.type as 'recruiter_call' | 'technical' | 'behavioral' | 'case_study' | 'portfolio' | 'onsite',\n          status: 'passed',\n          completedAt: new Date(Date.now() - (6 - stage.order) * 2 * 24 * 60 * 60 * 1000), // Stagger completion dates\n          score: stage.score,\n          feedback: stage.feedback\n        });\n      }\n\n      // Seed user progress for the completed interviews\n      const avgScore = Math.round(stagesData.reduce((sum, s) => sum + s.score, 0) / stagesData.length);\n      await this.createUserProgress({\n        userId: userId,\n        simulationType: 'interview',\n        totalSessions: 5,\n        completedSessions: 5,\n        averageScore: avgScore,\n        totalTime: 285 * 60, // Total interview duration in seconds\n      });\n    }\n  }\n\n  private async seedSprintWorkflowData() {\n    // Check if sprint workflow data already exists - skip if so\n    const existingJourneys = await db.select().from(userJourneys).limit(1);\n    if (existingJourneys.length > 0) {\n      console.log('Sprint workflow data already exists, skipping seed...');\n      return;\n    }\n\n    console.log('Seeding sprint workflow data...');\n\n    // Get or create progression path\n    let progressionPath;\n    const existingPaths = await db.select().from(progressionPaths).where(eq(progressionPaths.slug, 'intern-to-junior')).limit(1);\n    if (existingPaths.length > 0) {\n      progressionPath = existingPaths[0];\n    } else {\n      const [newPath] = await db.insert(progressionPaths).values({\n        slug: 'intern-to-junior',\n        entryLevel: 'intern',\n        exitLevel: 'junior',\n        role: 'developer',\n        displayName: 'Intern to Junior Developer',\n        description: 'Progress from Intern to Junior Ready through realistic work simulations',\n        requirements: { minSprints: 3, maxSprints: 8, readinessThreshold: 85 },\n        difficultyProgression: { startDifficulty: 1, endDifficulty: 3, curve: 'linear' },\n        exitBadge: 'Junior Ready Developer',\n        competencyFocus: ['code-quality', 'git-workflow', 'communication', 'problem-solving'],\n        estimatedDuration: '4-8 weeks',\n      }).returning();\n      progressionPath = newPath;\n    }\n\n    // Get or create project template\n    let projectTemplate;\n    const existingTemplates = await db.select().from(projectTemplates).where(eq(projectTemplates.slug, 'novapay-payment-platform')).limit(1);\n    if (existingTemplates.length > 0) {\n      projectTemplate = existingTemplates[0];\n    } else {\n      const [newTemplate] = await db.insert(projectTemplates).values({\n        slug: 'novapay-payment-platform',\n        name: 'NovaPay Payment Platform',\n        description: 'A fintech payment processing platform for small businesses',\n        industry: 'fintech',\n        domain: 'payments',\n        teamTopology: { structure: 'squad', size: 6 },\n        team: [\n          { id: 'tm-1', name: 'Sarah Chen', role: 'Engineering Manager', avatar: null },\n          { id: 'tm-2', name: 'Marcus Johnson', role: 'Senior Developer', avatar: null },\n          { id: 'tm-3', name: 'Priya Patel', role: 'Product Manager', avatar: null },\n          { id: 'tm-4', name: 'Alex Rivera', role: 'QA Engineer', avatar: null },\n        ],\n        codebase: { language: 'typescript', framework: 'react', complexity: 'medium' },\n        backlogThemes: ['payments', 'user-management', 'dashboard', 'notifications'],\n        bugTemplates: ['null-pointer', 'ui-responsive', 'api-error-handling'],\n        featureTemplates: ['add-field', 'loading-state', 'validation'],\n        softSkillPacks: ['standup', 'code-review', 'pair-programming'],\n        sprintCadence: 10,\n        techStack: ['TypeScript', 'React', 'Node.js', 'PostgreSQL'],\n        language: 'typescript',\n        progressionPathId: progressionPath.id,\n      }).returning();\n      projectTemplate = newTemplate;\n    }\n\n    // Get the job application with 'offer' status for user 1\n    const offerApplications = await db.select()\n      .from(jobApplications)\n      .where(eq(jobApplications.userId, 1))\n      .orderBy(jobApplications.id)\n      .limit(1);\n    \n    const jobApplicationId = offerApplications.length > 0 ? offerApplications[0].id : null;\n\n    // Create a journey for user 1 with accepted application\n    const journey = await this.createJourney({\n      userId: 1,\n      progressionPathId: progressionPath.id,\n      projectTemplateId: projectTemplate.id,\n      jobApplicationId: jobApplicationId,\n      status: 'in_progress',\n      currentArcId: null,\n      currentSprintNumber: 1,\n      completedSprints: 0,\n      readinessScore: 25,\n      exitTrigger: null,\n      journeyMetadata: {\n        companyName: 'NovaPay',\n        role: 'Junior Developer',\n        level: 'intern',\n      },\n    });\n\n    // Create a journey arc first\n    const [arc] = await db.insert(journeyArcs).values({\n      journeyId: journey.id,\n      arcType: 'sprint',\n      arcOrder: 1,\n      name: 'Sprint 1: Onboarding',\n      description: 'Your first sprint - get familiar with the codebase and team',\n      status: 'active',\n      difficultyBand: 'guided',\n      durationDays: 10,\n      competencyFocus: ['code-quality', 'git-workflow'],\n      isFinalArc: false,\n      arcData: { theme: 'Onboarding' },\n    }).returning();\n\n    // Update journey with current arc\n    await db.update(userJourneys)\n      .set({ currentArcId: arc.id })\n      .where(eq(userJourneys.id, journey.id));\n\n    // Create the first sprint with proper schema structure\n    const [sprint] = await db.insert(sprints).values({\n      arcId: arc.id,\n      sprintNumber: 1,\n      goal: 'Complete onboarding and deliver first bug fix',\n      theme: 'Onboarding',\n      backlog: [\n        { id: 1, title: 'Fix login button', type: 'bug', points: 3 },\n        { id: 2, title: 'Add loading spinner', type: 'feature', points: 2 },\n        { id: 3, title: 'Review documentation', type: 'task', points: 1 },\n        { id: 4, title: 'Fix null pointer', type: 'bug', points: 5 },\n        { id: 5, title: 'Update profile API', type: 'feature', points: 2 },\n      ],\n      userTickets: [1, 2, 3], // Ticket IDs assigned to user\n      teamTickets: [4, 5], // Ticket IDs for AI team\n      storyPointsTarget: 13,\n      storyPointsCompleted: 0,\n      ceremonies: {\n        planning: { status: 'pending', scheduledDay: 1 },\n        standup: { status: 'pending', scheduledDay: 2 },\n        review: { status: 'pending', scheduledDay: 10 },\n        retrospective: { status: 'pending', scheduledDay: 10 },\n      },\n      sprintState: { currentDay: 1, phase: 'planning' },\n    }).returning();\n\n    // Create sprint tickets\n    const ticketData = [\n      {\n        sprintId: sprint.id,\n        ticketKey: 'NOVA-101',\n        title: 'Fix login button not responding on mobile',\n        description: 'Users report that the login button on mobile devices does not respond to taps. Investigate and fix the issue.',\n        type: 'bug' as const,\n        priority: 'high' as const,\n        status: 'todo' as const,\n        storyPoints: 3,\n        acceptanceCriteria: ['Login button responds to taps on iOS and Android', 'No regression on desktop'],\n        dayAssigned: 1,\n      },\n      {\n        sprintId: sprint.id,\n        ticketKey: 'NOVA-102',\n        title: 'Add loading spinner to dashboard',\n        description: 'The dashboard currently shows a blank screen while loading data. Add a loading spinner for better UX.',\n        type: 'feature' as const,\n        priority: 'medium' as const,\n        status: 'todo' as const,\n        storyPoints: 2,\n        acceptanceCriteria: ['Spinner displays while data is loading', 'Spinner disappears when data loads'],\n        dayAssigned: 1,\n      },\n      {\n        sprintId: sprint.id,\n        ticketKey: 'NOVA-103',\n        title: 'Review onboarding documentation',\n        description: 'Read through the developer onboarding docs and note any questions or unclear sections.',\n        type: 'feature' as const,\n        priority: 'low' as const,\n        status: 'todo' as const,\n        storyPoints: 1,\n        acceptanceCriteria: ['Docs reviewed', 'Questions documented'],\n        dayAssigned: 2,\n      },\n      {\n        sprintId: sprint.id,\n        ticketKey: 'NOVA-104',\n        title: 'Fix null pointer in payment processing',\n        description: 'The payment processing module throws a null pointer exception when the user has no saved cards.',\n        type: 'bug' as const,\n        priority: 'high' as const,\n        status: 'todo' as const,\n        storyPoints: 5,\n        acceptanceCriteria: ['No crash when user has no saved cards', 'Proper error message shown'],\n        dayAssigned: 3,\n      },\n      {\n        sprintId: sprint.id,\n        ticketKey: 'NOVA-105',\n        title: 'Update user profile API endpoint',\n        description: 'Add email verification field to the user profile API response.',\n        type: 'feature' as const,\n        priority: 'medium' as const,\n        status: 'todo' as const,\n        storyPoints: 2,\n        acceptanceCriteria: ['API returns emailVerified field', 'Field is boolean'],\n        dayAssigned: 4,\n      },\n    ];\n\n    for (const ticket of ticketData) {\n      await this.createSprintTicket(ticket);\n    }\n\n    // Create ceremonies for the sprint\n    const ceremonyData = [\n      {\n        sprintId: sprint.id,\n        ceremonyType: 'planning' as const,\n        status: 'pending' as const,\n        dayNumber: 1,\n      },\n      {\n        sprintId: sprint.id,\n        ceremonyType: 'standup' as const,\n        status: 'pending' as const,\n        dayNumber: 2,\n      },\n      {\n        sprintId: sprint.id,\n        ceremonyType: 'review' as const,\n        status: 'pending' as const,\n        dayNumber: 10,\n      },\n      {\n        sprintId: sprint.id,\n        ceremonyType: 'retrospective' as const,\n        status: 'pending' as const,\n        dayNumber: 10,\n      },\n    ];\n\n    for (const ceremony of ceremonyData) {\n      await this.createCeremonyInstance(ceremony);\n    }\n\n    console.log('Sprint workflow data seeded successfully!');\n  }\n\n  // Phase 1: Competency operations\n  async getCompetencies(filters?: { role?: string; category?: string }): Promise<Competency[]> {\n    let query = db.select().from(competencies);\n    \n    const conditions: any[] = [];\n    if (filters?.role) {\n      conditions.push(or(eq(competencies.role, filters.role), sql`${competencies.role} IS NULL`));\n    }\n    if (filters?.category) {\n      conditions.push(eq(competencies.category, filters.category));\n    }\n    \n    if (conditions.length > 0) {\n      return await db.select().from(competencies).where(and(...conditions));\n    }\n    return await db.select().from(competencies);\n  }\n\n  async getCompetency(slug: string): Promise<Competency | undefined> {\n    const results = await db.select().from(competencies).where(eq(competencies.slug, slug));\n    return results[0];\n  }\n\n  // Phase 1: Simulation Catalogue operations\n  async getCatalogueItems(filters?: { \n    simulator?: string; \n    type?: string;\n    role?: string; \n    level?: string; \n    language?: string;\n    day?: number;\n  }): Promise<SimulationCatalogue[]> {\n    const conditions: any[] = [];\n    \n    if (filters?.simulator) {\n      conditions.push(eq(simulationCatalogue.simulator, filters.simulator));\n    }\n    if (filters?.type) {\n      conditions.push(eq(simulationCatalogue.type, filters.type));\n    }\n    if (filters?.role) {\n      conditions.push(or(eq(simulationCatalogue.role, filters.role), sql`${simulationCatalogue.role} IS NULL`));\n    }\n    if (filters?.level) {\n      conditions.push(or(eq(simulationCatalogue.level, filters.level), sql`${simulationCatalogue.level} IS NULL`));\n    }\n    if (filters?.language) {\n      conditions.push(or(eq(simulationCatalogue.language, filters.language), sql`${simulationCatalogue.language} IS NULL`));\n    }\n    if (filters?.day !== undefined) {\n      conditions.push(eq(simulationCatalogue.day, filters.day));\n    }\n    \n    if (conditions.length > 0) {\n      return await db.select().from(simulationCatalogue).where(and(...conditions));\n    }\n    return await db.select().from(simulationCatalogue);\n  }\n\n  async getCatalogueItem(externalId: string): Promise<SimulationCatalogue | undefined> {\n    const results = await db.select().from(simulationCatalogue).where(eq(simulationCatalogue.externalId, externalId));\n    return results[0];\n  }\n\n  async getCatalogueItemById(id: number): Promise<SimulationCatalogue | undefined> {\n    const results = await db.select().from(simulationCatalogue).where(eq(simulationCatalogue.id, id));\n    return results[0];\n  }\n\n  // Phase 1: Role Adapter operations\n  async getRoleAdapters(): Promise<RoleAdapter[]> {\n    return await db.select().from(roleAdapters);\n  }\n\n  async getRoleAdapter(role: string): Promise<RoleAdapter | undefined> {\n    const results = await db.select().from(roleAdapters).where(eq(roleAdapters.role, role));\n    return results[0];\n  }\n\n  // Phase 1: Competency Ledger operations\n  async getUserCompetencyLedger(userId: number): Promise<CompetencyLedger[]> {\n    return await db.select().from(competencyLedger)\n      .where(eq(competencyLedger.userId, userId));\n  }\n\n  async getUserCompetencyEntry(userId: number, competencyId: number): Promise<CompetencyLedger | undefined> {\n    const results = await db.select().from(competencyLedger)\n      .where(and(\n        eq(competencyLedger.userId, userId),\n        eq(competencyLedger.competencyId, competencyId)\n      ));\n    return results[0];\n  }\n\n  async createCompetencyEntry(entry: InsertCompetencyLedger): Promise<CompetencyLedger> {\n    const results = await db.insert(competencyLedger).values({\n      ...entry,\n      currentBand: entry.currentBand || 'explorer',\n      evidenceCount: entry.evidenceCount || 0,\n      confidence: entry.confidence || 0,\n      history: entry.history || [],\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateCompetencyEntry(id: number, updates: Partial<CompetencyLedger>): Promise<CompetencyLedger | undefined> {\n    const results = await db.update(competencyLedger)\n      .set({\n        ...updates,\n        updatedAt: new Date()\n      })\n      .where(eq(competencyLedger.id, id))\n      .returning();\n    return results[0];\n  }\n\n  async getUserReadiness(userId: number): Promise<ReadinessScore> {\n    // Get all competencies for this user\n    const ledgerEntries = await this.getUserCompetencyLedger(userId);\n    const allCompetencies = await this.getCompetencies();\n    \n    // Build competency map for quick lookup\n    const competencyMap = new Map(allCompetencies.map(c => [c.id, c]));\n    \n    // Build breakdown with existing data\n    const competencyBreakdown = allCompetencies.map(comp => {\n      const entry = ledgerEntries.find(e => e.competencyId === comp.id);\n      return {\n        slug: comp.slug,\n        name: comp.name,\n        band: (entry?.currentBand || 'explorer') as 'explorer' | 'contributor' | 'junior_ready',\n        confidence: entry?.confidence || 0,\n        evidenceCount: entry?.evidenceCount || 0,\n      };\n    });\n    \n    // Calculate band weights: explorer=1, contributor=2, junior_ready=3\n    const bandWeights: Record<string, number> = { 'explorer': 1, 'contributor': 2, 'junior_ready': 3 };\n    const avgWeight = competencyBreakdown.length > 0\n      ? competencyBreakdown.reduce((sum, c) => sum + (bandWeights[c.band] || 1), 0) / competencyBreakdown.length\n      : 1;\n    \n    // Determine overall band based on average weight\n    let currentBand: 'explorer' | 'contributor' | 'junior_ready';\n    if (avgWeight >= 2.5) {\n      currentBand = 'junior_ready';\n    } else if (avgWeight >= 1.5) {\n      currentBand = 'contributor';\n    } else {\n      currentBand = 'explorer';\n    }\n    \n    // Calculate overall score (0-100 based on bands and confidence)\n    const avgConfidence = competencyBreakdown.length > 0\n      ? competencyBreakdown.reduce((sum, c) => sum + c.confidence, 0) / competencyBreakdown.length\n      : 0;\n    const overallScore = Math.round((avgWeight / 3) * 100 * 0.7 + avgConfidence * 0.3);\n    \n    // Identify gaps (low confidence or explorer band)\n    const gaps = competencyBreakdown\n      .filter(c => c.band === 'explorer' || c.confidence < 30)\n      .map(c => c.slug);\n    \n    // Identify strengths (high confidence and contributor or above)\n    const strengths = competencyBreakdown\n      .filter(c => c.band !== 'explorer' && c.confidence >= 70)\n      .map(c => c.slug);\n    \n    return {\n      overallScore,\n      currentBand,\n      competencyBreakdown,\n      gaps,\n      strengths,\n    };\n  }\n\n  // Phase 1: Portfolio Artifact operations\n  async getUserPortfolio(userId: number): Promise<PortfolioArtifact[]> {\n    return await db.select().from(portfolioArtifacts)\n      .where(eq(portfolioArtifacts.userId, userId))\n      .orderBy(desc(portfolioArtifacts.createdAt));\n  }\n\n  async getPortfolioArtifact(id: number): Promise<PortfolioArtifact | undefined> {\n    const results = await db.select().from(portfolioArtifacts).where(eq(portfolioArtifacts.id, id));\n    return results[0];\n  }\n\n  async createPortfolioArtifact(artifact: InsertPortfolioArtifact): Promise<PortfolioArtifact> {\n    const results = await db.insert(portfolioArtifacts).values({\n      ...artifact,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // ============================================================================\n  // PHASE 3: NARRATIVE ARCHITECTURE OPERATIONS\n  // ============================================================================\n\n  // Progression Path operations\n  async getProgressionPaths(filters?: { role?: string; entryLevel?: string }): Promise<ProgressionPath[]> {\n    const conditions: any[] = [];\n    \n    if (filters?.role) {\n      conditions.push(eq(progressionPaths.role, filters.role));\n    }\n    if (filters?.entryLevel) {\n      conditions.push(eq(progressionPaths.entryLevel, filters.entryLevel));\n    }\n    \n    if (conditions.length > 0) {\n      return await db.select().from(progressionPaths).where(and(...conditions));\n    }\n    return await db.select().from(progressionPaths);\n  }\n\n  async getProgressionPath(slug: string): Promise<ProgressionPath | undefined> {\n    const results = await db.select().from(progressionPaths).where(eq(progressionPaths.slug, slug));\n    return results[0];\n  }\n\n  async getProgressionPathById(id: number): Promise<ProgressionPath | undefined> {\n    const results = await db.select().from(progressionPaths).where(eq(progressionPaths.id, id));\n    return results[0];\n  }\n\n  async createProgressionPath(path: InsertProgressionPath): Promise<ProgressionPath> {\n    const results = await db.insert(progressionPaths).values({\n      ...path,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // Project Template operations\n  async getProjectTemplates(filters?: { language?: string; industry?: string }): Promise<ProjectTemplate[]> {\n    const conditions: any[] = [];\n    \n    if (filters?.language) {\n      conditions.push(eq(projectTemplates.language, filters.language));\n    }\n    if (filters?.industry) {\n      conditions.push(eq(projectTemplates.industry, filters.industry));\n    }\n    \n    if (conditions.length > 0) {\n      return await db.select().from(projectTemplates).where(and(...conditions));\n    }\n    return await db.select().from(projectTemplates);\n  }\n\n  async getProjectTemplate(slug: string): Promise<ProjectTemplate | undefined> {\n    const results = await db.select().from(projectTemplates).where(eq(projectTemplates.slug, slug));\n    return results[0];\n  }\n\n  async getProjectTemplateById(id: number): Promise<ProjectTemplate | undefined> {\n    const results = await db.select().from(projectTemplates).where(eq(projectTemplates.id, id));\n    return results[0];\n  }\n\n  async createProjectTemplate(template: InsertProjectTemplate): Promise<ProjectTemplate> {\n    const results = await db.insert(projectTemplates).values({\n      ...template,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // User Journey operations\n  async getUserJourneys(userId: number): Promise<UserJourney[]> {\n    return await db.select().from(userJourneys)\n      .where(eq(userJourneys.userId, userId))\n      .orderBy(desc(userJourneys.startedAt));\n  }\n\n  async getUserActiveJourney(userId: number): Promise<UserJourney | undefined> {\n    const results = await db.select().from(userJourneys)\n      .where(and(\n        eq(userJourneys.userId, userId),\n        eq(userJourneys.status, 'active')\n      ))\n      .limit(1);\n    return results[0];\n  }\n\n  async getJourney(id: number): Promise<UserJourney | undefined> {\n    const results = await db.select().from(userJourneys).where(eq(userJourneys.id, id));\n    return results[0];\n  }\n\n  async createJourney(journey: InsertUserJourney): Promise<UserJourney> {\n    const results = await db.insert(userJourneys).values({\n      ...journey,\n      status: journey.status || 'active',\n      currentSprintNumber: journey.currentSprintNumber || 0,\n      completedSprints: journey.completedSprints || 0,\n      readinessScore: journey.readinessScore || 0,\n      journeyMetadata: journey.journeyMetadata || {},\n      startedAt: new Date(),\n      lastActivityAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateJourney(id: number, updates: Partial<UserJourney>): Promise<UserJourney | undefined> {\n    const results = await db.update(userJourneys)\n      .set({\n        ...updates,\n        lastActivityAt: new Date()\n      })\n      .where(eq(userJourneys.id, id))\n      .returning();\n    return results[0];\n  }\n\n  async getJourneyState(journeyId: number): Promise<JourneyState | null> {\n    const journey = await this.getJourney(journeyId);\n    if (!journey) return null;\n\n    const currentArc = journey.currentArcId \n      ? await this.getJourneyArc(journey.currentArcId) \n      : await this.getCurrentArc(journeyId);\n    \n    let currentSprint: Sprint | null = null;\n    let todayActivities: SprintActivity[] = [];\n    \n    if (currentArc && currentArc.arcType === 'sprint') {\n      currentSprint = await this.getSprintByArc(currentArc.id) || null;\n      if (currentSprint) {\n        const sprintState = currentSprint.sprintState as { currentDay?: number } || {};\n        const currentDay = sprintState.currentDay || 1;\n        todayActivities = await this.getSprintActivities(currentSprint.id, currentDay);\n      }\n    }\n\n    // Get progression path for exit requirements\n    const progressionPath = await this.getProgressionPathById(journey.progressionPathId);\n    const requirements = progressionPath?.requirements as { minSprints?: number; maxSprints?: number; readinessThreshold?: number } || {};\n    \n    const canGraduate = journey.completedSprints >= (requirements.minSprints || 2) && \n      (journey.readinessScore >= (requirements.readinessThreshold || 85) || \n       journey.completedSprints >= (requirements.maxSprints || 8));\n\n    return {\n      journey,\n      currentArc: currentArc || null,\n      currentSprint,\n      currentDay: currentSprint ? ((currentSprint.sprintState as { currentDay?: number })?.currentDay || 1) : 1,\n      todayActivities,\n      readinessScore: journey.readinessScore,\n      canGraduate,\n      exitOptions: {\n        userChoice: journey.completedSprints >= (requirements.minSprints || 2),\n        readinessThreshold: journey.readinessScore >= (requirements.readinessThreshold || 85),\n        maxSprints: journey.completedSprints >= (requirements.maxSprints || 8)\n      }\n    };\n  }\n\n  // Journey Arc operations\n  async getJourneyArcs(journeyId: number): Promise<JourneyArc[]> {\n    return await db.select().from(journeyArcs)\n      .where(eq(journeyArcs.journeyId, journeyId))\n      .orderBy(journeyArcs.arcOrder);\n  }\n\n  async getJourneyArc(id: number): Promise<JourneyArc | undefined> {\n    const results = await db.select().from(journeyArcs).where(eq(journeyArcs.id, id));\n    return results[0];\n  }\n\n  async getCurrentArc(journeyId: number): Promise<JourneyArc | undefined> {\n    const results = await db.select().from(journeyArcs)\n      .where(and(\n        eq(journeyArcs.journeyId, journeyId),\n        eq(journeyArcs.status, 'active')\n      ))\n      .limit(1);\n    return results[0];\n  }\n\n  async createJourneyArc(arc: InsertJourneyArc): Promise<JourneyArc> {\n    const results = await db.insert(journeyArcs).values({\n      ...arc,\n      status: arc.status || 'pending',\n      difficultyBand: arc.difficultyBand || 'guided',\n      durationDays: arc.durationDays || 5,\n      isFinalArc: arc.isFinalArc || false,\n      arcData: arc.arcData || {},\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateJourneyArc(id: number, updates: Partial<JourneyArc>): Promise<JourneyArc | undefined> {\n    const results = await db.update(journeyArcs)\n      .set(updates)\n      .where(eq(journeyArcs.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Sprint operations\n  async getSprint(id: number): Promise<Sprint | undefined> {\n    const results = await db.select().from(sprints).where(eq(sprints.id, id));\n    return results[0];\n  }\n\n  async getSprintByArc(arcId: number): Promise<Sprint | undefined> {\n    const results = await db.select().from(sprints).where(eq(sprints.arcId, arcId));\n    return results[0];\n  }\n\n  async getSprintsByJourney(journeyId: number): Promise<Sprint[]> {\n    const arcs = await this.getJourneyArcs(journeyId);\n    const arcIds = arcs.map(arc => arc.id);\n    \n    if (arcIds.length === 0) return [];\n    \n    const results = await db.select().from(sprints)\n      .where(inArray(sprints.arcId, arcIds))\n      .orderBy(sprints.sprintNumber);\n    \n    return results;\n  }\n\n  async createSprint(sprint: InsertSprint): Promise<Sprint> {\n    const results = await db.insert(sprints).values({\n      ...sprint,\n      storyPointsTarget: sprint.storyPointsTarget || 8,\n      storyPointsCompleted: sprint.storyPointsCompleted || 0,\n      softSkillEvents: sprint.softSkillEvents || [],\n      midSprintEvents: sprint.midSprintEvents || [],\n      sprintState: sprint.sprintState || {},\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateSprint(id: number, updates: Partial<Sprint>): Promise<Sprint | undefined> {\n    const results = await db.update(sprints)\n      .set(updates)\n      .where(eq(sprints.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Sprint Activity operations\n  async getSprintActivities(sprintId: number, dayNumber?: number): Promise<SprintActivity[]> {\n    const conditions = [eq(sprintActivities.sprintId, sprintId)];\n    \n    if (dayNumber !== undefined) {\n      conditions.push(eq(sprintActivities.dayNumber, dayNumber));\n    }\n    \n    return await db.select().from(sprintActivities)\n      .where(and(...conditions))\n      .orderBy(sprintActivities.dayNumber, sprintActivities.activityOrder);\n  }\n\n  async getSprintActivity(id: number): Promise<SprintActivity | undefined> {\n    const results = await db.select().from(sprintActivities).where(eq(sprintActivities.id, id));\n    return results[0];\n  }\n\n  async createSprintActivity(activity: InsertSprintActivity): Promise<SprintActivity> {\n    const results = await db.insert(sprintActivities).values({\n      ...activity,\n      status: activity.status || 'pending',\n      isRequired: activity.isRequired ?? true,\n      estimatedMinutes: activity.estimatedMinutes || 15,\n      activityData: activity.activityData || {},\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateSprintActivity(id: number, updates: Partial<SprintActivity>): Promise<SprintActivity | undefined> {\n    const results = await db.update(sprintActivities)\n      .set(updates)\n      .where(eq(sprintActivities.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Competency Snapshot operations\n  async getCompetencySnapshots(journeyId: number): Promise<CompetencySnapshot[]> {\n    return await db.select().from(competencySnapshots)\n      .where(eq(competencySnapshots.journeyId, journeyId))\n      .orderBy(competencySnapshots.createdAt);\n  }\n\n  async createCompetencySnapshot(snapshot: InsertCompetencySnapshot): Promise<CompetencySnapshot> {\n    const results = await db.insert(competencySnapshots).values({\n      ...snapshot,\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // Phase 5: Sprint Ticket operations\n  async getSprintTickets(sprintId: number): Promise<SprintTicket[]> {\n    return await db.select().from(sprintTickets)\n      .where(eq(sprintTickets.sprintId, sprintId))\n      .orderBy(sprintTickets.dayAssigned, sprintTickets.priority);\n  }\n\n  async getSprintTicket(id: number): Promise<SprintTicket | undefined> {\n    const results = await db.select().from(sprintTickets).where(eq(sprintTickets.id, id));\n    return results[0];\n  }\n\n  async getSprintTicketByKey(sprintId: number, ticketKey: string): Promise<SprintTicket | undefined> {\n    const results = await db.select().from(sprintTickets)\n      .where(and(\n        eq(sprintTickets.sprintId, sprintId),\n        eq(sprintTickets.ticketKey, ticketKey)\n      ));\n    return results[0];\n  }\n\n  async createSprintTicket(ticket: InsertSprintTicket): Promise<SprintTicket> {\n    const results = await db.insert(sprintTickets).values({\n      ...ticket,\n      status: ticket.status || 'todo',\n      priority: ticket.priority || 'medium',\n      storyPoints: ticket.storyPoints || 2,\n      dayAssigned: ticket.dayAssigned || 1,\n      gitState: ticket.gitState || {},\n      acceptanceCriteria: ticket.acceptanceCriteria || [],\n      reviewComments: ticket.reviewComments || [],\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateSprintTicket(id: number, updates: Partial<SprintTicket>): Promise<SprintTicket | undefined> {\n    const results = await db.update(sprintTickets)\n      .set(updates)\n      .where(eq(sprintTickets.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Phase 5: Ceremony Instance operations\n  async getCeremonyInstances(sprintId: number): Promise<CeremonyInstance[]> {\n    return await db.select().from(ceremonyInstances)\n      .where(eq(ceremonyInstances.sprintId, sprintId))\n      .orderBy(ceremonyInstances.dayNumber);\n  }\n\n  async getCeremonyInstance(id: number): Promise<CeremonyInstance | undefined> {\n    const results = await db.select().from(ceremonyInstances).where(eq(ceremonyInstances.id, id));\n    return results[0];\n  }\n\n  async getCeremonyByType(sprintId: number, ceremonyType: string, dayNumber?: number): Promise<CeremonyInstance | undefined> {\n    const conditions = [\n      eq(ceremonyInstances.sprintId, sprintId),\n      eq(ceremonyInstances.ceremonyType, ceremonyType)\n    ];\n    \n    if (dayNumber !== undefined) {\n      conditions.push(eq(ceremonyInstances.dayNumber, dayNumber));\n    }\n    \n    const results = await db.select().from(ceremonyInstances)\n      .where(and(...conditions))\n      .orderBy(desc(ceremonyInstances.dayNumber));\n    return results[0];\n  }\n\n  async createCeremonyInstance(ceremony: InsertCeremonyInstance): Promise<CeremonyInstance> {\n    const results = await db.insert(ceremonyInstances).values({\n      ...ceremony,\n      status: ceremony.status || 'pending',\n      script: ceremony.script || [],\n      teamMessages: ceremony.teamMessages || [],\n      userResponses: ceremony.userResponses || [],\n      actionItems: ceremony.actionItems || [],\n      commitments: ceremony.commitments || [],\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateCeremonyInstance(id: number, updates: Partial<CeremonyInstance>): Promise<CeremonyInstance | undefined> {\n    const results = await db.update(ceremonyInstances)\n      .set(updates)\n      .where(eq(ceremonyInstances.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Phase 5: Git Session operations\n  async getGitSession(ticketId: number): Promise<GitSession | undefined> {\n    const results = await db.select().from(gitSessions).where(eq(gitSessions.ticketId, ticketId));\n    return results[0];\n  }\n\n  async getGitSessionById(id: number): Promise<GitSession | undefined> {\n    const results = await db.select().from(gitSessions).where(eq(gitSessions.id, id));\n    return results[0];\n  }\n\n  async createGitSession(session: InsertGitSession): Promise<GitSession> {\n    const results = await db.insert(gitSessions).values({\n      ...session,\n      currentBranch: session.currentBranch || 'main',\n      isCloned: session.isCloned || false,\n      stagedFiles: session.stagedFiles || [],\n      commits: session.commits || [],\n      remoteSyncStatus: session.remoteSyncStatus || 'synced',\n      createdAt: new Date(),\n      updatedAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  async updateGitSession(id: number, updates: Partial<GitSession>): Promise<GitSession | undefined> {\n    const results = await db.update(gitSessions)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(gitSessions.id, id))\n      .returning();\n    return results[0];\n  }\n\n  // Phase 5: Git Event operations\n  async getGitEvents(sessionId: number): Promise<GitEvent[]> {\n    return await db.select().from(gitEvents)\n      .where(eq(gitEvents.sessionId, sessionId))\n      .orderBy(gitEvents.createdAt);\n  }\n\n  async createGitEvent(event: InsertGitEvent): Promise<GitEvent> {\n    const results = await db.insert(gitEvents).values({\n      sessionId: event.sessionId,\n      commandType: event.commandType,\n      rawCommand: event.rawCommand,\n      isValid: event.isValid ?? true,\n      output: event.output || null,\n      errorMessage: event.errorMessage || null,\n      stateChange: event.stateChange || {},\n      createdAt: new Date()\n    }).returning();\n    return results[0];\n  }\n\n  // Phase 5: Dashboard data operations\n  async getSprintOverview(sprintId: number): Promise<SprintOverview | null> {\n    const sprint = await this.getSprint(sprintId);\n    if (!sprint) return null;\n\n    const tickets = await this.getSprintTickets(sprintId);\n    const ceremonies = await this.getCeremonyInstances(sprintId);\n    const activities = await this.getSprintActivities(sprintId);\n\n    const ticketStats = {\n      todo: tickets.filter(t => t.status === 'todo').length,\n      inProgress: tickets.filter(t => t.status === 'in_progress').length,\n      inReview: tickets.filter(t => t.status === 'in_review').length,\n      done: tickets.filter(t => t.status === 'done').length,\n    };\n\n    const upcomingCeremonies = ceremonies.filter(c => c.status === 'pending');\n    const sprintState = sprint.sprintState as { currentDay?: number } | null;\n    const currentDay = sprintState?.currentDay || 1;\n    const todayActivities = activities.filter(a => a.dayNumber === currentDay);\n\n    return {\n      sprint,\n      tickets,\n      ceremonies,\n      currentDay,\n      ticketStats,\n      upcomingCeremonies,\n      todayActivities,\n    };\n  }\n\n  async getJourneyDashboard(journeyId: number): Promise<JourneyDashboard | null> {\n    const journey = await this.getJourney(journeyId);\n    if (!journey) return null;\n\n    const arcs = await this.getJourneyArcs(journeyId);\n    const currentArc = arcs.find(arc => arc.status === 'active' || arc.status === 'in_progress') || null;\n    \n    let currentSprint: SprintOverview | null = null;\n    if (currentArc) {\n      const sprint = await this.getSprintByArc(currentArc.id);\n      if (sprint) {\n        currentSprint = await this.getSprintOverview(sprint.id);\n      }\n    }\n\n    const readinessScore = journey.readinessScore || 0;\n    const competencyScores: Record<string, { score: number; band: MasteryBand }> = {};\n    \n    const ledgerEntries = await this.getUserCompetencyLedger(journey.userId);\n    for (const entry of ledgerEntries) {\n      const competency = await db.select().from(competencies).where(eq(competencies.id, entry.competencyId));\n      if (competency[0]) {\n        competencyScores[competency[0].slug] = {\n          score: entry.confidence,\n          band: entry.currentBand as MasteryBand,\n        };\n      }\n    }\n\n    const allSprints = await this.getSprintsByJourney(journeyId);\n    const arcsWithSprints = arcs.map(arc => ({\n      ...arc,\n      sprints: allSprints.filter(s => s.arcId === arc.id),\n    }));\n\n    const currentArcIndex = currentArc ? arcs.findIndex(a => a.id === currentArc.id) : -1;\n    const currentSprintIndex = currentSprint ? \n      arcsWithSprints[currentArcIndex]?.sprints.findIndex(s => s.id === currentSprint?.sprint.id) ?? -1 : -1;\n\n    const progressionPath = await this.getProgressionPathById(journey.progressionPathId);\n    const requirements = progressionPath?.requirements as { minSprints?: number } | null;\n    const minSprintsRequired = requirements?.minSprints || 3;\n    \n    const canGraduate = readinessScore >= 85 && journey.completedSprints >= minSprintsRequired;\n    const estimatedSprintsRemaining = Math.max(0, Math.ceil((85 - readinessScore) / 10));\n\n    return {\n      journey,\n      currentArc,\n      currentSprint,\n      readinessScore,\n      competencyScores,\n      timeline: {\n        arcs: arcsWithSprints,\n        currentPosition: { arcIndex: currentArcIndex, sprintIndex: currentSprintIndex },\n      },\n      canGraduate,\n      estimatedSprintsRemaining,\n    };\n  }\n\n  async getWorkspaceInstance(id: number): Promise<WorkspaceInstance | undefined> {\n    const result = await db.select().from(workspaceInstances).where(eq(workspaceInstances.id, id));\n    return result[0];\n  }\n\n  async getWorkspaceInstanceByJourney(journeyId: number): Promise<WorkspaceInstance | undefined> {\n    const result = await db.select().from(workspaceInstances).where(eq(workspaceInstances.journeyId, journeyId));\n    return result[0];\n  }\n\n  async getUserWorkspaceInstances(userId: number): Promise<WorkspaceInstance[]> {\n    return db.select().from(workspaceInstances)\n      .where(eq(workspaceInstances.userId, userId))\n      .orderBy(desc(workspaceInstances.createdAt));\n  }\n\n  async createWorkspaceInstance(workspace: InsertWorkspaceInstance): Promise<WorkspaceInstance> {\n    const result = await db.insert(workspaceInstances).values(workspace).returning();\n    \n    await this.createWorkspacePhaseEvent({\n      workspaceId: result[0].id,\n      phase: 'onboarding',\n      status: 'started',\n      payload: {},\n    });\n    \n    return result[0];\n  }\n\n  async updateWorkspaceInstance(id: number, updates: Partial<WorkspaceInstance>): Promise<WorkspaceInstance | undefined> {\n    const result = await db.update(workspaceInstances)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(workspaceInstances.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getWorkspacePhaseEvents(workspaceId: number): Promise<WorkspacePhaseEvent[]> {\n    return db.select().from(workspacePhaseEvents)\n      .where(eq(workspacePhaseEvents.workspaceId, workspaceId))\n      .orderBy(desc(workspacePhaseEvents.createdAt));\n  }\n\n  async createWorkspacePhaseEvent(event: InsertWorkspacePhaseEvent): Promise<WorkspacePhaseEvent> {\n    const result = await db.insert(workspacePhaseEvents).values(event).returning();\n    return result[0];\n  }\n\n  async updateWorkspacePhaseEvent(id: number, updates: Partial<WorkspacePhaseEvent>): Promise<WorkspacePhaseEvent | undefined> {\n    const result = await db.update(workspacePhaseEvents)\n      .set(updates)\n      .where(eq(workspacePhaseEvents.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async getWorkspaceState(workspaceId: number): Promise<WorkspaceState | null> {\n    const workspace = await this.getWorkspaceInstance(workspaceId);\n    if (!workspace) return null;\n\n    const phaseHistory = await this.getWorkspacePhaseEvents(workspaceId);\n    \n    let currentSprint: Sprint | null = null;\n    if (workspace.currentSprintId) {\n      currentSprint = await this.getSprint(workspace.currentSprintId) || null;\n    }\n\n    const currentPhase = workspace.currentPhase as WorkspacePhase;\n    const phaseChecklist = this.getPhaseChecklist(currentPhase, workspace, currentSprint);\n    const nextActions = this.getPhaseNextActions(currentPhase, workspaceId, workspace.currentSprintId);\n\n    return {\n      workspace,\n      currentPhase,\n      currentSprint,\n      phaseChecklist,\n      nextActions,\n      phaseHistory,\n    };\n  }\n\n  private getPhaseChecklist(\n    phase: WorkspacePhase, \n    workspace: WorkspaceInstance,\n    currentSprint: Sprint | null\n  ): { item: string; completed: boolean; required: boolean }[] {\n    switch (phase) {\n      case 'onboarding': {\n        const onboardingProgress = (workspace.workspaceMetadata as any)?.onboardingProgress;\n        const teamIntrosComplete = onboardingProgress?.teamIntrosComplete || {};\n        const docsRead = onboardingProgress?.docsRead || {};\n        const comprehensionComplete = onboardingProgress?.comprehensionComplete || false;\n        \n        const allTeamIntrosComplete = Object.values(teamIntrosComplete).filter(Boolean).length >= 3;\n        const allDocsRead = Object.values(docsRead).filter(Boolean).length >= 4;\n        \n        return [\n          { item: 'Meet the team', completed: allTeamIntrosComplete, required: true },\n          { item: 'Read company documentation', completed: allDocsRead, required: true },\n          { item: 'Complete comprehension check', completed: comprehensionComplete, required: true },\n        ];\n      }\n      case 'planning':\n        return [\n          { item: 'Review product backlog', completed: false, required: true },\n          { item: 'Select priority items', completed: false, required: true },\n          { item: 'Set sprint goal', completed: !!currentSprint?.goal, required: true },\n          { item: 'Commit to sprint scope', completed: false, required: true },\n        ];\n      case 'execution':\n        return [\n          { item: 'Attend daily standup', completed: false, required: true },\n          { item: 'Complete assigned tickets', completed: false, required: true },\n          { item: 'Submit code for review', completed: false, required: false },\n        ];\n      case 'review':\n        return [\n          { item: 'Prepare demo', completed: false, required: true },\n          { item: 'Present completed work', completed: false, required: true },\n          { item: 'Receive stakeholder feedback', completed: false, required: true },\n        ];\n      case 'retro':\n        return [\n          { item: 'Share what went well', completed: false, required: true },\n          { item: 'Identify improvements', completed: false, required: true },\n          { item: 'Commit to action items', completed: false, required: true },\n        ];\n      default:\n        return [];\n    }\n  }\n\n  private getPhaseNextActions(\n    phase: WorkspacePhase,\n    workspaceId: number,\n    currentSprintId: number | null\n  ): { action: string; route: string; priority: 'primary' | 'secondary' }[] {\n    switch (phase) {\n      case 'onboarding':\n        return [\n          { action: 'Start Onboarding', route: `/workspace/${workspaceId}/onboarding`, priority: 'primary' },\n        ];\n      case 'planning':\n        return [\n          { action: 'Open Sprint Planning', route: `/workspace/${workspaceId}/planning`, priority: 'primary' },\n        ];\n      case 'execution':\n        return [\n          { action: 'Open Sprint Hub', route: `/sprint/${currentSprintId}`, priority: 'primary' },\n          { action: 'View Ceremonies', route: `/workspace/${workspaceId}/ceremonies`, priority: 'secondary' },\n        ];\n      case 'review':\n        return [\n          { action: 'Start Sprint Review', route: `/workspace/${workspaceId}/review`, priority: 'primary' },\n        ];\n      case 'retro':\n        return [\n          { action: 'Start Retrospective', route: `/workspace/${workspaceId}/retro`, priority: 'primary' },\n        ];\n      default:\n        return [];\n    }\n  }\n\n  async advanceWorkspacePhase(workspaceId: number, payload?: Record<string, unknown>): Promise<WorkspaceInstance | undefined> {\n    const workspace = await this.getWorkspaceInstance(workspaceId);\n    if (!workspace) return undefined;\n\n    const phaseOrder: WorkspacePhase[] = ['onboarding', 'planning', 'execution', 'review', 'retro'];\n    const currentIndex = phaseOrder.indexOf(workspace.currentPhase as WorkspacePhase);\n    \n    if (currentIndex === -1) return undefined;\n\n    await this.updateWorkspacePhaseEvent(\n      (await this.getWorkspacePhaseEvents(workspaceId))[0]?.id || 0,\n      { status: 'completed', completedAt: new Date(), payload: payload || {} }\n    );\n\n    let nextPhase: WorkspacePhase;\n    \n    if (workspace.currentPhase === 'onboarding') {\n      nextPhase = 'planning';\n      await this.updateWorkspaceInstance(workspaceId, { onboardingCompletedAt: new Date() });\n    } else if (workspace.currentPhase === 'retro') {\n      nextPhase = 'planning';\n    } else {\n      nextPhase = phaseOrder[currentIndex + 1];\n    }\n\n    await this.createWorkspacePhaseEvent({\n      workspaceId,\n      phase: nextPhase,\n      sprintId: workspace.currentSprintId,\n      status: 'started',\n      payload: {},\n    });\n\n    return this.updateWorkspaceInstance(workspaceId, { currentPhase: nextPhase });\n  }\n\n  // Phase 6: Planning Session operations\n  async getPlanningSession(id: number): Promise<PlanningSession | undefined> {\n    const [session] = await db.select().from(planningSessions).where(eq(planningSessions.id, id)).limit(1);\n    return session;\n  }\n\n  async getPlanningSessionByWorkspace(workspaceId: number): Promise<PlanningSession | undefined> {\n    const [session] = await db.select()\n      .from(planningSessions)\n      .where(and(\n        eq(planningSessions.workspaceId, workspaceId),\n        eq(planningSessions.status, 'active')\n      ))\n      .orderBy(desc(planningSessions.startedAt))\n      .limit(1);\n    return session;\n  }\n\n  async createPlanningSession(session: InsertPlanningSession): Promise<PlanningSession> {\n    const [created] = await db.insert(planningSessions).values(session).returning();\n    return created;\n  }\n\n  async updatePlanningSession(id: number, updates: Partial<PlanningSession>): Promise<PlanningSession | undefined> {\n    const [updated] = await db.update(planningSessions)\n      .set(updates)\n      .where(eq(planningSessions.id, id))\n      .returning();\n    return updated;\n  }\n\n  // Phase 6: Planning Message operations\n  async getPlanningMessages(sessionId: number): Promise<PlanningMessage[]> {\n    return db.select()\n      .from(planningMessages)\n      .where(eq(planningMessages.sessionId, sessionId))\n      .orderBy(planningMessages.createdAt);\n  }\n\n  async createPlanningMessage(message: InsertPlanningMessage): Promise<PlanningMessage> {\n    const [created] = await db.insert(planningMessages).values(message).returning();\n    return created;\n  }\n\n  // Phase 6: Planning Session State\n  async getPlanningSessionState(workspaceId: number): Promise<PlanningSessionState | null> {\n    const session = await this.getPlanningSessionByWorkspace(workspaceId);\n    if (!session) return null;\n\n    const messages = await this.getPlanningMessages(session.id);\n    const workspace = await this.getWorkspaceInstance(workspaceId);\n    if (!workspace) return null;\n\n    const selectedItemIds = (session.selectedItems as string[]) || [];\n\n    const backlogItems = [\n      {\n        id: 'TICK-001',\n        title: 'Fix timezone display bug in user settings',\n        description: 'Users in different timezones see incorrect timestamps',\n        type: 'bug' as const,\n        priority: 'high' as const,\n        points: 3,\n        selected: selectedItemIds.includes('TICK-001')\n      },\n      {\n        id: 'TICK-002',\n        title: 'Implement user notifications',\n        description: 'Add in-app notification system for activity updates',\n        type: 'feature' as const,\n        priority: 'high' as const,\n        points: 5,\n        selected: selectedItemIds.includes('TICK-002')\n      },\n      {\n        id: 'TICK-003',\n        title: 'Improve loading state feedback',\n        description: 'Add skeleton loaders for better UX during data fetches',\n        type: 'improvement' as const,\n        priority: 'medium' as const,\n        points: 2,\n        selected: selectedItemIds.includes('TICK-003')\n      },\n      {\n        id: 'TICK-004',\n        title: 'Fix null check in payment flow',\n        description: 'Payment occasionally fails due to missing null checks',\n        type: 'bug' as const,\n        priority: 'high' as const,\n        points: 2,\n        selected: selectedItemIds.includes('TICK-004')\n      },\n      {\n        id: 'TICK-005',\n        title: 'Add pagination to user list',\n        description: 'User list becomes slow with many users, needs pagination',\n        type: 'feature' as const,\n        priority: 'medium' as const,\n        points: 3,\n        selected: selectedItemIds.includes('TICK-005')\n      }\n    ];\n\n    const adapter = getSprintPlanningAdapter(session.role, session.level);\n\n    return {\n      session,\n      messages,\n      backlogItems,\n      capacity: 10,\n      adapterConfig: {\n        role: session.role,\n        level: session.level,\n        facilitator: session.role === 'pm' ? 'user' : 'ai',\n        showLearningObjectives: session.level === 'intern' || session.level === 'junior',\n        showKnowledgeCheck: session.level === 'intern',\n        canSkipPhases: session.level === 'mid' || session.level === 'senior',\n        engagement: adapter.engagement,\n      }\n    };\n  }\n}\n\nexport const storage = new MemStorage();\n","path":null,"size_bytes":171490,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":1921,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2254,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":23567,"size_tokens":null},"server/services/groq.ts":{"content":"import Groq from \"groq-sdk\";\n\n// Using Groq for fast AI inference with llama models\nconst groq = new Groq({ \n  apiKey: process.env.GROQ_API_KEY\n});\n\nexport interface InterviewQuestion {\n  question: string;\n  category: string;\n  difficulty: string;\n  expectedAnswer?: string;\n}\n\nexport interface InterviewFeedback {\n  score: number;\n  strengths: string[];\n  improvements: string[];\n  overallFeedback: string;\n}\n\nexport interface NegotiationResponse {\n  response: string;\n  sentiment: string;\n  strategy: string;\n  counterOffer?: any;\n}\n\nexport class GroqService {\n  async generateInterviewQuestion(\n    profession: string,\n    interviewType: string,\n    difficulty: string,\n    jobPosting?: string,\n    previousQuestions: string[] = []\n  ): Promise<InterviewQuestion> {\n    const prompt = `Generate a ${difficulty}-level ${interviewType} interview question for a ${profession} position.\n    ${jobPosting ? `Job posting context: ${jobPosting}` : ''}\n    ${previousQuestions.length > 0 ? `Avoid these previously asked questions: ${previousQuestions.join(', ')}` : ''}\n    \n    Respond with JSON in this format: {\n      \"question\": \"specific interview question\",\n      \"category\": \"technical/behavioral/system-design/culture-fit\",\n      \"difficulty\": \"${difficulty}\",\n      \"expectedAnswer\": \"brief guidance on what a good answer would include\"\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert interviewer who creates realistic and challenging interview questions.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as InterviewQuestion;\n    } catch (error) {\n      console.log('Using fallback question generation due to API error');\n      return this.getFallbackQuestion(profession, interviewType, difficulty, previousQuestions);\n    }\n  }\n\n  private getFallbackQuestion(profession: string, interviewType: string, difficulty: string, previousQuestions: string[]): InterviewQuestion {\n    const questionBank = {\n      \"Software Engineer\": {\n        \"Technical Interview\": {\n          junior: [\n            \"What is the difference between let, const, and var in JavaScript?\",\n            \"Explain the concept of closures in JavaScript with an example.\",\n            \"How would you reverse a string in your preferred programming language?\"\n          ],\n          mid: [\n            \"Design a REST API for a simple e-commerce application. What endpoints would you create?\",\n            \"Explain the difference between SQL and NoSQL databases. When would you use each?\",\n            \"How would you implement a simple caching mechanism in a web application?\"\n          ],\n          senior: [\n            \"How would you design a system to handle 1 million concurrent users?\",\n            \"Explain microservices architecture and its trade-offs compared to monolithic design.\",\n            \"Describe your approach to implementing real-time features in a web application.\"\n          ]\n        },\n        \"Behavioral Interview\": {\n          junior: [\n            \"Tell me about your experience working in a team.\",\n            \"Describe a challenging project you worked on.\",\n            \"How do you handle tight deadlines?\"\n          ],\n          mid: [\n            \"Tell me about a time when you had to learn a new technology quickly.\",\n            \"Describe a situation where you had to solve a complex problem.\",\n            \"How do you approach code reviews?\"\n          ],\n          senior: [\n            \"Tell me about a time when you had to make a difficult technical decision.\",\n            \"Describe your experience mentoring junior developers.\",\n            \"How do you handle disagreements with team members about technical approaches?\"\n          ]\n        }\n      },\n      \"Product Manager\": {\n        \"Behavioral Interview\": {\n          junior: [\n            \"Tell me about your experience with product development.\",\n            \"How do you prioritize features?\",\n            \"Describe a time when you had to work with engineers.\"\n          ],\n          mid: [\n            \"Tell me about a product you launched and its results.\",\n            \"How do you handle competing stakeholder demands?\",\n            \"Describe your approach to user research.\"\n          ],\n          senior: [\n            \"Tell me about a time when you had to pivot a product strategy.\",\n            \"How do you measure product success?\",\n            \"Describe your experience building and leading product teams.\"\n          ]\n        }\n      }\n    };\n\n    const professionQuestions = questionBank[profession as keyof typeof questionBank] || questionBank[\"Software Engineer\"];\n    const typeQuestions = professionQuestions[interviewType as keyof typeof professionQuestions] || professionQuestions[\"Behavioral Interview\"];\n    const difficultyQuestions = typeQuestions[difficulty as keyof typeof typeQuestions] || typeQuestions.mid;\n\n    // Filter out previously asked questions\n    const availableQuestions = difficultyQuestions.filter(q => !previousQuestions.includes(q));\n    const question = availableQuestions.length > 0 \n      ? availableQuestions[Math.floor(Math.random() * availableQuestions.length)]\n      : difficultyQuestions[Math.floor(Math.random() * difficultyQuestions.length)];\n\n    return {\n      question,\n      category: interviewType.toLowerCase().includes('technical') ? 'technical' : 'behavioral',\n      difficulty,\n      expectedAnswer: \"Provide a clear, structured answer with specific examples and demonstrate your understanding of the topic.\"\n    };\n  }\n\n  async evaluateInterviewAnswer(\n    question: string,\n    answer: string,\n    difficulty: string\n  ): Promise<{ score: number; feedback: string; followUp?: string }> {\n    const prompt = `Evaluate this interview answer:\n    Question: ${question}\n    Answer: ${answer}\n    Difficulty: ${difficulty}\n    \n    Provide a score (0-100) and constructive feedback. Format as JSON:\n    {\n      \"score\": number,\n      \"feedback\": \"detailed feedback on the answer\",\n      \"followUp\": \"optional follow-up question to dive deeper\"\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert interviewer providing constructive feedback on interview answers.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        score: result.score || 75,\n        feedback: result.feedback || \"Good answer with room for improvement.\",\n        followUp: result.followUp\n      };\n    } catch (error) {\n      console.log('Using fallback evaluation due to API error');\n      return this.getFallbackEvaluation(question, answer, difficulty);\n    }\n  }\n\n  private getFallbackEvaluation(question: string, answer: string, difficulty: string): { score: number; feedback: string; followUp?: string } {\n    const answerLength = answer.trim().length;\n    let baseScore = 60;\n    \n    if (answerLength > 200) baseScore += 15;\n    else if (answerLength > 100) baseScore += 10;\n    else if (answerLength > 50) baseScore += 5;\n    \n    if (difficulty === 'senior') baseScore = Math.min(baseScore, 80);\n    else if (difficulty === 'junior') baseScore += 10;\n    \n    const score = Math.min(90, Math.max(40, baseScore + Math.floor(Math.random() * 20) - 10));\n    \n    const feedbackOptions = [\n      \"Your answer shows good understanding. Consider providing more specific examples to strengthen your response.\",\n      \"Good response overall. Try to elaborate more on the technical details and your thought process.\",\n      \"Nice approach to the question. Adding more context about your experience would make this even stronger.\",\n      \"Solid answer. Consider discussing potential challenges and how you'd address them.\",\n      \"Good foundation. Try to connect your answer more directly to real-world scenarios.\"\n    ];\n    \n    return {\n      score,\n      feedback: feedbackOptions[Math.floor(Math.random() * feedbackOptions.length)],\n      followUp: score > 70 ? \"Can you tell me about a specific time when you applied this approach?\" : undefined\n    };\n  }\n\n  async generateNegotiationResponse(\n    scenario: string,\n    userMessage: string,\n    counterpartStyle: string,\n    conversationHistory: string[] = []\n  ): Promise<NegotiationResponse> {\n    const prompt = `You are roleplaying as a ${counterpartStyle} negotiation counterpart in this scenario: ${scenario}\n    \n    Conversation history: ${conversationHistory.join(' | ')}\n    User's latest message: ${userMessage}\n    \n    Respond in character with a realistic negotiation response. Format as JSON:\n    {\n      \"response\": \"your negotiation response\",\n      \"sentiment\": \"cooperative/competitive/neutral\",\n      \"strategy\": \"brief description of negotiation strategy used\",\n      \"counterOffer\": \"any specific counter-proposal if applicable\"\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert negotiator roleplaying different negotiation styles realistically.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as NegotiationResponse;\n    } catch (error) {\n      console.log('Using fallback negotiation response due to API error');\n      return this.getFallbackNegotiationResponse(scenario, userMessage, counterpartStyle);\n    }\n  }\n\n  private getFallbackNegotiationResponse(scenario: string, userMessage: string, counterpartStyle: string): NegotiationResponse {\n    const responses = {\n      cooperative: [\n        \"I appreciate your perspective. Let's see how we can find a solution that works for both of us.\",\n        \"That's an interesting point. I'd like to explore how we might address both of our concerns here.\",\n        \"I hear what you're saying. Let me share my thoughts and see where we might find common ground.\"\n      ],\n      competitive: [\n        \"I understand your position, but I need to be clear about our requirements and constraints.\",\n        \"I appreciate the offer, but we need to discuss this further. Here's what I'm thinking...\",\n        \"That's one way to look at it. However, from our perspective, we need to consider...\"\n      ],\n      analytical: [\n        \"Let me break down the key factors we should consider in this decision.\",\n        \"I'd like to examine the data behind this proposal more carefully.\",\n        \"Before we proceed, let's analyze the potential outcomes of different approaches.\"\n      ]\n    };\n\n    const styleResponses = responses[counterpartStyle as keyof typeof responses] || responses.cooperative;\n    const response = styleResponses[Math.floor(Math.random() * styleResponses.length)];\n\n    return {\n      response,\n      sentiment: counterpartStyle === 'competitive' ? 'competitive' : counterpartStyle === 'cooperative' ? 'cooperative' : 'neutral',\n      strategy: `Using ${counterpartStyle} approach to maintain dialogue while protecting interests`,\n      counterOffer: userMessage.toLowerCase().includes('price') || userMessage.toLowerCase().includes('cost') \n        ? \"Let's discuss the value proposition and see if we can find a mutually beneficial arrangement\"\n        : undefined\n    };\n  }\n\n  async generateWorkspaceMessage(\n    scenario: string,\n    userMessage: string,\n    character: string,\n    messageType: string\n  ): Promise<{ content: string; sender: string; type: string }> {\n    const prompt = `You are ${character} in this workplace scenario: ${scenario}\n    \n    User sent: ${userMessage}\n    Message type: ${messageType}\n    \n    Respond in character with a realistic workplace message. Format as JSON:\n    {\n      \"content\": \"your response message\",\n      \"sender\": \"${character}\",\n      \"type\": \"${messageType}\"\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are roleplaying workplace scenarios with realistic professional communication.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        content: result.content || \"Thanks for your message. Let me get back to you on this.\",\n        sender: character,\n        type: messageType\n      };\n    } catch (error) {\n      console.log('Using fallback workspace message due to API error');\n      \n      const fallbackMessages = [\n        \"Thanks for bringing this to my attention. Let me review and get back to you.\",\n        \"I appreciate you reaching out. Let's schedule some time to discuss this further.\",\n        \"Good point. I'll need to coordinate with the team on this one.\",\n        \"Thanks for the update. Let me know if you need any support on this.\",\n        \"I'll take a look at this and circle back with you soon.\"\n      ];\n      \n      return {\n        content: fallbackMessages[Math.floor(Math.random() * fallbackMessages.length)],\n        sender: character,\n        type: messageType\n      };\n    }\n  }\n\n  async transcribeAudio(audioBuffer: Buffer, mimeType: string = 'audio/webm'): Promise<{ text: string }> {\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('GROQ_API_KEY not configured');\n      }\n\n      // Import FormData for Node.js\n      const { FormData } = await import('formdata-node');\n      const { Blob } = await import('formdata-node');\n\n      const formData = new FormData();\n      formData.append('file', new Blob([audioBuffer], { type: mimeType }), 'recording.webm');\n      formData.append('model', 'whisper-large-v3');\n      formData.append('response_format', 'json');\n      formData.append('language', 'en');\n\n      const response = await fetch('https://api.groq.com/openai/v1/audio/transcriptions', {\n        method: 'POST',\n        headers: {\n          'Authorization': `Bearer ${process.env.GROQ_API_KEY}`,\n        },\n        body: formData as any\n      });\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('Groq API error response:', errorText);\n        throw new Error(`Groq API error: ${response.status} ${response.statusText} - ${errorText}`);\n      }\n\n      const result = await response.json();\n      console.log('Groq transcription result:', result);\n      return { text: result.text || '' };\n    } catch (error) {\n      console.error('Groq transcription error:', error);\n      throw new Error('Failed to transcribe audio: ' + (error as Error).message);\n    }\n  }\n\n  async generateSessionFeedback(\n    sessionType: string,\n    messages: any[],\n    score: number\n  ): Promise<{\n    score: number;\n    summary: string;\n    strengths: string[];\n    improvements: string[];\n    nextSteps: string[];\n  }> {\n    const prompt = `Analyze this ${sessionType} simulation session and provide comprehensive feedback:\n    \n    Session messages: ${JSON.stringify(messages.slice(-10))} // Last 10 messages\n    Performance score: ${score}\n    \n    Provide detailed feedback in JSON format:\n    {\n      \"score\": number,\n      \"summary\": \"overall session summary\",\n      \"strengths\": [\"strength1\", \"strength2\", \"strength3\"],\n      \"improvements\": [\"improvement1\", \"improvement2\", \"improvement3\"],\n      \"nextSteps\": [\"next step 1\", \"next step 2\", \"next step 3\"]\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert coach providing detailed feedback on professional simulation sessions.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        score: result.score || score,\n        summary: result.summary || `Completed ${sessionType} simulation session.`,\n        strengths: result.strengths || [\"Active participation\", \"Good engagement\", \"Completion of session\"],\n        improvements: result.improvements || [\"More detailed responses\", \"Clearer explanations\", \"Better examples\"],\n        nextSteps: result.nextSteps || [`Try another ${sessionType} session`, \"Practice specific skills\", \"Review feedback\"]\n      };\n    } catch (error) {\n      console.log('Using fallback session feedback due to API error');\n      \n      return {\n        score,\n        summary: `Completed ${sessionType} simulation with ${messages.length} interactions. Good overall engagement.`,\n        strengths: [\n          \"Active participation in the simulation\",\n          \"Consistent engagement with scenarios\",\n          \"Completion of the full session\"\n        ],\n        improvements: [\n          \"Consider providing more detailed responses\",\n          \"Practice explaining reasoning more thoroughly\", \n          \"Try to incorporate specific examples\"\n        ],\n        nextSteps: [\n          `Try another ${sessionType} session with different parameters`,\n          \"Explore other simulation types to build comprehensive skills\",\n          \"Review feedback and focus on improvement areas\"\n        ]\n      };\n    }\n  }\n\n  async generateCustomerSupportMessage(\n    stage: string,\n    persona: string,\n    problem: string,\n    agentMessage?: string,\n    conversationHistory?: any[],\n    isInitial?: boolean,\n    stageTransition?: boolean\n  ): Promise<{ message: string; sentiment: string }> {\n    const conversationCount = conversationHistory ? conversationHistory.length : 0;\n    \n    // Always use contextual fallback for more consistent conversation flow\n    console.log('Generating contextual customer message');\n    return this.getContextualCustomerMessage(stage, persona, problem, agentMessage, isInitial, stageTransition, conversationCount);\n  }\n\n  async evaluateCustomerSupportResponse(\n    stage: string,\n    agentMessage: string,\n    customerPersona: string,\n    problem: string,\n    conversationHistory: any[]\n  ): Promise<{ empathyScore: number; clarityScore: number; feedback: string }> {\n    const prompt = `Evaluate this customer support agent's response:\n    \n    Stage: ${stage}\n    Customer Persona: ${customerPersona}\n    Problem: ${problem}\n    Agent Message: \"${agentMessage}\"\n    \n    Rate the response on:\n    1. Empathy (1-10): How well does the agent show understanding and care?\n    2. Clarity (1-10): How clear and easy to understand is the response?\n    \n    Provide brief feedback on strengths and areas for improvement.\n    \n    Format as JSON:\n    {\n      \"empathyScore\": number,\n      \"clarityScore\": number,\n      \"feedback\": \"brief constructive feedback\"\n    }`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert customer support trainer providing feedback on agent performance.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        empathyScore: result.empathyScore || 7,\n        clarityScore: result.clarityScore || 7,\n        feedback: result.feedback || \"Good response overall.\"\n      };\n    } catch (error) {\n      console.log('Using fallback evaluation due to API error');\n      return this.getFallbackSupportEvaluation(agentMessage, stage);\n    }\n  }\n\n  private detectSentiment(message: string, persona: string): string {\n    const lowerMessage = message.toLowerCase();\n    \n    if (persona.includes('angry') || lowerMessage.includes('frustrated') || lowerMessage.includes('angry')) {\n      return 'angry';\n    } else if (lowerMessage.includes('thank') || lowerMessage.includes('great') || lowerMessage.includes('perfect')) {\n      return 'happy';\n    } else if (lowerMessage.includes('confused') || lowerMessage.includes('understand') || lowerMessage.includes('what')) {\n      return 'confused';\n    } else {\n      return 'neutral';\n    }\n  }\n\n  private getFallbackCustomerMessage(stage: string, persona: string, problem: string, isInitial?: boolean, conversationCount: number = 0): { message: string; sentiment: string } {\n    const personaKey = persona.includes('angry') ? 'angry' : \n                     persona.includes('polite') ? 'polite' : \n                     persona.includes('confused') ? 'confused' :\n                     persona.includes('elderly') ? 'elderly' :\n                     persona.includes('urgent') ? 'urgent' : 'polite';\n    \n    // Generate contextual responses based on conversation flow\n    const responseTemplates = {\n      angry: {\n        initial: [\n          \"This is absolutely ridiculous! I've been trying to resolve this for hours and nothing works!\",\n          \"I'm extremely frustrated! Your system has been down and I need this fixed immediately!\",\n          \"This is unacceptable! I've been dealing with this issue all day and getting nowhere!\"\n        ],\n        responses: [\n          \"Look, I appreciate you trying to help, but I need actual solutions, not just sympathy.\",\n          \"Can you please just fix this instead of asking me more questions?\",\n          \"I've already explained this twice. When will this actually be resolved?\",\n          \"This is taking way too long. What exactly are you going to do about it?\",\n          \"I don't have time for this runaround. Give me a straight answer!\"\n        ]\n      },\n      polite: {\n        initial: [\n          \"Hello, I'm having an issue that I was hoping you could help me with.\",\n          \"Hi there, I'm experiencing a problem and would appreciate your assistance.\",\n          \"Good day, I have a concern that I need help resolving.\"\n        ],\n        responses: [\n          \"Thank you for explaining that. Could you help me with the next steps?\",\n          \"I appreciate your patience. What should I do from here?\",\n          \"That makes sense. Is there anything else I need to know?\",\n          \"Thank you for the clarification. How long might this take to resolve?\",\n          \"I understand. What would be the best way to proceed?\"\n        ]\n      },\n      confused: {\n        initial: [\n          \"Um, hi... I'm not really sure what's going on but something isn't working right.\",\n          \"Hello, I'm having some kind of problem but I'm not sure how to explain it.\",\n          \"Hi, something seems wrong but I don't really understand what happened.\"\n        ],\n        responses: [\n          \"I'm sorry, I don't really understand what you mean. Could you explain that differently?\",\n          \"That sounds complicated. Can you walk me through it step by step?\",\n          \"I'm still not sure I follow. Could you say that in simpler terms?\",\n          \"Okay, I think I'm getting it, but what exactly do I need to click?\",\n          \"I'm trying to follow along, but where exactly should I be looking?\"\n        ]\n      },\n      elderly: {\n        initial: [\n          \"Hello dear, I'm having trouble with this computer thing and I don't know what to do.\",\n          \"Hi, I'm not very good with technology and something's not working properly.\",\n          \"Excuse me, I need help but I'm not sure how to explain what's wrong.\"\n        ],\n        responses: [\n          \"I'm sorry, could you please speak more slowly? I'm not good with these technical terms.\",\n          \"That sounds very complicated. Is there a simpler way to do this?\",\n          \"I'm trying to follow but where exactly is this button you mentioned?\",\n          \"Could you please repeat that? I want to make sure I understand correctly.\",\n          \"This is all very confusing for me. Can we go through it one step at a time?\"\n        ]\n      },\n      urgent: {\n        initial: [\n          \"I need help immediately! This is extremely time-sensitive and I'm running out of time!\",\n          \"This is urgent! I have a deadline in an hour and nothing is working!\",\n          \"Please help me quickly! I'm in the middle of something important and this broke!\"\n        ],\n        responses: [\n          \"Okay, but can we please speed this up? I really don't have much time.\",\n          \"That sounds like it might work, but how quickly can we get this resolved?\",\n          \"I understand, but is there a faster way to do this? Time is really critical here.\",\n          \"Alright, I'll try that, but what if it doesn't work? I need a backup plan.\",\n          \"Good, that seems to be working. What's the next step to finish this quickly?\"\n        ]\n      }\n    };\n\n    if (isInitial) {\n      const initialMessages = responseTemplates[personaKey]?.initial || responseTemplates.polite.initial;\n      const message = initialMessages[Math.floor(Math.random() * initialMessages.length)];\n      const sentiment = personaKey === 'angry' ? 'angry' : \n                       personaKey === 'urgent' ? 'stressed' :\n                       personaKey === 'polite' ? 'neutral' : 'confused';\n      return { message, sentiment };\n    }\n\n    // For follow-up responses, use different messages based on conversation count\n    const responses = responseTemplates[personaKey]?.responses || responseTemplates.polite.responses;\n    const messageIndex = Math.min(Math.floor(conversationCount / 2), responses.length - 1);\n    const message = responses[messageIndex];\n    \n    const sentiment = personaKey === 'angry' ? 'frustrated' : \n                     personaKey === 'urgent' ? 'impatient' :\n                     personaKey === 'polite' ? 'cooperative' : 'confused';\n\n    return { message, sentiment };\n  }\n\n  private getFallbackSupportEvaluation(agentMessage: string, stage: string): { empathyScore: number; clarityScore: number; feedback: string; suggestedResponse?: string } {\n    const messageLength = agentMessage.length;\n    const agentLower = agentMessage.toLowerCase();\n    let empathyScore = 5;\n    let clarityScore = 5;\n    let feedback = \"Try to be more helpful and specific.\";\n    let suggestedResponse = \"\";\n\n    // Analyze response quality and provide specific feedback\n    if (messageLength < 20) {\n      empathyScore = Math.floor(Math.random() * 3) + 3; // 3-5 for very short responses\n      clarityScore = Math.floor(Math.random() * 3) + 3;\n      feedback = \" Response too brief. Customers need detailed explanations, acknowledgment of their frustration, and clear next steps.\";\n      suggestedResponse = this.generateBetterAgentResponse(agentMessage, stage, 'brief');\n    } else if (messageLength < 50) {\n      empathyScore = Math.floor(Math.random() * 3) + 4; // 4-6 for short responses\n      clarityScore = Math.floor(Math.random() * 3) + 4;\n      feedback = \"Response lacks detail. Add empathy, acknowledge the customer's concern, and provide specific solutions.\";\n      suggestedResponse = this.generateBetterAgentResponse(agentMessage, stage, 'short');\n    } else {\n      // Longer responses get better base scores\n      empathyScore = 6;\n      clarityScore = 6;\n      \n      // Bonus points for empathetic language\n      if (agentLower.includes('sorry') || agentLower.includes('apologize') || agentLower.includes('understand')) {\n        empathyScore += 2;\n        feedback = \"Good empathetic language. \";\n      }\n      \n      // Bonus for helpful content\n      if (agentLower.includes('help') || agentLower.includes('resolve') || agentLower.includes('solution')) {\n        clarityScore += 2;\n        feedback += \"Shows commitment to helping. \";\n      }\n      \n      // Bonus for asking questions\n      if (agentMessage.includes('?')) {\n        empathyScore += 1;\n        feedback += \"Good use of questions to understand the issue better.\";\n      }\n      \n      if (feedback === \"Try to be more helpful and specific.\") {\n        feedback = \"Professional response. Consider adding more empathy and specific action steps.\";\n      }\n    }\n    \n    empathyScore = Math.min(10, Math.max(1, empathyScore));\n    clarityScore = Math.min(10, Math.max(1, clarityScore));\n    \n    return {\n      empathyScore,\n      clarityScore,\n      feedback,\n      suggestedResponse\n    };\n  }\n\n  private generateBetterAgentResponse(originalMessage: string, stage: string, issueType: string): string {\n    const responses = {\n      brief: [\n        \"I sincerely apologize for the frustration this has caused you. I understand you've already explained this issue twice, and I want to make sure we resolve it properly this time. Let me review your case and provide you with a clear timeline and solution. I'll personally ensure this gets the attention it deserves.\",\n        \"I completely understand your frustration, and I apologize that you've had to repeat this information. This is clearly taking longer than it should, and that's not acceptable. Let me take immediate action to resolve this for you. Here's exactly what I'm going to do and when you can expect results.\",\n        \"Thank you for your patience, and I'm sorry this hasn't been resolved yet. I can see why you're frustrated - no one should have to explain the same issue multiple times. I'm going to prioritize your case right now and walk you through the exact steps to get this fixed today.\"\n      ],\n      short: [\n        \"I understand this situation is frustrating, especially having to repeat the same information. Let me assure you that I'm committed to resolving this properly. Based on what you've shared, here's the specific action plan I'm implementing to fix this issue permanently.\",\n        \"I appreciate your patience and I can see why this delay is concerning. You deserve a clear answer about timing and next steps. Let me provide you with specific details about the resolution process and realistic timeframes for when this will be completely resolved.\",\n        \"Thank you for bringing this to my attention again. I want to make sure we address not just the immediate issue, but also why this has taken multiple contacts to resolve. Here's my plan to fix both the problem and prevent this from happening again.\"\n      ]\n    };\n\n    const responseType = issueType as keyof typeof responses;\n    const options = responses[responseType] || responses.brief;\n    return options[Math.floor(Math.random() * options.length)];\n  }\n\n  private getContextualCustomerMessage(\n    stage: string,\n    persona: string,\n    problem: string,\n    agentMessage?: string,\n    isInitial?: boolean,\n    stageTransition?: boolean,\n    conversationCount: number = 0\n  ): { message: string; sentiment: string } {\n    const personaKey = persona.includes('angry') ? 'angry' : \n                     persona.includes('polite') ? 'polite' : \n                     persona.includes('confused') ? 'confused' :\n                     persona.includes('elderly') ? 'elderly' :\n                     persona.includes('urgent') ? 'urgent' : 'polite';\n\n    if (isInitial) {\n      return this.getFallbackCustomerMessage(stage, persona, problem, true, 0);\n    }\n\n    // Analyze agent message to provide realistic customer responses\n    if (agentMessage) {\n      const agentLower = agentMessage.toLowerCase();\n      const messageLength = agentMessage.length;\n      \n      // React to very short responses (like \"In 1 minute\")\n      if (messageLength < 20) {\n        return this.generateShortResponseReaction(personaKey, agentMessage, conversationCount);\n      }\n      \n      // React to different types of agent responses\n      if (agentLower.includes('sorry') || agentLower.includes('apologize')) {\n        return this.generateApologyResponse(personaKey, conversationCount);\n      } else if (agentLower.includes('try') || agentLower.includes('can you') || agentLower.includes('please')) {\n        return this.generateActionResponse(personaKey, conversationCount);\n      } else if (agentLower.includes('understand') || agentLower.includes('let me') || agentLower.includes('see')) {\n        return this.generateUnderstandingResponse(personaKey, conversationCount);\n      } else if (agentLower.includes('help') || agentLower.includes('assist') || agentLower.includes('resolve')) {\n        return this.generateHelpResponse(personaKey, conversationCount);\n      } else if (agentMessage.includes('?')) {\n        return this.generateQuestionResponse(personaKey, problem, conversationCount);\n      } else if (agentLower.includes('minute') || agentLower.includes('time') || agentLower.includes('wait')) {\n        return this.generateTimeResponse(personaKey, agentMessage, conversationCount);\n      }\n    }\n\n    // Default contextual response\n    return this.getFallbackCustomerMessage(stage, persona, problem, false, conversationCount);\n  }\n\n  private generateApologyResponse(personaKey: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"Well, it's about time someone acknowledged this mess!\",\n        \"I appreciate that, but I need this fixed, not just apologies.\",\n        \"Look, saying sorry is fine, but what are you going to do about it?\"\n      ],\n      polite: [\n        \"Thank you for the apology. I understand these things happen.\",\n        \"I appreciate that. Can we work together to solve this?\",\n        \"That's okay, I just want to get this resolved.\"\n      ],\n      confused: [\n        \"Oh, okay... but I'm still not sure what went wrong.\",\n        \"I don't really understand what happened, but thank you.\",\n        \"It's fine, I guess. Can you explain what the problem was?\"\n      ],\n      elderly: [\n        \"Well, I appreciate you saying that, dear.\",\n        \"Thank you for being honest. These computer things are so complicated.\",\n        \"That's alright. I know I'm not good with technology.\"\n      ],\n      urgent: [\n        \"Okay, but can we please focus on fixing this quickly?\",\n        \"I appreciate that, but time is really critical here.\",\n        \"Fine, but I really need this resolved immediately.\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'frustrated' : \n                     personaKey === 'urgent' ? 'impatient' : 'understanding';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateActionResponse(personaKey: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"Fine, I'll try it, but this better work this time!\",\n        \"Alright, but if this doesn't work, I want to speak to a manager.\",\n        \"I've tried so many things already, but sure, let's do this.\"\n      ],\n      polite: [\n        \"Of course, I'll try that right now. Thank you for the suggestion.\",\n        \"That sounds reasonable. Let me give that a try.\",\n        \"Sure, I'm willing to try anything that might help.\"\n      ],\n      confused: [\n        \"Um, okay... where exactly do I do that?\",\n        \"I'm not sure I understand, but I'll try my best.\",\n        \"Could you walk me through that step by step?\"\n      ],\n      elderly: [\n        \"I'll try, but could you please tell me exactly where to click?\",\n        \"This sounds complicated. Can you help me through it?\",\n        \"I'm not sure I can do that on my own. Could you guide me?\"\n      ],\n      urgent: [\n        \"Okay, I'll try that quickly. How long should this take?\",\n        \"Fine, but please tell me this will be fast.\",\n        \"Alright, doing it now. What if it doesn't work?\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'reluctant' : \n                     personaKey === 'urgent' ? 'anxious' : 'cooperative';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateUnderstandingResponse(personaKey: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"Good, finally someone who gets it. Now what's the solution?\",\n        \"Yes, exactly! So how are we going to fix this?\",\n        \"Right, you understand the problem. What's next?\"\n      ],\n      polite: [\n        \"Yes, that's exactly right. I'm glad you understand.\",\n        \"Thank you for taking the time to understand my situation.\",\n        \"Perfect, you've got it. What should we do next?\"\n      ],\n      confused: [\n        \"I think so... maybe? I'm still a bit lost though.\",\n        \"Kind of, but I'm not really sure about some parts.\",\n        \"I hope you understand it better than I do!\"\n      ],\n      elderly: [\n        \"I hope you understand it, because I certainly don't!\",\n        \"Yes, you seem to know what you're talking about.\",\n        \"That's good, dear. I trust you know what to do.\"\n      ],\n      urgent: [\n        \"Great, you get it. Now can we fix this quickly?\",\n        \"Perfect. How fast can we resolve this?\",\n        \"Good, you understand the urgency. What's the quickest solution?\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'hopeful' : \n                     personaKey === 'urgent' ? 'expectant' : 'relieved';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateHelpResponse(personaKey: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"Yes, I definitely need help! This has been a nightmare.\",\n        \"Finally! Yes, I need help getting this sorted out.\",\n        \"Absolutely, I've been trying to get help for hours!\"\n      ],\n      polite: [\n        \"Yes, I would really appreciate your help with this.\",\n        \"That would be wonderful, thank you so much.\",\n        \"Yes please, I'd be very grateful for your assistance.\"\n      ],\n      confused: [\n        \"Yes, I really need help. I don't know what I'm doing.\",\n        \"Please, I'm so lost and don't understand any of this.\",\n        \"Yes, I definitely need someone to help me figure this out.\"\n      ],\n      elderly: [\n        \"Oh yes, please help me. I'm terrible with these things.\",\n        \"I would appreciate that so much. Technology confuses me.\",\n        \"Yes, please be patient with me. I learn slowly.\"\n      ],\n      urgent: [\n        \"Yes, urgent help! I need this fixed immediately!\",\n        \"Please help me quickly! Time is running out!\",\n        \"Yes, but I need fast help. This can't wait much longer.\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'desperate' : \n                     personaKey === 'urgent' ? 'stressed' : 'hopeful';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateQuestionResponse(personaKey: string, problem: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"Look, I already explained this. The issue is with \" + problem.substring(0, 50) + \"...\",\n        \"I told you already! Why do I have to keep repeating myself?\",\n        \"Are you even listening? I said the problem is \" + problem.substring(0, 30) + \"...\"\n      ],\n      polite: [\n        \"Of course! The issue I'm having is: \" + problem.substring(0, 60) + \"...\",\n        \"Sure, let me explain. \" + problem.substring(0, 50) + \"...\",\n        \"Yes, to clarify: \" + problem.substring(0, 55) + \"...\"\n      ],\n      confused: [\n        \"Um, I think the problem is... \" + problem.substring(0, 40) + \"... but I'm not sure.\",\n        \"Well, something about \" + problem.substring(0, 35) + \"... I think?\",\n        \"I'm not really sure how to explain it, but \" + problem.substring(0, 30) + \"...\"\n      ],\n      elderly: [\n        \"Well, I think it has something to do with \" + problem.substring(0, 40) + \"...\",\n        \"Let me try to explain... \" + problem.substring(0, 45) + \"...\",\n        \"I'm not sure I can explain it properly, but \" + problem.substring(0, 35) + \"...\"\n      ],\n      urgent: [\n        \"Yes! \" + problem.substring(0, 50) + \"... and I need it fixed NOW!\",\n        \"The problem is \" + problem.substring(0, 45) + \"... and it's urgent!\",\n        \"Look, \" + problem.substring(0, 40) + \"... and time is critical!\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'irritated' : \n                     personaKey === 'urgent' ? 'stressed' : 'explanatory';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateShortResponseReaction(personaKey: string, agentMessage: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        `\"${agentMessage}\"? That's it? I need more than that! What exactly are you doing to fix this?`,\n        `Seriously? \"${agentMessage}\" is all you can tell me? I've been waiting and need real help!`,\n        `That's not an answer! \"${agentMessage}\" doesn't tell me anything useful. I need details!`\n      ],\n      polite: [\n        `I appreciate the update, but could you please provide more details about what \"${agentMessage}\" means for my situation?`,\n        `Thank you, but I'd like to understand more about \"${agentMessage}\" - what exactly does that involve?`,\n        `I see you mentioned \"${agentMessage}\", but could you help me understand what happens next?`\n      ],\n      confused: [\n        `I'm sorry, but I don't understand what \"${agentMessage}\" means. Could you explain that more clearly?`,\n        `\"${agentMessage}\"? I'm not sure what that means for my problem. Can you help me understand?`,\n        `I'm lost. When you say \"${agentMessage}\", what exactly should I expect?`\n      ],\n      elderly: [\n        `I'm sorry dear, but \"${agentMessage}\" doesn't really help me understand. Could you explain it differently?`,\n        `\"${agentMessage}\"? I'm afraid I need more explanation than that. What does this mean exactly?`,\n        `I don't quite follow. When you say \"${agentMessage}\", what am I supposed to do?`\n      ],\n      urgent: [\n        `\"${agentMessage}\"? I need more than that! Time is critical here - what's the full plan?`,\n        `That's too vague! \"${agentMessage}\" doesn't help when I'm under pressure. Give me specifics!`,\n        `I can't work with \"${agentMessage}\" - I need detailed steps because this is urgent!`\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'frustrated' : \n                     personaKey === 'urgent' ? 'impatient' : \n                     personaKey === 'polite' ? 'confused' : 'confused';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n\n  private generateTimeResponse(personaKey: string, agentMessage: string, conversationCount: number): { message: string; sentiment: string } {\n    const responses = {\n      angry: [\n        \"How long is this going to take? I've already wasted too much time on this!\",\n        \"Another delay? This is ridiculous! When will this actually be resolved?\",\n        \"I don't have time to keep waiting. Give me a real timeline!\"\n      ],\n      polite: [\n        \"I understand these things take time. Could you give me an estimate of when this might be resolved?\",\n        \"Thank you for the update. Do you have a rough idea of how long this process usually takes?\",\n        \"I appreciate your help. When might I expect to hear back from you?\"\n      ],\n      confused: [\n        \"I'm not sure I understand the timeline. How long should I expect this to take?\",\n        \"When you say it will take time, what does that mean exactly?\",\n        \"I'm confused about the timing. Could you be more specific?\"\n      ],\n      elderly: [\n        \"I'm not good with timing these technical things. How long should I plan to wait?\",\n        \"Could you help me understand when I might hear back? I like to know what to expect.\",\n        \"I'm patient, but it would help to know roughly how long these things usually take.\"\n      ],\n      urgent: [\n        \"Time is really critical here! Can you give me a more specific timeline?\",\n        \"I need this resolved quickly. What's the fastest this can be done?\",\n        \"Every minute counts! How can we speed this up?\"\n      ]\n    };\n\n    const messages = responses[personaKey as keyof typeof responses] || responses.polite;\n    const messageIndex = Math.min(conversationCount, messages.length - 1);\n    const sentiment = personaKey === 'angry' ? 'frustrated' : \n                     personaKey === 'urgent' ? 'stressed' : 'inquisitive';\n    \n    return { message: messages[messageIndex], sentiment };\n  }\n}\n\nexport const groqService = new GroqService();","path":null,"size_bytes":46625,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1128,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","path":null,"size_bytes":1858,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1419,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/pages/workspace-simulator.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Briefcase, Users, Target, Clock, Code, Palette, TestTube, Server, Wrench } from \"lucide-react\";\nimport WorkspaceSession from \"@/components/simulation/workspace-session\";\nimport WorkspaceDashboard from \"@/components/simulation/workspace-dashboard\";\nimport EnterpriseFeatureSession from \"@/components/simulation/enterprise-feature-session\";\nimport InternOnboardingSession from \"@/components/simulation/intern-onboarding-session\";\n\nexport default function WorkspaceSimulator() {\n  const [selectedProject, setSelectedProject] = useState<any>(null);\n  const [selectedRole, setSelectedRole] = useState<string>(\"\");\n  const [activeSession, setActiveSession] = useState<any>(null);\n\n  const { data: projects, isLoading: projectsLoading } = useQuery({\n    queryKey: ['/api/workspace/projects'],\n  });\n\n  const { data: roles, isLoading: rolesLoading } = useQuery({\n    queryKey: ['/api/workspace/roles'],\n  });\n\n  const { data: user } = useQuery({\n    queryKey: ['/api/user'],\n  });\n\n  const createSessionMutation = useMutation({\n    mutationFn: async (config: any) => {\n      const response = await apiRequest(\"POST\", \"/api/sessions\", config);\n      return response.json();\n    },\n    onSuccess: (session) => {\n      setActiveSession(session);\n      queryClient.invalidateQueries({ queryKey: ['/api/user/1/sessions'] });\n    },\n  });\n\n  const handleStartSession = async () => {\n    if (!selectedProject || !selectedRole || !user) return;\n\n    await createSessionMutation.mutateAsync({\n      userId: (user as any).id,\n      type: 'workspace',\n      status: 'active',\n      configuration: {\n        projectId: selectedProject.id,\n        projectName: selectedProject.name,\n        projectCategory: selectedProject.category,\n        projectDescription: selectedProject.description,\n        activeRole: selectedRole,\n        sprintPhase: 'onboarding',\n        teamMembers: selectedProject.teamStructure,\n        duration: selectedProject.estimatedDuration,\n        requirements: selectedProject.requirements,\n        scenarioScript: selectedProject.scenarioScript\n      },\n      messages: []\n    });\n  };\n\n  const handleSessionComplete = () => {\n    setActiveSession(null);\n    setSelectedProject(null);\n    setSelectedRole(\"\");\n    queryClient.invalidateQueries({ queryKey: ['/api/user/1/progress'] });\n  };\n\n  const getRoleIcon = (roleName: string) => {\n    const icons: Record<string, any> = {\n      'Developer': Code,\n      'Product Manager': Briefcase,\n      'Designer': Palette,\n      'QA Engineer': TestTube,\n      'DevOps Engineer': Server\n    };\n    return icons[roleName] || Wrench;\n  };\n\n  const getDifficultyColor = (difficulty: string) => {\n    const colors: Record<string, string> = {\n      'intern': 'bg-blue-100 text-blue-800',\n      'junior': 'bg-green-100 text-green-800',\n      'mid': 'bg-yellow-100 text-yellow-800',\n      'senior': 'bg-red-100 text-red-800'\n    };\n    return colors[difficulty] || 'bg-gray-100 text-gray-800';\n  };\n\n  if (activeSession) {\n    const config = activeSession.configuration;\n    \n    // Check if this is an enterprise feature scenario\n    const isEnterpriseFeature = config?.projectName?.includes('PulseOps IQ');\n    \n    // Check if this is an intern onboarding scenario (check both session config and selected project)\n    const isInternOnboarding = config?.projectCategory === 'intern-onboarding' || \n                               selectedProject?.category === 'intern-onboarding';\n    \n    // Get project data - prefer selectedProject, but can reconstruct from session config\n    const projectData = selectedProject || {\n      id: config?.projectId,\n      name: config?.projectName,\n      description: config?.projectDescription,\n      category: config?.projectCategory,\n      teamStructure: config?.teamMembers,\n      estimatedDuration: config?.duration,\n      requirements: config?.requirements || {},\n      scenarioScript: config?.scenarioScript || {}\n    };\n    \n    if (isEnterpriseFeature) {\n      return (\n        <EnterpriseFeatureSession\n          session={activeSession}\n          project={selectedProject || projectData}\n          onComplete={handleSessionComplete}\n        />\n      );\n    }\n    \n    if (isInternOnboarding) {\n      return (\n        <InternOnboardingSession\n          session={activeSession}\n          project={selectedProject || projectData}\n          onComplete={handleSessionComplete}\n        />\n      );\n    }\n    \n    return <WorkspaceSession session={activeSession} onComplete={handleSessionComplete} />;\n  }\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        <div className=\"mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900\" data-testid=\"text-workspace-title\">Workspace Simulator</h1>\n          <p className=\"text-gray-600 mt-2\">\n            Experience real-world team collaboration by working on projects with AI teammates\n          </p>\n        </div>\n\n        <Tabs defaultValue=\"dashboard\" className=\"space-y-6\">\n          <TabsList>\n            <TabsTrigger value=\"dashboard\" data-testid=\"tab-dashboard\">Dashboard</TabsTrigger>\n            <TabsTrigger value=\"select-project\" data-testid=\"tab-select-project\">Select Project</TabsTrigger>\n            <TabsTrigger value=\"select-role\" disabled={!selectedProject} data-testid=\"tab-select-role\">\n              Choose Role\n            </TabsTrigger>\n            <TabsTrigger value=\"review\" disabled={!selectedProject || !selectedRole} data-testid=\"tab-review\">\n              Review & Start\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"dashboard\">\n            <WorkspaceDashboard\n              userId={(user as any)?.id || 1}\n              onResumeSession={(session) => setActiveSession(session)}\n              onStartNew={() => {\n                const tabsList = document.querySelector('[value=\"select-project\"]') as HTMLElement;\n                tabsList?.click();\n              }}\n            />\n          </TabsContent>\n\n          <TabsContent value=\"select-project\">\n            {projectsLoading ? (\n              <div className=\"text-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n                <p className=\"mt-4 text-gray-600\">Loading projects...</p>\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {(projects as any[])?.map((project: any) => (\n                  <Card\n                    key={project.id}\n                    className={`cursor-pointer transition-all ${\n                      selectedProject?.id === project.id\n                        ? 'ring-2 ring-blue-500 shadow-lg'\n                        : 'hover:shadow-md'\n                    }`}\n                    onClick={() => setSelectedProject(project)}\n                    data-testid={`card-project-${project.id}`}\n                  >\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <CardTitle className=\"text-lg\">{project.name}</CardTitle>\n                        <Badge className={getDifficultyColor(project.difficulty)}>\n                          {project.difficulty}\n                        </Badge>\n                      </div>\n                      <CardDescription>{project.description}</CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Users className=\"h-4 w-4 mr-2\" />\n                          <span>{project.teamStructure?.length || 0} team members</span>\n                        </div>\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Clock className=\"h-4 w-4 mr-2\" />\n                          <span>~{project.estimatedDuration} minutes</span>\n                        </div>\n                        <div className=\"flex items-center text-sm text-gray-600\">\n                          <Target className=\"h-4 w-4 mr-2\" />\n                          <span>{project.category}</span>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"select-role\">\n            {rolesLoading ? (\n              <div className=\"text-center py-12\">\n                <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n                <p className=\"mt-4 text-gray-600\">Loading roles...</p>\n              </div>\n            ) : (\n              <div>\n                <div className=\"mb-6\">\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">\n                    Choose Your Role for \"{selectedProject?.name}\"\n                  </h3>\n                  <p className=\"text-gray-600\">\n                    Select the role you want to practice. You'll collaborate with AI teammates in other roles.\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                  {(roles as any[])?.map((role: any) => {\n                    const Icon = getRoleIcon(role.name);\n                    return (\n                      <Card\n                        key={role.id}\n                        className={`cursor-pointer transition-all ${\n                          selectedRole === role.name\n                            ? 'ring-2 ring-blue-500 shadow-lg'\n                            : 'hover:shadow-md'\n                        }`}\n                        onClick={() => setSelectedRole(role.name)}\n                        data-testid={`card-role-${role.name.toLowerCase().replace(' ', '-')}`}\n                      >\n                        <CardHeader>\n                          <div className=\"flex items-center space-x-3\">\n                            <div className=\"p-2 bg-blue-100 rounded-lg\">\n                              <Icon className=\"h-6 w-6 text-blue-600\" />\n                            </div>\n                            <CardTitle className=\"text-base\">{role.name}</CardTitle>\n                          </div>\n                          <CardDescription className=\"mt-2\">{role.description}</CardDescription>\n                        </CardHeader>\n                        <CardContent>\n                          <div className=\"space-y-2\">\n                            <p className=\"text-sm font-medium text-gray-700\">Key Competencies:</p>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {role.competencies?.slice(0, 3).map((comp: string) => (\n                                <Badge key={comp} variant=\"outline\" className=\"text-xs\">\n                                  {comp}\n                                </Badge>\n                              ))}\n                            </div>\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"review\">\n            {selectedProject && selectedRole && (\n              <Card>\n                <CardHeader>\n                  <CardTitle>Ready to Start</CardTitle>\n                  <CardDescription>Review your selection and start the workspace simulation</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-6\">\n                    <div>\n                      <h4 className=\"font-semibold text-gray-900 mb-2\">Project</h4>\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\n                        <h5 className=\"font-medium text-gray-900\">{selectedProject.name}</h5>\n                        <p className=\"text-sm text-gray-600 mt-1\">{selectedProject.description}</p>\n                        <div className=\"mt-3 flex items-center space-x-4\">\n                          <Badge className={getDifficultyColor(selectedProject.difficulty)}>\n                            {selectedProject.difficulty}\n                          </Badge>\n                          <span className=\"text-sm text-gray-600\">\n                            {selectedProject.estimatedDuration} minutes\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      <h4 className=\"font-semibold text-gray-900 mb-2\">Your Role</h4>\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\n                        <div className=\"flex items-center space-x-3\">\n                          {(() => {\n                            const Icon = getRoleIcon(selectedRole);\n                            return <Icon className=\"h-5 w-5 text-blue-600\" />;\n                          })()}\n                          <span className=\"font-medium text-gray-900\">{selectedRole}</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div>\n                      <h4 className=\"font-semibold text-gray-900 mb-2\">Your Team</h4>\n                      <div className=\"bg-gray-50 p-4 rounded-lg\">\n                        <div className=\"grid grid-cols-2 gap-3\">\n                          {selectedProject.teamStructure?.map((member: any, idx: number) => (\n                            <div key={idx} className=\"flex items-center space-x-2\">\n                              <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center\">\n                                <span className=\"text-sm font-medium text-blue-600\">\n                                  {member.name.charAt(0)}\n                                </span>\n                              </div>\n                              <div>\n                                <p className=\"text-sm font-medium text-gray-900\">{member.name}</p>\n                                <p className=\"text-xs text-gray-600\">{member.role}</p>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"pt-4\">\n                      <Button\n                        onClick={handleStartSession}\n                        disabled={createSessionMutation.isPending}\n                        className=\"w-full\"\n                        data-testid=\"button-start-simulation\"\n                      >\n                        {createSessionMutation.isPending ? 'Starting...' : 'Start Workspace Simulation'}\n                      </Button>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":15476,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":971,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5742,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, jsonb, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  email: text(\"email\").notNull().unique(),\n  firstName: text(\"first_name\").notNull(),\n  lastName: text(\"last_name\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const simulationSessions = pgTable(\"simulation_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  type: text(\"type\").notNull(), // 'interview', 'negotiation', 'workspace'\n  status: text(\"status\").notNull().default('active'), // 'active', 'completed', 'paused'\n  configuration: jsonb(\"configuration\").notNull(), // stores simulation config\n  messages: jsonb(\"messages\").notNull().default('[]'), // chat messages\n  score: integer(\"score\"), // final score\n  feedback: jsonb(\"feedback\"), // AI feedback\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n  duration: integer(\"duration\"), // in seconds\n});\n\nexport const userProgress = pgTable(\"user_progress\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  simulationType: text(\"simulation_type\").notNull(),\n  totalSessions: integer(\"total_sessions\").notNull().default(0),\n  completedSessions: integer(\"completed_sessions\").notNull().default(0),\n  averageScore: integer(\"average_score\"),\n  totalTime: integer(\"total_time\").notNull().default(0), // in seconds\n  lastSessionAt: timestamp(\"last_session_at\"),\n});\n\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSimulationSessionSchema = createInsertSchema(simulationSessions).omit({\n  id: true,\n  startedAt: true,\n});\n\nexport const insertUserProgressSchema = createInsertSchema(userProgress).omit({\n  id: true,\n});\n\n// Workspace Simulator Tables\nexport const workspaceProjects = pgTable(\"workspace_projects\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  category: text(\"category\").notNull(), // 'web-app', 'mobile-app', 'api', 'platform'\n  teamStructure: jsonb(\"team_structure\").notNull(), // Array of AI team members with roles and personas\n  requirements: jsonb(\"requirements\").notNull(), // Project requirements and milestones\n  scenarioScript: jsonb(\"scenario_script\"), // Staged events and challenges\n  difficulty: text(\"difficulty\").notNull(), // 'junior', 'mid', 'senior'\n  estimatedDuration: integer(\"estimated_duration\").notNull(), // in minutes\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const workspaceRoles = pgTable(\"workspace_roles\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(), // 'Developer', 'Product Manager', 'Designer', 'QA', 'DevOps'\n  description: text(\"description\").notNull(),\n  competencies: jsonb(\"competencies\").notNull(), // Skills to track for this role\n  availableActions: jsonb(\"available_actions\").notNull(), // Actions this role can perform\n  evaluationCriteria: jsonb(\"evaluation_criteria\").notNull(), // How to evaluate this role\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const workspaceArtifacts = pgTable(\"workspace_artifacts\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => simulationSessions.id).notNull(),\n  type: text(\"type\").notNull(), // 'ticket', 'code-review', 'design', 'documentation', 'test-case'\n  title: text(\"title\").notNull(),\n  content: jsonb(\"content\").notNull(), // Artifact data (code, design file, test cases, etc.)\n  status: text(\"status\").notNull(), // 'draft', 'in-review', 'approved', 'completed'\n  assignedRole: text(\"assigned_role\"), // Which role owns this artifact\n  metadata: jsonb(\"metadata\"), // Additional metadata (priority, labels, etc.)\n  versionHistory: jsonb(\"version_history\").notNull().default('[]'), // Track changes\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const workspaceTasks = pgTable(\"workspace_tasks\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => simulationSessions.id).notNull(),\n  artifactId: integer(\"artifact_id\").references(() => workspaceArtifacts.id),\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  status: text(\"status\").notNull().default('todo'), // 'todo', 'in-progress', 'review', 'done'\n  priority: text(\"priority\").notNull().default('medium'), // 'low', 'medium', 'high', 'urgent'\n  assignedRole: text(\"assigned_role\"),\n  complexity: integer(\"complexity\"), // Story points or complexity rating\n  dependencies: jsonb(\"dependencies\").default('[]'), // Task IDs this depends on\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const workspaceInteractions = pgTable(\"workspace_interactions\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => simulationSessions.id).notNull(),\n  channel: text(\"channel\").notNull(), // 'chat', 'email', 'standup', 'code-review', 'one-on-one'\n  sender: text(\"sender\").notNull(), // 'user' or AI persona name\n  senderRole: text(\"sender_role\").notNull(),\n  content: text(\"content\").notNull(),\n  metadata: jsonb(\"metadata\"), // Sentiment, action items, mentions, etc.\n  threadId: text(\"thread_id\"), // For grouping related messages\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const workspaceEvaluations = pgTable(\"workspace_evaluations\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => simulationSessions.id).notNull(),\n  role: text(\"role\").notNull(),\n  competencyScores: jsonb(\"competency_scores\").notNull(), // Role-specific skill scores\n  collaborationScore: integer(\"collaboration_score\"), // 0-100\n  deliveryScore: integer(\"delivery_score\"), // 0-100\n  communicationScore: integer(\"communication_score\"), // 0-100\n  feedback: jsonb(\"feedback\"), // Detailed feedback and suggestions\n  phase: text(\"phase\").notNull(), // 'onboarding', 'sprint', 'retro'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertWorkspaceProjectSchema = createInsertSchema(workspaceProjects).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkspaceRoleSchema = createInsertSchema(workspaceRoles).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkspaceArtifactSchema = createInsertSchema(workspaceArtifacts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertWorkspaceTaskSchema = createInsertSchema(workspaceTasks).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertWorkspaceInteractionSchema = createInsertSchema(workspaceInteractions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkspaceEvaluationSchema = createInsertSchema(workspaceEvaluations).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Workspace Progress Tracking - persists day-level progress for simulations\nexport const workspaceProgress = pgTable(\"workspace_progress\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => simulationSessions.id).notNull(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  projectId: integer(\"project_id\").references(() => workspaceProjects.id).notNull(),\n  role: text(\"role\").notNull(),\n  mode: text(\"mode\").notNull().default('journey'), // 'practice' or 'journey'\n  currentDay: integer(\"current_day\").notNull().default(1),\n  scenarioId: text(\"scenario_id\"), // For practice mode: specific day/scenario selected\n  dayProgress: jsonb(\"day_progress\").notNull().default('{}'), // Day-specific progress: {docsRead, introProgress, comprehensionComplete, etc.}\n  overallProgress: integer(\"overall_progress\").notNull().default(0), // 0-100\n  status: text(\"status\").notNull().default('in_progress'), // 'in_progress', 'completed', 'abandoned'\n  score: integer(\"score\"), // Final score for completed sessions\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  lastActivityAt: timestamp(\"last_activity_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const insertWorkspaceProgressSchema = createInsertSchema(workspaceProgress).omit({\n  id: true,\n  startedAt: true,\n  lastActivityAt: true,\n});\n\nexport type WorkspaceProgress = typeof workspaceProgress.$inferSelect;\nexport type InsertWorkspaceProgress = z.infer<typeof insertWorkspaceProgressSchema>;\n\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type SimulationSession = typeof simulationSessions.$inferSelect;\nexport type InsertSimulationSession = z.infer<typeof insertSimulationSessionSchema>;\nexport type UserProgress = typeof userProgress.$inferSelect;\nexport type InsertUserProgress = z.infer<typeof insertUserProgressSchema>;\nexport type WorkspaceProject = typeof workspaceProjects.$inferSelect;\nexport type InsertWorkspaceProject = z.infer<typeof insertWorkspaceProjectSchema>;\nexport type WorkspaceRole = typeof workspaceRoles.$inferSelect;\nexport type InsertWorkspaceRole = z.infer<typeof insertWorkspaceRoleSchema>;\nexport type WorkspaceArtifact = typeof workspaceArtifacts.$inferSelect;\nexport type InsertWorkspaceArtifact = z.infer<typeof insertWorkspaceArtifactSchema>;\nexport type WorkspaceTask = typeof workspaceTasks.$inferSelect;\nexport type InsertWorkspaceTask = z.infer<typeof insertWorkspaceTaskSchema>;\nexport type WorkspaceInteraction = typeof workspaceInteractions.$inferSelect;\nexport type InsertWorkspaceInteraction = z.infer<typeof insertWorkspaceInteractionSchema>;\nexport type WorkspaceEvaluation = typeof workspaceEvaluations.$inferSelect;\nexport type InsertWorkspaceEvaluation = z.infer<typeof insertWorkspaceEvaluationSchema>;\n\n// Interview Simulator Tables\nexport const interviewSessions = pgTable(\"interview_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  interviewType: text(\"interview_type\").notNull(), // 'behavioral', 'technical', 'system-design', 'case-study'\n  targetRole: text(\"target_role\").notNull(), // 'developer', 'pm', 'designer', 'data-scientist'\n  difficulty: text(\"difficulty\").notNull().default('medium'), // 'easy', 'medium', 'hard'\n  status: text(\"status\").notNull().default('in_progress'), // 'in_progress', 'completed', 'abandoned'\n  mode: text(\"mode\").notNull().default('practice'), // 'practice' or 'journey'\n  applicationStageId: integer(\"application_stage_id\"), // Links to application_stages for journey mode\n  currentQuestionIndex: integer(\"current_question_index\").notNull().default(0),\n  totalQuestions: integer(\"total_questions\").notNull().default(5),\n  overallScore: integer(\"overall_score\"), // 0-100\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const interviewQuestions = pgTable(\"interview_questions\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => interviewSessions.id).notNull(),\n  questionIndex: integer(\"question_index\").notNull(),\n  questionText: text(\"question_text\").notNull(),\n  questionType: text(\"question_type\").notNull(), // 'opening', 'main', 'follow-up', 'closing'\n  expectedCriteria: jsonb(\"expected_criteria\").notNull(), // What to look for in the answer\n  candidateAnswer: text(\"candidate_answer\"),\n  score: integer(\"score\"), // 1-10\n  feedback: text(\"feedback\"),\n  strengths: jsonb(\"strengths\").default('[]'),\n  improvements: jsonb(\"improvements\").default('[]'),\n  askedAt: timestamp(\"asked_at\").defaultNow().notNull(),\n  answeredAt: timestamp(\"answered_at\"),\n});\n\nexport const interviewFeedback = pgTable(\"interview_feedback\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => interviewSessions.id).notNull(),\n  overallScore: integer(\"overall_score\").notNull(), // 0-100\n  communicationScore: integer(\"communication_score\").notNull(),\n  technicalScore: integer(\"technical_score\"),\n  problemSolvingScore: integer(\"problem_solving_score\"),\n  cultureFitScore: integer(\"culture_fit_score\"),\n  summary: text(\"summary\").notNull(),\n  strengths: jsonb(\"strengths\").notNull(),\n  improvements: jsonb(\"improvements\").notNull(),\n  recommendations: jsonb(\"recommendations\").notNull(),\n  hiringDecision: text(\"hiring_decision\").notNull(), // 'strong_yes', 'yes', 'maybe', 'no', 'strong_no'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertInterviewSessionSchema = createInsertSchema(interviewSessions).omit({\n  id: true,\n  startedAt: true,\n});\n\nexport const insertInterviewQuestionSchema = createInsertSchema(interviewQuestions).omit({\n  id: true,\n  askedAt: true,\n});\n\nexport const insertInterviewFeedbackSchema = createInsertSchema(interviewFeedback).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InterviewSession = typeof interviewSessions.$inferSelect;\nexport type InsertInterviewSession = z.infer<typeof insertInterviewSessionSchema>;\nexport type InterviewQuestion = typeof interviewQuestions.$inferSelect;\nexport type InsertInterviewQuestion = z.infer<typeof insertInterviewQuestionSchema>;\nexport type InterviewFeedback = typeof interviewFeedback.$inferSelect;\nexport type InsertInterviewFeedback = z.infer<typeof insertInterviewFeedbackSchema>;\n\n// Job Journey Tables\n\nexport const companies = pgTable(\"companies\", {\n  id: serial(\"id\").primaryKey(),\n  name: text(\"name\").notNull(),\n  logo: text(\"logo\"), // URL or emoji\n  industry: text(\"industry\").notNull(), // 'tech', 'fintech', 'healthtech', 'e-commerce'\n  size: text(\"size\").notNull(), // 'startup', 'mid-size', 'enterprise'\n  description: text(\"description\").notNull(),\n  culture: text(\"culture\").notNull(), // Brief culture description\n  values: jsonb(\"values\").notNull().default('[]'), // Array of company values\n  benefits: jsonb(\"benefits\").notNull().default('[]'), // Array of benefits\n  interviewStyle: text(\"interview_style\").notNull().default('balanced'), // 'rigorous', 'balanced', 'casual'\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const jobPostings = pgTable(\"job_postings\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id).notNull(),\n  title: text(\"title\").notNull(), // 'Junior Project Manager', 'Senior Software Engineer'\n  role: text(\"role\").notNull(), // 'pm', 'developer', 'designer', 'qa', 'devops'\n  seniority: text(\"seniority\").notNull(), // 'junior', 'mid', 'senior', 'lead'\n  department: text(\"department\").notNull(), // 'Engineering', 'Product', 'Design'\n  location: text(\"location\").notNull(), // 'Remote', 'San Francisco, CA', 'Hybrid'\n  employmentType: text(\"employment_type\").notNull().default('full-time'), // 'full-time', 'contract', 'part-time'\n  salaryMin: integer(\"salary_min\"),\n  salaryMax: integer(\"salary_max\"),\n  description: text(\"description\").notNull(), // Full job description\n  responsibilities: jsonb(\"responsibilities\").notNull().default('[]'), // Array of responsibilities\n  requirements: jsonb(\"requirements\").notNull().default('[]'), // Array of requirements\n  niceToHave: jsonb(\"nice_to_have\").default('[]'), // Array of nice-to-haves\n  highlightedTerms: jsonb(\"highlighted_terms\").default('[]'), // Terms to highlight with glossary popups\n  interviewStages: integer(\"interview_stages\").notNull().default(3), // Number of interview stages\n  isActive: boolean(\"is_active\").notNull().default(true),\n  postedAt: timestamp(\"posted_at\").defaultNow().notNull(),\n  // Phase 3: Narrative Architecture Fields\n  projectTemplateSlug: text(\"project_template_slug\"), // Links to project template\n  narrativeContext: jsonb(\"narrative_context\"), // Industry, domain, team topology overrides\n  journeyLength: jsonb(\"journey_length\"), // { minSprints, maxSprints }\n});\n\nexport const jobGlossary = pgTable(\"job_glossary\", {\n  id: serial(\"id\").primaryKey(),\n  term: text(\"term\").notNull().unique(),\n  definition: text(\"definition\").notNull(),\n  category: text(\"category\"), // 'product', 'engineering', 'business', 'general'\n  relatedTerms: jsonb(\"related_terms\").default('[]'),\n});\n\nexport const jobApplications = pgTable(\"job_applications\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  jobPostingId: integer(\"job_posting_id\").references(() => jobPostings.id).notNull(),\n  status: text(\"status\").notNull().default('draft'), // 'draft', 'submitted', 'screening', 'interviewing', 'offer', 'accepted', 'rejected'\n  cvFileName: text(\"cv_file_name\"),\n  cvContent: text(\"cv_content\"), // Stored CV text for AI context\n  coverLetter: text(\"cover_letter\"),\n  currentStageIndex: integer(\"current_stage_index\").notNull().default(0),\n  hrContactedAt: timestamp(\"hr_contacted_at\"),\n  offerDetails: jsonb(\"offer_details\"), // Salary, start date, etc.\n  notes: text(\"notes\"),\n  appliedAt: timestamp(\"applied_at\"),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const interviewTemplates = pgTable(\"interview_templates\", {\n  id: serial(\"id\").primaryKey(),\n  companyId: integer(\"company_id\").references(() => companies.id),\n  role: text(\"role\"), // If null, applies to all roles at company\n  name: text(\"name\").notNull(),\n  stages: jsonb(\"stages\").notNull(), // Array of stage configs: [{order, type, name, duration, config}]\n  totalDuration: integer(\"total_duration\"), // Estimated total time in minutes\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const applicationStages = pgTable(\"application_stages\", {\n  id: serial(\"id\").primaryKey(),\n  applicationId: integer(\"application_id\").references(() => jobApplications.id).notNull(),\n  stageOrder: integer(\"stage_order\").notNull(),\n  stageName: text(\"stage_name\").notNull(), // 'Phone Screen', 'Technical Interview', 'System Design'\n  stageType: text(\"stage_type\").notNull(), // 'recruiter_call', 'technical', 'behavioral', 'case_study', 'panel', 'team' (team/panel both use multi-persona interviews), 'offer'\n  status: text(\"status\").notNull().default('pending'), // 'pending', 'scheduled', 'in_progress', 'completed', 'skipped'\n  interviewSessionId: integer(\"interview_session_id\").references(() => interviewSessions.id),\n  scheduledAt: timestamp(\"scheduled_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  score: integer(\"score\"), // 0-100\n  feedback: text(\"feedback\"),\n  recruiterNotes: text(\"recruiter_notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const insertCompanySchema = createInsertSchema(companies).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertJobPostingSchema = createInsertSchema(jobPostings).omit({\n  id: true,\n  postedAt: true,\n});\n\nexport const insertJobGlossarySchema = createInsertSchema(jobGlossary).omit({\n  id: true,\n});\n\nexport const insertJobApplicationSchema = createInsertSchema(jobApplications).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertInterviewTemplateSchema = createInsertSchema(interviewTemplates).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertApplicationStageSchema = createInsertSchema(applicationStages).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type Company = typeof companies.$inferSelect;\nexport type InsertCompany = z.infer<typeof insertCompanySchema>;\nexport type JobPosting = typeof jobPostings.$inferSelect;\nexport type InsertJobPosting = z.infer<typeof insertJobPostingSchema>;\nexport type JobGlossary = typeof jobGlossary.$inferSelect;\nexport type InsertJobGlossary = z.infer<typeof insertJobGlossarySchema>;\nexport type JobApplication = typeof jobApplications.$inferSelect;\nexport type InsertJobApplication = z.infer<typeof insertJobApplicationSchema>;\nexport type InterviewTemplate = typeof interviewTemplates.$inferSelect;\nexport type InsertInterviewTemplate = z.infer<typeof insertInterviewTemplateSchema>;\nexport type ApplicationStage = typeof applicationStages.$inferSelect;\nexport type InsertApplicationStage = z.infer<typeof insertApplicationStageSchema>;\n\n// Team Interview Types and Settings\nexport type ExperienceLevel = 'intern' | 'junior' | 'mid' | 'senior' | 'lead';\n\nexport interface TeamInterviewPersona {\n  id: string;\n  name: string;\n  role: string; // 'tech_lead', 'peer_engineer', 'product_partner', 'engineering_manager'\n  displayRole: string; // Human-readable: \"Tech Lead\", \"Software Engineer\"\n  tone: 'supportive' | 'collegial' | 'challenging' | 'strategic';\n  focusAreas: string[]; // What this persona probes: ['learning', 'collaboration', 'debugging']\n  introStyle: string; // How they introduce themselves\n}\n\nexport interface TeamInterviewSettings {\n  experienceLevel: ExperienceLevel;\n  personas: TeamInterviewPersona[];\n  questionWeights: {\n    learning: number; // % of interview focused on learning/growth\n    collaboration: number; // % on teamwork\n    technical: number; // % on technical skills\n    curiosity: number; // % on candidate questions\n  };\n  evaluationRubric: {\n    criterion: string;\n    weight: number;\n    levelExpectations: Record<ExperienceLevel, string>;\n  }[];\n  artifactComplexity: 'simple' | 'moderate' | 'complex';\n  maxQuestions: number;\n}\n\n// Predefined team interview settings by experience level\nexport const TEAM_INTERVIEW_PRESETS: Record<ExperienceLevel, TeamInterviewSettings> = {\n  intern: {\n    experienceLevel: 'intern',\n    personas: [\n      {\n        id: 'peer_engineer',\n        name: 'Marcus',\n        role: 'peer_engineer',\n        displayRole: 'Software Engineer',\n        tone: 'supportive',\n        focusAreas: ['learning', 'collaboration', 'asking_for_help'],\n        introStyle: \"Hey! I'm Marcus, one of the developers on the team. I've been here about a year, so I remember what it's like being new.\",\n      },\n      {\n        id: 'tech_lead',\n        name: 'Sarah',\n        role: 'tech_lead',\n        displayRole: 'Tech Lead',\n        tone: 'supportive',\n        focusAreas: ['potential', 'growth_mindset', 'fundamentals'],\n        introStyle: \"Hi! I'm Sarah, the tech lead for this team. I'm excited to learn more about you and what you're looking to get out of this role.\",\n      },\n    ],\n    questionWeights: {\n      learning: 40,\n      collaboration: 30,\n      technical: 20,\n      curiosity: 10,\n    },\n    evaluationRubric: [\n      {\n        criterion: 'learning_mindset',\n        weight: 35,\n        levelExpectations: {\n          intern: 'Shows curiosity, asks clarifying questions, admits knowledge gaps honestly',\n          junior: 'Demonstrates self-directed learning, seeks feedback proactively',\n          mid: 'Mentors others while continuing to grow, learns from mistakes quickly',\n          senior: 'Drives learning culture, identifies skill gaps in team',\n          lead: 'Shapes learning strategy, builds knowledge-sharing systems',\n        },\n      },\n      {\n        criterion: 'collaboration',\n        weight: 30,\n        levelExpectations: {\n          intern: 'Communicates clearly, open to feedback, thinks about teammates',\n          junior: 'Works effectively in pairs, gives and receives feedback well',\n          mid: 'Facilitates team discussions, resolves minor conflicts',\n          senior: 'Builds consensus, mentors collaboration skills',\n          lead: 'Designs team structures, optimizes cross-team collaboration',\n        },\n      },\n      {\n        criterion: 'problem_solving',\n        weight: 25,\n        levelExpectations: {\n          intern: 'Has a logical process, knows when to ask for help',\n          junior: 'Breaks down problems, proposes solutions with guidance',\n          mid: 'Solves complex problems independently, considers trade-offs',\n          senior: 'Anticipates problems, designs robust solutions',\n          lead: 'Solves organizational problems, strategic thinking',\n        },\n      },\n      {\n        criterion: 'technical_foundations',\n        weight: 10,\n        levelExpectations: {\n          intern: 'Basic understanding, does not need to be polished',\n          junior: 'Solid fundamentals, can debug with guidance',\n          mid: 'Strong skills, teaches fundamentals to others',\n          senior: 'Expert level, designs systems and patterns',\n          lead: 'Sets technical direction, evaluates new technologies',\n        },\n      },\n    ],\n    artifactComplexity: 'simple',\n    maxQuestions: 8,\n  },\n  junior: {\n    experienceLevel: 'junior',\n    personas: [\n      {\n        id: 'peer_engineer',\n        name: 'Marcus',\n        role: 'peer_engineer',\n        displayRole: 'Senior Engineer',\n        tone: 'collegial',\n        focusAreas: ['practical_skills', 'debugging', 'code_quality'],\n        introStyle: \"Hey, I'm Marcus. I'm a senior engineer on the team and I'll be asking you some questions about your experience.\",\n      },\n      {\n        id: 'tech_lead',\n        name: 'Sarah',\n        role: 'tech_lead',\n        displayRole: 'Tech Lead',\n        tone: 'collegial',\n        focusAreas: ['problem_solving', 'growth', 'ownership'],\n        introStyle: \"Hi, I'm Sarah, the tech lead. Looking forward to hearing about your background and how you approach problems.\",\n      },\n    ],\n    questionWeights: {\n      learning: 25,\n      collaboration: 30,\n      technical: 35,\n      curiosity: 10,\n    },\n    evaluationRubric: [],\n    artifactComplexity: 'moderate',\n    maxQuestions: 10,\n  },\n  mid: {\n    experienceLevel: 'mid',\n    personas: [\n      {\n        id: 'senior_engineer',\n        name: 'Marcus',\n        role: 'peer_engineer',\n        displayRole: 'Staff Engineer',\n        tone: 'collegial',\n        focusAreas: ['system_design', 'code_review', 'mentoring'],\n        introStyle: \"I'm Marcus, a staff engineer. I'll be diving into some technical scenarios with you.\",\n      },\n      {\n        id: 'tech_lead',\n        name: 'Sarah',\n        role: 'tech_lead',\n        displayRole: 'Tech Lead',\n        tone: 'challenging',\n        focusAreas: ['ownership', 'decision_making', 'delivery'],\n        introStyle: \"Hi, I'm Sarah, the tech lead. I want to understand how you make technical decisions and drive projects forward.\",\n      },\n      {\n        id: 'product_partner',\n        name: 'Priya',\n        role: 'product_partner',\n        displayRole: 'Product Manager',\n        tone: 'collegial',\n        focusAreas: ['cross_functional', 'requirements', 'stakeholder_management'],\n        introStyle: \"Hey, I'm Priya from the product team. I'll ask about how you collaborate with non-engineers.\",\n      },\n    ],\n    questionWeights: {\n      learning: 15,\n      collaboration: 25,\n      technical: 50,\n      curiosity: 10,\n    },\n    evaluationRubric: [],\n    artifactComplexity: 'moderate',\n    maxQuestions: 12,\n  },\n  senior: {\n    experienceLevel: 'senior',\n    personas: [\n      {\n        id: 'tech_lead',\n        name: 'Sarah',\n        role: 'tech_lead',\n        displayRole: 'Engineering Manager',\n        tone: 'challenging',\n        focusAreas: ['system_design', 'leadership', 'trade_offs'],\n        introStyle: \"I'm Sarah, the engineering manager. I'll be exploring your technical depth and leadership experience.\",\n      },\n      {\n        id: 'staff_engineer',\n        name: 'Marcus',\n        role: 'peer_engineer',\n        displayRole: 'Principal Engineer',\n        tone: 'challenging',\n        focusAreas: ['architecture', 'scalability', 'technical_vision'],\n        introStyle: \"Marcus here, principal engineer. Let's discuss system design and architectural decisions.\",\n      },\n      {\n        id: 'product_partner',\n        name: 'Priya',\n        role: 'product_partner',\n        displayRole: 'Senior PM',\n        tone: 'strategic',\n        focusAreas: ['strategy', 'influence', 'cross_org'],\n        introStyle: \"I'm Priya, senior PM. I'll ask about your experience driving cross-functional initiatives.\",\n      },\n    ],\n    questionWeights: {\n      learning: 10,\n      collaboration: 20,\n      technical: 55,\n      curiosity: 15,\n    },\n    evaluationRubric: [],\n    artifactComplexity: 'complex',\n    maxQuestions: 12,\n  },\n  lead: {\n    experienceLevel: 'lead',\n    personas: [\n      {\n        id: 'director',\n        name: 'David',\n        role: 'engineering_manager',\n        displayRole: 'Engineering Director',\n        tone: 'strategic',\n        focusAreas: ['team_building', 'technical_strategy', 'org_impact'],\n        introStyle: \"I'm David, engineering director. I'm interested in your experience building and scaling engineering teams.\",\n      },\n      {\n        id: 'staff_engineer',\n        name: 'Sarah',\n        role: 'tech_lead',\n        displayRole: 'Staff Engineer',\n        tone: 'challenging',\n        focusAreas: ['architecture', 'technical_excellence', 'mentorship'],\n        introStyle: \"Sarah here, staff engineer. Let's discuss technical vision and how you elevate engineering standards.\",\n      },\n      {\n        id: 'product_leader',\n        name: 'Priya',\n        role: 'product_partner',\n        displayRole: 'VP Product',\n        tone: 'strategic',\n        focusAreas: ['roadmap', 'business_alignment', 'vision'],\n        introStyle: \"I'm Priya, VP of Product. I want to understand how you align technical work with business goals.\",\n      },\n    ],\n    questionWeights: {\n      learning: 5,\n      collaboration: 25,\n      technical: 50,\n      curiosity: 20,\n    },\n    evaluationRubric: [],\n    artifactComplexity: 'complex',\n    maxQuestions: 15,\n  },\n};\n\n// ============================================================================\n// PHASE 1: UNIFIED DATA LAYER TABLES\n// ============================================================================\n\n// Mastery bands for competency progression\nexport const masteryBandEnum = ['explorer', 'contributor', 'junior_ready'] as const;\nexport type MasteryBand = typeof masteryBandEnum[number];\n\n// Competencies - Skills with rubrics per mastery band\nexport const competencies = pgTable(\"competencies\", {\n  id: serial(\"id\").primaryKey(),\n  slug: text(\"slug\").notNull().unique(), // e.g., \"debugging\", \"git-workflow\", \"code-review\"\n  name: text(\"name\").notNull(), // Human-readable name\n  summary: text(\"summary\").notNull(), // Brief description\n  category: text(\"category\").notNull(), // \"foundational_habits\", \"core_delivery\", \"professional_impact\"\n  role: text(\"role\"), // null = universal, or specific role like \"developer\"\n  rubric: jsonb(\"rubric\").notNull(), // { explorer: {...}, contributor: {...}, junior_ready: {...} }\n  skills: jsonb(\"skills\").notNull(), // Observable behaviors for this competency\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Simulation Catalogue - Questions/scenarios with adapter tags\nexport const simulationCatalogue = pgTable(\"simulation_catalogue\", {\n  id: serial(\"id\").primaryKey(),\n  externalId: text(\"external_id\").notNull().unique(), // Maps to JSON meta.id (e.g., \"workspace-standup-day2\")\n  type: text(\"type\").notNull(), // Content type (e.g., \"standup_script\", \"code_exercise\")\n  simulator: text(\"simulator\").notNull(), // \"workspace\" or \"interview\"\n  role: text(\"role\"), // \"developer\", \"pm\", \"qa\", etc. (null = shared)\n  level: text(\"level\"), // \"intern\", \"junior\", \"mid\", \"senior\" (null = all levels)\n  language: text(\"language\"), // \"javascript\", \"python\", \"c_cpp\" (null = language-agnostic)\n  day: integer(\"day\"), // Day number for daily content (null = not day-specific)\n  version: text(\"version\").notNull(),\n  title: text(\"title\").notNull(),\n  summary: text(\"summary\"),\n  content: jsonb(\"content\").notNull(), // The actual content payload\n  competencySlugs: text(\"competency_slugs\").array(), // Links to competencies this item tests\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Role Adapters - Config per role\nexport const roleAdapters = pgTable(\"role_adapters\", {\n  id: serial(\"id\").primaryKey(),\n  role: text(\"role\").notNull().unique(), // \"developer\", \"pm\", \"qa\", \"devops\", \"data_science\"\n  displayName: text(\"display_name\").notNull(),\n  description: text(\"description\").notNull(),\n  levels: jsonb(\"levels\").notNull(), // Per-level scaffolding and expectations\n  languageOverrides: jsonb(\"language_overrides\"), // Language-specific adaptations (for developer)\n  simulatorSettings: jsonb(\"simulator_settings\").notNull(), // Settings per simulator\n  metadata: jsonb(\"metadata\"), // Additional role-specific config\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Competency Ledger - User mastery scores\nexport const competencyLedger = pgTable(\"competency_ledger\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  competencyId: integer(\"competency_id\").references(() => competencies.id).notNull(),\n  currentBand: text(\"current_band\").notNull().default('explorer'), // 'explorer', 'contributor', 'junior_ready'\n  evidenceCount: integer(\"evidence_count\").notNull().default(0),\n  confidence: integer(\"confidence\").notNull().default(0), // 0-100\n  lastEvidenceAt: timestamp(\"last_evidence_at\"),\n  history: jsonb(\"history\").notNull().default('[]'), // Array of delta events\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Portfolio Artifacts - Collected work samples\nexport const portfolioArtifacts = pgTable(\"portfolio_artifacts\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  source: text(\"source\").notNull(), // \"workspace\", \"interview\", \"upload\"\n  catalogueItemId: integer(\"catalogue_item_id\").references(() => simulationCatalogue.id),\n  title: text(\"title\").notNull(),\n  artifactType: text(\"artifact_type\").notNull(), // \"code_fix\", \"standup_response\", \"interview_answer\", etc.\n  summary: text(\"summary\"),\n  artifactData: jsonb(\"artifact_data\").notNull(), // The actual work sample data\n  evidenceCompetencies: text(\"evidence_competencies\").array(), // Competency slugs this demonstrates\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Insert schemas for Phase 1 tables\nexport const insertCompetencySchema = createInsertSchema(competencies).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertSimulationCatalogueSchema = createInsertSchema(simulationCatalogue).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertRoleAdapterSchema = createInsertSchema(roleAdapters).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertCompetencyLedgerSchema = createInsertSchema(competencyLedger).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertPortfolioArtifactSchema = createInsertSchema(portfolioArtifacts).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Types for Phase 1 tables\nexport type InsertCompetency = z.infer<typeof insertCompetencySchema>;\nexport type Competency = typeof competencies.$inferSelect;\n\nexport type InsertSimulationCatalogue = z.infer<typeof insertSimulationCatalogueSchema>;\nexport type SimulationCatalogue = typeof simulationCatalogue.$inferSelect;\n\nexport type InsertRoleAdapter = z.infer<typeof insertRoleAdapterSchema>;\nexport type RoleAdapter = typeof roleAdapters.$inferSelect;\n\nexport type InsertCompetencyLedger = z.infer<typeof insertCompetencyLedgerSchema>;\nexport type CompetencyLedger = typeof competencyLedger.$inferSelect;\n\nexport type InsertPortfolioArtifact = z.infer<typeof insertPortfolioArtifactSchema>;\nexport type PortfolioArtifact = typeof portfolioArtifacts.$inferSelect;\n\n// Competency delta payload for POST /api/user/:id/competency-delta\nexport const competencyDeltaSchema = z.object({\n  competencySlug: z.string(),\n  source: z.enum(['workspace', 'interview']),\n  catalogueItemId: z.number().optional(),\n  evidenceType: z.string(), // \"exercise_complete\", \"answer_rated\", etc.\n  evidenceData: z.record(z.unknown()).optional(),\n  score: z.number().min(0).max(100).optional(), // Optional score from the activity\n});\n\nexport type CompetencyDelta = z.infer<typeof competencyDeltaSchema>;\n\n// Readiness response structure\nexport interface ReadinessScore {\n  overallScore: number; // 0-100\n  currentBand: MasteryBand;\n  competencyBreakdown: {\n    slug: string;\n    name: string;\n    band: MasteryBand;\n    confidence: number;\n    evidenceCount: number;\n  }[];\n  gaps: string[]; // Competency slugs needing improvement\n  strengths: string[]; // Competency slugs showing strength\n}\n\n// ============================================================================\n// PHASE 3: NARRATIVE ARCHITECTURE TABLES\n// ============================================================================\n\n// Difficulty bands for progression\nexport const difficultyBandEnum = ['guided', 'supported', 'independent', 'expert'] as const;\nexport type DifficultyBand = typeof difficultyBandEnum[number];\n\n// Arc types\nexport const arcTypeEnum = ['onboarding', 'sprint'] as const;\nexport type ArcType = typeof arcTypeEnum[number];\n\n// Activity types\nexport const activityTypeEnum = [\n  'team_chat',\n  'documentation_reading', \n  'standup_meeting',\n  'sprint_planning',\n  'ticket_work',\n  'code_exercise',\n  'code_review',\n  'pr_creation',\n  'demo_presentation',\n  'retrospective',\n  'one_on_one',\n  'incident_response',\n  'reflection',\n  'soft_skill_event'\n] as const;\nexport type ActivityType = typeof activityTypeEnum[number];\n\n// Ceremony types\nexport const ceremonyTypeEnum = [\n  'sprint_planning',\n  'daily_standup', \n  'sprint_review',\n  'sprint_retrospective',\n  'manager_1_1',\n  'final_1_1'\n] as const;\nexport type CeremonyType = typeof ceremonyTypeEnum[number];\n\n// Progression Paths - defines level transitions (InternJunior, JuniorMid, etc.)\nexport const progressionPaths = pgTable(\"progression_paths\", {\n  id: serial(\"id\").primaryKey(),\n  slug: text(\"slug\").notNull().unique(), // \"intern_to_junior\", \"junior_to_mid\"\n  entryLevel: text(\"entry_level\").notNull(), // \"intern\", \"junior\", \"mid\"\n  exitLevel: text(\"exit_level\").notNull(), // \"junior\", \"mid\", \"senior\"\n  role: text(\"role\").notNull(), // \"developer\", \"pm\", \"qa\", etc.\n  displayName: text(\"display_name\").notNull(), // \"Intern  Junior Ready\"\n  description: text(\"description\").notNull(),\n  requirements: jsonb(\"requirements\").notNull(), // { minSprints, readinessThreshold, requiredCompetencies }\n  difficultyProgression: jsonb(\"difficulty_progression\").notNull(), // How difficulty increases over sprints\n  exitBadge: text(\"exit_badge\"), // Badge awarded on completion\n  competencyFocus: text(\"competency_focus\").array(), // Primary competencies for this path\n  estimatedDuration: jsonb(\"estimated_duration\").notNull(), // { minWeeks, maxWeeks }\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Project Templates - simulated project/team environments\nexport const projectTemplates = pgTable(\"project_templates\", {\n  id: serial(\"id\").primaryKey(),\n  slug: text(\"slug\").notNull().unique(), // \"novapay\", \"chatflow\", \"shopstack\"\n  name: text(\"name\").notNull(), // \"NovaPay\"\n  description: text(\"description\").notNull(),\n  industry: text(\"industry\").notNull(), // \"fintech\", \"social\", \"ecommerce\"\n  domain: text(\"domain\").notNull(), // \"payments\", \"messaging\", \"inventory\"\n  teamTopology: text(\"team_topology\").notNull(), // \"startup\", \"enterprise\", \"agency\"\n  team: jsonb(\"team\").notNull(), // Team member templates with personas\n  codebase: jsonb(\"codebase\").notNull(), // Codebase structure, key files, bug patterns\n  backlogThemes: jsonb(\"backlog_themes\").notNull(), // Feature areas for sprint generation\n  bugTemplates: jsonb(\"bug_templates\").notNull(), // Bug patterns for exercises\n  featureTemplates: jsonb(\"feature_templates\").notNull(), // Feature patterns for exercises\n  softSkillPacks: jsonb(\"soft_skill_packs\").notNull(), // Soft skill event templates\n  sprintCadence: integer(\"sprint_cadence\").notNull().default(10), // Days per sprint\n  techStack: text(\"tech_stack\").array(), // [\"react\", \"node\", \"postgres\"]\n  language: text(\"language\").notNull().default('javascript'), // Primary language\n  progressionPathId: integer(\"progression_path_id\").references(() => progressionPaths.id),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// User Journeys - user's journey through a progression path\nexport const userJourneys = pgTable(\"user_journeys\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  progressionPathId: integer(\"progression_path_id\").references(() => progressionPaths.id).notNull(),\n  projectTemplateId: integer(\"project_template_id\").references(() => projectTemplates.id).notNull(),\n  jobApplicationId: integer(\"job_application_id\").references(() => jobApplications.id), // Links to job application\n  status: text(\"status\").notNull().default('active'), // 'active', 'paused', 'completed', 'graduated', 'abandoned'\n  currentArcId: integer(\"current_arc_id\"), // Will be set after arcs are created\n  currentSprintNumber: integer(\"current_sprint_number\").notNull().default(0), // 0 = onboarding\n  completedSprints: integer(\"completed_sprints\").notNull().default(0),\n  readinessScore: integer(\"readiness_score\").notNull().default(0), // 0-100\n  exitTrigger: text(\"exit_trigger\"), // 'user_choice', 'readiness_threshold', 'max_sprints', null if not exited\n  graduatedAt: timestamp(\"graduated_at\"),\n  badgeAwarded: text(\"badge_awarded\"),\n  journeyMetadata: jsonb(\"journey_metadata\").notNull().default('{}'), // Additional journey state\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  lastActivityAt: timestamp(\"last_activity_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\n// Journey Arcs - arcs within a journey (onboarding, sprint 1, sprint 2, etc.)\nexport const journeyArcs = pgTable(\"journey_arcs\", {\n  id: serial(\"id\").primaryKey(),\n  journeyId: integer(\"journey_id\").references(() => userJourneys.id).notNull(),\n  arcType: text(\"arc_type\").notNull(), // 'onboarding' or 'sprint'\n  arcOrder: integer(\"arc_order\").notNull(), // Sequence: 1 = onboarding, 2 = sprint 1, etc.\n  name: text(\"name\").notNull(), // \"Onboarding\", \"Sprint 1\", etc.\n  description: text(\"description\"),\n  status: text(\"status\").notNull().default('pending'), // 'pending', 'active', 'completed'\n  difficultyBand: text(\"difficulty_band\").notNull().default('guided'), // 'guided', 'supported', 'independent'\n  durationDays: integer(\"duration_days\").notNull().default(5),\n  competencyFocus: text(\"competency_focus\").array(), // Primary competencies for this arc\n  isFinalArc: boolean(\"is_final_arc\").notNull().default(false),\n  arcData: jsonb(\"arc_data\").notNull().default('{}'), // Arc-specific data (scripted content, etc.)\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Sprints - sprint-specific data for sprint arcs\nexport const sprints = pgTable(\"sprints\", {\n  id: serial(\"id\").primaryKey(),\n  arcId: integer(\"arc_id\").references(() => journeyArcs.id).notNull(),\n  sprintNumber: integer(\"sprint_number\").notNull(),\n  goal: text(\"goal\").notNull(), // Sprint goal\n  theme: text(\"theme\").notNull(), // Sprint theme from backlog themes\n  backlog: jsonb(\"backlog\").notNull(), // Generated backlog items\n  userTickets: jsonb(\"user_tickets\").notNull(), // Tickets assigned to user\n  teamTickets: jsonb(\"team_tickets\").notNull(), // Tickets for AI team members\n  storyPointsTarget: integer(\"story_points_target\").notNull().default(8),\n  storyPointsCompleted: integer(\"story_points_completed\").notNull().default(0),\n  softSkillEvents: jsonb(\"soft_skill_events\").notNull().default('[]'), // Scheduled soft skill events\n  midSprintEvents: jsonb(\"mid_sprint_events\").notNull().default('[]'), // Dynamic disruptions\n  ceremonies: jsonb(\"ceremonies\").notNull(), // Ceremony scripts and states\n  sprintState: jsonb(\"sprint_state\").notNull().default('{}'), // Current sprint state\n  generationMetadata: jsonb(\"generation_metadata\"), // How this sprint was generated\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Sprint Activities - individual activities within a sprint day\nexport const sprintActivities = pgTable(\"sprint_activities\", {\n  id: serial(\"id\").primaryKey(),\n  sprintId: integer(\"sprint_id\").references(() => sprints.id).notNull(),\n  dayNumber: integer(\"day_number\").notNull(), // Day within the sprint (1-10)\n  activityOrder: integer(\"activity_order\").notNull(), // Order within the day\n  activityType: text(\"activity_type\").notNull(), // From activityTypeEnum\n  ceremonyType: text(\"ceremony_type\"), // If this is a ceremony\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  status: text(\"status\").notNull().default('pending'), // 'pending', 'in_progress', 'completed', 'skipped'\n  isRequired: boolean(\"is_required\").notNull().default(true),\n  estimatedMinutes: integer(\"estimated_minutes\").notNull().default(15),\n  competencyTags: text(\"competency_tags\").array(), // Competencies practiced\n  activityData: jsonb(\"activity_data\").notNull().default('{}'), // Activity-specific content\n  userResponse: jsonb(\"user_response\"), // User's actions/responses\n  evaluation: jsonb(\"evaluation\"), // AI evaluation of user's performance\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Competency Snapshots - snapshots of competency state at key points\nexport const competencySnapshots = pgTable(\"competency_snapshots\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  journeyId: integer(\"journey_id\").references(() => userJourneys.id).notNull(),\n  arcId: integer(\"arc_id\").references(() => journeyArcs.id),\n  sprintId: integer(\"sprint_id\").references(() => sprints.id),\n  snapshotType: text(\"snapshot_type\").notNull(), // 'arc_start', 'arc_end', 'sprint_end', 'journey_end'\n  readinessScore: integer(\"readiness_score\").notNull(),\n  competencyScores: jsonb(\"competency_scores\").notNull(), // { [slug]: { band, confidence, score } }\n  strengths: text(\"strengths\").array(),\n  gaps: text(\"gaps\").array(),\n  recommendations: jsonb(\"recommendations\"), // AI-generated recommendations\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Insert schemas for Phase 3 tables\nexport const insertProgressionPathSchema = createInsertSchema(progressionPaths).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertProjectTemplateSchema = createInsertSchema(projectTemplates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertUserJourneySchema = createInsertSchema(userJourneys).omit({\n  id: true,\n  startedAt: true,\n  lastActivityAt: true,\n});\n\nexport const insertJourneyArcSchema = createInsertSchema(journeyArcs).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSprintSchema = createInsertSchema(sprints).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertSprintActivitySchema = createInsertSchema(sprintActivities).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCompetencySnapshotSchema = createInsertSchema(competencySnapshots).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for Phase 3 tables\nexport type InsertProgressionPath = z.infer<typeof insertProgressionPathSchema>;\nexport type ProgressionPath = typeof progressionPaths.$inferSelect;\n\nexport type InsertProjectTemplate = z.infer<typeof insertProjectTemplateSchema>;\nexport type ProjectTemplate = typeof projectTemplates.$inferSelect;\n\nexport type InsertUserJourney = z.infer<typeof insertUserJourneySchema>;\nexport type UserJourney = typeof userJourneys.$inferSelect;\n\nexport type InsertJourneyArc = z.infer<typeof insertJourneyArcSchema>;\nexport type JourneyArc = typeof journeyArcs.$inferSelect;\n\nexport type InsertSprint = z.infer<typeof insertSprintSchema>;\nexport type Sprint = typeof sprints.$inferSelect;\n\nexport type InsertSprintActivity = z.infer<typeof insertSprintActivitySchema>;\nexport type SprintActivity = typeof sprintActivities.$inferSelect;\n\nexport type InsertCompetencySnapshot = z.infer<typeof insertCompetencySnapshotSchema>;\nexport type CompetencySnapshot = typeof competencySnapshots.$inferSelect;\n\n// Journey state interface for frontend consumption\nexport interface JourneyState {\n  journey: UserJourney;\n  currentArc: JourneyArc | null;\n  currentSprint: Sprint | null;\n  currentDay: number;\n  todayActivities: SprintActivity[];\n  readinessScore: number;\n  canGraduate: boolean;\n  exitOptions: {\n    userChoice: boolean;\n    readinessThreshold: boolean;\n    maxSprints: boolean;\n  };\n}\n\n// Sprint generation request\nexport interface SprintGenerationRequest {\n  journeyId: number;\n  sprintNumber: number;\n  difficultyBand: DifficultyBand;\n  previousSprints: Sprint[];\n  userCompetencyGaps: string[];\n  avoidThemes: string[];\n  avoidTemplates: string[];\n}\n\n// Progression requirements\nexport interface ProgressionRequirements {\n  minSprints: number;\n  maxSprints: number;\n  readinessThreshold: number;\n  requiredCompetencies: {\n    slug: string;\n    minBand: MasteryBand;\n  }[];\n}\n\n// Job Offer Details Structure - mimics real job offers\nexport interface OfferDetails {\n  // Core Compensation\n  baseSalary: number;\n  salaryFrequency: 'annual' | 'monthly';\n  signingBonus?: number;\n  annualBonus?: {\n    targetPercent: number;\n    description: string;\n  };\n  \n  // Equity\n  equity?: {\n    type: 'stock_options' | 'rsu' | 'none';\n    amount: number;\n    vestingSchedule: string;\n    cliffMonths: number;\n    totalVestingMonths: number;\n  };\n  \n  // Benefits\n  benefits: {\n    healthInsurance: string;\n    dentalVision: boolean;\n    retirement401k: {\n      available: boolean;\n      matchPercent?: number;\n      maxMatch?: number;\n    };\n    pto: {\n      days: number;\n      type: 'unlimited' | 'accrued' | 'fixed';\n    };\n    remote: 'full' | 'hybrid' | 'onsite';\n    otherBenefits: string[];\n  };\n  \n  // Job Details\n  startDate: string;\n  responseDeadline: string;\n  reportingTo: string;\n  teamSize: number;\n  \n  // Offer metadata\n  offerDate: string;\n  offerLetterSignatory: string;\n  offerLetterSignatoryTitle: string;\n}\n\n// =====================================================\n// Phase 4: Dynamic Sprint Generation Templates\n// =====================================================\n\nexport type TemplateCategory = 'bug' | 'feature' | 'soft_skill';\nexport type TemplateDifficulty = 'guided' | 'supported' | 'independent' | 'expert';\n\nexport interface ContextVariable {\n  key: string;\n  description: string;\n  examples: Record<string, string>;\n}\n\nexport interface BugTemplate {\n  id: string;\n  version: string;\n  category: 'bug';\n  name: string;\n  summary: string;\n  description: string;\n  difficulty: TemplateDifficulty[];\n  roles: string[];\n  languages: string[];\n  competencies: string[];\n  contextVariables: ContextVariable[];\n  scenarioTemplate: {\n    ticketTitle: string;\n    ticketDescription: string;\n    acceptanceCriteria: string[];\n    filesToInvestigate: string[];\n  };\n  codeExercise: {\n    problemDescription: string;\n    codeTemplate: string;\n    blanks: {\n      id: string;\n      placeholder: string;\n      correctAnswers: string[];\n      hint: string;\n    }[];\n    fixedCode: string;\n    successMessage: string;\n  };\n  hints: string[];\n  commonMistakes: string[];\n  industryExamples: Record<string, {\n    feature: string;\n    specificContext: string;\n    testScenario: string;\n  }>;\n  cooldownSprints: number;\n}\n\nexport interface FeatureTemplate {\n  id: string;\n  version: string;\n  category: 'feature';\n  name: string;\n  summary: string;\n  description: string;\n  difficulty: TemplateDifficulty[];\n  roles: string[];\n  languages: string[];\n  competencies: string[];\n  contextVariables: ContextVariable[];\n  scenarioTemplate: {\n    ticketTitle: string;\n    ticketDescription: string;\n    acceptanceCriteria: string[];\n    technicalRequirements: string[];\n  };\n  codeExercise: {\n    problemDescription: string;\n    codeTemplate: string;\n    blanks: {\n      id: string;\n      placeholder: string;\n      correctAnswers: string[];\n      hint: string;\n    }[];\n    solutionCode: string;\n    successMessage: string;\n  };\n  hints: string[];\n  industryExamples: Record<string, {\n    feature: string;\n    specificContext: string;\n    businessValue: string;\n  }>;\n  cooldownSprints: number;\n}\n\nexport interface SoftSkillTemplate {\n  id: string;\n  version: string;\n  category: 'soft_skill';\n  name: string;\n  summary: string;\n  skillType: 'pressure' | 'feedback' | 'conflict' | 'ambiguity' | 'communication' | 'help' | 'mistakes';\n  competencies: string[];\n  trigger: 'start_of_day' | 'mid_sprint' | 'end_of_day' | 'after_activity' | 'random';\n  contextVariables: ContextVariable[];\n  scenarioTemplate: {\n    setup: string;\n    message: string;\n    sender: string;\n    senderRole: string;\n  };\n  responseOptions: {\n    id: string;\n    label: string;\n    description: string;\n    isRecommended: boolean;\n    evaluationNotes: string;\n  }[];\n  evaluationCriteria: {\n    dimension: string;\n    question: string;\n    weight: number;\n  }[];\n  followUpTemplates: {\n    condition: string;\n    message: string;\n  }[];\n  industryExamples: Record<string, {\n    context: string;\n    specificMessage: string;\n  }>;\n  cooldownSprints: number;\n}\n\nexport type ProblemTemplate = BugTemplate | FeatureTemplate | SoftSkillTemplate;\n\nexport interface SprintTheme {\n  id: string;\n  name: string;\n  description: string;\n  industries: string[];\n  suggestedTemplates: {\n    bugs: string[];\n    features: string[];\n    softSkills: string[];\n  };\n}\n\nexport interface GeneratedSprintBacklog {\n  theme: SprintTheme;\n  tickets: {\n    templateId: string;\n    type: 'bug' | 'feature';\n    day: number;\n    appliedContext: Record<string, string>;\n    generatedTicket: {\n      title: string;\n      description: string;\n      acceptanceCriteria: string[];\n      difficulty: TemplateDifficulty;\n    };\n  }[];\n  softSkillEvents: {\n    templateId: string;\n    day: number;\n    trigger: string;\n    appliedContext: Record<string, string>;\n    generatedScenario: {\n      setup: string;\n      message: string;\n      sender: string;\n      senderRole: string;\n    };\n  }[];\n  ceremonies: {\n    planning: { day: number; script: string[] };\n    standups: { day: number; script: string[] }[];\n    review: { day: number; script: string[] };\n    retro: { day: number; script: string[] };\n  };\n}\n\n// =====================================================\n// Phase 5: Sprint Tickets, Ceremonies, Git Workflow\n// =====================================================\n\nexport type TicketStatus = 'todo' | 'in_progress' | 'in_review' | 'done';\nexport type TicketType = 'bug' | 'feature';\nexport type CeremonyStatus = 'pending' | 'in_progress' | 'completed' | 'skipped';\nexport type GitCommandType = 'clone' | 'checkout' | 'branch' | 'add' | 'commit' | 'push' | 'pull' | 'fetch' | 'merge' | 'rebase' | 'status' | 'log' | 'diff';\nexport type PRStatus = 'draft' | 'open' | 'changes_requested' | 'approved' | 'merged' | 'closed';\n\n// Sprint Tickets - individual work items with Git state\nexport const sprintTickets = pgTable(\"sprint_tickets\", {\n  id: serial(\"id\").primaryKey(),\n  sprintId: integer(\"sprint_id\").references(() => sprints.id).notNull(),\n  ticketKey: text(\"ticket_key\").notNull(), // e.g., \"ACME-42\"\n  templateId: text(\"template_id\"), // Reference to template used\n  type: text(\"type\").notNull(), // 'bug' | 'feature'\n  title: text(\"title\").notNull(),\n  description: text(\"description\").notNull(),\n  acceptanceCriteria: jsonb(\"acceptance_criteria\").notNull().default('[]'),\n  storyPoints: integer(\"story_points\").notNull().default(2),\n  status: text(\"status\").notNull().default('todo'), // TicketStatus\n  priority: text(\"priority\").notNull().default('medium'),\n  dayAssigned: integer(\"day_assigned\").notNull().default(1),\n  gitState: jsonb(\"git_state\").notNull().default('{}'), // GitTicketState\n  codeExercise: jsonb(\"code_exercise\"), // Code exercise data from template\n  prDetails: jsonb(\"pr_details\"), // PR information\n  reviewComments: jsonb(\"review_comments\").default('[]'),\n  competenciesPracticed: text(\"competencies_practiced\").array(),\n  evaluation: jsonb(\"evaluation\"), // AI evaluation of work\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Ceremony Instances - tracking ceremony execution\nexport const ceremonyInstances = pgTable(\"ceremony_instances\", {\n  id: serial(\"id\").primaryKey(),\n  sprintId: integer(\"sprint_id\").references(() => sprints.id).notNull(),\n  ceremonyType: text(\"ceremony_type\").notNull(), // CeremonyType\n  dayNumber: integer(\"day_number\").notNull(),\n  status: text(\"status\").notNull().default('pending'), // CeremonyStatus\n  script: jsonb(\"script\").notNull().default('[]'), // Ceremony script/prompts\n  teamMessages: jsonb(\"team_messages\").notNull().default('[]'), // AI team member messages\n  userResponses: jsonb(\"user_responses\").notNull().default('[]'), // User's responses\n  actionItems: jsonb(\"action_items\").default('[]'), // For retro\n  commitments: jsonb(\"commitments\").default('[]'), // For planning\n  feedback: jsonb(\"feedback\"), // Manager feedback for 1:1\n  competencyDeltas: jsonb(\"competency_deltas\"), // Competency changes from this ceremony\n  startedAt: timestamp(\"started_at\"),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Git Sessions - one per ticket, tracks Git state\nexport const gitSessions = pgTable(\"git_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  ticketId: integer(\"ticket_id\").references(() => sprintTickets.id).notNull(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  repoName: text(\"repo_name\").notNull(),\n  currentBranch: text(\"current_branch\").notNull().default('main'),\n  isCloned: boolean(\"is_cloned\").notNull().default(false),\n  stagedFiles: text(\"staged_files\").array().default([]),\n  commits: jsonb(\"commits\").notNull().default('[]'), // Local commit history\n  remoteSyncStatus: text(\"remote_sync_status\").notNull().default('synced'), // 'synced', 'ahead', 'behind', 'diverged'\n  prStatus: text(\"pr_status\"), // PRStatus\n  prUrl: text(\"pr_url\"),\n  lastFetchAt: timestamp(\"last_fetch_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Git Events - individual Git commands executed\nexport const gitEvents = pgTable(\"git_events\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => gitSessions.id).notNull(),\n  commandType: text(\"command_type\").notNull(), // GitCommandType\n  rawCommand: text(\"raw_command\").notNull(), // Full command string\n  isValid: boolean(\"is_valid\").notNull().default(true),\n  output: text(\"output\"), // Simulated output\n  errorMessage: text(\"error_message\"),\n  stateChange: jsonb(\"state_change\"), // What changed in git state\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Workspace Phase types\nexport type WorkspacePhase = 'onboarding' | 'planning' | 'execution' | 'review' | 'retro';\nexport type WorkspaceStatus = 'active' | 'paused' | 'completed';\nexport type PhaseEventStatus = 'started' | 'completed';\n\n// Workspace Instances - created when job offer is accepted\nexport const workspaceInstances = pgTable(\"workspace_instances\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  journeyId: integer(\"journey_id\").references(() => userJourneys.id).notNull(),\n  jobApplicationId: integer(\"job_application_id\").references(() => jobApplications.id),\n  projectTemplateId: integer(\"project_template_id\").references(() => projectTemplates.id),\n  companyName: text(\"company_name\").notNull(),\n  role: text(\"role\").notNull(),\n  status: text(\"status\").notNull().default('active'), // WorkspaceStatus\n  currentPhase: text(\"current_phase\").notNull().default('onboarding'), // WorkspacePhase\n  currentSprintId: integer(\"current_sprint_id\"),\n  onboardingCompletedAt: timestamp(\"onboarding_completed_at\"),\n  workspaceMetadata: jsonb(\"workspace_metadata\").notNull().default('{}'),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Workspace Phase Events - tracks phase transitions\nexport const workspacePhaseEvents = pgTable(\"workspace_phase_events\", {\n  id: serial(\"id\").primaryKey(),\n  workspaceId: integer(\"workspace_id\").references(() => workspaceInstances.id).notNull(),\n  phase: text(\"phase\").notNull(), // WorkspacePhase\n  sprintId: integer(\"sprint_id\"), // Nullable - only for sprint phases\n  status: text(\"status\").notNull(), // PhaseEventStatus: 'started' | 'completed'\n  payload: jsonb(\"payload\").default('{}'), // Phase-specific outputs (sprint goal, retro actions, etc.)\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Insert schemas for workspace tables\nexport const insertWorkspaceInstanceSchema = createInsertSchema(workspaceInstances).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertWorkspacePhaseEventSchema = createInsertSchema(workspacePhaseEvents).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for workspace tables\nexport type InsertWorkspaceInstance = z.infer<typeof insertWorkspaceInstanceSchema>;\nexport type WorkspaceInstance = typeof workspaceInstances.$inferSelect;\n\n// Phase 6: Sprint Planning Session Tables\nexport type PlanningPhase = 'context' | 'discussion' | 'commitment';\n\nexport const planningSessions = pgTable(\"planning_sessions\", {\n  id: serial(\"id\").primaryKey(),\n  workspaceId: integer(\"workspace_id\").references(() => workspaceInstances.id).notNull(),\n  sprintId: integer(\"sprint_id\").references(() => sprints.id),\n  role: text(\"role\").notNull(), // 'developer' | 'pm' | 'qa' | etc.\n  level: text(\"level\").notNull(), // 'intern' | 'junior' | 'mid' | 'senior'\n  currentPhase: text(\"current_phase\").notNull().default('context'), // PlanningPhase\n  phaseCompletions: jsonb(\"phase_completions\").notNull().default('{\"context\": false, \"discussion\": false, \"commitment\": false}'),\n  selectedItems: jsonb(\"selected_items\").notNull().default('[]'), // Array of backlog item IDs selected for sprint\n  capacityUsed: integer(\"capacity_used\").notNull().default(0),\n  goalStatement: text(\"goal_statement\"),\n  commitmentSummary: text(\"commitment_summary\"),\n  knowledgeCheckPassed: boolean(\"knowledge_check_passed\").notNull().default(false),\n  autoStartInitialized: boolean(\"auto_start_initialized\").notNull().default(false), // Prevents duplicate auto-start messages on concurrent requests\n  status: text(\"status\").notNull().default('active'), // 'active' | 'completed' | 'abandoned'\n  score: integer(\"score\"), // Final planning score (0-100)\n  feedback: jsonb(\"feedback\"), // Evaluation feedback\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const planningMessages = pgTable(\"planning_messages\", {\n  id: serial(\"id\").primaryKey(),\n  sessionId: integer(\"session_id\").references(() => planningSessions.id).notNull(),\n  sender: text(\"sender\").notNull(), // 'User' or AI persona name\n  senderRole: text(\"sender_role\").notNull(), // 'user' | 'pm' | 'developer' | 'qa' | etc.\n  message: text(\"message\").notNull(),\n  phase: text(\"phase\").notNull(), // PlanningPhase\n  isUser: boolean(\"is_user\").notNull().default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Insert schemas for planning tables\nexport const insertPlanningSessionSchema = createInsertSchema(planningSessions).omit({\n  id: true,\n  startedAt: true,\n});\n\nexport const insertPlanningMessageSchema = createInsertSchema(planningMessages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for planning tables\nexport type InsertPlanningSession = z.infer<typeof insertPlanningSessionSchema>;\nexport type PlanningSession = typeof planningSessions.$inferSelect;\n\nexport type InsertPlanningMessage = z.infer<typeof insertPlanningMessageSchema>;\nexport type PlanningMessage = typeof planningMessages.$inferSelect;\n\n// Engagement mode types for planning\nexport type EngagementMode = 'shadow' | 'guided' | 'active' | 'facilitator';\nexport type PhaseEngagement = 'observe' | 'respond' | 'lead';\n\nexport interface LevelEngagement {\n  mode: EngagementMode;\n  autoStartConversation: boolean;\n  teamTalkRatio: number;\n  phaseEngagement: {\n    context: PhaseEngagement;\n    discussion: PhaseEngagement;\n    commitment: PhaseEngagement;\n  };\n  promptSuggestions?: {\n    context: string[];\n    discussion: string[];\n    commitment: string[];\n  };\n  autoStartMessage: string;\n}\n\n// Planning session state for API responses\nexport interface PlanningSessionState {\n  session: PlanningSession;\n  messages: PlanningMessage[];\n  backlogItems: {\n    id: string;\n    title: string;\n    description: string;\n    type: 'bug' | 'feature' | 'improvement';\n    priority: 'high' | 'medium' | 'low';\n    points: number;\n    selected: boolean;\n  }[];\n  capacity: number;\n  adapterConfig: {\n    role: string;\n    level: string;\n    facilitator: 'user' | 'ai';\n    showLearningObjectives: boolean;\n    showKnowledgeCheck: boolean;\n    canSkipPhases: boolean;\n    engagement?: LevelEngagement;\n  };\n}\n\nexport type InsertWorkspacePhaseEvent = z.infer<typeof insertWorkspacePhaseEventSchema>;\nexport type WorkspacePhaseEvent = typeof workspacePhaseEvents.$inferSelect;\n\n// Workspace state for API responses\nexport interface WorkspaceState {\n  workspace: WorkspaceInstance;\n  currentPhase: WorkspacePhase;\n  currentSprint: Sprint | null;\n  phaseChecklist: {\n    item: string;\n    completed: boolean;\n    required: boolean;\n  }[];\n  nextActions: {\n    action: string;\n    route: string;\n    priority: 'primary' | 'secondary';\n  }[];\n  phaseHistory: WorkspacePhaseEvent[];\n}\n\n// Insert schemas for Phase 5 tables\nexport const insertSprintTicketSchema = createInsertSchema(sprintTickets).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertCeremonyInstanceSchema = createInsertSchema(ceremonyInstances).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertGitSessionSchema = createInsertSchema(gitSessions).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertGitEventSchema = createInsertSchema(gitEvents).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types for Phase 5 tables\nexport type InsertSprintTicket = z.infer<typeof insertSprintTicketSchema>;\nexport type SprintTicket = typeof sprintTickets.$inferSelect;\n\nexport type InsertCeremonyInstance = z.infer<typeof insertCeremonyInstanceSchema>;\nexport type CeremonyInstance = typeof ceremonyInstances.$inferSelect;\n\nexport type InsertGitSession = z.infer<typeof insertGitSessionSchema>;\nexport type GitSession = typeof gitSessions.$inferSelect;\n\nexport type InsertGitEvent = z.infer<typeof insertGitEventSchema>;\nexport type GitEvent = typeof gitEvents.$inferSelect;\n\n// Git state for a ticket\nexport interface GitTicketState {\n  branchName: string | null;\n  branchCreatedAt: string | null;\n  commits: {\n    hash: string;\n    message: string;\n    timestamp: string;\n  }[];\n  isPushed: boolean;\n  prCreated: boolean;\n  prApproved: boolean;\n  isMerged: boolean;\n}\n\n// PR Details structure\nexport interface PRDetails {\n  title: string;\n  description: string;\n  targetBranch: string;\n  sourceBranch: string;\n  status: PRStatus;\n  reviewers: string[];\n  checksStatus: 'pending' | 'passing' | 'failing';\n  comments: {\n    author: string;\n    authorRole: string;\n    message: string;\n    file?: string;\n    line?: number;\n    timestamp: string;\n  }[];\n  approvedBy: string[];\n  createdAt: string;\n  mergedAt?: string;\n}\n\n// Ceremony user response\nexport interface CeremonyUserResponse {\n  promptId: string;\n  response: string;\n  timestamp: string;\n}\n\n// Standup response structure\nexport interface StandupResponse {\n  yesterday: string;\n  today: string;\n  blockers: string;\n}\n\n// Retro item structure\nexport interface RetroItem {\n  id: string;\n  category: 'went_well' | 'improve' | 'action_item';\n  content: string;\n  votes: number;\n  author: 'user' | string; // 'user' or AI team member name\n}\n\n// Sprint overview for dashboard\nexport interface SprintOverview {\n  sprint: Sprint;\n  tickets: SprintTicket[];\n  ceremonies: CeremonyInstance[];\n  currentDay: number;\n  ticketStats: {\n    todo: number;\n    inProgress: number;\n    inReview: number;\n    done: number;\n  };\n  upcomingCeremonies: CeremonyInstance[];\n  todayActivities: SprintActivity[];\n}\n\n// Journey dashboard data\nexport interface JourneyDashboard {\n  journey: UserJourney;\n  currentArc: JourneyArc | null;\n  currentSprint: SprintOverview | null;\n  readinessScore: number;\n  competencyScores: Record<string, { score: number; band: MasteryBand }>;\n  timeline: {\n    arcs: (JourneyArc & { sprints: Sprint[] })[];\n    currentPosition: { arcIndex: number; sprintIndex: number };\n  };\n  canGraduate: boolean;\n  estimatedSprintsRemaining: number;\n}\n","path":null,"size_bytes":69582,"size_tokens":null},"client/src/components/simulation/interview-session-old.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Send, Mic, MicOff, HelpCircle, Lightbulb, Bus, User, X } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  role: 'interviewer' | 'candidate';\n  content: string;\n  timestamp: Date;\n  score?: number;\n  feedback?: string;\n}\n\ninterface InterviewSessionProps {\n  session: any;\n  onComplete: () => void;\n}\n\nexport default function InterviewSession({ session, onComplete }: InterviewSessionProps) {\n  const { toast } = useToast();\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [currentResponse, setCurrentResponse] = useState(\"\");\n  const [timeRemaining, setTimeRemaining] = useState(session.configuration.duration * 60);\n  const [currentQuestion, setCurrentQuestion] = useState<any>(null);\n  const [isLoading, setIsLoading] = useState(false);\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioSupported, setAudioSupported] = useState(false);\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n\n  const generateQuestionMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/interview/question\", data);\n      return response.json();\n    },\n    onSuccess: (question) => {\n      setCurrentQuestion(question);\n      const newMessage: Message = {\n        id: Date.now().toString(),\n        role: 'interviewer',\n        content: question.question,\n        timestamp: new Date()\n      };\n      setMessages(prev => [...prev, newMessage]);\n    }\n  });\n\n  const evaluateAnswerMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/interview/evaluate\", data);\n      return response.json();\n    },\n    onSuccess: (evaluation) => {\n      // Update the last user message with score and feedback\n      setMessages(prev => {\n        const updated = [...prev];\n        const lastUserMessageIndex = updated.map(m => m.role).lastIndexOf('candidate');\n        if (lastUserMessageIndex !== -1) {\n          updated[lastUserMessageIndex] = {\n            ...updated[lastUserMessageIndex],\n            score: evaluation.score,\n            feedback: evaluation.feedback\n          };\n        }\n        return updated;\n      });\n\n      // Generate follow-up question if provided\n      if (evaluation.followUp) {\n        setTimeout(() => {\n          const followUpMessage: Message = {\n            id: Date.now().toString(),\n            role: 'interviewer',\n            content: evaluation.followUp,\n            timestamp: new Date()\n          };\n          setMessages(prev => [...prev, followUpMessage]);\n        }, 1000);\n      }\n    }\n  });\n\n  const generateFeedbackMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/sessions/${session.id}/feedback`);\n      return response.json();\n    },\n    onSuccess: (feedback) => {\n      toast({\n        title: \"Interview Complete!\",\n        description: `Your final score: ${feedback.score}/100`,\n      });\n      onComplete();\n    }\n  });\n\n  const transcribeAudioMutation = useMutation({\n    mutationFn: async (audioBlob: Blob) => {\n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'audio.webm');\n      \n      const response = await fetch('/api/transcribe', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Transcription failed: ${response.statusText}`);\n      }\n      \n      return response.json();\n    },\n    onSuccess: (result) => {\n      if (result.text && result.text.trim()) {\n        setCurrentResponse(prev => {\n          const newText = prev ? prev + ' ' + result.text.trim() : result.text.trim();\n          return newText;\n        });\n        toast({\n          title: \"Voice Recognized\",\n          description: \"Your speech has been converted to text successfully!\",\n        });\n      } else {\n        toast({\n          title: \"No Speech Detected\",\n          description: \"Please try speaking more clearly or check your microphone.\",\n          variant: \"destructive\"\n        });\n      }\n    },\n    onError: (error) => {\n      console.error('Transcription error:', error);\n      toast({\n        title: \"Transcription Failed\",\n        description: \"Unable to convert speech to text. Please try again or type your response.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  // Timer countdown\n  useEffect(() => {\n    if (timeRemaining <= 0) {\n      handleEndInterview();\n      return;\n    }\n\n    const timer = setInterval(() => {\n      setTimeRemaining(prev => prev - 1);\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [timeRemaining]);\n\n  // Generate initial question\n  useEffect(() => {\n    if (messages.length === 0) {\n      generateQuestionMutation.mutate({\n        profession: session.configuration.profession,\n        interviewType: session.configuration.interviewType,\n        difficulty: session.configuration.difficulty,\n        jobPosting: session.configuration.jobPosting,\n        previousQuestions: []\n      });\n    }\n  }, []);\n\n  // Initialize speech recognition\n  useEffect(() => {\n    const initializeSpeechRecognition = async () => {\n      // Check if browser supports speech recognition\n      const hasSpeechRecognition = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;\n      \n      if (!hasSpeechRecognition) {\n        console.log('Speech recognition not supported');\n        return;\n      }\n\n      try {\n        // Request microphone permission first\n        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n        stream.getTracks().forEach(track => track.stop()); // Stop the stream immediately\n\n        const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n        recognitionRef.current = new SpeechRecognition();\n        recognitionRef.current.continuous = false;\n        recognitionRef.current.interimResults = true; // Enable interim results for better UX\n        recognitionRef.current.lang = 'en-US';\n        recognitionRef.current.maxAlternatives = 1;\n\n        recognitionRef.current.onresult = (event: any) => {\n          let finalTranscript = '';\n          let interimTranscript = '';\n\n          for (let i = event.resultIndex; i < event.results.length; i++) {\n            const transcript = event.results[i][0].transcript;\n            if (event.results[i].isFinal) {\n              finalTranscript += transcript;\n            } else {\n              interimTranscript += transcript;\n            }\n          }\n\n          if (finalTranscript) {\n            setCurrentResponse(prev => {\n              const newText = prev ? prev + ' ' + finalTranscript : finalTranscript;\n              return newText;\n            });\n            toast({\n              title: \"Speech Recognized\",\n              description: \"Voice input added to your response.\",\n            });\n          }\n        };\n\n        recognitionRef.current.onerror = (event: any) => {\n          console.error('Speech recognition error:', event.error);\n          setIsRecording(false);\n          \n          if (event.error === 'network') {\n            setNetworkRetries(prev => prev + 1);\n            console.log('Network error, will retry automatically');\n            \n            // After 3 network failures, disable speech recognition\n            if (networkRetries >= 2) {\n              setSpeechSupported(false);\n              toast({\n                title: \"Voice Input Temporarily Unavailable\",\n                description: \"Unable to connect to speech recognition service. Please continue with typing - your responses work just as well!\",\n                variant: \"destructive\"\n              });\n            }\n            return;\n          }\n          \n          let errorMessage = \"Speech recognition failed. Please try typing instead.\";\n          let title = \"Voice Input Failed\";\n          \n          switch (event.error) {\n            case 'not-allowed':\n              title = \"Microphone Access Denied\";\n              errorMessage = \"Please allow microphone access in your browser settings and refresh the page.\";\n              break;\n            case 'no-speech':\n              // Don't show error for no speech, it's normal\n              return;\n            case 'audio-capture':\n              title = \"Audio Capture Failed\";\n              errorMessage = \"Unable to capture audio. Please check your microphone and try again.\";\n              break;\n            case 'service-not-allowed':\n              title = \"Service Not Available\";\n              errorMessage = \"Speech recognition service is not available in your browser. Please use typing instead.\";\n              break;\n          }\n          \n          toast({\n            title,\n            description: errorMessage,\n            variant: \"destructive\"\n          });\n        };\n\n        recognitionRef.current.onstart = () => {\n          setIsRecording(true);\n          setNetworkRetries(0); // Reset retry count on successful start\n          console.log('Speech recognition started');\n        };\n\n        recognitionRef.current.onend = () => {\n          setIsRecording(false);\n          console.log('Speech recognition ended');\n        };\n\n        recognitionRef.current.onspeechstart = () => {\n          console.log('Speech detected');\n        };\n\n        recognitionRef.current.onspeechend = () => {\n          console.log('Speech ended');\n        };\n\n        setSpeechSupported(true);\n\n      } catch (error) {\n        console.error('Failed to initialize speech recognition:', error);\n        setSpeechSupported(false);\n        if (error instanceof DOMException && error.name === 'NotAllowedError') {\n          toast({\n            title: \"Microphone Permission Required\",\n            description: \"Please allow microphone access to use voice input, or continue with typing.\",\n            variant: \"destructive\"\n          });\n        }\n      }\n    };\n\n    initializeSpeechRecognition();\n\n    // Monitor network connectivity\n    const handleOnline = () => setIsOnline(true);\n    const handleOffline = () => setIsOnline(false);\n    \n    window.addEventListener('online', handleOnline);\n    window.addEventListener('offline', handleOffline);\n    \n    return () => {\n      window.removeEventListener('online', handleOnline);\n      window.removeEventListener('offline', handleOffline);\n    };\n  }, []);\n\n  const toggleRecording = async () => {\n    if (!recognitionRef.current) {\n      toast({\n        title: \"Voice Input Not Available\",\n        description: \"Speech recognition requires Chrome, Edge, or Safari with internet access. Please type your response instead.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    // Check network connectivity first\n    if (!isOnline) {\n      toast({\n        title: \"No Internet Connection\",\n        description: \"Voice recognition requires an internet connection. Please check your connection and try again.\",\n        variant: \"destructive\"\n      });\n      return;\n    }\n\n    if (isRecording) {\n      recognitionRef.current.stop();\n      return;\n    }\n\n    try {\n      // Check microphone permission before starting\n      const permission = await navigator.permissions.query({ name: 'microphone' as PermissionName });\n      \n      if (permission.state === 'denied') {\n        toast({\n          title: \"Microphone Access Denied\",\n          description: \"Please enable microphone access in your browser settings and refresh the page.\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n\n      // Test microphone access\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      stream.getTracks().forEach(track => track.stop()); // Stop the test stream\n\n      recognitionRef.current.start();\n      toast({\n        title: \"Listening...\",\n        description: \"Speak clearly. The microphone will automatically stop when you finish speaking.\",\n      });\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n      setIsRecording(false);\n      \n      if (error instanceof DOMException) {\n        if (error.name === 'NotAllowedError') {\n          toast({\n            title: \"Microphone Permission Denied\",\n            description: \"Please allow microphone access in your browser and try again.\",\n            variant: \"destructive\"\n          });\n        } else if (error.name === 'NotFoundError') {\n          toast({\n            title: \"No Microphone Found\",\n            description: \"Please connect a microphone and try again.\",\n            variant: \"destructive\"\n          });\n        } else {\n          toast({\n            title: \"Microphone Error\",\n            description: \"Unable to access microphone. Please check your device settings.\",\n            variant: \"destructive\"\n          });\n        }\n      }\n    }\n  };\n\n  const handleSendResponse = async () => {\n    if (!currentResponse.trim() || !currentQuestion || isLoading) return;\n\n    setIsLoading(true);\n    \n    // Add user message\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'candidate',\n      content: currentResponse,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    \n    // Clear input\n    const response = currentResponse;\n    setCurrentResponse(\"\");\n\n    try {\n      // Evaluate the answer\n      await evaluateAnswerMutation.mutateAsync({\n        question: currentQuestion.question,\n        answer: response,\n        profession: session.configuration.profession,\n        difficulty: session.configuration.difficulty\n      });\n\n      // Generate next question after a delay\n      setTimeout(() => {\n        const previousQuestions = messages\n          .filter(m => m.role === 'interviewer')\n          .map(m => m.content);\n        \n        generateQuestionMutation.mutate({\n          profession: session.configuration.profession,\n          interviewType: session.configuration.interviewType,\n          difficulty: session.configuration.difficulty,\n          jobPosting: session.configuration.jobPosting,\n          previousQuestions\n        });\n      }, 2000);\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to process your response\",\n        variant: \"destructive\",\n      });\n    }\n    \n    setIsLoading(false);\n  };\n\n  const handleEndInterview = async () => {\n    // Update session with messages\n    await apiRequest(\"PATCH\", `/api/sessions/${session.id}`, {\n      messages: messages,\n      status: 'completed',\n      completedAt: new Date()\n    });\n\n    // Generate final feedback\n    generateFeedbackMutation.mutate();\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const getInterviewerName = () => {\n    const names = {\n      friendly: \"Sarah Chen\",\n      strict: \"Michael Rodriguez\", \n      casual: \"Alex Thompson\",\n      challenging: \"Dr. Jennifer Wu\"\n    };\n    return names[session.configuration.personality as keyof typeof names] || \"Sarah Chen\";\n  };\n\n  const getInterviewerRole = () => {\n    const roles = {\n      \"Technical Interview\": \"Senior Software Engineer\",\n      \"Behavioral Interview\": \"Engineering Manager\",\n      \"System Design\": \"Principal Architect\", \n      \"HR/Culture Fit\": \"HR Business Partner\"\n    };\n    return roles[session.configuration.interviewType as keyof typeof roles] || \"Senior Engineer\";\n  };\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Card>\n          {/* Session Header */}\n          <div className=\"border-b border-gray-200 p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                <Avatar>\n                  <AvatarFallback className=\"bg-blue-600 text-white\">\n                    <Bus className=\"h-5 w-5\" />\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{getInterviewerName()}</h3>\n                  <p className=\"text-sm text-gray-600\">{getInterviewerRole()}</p>\n                </div>\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-600\">Time Remaining</p>\n                  <p className={`font-semibold ${timeRemaining < 300 ? 'text-red-600' : 'text-gray-900'}`}>\n                    {formatTime(timeRemaining)}\n                  </p>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={handleEndInterview}\n                  className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                >\n                  <X className=\"h-4 w-4 mr-1\" />\n                  End Interview\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Chat Interface */}\n          <CardContent className=\"p-6\">\n            <div className=\"h-96 overflow-y-auto border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50 space-y-4\">\n              {messages.length === 0 && generateQuestionMutation.isPending && (\n                <div className=\"flex items-center space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className=\"bg-blue-600 text-white\">\n                      <Bus className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{getInterviewerName()}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">Preparing question...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n\n              {messages.map((message) => (\n                <div key={message.id} className=\"flex items-start space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className={\n                      message.role === 'interviewer' \n                        ? \"bg-blue-600 text-white\" \n                        : \"bg-gray-600 text-white\"\n                    }>\n                      {message.role === 'interviewer' ? (\n                        <Bus className=\"h-4 w-4\" />\n                      ) : (\n                        <User className=\"h-4 w-4\" />\n                      )}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {message.role === 'interviewer' ? getInterviewerName() : 'You'}\n                      </p>\n                      {message.score && (\n                        <Badge variant={message.score >= 70 ? \"default\" : \"secondary\"}>\n                          {message.score}/100\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-gray-700 mt-1\">{message.content}</p>\n                    {message.feedback && (\n                      <div className=\"mt-2 p-2 bg-blue-50 rounded border border-blue-200\">\n                        <p className=\"text-sm text-blue-800\">{message.feedback}</p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 mt-2\">\n                      {message.timestamp.toLocaleTimeString()}\n                    </p>\n                  </div>\n                </div>\n              ))}\n\n              {isLoading && (\n                <div className=\"flex items-center space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className=\"bg-blue-600 text-white\">\n                      <Bus className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{getInterviewerName()}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">Evaluating your response...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Recording Status */}\n            {isRecording && (\n              <div className=\"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"animate-pulse bg-red-500 rounded-full h-3 w-3\"></div>\n                  <span className=\"text-red-800 font-medium\">Recording... Speak clearly</span>\n                  <button \n                    onClick={toggleRecording}\n                    className=\"ml-auto text-red-600 hover:text-red-800 underline text-sm\"\n                  >\n                    Stop Recording\n                  </button>\n                </div>\n              </div>\n            )}\n\n            {/* Network Status Warning */}\n            {!isOnline && (\n              <div className=\"mb-3 p-3 bg-red-50 border border-red-200 rounded-lg\">\n                <div className=\"flex items-start space-x-2\">\n                  <X className=\"h-5 w-5 text-red-600 mt-0.5\" />\n                  <div>\n                    <p className=\"text-red-800 font-medium\">No Internet Connection</p>\n                    <p className=\"text-red-700 text-sm mt-1\">\n                      Voice recognition requires a stable internet connection. Please check your connection and refresh the page.\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Speech Recognition Help */}\n            {isOnline && !speechSupported && (\n              <div className=\"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                <div className=\"flex items-start space-x-2\">\n                  <Lightbulb className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                  <div>\n                    <p className=\"text-blue-800 font-medium\">Voice Input Alternative</p>\n                    <p className=\"text-blue-700 text-sm mt-1\">\n                      Voice recognition is temporarily unavailable due to network connectivity. \n                      <strong>Tip:</strong> Use your device's built-in voice-to-text feature (like iPhone's dictation or Android's voice typing) \n                      in the text area below for a similar experience!\n                    </p>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* Voice Input Instructions */}\n            <div className=\"mb-3 p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n              <div className=\"flex items-start space-x-2\">\n                <Lightbulb className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                <div>\n                  <p className=\"text-blue-800 font-medium\">Voice Input Solution</p>\n                  <p className=\"text-blue-700 text-sm mt-1\">\n                    For the best voice input experience, use your device's built-in dictation:\n                    <br />\n                    <strong> iPhone/iPad:</strong> Tap the microphone icon on your keyboard\n                    <br />\n                    <strong> Android:</strong> Tap the microphone icon on your keyboard\n                    <br />\n                    <strong> Mac:</strong> Press Fn key twice or use Edit  Start Dictation\n                    <br />\n                    <strong> Windows:</strong> Press Windows + H for voice typing\n                  </p>\n                </div>\n              </div>\n            </div>\n\n            {/* Response Input */}\n            <div className=\"flex space-x-3\">\n              <Textarea\n                className=\"flex-1 resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500\"\n                rows={4}\n                placeholder=\"Type your response here... (For voice input: use your device's built-in voice typing - tap the microphone on your keyboard or use voice commands)\"\n                value={currentResponse}\n                onChange={(e) => setCurrentResponse(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendResponse();\n                  }\n                }}\n                disabled={isLoading || generateQuestionMutation.isPending}\n                aria-label=\"Interview response input\"\n                autoComplete=\"off\"\n                spellCheck=\"true\"\n              />\n              <div className=\"flex flex-col space-y-2\">\n                <Button \n                  size=\"lg\"\n                  onClick={handleSendResponse}\n                  disabled={!currentResponse.trim() || isLoading || generateQuestionMutation.isPending}\n                  className=\"bg-blue-600 hover:bg-blue-700\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n                <Button \n                  variant=\"outline\" \n                  size=\"lg\"\n                  onClick={() => {\n                    toast({\n                      title: \"Voice Input Tip\",\n                      description: \"Use your device's built-in voice typing feature in the text box below for reliable voice input.\",\n                    });\n                  }}\n                  disabled={isLoading || generateQuestionMutation.isPending}\n                  className=\"hover:bg-blue-50\"\n                  title=\"Voice Input Help\"\n                >\n                  <HelpCircle className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"flex space-x-2 mt-3\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                disabled\n                className=\"text-sm\"\n              >\n                <HelpCircle className=\"h-3 w-3 mr-1\" />\n                Ask for clarification\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                disabled\n                className=\"text-sm\"\n              >\n                <Lightbulb className=\"h-3 w-3 mr-1\" />\n                Request a hint\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":27880,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":2627,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":791,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"server/services/openai.ts":{"content":"import OpenAI from \"openai\";\n\n// Using OpenAI for AI inference\nconst openai = new OpenAI({ \n  apiKey: process.env.OPENAI_API_KEY\n});\n\nexport interface InterviewQuestion {\n  question: string;\n  category: string;\n  difficulty: string;\n  expectedAnswer?: string;\n}\n\nexport interface InterviewFeedback {\n  score: number;\n  strengths: string[];\n  improvements: string[];\n  overallFeedback: string;\n}\n\nexport interface NegotiationResponse {\n  response: string;\n  sentiment: string;\n  strategy: string;\n  counterOffer?: any;\n}\n\nexport class OpenAIService {\n  async generateInterviewQuestion(\n    profession: string,\n    interviewType: string,\n    difficulty: string,\n    jobPosting?: string,\n    previousQuestions: string[] = []\n  ): Promise<InterviewQuestion> {\n    const prompt = `Generate a ${difficulty}-level ${interviewType} interview question for a ${profession} position.\n    ${jobPosting ? `Job posting context: ${jobPosting}` : ''}\n    ${previousQuestions.length > 0 ? `Avoid these previously asked questions: ${previousQuestions.join(', ')}` : ''}\n    \n    Respond with JSON in this format: {\n      \"question\": \"specific interview question\",\n      \"category\": \"technical/behavioral/system-design/culture-fit\",\n      \"difficulty\": \"${difficulty}\",\n      \"expectedAnswer\": \"brief guidance on what a good answer would include\"\n    }`;\n\n    try {\n      // Check if we have a valid API key first\n      if (!process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY.includes('*')) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert interviewer who creates realistic and challenging interview questions.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as InterviewQuestion;\n    } catch (error) {\n      // Fallback questions when API fails\n      console.log('Using fallback question generation due to API error');\n      const fallbackQuestions = this.getFallbackQuestion(profession, interviewType, difficulty, previousQuestions);\n      return fallbackQuestions;\n    }\n  }\n\n  private getFallbackQuestion(profession: string, interviewType: string, difficulty: string, previousQuestions: string[]): InterviewQuestion {\n    const questionBank = {\n      \"Software Engineer\": {\n        \"Technical Interview\": {\n          junior: [\n            \"What is the difference between let, const, and var in JavaScript?\",\n            \"Explain the concept of closures in JavaScript with an example.\",\n            \"How would you reverse a string in your preferred programming language?\"\n          ],\n          mid: [\n            \"Design a REST API for a simple e-commerce application. What endpoints would you create?\",\n            \"Explain the difference between SQL and NoSQL databases. When would you use each?\",\n            \"How would you implement a simple caching mechanism in a web application?\"\n          ],\n          senior: [\n            \"How would you design a system to handle 1 million concurrent users?\",\n            \"Explain microservices architecture and its trade-offs compared to monolithic design.\",\n            \"Describe your approach to implementing real-time features in a web application.\"\n          ]\n        },\n        \"Behavioral Interview\": {\n          junior: [\n            \"Tell me about a time when you had to learn a new technology quickly.\",\n            \"Describe a challenging bug you encountered and how you solved it.\",\n            \"How do you stay updated with new technologies and best practices?\"\n          ],\n          mid: [\n            \"Tell me about a time when you had to work with a difficult team member.\",\n            \"Describe a project where you had to balance technical debt with new feature development.\",\n            \"How do you handle code reviews and feedback?\"\n          ],\n          senior: [\n            \"Tell me about a time when you had to make a difficult technical decision.\",\n            \"Describe how you would mentor a junior developer who is struggling.\",\n            \"How do you approach system design decisions in a team environment?\"\n          ]\n        }\n      }\n    };\n\n    const questions = questionBank[profession as keyof typeof questionBank]?.[interviewType as keyof typeof questionBank[\"Software Engineer\"]]?.[difficulty as keyof typeof questionBank[\"Software Engineer\"][\"Technical Interview\"]] || [\n      \"Tell me about your experience with software development.\",\n      \"What interests you about this role?\",\n      \"Describe a project you're proud of.\"\n    ];\n\n    // Filter out previously asked questions\n    const availableQuestions = questions.filter(q => !previousQuestions.includes(q));\n    const selectedQuestion = availableQuestions.length > 0 ? availableQuestions[0] : questions[0];\n\n    return {\n      question: selectedQuestion,\n      category: interviewType === \"Technical Interview\" ? \"technical\" : \"behavioral\",\n      difficulty,\n      expectedAnswer: \"Provide a clear, structured answer with specific examples and demonstrate your understanding of the topic.\"\n    };\n  }\n\n  async evaluateInterviewAnswer(\n    question: string,\n    answer: string,\n    profession: string,\n    difficulty: string\n  ): Promise<{ score: number; feedback: string; followUp?: string }> {\n    const prompt = `Evaluate this interview answer for a ${profession} position:\n    \n    Question: ${question}\n    Answer: ${answer}\n    Difficulty Level: ${difficulty}\n    \n    Provide evaluation with score (0-100) and constructive feedback. Also suggest a follow-up question if appropriate.\n    \n    Respond with JSON: {\n      \"score\": number,\n      \"feedback\": \"detailed feedback on the answer\",\n      \"followUp\": \"optional follow-up question\"\n    }`;\n\n    try {\n      // Check if we have a valid API key first\n      if (!process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY.includes('*')) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert interviewer who provides fair and constructive feedback on interview answers.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result;\n    } catch (error) {\n      // Fallback evaluation when API fails\n      console.log('Using fallback evaluation due to API error');\n      return this.getFallbackEvaluation(question, answer, difficulty);\n    }\n  }\n\n  private getFallbackEvaluation(question: string, answer: string, difficulty: string): { score: number; feedback: string; followUp?: string } {\n    const answerLength = answer.trim().length;\n    const hasExamples = answer.toLowerCase().includes('example') || answer.toLowerCase().includes('for instance');\n    const hasStructure = answer.includes('.') && answer.split('.').length > 2;\n    \n    let score = 60; // Base score\n    \n    // Adjust score based on answer quality indicators\n    if (answerLength > 100) score += 10;\n    if (answerLength > 300) score += 10;\n    if (hasExamples) score += 15;\n    if (hasStructure) score += 10;\n    \n    // Adjust based on difficulty\n    const difficultyMultiplier = difficulty === 'senior' ? 0.9 : difficulty === 'mid' ? 0.95 : 1.0;\n    score = Math.round(score * difficultyMultiplier);\n    score = Math.min(score, 95); // Cap at 95 for fallback\n    \n    const feedback = score >= 80 \n      ? \"Great answer! You demonstrated good understanding and provided relevant details. Consider adding more specific examples to strengthen your response.\"\n      : score >= 65\n      ? \"Good response with solid fundamentals. Try to elaborate more on your reasoning and include specific examples when possible.\"\n      : \"Your answer shows basic understanding. Consider providing more detailed explanations and concrete examples to demonstrate your knowledge.\";\n      \n    const followUps = [\n      \"Can you walk me through how you would implement this in practice?\",\n      \"What challenges might you face with this approach?\",\n      \"How would you handle edge cases in this scenario?\",\n      \"What tools or technologies would you use for this?\"\n    ];\n    \n    const followUp = followUps[Math.floor(Math.random() * followUps.length)];\n    \n    return { score, feedback, followUp };\n  }\n\n  async generateNegotiationResponse(\n    scenario: string,\n    userMessage: string,\n    negotiationHistory: any[],\n    counterpartStyle: string\n  ): Promise<NegotiationResponse> {\n    const prompt = `You are playing the role of a ${counterpartStyle} negotiation counterpart in a ${scenario} scenario.\n    \n    Negotiation history: ${JSON.stringify(negotiationHistory)}\n    User's latest message: ${userMessage}\n    \n    Respond as the counterpart would, considering their ${counterpartStyle} style.\n    \n    Respond with JSON: {\n      \"response\": \"your negotiation response\",\n      \"sentiment\": \"collaborative/competitive/neutral\",\n      \"strategy\": \"brief explanation of your negotiation strategy\",\n      \"counterOffer\": \"any specific counter-offer if applicable\"\n    }`;\n\n    try {\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert negotiator who adapts their style based on the scenario and maintains realistic negotiation dynamics.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as NegotiationResponse;\n    } catch (error) {\n      return this.getFallbackNegotiationResponse(scenario, userMessage, counterpartStyle);\n    }\n  }\n\n  private getFallbackNegotiationResponse(scenario: string, userMessage: string, counterpartStyle: string): NegotiationResponse {\n    const responses = {\n      collaborative: [\n        \"I appreciate your perspective on this. Let's see how we can find a solution that works for both of us.\",\n        \"That's an interesting point. I'd like to understand your priorities better so we can work together.\",\n        \"I think we're making good progress. What if we explored some alternative approaches?\"\n      ],\n      competitive: [\n        \"I understand your position, but we need to be realistic about what's possible here.\",\n        \"That's quite ambitious. Our standard practice is different, but let me see what options we have.\",\n        \"I need to be frank with you - that's outside our typical range, but I'm willing to discuss alternatives.\"\n      ],\n      analytical: [\n        \"Let me review the data and market standards for similar positions.\",\n        \"Based on our compensation analysis, here's what I can share with you.\",\n        \"I'd like to present some benchmarks that might help frame our discussion.\"\n      ],\n      relationship: [\n        \"I want to make sure we maintain a positive working relationship throughout this process.\",\n        \"Your success is important to us, and I want to find a path that supports that.\",\n        \"Let's focus on building something that sets you up for long-term success here.\"\n      ]\n    };\n\n    const styleResponses = responses[counterpartStyle as keyof typeof responses] || responses.collaborative;\n    const response = styleResponses[Math.floor(Math.random() * styleResponses.length)];\n    \n    const sentiment = counterpartStyle === 'competitive' ? 'competitive' : \n                     counterpartStyle === 'collaborative' ? 'collaborative' : 'neutral';\n    \n    const strategy = `Using a ${counterpartStyle} approach to address your request while maintaining our position.`;\n    \n    return {\n      response,\n      sentiment,\n      strategy,\n      counterOffer: scenario === 'salary' ? \"We could consider a performance-based increase after 6 months.\" : undefined\n    };\n  }\n\n  async generateWorkspaceMessage(\n    teamMember: any,\n    context: string,\n    userAction: string\n  ): Promise<{ message: string; urgency: string; nextAction?: string }> {\n    const prompt = `You are ${teamMember.name}, a ${teamMember.role} with ${teamMember.personality} personality.\n    \n    Context: ${context}\n    User just: ${userAction}\n    \n    Respond as this team member would in a workplace chat/meeting.\n    \n    Respond with JSON: {\n      \"message\": \"your workplace message\",\n      \"urgency\": \"low/medium/high\",\n      \"nextAction\": \"suggested next action for the user (optional)\"\n    }`;\n\n    try {\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are a realistic workplace team member who communicates professionally and authentically.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result;\n    } catch (error) {\n      throw new Error(\"Failed to generate workspace message: \" + (error as Error).message);\n    }\n  }\n\n  async generateSessionFeedback(\n    sessionType: string,\n    messages: any[],\n    configuration: any\n  ): Promise<InterviewFeedback> {\n    const prompt = `Analyze this ${sessionType} simulation session and provide comprehensive feedback:\n    \n    Configuration: ${JSON.stringify(configuration)}\n    Messages: ${JSON.stringify(messages)}\n    \n    Provide detailed feedback with score and recommendations.\n    \n    Respond with JSON: {\n      \"score\": number (0-100),\n      \"strengths\": [\"list of strengths shown\"],\n      \"improvements\": [\"list of areas for improvement\"],\n      \"overallFeedback\": \"comprehensive summary feedback\"\n    }`;\n\n    try {\n      // Check if we have a valid API key first\n      if (!process.env.OPENAI_API_KEY || process.env.OPENAI_API_KEY.includes('*')) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await openai.chat.completions.create({\n        model: \"gpt-4o\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert coach who provides detailed, actionable feedback on professional simulations.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return result as InterviewFeedback;\n    } catch (error) {\n      console.log('Using fallback session feedback due to API error');\n      \n      // Generate fallback feedback based on session data\n      const responseCount = Array.isArray(messages) ? messages.filter(msg => msg.role === 'candidate' || msg.role === 'user').length : 3;\n      const baseScore = Math.min(90, Math.max(65, 65 + (responseCount * 5)));\n      \n      return {\n        score: baseScore,\n        strengths: [\n          \"Completed the full simulation session\",\n          \"Engaged consistently throughout the experience\",\n          \"Demonstrated professional communication\"\n        ],\n        improvements: [\n          \"Consider adding more specific examples in responses\",\n          \"Practice elaborating on reasoning and thought processes\",\n          \"Explore different approaches to challenging scenarios\"\n        ],\n        overallFeedback: `Strong performance in this ${sessionType} simulation. You maintained good engagement and completed ${responseCount} meaningful interactions. Focus on providing more detailed responses and incorporating specific examples to enhance your performance further.`\n      };\n    }\n  }\n}\n\nexport const openaiService = new OpenAIService();\n","path":null,"size_bytes":16212,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1376,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":1901,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { type ClassValue, clsx } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nexport function formatDuration(seconds: number): string {\n  if (seconds < 60) {\n    return `${seconds}s`;\n  } else if (seconds < 3600) {\n    const minutes = Math.floor(seconds / 60);\n    return `${minutes}m`;\n  } else {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    return minutes > 0 ? `${hours}h ${minutes}m` : `${hours}h`;\n  }\n}\n\nexport function formatScore(score: number | null): string {\n  if (score === null) return \"--\";\n  return `${score}/100`;\n}\n\nexport function getScoreColor(score: number | null): string {\n  if (score === null) return \"text-gray-500\";\n  if (score >= 80) return \"text-green-600\";\n  if (score >= 60) return \"text-yellow-600\";\n  return \"text-red-600\";\n}\n\nexport function getInitials(firstName: string, lastName: string): string {\n  return `${firstName.charAt(0)}${lastName.charAt(0)}`.toUpperCase();\n}\n","path":null,"size_bytes":1057,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport JourneyMap from \"@/pages/journey-map\";\nimport InterviewSimulator from \"@/pages/interview-simulator\";\nimport InterviewHistory from \"@/pages/interview-history\";\nimport NegotiationSimulator from \"@/pages/negotiation-simulator\";\nimport WorkspaceJourney from \"@/pages/workspace-journey\";\nimport WorkspacePractice from \"@/pages/workspace-practice\";\nimport DocumentViewer from \"@/pages/document-viewer\";\nimport Progress from \"@/pages/progress\";\nimport JobBoard from \"@/pages/job-board\";\nimport Journey from \"@/pages/journey\";\nimport JourneyDashboard from \"@/pages/journey-dashboard\";\nimport SprintHub from \"@/pages/sprint-hub\";\nimport WorkspaceDashboard from \"@/pages/workspace-dashboard\";\nimport WorkspaceOnboarding from \"@/pages/workspace-onboarding\";\nimport WorkspacePlanning from \"@/pages/workspace-planning\";\nimport WorkspaceExecution from \"@/pages/workspace-execution\";\nimport WorkspaceReview from \"@/pages/workspace-review\";\nimport WorkspaceRetro from \"@/pages/workspace-retro\";\nimport Sidebar from \"@/components/layout/sidebar\";\nimport Header from \"@/components/layout/header\";\nimport NotFound from \"@/pages/not-found\";\n\nfunction AppLayout({ children }: { children: React.ReactNode }) {\n  return (\n    <div className=\"min-h-screen flex bg-gray-50\">\n      <Sidebar />\n      <main className=\"flex-1 ml-64\">\n        <Header />\n        {children}\n      </main>\n    </div>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/\" component={JourneyMap} />\n      <Route path=\"/jobs\" component={JobBoard} />\n      <Route path=\"/journey\" component={Journey} />\n      <Route path=\"/journey/:journeyId\" component={JourneyDashboard} />\n      <Route path=\"/journey/:journeyId/sprint/:sprintId\" component={SprintHub} />\n      <Route path=\"/workspace/:workspaceId\" component={WorkspaceDashboard} />\n      <Route path=\"/workspace/:workspaceId/onboarding\" component={WorkspaceOnboarding} />\n      <Route path=\"/workspace/:workspaceId/planning\" component={WorkspacePlanning} />\n      <Route path=\"/workspace/:workspaceId/execution\" component={WorkspaceExecution} />\n      <Route path=\"/workspace/:workspaceId/review\" component={WorkspaceReview} />\n      <Route path=\"/workspace/:workspaceId/retro\" component={WorkspaceRetro} />\n      <Route path=\"/interview\" component={InterviewSimulator} />\n      <Route path=\"/interview/history\" component={InterviewHistory} />\n      <Route path=\"/negotiation\" component={NegotiationSimulator} />\n      <Route path=\"/workspace/journey\" component={WorkspaceJourney} />\n      <Route path=\"/workspace/practice\" component={WorkspacePractice} />\n      <Route path=\"/progress\" component={Progress} />\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <QueryClientProvider client={queryClient}>\n      <TooltipProvider>\n        <Toaster />\n        <Switch>\n          <Route path=\"/workspace/:sessionId/document/:docType\">\n            <DocumentViewer />\n          </Route>\n          <Route>\n            <AppLayout>\n              <Router />\n            </AppLayout>\n          </Route>\n        </Switch>\n      </TooltipProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":3418,"size_tokens":null},"client/src/components/simulation/negotiation-session.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Send, Bus, User, X, DollarSign, TrendingUp, Handshake } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  role: 'counterpart' | 'user';\n  content: string;\n  timestamp: Date;\n  sentiment?: string;\n  strategy?: string;\n  counterOffer?: any;\n}\n\ninterface NegotiationSessionProps {\n  session: any;\n  onComplete: () => void;\n}\n\nexport default function NegotiationSession({ session, onComplete }: NegotiationSessionProps) {\n  const { toast } = useToast();\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [currentMessage, setCurrentMessage] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n\n  const generateResponseMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/negotiation/respond\", data);\n      return response.json();\n    },\n    onSuccess: (response) => {\n      const newMessage: Message = {\n        id: Date.now().toString(),\n        role: 'counterpart',\n        content: response.response,\n        timestamp: new Date(),\n        sentiment: response.sentiment,\n        strategy: response.strategy,\n        counterOffer: response.counterOffer\n      };\n      setMessages(prev => [...prev, newMessage]);\n    }\n  });\n\n  const generateFeedbackMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/sessions/${session.id}/feedback`);\n      return response.json();\n    },\n    onSuccess: (feedback) => {\n      toast({\n        title: \"Negotiation Complete!\",\n        description: `Success rate: ${feedback.score}%`,\n      });\n      onComplete();\n    }\n  });\n\n  // Initialize with opening message\n  useEffect(() => {\n    if (messages.length === 0) {\n      const openingMessage = getOpeningMessage();\n      setMessages([{\n        id: \"opening\",\n        role: 'counterpart',\n        content: openingMessage,\n        timestamp: new Date()\n      }]);\n    }\n  }, []);\n\n  const getOpeningMessage = () => {\n    const { scenario, targetAmount, companyRange } = session.configuration;\n    \n    switch (scenario) {\n      case 'salary':\n        return `Thank you for your interest in the position. I see you're looking at a salary of $${targetAmount?.toLocaleString()}. Our budget for this role is typically in the ${companyRange} range. Let's discuss what we can work out.`;\n      case 'promotion':\n        return `I appreciate you coming to discuss your career development. I understand you're interested in advancing to the next level. Let's talk about what that might look like and the requirements involved.`;\n      case 'offer':\n        return `Congratulations on receiving our offer! I'm here to discuss the complete package including salary, benefits, and other terms. What aspects would you like to focus on?`;\n      default:\n        return `Let's begin our negotiation discussion. What would you like to address first?`;\n    }\n  };\n\n  const getCounterpartName = () => {\n    const names = {\n      collaborative: \"Jennifer Martinez\",\n      competitive: \"Robert Chen\",\n      analytical: \"Dr. Sarah Kim\",\n      relationship: \"Michael Johnson\"\n    };\n    return names[session.configuration.counterpartStyle as keyof typeof names] || \"Jennifer Martinez\";\n  };\n\n  const getCounterpartRole = () => {\n    const { scenario } = session.configuration;\n    switch (scenario) {\n      case 'salary':\n        return \"HR Manager\";\n      case 'promotion':\n        return \"Department Director\";\n      case 'offer':\n        return \"Hiring Manager\";\n      default:\n        return \"Negotiation Partner\";\n    }\n  };\n\n  const getScenarioIcon = () => {\n    const { scenario } = session.configuration;\n    switch (scenario) {\n      case 'salary':\n        return DollarSign;\n      case 'promotion':\n        return TrendingUp;\n      case 'offer':\n        return Handshake;\n      default:\n        return Handshake;\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!currentMessage.trim() || isLoading) return;\n\n    setIsLoading(true);\n    \n    // Add user message\n    const userMessage: Message = {\n      id: Date.now().toString(),\n      role: 'user',\n      content: currentMessage,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, userMessage]);\n    \n    // Clear input\n    const message = currentMessage;\n    setCurrentMessage(\"\");\n\n    try {\n      // Generate counterpart response\n      await generateResponseMutation.mutateAsync({\n        scenario: session.configuration.scenario,\n        userMessage: message,\n        negotiationHistory: messages,\n        counterpartStyle: session.configuration.counterpartStyle\n      });\n    } catch (error) {\n      toast({\n        title: \"Error\",\n        description: \"Failed to generate response\",\n        variant: \"destructive\",\n      });\n    }\n    \n    setIsLoading(false);\n  };\n\n  const handleEndNegotiation = async () => {\n    // Update session with messages\n    await apiRequest(\"PATCH\", `/api/sessions/${session.id}`, {\n      messages: messages,\n      status: 'completed',\n      completedAt: new Date()\n    });\n\n    // Generate final feedback\n    generateFeedbackMutation.mutate();\n  };\n\n  const Icon = getScenarioIcon();\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <Card>\n          {/* Session Header */}\n          <div className=\"border-b border-gray-200 p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center space-x-4\">\n                <Avatar>\n                  <AvatarFallback className=\"bg-green-600 text-white\">\n                    <Icon className=\"h-5 w-5\" />\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{getCounterpartName()}</h3>\n                  <p className=\"text-sm text-gray-600\">{getCounterpartRole()}</p>\n                </div>\n                <Badge variant=\"outline\" className=\"capitalize\">\n                  {session.configuration.scenario} Negotiation\n                </Badge>\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-600\">Target</p>\n                  <p className=\"font-semibold text-gray-900\">\n                    ${session.configuration.targetAmount?.toLocaleString()}\n                  </p>\n                </div>\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={handleEndNegotiation}\n                  className=\"text-red-600 border-red-200 hover:bg-red-50\"\n                >\n                  <X className=\"h-4 w-4 mr-1\" />\n                  End Negotiation\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Chat Interface */}\n          <CardContent className=\"p-6\">\n            <div className=\"h-96 overflow-y-auto border border-gray-200 rounded-lg p-4 mb-4 bg-gray-50 space-y-4\">\n              {messages.map((message) => (\n                <div key={message.id} className=\"flex items-start space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className={\n                      message.role === 'counterpart' \n                        ? \"bg-green-600 text-white\" \n                        : \"bg-gray-600 text-white\"\n                    }>\n                      {message.role === 'counterpart' ? (\n                        <Icon className=\"h-4 w-4\" />\n                      ) : (\n                        <User className=\"h-4 w-4\" />\n                      )}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center space-x-2\">\n                      <p className=\"text-sm font-medium text-gray-900\">\n                        {message.role === 'counterpart' ? getCounterpartName() : 'You'}\n                      </p>\n                      {message.sentiment && (\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {message.sentiment}\n                        </Badge>\n                      )}\n                    </div>\n                    <p className=\"text-gray-700 mt-1\">{message.content}</p>\n                    {message.strategy && (\n                      <div className=\"mt-2 p-2 bg-green-50 rounded border border-green-200\">\n                        <p className=\"text-sm text-green-800\">\n                          <strong>Strategy:</strong> {message.strategy}\n                        </p>\n                      </div>\n                    )}\n                    {message.counterOffer && (\n                      <div className=\"mt-2 p-2 bg-yellow-50 rounded border border-yellow-200\">\n                        <p className=\"text-sm text-yellow-800\">\n                          <strong>Counter-offer:</strong> {message.counterOffer}\n                        </p>\n                      </div>\n                    )}\n                    <p className=\"text-xs text-gray-500 mt-2\">\n                      {message.timestamp.toLocaleTimeString()}\n                    </p>\n                  </div>\n                </div>\n              ))}\n\n              {isLoading && (\n                <div className=\"flex items-center space-x-3\">\n                  <Avatar className=\"w-8 h-8\">\n                    <AvatarFallback className=\"bg-green-600 text-white\">\n                      <Icon className=\"h-4 w-4\" />\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <p className=\"text-sm font-medium text-gray-900\">{getCounterpartName()}</p>\n                    <div className=\"flex items-center space-x-2 mt-1\">\n                      <div className=\"animate-pulse flex space-x-1\">\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                        <div className=\"rounded-full bg-gray-400 h-2 w-2\"></div>\n                      </div>\n                      <span className=\"text-xs text-gray-500\">Considering your proposal...</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Message Input */}\n            <div className=\"flex space-x-3\">\n              <Textarea\n                className=\"flex-1 resize-none\"\n                rows={3}\n                placeholder=\"Type your negotiation message...\"\n                value={currentMessage}\n                onChange={(e) => setCurrentMessage(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage();\n                  }\n                }}\n                disabled={isLoading}\n              />\n              <Button \n                size=\"lg\"\n                onClick={handleSendMessage}\n                disabled={!currentMessage.trim() || isLoading}\n                className=\"bg-green-600 hover:bg-green-700\"\n              >\n                <Send className=\"h-4 w-4\" />\n              </Button>\n            </div>\n\n            {/* Quick Actions */}\n            <div className=\"flex space-x-2 mt-3\">\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setCurrentMessage(\"I appreciate your offer, but I was hoping we could explore some additional options.\")}\n                className=\"text-sm\"\n              >\n                Request alternatives\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"sm\"\n                onClick={() => setCurrentMessage(\"Could you help me understand the reasoning behind this offer?\")}\n                className=\"text-sm\"\n              >\n                Ask for justification\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":12535,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/interview-simulator.tsx":{"content":"import { useState, useEffect, useRef, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useSearch, useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ModeBanner } from \"@/components/ModeBanner\";\nimport LangchainInterviewSession from \"@/components/simulation/langchain-interview-session\";\nimport { \n  Play, \n  MessageCircle, \n  Brain, \n  Clock,\n  TrendingUp,\n  Briefcase,\n  Code,\n  Lightbulb,\n  Bot,\n  User as UserIcon,\n  Send,\n  Loader2,\n  Target,\n  Database,\n  TestTube,\n  Server\n} from \"lucide-react\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { cn } from \"@/lib/utils\";\nimport { getPersonaStyle } from \"@/lib/persona-styles\";\nimport { InterviewPanelHeader, PersonaRoster } from \"@/components/simulation/team-interview-panel\";\nimport type { User as UserType, InterviewSession } from \"@shared/schema\";\nimport { \n  useAvailableRoles, \n  useAvailableLevels, \n  useInterviewConfig,\n  type Role,\n  type Level,\n  type AvailableRole\n} from \"@/hooks/use-adapters\";\n\nimport interviewConfigData from \"@shared/catalogue/interview/interview-config.json\";\n\nconst iconMap: Record<string, any> = {\n  Code,\n  Briefcase,\n  Lightbulb,\n  Brain,\n  Database,\n  TestTube,\n  Server\n};\n\nconst roleIconMap: Record<string, any> = {\n  developer: Code,\n  pm: Briefcase,\n  qa: TestTube,\n  devops: Server,\n  data_science: Database,\n};\n\nconst legacyTargetRoles = interviewConfigData.content.targetRoles.map(role => ({\n  value: role.value,\n  label: role.label,\n  icon: iconMap[role.icon as keyof typeof iconMap] || Code\n}));\n\nconst interviewTypes = interviewConfigData.content.interviewTypes.map(type => ({\n  value: type.value,\n  label: type.label,\n  description: type.description\n}));\n\nconst difficulties = interviewConfigData.content.difficulties.map(diff => ({\n  value: diff.value,\n  label: diff.label,\n  description: diff.description\n}));\n\nexport default function InterviewSimulator() {\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n  const searchString = useSearch();\n  const [activeSession, setActiveSession] = useState<any>(null);\n  const [activeFirstQuestion, setActiveFirstQuestion] = useState<any>(null);\n  const [activeIntroduction, setActiveIntroduction] = useState<string | undefined>(undefined);\n  const [applicationStageId, setApplicationStageId] = useState<number | null>(null);\n  const [targetRole, setTargetRole] = useState(\"developer\");\n  const [interviewType, setInterviewType] = useState(\"behavioral\");\n  const [difficulty, setDifficulty] = useState(\"medium\");\n  const [totalQuestions, setTotalQuestions] = useState([5]);\n  const [autoStarted, setAutoStarted] = useState(false);\n  \n  // Prelude conversation state\n  const [isPreludeMode, setIsPreludeMode] = useState(false);\n  const [preludeMessages, setPreludeMessages] = useState<Array<{role: 'interviewer' | 'candidate', content: string; personaId?: string}>>([]);\n  const [completedPreludeMessages, setCompletedPreludeMessages] = useState<Array<{role: 'interviewer' | 'candidate', content: string; personaId?: string}>>([]);\n  const [preludeResponse, setPreludeResponse] = useState(\"\");\n  const [isPreludeSubmitting, setIsPreludeSubmitting] = useState(false);\n  \n  // Sequential message reveal state (for team interview greetings)\n  const [visibleMessageCount, setVisibleMessageCount] = useState(0);\n  const [typingPersonaId, setTypingPersonaId] = useState<string | null>(null);\n  const [pendingMessages, setPendingMessages] = useState<Array<{role: 'interviewer' | 'candidate', content: string; personaId?: string}>>([]);\n  \n  // Team interview state\n  const [isTeamInterview, setIsTeamInterview] = useState(false);\n  const [teamPersonas, setTeamPersonas] = useState<Array<{id: string; name: string; role: string; displayRole: string}>>([]);\n  \n  // Pacing state for prelude\n  const [preludeStartTime, setPreludeStartTime] = useState<number | null>(null);\n  const [preludeElapsedMinutes, setPreludeElapsedMinutes] = useState(0);\n\n  // Ref for auto-scroll in prelude\n  const preludeMessagesEndRef = useRef<HTMLDivElement>(null);\n\n  // Auto-scroll to bottom when messages change or submitting\n  useEffect(() => {\n    if (preludeMessagesEndRef.current) {\n      preludeMessagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [preludeMessages, isPreludeSubmitting, typingPersonaId]);\n\n  // Sequential message reveal effect for team interview greetings\n  // This creates a natural \"typing then speaking\" flow for each persona\n  useEffect(() => {\n    if (pendingMessages.length === 0) return;\n    \n    const nextMessage = pendingMessages[0];\n    \n    // Start the reveal process: show typing, wait, then reveal message\n    // Set typing indicator immediately\n    setTypingPersonaId(nextMessage.personaId || null);\n    \n    // After a delay, reveal the message and clear typing\n    const typingDelay = setTimeout(() => {\n      setPreludeMessages(prev => [...prev, nextMessage]);\n      setTypingPersonaId(null);\n      setPendingMessages(prev => prev.slice(1));\n    }, 1500); // 1.5 seconds of \"typing\"\n    \n    return () => clearTimeout(typingDelay);\n  }, [pendingMessages.length]); // Only depend on length to avoid re-running when we modify the array\n\n  // Determine mode based on URL params\n  const isJourneyMode = applicationStageId !== null;\n\n  // Parse URL search params\n  useEffect(() => {\n    const params = new URLSearchParams(searchString);\n    const stageId = params.get('stageId');\n    const type = params.get('type');\n    const role = params.get('role');\n    \n    if (stageId) {\n      setApplicationStageId(parseInt(stageId));\n    }\n    if (type && ['behavioral', 'technical', 'system-design', 'case-study', 'team', 'panel'].includes(type)) {\n      setInterviewType(type);\n    }\n    if (role && ['developer', 'pm', 'designer', 'data-scientist'].includes(role)) {\n      setTargetRole(role);\n    }\n  }, [searchString]);\n\n  const { data: user } = useQuery<UserType>({\n    queryKey: [\"/api/user\"],\n  });\n\n  const { data: interviewHistory = [] } = useQuery<InterviewSession[]>({\n    queryKey: [\"/api/users\", user?.id, \"interviews\"],\n    enabled: !!user?.id,\n  });\n\n  // Phase 2: Fetch available roles from adapters API\n  const { data: availableRoles = [], isLoading: rolesLoading } = useAvailableRoles();\n  \n  // Fetch available levels for selected role\n  const { data: availableLevels = [], isLoading: levelsLoading } = useAvailableLevels(targetRole);\n  \n  // Map difficulty to level for adapter API\n  const difficultyToLevel = useMemo(() => {\n    const map: Record<string, string> = {\n      'easy': 'intern',\n      'medium': 'junior', \n      'hard': 'senior',\n      'junior': 'junior',\n      'mid': 'mid',\n      'senior': 'senior',\n      'intern': 'intern',\n    };\n    return map[difficulty] || 'junior';\n  }, [difficulty]);\n  \n  // Fetch interview configuration for selected role/level\n  const { data: interviewConfig, isLoading: configLoading } = useInterviewConfig(\n    targetRole, \n    difficultyToLevel\n  );\n\n  // Map available roles to display format with icons\n  const targetRoles = useMemo(() => {\n    if (availableRoles.length === 0) {\n      return legacyTargetRoles;\n    }\n    return availableRoles.map((role: AvailableRole) => ({\n      value: role.role,\n      label: role.displayName,\n      description: role.description,\n      icon: roleIconMap[role.role] || Code\n    }));\n  }, [availableRoles]);\n\n  const startInterviewMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/interviews/start\", data);\n      return response.json();\n    },\n    onSuccess: (result) => {\n      setActiveSession(result.session);\n      \n      // Reset prelude state for new session\n      setCompletedPreludeMessages([]);\n      \n      // Handle team interview data\n      if (result.isTeamInterview && result.teamPersonas) {\n        setIsTeamInterview(true);\n        setTeamPersonas(result.teamPersonas);\n      } else {\n        setIsTeamInterview(false);\n        setTeamPersonas([]);\n      }\n      \n      if (result.isPreludeMode && result.greeting) {\n        // Enter conversational prelude mode\n        setIsPreludeMode(true);\n        \n        // Reset sequential reveal state\n        setTypingPersonaId(null);\n        setPendingMessages([]);\n        \n        // Check if greeting is a combined team format (JSON with messages array)\n        try {\n          const parsed = JSON.parse(result.greeting);\n          if (parsed.messages && Array.isArray(parsed.messages)) {\n            // Team interview: multiple persona messages - reveal sequentially\n            const messages = parsed.messages.map((msg: { personaId: string; content: string }) => ({\n              role: 'interviewer' as const,\n              content: msg.content,\n              personaId: msg.personaId\n            }));\n            \n            // Show first message immediately, queue the rest\n            if (messages.length > 0) {\n              setPreludeMessages([messages[0]]);\n              if (messages.length > 1) {\n                setPendingMessages(messages.slice(1));\n              }\n            }\n          } else {\n            // Fallback to single message\n            const greetingMessage = {\n              role: 'interviewer' as const, \n              content: result.greeting,\n              personaId: result.activePersonaId\n            };\n            setPreludeMessages([greetingMessage]);\n          }\n        } catch {\n          // Not JSON, treat as single message (legacy format)\n          const greetingMessage = {\n            role: 'interviewer' as const, \n            content: result.greeting,\n            personaId: result.activePersonaId\n          };\n          setPreludeMessages([greetingMessage]);\n        }\n      } else {\n        // Legacy flow without prelude\n        setIsPreludeMode(false);\n        setPreludeMessages([]);\n        setActiveFirstQuestion(result.firstQuestion);\n        setActiveIntroduction(result.introduction);\n      }\n      \n      if (result.applicationStageId) {\n        setApplicationStageId(result.applicationStageId);\n      }\n      queryClient.invalidateQueries({ queryKey: [\"/api/users\", user?.id, \"interviews\"] });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Failed to Start Interview\",\n        description: error.message || \"Please try again\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Handle prelude responses during conversational intro\n  const preludeMutation = useMutation({\n    mutationFn: async ({ sessionId, response, currentMessages }: { \n      sessionId: number; \n      response: string;\n      currentMessages: Array<{role: 'interviewer' | 'candidate', content: string, personaId?: string}>;\n    }) => {\n      const res = await apiRequest(\"POST\", `/api/interviews/${sessionId}/prelude`, { response });\n      const data = await res.json();\n      // Return both the API result and the current messages for proper state handling\n      return { ...data, messagesAtSubmit: currentMessages };\n    },\n    onSuccess: (result) => {\n      setIsPreludeSubmitting(false);\n      \n      if (result.preludeComplete && result.firstQuestion) {\n        // Prelude is done, transition to real interview\n        // Use the messages from the mutation context (not stale closure)\n        setCompletedPreludeMessages(result.messagesAtSubmit);\n        setIsPreludeMode(false);\n        setActiveFirstQuestion(result.firstQuestion);\n      } else if (result.preludeMessage) {\n        // Add interviewer's response to prelude messages - include persona info for team interviews\n        setPreludeMessages(prev => [...prev, { \n          role: 'interviewer', \n          content: result.preludeMessage,\n          personaId: result.activePersonaId\n        }]);\n      }\n    },\n    onError: (error: any) => {\n      setIsPreludeSubmitting(false);\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to continue conversation\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handlePreludeSubmit = () => {\n    if (!preludeResponse.trim() || isPreludeSubmitting || !activeSession) return;\n    \n    const trimmedResponse = preludeResponse.trim();\n    \n    setIsPreludeSubmitting(true);\n    \n    // Add the candidate's response to messages first\n    const candidateMessage = { role: 'candidate' as const, content: trimmedResponse };\n    const updatedMessages = [...preludeMessages, candidateMessage];\n    setPreludeMessages(updatedMessages);\n    \n    // Clear input immediately so user sees their message was sent\n    setPreludeResponse(\"\");\n    \n    // Pass the updated messages to the mutation to avoid stale closure\n    preludeMutation.mutate({\n      sessionId: activeSession.id,\n      response: trimmedResponse,\n      currentMessages: updatedMessages\n    });\n  };\n\n  // Auto-start interview if coming from Journey page with stageId\n  useEffect(() => {\n    if (user && applicationStageId && !autoStarted && !activeSession) {\n      setAutoStarted(true);\n      // For Journey mode, don't send totalQuestions - let the backend decide\n      // based on interview type (7 for HR/behavioral, 5 for technical)\n      startInterviewMutation.mutate({\n        userId: user.id,\n        interviewType,\n        targetRole,\n        difficulty,\n        applicationStageId,\n      });\n    }\n  }, [user, applicationStageId, autoStarted, activeSession]);\n  \n  // Track elapsed time during prelude\n  useEffect(() => {\n    if (isPreludeMode && activeSession && !preludeStartTime) {\n      setPreludeStartTime(Date.now());\n    }\n    \n    if (!isPreludeMode || !preludeStartTime) return;\n    \n    // Immediate update\n    const elapsed = Math.floor((Date.now() - preludeStartTime) / 60000);\n    setPreludeElapsedMinutes(elapsed);\n    \n    // Update every 10 seconds\n    const timer = setInterval(() => {\n      const elapsedNow = Math.floor((Date.now() - preludeStartTime) / 60000);\n      setPreludeElapsedMinutes(elapsedNow);\n    }, 10000);\n    \n    return () => clearInterval(timer);\n  }, [isPreludeMode, activeSession, preludeStartTime]);\n\n  const handleStartInterview = () => {\n    if (!user) return;\n\n    // For Journey mode, don't send totalQuestions - let the backend decide\n    // For Practice mode, send the user-selected totalQuestions\n    const mutationData: any = {\n      userId: user.id,\n      interviewType,\n      targetRole,\n      difficulty,\n    };\n    \n    if (applicationStageId) {\n      mutationData.applicationStageId = applicationStageId;\n    } else {\n      // Only include totalQuestions for Practice mode\n      mutationData.totalQuestions = totalQuestions[0];\n    }\n\n    startInterviewMutation.mutate(mutationData);\n  };\n\n  // Show loading if in Journey mode and interview is starting\n  if (isJourneyMode && startInterviewMutation.isPending) {\n    return (\n      <div className=\"p-8 flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4\"></div>\n          <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Starting your interview...</h2>\n          <p className=\"text-gray-500 dark:text-gray-400 mt-2\">Preparing your interview session</p>\n        </div>\n      </div>\n    );\n  }\n\n  // Show conversational prelude UI - matches LangchainInterviewSession styling\n  if (activeSession && isPreludeMode) {\n    const interviewTypeLabel = activeSession.interviewType.charAt(0).toUpperCase() + activeSession.interviewType.slice(1);\n    \n    return (\n      <div className=\"h-[calc(100vh-80px)] flex flex-col p-4\">\n        <Card className=\"flex-1 flex flex-col overflow-hidden\">\n          {/* Enhanced Interview Panel Header for team interviews */}\n          {isTeamInterview ? (\n            <InterviewPanelHeader\n              jobTitle={activeSession.targetRole}\n              difficulty={activeSession.difficulty}\n              currentQuestionIndex={0}\n              totalQuestions={activeSession.totalQuestions || 8}\n              elapsedMinutes={preludeElapsedMinutes}\n              isTeamInterview={isTeamInterview}\n              teamPersonas={teamPersonas}\n              activePersonaId={teamPersonas.length > 0 ? teamPersonas[0].id : null}\n            />\n          ) : (\n            <CardHeader className=\"flex-shrink-0 border-b\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-xl\">\n                    {interviewTypeLabel} Interview\n                  </CardTitle>\n                  <p className=\"text-sm text-gray-500 mt-1\">\n                    {activeSession.targetRole}  {activeSession.difficulty} level\n                  </p>\n                </div>\n                <div className=\"flex items-center space-x-4\">\n                  {/* Time-based pacing indicator */}\n                  <div className=\"flex items-center space-x-2\">\n                    <Clock className=\"h-5 w-5 text-gray-400\" />\n                    <span className=\"text-sm text-gray-600\">\n                      {preludeElapsedMinutes} min\n                    </span>\n                  </div>\n                  \n                  {/* Status chip */}\n                  <Badge \n                    variant=\"outline\" \n                    className=\"text-xs px-2 py-0.5 border-blue-200 bg-blue-50 text-blue-700\"\n                    data-testid=\"badge-pacing-status\"\n                  >\n                    Getting started\n                  </Badge>\n                  \n                  {/* Progress ring */}\n                  <div className=\"relative w-8 h-8\">\n                    <svg className=\"w-8 h-8 transform -rotate-90\">\n                      <circle\n                        cx=\"16\"\n                        cy=\"16\"\n                        r=\"12\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"3\"\n                        fill=\"none\"\n                        className=\"text-gray-200\"\n                      />\n                      <circle\n                        cx=\"16\"\n                        cy=\"16\"\n                        r=\"12\"\n                        stroke=\"currentColor\"\n                        strokeWidth=\"3\"\n                        fill=\"none\"\n                        strokeDasharray={`${Math.min(preludeElapsedMinutes * 3, 75)} 100`}\n                        className=\"text-blue-500\"\n                        strokeLinecap=\"round\"\n                      />\n                    </svg>\n                  </div>\n                </div>\n              </div>\n            </CardHeader>\n          )}\n\n          {/* Main content area with optional PersonaRoster sidebar */}\n          <div className=\"flex-1 flex overflow-hidden\">\n            {/* Persona Roster Sidebar - only for team interviews */}\n            {isTeamInterview && teamPersonas.length > 0 && (\n              <PersonaRoster\n                teamPersonas={teamPersonas}\n                activePersonaId={teamPersonas.length > 0 ? teamPersonas[0].id : null}\n                isTyping={isPreludeSubmitting}\n                className=\"hidden md:block\"\n              />\n            )}\n\n            <CardContent className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n            {preludeMessages.map((msg, index) => {\n              const personaStyle = msg.role === 'interviewer' ? getPersonaStyle(msg.personaId, isTeamInterview, teamPersonas) : null;\n              \n              return (\n              <div\n                key={index}\n                className={cn(\n                  \"flex items-start space-x-3\",\n                  msg.role === 'candidate' && \"flex-row-reverse space-x-reverse\"\n                )}\n                data-testid={`prelude-message-${msg.role}-${index}`}\n              >\n                <Avatar className={cn(\n                  \"h-10 w-10 shrink-0\",\n                  msg.role === 'interviewer' \n                    ? (personaStyle?.bgColor || \"bg-blue-100\") \n                    : \"bg-green-100\"\n                )}>\n                  <AvatarFallback className={cn(\n                    \"font-semibold\",\n                    msg.role === 'interviewer' ? personaStyle?.textColor : \"text-green-600\"\n                  )}>\n                    {msg.role === 'interviewer' ? (\n                      isTeamInterview && personaStyle?.initials ? personaStyle.initials : <Bot className={cn(\"h-5 w-5\", personaStyle?.iconColor || \"text-blue-600\")} />\n                    ) : (\n                      <UserIcon className=\"h-5 w-5 text-green-600\" />\n                    )}\n                  </AvatarFallback>\n                </Avatar>\n                <div className={cn(\n                  \"max-w-[70%] rounded-lg p-4\",\n                  msg.role === 'interviewer' \n                    ? cn(\n                        personaStyle?.messageBg || \"bg-blue-50\",\n                        \"text-gray-900\",\n                        isTeamInterview && personaStyle && \"border-l-4\",\n                        isTeamInterview && personaStyle?.borderColor\n                      )\n                    : \"bg-green-50 text-gray-900\"\n                )}>\n                  {/* Show persona name and role for team interviews with enhanced styling */}\n                  {isTeamInterview && msg.role === 'interviewer' && personaStyle && personaStyle.name !== 'Interviewer' && (\n                    <div className=\"mb-2 pb-2 border-b border-gray-200/50 flex items-center gap-2\">\n                      <span className={cn(\"font-semibold text-sm\", personaStyle.textColor)}>\n                        {personaStyle.name}\n                      </span>\n                      {personaStyle.displayRole && (\n                        <span className={cn(\"text-[10px] px-1.5 py-0 border rounded-full\", personaStyle.borderColor)}>\n                          {personaStyle.displayRole}\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  <p className=\"whitespace-pre-wrap\">{msg.content}</p>\n                </div>\n              </div>\n            );\n            })}\n            \n            {/* Typing indicator - shown for sequential reveals OR when waiting for API response */}\n            {(typingPersonaId || isPreludeSubmitting) && (() => {\n              // Use the specific persona for sequential reveals, or first persona for API responses\n              const activeTypingId = typingPersonaId || (teamPersonas.length > 0 ? teamPersonas[0].id : undefined);\n              const typingPersonaStyle = getPersonaStyle(activeTypingId, isTeamInterview, teamPersonas);\n              return (\n              <div className=\"flex items-start space-x-3\">\n                <Avatar className={cn(\"h-10 w-10\", typingPersonaStyle.bgColor)}>\n                  <AvatarFallback className={cn(\"font-semibold\", typingPersonaStyle.textColor)}>\n                    {isTeamInterview && typingPersonaStyle.initials ? typingPersonaStyle.initials : <Bot className={cn(\"h-5 w-5\", typingPersonaStyle.iconColor)} />}\n                  </AvatarFallback>\n                </Avatar>\n                <div className={cn(\n                  typingPersonaStyle.messageBg, \n                  \"rounded-lg p-4\",\n                  isTeamInterview && \"border-l-4\",\n                  isTeamInterview && typingPersonaStyle.borderColor\n                )}>\n                  {isTeamInterview && typingPersonaStyle.name !== 'Interviewer' && (\n                    <div className=\"mb-2 pb-2 border-b border-gray-200/50 flex items-center gap-2\">\n                      <span className={cn(\"font-semibold text-sm\", typingPersonaStyle.textColor)}>\n                        {typingPersonaStyle.name}\n                      </span>\n                      {typingPersonaStyle.displayRole && (\n                        <span className={cn(\"text-[10px] px-1.5 py-0 border rounded-full\", typingPersonaStyle.borderColor)}>\n                          {typingPersonaStyle.displayRole}\n                        </span>\n                      )}\n                    </div>\n                  )}\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"flex space-x-1\">\n                      <div className={cn(\"w-2 h-2 rounded-full animate-bounce\", isTeamInterview ? typingPersonaStyle.accentColor : \"bg-gray-400\")} style={{ animationDelay: '0ms' }} />\n                      <div className={cn(\"w-2 h-2 rounded-full animate-bounce\", isTeamInterview ? typingPersonaStyle.accentColor : \"bg-gray-400\")} style={{ animationDelay: '150ms' }} />\n                      <div className={cn(\"w-2 h-2 rounded-full animate-bounce\", isTeamInterview ? typingPersonaStyle.accentColor : \"bg-gray-400\")} style={{ animationDelay: '300ms' }} />\n                    </div>\n                    <span className=\"text-xs text-gray-500\">typing...</span>\n                  </div>\n                </div>\n              </div>\n            );\n            })()}\n            \n            {/* Scroll anchor */}\n            <div ref={preludeMessagesEndRef} />\n          </CardContent>\n          </div>\n\n          <div className=\"flex-shrink-0 border-t p-4\">\n            <div className=\"flex space-x-3\">\n              <Textarea\n                value={preludeResponse}\n                onChange={(e) => setPreludeResponse(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handlePreludeSubmit();\n                  }\n                }}\n                placeholder={pendingMessages.length > 0 ? \"Please wait for all interviewers to introduce themselves...\" : \"Type your response here... (Press Enter to send, Shift+Enter for new line)\"}\n                className=\"flex-1 min-h-[80px] resize-none\"\n                disabled={isPreludeSubmitting || pendingMessages.length > 0 || typingPersonaId !== null}\n                data-testid=\"input-prelude-response\"\n              />\n              <Button \n                onClick={handlePreludeSubmit}\n                disabled={!preludeResponse.trim() || isPreludeSubmitting || pendingMessages.length > 0 || typingPersonaId !== null}\n                className=\"self-end\"\n                data-testid=\"button-send-prelude\"\n              >\n                {isPreludeSubmitting ? (\n                  <Loader2 className=\"h-5 w-5 animate-spin\" />\n                ) : (\n                  <Send className=\"h-5 w-5\" />\n                )}\n              </Button>\n            </div>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  if (activeSession && activeFirstQuestion) {\n    return (\n      <LangchainInterviewSession\n        session={activeSession}\n        firstQuestion={activeFirstQuestion}\n        introduction={activeIntroduction}\n        preludeMessages={completedPreludeMessages.length > 0 ? completedPreludeMessages : undefined}\n        mode={isJourneyMode ? \"journey\" : \"practice\"}\n        isTeamInterview={isTeamInterview}\n        teamPersonas={teamPersonas}\n        onComplete={() => {\n          setActiveSession(null);\n          setActiveFirstQuestion(null);\n          queryClient.invalidateQueries({ queryKey: [\"/api/users\", user?.id, \"interviews\"] });\n          \n          // If this was part of a job application, redirect to journey page\n          if (applicationStageId && user?.id) {\n            // Invalidate with the exact query key format used in journey.tsx\n            queryClient.invalidateQueries({ queryKey: [`/api/users/${user.id}/applications`] });\n            toast({\n              title: \"Interview Completed!\",\n              description: \"Your application has been updated. Check your journey for next steps.\",\n            });\n            navigate('/journey');\n          } else {\n            // Practice mode: show practice results\n            toast({\n              title: \"Interview Complete!\",\n              description: \"Great job! You can start another practice session anytime.\",\n            });\n            navigate('/interview');\n          }\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto space-y-8\">\n        {/* Mode Banner */}\n        <ModeBanner \n          mode={isJourneyMode ? \"journey\" : \"practice\"} \n          variant=\"banner\"\n        />\n\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-2\">\n            {isJourneyMode ? \"Complete Your Interview\" : \"Interview Simulator\"}\n          </h1>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            {isJourneyMode \n              ? \"This interview is part of your job application  your performance will be evaluated\"\n              : \"Build your interview skills with AI-powered feedback  no real stakes\"}\n          </p>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center\">\n              <Brain className=\"h-5 w-5 mr-2 text-blue-600\" />\n              Configure Your Interview\n            </CardTitle>\n            <CardDescription>\n              {isJourneyMode \n                ? \"Review and confirm your interview settings before starting\"\n                : \"Customize your practice session to match your target role and interview type\"}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-8\">\n            <div>\n              <Label className=\"text-sm font-medium text-gray-700 mb-3 block\">Target Role</Label>\n              {rolesLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <Loader2 className=\"h-6 w-6 animate-spin text-blue-600\" />\n                  <span className=\"ml-2 text-gray-500\">Loading roles...</span>\n                </div>\n              ) : (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3\">\n                  {targetRoles.map((role: any) => {\n                    const Icon = role.icon;\n                    return (\n                      <Button\n                        key={role.value}\n                        variant={targetRole === role.value ? \"default\" : \"outline\"}\n                        className={cn(\n                          \"h-auto py-4 flex flex-col items-center justify-center text-center\",\n                          targetRole === role.value && \"bg-blue-600 hover:bg-blue-700\"\n                        )}\n                        onClick={() => setTargetRole(role.value)}\n                        data-testid={`button-role-${role.value}`}\n                        title={role.description}\n                      >\n                        <Icon className=\"h-6 w-6 mb-2\" />\n                        <span className=\"text-sm font-medium\">{role.label}</span>\n                      </Button>\n                    );\n                  })}\n                </div>\n              )}\n              {interviewConfig && (\n                <div className=\"mt-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                  <div className=\"text-xs text-blue-700 dark:text-blue-300\">\n                    <span className=\"font-medium\">Focus areas:</span>{' '}\n                    {interviewConfig.focusAreas.join(', ')}\n                  </div>\n                </div>\n              )}\n            </div>\n\n            <div>\n              <Label className=\"text-sm font-medium text-gray-700 mb-3 block\">Interview Type</Label>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                {interviewTypes.map((type) => (\n                  <div\n                    key={type.value}\n                    className={cn(\n                      \"border rounded-lg p-4 cursor-pointer transition-all\",\n                      interviewType === type.value \n                        ? \"border-blue-600 bg-blue-50\" \n                        : \"border-gray-200 hover:border-gray-300\"\n                    )}\n                    onClick={() => setInterviewType(type.value)}\n                    data-testid={`card-interview-type-${type.value}`}\n                  >\n                    <div className=\"font-medium text-gray-900\">{type.label}</div>\n                    <div className=\"text-sm text-gray-500\">{type.description}</div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div>\n              <Label className=\"text-sm font-medium text-gray-700 mb-3 block\">Difficulty Level</Label>\n              <div className=\"grid grid-cols-3 gap-3\">\n                {difficulties.map((diff) => (\n                  <Button\n                    key={diff.value}\n                    variant={difficulty === diff.value ? \"default\" : \"outline\"}\n                    className={cn(\n                      \"h-auto py-3 flex flex-col\",\n                      difficulty === diff.value && \"bg-blue-600 hover:bg-blue-700\"\n                    )}\n                    onClick={() => setDifficulty(diff.value)}\n                    data-testid={`button-difficulty-${diff.value}`}\n                  >\n                    <span className=\"font-medium\">{diff.label}</span>\n                    <span className=\"text-xs opacity-80\">{diff.description}</span>\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            <div>\n              <div className=\"flex items-center justify-between mb-3\">\n                <Label className=\"text-sm font-medium text-gray-700\">Number of Questions</Label>\n                <span className=\"text-sm font-semibold text-blue-600\">{totalQuestions[0]} questions</span>\n              </div>\n              <Slider\n                value={totalQuestions}\n                onValueChange={setTotalQuestions}\n                min={3}\n                max={10}\n                step={1}\n                className=\"w-full\"\n                data-testid=\"slider-questions\"\n              />\n              <div className=\"flex justify-between text-xs text-gray-400 mt-1\">\n                <span>Quick (3)</span>\n                <span>Standard (5-7)</span>\n                <span>Thorough (10)</span>\n              </div>\n            </div>\n\n            <div className=\"flex justify-center pt-4\">\n              <Button\n                size=\"lg\"\n                onClick={handleStartInterview}\n                disabled={startInterviewMutation.isPending}\n                className=\"bg-blue-600 hover:bg-blue-700 px-8\"\n                data-testid=\"button-start-interview\"\n              >\n                {startInterviewMutation.isPending ? (\n                  <>\n                    <Clock className=\"mr-2 h-5 w-5 animate-spin\" />\n                    Starting...\n                  </>\n                ) : (\n                  <>\n                    <Play className=\"mr-2 h-5 w-5\" />\n                    Start Interview\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {interviewHistory.length > 0 && (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center\">\n                <TrendingUp className=\"h-5 w-5 mr-2 text-green-600\" />\n                Interview History\n              </CardTitle>\n              <CardDescription>\n                Review your past interview sessions and track your progress\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {interviewHistory.map((session: any) => (\n                  <div \n                    key={session.id} \n                    className=\"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors\"\n                    data-testid={`card-history-${session.id}`}\n                  >\n                    <div className=\"flex items-center space-x-4\">\n                      <div className={cn(\n                        \"w-12 h-12 rounded-lg flex items-center justify-center\",\n                        session.status === 'completed' ? \"bg-green-100\" : \"bg-yellow-100\"\n                      )}>\n                        <MessageCircle className={cn(\n                          \"h-6 w-6\",\n                          session.status === 'completed' ? \"text-green-600\" : \"text-yellow-600\"\n                        )} />\n                      </div>\n                      <div>\n                        <h4 className=\"font-semibold text-gray-900\">\n                          {session.interviewType.charAt(0).toUpperCase() + session.interviewType.slice(1)} Interview\n                        </h4>\n                        <p className=\"text-sm text-gray-500\">\n                          {session.targetRole}  {session.difficulty} level\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-4\">\n                      <Badge variant={session.status === 'completed' ? \"default\" : \"secondary\"}>\n                        {session.status === 'completed' ? 'Completed' : 'In Progress'}\n                      </Badge>\n                      {session.overallScore && (\n                        <div className=\"text-right\">\n                          <div className={cn(\n                            \"text-lg font-bold\",\n                            session.overallScore >= 80 ? \"text-green-600\" :\n                            session.overallScore >= 60 ? \"text-yellow-600\" : \"text-red-600\"\n                          )}>\n                            {session.overallScore}%\n                          </div>\n                          <div className=\"text-xs text-gray-500\">Score</div>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":38251,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"replit.md":{"content":"# edmap: AI-Powered B2B Onboarding Platform\n\n## Overview\nedmap is an AI-powered B2B onboarding platform designed to transition students from \"Intern\" to \"Junior Ready\" through realistic professional simulations. It exposes learners to real-world technical and soft challenges, enabling them to gain practical experience and stand out in the job market. The platform offers two primary user paths: a guided, story-driven \"Journey Path\" and a targeted, drill-focused \"Practice Path.\" Its core value proposition is to provide simulated work experience, demonstrated readiness, and a professional portfolio, addressing the gap between theoretical knowledge and real-world job demands. Future ambitions include multi-role support (Developer, PM, QA, DevOps, Data Science) and language adapters (C/C++, JavaScript, Python).\n\n## User Preferences\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### UI/UX Decisions\nThe platform features a fixed sidebar navigation, responsive header, and distinct interfaces for each simulator. Interactive chat interfaces with message persistence are central. Journey Mode uses a blue accent theme, while Practice Mode uses a teal accent theme. Team interview messages incorporate persona-specific styling with distinct colors and display persona names and roles.\n\n### Technical Implementations\nedmap is built as a monorepo, utilizing a React 18 frontend (TypeScript, Vite, shadcn/ui, Tailwind CSS, TanStack Query, Wouter, React Hook Form with Zod) and a Node.js Express.js backend (TypeScript, Drizzle ORM, PostgreSQL). AI integration is powered by Groq via LangChain.js, and session management uses Express sessions with a PostgreSQL store.\n\n### System Design Choices\nThe system employs a monorepo structure (`client/`, `server/`, `shared/`, `migrations/`). Both simulators consistently use dual-mode architectures (Journey and Practice) for varied learning experiences. AI agent architectures are modular, orchestrated by LangChain for complex interactions and evaluations. A unified adapter and catalogue architecture is implemented to manage various roles, levels, and content. The competency framework tracks progression from Explorer to Contributor to Junior Ready.\n\n### Feature Specifications\n- **Job Journey System**: Manages the job application lifecycle, including a searchable Job Board, AI-feedback-enabled Application Flow, and a Journey Timeline, integrating with the Interview Simulator.\n- **Interview Simulator**: An AI-powered tool offering dual-mode interview experiences with multi-persona AI teams, level calibration, and a two-phase AI agent architecture (Preparation and Conversation). It includes a question backlog, real-time evaluation, smart follow-ups, and comprehensive final reports.\n- **Workspace Simulator**: Creates a virtual tech team environment for collaborative project work in dual-mode. It features multi-character AI teams, role-based practice, various project scenarios, persistent progress saving, dynamic collaboration via multi-channel communication, interactive project artifacts, and specialized session components (e.g., `InternOnboardingSession`).\n- **Workspace Phase System (Phase 5)**: A complete Scrum sprint cycle simulation integrated with the Job Journey system. Features include:\n  - Five distinct phases: Onboarding  Planning  Execution  Review  Retro\n  - Phase-specific modules with multi-step workflows:\n    - **OnboardingModule**: Team introductions, documentation review, comprehension check with Sarah\n    - **PlanningModule**: Collaborative sprint planning with role-aware adapter system (see Phase 6 below)\n    - **ExecutionModule**: Kanban board with drag-and-drop, git workflow simulation, team chat\n    - **ReviewModule**: Demo presenter, stakeholder feedback collection, summary\n    - **RetroModule**: Reflection cards (went well/to improve), voting, action items with owners\n  - PhaseGuard component for enforcing linear phase progression\n  - Phase-specific color themes: onboarding (teal), planning (indigo), execution (blue), review (amber), retro (violet)\n  - Automatic workspace creation on job offer acceptance\n  - Routes: `/workspace/:id`, `/workspace/:id/onboarding`, `/workspace/:id/planning`, `/workspace/:id/execution`, `/workspace/:id/review`, `/workspace/:id/retro`\n  - WorkspaceDashboard with PhaseStepper visualization, phase checklist, and CTA buttons\n- **Collaborative Sprint Planning (Phase 6)**: A role-aware, adapter-driven sprint planning experience that simulates real Scrum planning meetings. Features include:\n  - **Single Meeting Flow**: Planning presented as one continuous session with three sections:\n    - Context (5 min): Facilitator presents priorities and business context\n    - Discussion (15 min): Team discusses items, estimates, and concerns\n    - Commitment (10 min): Team agrees on scope and sprint goal\n  - **Role-Aware Adapters**: Experience adapts based on workspace.role:\n    - Developer/QA/DevOps/Data Science: Participates in planning led by AI PM (Priya)\n    - PM: Leads/facilitates planning, AI dev team responds with concerns\n  - **Level Overlays**: Difficulty and scaffolding adjust based on level:\n    - Intern: Heavy guidance, knowledge checks, AI nudges, no skipping\n    - Junior: Moderate guidance, some autonomy, optional checks\n    - Senior: Minimal guidance, complex scenarios, AI pushback\n  - **Level-Based Engagement System**: Differentiated interaction patterns per level:\n    - Engagement modes: `shadow` (observe), `guided` (prompted), `active` (contribute), `facilitator` (lead)\n    - Phase engagement: `observe`, `respond`, or `lead` per phase\n    - Auto-start conversation: PM (Priya) automatically kicks off planning with level-appropriate welcome\n    - Team talk ratio: Controls AI vs user speaking balance (85% AI for intern, 30% for senior)\n    - Prompt suggestions: Optional scaffolding chips for interns/juniors\n    - UI badges show current engagement mode (Observing, Guided, Active, Facilitating)\n  - **AutoStartSequence System**: Multi-message conversation kickoffs that simulate realistic team discussions:\n    - `AutoStartStep` interface with `personaId`, `personaName`, `personaRole`, `message`, `phase`, `requiresUserResponse`\n    - Intern (shadow mode): 6-message sequence - team discusses priorities before asking intern for questions\n    - Junior (guided mode): 3-message sequence - asks for input sooner with less team discussion\n    - Mid/Senior: Single welcome message or no auto-start (user drives discussion)\n    - Idempotency protection via `autoStartInitialized` flag prevents duplicate messages on page refresh\n    - Sequence stops at first message with `requiresUserResponse: true`\n  - **Composable Adapter Architecture**:\n    - Role adapters in `shared/adapters/planning/roles/` (base behavior per role)\n    - Level overlays in `shared/adapters/planning/levels/` (difficulty modifiers + engagement)\n    - Factory merges role + level: `getSprintPlanningAdapter(role, level)`\n  - **SprintPlanningAdapter Interface**:\n    - `prompts`: Role-specific system prompts and AI persona configuration\n    - `uiControls`: Panel visibility, skip permissions, learning objectives\n    - `difficulty`: Ticket complexity, ambiguity, conflict scenarios\n    - `evaluation`: Rubric weights and passing thresholds\n    - `engagement`: Level-based interaction patterns and auto-start settings\n  - **Hybrid UI**: Chat-based team discussion with phase progress indicator\n  - **Data Model**: `planningSessions` table tracking phase progress, selected items, goal, commitment; `planningMessages` for conversation history\n- **Narrative Progression System (Phase 3)**: A dynamic journey system with configurable progression paths (InternJunior, JuniorMid, MidSenior), story arcs (Onboarding, Sprints, Graduation), and competency tracking. Features include:\n  - Level-agnostic sprint generation engine (same code, different content packs per level)\n  - Delta calculator for competency changes with mastery bands (Explorer  Contributor  Junior Ready)\n  - Readiness scoring with exit triggers (min sprints + user choice OR 85% readiness OR max sprints)\n  - Progress dashboard UI showing readiness, sprint progress, and graduation eligibility\n  - React Query hooks for all progression data (use-progression.ts)\n- **Template-Driven Sprint Generation (Phase 4)**: A catalogue-based system for generating varied sprint content. Features include:\n  - Template schema for bugs, features, and soft skills with context variables\n  - 15 initial templates (7 bug, 4 feature, 4 soft skill) organized in shared/catalogue/templates/\n  - SprintGeneratorService with competency-aware selection and theme rotation\n  - Context substitution engine for filling template variables based on company/industry\n  - Integration with progression engine via startNewSprint method\n  - Quality guardrails: validateAndRepairBacklog for crash-proof template handling\n  - Fallback mechanisms for exhausted templates and missing content\n\n## External Dependencies\n\n### AI Services\n- **Groq API**: Powers AI features using `llama-3.3-70b-versatile` for the Interview Simulator, Workspace Simulator AI team responses, and Whisper AI for voice transcription.\n\n### Database\n- **Neon Database**: Serverless PostgreSQL database used for production environments.\n- **@neondatabase/serverless**: Library for optimized database connections.\n\n### Authentication\n- Session-based authentication is implemented.","path":null,"size_bytes":9479,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/pages/progress.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress as ProgressBar } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { formatDuration, formatScore, getScoreColor } from \"@/lib/utils\";\nimport type { UserProgress, SimulationSession } from \"@shared/schema\";\nimport { \n  Play, \n  TrendingUp, \n  Clock, \n  CheckCircle, \n  MessageCircle, \n  Handshake, \n  Users,\n  Award,\n  Target,\n  Calendar\n} from \"lucide-react\";\n\ninterface SkillData {\n  name: string;\n  score: number;\n  improvement: number;\n}\n\ninterface ActivityItem {\n  id: string;\n  type: 'interview' | 'negotiation' | 'workspace';\n  title: string;\n  score: number | null;\n  timestamp: Date;\n}\n\nexport default function Progress() {\n  const { data: user } = useQuery({\n    queryKey: [\"/api/user\"],\n  });\n\n  const { data: progress = [] } = useQuery<UserProgress[]>({\n    queryKey: [`/api/user/${user?.id}/progress`],\n    enabled: !!user?.id,\n  });\n\n  const { data: recentSessions = [] } = useQuery<SimulationSession[]>({\n    queryKey: [`/api/user/${user?.id}/sessions`],\n    enabled: !!user?.id,\n  });\n\n  // Calculate overview statistics\n  const totalSessions = progress.reduce((sum: number, p: UserProgress) => sum + p.totalSessions, 0);\n  const completedSessions = progress.reduce((sum: number, p: UserProgress) => sum + p.completedSessions, 0);\n  const totalTime = progress.reduce((sum: number, p: UserProgress) => sum + p.totalTime, 0);\n  const completionRate = totalSessions > 0 ? Math.round((completedSessions / totalSessions) * 100) : 0;\n  \n  // Calculate average score across all simulation types\n  const averageScore = progress.length > 0 \n    ? Math.round(progress.reduce((sum: number, p: UserProgress) => sum + (p.averageScore || 0), 0) / progress.filter((p: UserProgress) => p.averageScore).length)\n    : null;\n\n  // Calculate growth from previous period (mock calculation for demo)\n  const sessionGrowth = Math.max(0, completedSessions - Math.floor(completedSessions * 0.8));\n  const scoreGrowth = averageScore ? Math.max(0, averageScore - Math.floor(averageScore * 0.94)) : 0;\n\n  // Generate skills data based on progress\n  const skillsData: SkillData[] = [\n    {\n      name: \"Technical Communication\",\n      score: progress.find((p: UserProgress) => p.simulationType === 'interview')?.averageScore || 0,\n      improvement: 5\n    },\n    {\n      name: \"Negotiation Strategy\", \n      score: progress.find((p: UserProgress) => p.simulationType === 'negotiation')?.averageScore || 0,\n      improvement: 8\n    },\n    {\n      name: \"Team Collaboration\",\n      score: progress.find((p: UserProgress) => p.simulationType === 'workspace')?.averageScore || 0,\n      improvement: 3\n    },\n    {\n      name: \"Problem Solving\",\n      score: averageScore ? Math.min(100, averageScore + 5) : 0,\n      improvement: 7\n    },\n    {\n      name: \"Professional Presentation\",\n      score: averageScore ? Math.min(100, averageScore - 3) : 0,\n      improvement: 4\n    }\n  ].filter(skill => skill.score > 0);\n\n  // Generate recent activity from sessions\n  const recentActivity: ActivityItem[] = recentSessions\n    .slice(0, 10)\n    .map((session: SimulationSession) => ({\n      id: session.id.toString(),\n      type: session.type as 'interview' | 'negotiation' | 'workspace',\n      title: getActivityTitle(session.type, session.configuration),\n      score: session.score,\n      timestamp: new Date(session.completedAt || session.startedAt)\n    }))\n    .sort((a: ActivityItem, b: ActivityItem) => b.timestamp.getTime() - a.timestamp.getTime());\n\n  function getActivityTitle(type: string, config: any): string {\n    switch (type) {\n      case 'interview':\n        return `${config?.interviewType || 'Interview'} Practice`;\n      case 'negotiation':\n        return `${config?.scenario || 'Negotiation'} Session`;\n      case 'workspace':\n        return `Workspace at ${config?.companyType || 'Company'}`;\n      default:\n        return 'Simulation Session';\n    }\n  }\n\n  function getActivityIcon(type: string) {\n    switch (type) {\n      case 'interview':\n        return MessageCircle;\n      case 'negotiation':\n        return Handshake;\n      case 'workspace':\n        return Users;\n      default:\n        return Play;\n    }\n  }\n\n  function getRelativeTime(date: Date): string {\n    const now = new Date();\n    const diffInHours = Math.floor((now.getTime() - date.getTime()) / (1000 * 60 * 60));\n    \n    if (diffInHours < 1) return \"Just now\";\n    if (diffInHours < 24) return `${diffInHours} hours ago`;\n    \n    const diffInDays = Math.floor(diffInHours / 24);\n    if (diffInDays < 7) return `${diffInDays} days ago`;\n    \n    const diffInWeeks = Math.floor(diffInDays / 7);\n    return `${diffInWeeks} weeks ago`;\n  }\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Overview Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Total Sessions</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">{completedSessions}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                  <Play className=\"h-6 w-6 text-blue-600\" />\n                </div>\n              </div>\n              {sessionGrowth > 0 && (\n                <p className=\"text-sm text-green-600 mt-2\">+{sessionGrowth} this week</p>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Average Score</p>\n                  <p className={`text-3xl font-bold ${getScoreColor(averageScore)}`}>\n                    {averageScore || \"--\"}\n                  </p>\n                </div>\n                <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n                  <TrendingUp className=\"h-6 w-6 text-green-600\" />\n                </div>\n              </div>\n              {scoreGrowth > 0 && (\n                <p className=\"text-sm text-green-600 mt-2\">+{scoreGrowth} from last month</p>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Time Practiced</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">\n                    {formatDuration(totalTime)}\n                  </p>\n                </div>\n                <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\n                  <Clock className=\"h-6 w-6 text-purple-600\" />\n                </div>\n              </div>\n              <p className=\"text-sm text-gray-600 mt-2\">This month</p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Completion Rate</p>\n                  <p className=\"text-3xl font-bold text-gray-900\">{completionRate}%</p>\n                </div>\n                <div className=\"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center\">\n                  <CheckCircle className=\"h-6 w-6 text-yellow-600\" />\n                </div>\n              </div>\n              <p className={`text-sm mt-2 ${\n                completionRate >= 80 ? 'text-green-600' : \n                completionRate >= 60 ? 'text-yellow-600' : 'text-red-600'\n              }`}>\n                {completionRate >= 80 ? 'Excellent' : \n                 completionRate >= 60 ? 'Good' : 'Needs Improvement'}\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Performance Chart Placeholder */}\n        <Card className=\"mb-8\">\n          <CardHeader>\n            <CardTitle className=\"text-lg font-semibold text-gray-900\">Performance Over Time</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"h-64 bg-gray-50 rounded-lg flex items-center justify-center\">\n              <div className=\"text-center\">\n                <TrendingUp className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                <p className=\"text-gray-500\">Performance chart visualization</p>\n                <p className=\"text-sm text-gray-400 mt-2\">\n                  Track your progress across all simulation types\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n          {/* Skills Assessment */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">Skills Assessment</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {skillsData.length > 0 ? (\n                <div className=\"space-y-6\">\n                  {skillsData.map((skill) => (\n                    <div key={skill.name}>\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <span className=\"text-sm font-medium text-gray-700\">{skill.name}</span>\n                        <div className=\"flex items-center space-x-2\">\n                          <span className=\"text-sm text-gray-600\">{skill.score}%</span>\n                          {skill.improvement > 0 && (\n                            <Badge variant=\"outline\" className=\"text-xs text-green-600\">\n                              +{skill.improvement}%\n                            </Badge>\n                          )}\n                        </div>\n                      </div>\n                      <ProgressBar value={skill.score} className=\"h-2\" />\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Target className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">Complete simulations to see your skills assessment</p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {/* Recent Activity */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">Recent Activity</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {recentActivity.length > 0 ? (\n                <div className=\"space-y-4\">\n                  {recentActivity.map((activity) => {\n                    const Icon = getActivityIcon(activity.type);\n                    return (\n                      <div key={activity.id} className=\"flex items-center space-x-3\">\n                        <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                          activity.type === 'interview' ? 'bg-blue-100' :\n                          activity.type === 'negotiation' ? 'bg-green-100' : 'bg-purple-100'\n                        }`}>\n                          <Icon className={`h-4 w-4 ${\n                            activity.type === 'interview' ? 'text-blue-600' :\n                            activity.type === 'negotiation' ? 'text-green-600' : 'text-purple-600'\n                          }`} />\n                        </div>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm font-medium text-gray-900\">{activity.title}</p>\n                          <p className=\"text-xs text-gray-500\">{getRelativeTime(activity.timestamp)}</p>\n                        </div>\n                        {activity.score && (\n                          <span className={`text-sm font-medium ${getScoreColor(activity.score)}`}>\n                            {activity.score}\n                          </span>\n                        )}\n                      </div>\n                    );\n                  })}\n                </div>\n              ) : (\n                <div className=\"text-center py-8\">\n                  <Calendar className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n                  <p className=\"text-gray-500\">No recent activity</p>\n                  <p className=\"text-sm text-gray-400 mt-2\">\n                    Start a simulation to see your activity here\n                  </p>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Simulation Type Breakdown */}\n        {progress.length > 0 && (\n          <Card className=\"mt-8\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold text-gray-900\">Simulation Breakdown</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n                {progress.map((prog) => {\n                  const Icon = prog.simulationType === 'interview' ? MessageCircle :\n                              prog.simulationType === 'negotiation' ? Handshake : Users;\n                  const iconColor = prog.simulationType === 'interview' ? 'text-blue-600' :\n                                   prog.simulationType === 'negotiation' ? 'text-green-600' : 'text-purple-600';\n                  const bgColor = prog.simulationType === 'interview' ? 'bg-blue-100' :\n                                 prog.simulationType === 'negotiation' ? 'bg-green-100' : 'bg-purple-100';\n                  \n                  return (\n                    <div key={prog.simulationType} className=\"border border-gray-200 rounded-lg p-6\">\n                      <div className=\"flex items-center space-x-3 mb-4\">\n                        <div className={`w-10 h-10 ${bgColor} rounded-lg flex items-center justify-center`}>\n                          <Icon className={`h-5 w-5 ${iconColor}`} />\n                        </div>\n                        <h4 className=\"font-semibold text-gray-900 capitalize\">\n                          {prog.simulationType} Sessions\n                        </h4>\n                      </div>\n                      \n                      <div className=\"space-y-3\">\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-sm text-gray-600\">Completed</span>\n                          <span className=\"font-medium\">{prog.completedSessions}</span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-sm text-gray-600\">Average Score</span>\n                          <span className={`font-medium ${getScoreColor(prog.averageScore)}`}>\n                            {formatScore(prog.averageScore)}\n                          </span>\n                        </div>\n                        <div className=\"flex justify-between\">\n                          <span className=\"text-sm text-gray-600\">Time Spent</span>\n                          <span className=\"font-medium\">{formatDuration(prog.totalTime)}</span>\n                        </div>\n                        {prog.lastSessionAt && (\n                          <div className=\"flex justify-between\">\n                            <span className=\"text-sm text-gray-600\">Last Session</span>\n                            <span className=\"text-sm text-gray-900\">\n                              {getRelativeTime(new Date(prog.lastSessionAt))}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16028,"size_tokens":null},"client/src/pages/dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { getInitials, formatDuration, formatScore, getScoreColor } from \"@/lib/utils\";\nimport { Link } from \"wouter\";\nimport { \n  MessageCircle, \n  Users, \n  Handshake, \n  ExternalLink, \n  CheckCircle, \n  TrendingUp, \n  Clock,\n  Play\n} from \"lucide-react\";\nimport type { User, UserProgress, SimulationSession } from \"@shared/schema\";\n\nexport default function Dashboard() {\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/user\"],\n  });\n\n  const { data: progress = [] } = useQuery<UserProgress[]>({\n    queryKey: [`/api/user/${user?.id}/progress`],\n    enabled: !!user?.id,\n  });\n\n  const { data: recentSessions = [] } = useQuery<SimulationSession[]>({\n    queryKey: [`/api/user/${user?.id}/sessions`],\n    enabled: !!user?.id,\n  });\n\n  const totalSessions = progress.reduce((sum, p) => sum + p.totalSessions, 0);\n  const completedSessions = progress.reduce((sum, p) => sum + p.completedSessions, 0);\n  const totalTime = progress.reduce((sum, p) => sum + p.totalTime, 0);\n  const averageScore = progress.length > 0 \n    ? Math.round(progress.reduce((sum, p) => sum + (p.averageScore || 0), 0) / progress.filter(p => p.averageScore).length)\n    : null;\n\n  const simulationCards = [\n    {\n      title: \"Interview Practice\",\n      description: \"Learn to analyze company and job info before the interview\",\n      icon: MessageCircle,\n      href: \"/interview\",\n      number: 1,\n      bgColor: \"bg-blue-100\",\n      iconColor: \"text-blue-600\",\n      buttonEnabled: true\n    },\n    {\n      title: \"Workplace Simulation\", \n      description: \"Learn to analyze company and job info before the interview\",\n      icon: Users,\n      href: \"/workspace\",\n      number: 3,\n      bgColor: \"bg-purple-100\",\n      iconColor: \"text-purple-600\",\n      buttonEnabled: false\n    },\n    {\n      title: \"Offer Negotiation\",\n      description: \"Learn to analyze company and job info before the interview\", \n      icon: Handshake,\n      href: \"/negotiation\",\n      number: 2,\n      bgColor: \"bg-green-100\",\n      iconColor: \"text-green-600\",\n      buttonEnabled: false\n    }\n  ];\n\n  return (\n    <div>\n      {/* Welcome Banner */}\n      <div className=\"brand-gradient text-white p-8 m-8 rounded-xl\">\n        <div className=\"flex items-center space-x-4\">\n          <Avatar className=\"w-16 h-16 bg-white bg-opacity-20\">\n            <AvatarFallback className=\"text-2xl font-bold text-white bg-transparent\">\n              {user ? getInitials(user.firstName, user.lastName) : \"AA\"}\n            </AvatarFallback>\n          </Avatar>\n          <div>\n            <h2 className=\"text-2xl font-bold mb-2\">\n              Welcome, {user ? user.firstName : \"Arsen\"}\n            </h2>\n            <p className=\"text-blue-100\">\n              Start your journey by going through the whole process from prepping for the interview to negotiating your offer.\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"p-8\">\n        {/* Simulation Cards */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8 mb-12\">\n          {simulationCards.map((card) => {\n            const Icon = card.icon;\n            return (\n              <Card key={card.title} className=\"hover:shadow-md transition-shadow\">\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-4\">\n                    <div className={`w-12 h-12 ${card.bgColor} rounded-lg flex items-center justify-center`}>\n                      <Icon className={`${card.iconColor} text-xl h-6 w-6`} />\n                    </div>\n                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                      card.buttonEnabled ? 'bg-blue-600' : 'bg-gray-300'\n                    }`}>\n                      <span className={`text-sm font-bold ${\n                        card.buttonEnabled ? 'text-white' : 'text-gray-600'\n                      }`}>\n                        {card.number}\n                      </span>\n                    </div>\n                  </div>\n                  <h3 className=\"text-lg font-semibold text-gray-900 mb-2\">{card.title}</h3>\n                  <p className=\"text-gray-600 text-sm mb-4\">{card.description}</p>\n                  \n                  {card.buttonEnabled ? (\n                    <Link href={card.href}>\n                      <Button className=\"w-full bg-blue-600 hover:bg-blue-700\">\n                        <span>Start simulation</span>\n                        <ExternalLink className=\"ml-2 h-4 w-4\" />\n                      </Button>\n                    </Link>\n                  ) : (\n                    <Button disabled className=\"w-full bg-gray-100 text-gray-500 cursor-not-allowed\">\n                      <span>Start simulation</span>\n                      <ExternalLink className=\"ml-2 h-4 w-4\" />\n                    </Button>\n                  )}\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n\n        {/* Progress Overview */}\n        <div>\n          <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">Your Progress</h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Completed Sessions</p>\n                    <p className=\"text-2xl font-bold text-gray-900\">{completedSessions}</p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center\">\n                    <CheckCircle className=\"h-6 w-6 text-blue-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Average Score</p>\n                    <p className={`text-2xl font-bold ${getScoreColor(averageScore)}`}>\n                      {formatScore(averageScore)}\n                    </p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center\">\n                    <TrendingUp className=\"h-6 w-6 text-green-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n            \n            <Card>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-600\">Time Practiced</p>\n                    <p className=\"text-2xl font-bold text-gray-900\">\n                      {formatDuration(totalTime)}\n                    </p>\n                  </div>\n                  <div className=\"w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center\">\n                    <Clock className=\"h-6 w-6 text-purple-600\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {/* Recent Sessions */}\n        {recentSessions.length > 0 && (\n          <div className=\"mt-12\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-6\">Recent Sessions</h3>\n            <div className=\"space-y-4\">\n              {recentSessions.slice(0, 5).map((session: any) => (\n                <Card key={session.id}>\n                  <CardContent className=\"p-6\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-4\">\n                        <div className=\"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center\">\n                          {session.type === 'interview' && <MessageCircle className=\"h-5 w-5 text-blue-600\" />}\n                          {session.type === 'negotiation' && <Handshake className=\"h-5 w-5 text-green-600\" />}\n                          {session.type === 'workspace' && <Users className=\"h-5 w-5 text-purple-600\" />}\n                        </div>\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900 capitalize\">\n                            {session.type} Session\n                          </h4>\n                          <p className=\"text-sm text-gray-600\">\n                            {session.status === 'completed' ? 'Completed' : 'In Progress'}  {formatDuration(session.duration || 0)}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-center space-x-4\">\n                        {session.score && (\n                          <div className=\"text-right\">\n                            <p className={`text-sm font-medium ${getScoreColor(session.score)}`}>\n                              Score: {formatScore(session.score)}\n                            </p>\n                          </div>\n                        )}\n                        <Button variant=\"ghost\" size=\"sm\">\n                          View Details\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9669,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/layout/header.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Bell, ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { getInitials } from \"@/lib/utils\";\nimport { useLocation } from \"wouter\";\n\nconst pageTitles: Record<string, string> = {\n  \"/\": \"Dashboard\",\n  \"/interview\": \"Interview Simulator\",\n  \"/negotiation\": \"Negotiation Simulator\", \n  \"/workspace\": \"Workspace Simulator\",\n  \"/progress\": \"Progress & Analytics\"\n};\n\nexport default function Header() {\n  const [location] = useLocation();\n  const pageTitle = pageTitles[location] || \"Dashboard\";\n\n  const { data: user } = useQuery({\n    queryKey: [\"/api/user\"],\n  });\n\n  return (\n    <header className=\"bg-white border-b border-gray-200 px-8 py-4\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center space-x-4\">\n          <h1 className=\"text-2xl font-bold text-gray-900\">{pageTitle}</h1>\n        </div>\n        \n        <div className=\"flex items-center space-x-4\">\n          <Button variant=\"ghost\" size=\"sm\" className=\"p-2\">\n            <Bell className=\"h-4 w-4 text-gray-500\" />\n          </Button>\n          \n          <div className=\"flex items-center space-x-3\">\n            <Avatar className=\"h-8 w-8\">\n              <AvatarFallback className=\"bg-gray-300 text-gray-700 text-sm font-medium\">\n                {user ? getInitials(user.firstName, user.lastName) : \"AA\"}\n              </AvatarFallback>\n            </Avatar>\n            <span className=\"text-sm font-medium text-gray-700\">\n              {user ? user.firstName : \"Arsen\"}\n            </span>\n            <ChevronDown className=\"h-4 w-4 text-gray-400\" />\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","path":null,"size_bytes":1795,"size_tokens":null},"client/src/components/simulation/customer-support-session.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { formatDuration } from \"@/lib/utils\";\nimport { Send, Mic, Phone, MessageCircle, Clock, User, X, Check } from \"lucide-react\";\n\ninterface Message {\n  id: string;\n  role: 'customer' | 'agent';\n  content: string;\n  timestamp: Date;\n  sentiment?: string;\n  empathyScore?: number;\n  clarityScore?: number;\n  feedback?: string;\n  suggestedResponse?: string;\n}\n\ninterface CustomerSupportSessionProps {\n  session: any;\n  onComplete: () => void;\n}\n\nconst supportStages = [\n  \"Greeting\",\n  \"Problem Diagnosis\", \n  \"Resolution\",\n  \"Escalation\",\n  \"Closing\"\n];\n\nconst customerPersonas = [\n  { id: \"angry\", name: \"Angry Customer\", description: \"Frustrated and impatient, wants immediate resolution\" },\n  { id: \"polite\", name: \"Polite Customer\", description: \"Courteous and understanding, follows instructions well\" },\n  { id: \"confused\", name: \"Confused Customer\", description: \"Unclear about their problem, needs guidance\" },\n  { id: \"elderly\", name: \"Elderly Customer\", description: \"Not tech-savvy, needs patient explanation\" },\n  { id: \"urgent\", name: \"Urgent Customer\", description: \"Has a time-sensitive issue, stressed about deadline\" },\n  { id: \"skeptical\", name: \"Skeptical Customer\", description: \"Doubtful about solutions, needs convincing\" }\n];\n\nexport default function CustomerSupportSession({ session, onComplete }: CustomerSupportSessionProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [currentResponse, setCurrentResponse] = useState(\"\");\n  const [timeRemaining, setTimeRemaining] = useState(session.configuration.duration * 60);\n  const [isLoading, setIsLoading] = useState(false);\n  const [currentStage, setCurrentStage] = useState(session.configuration.stage || \"Greeting\");\n  const [sessionActive, setSessionActive] = useState(true);\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioSupported, setAudioSupported] = useState(false);\n  const [audioChunks, setAudioChunks] = useState<Blob[]>([]);\n  const [audioLevel, setAudioLevel] = useState(0);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const streamRef = useRef<MediaStream | null>(null);\n  const animationFrameRef = useRef<number>();\n\n  // Initialize customer conversation\n  const generateCustomerMessageMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/customer-support/message\", data);\n      return response.json();\n    },\n    onSuccess: (result) => {\n      const newMessage: Message = {\n        id: Date.now().toString(),\n        role: 'customer',\n        content: result.message,\n        timestamp: new Date(),\n        sentiment: result.sentiment\n      };\n      setMessages(prev => [...prev, newMessage]);\n    }\n  });\n\n  // Evaluate agent response\n  const evaluateResponseMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const response = await apiRequest(\"POST\", \"/api/customer-support/evaluate\", data);\n      return response.json();\n    },\n    onSuccess: (evaluation) => {\n      setMessages(prev => {\n        const updated = [...prev];\n        const lastAgentMessageIndex = updated.map(m => m.role).lastIndexOf('agent');\n        if (lastAgentMessageIndex !== -1) {\n          updated[lastAgentMessageIndex] = {\n            ...updated[lastAgentMessageIndex],\n            empathyScore: evaluation.empathyScore,\n            clarityScore: evaluation.clarityScore,\n            feedback: evaluation.feedback,\n            suggestedResponse: evaluation.suggestedResponse\n          };\n        }\n        return updated;\n      });\n\n      // Generate customer response based on agent's message\n      setTimeout(() => {\n        generateCustomerMessageMutation.mutate({\n          stage: currentStage,\n          persona: session.configuration.persona,\n          problem: session.configuration.problem,\n          agentMessage: currentResponse,\n          conversationHistory: messages.slice(-4).map(m => ({\n            role: m.role,\n            content: m.content\n          }))\n        });\n      }, 1500);\n    }\n  });\n\n  // Audio transcription\n  const transcribeAudioMutation = useMutation({\n    mutationFn: async (audioBlob: Blob) => {\n      const formData = new FormData();\n      formData.append('audio', audioBlob, 'audio.webm');\n      \n      const response = await fetch('/api/transcribe', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        throw new Error(`Transcription failed: ${response.statusText}`);\n      }\n      \n      return response.json();\n    },\n    onSuccess: (result) => {\n      if (result.text && result.text.trim()) {\n        setCurrentResponse(prev => {\n          const newText = prev ? prev + ' ' + result.text.trim() : result.text.trim();\n          return newText;\n        });\n      }\n    },\n    onError: (error) => {\n      console.error('Transcription error:', error);\n    }\n  });\n\n  // Timer countdown\n  useEffect(() => {\n    if (timeRemaining <= 0) {\n      handleEndSession();\n      return;\n    }\n\n    const timer = setInterval(() => {\n      setTimeRemaining(prev => prev - 1);\n    }, 1000);\n\n    return () => clearInterval(timer);\n  }, [timeRemaining]);\n\n  // Initialize audio support\n  useEffect(() => {\n    const checkAudioSupport = async () => {\n      try {\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n          setAudioSupported(true);\n          console.log('Audio recording initialized successfully');\n        }\n      } catch (error) {\n        console.error('Audio not supported:', error);\n        setAudioSupported(false);\n      }\n    };\n\n    checkAudioSupport();\n  }, []);\n\n  // Generate initial customer message\n  useEffect(() => {\n    if (messages.length === 0 && sessionActive) {\n      generateCustomerMessageMutation.mutate({\n        stage: currentStage,\n        persona: session.configuration.persona,\n        problem: session.configuration.problem,\n        isInitial: true\n      });\n    }\n  }, [sessionActive]);\n\n  const handleSendResponse = async () => {\n    if (!currentResponse.trim() || isLoading) return;\n\n    setIsLoading(true);\n    \n    const agentMessage: Message = {\n      id: Date.now().toString(),\n      role: 'agent',\n      content: currentResponse,\n      timestamp: new Date()\n    };\n    setMessages(prev => [...prev, agentMessage]);\n    \n    const response = currentResponse;\n    setCurrentResponse(\"\");\n\n    try {\n      await evaluateResponseMutation.mutateAsync({\n        stage: currentStage,\n        agentMessage: response,\n        customerPersona: session.configuration.persona,\n        problem: session.configuration.problem,\n        conversationHistory: messages.slice(-3)\n      });\n    } catch (error) {\n      console.error('Failed to process response:', error);\n    }\n    \n    setIsLoading(false);\n  };\n\n  const handleEndSession = async () => {\n    setSessionActive(false);\n    await apiRequest(\"PATCH\", `/api/sessions/${session.id}`, {\n      status: 'completed',\n      endTime: new Date().toISOString()\n    });\n    onComplete();\n  };\n\n  const handleStageChange = (newStage: string) => {\n    setCurrentStage(newStage);\n    // Generate a message appropriate for the new stage\n    generateCustomerMessageMutation.mutate({\n      stage: newStage,\n      persona: session.configuration.persona,\n      problem: session.configuration.problem,\n      stageTransition: true\n    });\n  };\n\n  // Audio recording functions\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        audio: {\n          echoCancellation: true,\n          noiseSuppression: true,\n          sampleRate: 44100\n        } \n      });\n      \n      streamRef.current = stream;\n      \n      const audioContext = new AudioContext();\n      const analyser = audioContext.createAnalyser();\n      const microphone = audioContext.createMediaStreamSource(stream);\n      const dataArray = new Uint8Array(analyser.frequencyBinCount);\n      \n      microphone.connect(analyser);\n      analyser.fftSize = 256;\n      \n      const updateAudioLevel = () => {\n        analyser.getByteFrequencyData(dataArray);\n        const average = dataArray.reduce((a, b) => a + b) / dataArray.length;\n        setAudioLevel(average / 255);\n        \n        if (isRecording) {\n          animationFrameRef.current = requestAnimationFrame(updateAudioLevel);\n        }\n      };\n\n      const mediaRecorder = new MediaRecorder(stream, {\n        mimeType: 'audio/webm;codecs=opus'\n      });\n      \n      mediaRecorderRef.current = mediaRecorder;\n      setAudioChunks([]);\n      \n      mediaRecorder.ondataavailable = (event) => {\n        if (event.data.size > 0) {\n          setAudioChunks(prev => [...prev, event.data]);\n        }\n      };\n\n      mediaRecorder.start();\n      setIsRecording(true);\n      updateAudioLevel();\n    } catch (error) {\n      console.error('Failed to start recording:', error);\n    }\n  };\n\n  const submitRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });\n        if (audioBlob.size > 0) {\n          transcribeAudioMutation.mutate(audioBlob);\n        }\n        cleanupRecording();\n      };\n      \n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const cancelRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.onstop = () => {\n        cleanupRecording();\n      };\n      \n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n      setAudioChunks([]);\n    }\n  };\n\n  const cleanupRecording = () => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    if (animationFrameRef.current) {\n      cancelAnimationFrame(animationFrameRef.current);\n    }\n    setAudioLevel(0);\n  };\n\n  const getPersonaInfo = () => {\n    return customerPersonas.find(p => p.id === session.configuration.persona) || customerPersonas[0];\n  };\n\n  const getSentimentColor = (sentiment: string) => {\n    switch (sentiment?.toLowerCase()) {\n      case 'angry': case 'frustrated': return 'text-red-600 bg-red-50';\n      case 'happy': case 'satisfied': return 'text-green-600 bg-green-50';\n      case 'neutral': return 'text-gray-600 bg-gray-50';\n      case 'confused': return 'text-yellow-600 bg-yellow-50';\n      default: return 'text-gray-600 bg-gray-50';\n    }\n  };\n\n  const getScoreColor = (score: number) => {\n    if (score >= 8) return 'text-green-600';\n    if (score >= 6) return 'text-yellow-600';\n    return 'text-red-600';\n  };\n\n  const persona = getPersonaInfo();\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900\">Customer Support Simulation</h2>\n            <div className=\"flex items-center space-x-4 mt-2\">\n              <Badge variant=\"secondary\">{session.configuration.channel}</Badge>\n              <Badge variant=\"outline\">{currentStage}</Badge>\n              <span className=\"text-sm text-gray-600\">\n                Time: {formatDuration(timeRemaining)}\n              </span>\n            </div>\n          </div>\n          <div className=\"flex space-x-2\">\n            <Select value={currentStage} onValueChange={handleStageChange}>\n              <SelectTrigger className=\"w-48\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {supportStages.map((stage) => (\n                  <SelectItem key={stage} value={stage}>{stage}</SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n            <Button variant=\"outline\" onClick={handleEndSession}>\n              End Session\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Customer Info */}\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center space-x-2\">\n                <User className=\"h-5 w-5\" />\n                <span>Customer Profile</span>\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <div>\n                  <h4 className=\"font-medium text-gray-900\">{persona.name}</h4>\n                  <p className=\"text-sm text-gray-600\">{persona.description}</p>\n                </div>\n                <div>\n                  <h5 className=\"font-medium text-gray-900 mb-2\">Issue:</h5>\n                  <p className=\"text-sm text-gray-700 bg-gray-50 p-3 rounded\">\n                    {session.configuration.problem}\n                  </p>\n                </div>\n                <div>\n                  <h5 className=\"font-medium text-gray-900 mb-2\">Channel:</h5>\n                  <div className=\"flex items-center space-x-2\">\n                    {session.configuration.channel === 'Chat' ? \n                      <MessageCircle className=\"h-4 w-4\" /> : \n                      <Phone className=\"h-4 w-4\" />\n                    }\n                    <span className=\"text-sm\">{session.configuration.channel}</span>\n                  </div>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Conversation */}\n          <Card className=\"lg:col-span-2\">\n            <CardHeader>\n              <CardTitle>Support Conversation</CardTitle>\n            </CardHeader>\n            <CardContent>\n              {/* Messages */}\n              <div className=\"h-96 overflow-y-auto border rounded-lg p-4 mb-4 space-y-4\">\n                {messages.map((message) => (\n                  <div\n                    key={message.id}\n                    className={`flex ${message.role === 'agent' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    <div className={`max-w-sm ${\n                      message.role === 'agent' \n                        ? 'bg-blue-600 text-white rounded-l-lg rounded-tr-lg' \n                        : 'bg-gray-100 text-gray-900 rounded-r-lg rounded-tl-lg'\n                    } p-3`}>\n                      <div className=\"flex items-start space-x-2\">\n                        <Avatar className=\"w-6 h-6\">\n                          <AvatarFallback className={\n                            message.role === 'agent' \n                              ? 'bg-blue-100 text-blue-700 text-xs' \n                              : 'bg-gray-200 text-gray-700 text-xs'\n                          }>\n                            {message.role === 'agent' ? 'A' : 'C'}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1\">\n                          <p className=\"text-sm\">{message.content}</p>\n                          <div className=\"flex items-center justify-between mt-2\">\n                            <span className=\"text-xs opacity-75\">\n                              {message.timestamp.toLocaleTimeString()}\n                            </span>\n                            {message.sentiment && (\n                              <Badge \n                                variant=\"outline\" \n                                className={`text-xs ${getSentimentColor(message.sentiment)}`}\n                              >\n                                {message.sentiment}\n                              </Badge>\n                            )}\n                          </div>\n                          {message.role === 'agent' && (message.empathyScore || message.clarityScore) && (\n                            <div className=\"mt-2 space-y-2\">\n                              <div className=\"flex space-x-2\">\n                                {message.empathyScore && (\n                                  <span className={`text-xs ${getScoreColor(message.empathyScore)}`}>\n                                    Empathy: {message.empathyScore}/10\n                                  </span>\n                                )}\n                                {message.clarityScore && (\n                                  <span className={`text-xs ${getScoreColor(message.clarityScore)}`}>\n                                    Clarity: {message.clarityScore}/10\n                                  </span>\n                                )}\n                              </div>\n                              \n                              {/* Show feedback and suggestions for poor responses */}\n                              {((message.empathyScore && message.empathyScore < 6) || (message.clarityScore && message.clarityScore < 6)) && (\n                                <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3 text-xs\">\n                                  <div className=\"font-medium text-yellow-800 mb-1\"> Improvement Suggestion:</div>\n                                  {message.feedback && (\n                                    <div className=\"text-yellow-700 mb-2\">\n                                      {message.feedback}\n                                    </div>\n                                  )}\n                                  {message.suggestedResponse && (\n                                    <div className=\"bg-white border border-yellow-300 rounded p-2\">\n                                      <div className=\"font-medium text-yellow-800 mb-1\">Better response example:</div>\n                                      <div className=\"text-gray-700 text-xs italic\">\n                                        \"{message.suggestedResponse}\"\n                                      </div>\n                                    </div>\n                                  )}\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n                \n                {(isLoading || generateCustomerMessageMutation.isPending) && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"bg-gray-100 rounded-r-lg rounded-tl-lg p-3 max-w-sm\">\n                      <div className=\"flex items-center space-x-2\">\n                        <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-gray-600\"></div>\n                        <span className=\"text-sm text-gray-600\">Customer is typing...</span>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              {/* Response Input */}\n              <div className=\"flex space-x-3\">\n                <div className=\"flex-1 relative\">\n                  <Textarea\n                    className=\"resize-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-3 pb-16\"\n                    rows={4}\n                    placeholder={isRecording ? \"Recording in progress...\" : \"Type your response here...\"}\n                    value={currentResponse}\n                    onChange={(e) => setCurrentResponse(e.target.value)}\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        handleSendResponse();\n                      }\n                    }}\n                    disabled={isLoading || generateCustomerMessageMutation.isPending || isRecording}\n                  />\n                  \n                  {/* Integrated Recording Interface */}\n                  {isRecording && (\n                    <div className=\"absolute bottom-2 left-2 right-2 bg-gradient-to-r from-red-50 to-orange-50 border border-red-200 rounded-lg p-3\">\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <div className=\"flex items-center space-x-2\">\n                          <div className=\"animate-pulse bg-red-500 rounded-full h-2 w-2\"></div>\n                          <span className=\"text-red-800 text-xs font-medium\">Recording...</span>\n                        </div>\n                        <div className=\"flex items-center space-x-1\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={cancelRecording}\n                            className=\"text-red-600 border-red-300 hover:bg-red-100 h-6 w-6 p-0\"\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </Button>\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={submitRecording}\n                            className=\"text-green-600 border-green-300 hover:bg-green-100 h-6 w-6 p-0\"\n                          >\n                            <Check className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </div>\n                      \n                      {/* Voice Wave Visualization */}\n                      <div className=\"flex items-center justify-center space-x-0.5 h-6\">\n                        {Array.from({ length: 25 }, (_, i) => (\n                          <div\n                            key={i}\n                            className=\"bg-red-400 rounded-full transition-all duration-150\"\n                            style={{\n                              width: '2px',\n                              height: `${Math.max(3, audioLevel * 20 + Math.random() * 8)}px`,\n                              opacity: audioLevel > 0.05 ? 0.8 : 0.3,\n                            }}\n                          />\n                        ))}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Processing Status */}\n                  {transcribeAudioMutation.isPending && (\n                    <div className=\"absolute bottom-2 left-2 right-2 bg-blue-50 border border-blue-200 rounded-lg p-2\">\n                      <div className=\"flex items-center justify-center space-x-2\">\n                        <div className=\"animate-spin rounded-full h-3 w-3 border-b-2 border-blue-600\"></div>\n                        <span className=\"text-blue-800 text-xs font-medium\">Converting speech to text...</span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n                \n                <div className=\"flex flex-col space-y-2\">\n                  <Button \n                    size=\"lg\"\n                    onClick={handleSendResponse}\n                    disabled={!currentResponse.trim() || isLoading || generateCustomerMessageMutation.isPending || isRecording}\n                    className=\"bg-blue-600 hover:bg-blue-700\"\n                  >\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                  {audioSupported && !isRecording && session.configuration.channel === 'Call' && (\n                    <Button \n                      variant=\"outline\" \n                      size=\"lg\"\n                      onClick={startRecording}\n                      disabled={isLoading || generateCustomerMessageMutation.isPending || transcribeAudioMutation.isPending}\n                      className=\"hover:bg-blue-50\"\n                      title=\"Start Voice Recording\"\n                    >\n                      <Mic className=\"h-4 w-4\" />\n                    </Button>\n                  )}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":24258,"size_tokens":null},"client/src/pages/negotiation-simulator.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useSearch, useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { formatScore, getScoreColor } from \"@/lib/utils\";\nimport { ModeBanner } from \"@/components/ModeBanner\";\nimport NegotiationSession from \"@/components/simulation/negotiation-session\";\nimport { \n  DollarSign, TrendingUp, Handshake, Play, Building2, Briefcase, \n  Target, CheckCircle2, MapPin, ArrowRight, ChevronLeft\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { OfferDetails } from \"@shared/schema\";\n\ninterface ApplicationWithOffer {\n  id: number;\n  status: string;\n  offerDetails: OfferDetails | null;\n  job: {\n    title: string;\n    role: string;\n    location: string;\n    company: {\n      id: number;\n      name: string;\n      logo: string | null;\n      industry: string;\n    };\n  };\n  stages: any[];\n}\n\nconst scenarios = [\n  {\n    id: \"salary\",\n    title: \"Salary Negotiation\",\n    description: \"Negotiate your salary with HR or hiring manager\",\n    icon: DollarSign,\n    bgColor: \"bg-green-100 dark:bg-green-900/30\",\n    iconColor: \"text-green-600 dark:text-green-400\"\n  },\n  {\n    id: \"promotion\", \n    title: \"Promotion Discussion\",\n    description: \"Discuss career advancement with your manager\",\n    icon: TrendingUp,\n    bgColor: \"bg-purple-100 dark:bg-purple-900/30\",\n    iconColor: \"text-purple-600 dark:text-purple-400\"\n  },\n  {\n    id: \"offer\",\n    title: \"Job Offer Terms\",\n    description: \"Negotiate complete offer package terms\",\n    icon: Handshake,\n    bgColor: \"bg-blue-100 dark:bg-blue-900/30\",\n    iconColor: \"text-blue-600 dark:text-blue-400\"\n  }\n];\n\nconst counterpartStyles = [\n  { id: \"collaborative\", label: \"Collaborative\", icon: \"\" },\n  { id: \"competitive\", label: \"Competitive\", icon: \"\" },\n  { id: \"analytical\", label: \"Analytical\", icon: \"\" },\n  { id: \"relationship\", label: \"Relationship-focused\", icon: \"\" }\n];\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    maximumFractionDigits: 0,\n  }).format(amount);\n}\n\n// Offer Selection Card Component\nfunction OfferCard({ \n  application, \n  isSelected, \n  onSelect \n}: { \n  application: ApplicationWithOffer; \n  isSelected: boolean;\n  onSelect: () => void;\n}) {\n  const offer = application.offerDetails!;\n  \n  return (\n    <button\n      onClick={onSelect}\n      className={cn(\n        \"w-full text-left p-4 rounded-lg border-2 transition-all\",\n        isSelected \n          ? \"border-primary bg-primary/5 dark:bg-primary/10\" \n          : \"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600\"\n      )}\n      data-testid={`offer-card-${application.id}`}\n    >\n      <div className=\"flex items-start gap-4\">\n        <div className=\"h-12 w-12 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-xl font-bold text-primary shrink-0\">\n          {application.job.company.name.charAt(0)}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-gray-900 dark:text-white truncate\">\n              {application.job.title}\n            </h3>\n            {isSelected && (\n              <CheckCircle2 className=\"h-5 w-5 text-primary shrink-0\" />\n            )}\n          </div>\n          <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n            {application.job.company.name}  {application.job.location}\n          </p>\n          <div className=\"flex items-center gap-4 mt-3\">\n            <div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Base Salary</p>\n              <p className=\"text-lg font-bold text-gray-900 dark:text-white\">\n                {formatCurrency(offer.baseSalary)}\n              </p>\n            </div>\n            {offer.signingBonus && (\n              <div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Signing</p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">\n                  {formatCurrency(offer.signingBonus)}\n                </p>\n              </div>\n            )}\n            {offer.equity && (\n              <div>\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Equity</p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">\n                  {formatCurrency(offer.equity.amount)}\n                </p>\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </button>\n  );\n}\n\n// Offer Selection Step\nfunction OfferSelectionStep({ \n  offers, \n  selectedOfferId,\n  onSelectOffer,\n  onContinue,\n  onPracticeMode,\n  isJourneyMode = false\n}: { \n  offers: ApplicationWithOffer[];\n  selectedOfferId: number | null;\n  onSelectOffer: (id: number) => void;\n  onContinue: () => void;\n  onPracticeMode: () => void;\n  isJourneyMode?: boolean;\n}) {\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-3xl mx-auto\">\n        {/* Journey Mode Banner for selection step */}\n        {isJourneyMode && (\n          <ModeBanner \n            mode=\"journey\" \n            variant=\"banner\"\n          />\n        )}\n\n        <div className=\"mb-8\">\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n            {isJourneyMode ? \"Select Your Offer\" : \"Negotiation Simulator\"}\n          </h1>\n          <p className=\"text-gray-500 dark:text-gray-400\">\n            {isJourneyMode \n              ? \"Choose which offer you'd like to negotiate as part of your job journey.\"\n              : \"Select an offer to negotiate, or start a practice session with custom scenarios.\"\n            }\n          </p>\n        </div>\n\n        {offers.length > 0 && (\n          <Card className=\"mb-6\">\n            <CardHeader>\n              <CardTitle className=\"text-lg flex items-center gap-2\">\n                <Briefcase className=\"h-5 w-5 text-green-600\" />\n                Your Offers\n              </CardTitle>\n              <CardDescription>\n                Choose an offer to negotiate for better terms\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              {offers.map((offer) => (\n                <OfferCard\n                  key={offer.id}\n                  application={offer}\n                  isSelected={selectedOfferId === offer.id}\n                  onSelect={() => onSelectOffer(offer.id)}\n                />\n              ))}\n            </CardContent>\n          </Card>\n        )}\n\n        <div className=\"flex items-center gap-4\">\n          {offers.length > 0 && (\n            <Button\n              size=\"lg\"\n              onClick={onContinue}\n              disabled={!selectedOfferId}\n              className=\"flex-1\"\n              data-testid=\"button-continue-with-offer\"\n            >\n              {isJourneyMode ? \"Continue with This Offer\" : \"Negotiate This Offer\"}\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\n            </Button>\n          )}\n          {/* Only show practice mode option when not in journey mode */}\n          {!isJourneyMode && (\n            <Button\n              size=\"lg\"\n              variant={offers.length > 0 ? \"outline\" : \"default\"}\n              onClick={onPracticeMode}\n              className={offers.length === 0 ? \"flex-1\" : \"\"}\n              data-testid=\"button-practice-mode\"\n            >\n              {offers.length > 0 ? \"Practice Mode Instead\" : \"Start Practice Session\"}\n            </Button>\n          )}\n        </div>\n\n        {offers.length === 0 && (\n          <Card className=\"mt-6 bg-gray-50 dark:bg-gray-800/50\">\n            <CardContent className=\"p-6 text-center\">\n              <div className=\"h-16 w-16 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center mx-auto mb-4\">\n                <Briefcase className=\"h-8 w-8 text-gray-400\" />\n              </div>\n              <h3 className=\"font-semibold text-gray-900 dark:text-white mb-2\">\n                No Offers Yet\n              </h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400 max-w-md mx-auto\">\n                Complete your interview stages in the Job Journey to receive offers. \n                {!isJourneyMode && \" In the meantime, you can practice negotiation with custom scenarios.\"}\n              </p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Selected Offer Summary (shown in configuration step)\nfunction SelectedOfferSummary({ \n  application,\n  onChangeOffer \n}: { \n  application: ApplicationWithOffer;\n  onChangeOffer: () => void;\n}) {\n  const offer = application.offerDetails!;\n  \n  return (\n    <Card className=\"mb-6 border border-gray-200 dark:border-gray-700 overflow-hidden\">\n      <div className=\"bg-gray-50 dark:bg-gray-800/50 px-6 py-4 border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"flex items-center justify-between\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-lg bg-white dark:bg-gray-700 shadow-sm flex items-center justify-center text-lg font-bold text-primary border border-gray-200 dark:border-gray-600\">\n              {application.job.company.name.charAt(0)}\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-gray-900 dark:text-white\">\n                {application.job.company.name}\n              </h3>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {application.job.title}  {application.job.location}\n              </p>\n            </div>\n          </div>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            onClick={onChangeOffer}\n            className=\"text-gray-500 hover:text-gray-700\"\n            data-testid=\"button-change-offer\"\n          >\n            <ChevronLeft className=\"h-4 w-4 mr-1\" />\n            Change Offer\n          </Button>\n        </div>\n      </div>\n      \n      <CardContent className=\"p-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          <div className=\"space-y-4\">\n            <div>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-1\">Current Base Offer</p>\n              <p className=\"text-4xl font-bold text-gray-900 dark:text-white\" data-testid=\"text-current-offer\">\n                {formatCurrency(offer.baseSalary)}\n              </p>\n            </div>\n            <div className=\"flex items-center gap-2 pt-2\">\n              <Target className=\"h-4 w-4 text-blue-600\" />\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Suggested target:</span>\n              <span className=\"text-lg font-semibold text-blue-600 dark:text-blue-400\">\n                {formatCurrency(Math.round(offer.baseSalary * 1.15))}\n              </span>\n              <span className=\"text-xs text-gray-500 dark:text-gray-400\">(+15%)</span>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-2 gap-3\">\n            {offer.signingBonus && (\n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Signing</p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">\n                  {formatCurrency(offer.signingBonus)}\n                </p>\n              </div>\n            )}\n            {offer.annualBonus && (\n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Bonus</p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">\n                  {offer.annualBonus.targetPercent}%\n                </p>\n              </div>\n            )}\n            {offer.equity && (\n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <p className=\"text-xs text-gray-500 dark:text-gray-400\">Equity</p>\n                <p className=\"font-semibold text-gray-900 dark:text-white\">\n                  {formatCurrency(offer.equity.amount)}\n                </p>\n              </div>\n            )}\n            <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">Start Date</p>\n              <p className=\"font-semibold text-gray-900 dark:text-white\">\n                {offer.startDate}\n              </p>\n            </div>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function NegotiationSimulator() {\n  const { toast } = useToast();\n  const [, navigate] = useLocation();\n  const searchString = useSearch();\n  const searchParams = new URLSearchParams(searchString);\n  const applicationIdFromUrl = searchParams.get('applicationId');\n  const journeyModeFromUrl = searchParams.get('journeyMode');\n  \n  // Step management: 'select' | 'configure' | 'session'\n  const [step, setStep] = useState<'select' | 'configure' | 'session'>(\n    applicationIdFromUrl ? 'configure' : 'select'\n  );\n  const [selectedApplicationId, setSelectedApplicationId] = useState<number | null>(\n    applicationIdFromUrl ? parseInt(applicationIdFromUrl) : null\n  );\n  const [currentSession, setCurrentSession] = useState<any>(null);\n  const [selectedScenario, setSelectedScenario] = useState(\"salary\");\n  const [targetAmount, setTargetAmount] = useState(\"120000\");\n  const [companyRange, setCompanyRange] = useState(\"$90k - $110k\");\n  const [counterpartStyle, setCounterpartStyle] = useState(\"collaborative\");\n\n  const { data: user } = useQuery<{ id: number }>({\n    queryKey: [\"/api/user\"],\n  });\n\n  // Dedicated query for direct applicationId links (works even before allApplications loads)\n  const { data: directApplication, isLoading: isLoadingDirect } = useQuery<ApplicationWithOffer>({\n    queryKey: [applicationIdFromUrl ? `/api/applications/${applicationIdFromUrl}` : null],\n    enabled: !!applicationIdFromUrl,\n  });\n\n  // Fetch all applications to find offers for the selection step\n  const { data: allApplications = [], isLoading: isLoadingApplications } = useQuery<ApplicationWithOffer[]>({\n    queryKey: [user?.id ? `/api/users/${user.id}/applications` : null],\n    enabled: !!user?.id,\n  });\n\n  // Filter to only applications with offers\n  const applicationsWithOffers = allApplications.filter(\n    app => app.status === 'offer' && app.offerDetails\n  );\n\n  // Get selected application - prioritize direct query for URL-based selection\n  const selectedApplication = selectedApplicationId \n    ? (directApplication?.id === selectedApplicationId \n        ? directApplication \n        : applicationsWithOffers.find(app => app.id === selectedApplicationId))\n    : null;\n\n  // Update config when application is selected\n  useEffect(() => {\n    if (selectedApplication?.offerDetails) {\n      setSelectedScenario(\"offer\");\n      setTargetAmount(String(Math.round(selectedApplication.offerDetails.baseSalary * 1.15)));\n      const currentOffer = formatCurrency(selectedApplication.offerDetails.baseSalary);\n      setCompanyRange(`${currentOffer} (current offer)`);\n    }\n  }, [selectedApplication]);\n\n  // Sync URL when selection changes (persist selection across refreshes)\n  // Preserve journeyMode if it was set\n  useEffect(() => {\n    if (step === 'configure' && selectedApplicationId && !applicationIdFromUrl) {\n      const params = new URLSearchParams();\n      if (journeyModeFromUrl) {\n        params.set('journeyMode', journeyModeFromUrl);\n      }\n      params.set('applicationId', String(selectedApplicationId));\n      navigate(`/negotiation?${params.toString()}`, { replace: true });\n    }\n  }, [step, selectedApplicationId, applicationIdFromUrl, journeyModeFromUrl, navigate]);\n\n  const { data: previousSessions = [] } = useQuery<Array<{ id: number; type: string; configuration?: { scenario?: string; targetAmount?: number }; score?: number }>>({\n    queryKey: [`/api/user/${user?.id}/sessions`],\n    enabled: !!user?.id,\n  });\n\n  const negotiationSessions = previousSessions.filter((session: any) => session.type === 'negotiation');\n\n  const createSessionMutation = useMutation({\n    mutationFn: async (sessionData: any) => {\n      const response = await apiRequest(\"POST\", \"/api/sessions\", sessionData);\n      return response.json();\n    },\n    onSuccess: (session) => {\n      setCurrentSession(session);\n      setStep('session');\n      queryClient.invalidateQueries({ queryKey: [`/api/user/${user?.id}/sessions`] });\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to start negotiation session\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleStartNegotiation = async () => {\n    if (!user) return;\n\n    const configuration = {\n      scenario: selectedScenario,\n      targetAmount: parseInt(targetAmount),\n      companyRange,\n      counterpartStyle,\n      applicationId: selectedApplicationId,\n    };\n\n    createSessionMutation.mutate({\n      userId: user.id,\n      type: 'negotiation',\n      status: 'active',\n      configuration,\n      messages: []\n    });\n  };\n\n  const handleSelectOffer = (id: number) => {\n    setSelectedApplicationId(id);\n  };\n\n  const handleContinueWithOffer = () => {\n    if (selectedApplicationId) {\n      setStep('configure');\n    }\n  };\n\n  const handlePracticeMode = () => {\n    setSelectedApplicationId(null);\n    setSelectedScenario(\"salary\");\n    setTargetAmount(\"120000\");\n    setCompanyRange(\"$90k - $110k\");\n    setStep('configure');\n  };\n\n  const handleChangeOffer = () => {\n    setStep('select');\n    setSelectedApplicationId(null);\n    // Preserve journey mode when changing offers\n    if (journeyModeFromUrl) {\n      navigate(`/negotiation?journeyMode=${journeyModeFromUrl}`, { replace: true });\n    } else {\n      navigate('/negotiation', { replace: true });\n    }\n  };\n\n  // Show active session\n  if (currentSession || step === 'session') {\n    return (\n      <NegotiationSession \n        session={currentSession}\n        onComplete={() => {\n          setCurrentSession(null);\n          setStep('select');\n          setSelectedApplicationId(null);\n          // Preserve journey mode when session completes - redirect to journey page\n          if (journeyModeFromUrl || applicationIdFromUrl) {\n            navigate('/', { replace: true });\n          } else {\n            navigate('/negotiation', { replace: true });\n          }\n          queryClient.invalidateQueries({ queryKey: [`/api/user/${user?.id}/sessions`] });\n        }}\n      />\n    );\n  }\n\n  // Loading state - show for direct link loading (journey mode) or applications loading in selection step\n  // Include journeyModeFromUrl to ensure we show loading for any Journey mode entry\n  const isJourneyEntryLoading = (applicationIdFromUrl || journeyModeFromUrl) && isLoadingDirect;\n  const isLoading = (step === 'configure' && isJourneyEntryLoading) \n    || (step === 'select' && isLoadingApplications);\n  \n  if (isLoading) {\n    return (\n      <div className=\"p-8\">\n        <div className=\"max-w-3xl mx-auto space-y-4\">\n          <Skeleton className=\"h-8 w-64\" />\n          <Skeleton className=\"h-4 w-96\" />\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"space-y-4\">\n                <Skeleton className=\"h-24 w-full\" />\n                <Skeleton className=\"h-24 w-full\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // Determine if we're in Journey mode based on URL params (source of truth)\n  const isJourneyMode = !!journeyModeFromUrl || !!applicationIdFromUrl || !!selectedApplicationId;\n\n  // Offer Selection Step\n  if (step === 'select') {\n    return (\n      <OfferSelectionStep\n        offers={applicationsWithOffers}\n        selectedOfferId={selectedApplicationId}\n        onSelectOffer={handleSelectOffer}\n        onContinue={handleContinueWithOffer}\n        onPracticeMode={handlePracticeMode}\n        isJourneyMode={isJourneyMode}\n      />\n    );\n  }\n\n  // Configuration Step\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        {/* Mode Banner - use URL params to determine mode even before data loads */}\n        <ModeBanner \n          mode={isJourneyMode ? \"journey\" : \"practice\"} \n          variant=\"banner\"\n          context={selectedApplication ? {\n            companyName: selectedApplication.job.company.name,\n            jobTitle: selectedApplication.job.title,\n          } : undefined}\n        />\n\n        {/* Back button for practice mode */}\n        {!isJourneyMode && (\n          <button\n            onClick={() => setStep('select')}\n            className=\"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 mb-4\"\n            data-testid=\"button-back-to-selection\"\n          >\n            <ChevronLeft className=\"h-4 w-4\" />\n            Back to offer selection\n          </button>\n        )}\n\n        {/* Selected Offer Summary */}\n        {selectedApplication && (\n          <SelectedOfferSummary \n            application={selectedApplication}\n            onChangeOffer={handleChangeOffer}\n          />\n        )}\n        \n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              {isJourneyMode ? \"Configure Negotiation\" : \"Practice Negotiation\"}\n            </CardTitle>\n            <CardDescription>\n              {isJourneyMode \n                ? \"Customize your negotiation parameters before starting\"\n                : \"Build your negotiation skills with sample scenarios\"\n              }\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-8\">\n            {/* Scenario Selection */}\n            <div className=\"mb-8\">\n              <Label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-4\">\n                Choose Negotiation Scenario\n              </Label>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mt-4\">\n                {scenarios.map((scenario) => {\n                  const Icon = scenario.icon;\n                  return (\n                    <div\n                      key={scenario.id}\n                      className={cn(\n                        \"cursor-pointer p-4 rounded-lg border-2 transition-all\",\n                        selectedScenario === scenario.id \n                          ? \"border-primary bg-primary/5\" \n                          : \"border-gray-200 dark:border-gray-700 hover:border-gray-300\"\n                      )}\n                      onClick={() => setSelectedScenario(scenario.id)}\n                      data-testid={`scenario-${scenario.id}`}\n                    >\n                      <div className={`w-12 h-12 ${scenario.bgColor} rounded-lg flex items-center justify-center mb-3`}>\n                        <Icon className={`${scenario.iconColor} h-6 w-6`} />\n                      </div>\n                      <h3 className=\"font-semibold text-gray-900 dark:text-white mb-2\">{scenario.title}</h3>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400\">{scenario.description}</p>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n\n            {/* Negotiation Parameters */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n              <div>\n                <Label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Your Target</Label>\n                <div className=\"relative mt-2\">\n                  <span className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500\">$</span>\n                  <Input\n                    type=\"number\"\n                    className=\"pl-8\"\n                    placeholder=\"120000\"\n                    value={targetAmount}\n                    onChange={(e) => setTargetAmount(e.target.value)}\n                    data-testid=\"input-target-amount\"\n                  />\n                </div>\n              </div>\n              <div>\n                <Label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Company's Likely Range</Label>\n                <Input\n                  className=\"mt-2\"\n                  placeholder=\"$90k - $110k\"\n                  value={companyRange}\n                  onChange={(e) => setCompanyRange(e.target.value)}\n                  data-testid=\"input-company-range\"\n                />\n              </div>\n            </div>\n\n            {/* Counterpart Style */}\n            <div className=\"mb-8\">\n              <Label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2\">Counterpart Style</Label>\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3 mt-2\">\n                {counterpartStyles.map((style) => (\n                  <Button\n                    key={style.id}\n                    variant={counterpartStyle === style.id ? \"default\" : \"outline\"}\n                    size=\"sm\"\n                    onClick={() => setCounterpartStyle(style.id)}\n                    className={cn(\n                      \"flex flex-col items-center space-y-1 h-auto py-3\",\n                      counterpartStyle === style.id && \"bg-blue-600 hover:bg-blue-700\"\n                    )}\n                    data-testid={`style-${style.id}`}\n                  >\n                    <span className=\"text-lg\">{style.icon}</span>\n                    <span className=\"text-xs\">{style.label}</span>\n                  </Button>\n                ))}\n              </div>\n            </div>\n\n            {/* Start Negotiation */}\n            <div className=\"flex justify-center\">\n              <Button \n                size=\"lg\"\n                onClick={handleStartNegotiation}\n                disabled={createSessionMutation.isPending}\n                className=\"bg-green-600 hover:bg-green-700\"\n                data-testid=\"button-start-negotiation\"\n              >\n                <Play className=\"mr-2 h-4 w-4\" />\n                {createSessionMutation.isPending ? \"Starting...\" : \"Start Negotiation\"}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Previous Negotiations */}\n        {negotiationSessions.length > 0 && (\n          <Card className=\"mt-8\">\n            <CardHeader>\n              <CardTitle className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                Previous Negotiations\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                {negotiationSessions.map((session: any) => (\n                  <div key={session.id} className=\"border border-gray-200 dark:border-gray-700 rounded-lg p-4\">\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex items-center space-x-4\">\n                        <div className=\"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center\">\n                          <Handshake className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                        </div>\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900 dark:text-white capitalize\">\n                            {session.configuration?.scenario} Negotiation\n                          </h4>\n                          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                            Target: ${session.configuration?.targetAmount?.toLocaleString()}  Final: {session.score ? 'TBD' : 'In Progress'}\n                          </p>\n                        </div>\n                      </div>\n                      <div className=\"text-right\">\n                        {session.score && (\n                          <>\n                            <p className={`text-sm font-medium ${getScoreColor(session.score)}`}>\n                              Success Rate: {session.score}%\n                            </p>\n                            <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                              {session.score >= 80 ? 'Strong performance' : session.score >= 60 ? 'Good result' : 'Needs improvement'}\n                            </p>\n                          </>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":29097,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/layout/sidebar.tsx":{"content":"import { Link, useLocation, useSearch } from \"wouter\";\nimport { cn } from \"@/lib/utils\";\nimport { \n  GraduationCap, \n  Map, \n  MessageCircle, \n  Handshake, \n  Users, \n  TrendingUp, \n  Settings,\n  Briefcase,\n  Route,\n  History,\n  Rocket,\n  Target\n} from \"lucide-react\";\n\ninterface NavItem {\n  title: string;\n  href: string;\n  icon: React.ComponentType<{ className?: string }>;\n  section: string;\n  children?: NavItem[];\n}\n\nconst navigationItems: NavItem[] = [\n  {\n    title: \"My Journey\",\n    href: \"/\",\n    icon: Map,\n    section: \"journey\"\n  },\n  {\n    title: \"Job Board\",\n    href: \"/jobs\",\n    icon: Briefcase,\n    section: \"journey\"\n  },\n  {\n    title: \"Application Details\",\n    href: \"/journey\",\n    icon: Route,\n    section: \"journey\"\n  },\n  {\n    title: \"Workspace\",\n    href: \"/workspace/journey\",\n    icon: Rocket,\n    section: \"journey\"\n  },\n  {\n    title: \"Interview Practice\", \n    href: \"/interview\",\n    icon: MessageCircle,\n    section: \"practice\",\n    children: [\n      {\n        title: \"Practice History\",\n        href: \"/interview/history\",\n        icon: History,\n        section: \"practice\"\n      }\n    ]\n  },\n  {\n    title: \"Negotiation Practice\",\n    href: \"/negotiation\", \n    icon: Handshake,\n    section: \"practice\"\n  },\n  {\n    title: \"Workspace Practice\",\n    href: \"/workspace/practice\",\n    icon: Target,\n    section: \"practice\"\n  },\n  {\n    title: \"Progress & Analytics\",\n    href: \"/progress\",\n    icon: TrendingUp,\n    section: \"account\"\n  },\n  {\n    title: \"Settings\",\n    href: \"/settings\",\n    icon: Settings,\n    section: \"account\"\n  }\n];\n\n// Paths that can be in Journey mode when they have specific URL params\nconst journeyModeIndicators: Record<string, string[]> = {\n  \"/interview\": [\"stageId\", \"journeyMode\"],\n  \"/negotiation\": [\"applicationId\", \"journeyMode\"],\n};\n\nexport default function Sidebar() {\n  const [location] = useLocation();\n  const searchString = useSearch();\n  const searchParams = new URLSearchParams(searchString);\n\n  // Check if current page is in Journey mode (has journey-related URL params)\n  const isInJourneyMode = Object.entries(journeyModeIndicators).some(\n    ([path, params]) => location === path && params.some(p => searchParams.has(p))\n  );\n\n  const groupedItems = navigationItems.reduce((acc, item) => {\n    if (!acc[item.section]) {\n      acc[item.section] = [];\n    }\n    acc[item.section].push(item);\n    return acc;\n  }, {} as Record<string, NavItem[]>);\n\n  // Determine which item should be active\n  const getIsActive = (item: NavItem) => {\n    // If we're in Journey mode on a simulator page, highlight \"Application Details\" instead\n    if (isInJourneyMode && item.href === \"/journey\") {\n      return true;\n    }\n    \n    // If we're in Journey mode, don't highlight the practice section items\n    if (isInJourneyMode && item.section === \"practice\") {\n      return false;\n    }\n    \n    // Normal path matching - also check if we're on a child route\n    if (location === item.href) return true;\n    \n    // Check if any child is active (for parent highlighting)\n    if (item.children?.some(child => location === child.href)) return true;\n    \n    return false;\n  };\n  \n  // Check if a parent item should be expanded (has active child or is active itself)\n  const shouldExpand = (item: NavItem) => {\n    if (!item.children) return false;\n    return location.startsWith(item.href);\n  };\n\n  return (\n    <aside className=\"w-64 bg-white shadow-sm border-r border-gray-200 fixed h-full overflow-y-auto\">\n      {/* Logo */}\n      <div className=\"p-6 border-b border-gray-100\">\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center\">\n            <GraduationCap className=\"h-5 w-5 text-white\" />\n          </div>\n          <span className=\"text-xl font-bold text-gray-900\">edmap</span>\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"mt-6\">\n        {Object.entries(groupedItems).map(([section, items]) => (\n          <div key={section} className=\"mb-8\">\n            <div className=\"px-4 mb-2\">\n              <h3 className=\"text-xs font-semibold text-gray-500 uppercase tracking-wide\">\n                {section === \"simulations\" ? \"Simulations\" : section === \"journey\" ? \"Job Journey\" : section === \"practice\" ? \"Practice\" : \"Account\"}\n              </h3>\n            </div>\n            \n            {items.map((item) => {\n              const Icon = item.icon;\n              const isActive = getIsActive(item);\n              const isExpanded = shouldExpand(item);\n              \n              return (\n                <div key={item.href}>\n                  <Link\n                    href={item.href}\n                    className={cn(\n                      \"simulation-nav-item\",\n                      isActive && \"active\"\n                    )}\n                  >\n                    <Icon className={cn(\n                      \"w-4 h-4\",\n                      isActive ? \"text-blue-600\" : \"text-gray-500\"\n                    )} />\n                    <span>{item.title}</span>\n                  </Link>\n                  \n                  {/* Nested children - always visible when parent exists */}\n                  {item.children && (\n                    <div className=\"ml-4 border-l border-gray-200\">\n                      {item.children.map((child) => {\n                        const ChildIcon = child.icon;\n                        const isChildActive = location === child.href;\n                        \n                        return (\n                          <Link\n                            key={child.href}\n                            href={child.href}\n                            className={cn(\n                              \"simulation-nav-item pl-4 text-sm\",\n                              isChildActive && \"active\"\n                            )}\n                          >\n                            <ChildIcon className={cn(\n                              \"w-3.5 h-3.5\",\n                              isChildActive ? \"text-blue-600\" : \"text-gray-400\"\n                            )} />\n                            <span className={cn(\n                              isChildActive ? \"text-blue-600\" : \"text-gray-600\"\n                            )}>{child.title}</span>\n                          </Link>\n                        );\n                      })}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        ))}\n      </nav>\n    </aside>\n  );\n}\n","path":null,"size_bytes":6525,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/simulation/workspace-session.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  MessageSquare, \n  CheckSquare, \n  Users, \n  Send,\n  Coffee,\n  Code,\n  X\n} from \"lucide-react\";\n\ninterface WorkspaceSessionProps {\n  session: any;\n  onComplete: () => void;\n}\n\nexport default function WorkspaceSession({ session, onComplete }: WorkspaceSessionProps) {\n  const [message, setMessage] = useState(\"\");\n  const [activeChannel, setActiveChannel] = useState(\"team-chat\");\n  const [isOnboarding, setIsOnboarding] = useState(session.configuration.sprintPhase === 'onboarding');\n  \n  const config = session.configuration;\n  const teamMembers = config.teamMembers || [];\n\n  // Fetch tasks\n  const { data: tasks = [], refetch: refetchTasks } = useQuery({\n    queryKey: [`/api/workspace/${session.id}/tasks`],\n    enabled: !!session.id,\n  });\n\n  // Fetch interactions (chat messages)\n  const { data: interactions = [], refetch: refetchInteractions } = useQuery({\n    queryKey: [`/api/workspace/${session.id}/interactions`],\n    enabled: !!session.id,\n  });\n\n  // Send message mutation\n  const sendMessageMutation = useMutation({\n    mutationFn: async (content: string) => {\n      const response = await apiRequest(\"POST\", `/api/workspace/${session.id}/action`, {\n        type: 'send-message',\n        channel: activeChannel,\n        data: { content }\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchInteractions();\n      setMessage(\"\");\n    },\n  });\n\n  // Update task mutation\n  const updateTaskMutation = useMutation({\n    mutationFn: async ({ taskId, updates }: { taskId: number; updates: any }) => {\n      const response = await apiRequest(\"PATCH\", `/api/workspace/tasks/${taskId}`, updates);\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchTasks();\n    },\n  });\n\n  // Complete onboarding\n  const completeOnboardingMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"PATCH\", `/api/sessions/${session.id}`, {\n        configuration: { ...config, sprintPhase: 'sprint' }\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsOnboarding(false);\n      queryClient.invalidateQueries({ queryKey: [`/api/sessions/${session.id}`] });\n    },\n  });\n\n  const handleSendMessage = () => {\n    if (!message.trim()) return;\n    sendMessageMutation.mutate(message);\n  };\n\n  const handleTaskToggle = (taskId: number, currentStatus: string) => {\n    const newStatus = currentStatus === 'completed' ? 'in-progress' : 'completed';\n    updateTaskMutation.mutate({ taskId, updates: { status: newStatus } });\n  };\n\n  const getInitials = (name: string) => {\n    return name.split(' ').map(n => n[0]).join('').toUpperCase();\n  };\n\n  const getChannelName = (channel: string) => {\n    const names: Record<string, string> = {\n      'team-chat': '# team-chat',\n      'standup': '# daily-standup',\n      'code-review': '# code-reviews',\n      'general': '# general'\n    };\n    return names[channel] || channel;\n  };\n\n  // Onboarding view\n  if (isOnboarding) {\n    return (\n      <div className=\"p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Card>\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-2xl\">Welcome to {config.projectName}!</CardTitle>\n                  <CardDescription className=\"mt-2\">\n                    Get to know your team and understand the project goals\n                  </CardDescription>\n                </div>\n                <Button variant=\"ghost\" size=\"icon\" onClick={onComplete} data-testid=\"button-close-session\">\n                  <X className=\"h-5 w-5\" />\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div>\n                <h3 className=\"text-lg font-semibold mb-3\">Your Role</h3>\n                <div className=\"bg-blue-50 p-4 rounded-lg\">\n                  <p className=\"font-medium text-blue-900\">{config.activeRole}</p>\n                  <p className=\"text-sm text-blue-700 mt-1\">\n                    You'll be working on this project as a {config.activeRole}. Collaborate with your team to deliver high-quality work.\n                  </p>\n                </div>\n              </div>\n\n              <div>\n                <h3 className=\"text-lg font-semibold mb-3\">Meet Your Team</h3>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {teamMembers.map((member: any, idx: number) => (\n                    <div key={idx} className=\"border rounded-lg p-4\" data-testid={`team-member-${idx}`}>\n                      <div className=\"flex items-center space-x-3 mb-2\">\n                        <Avatar className=\"h-10 w-10\">\n                          <AvatarFallback className=\"bg-purple-100 text-purple-700\">\n                            {getInitials(member.name)}\n                          </AvatarFallback>\n                        </Avatar>\n                        <div>\n                          <p className=\"font-semibold\">{member.name}</p>\n                          <p className=\"text-sm text-gray-600\">{member.role}</p>\n                        </div>\n                      </div>\n                      <p className=\"text-sm text-gray-700 mb-2\">{member.personality}</p>\n                      <div className=\"flex flex-wrap gap-1\">\n                        {member.expertise?.slice(0, 3).map((skill: string) => (\n                          <Badge key={skill} variant=\"outline\" className=\"text-xs\">\n                            {skill}\n                          </Badge>\n                        ))}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"bg-gray-50 p-4 rounded-lg\">\n                <h4 className=\"font-semibold mb-2\"> Project Objective</h4>\n                <p className=\"text-gray-700\">\n                  Work with your team to complete the {config.projectName} project. \n                  You'll communicate through team chat, attend standups, and collaborate on tasks.\n                </p>\n              </div>\n\n              <Button \n                onClick={() => completeOnboardingMutation.mutate()}\n                disabled={completeOnboardingMutation.isPending}\n                className=\"w-full\"\n                data-testid=\"button-start-working\"\n              >\n                {completeOnboardingMutation.isPending ? 'Starting...' : 'Start Working with Team'}\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  // Main workspace view\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6 flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold\">{config.projectName}</h2>\n            <p className=\"text-gray-600\">Your role: {config.activeRole}</p>\n          </div>\n          <Button variant=\"outline\" onClick={onComplete} data-testid=\"button-end-session\">\n            End Session\n          </Button>\n        </div>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          {/* Left sidebar - Team & Tasks */}\n          <div className=\"space-y-6\">\n            {/* Team Members */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-base\">\n                  <Users className=\"h-4 w-4 mr-2\" />\n                  Team\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-3\">\n                  {teamMembers.map((member: any, idx: number) => (\n                    <div key={idx} className=\"flex items-center space-x-2\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarFallback className=\"bg-purple-100 text-purple-700 text-xs\">\n                          {getInitials(member.name)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\">{member.name}</p>\n                        <p className=\"text-xs text-gray-500 truncate\">{member.role}</p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Tasks */}\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-base\">\n                  <CheckSquare className=\"h-4 w-4 mr-2\" />\n                  Tasks\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                {(tasks as any[]).length === 0 ? (\n                  <p className=\"text-sm text-gray-500\">No tasks yet. Start chatting with your team!</p>\n                ) : (\n                  <div className=\"space-y-2\">\n                    {(tasks as any[]).map((task: any) => (\n                      <div key={task.id} className=\"flex items-start space-x-2 p-2 border rounded\" data-testid={`task-${task.id}`}>\n                        <Checkbox\n                          checked={task.status === 'completed'}\n                          onCheckedChange={() => handleTaskToggle(task.id, task.status)}\n                          className=\"mt-0.5\"\n                        />\n                        <div className=\"flex-1\">\n                          <p className={`text-sm ${task.status === 'completed' ? 'line-through text-gray-500' : ''}`}>\n                            {task.title}\n                          </p>\n                          <Badge variant=\"outline\" className=\"text-xs mt-1\">\n                            {task.status}\n                          </Badge>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n\n          {/* Main content - Chat */}\n          <div className=\"lg:col-span-2\">\n            <Card className=\"h-[600px] flex flex-col\">\n              <CardHeader className=\"pb-3\">\n                <div className=\"flex items-center justify-between\">\n                  <CardTitle className=\"flex items-center text-base\">\n                    <MessageSquare className=\"h-4 w-4 mr-2\" />\n                    {getChannelName(activeChannel)}\n                  </CardTitle>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      variant={activeChannel === 'team-chat' ? 'default' : 'ghost'}\n                      size=\"sm\"\n                      onClick={() => setActiveChannel('team-chat')}\n                      data-testid=\"channel-team-chat\"\n                    >\n                      <MessageSquare className=\"h-4 w-4 mr-1\" />\n                      Chat\n                    </Button>\n                    <Button\n                      variant={activeChannel === 'standup' ? 'default' : 'ghost'}\n                      size=\"sm\"\n                      onClick={() => setActiveChannel('standup')}\n                      data-testid=\"channel-standup\"\n                    >\n                      <Coffee className=\"h-4 w-4 mr-1\" />\n                      Standup\n                    </Button>\n                    <Button\n                      variant={activeChannel === 'code-review' ? 'default' : 'ghost'}\n                      size=\"sm\"\n                      onClick={() => setActiveChannel('code-review')}\n                      data-testid=\"channel-code-review\"\n                    >\n                      <Code className=\"h-4 w-4 mr-1\" />\n                      Reviews\n                    </Button>\n                  </div>\n                </div>\n              </CardHeader>\n              \n              <CardContent className=\"flex-1 flex flex-col p-0\">\n                {/* Messages */}\n                <ScrollArea className=\"flex-1 p-4\">\n                  {(interactions as any[])\n                    .filter((int: any) => int.channel === activeChannel)\n                    .length === 0 ? (\n                    <div className=\"text-center py-12\">\n                      <MessageSquare className=\"h-12 w-12 text-gray-300 mx-auto mb-3\" />\n                      <p className=\"text-gray-500\">No messages yet. Start the conversation!</p>\n                    </div>\n                  ) : (\n                    <div className=\"space-y-4\">\n                      {(interactions as any[])\n                        .filter((int: any) => int.channel === activeChannel)\n                        .map((interaction: any) => (\n                          <div key={interaction.id} className=\"flex items-start space-x-3\" data-testid={`message-${interaction.id}`}>\n                            <Avatar className=\"h-8 w-8\">\n                              <AvatarFallback className={\n                                interaction.sender === 'User' \n                                  ? 'bg-blue-100 text-blue-700' \n                                  : 'bg-purple-100 text-purple-700'\n                              }>\n                                {getInitials(interaction.sender)}\n                              </AvatarFallback>\n                            </Avatar>\n                            <div className=\"flex-1\">\n                              <div className=\"flex items-baseline space-x-2\">\n                                <span className=\"font-semibold text-sm\">{interaction.sender}</span>\n                                <span className=\"text-xs text-gray-500\">{interaction.senderRole}</span>\n                                <span className=\"text-xs text-gray-400\">\n                                  {interaction.timestamp \n                                    ? new Date(interaction.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })\n                                    : 'just now'}\n                                </span>\n                              </div>\n                              <p className=\"text-sm text-gray-700 mt-1\">{interaction.content}</p>\n                            </div>\n                          </div>\n                        ))}\n                    </div>\n                  )}\n                </ScrollArea>\n\n                {/* Message input */}\n                <div className=\"p-4 border-t\">\n                  <div className=\"flex space-x-2\">\n                    <Input\n                      placeholder={`Message ${getChannelName(activeChannel)}...`}\n                      value={message}\n                      onChange={(e) => setMessage(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter' && !e.shiftKey) {\n                          e.preventDefault();\n                          handleSendMessage();\n                        }\n                      }}\n                      disabled={sendMessageMutation.isPending}\n                      data-testid=\"input-message\"\n                    />\n                    <Button \n                      onClick={handleSendMessage}\n                      disabled={!message.trim() || sendMessageMutation.isPending}\n                      data-testid=\"button-send-message\"\n                    >\n                      <Send className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                  <p className=\"text-xs text-gray-500 mt-2\">\n                    Press Enter to send, Shift+Enter for new line\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":16328,"size_tokens":null},"client/src/components/simulation/workspace-dashboard.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { \n  BarChart3, \n  Clock, \n  TrendingUp, \n  Award, \n  Code, \n  Briefcase, \n  Palette, \n  TestTube, \n  Server,\n  CheckCircle2,\n  PlayCircle,\n  Users,\n  Target\n} from \"lucide-react\";\n\ninterface WorkspaceDashboardProps {\n  userId: number;\n  onResumeSession?: (session: any) => void;\n  onStartNew?: () => void;\n}\n\nexport default function WorkspaceDashboard({ userId, onResumeSession, onStartNew }: WorkspaceDashboardProps) {\n  const { data: sessions, isLoading: sessionsLoading } = useQuery({\n    queryKey: ['/api/user', userId, 'sessions'],\n  });\n\n  const { data: progress, isLoading: progressLoading } = useQuery({\n    queryKey: ['/api/user', userId, 'progress'],\n  });\n\n  const sessionsArray = Array.isArray(sessions) ? sessions : [];\n  const progressArray = Array.isArray(progress) ? progress : [];\n  \n  const workspaceSessions = sessionsArray.filter((s: any) => s.type === 'workspace');\n  const activeSessions = workspaceSessions.filter((s: any) => s.status === 'active');\n  const completedSessions = workspaceSessions.filter((s: any) => s.status === 'completed');\n  const workspaceProgress = progressArray.find((p: any) => p.simulationType === 'workspace');\n\n  const getRoleIcon = (roleName: string) => {\n    const icons: Record<string, any> = {\n      'Developer': Code,\n      'Product Manager': Briefcase,\n      'Designer': Palette,\n      'QA Engineer': TestTube,\n      'DevOps Engineer': Server\n    };\n    return icons[roleName] || Code;\n  };\n\n  const getStatusColor = (status: string) => {\n    const colors: Record<string, string> = {\n      'active': 'bg-green-100 text-green-800',\n      'completed': 'bg-blue-100 text-blue-800',\n      'paused': 'bg-yellow-100 text-yellow-800'\n    };\n    return colors[status] || 'bg-gray-100 text-gray-800';\n  };\n\n  const calculateCompletionRate = () => {\n    if (!workspaceProgress) return 0;\n    const total = workspaceProgress.totalSessions || 0;\n    const completed = workspaceProgress.completedSessions || 0;\n    return total > 0 ? Math.round((completed / total) * 100) : 0;\n  };\n\n  if (sessionsLoading || progressLoading) {\n    return (\n      <div className=\"text-center py-12\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n        <p className=\"mt-4 text-gray-600\">Loading dashboard...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Hero Metrics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n        <Card data-testid=\"metric-total-sessions\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Total Sessions</p>\n                <p className=\"text-4xl font-bold text-gray-900 mt-2\">\n                  {workspaceProgress?.totalSessions || 0}\n                </p>\n              </div>\n              <div className=\"p-3 bg-blue-100 rounded-lg\">\n                <BarChart3 className=\"h-8 w-8 text-blue-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"metric-completed\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Completed</p>\n                <p className=\"text-4xl font-bold text-gray-900 mt-2\">\n                  {workspaceProgress?.completedSessions || 0}\n                </p>\n              </div>\n              <div className=\"p-3 bg-green-100 rounded-lg\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"metric-avg-score\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Avg Score</p>\n                <p className=\"text-4xl font-bold text-gray-900 mt-2\">\n                  {workspaceProgress?.averageScore || 0}\n                </p>\n              </div>\n              <div className=\"p-3 bg-purple-100 rounded-lg\">\n                <Award className=\"h-8 w-8 text-purple-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"metric-time-spent\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium text-gray-600 uppercase tracking-wide\">Time Spent</p>\n                <p className=\"text-4xl font-bold text-gray-900 mt-2\">\n                  {workspaceProgress?.timeSpent || 0}\n                  <span className=\"text-lg text-gray-600 ml-1\">min</span>\n                </p>\n              </div>\n              <div className=\"p-3 bg-orange-100 rounded-lg\">\n                <Clock className=\"h-8 w-8 text-orange-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Active Sessions - 2/3 width */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          <Card data-testid=\"card-active-sessions\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <CardTitle className=\"text-xl\">Active Sessions</CardTitle>\n                  <CardDescription>Continue your ongoing workspace simulations</CardDescription>\n                </div>\n                <Button \n                  onClick={onStartNew}\n                  size=\"sm\"\n                  data-testid=\"button-start-new\"\n                >\n                  <PlayCircle className=\"h-4 w-4 mr-2\" />\n                  Start New\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              {activeSessions.length === 0 ? (\n                <div className=\"text-center py-8\" data-testid=\"empty-active-sessions\">\n                  <Target className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                  <p className=\"text-gray-600\">No active sessions</p>\n                  <p className=\"text-sm text-gray-500 mt-1\">Start a new workspace simulation to begin practicing</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {activeSessions.map((session: any) => (\n                    <div \n                      key={session.id}\n                      className=\"border rounded-lg p-4 hover:border-blue-500 transition-colors\"\n                      data-testid={`session-active-${session.id}`}\n                    >\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900\">\n                            {session.configuration?.projectName || 'Workspace Project'}\n                          </h4>\n                          <div className=\"flex items-center gap-2 mt-1\">\n                            <Badge className={getStatusColor(session.status)}>\n                              {session.status}\n                            </Badge>\n                            {session.configuration?.activeRole && (() => {\n                              const Icon = getRoleIcon(session.configuration.activeRole);\n                              return (\n                                <div className=\"flex items-center text-sm text-gray-600\">\n                                  <Icon className=\"h-3 w-3 mr-1\" />\n                                  <span>{session.configuration.activeRole}</span>\n                                </div>\n                              );\n                            })()}\n                          </div>\n                        </div>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => onResumeSession?.(session)}\n                          data-testid={`button-resume-${session.id}`}\n                        >\n                          Resume\n                        </Button>\n                      </div>\n                      \n                      <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n                        <div className=\"flex items-center\">\n                          <Users className=\"h-4 w-4 mr-1\" />\n                          <span>{session.configuration?.teamMembers?.length || 0} team members</span>\n                        </div>\n                        <div className=\"flex items-center\">\n                          <Clock className=\"h-4 w-4 mr-1\" />\n                          <span>Started {new Date(session.createdAt).toLocaleDateString()}</span>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-recent-sessions\">\n            <CardHeader>\n              <CardTitle className=\"text-xl\">Recent Completions</CardTitle>\n              <CardDescription>Your recently completed workspace simulations</CardDescription>\n            </CardHeader>\n            <CardContent>\n              {completedSessions.length === 0 ? (\n                <div className=\"text-center py-8\" data-testid=\"empty-completed-sessions\">\n                  <CheckCircle2 className=\"h-12 w-12 text-gray-400 mx-auto mb-3\" />\n                  <p className=\"text-gray-600\">No completed sessions yet</p>\n                  <p className=\"text-sm text-gray-500 mt-1\">Complete your first simulation to see it here</p>\n                </div>\n              ) : (\n                <div className=\"space-y-3\">\n                  {completedSessions.slice(0, 5).map((session: any) => (\n                    <div \n                      key={session.id}\n                      className=\"border-b last:border-b-0 pb-3 last:pb-0\"\n                      data-testid={`session-completed-${session.id}`}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <p className=\"font-medium text-gray-900\">\n                            {session.configuration?.projectName || 'Workspace Project'}\n                          </p>\n                          <div className=\"flex items-center gap-2 mt-1\">\n                            {session.configuration?.activeRole && (() => {\n                              const Icon = getRoleIcon(session.configuration.activeRole);\n                              return (\n                                <div className=\"flex items-center text-sm text-gray-600\">\n                                  <Icon className=\"h-3 w-3 mr-1\" />\n                                  <span>{session.configuration.activeRole}</span>\n                                </div>\n                              );\n                            })()}\n                            <span className=\"text-sm text-gray-500\">\n                               {new Date(session.updatedAt).toLocaleDateString()}\n                            </span>\n                          </div>\n                        </div>\n                        <Badge variant=\"outline\" className=\"bg-green-50\">\n                          <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                          Completed\n                        </Badge>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Sidebar - 1/3 width */}\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-completion-rate\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Completion Rate</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-center\">\n                <div className=\"relative inline-flex items-center justify-center\">\n                  <svg className=\"w-32 h-32 transform -rotate-90\">\n                    <circle\n                      cx=\"64\"\n                      cy=\"64\"\n                      r=\"56\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"8\"\n                      fill=\"none\"\n                      className=\"text-gray-200\"\n                    />\n                    <circle\n                      cx=\"64\"\n                      cy=\"64\"\n                      r=\"56\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"8\"\n                      fill=\"none\"\n                      strokeDasharray={`${2 * Math.PI * 56}`}\n                      strokeDashoffset={`${2 * Math.PI * 56 * (1 - calculateCompletionRate() / 100)}`}\n                      className=\"text-blue-600 transition-all duration-500\"\n                    />\n                  </svg>\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <span className=\"text-3xl font-bold text-gray-900\">{calculateCompletionRate()}%</span>\n                  </div>\n                </div>\n                <p className=\"text-sm text-gray-600 mt-4\">\n                  {workspaceProgress?.completedSessions || 0} of {workspaceProgress?.totalSessions || 0} sessions completed\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-performance-metrics\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Performance Metrics</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div data-testid=\"metric-collaboration\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-700\">Collaboration</span>\n                  <span className=\"text-sm font-semibold text-gray-900\">\n                    {workspaceProgress?.metrics?.collaboration || 0}/100\n                  </span>\n                </div>\n                <Progress value={workspaceProgress?.metrics?.collaboration || 0} className=\"h-2\" />\n              </div>\n\n              <div data-testid=\"metric-communication\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-700\">Communication</span>\n                  <span className=\"text-sm font-semibold text-gray-900\">\n                    {workspaceProgress?.metrics?.communication || 0}/100\n                  </span>\n                </div>\n                <Progress value={workspaceProgress?.metrics?.communication || 0} className=\"h-2\" />\n              </div>\n\n              <div data-testid=\"metric-delivery\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-700\">Delivery</span>\n                  <span className=\"text-sm font-semibold text-gray-900\">\n                    {workspaceProgress?.metrics?.delivery || 0}/100\n                  </span>\n                </div>\n                <Progress value={workspaceProgress?.metrics?.delivery || 0} className=\"h-2\" />\n              </div>\n\n              <div data-testid=\"metric-technical\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-700\">Technical Skills</span>\n                  <span className=\"text-sm font-semibold text-gray-900\">\n                    {workspaceProgress?.metrics?.technical || 0}/100\n                  </span>\n                </div>\n                <Progress value={workspaceProgress?.metrics?.technical || 0} className=\"h-2\" />\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-quick-stats\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Quick Stats</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-gray-600\">Active Projects</span>\n                <span className=\"text-lg font-semibold text-gray-900\">{activeSessions.length}</span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-gray-600\">Total Completions</span>\n                <span className=\"text-lg font-semibold text-gray-900\">\n                  {workspaceProgress?.completedSessions || 0}\n                </span>\n              </div>\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm text-gray-600\">Streak</span>\n                <span className=\"text-lg font-semibold text-gray-900\">\n                  {workspaceProgress?.streak || 0} days\n                </span>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17517,"size_tokens":null},"design_guidelines.md":{"content":"# EdMap B2B Onboarding Platform - Design Guidelines\n\n## Design Approach\n**System**: Hybrid combining Linear's clean modernism, Notion's structured hierarchy, and Stripe's professional restraint. Journey-focused interface emphasizing progression and milestone achievements.\n\n**Key Principles**: Clear state transitions, celebration moments at milestones, visual continuity across application-to-onboarding flow.\n\n## Typography System\n**Primary Font**: Inter via Google Fonts\n- Journey Headers: 3xl to 4xl, font-bold\n- Stage Titles: xl to 2xl, font-semibold\n- Card Titles: base to lg, font-medium\n- Status Text: sm to base, font-normal\n- Labels/Metadata: xs to sm, font-medium, uppercase tracking-wide\n- Celebration Headlines: 4xl to 5xl, font-extrabold\n\n## Layout Architecture\n**Container System**: max-w-7xl mx-auto with px-6 to px-8\n**Spacing Primitives**: Tailwind units of 2, 4, 6, 8, 12, 16\n- Card padding: p-6 to p-8\n- Section gaps: gap-6 to gap-8\n- Journey step spacing: space-y-8\n\n## Journey Flow Architecture\n\n### Header Navigation\n**Sticky header** (h-16) with:\n- Left: \"EdMap\" logo + Journey breadcrumb (\"Application  Onboarding\")\n- Center: Progress indicator showing overall journey stage (Interview/Negotiation/Offer/Onboarding)\n- Right: Notifications + User avatar + Help icon\n\n### Journey Progress Visualization\n**Horizontal stepper component** positioned below header (py-6):\n- 4 connected steps with circular nodes\n- States: Completed (checkmark), Active (pulse ring), Upcoming (outlined)\n- Steps: \"Apply\"  \"Interview\"  \"Offer\"  \"Onboarding\"\n- Line connectors between nodes with gradient fill showing progress\n- Current step highlighted with larger node + label below\n\n### Application Details View\n\n**Two-column layout** (grid-cols-3):\n\n**Left Column (col-span-2)**: \n- Interview Stages Card:\n  - Stage list with expandable accordion items\n  - Each stage: Badge status + Date + Interviewer name + Notes section\n  - Stage 1: Technical Interview (completed checkmark)\n  - Stage 2: Behavioral Interview (in-progress spinner or completed)\n  - Feedback display area with avatar of interviewer + rating stars\n\n- Offer Negotiation Card (appears after interviews):\n  - Salary slider with current vs offered amounts\n  - Benefits checklist with toggle states\n  - Counteroffer form (text area + \"Submit Counteroffer\" button)\n  - Negotiation history timeline with back-and-forth exchanges\n  - Final offer badge when settled\n\n**Right Column (col-span-1)**:\n- Application Summary sticky card:\n  - Company logo + name\n  - Position title\n  - Key details list (Location, Start Date, Salary)\n  - Current Status badge (large, prominent)\n  \n- Timeline Activity Feed:\n  - Vertical timeline with dot indicators\n  - Recent actions with timestamps\n  - Auto-updates as stages progress\n\n### Milestone Celebration Modal\n\n**Triggered on offer acceptance**:\n- Full-screen overlay with backdrop blur\n- Center card (max-w-2xl):\n  - Confetti animation background (CSS particles or lottie)\n  - Large congratulatory headline \"Offer Accepted! \"\n  - Company logo + position title\n  - Brief celebratory message\n  - Start date prominently displayed\n  - Primary CTA: \"Start Onboarding Journey\" (large, h-14, w-full)\n  - Secondary link: \"Review Offer Details\"\n- Auto-dismiss after 8 seconds or user action\n\n### Onboarding Transition Screen\n\n**Bridge page between acceptance and workspace**:\n- Hero section with illustration:\n  - Welcome headline \"Welcome to [Company Name]!\"\n  - Subtitle \"Let's get you ready for day one\"\n  - Supporting text about onboarding process\n  \n- Onboarding Checklist Preview (3-column grid):\n  - Pre-start tasks card (Documents, Equipment, Access)\n  - Week 1 plan card (Orientation schedule, Team introductions)\n  - Resources card (Handbook links, Contact info)\n  \n- Prominent \"Enter Workspace Simulator\" button (h-16, centered)\n\n### Workspace Simulator Dashboard\n*Inherits from existing dashboard guidelines*:\n- Welcome banner with personalized greeting + days until start\n- Quick-start simulation cards\n- Integration with training modules\n\n## Component Specifications\n\n### Journey Step Node\n- Circle: h-12 w-12, rounded-full\n- Active state: ring-4 with pulse animation\n- Completed: Checkmark icon inside\n- Connector line: h-0.5 between nodes\n\n### Status Badges\n- Pill shape: rounded-full px-4 py-1.5\n- States: Scheduled, In Progress, Completed, Pending Review, Accepted, Declined\n- Size variants: sm (text-xs) and lg (text-sm font-semibold)\n\n### Interview Stage Card\n- Accordion pattern with chevron icon\n- Collapsed: Shows stage name + status + date (h-16)\n- Expanded: Reveals feedback area, notes, action buttons\n- Border-left accent color indicates status\n\n### Offer Card\n- Prominent display: border-2 with shadow-lg\n- Salary comparison: Two columns (Current vs Offered)\n- Accept/Decline buttons: Full-width split layout (grid-cols-2 gap-4)\n- Accept button: Primary style (h-12)\n- Decline button: Secondary/outline style\n\n### Celebration Elements\n- Modal backdrop: backdrop-blur-md with semi-transparent background\n- Confetti: CSS animation or minimal library\n- Success icons: Large (h-24 w-24), celebratory colors\n- CTA buttons in celebration: Extra-large (h-14 text-lg font-semibold)\n\n## Images Section\n\n**Hero Image**: YES - Onboarding transition screen\n- Placement: Full-width hero on transition screen\n- Description: Professional workspace environment or team collaboration scene with welcoming atmosphere\n- Treatment: Subtle gradient overlay from bottom for text readability\n- Size: h-96 on desktop, h-64 on mobile\n- Buttons on image: Use backdrop-blur-md background on CTA button\n\n**Supporting Images**:\n- Company logos: Throughout journey (h-16 w-16, rounded-lg)\n- Interviewer avatars: Circular (h-12 w-12), shown in feedback sections\n- Empty state illustrations: When no interviews scheduled (centered, max-w-sm)\n- Celebration graphics: Abstract geometric shapes or minimal 3D elements in modals\n\n## Accessibility\n- Journey progress: aria-current on active step, aria-label descriptions\n- Modal focus trap: Lock focus within celebration modal\n- Button minimum: h-11 touch targets\n- Keyboard navigation: Tab through interview stages, offer actions\n- Status announcements: Use aria-live for progress updates\n\n## Responsive Behavior\n- Desktop (lg+): Two-column layout, horizontal stepper\n- Tablet (md): Single column, stepper stays horizontal but scales\n- Mobile: Stack all cards, stepper converts to vertical timeline (left-aligned)\n- Modal: Full-screen on mobile with slide-up animation\n\n## Micro-interactions\n- Step completion: Checkmark draw animation (500ms)\n- Offer acceptance: Button transforms to checkmark with scale animation\n- Card reveals: Stagger fade-in when transitioning between views (100ms delay each)\n- Progress bar: Smooth width transition (transition-all duration-700)\n- Modal entrance: Scale + fade (scale-95 to scale-100, 300ms)\n\n**Animation philosophy**: Purposeful feedback at milestone moments onlyno gratuitous effects during standard navigation.","path":null,"size_bytes":7005,"size_tokens":null},"client/src/components/simulation/enterprise-feature-session.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Send, \n  CheckCircle2, \n  Clock, \n  Target,\n  Users,\n  FileCode,\n  MessageSquare,\n  ChevronRight,\n  AtSign\n} from \"lucide-react\";\nimport CodebaseExplorer from \"./codebase-explorer\";\n\ninterface EnterpriseFeatureSessionProps {\n  session: any;\n  project: any;\n  onComplete: () => void;\n}\n\nexport default function EnterpriseFeatureSession({ session, project, onComplete }: EnterpriseFeatureSessionProps) {\n  const [message, setMessage] = useState(\"\");\n  const [currentPhase, setCurrentPhase] = useState<string>(\"onboarding\");\n  const [phaseStartTime, setPhaseStartTime] = useState<Date>(new Date());\n  const [showMentionMenu, setShowMentionMenu] = useState(false);\n  const [mentionSearch, setMentionSearch] = useState(\"\");\n  const [mentionCursorPos, setMentionCursorPos] = useState(0);\n  const [typingIndicator, setTypingIndicator] = useState<string | null>(null);\n  const [userIsTyping, setUserIsTyping] = useState(false);\n  const [completedObjectives, setCompletedObjectives] = useState<Record<string, boolean[]>>({});\n  const [activeChannel, setActiveChannel] = useState<string>(\"team-chat\");\n  const [openDMs, setOpenDMs] = useState<string[]>([]);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const typingTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const requirements = project.requirements || {};\n  const phases = requirements.phases || [];\n  const existingProduct = requirements.existingProduct || {};\n  const featureRequest = requirements.featureRequest || {};\n  const productDocumentation = requirements.productDocumentation || {};\n  const simulatedCodebase = requirements.simulatedCodebase || { structure: {}, keyFiles: [] };\n  const scenarioScript = project.scenarioScript || {};\n\n  const currentPhaseData = phases.find((p: any) => p.name === currentPhase) || phases[0];\n  const currentPhaseIndex = phases.findIndex((p: any) => p.name === currentPhase);\n  const progressPercentage = ((currentPhaseIndex + 1) / phases.length) * 100;\n  \n  // Phase guidance for different roles\n  const phaseGuidance: Record<string, { description: string; tips: string[] }> = {\n    onboarding: {\n      description: \"Welcome! Get familiar with the team, codebase, and feature requirements.\",\n      tips: [\n        \"Review the feature requirements and acceptance criteria in the Requirements tab\",\n        \"Explore the codebase structure in the Codebase tab to understand the architecture\",\n        \"Chat with your teammates to ask questions and introduce yourself\",\n        \"Check off objectives as you complete them to track your progress\"\n      ]\n    },\n    planning: {\n      description: \"Break down the feature into concrete tasks and align with the team.\",\n      tips: [\n        \"Discuss the technical approach with Ravi (Backend Lead) and Maya (Frontend)\",\n        \"Ask about potential risks, dependencies, or architectural decisions\",\n        \"For PMs: Define milestones and coordinate the sprint plan\",\n        \"For Developers: Identify which files need changes and what APIs to create\",\n        \"Check off objectives once you've discussed them with the team\"\n      ]\n    },\n    implementation: {\n      description: \"Build the feature by collaborating with your team.\",\n      tips: [\n        \"For Developers: Discuss code implementation details with technical teammates\",\n        \"For PMs: Check in on progress, unblock dependencies, and coordinate with stakeholders\",\n        \"Share your work-in-progress and ask for feedback\",\n        \"Document key decisions and update the team on your progress\",\n        \"This phase typically takes the longest - work through each objective systematically\"\n      ]\n    },\n    review: {\n      description: \"Get feedback from teammates and refine your work.\",\n      tips: [\n        \"Share your completed work with the team for review\",\n        \"For Developers: Ask Elena (QA) about testing and Ravi about code review\",\n        \"For PMs: Coordinate final sign-offs and ensure acceptance criteria are met\",\n        \"Address any feedback or questions from teammates\",\n        \"Ensure all deliverables are ready before moving to release\"\n      ]\n    },\n    release: {\n      description: \"Deploy the feature and wrap up the sprint.\",\n      tips: [\n        \"Coordinate with Luis (DevOps) on deployment process\",\n        \"Participate in sprint retrospective to reflect on what went well\",\n        \"Share key learnings and celebrate the team's success\",\n        \"You'll receive a performance evaluation based on your collaboration and communication\"\n      ]\n    }\n  };\n  \n  const currentGuidance = phaseGuidance[currentPhase] || phaseGuidance.onboarding;\n  const phaseObjectives = completedObjectives[currentPhase] || [];\n  const objectivesCompleted = phaseObjectives.filter(Boolean).length;\n  const totalObjectives = currentPhaseData?.objectives?.length || 0;\n  const canAdvancePhase = objectivesCompleted >= Math.ceil(totalObjectives * 0.5); // At least 50% complete\n\n  // Fetch interactions for current session\n  const { data: interactions, isLoading: interactionsLoading } = useQuery({\n    queryKey: ['/api/workspace', session.id, 'interactions'],\n    queryFn: () => fetch(`/api/workspace/${session.id}/interactions`).then(res => res.json()),\n    refetchInterval: 2000\n  });\n\n  // Send message mutation\n  const sendMessageMutation = useMutation({\n    mutationFn: async (userMessage: string) => {\n      // Show typing indicator for the responding AI teammate\n      const teamMembers = project.teamStructure || [];\n      \n      // For DMs, show typing for specific member\n      if (activeChannel.startsWith('dm-')) {\n        const memberName = activeChannel.replace('dm-', '');\n        setTypingIndicator(memberName);\n      } else {\n        const randomMember = teamMembers[Math.floor(Math.random() * teamMembers.length)];\n        setTypingIndicator(randomMember?.name || \"Teammate\");\n      }\n      \n      const response = await apiRequest(\"POST\", `/api/workspace/${session.id}/action`, {\n        type: 'send-message',\n        channel: activeChannel === 'team-chat' ? getChannelForPhase(currentPhase) : activeChannel,\n        data: { content: userMessage }\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      setTypingIndicator(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n      setMessage(\"\");\n    },\n    onError: () => {\n      setTypingIndicator(null);\n    }\n  });\n\n  // Auto-trigger phase events when phase changes\n  useEffect(() => {\n    const phaseScript = scenarioScript.phases?.[currentPhase];\n    if (!phaseScript || !Array.isArray(phaseScript)) return;\n\n    const timers: NodeJS.Timeout[] = [];\n    let cumulativeDelay = 0;\n    \n    phaseScript.forEach((event: any, index: number) => {\n      // Add staggered delays (3-8 seconds apart) for more realistic timing\n      const baseDelay = 3000; // 3 seconds minimum\n      const randomDelay = Math.random() * 5000; // 0-5 seconds random\n      cumulativeDelay += baseDelay + randomDelay; // Total 3-8 seconds between messages\n      \n      const timer = setTimeout(async () => {\n        try {\n          await apiRequest(\"POST\", `/api/workspace/${session.id}/interactions`, {\n            sessionId: session.id,\n            channel: getChannelForPhase(currentPhase),\n            sender: event.from,\n            senderRole: project.teamStructure?.find((m: any) => m.name === event.from)?.role || 'Team Member',\n            content: event.message\n          });\n          queryClient.invalidateQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n        } catch (error) {\n          console.error('Failed to send auto message:', error);\n        }\n      }, cumulativeDelay);\n      timers.push(timer);\n    });\n\n    return () => {\n      timers.forEach(timer => clearTimeout(timer));\n    };\n  }, [currentPhase]);\n\n  function getChannelForPhase(phase: string): string {\n    const channelMap: Record<string, string> = {\n      'onboarding': 'team-chat',\n      'planning': 'standup',\n      'implementation': 'team-chat',\n      'review': 'code-reviews',\n      'release': 'team-chat'\n    };\n    return channelMap[phase] || 'team-chat';\n  }\n\n  function handleSendMessage() {\n    if (!message.trim() || sendMessageMutation.isPending) return;\n    sendMessageMutation.mutate(message);\n  }\n\n  function advancePhase() {\n    const nextPhaseIndex = currentPhaseIndex + 1;\n    if (nextPhaseIndex < phases.length) {\n      setCurrentPhase(phases[nextPhaseIndex].name);\n      setPhaseStartTime(new Date());\n    } else {\n      // Simulation complete\n      onComplete();\n    }\n  }\n\n  // Start or switch to DM with a team member\n  function startDM(memberName: string) {\n    const dmChannel = `dm-${memberName}`;\n    if (!openDMs.includes(dmChannel)) {\n      setOpenDMs([...openDMs, dmChannel]);\n    }\n    setActiveChannel(dmChannel);\n  }\n\n  // Auto-scroll to bottom when new messages arrive\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [interactions]);\n\n  // Cleanup timeouts on unmount\n  useEffect(() => {\n    return () => {\n      if (typingTimeoutRef.current) clearTimeout(typingTimeoutRef.current);\n    };\n  }, []);\n\n  // Handle message input changes and detect @ mentions\n  function handleMessageChange(e: React.ChangeEvent<HTMLTextAreaElement>) {\n    const value = e.target.value;\n    const cursorPos = e.target.selectionStart;\n    \n    setMessage(value);\n    \n    // User typing detection - hide typing indicator when user starts typing\n    if (value.length > 0 && !userIsTyping) {\n      setUserIsTyping(true);\n      setTypingIndicator(null); // Hide typing indicator when user starts typing\n    }\n    \n    // User stopped typing or cleared input\n    if (value.length === 0) {\n      setUserIsTyping(false);\n    }\n    \n    // Clear typing timeout\n    if (typingTimeoutRef.current) {\n      clearTimeout(typingTimeoutRef.current);\n    }\n    \n    // Set user as not typing after 2 seconds of inactivity\n    if (value.length > 0) {\n      typingTimeoutRef.current = setTimeout(() => {\n        setUserIsTyping(false);\n      }, 2000);\n    }\n    \n    // Check if we're typing an @ mention\n    const textBeforeCursor = value.substring(0, cursorPos);\n    const lastAtSymbol = textBeforeCursor.lastIndexOf('@');\n    \n    if (lastAtSymbol !== -1) {\n      const textAfterAt = textBeforeCursor.substring(lastAtSymbol + 1);\n      const hasSpace = textAfterAt.includes(' ');\n      \n      if (!hasSpace) {\n        setShowMentionMenu(true);\n        setMentionSearch(textAfterAt.toLowerCase());\n        setMentionCursorPos(lastAtSymbol);\n      } else {\n        setShowMentionMenu(false);\n      }\n    } else {\n      setShowMentionMenu(false);\n    }\n  }\n\n  // Insert mention when selected from dropdown\n  function insertMention(memberName: string) {\n    const beforeMention = message.substring(0, mentionCursorPos);\n    const afterMention = message.substring(mentionCursorPos + mentionSearch.length + 1);\n    const newMessage = `${beforeMention}@${memberName} ${afterMention}`;\n    \n    setMessage(newMessage);\n    setShowMentionMenu(false);\n    textareaRef.current?.focus();\n  }\n\n  // Toggle objective completion\n  function toggleObjective(index: number) {\n    setCompletedObjectives(prev => {\n      const phaseObjs = prev[currentPhase] || Array(totalObjectives).fill(false);\n      const updated = [...phaseObjs];\n      updated[index] = !updated[index];\n      return { ...prev, [currentPhase]: updated };\n    });\n  }\n  \n  // Initialize phase objectives when phase changes\n  useEffect(() => {\n    if (!completedObjectives[currentPhase] && totalObjectives > 0) {\n      setCompletedObjectives(prev => ({\n        ...prev,\n        [currentPhase]: Array(totalObjectives).fill(false)\n      }));\n    }\n  }, [currentPhase, totalObjectives]);\n\n  // Filter team members for mention autocomplete\n  const teamMembers = project.teamStructure || [];\n  const filteredMembers = showMentionMenu\n    ? teamMembers.filter((member: any) =>\n        member.name.toLowerCase().includes(mentionSearch)\n      )\n    : [];\n\n  // Filter interactions by active channel\n  const channelInteractions = Array.isArray(interactions)\n    ? interactions.filter((i: any) => {\n        if (activeChannel === 'team-chat') {\n          // For team chat, show messages from the current phase channel\n          const phaseChannel = getChannelForPhase(currentPhase);\n          return i.channel === phaseChannel;\n        } else {\n          // For DMs, show messages from that specific DM channel\n          return i.channel === activeChannel;\n        }\n      })\n    : [];\n\n  return (\n    <div className=\"h-screen flex flex-col bg-gray-50\">\n      {/* Header with Phase Progress */}\n      <div className=\"bg-white border-b px-6 py-4\">\n        <div className=\"max-w-screen-2xl mx-auto\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\" data-testid=\"text-session-title\">\n                {project.name}\n              </h1>\n              <p className=\"text-gray-600 text-sm mt-1\">{featureRequest.title || project.description}</p>\n            </div>\n            <Button\n              onClick={onComplete}\n              variant=\"outline\"\n              size=\"sm\"\n              data-testid=\"button-exit-session\"\n            >\n              Exit Simulation\n            </Button>\n          </div>\n\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between text-sm\">\n              <span className=\"font-medium text-gray-700\">\n                Phase {currentPhaseIndex + 1} of {phases.length}: {currentPhaseData?.name}\n              </span>\n              <span className=\"text-gray-500\">\n                {Math.round(progressPercentage)}% Complete\n              </span>\n            </div>\n            <Progress value={progressPercentage} className=\"h-2\" />\n            <div className=\"flex items-center gap-4 text-xs text-gray-600\">\n              {phases.map((phase: any, idx: number) => (\n                <div key={phase.name} className=\"flex items-center gap-1\">\n                  {idx < currentPhaseIndex ? (\n                    <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                  ) : idx === currentPhaseIndex ? (\n                    <Clock className=\"h-4 w-4 text-blue-600\" />\n                  ) : (\n                    <div className=\"h-4 w-4 rounded-full border-2 border-gray-300\" />\n                  )}\n                  <span className={idx === currentPhaseIndex ? 'font-medium' : ''}>\n                    {phase.name}\n                  </span>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Content */}\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full max-w-screen-2xl mx-auto px-6 py-6\">\n          <div className=\"h-full grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            {/* Left Sidebar - Phase Info & Team */}\n            <div className=\"lg:col-span-1 space-y-4 overflow-y-auto\">\n              {/* Phase Guidance */}\n              <Card data-testid=\"card-phase-guidance\" className=\"bg-blue-50 border-blue-200\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg flex items-center gap-2 text-blue-900\">\n                    <Target className=\"h-5 w-5\" />\n                    What to Do Now\n                  </CardTitle>\n                  <CardDescription className=\"text-blue-700\">\n                    {currentGuidance.description}\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2\">\n                    {currentGuidance.tips.map((tip: string, idx: number) => (\n                      <li key={idx} className=\"flex items-start gap-2 text-sm text-blue-900\">\n                        <span className=\"text-blue-600 font-bold mt-0.5\"></span>\n                        <span>{tip}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </CardContent>\n              </Card>\n              \n              {/* Phase Objectives with Checkboxes */}\n              <Card data-testid=\"card-phase-objectives\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-lg flex items-center gap-2\">\n                      <CheckCircle2 className=\"h-5 w-5\" />\n                      Objectives ({objectivesCompleted}/{totalObjectives})\n                    </CardTitle>\n                    {objectivesCompleted > 0 && (\n                      <span className=\"text-xs font-medium text-green-600\">\n                        {Math.round((objectivesCompleted / totalObjectives) * 100)}% complete\n                      </span>\n                    )}\n                  </div>\n                  <CardDescription>\n                    Check off objectives as you complete them\n                  </CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {currentPhaseData?.objectives?.map((obj: string, idx: number) => (\n                      <label\n                        key={idx}\n                        className=\"flex items-start gap-3 cursor-pointer hover:bg-gray-50 p-2 rounded transition-colors\"\n                        data-testid={`objective-${idx}`}\n                      >\n                        <input\n                          type=\"checkbox\"\n                          checked={phaseObjectives[idx] || false}\n                          onChange={() => toggleObjective(idx)}\n                          className=\"mt-0.5 h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer\"\n                          data-testid={`checkbox-objective-${idx}`}\n                        />\n                        <span className={`text-sm flex-1 ${phaseObjectives[idx] ? 'text-gray-500 line-through' : 'text-gray-700'}`}>\n                          {obj}\n                        </span>\n                      </label>\n                    ))}\n                  </div>\n                  <div className=\"mt-4 pt-4 border-t\">\n                    <h4 className=\"text-sm font-semibold text-gray-700 mb-2\">Deliverables</h4>\n                    <div className=\"space-y-1\">\n                      {currentPhaseData?.deliverables?.map((del: string, idx: number) => (\n                        <div key={idx} className=\"flex items-center gap-2\">\n                          <div className=\"h-1.5 w-1.5 rounded-full bg-blue-600\" />\n                          <span className=\"text-sm text-gray-600\">{del}</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card data-testid=\"card-team-members\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    <Users className=\"h-5 w-5\" />\n                    Your Team\n                  </CardTitle>\n                  <CardDescription className=\"text-xs\">Click to start a direct message</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-2\">\n                    {project.teamStructure?.map((member: any, idx: number) => (\n                      <button\n                        key={idx}\n                        onClick={() => startDM(member.name)}\n                        className={`w-full flex items-start gap-3 p-2 rounded-lg transition-colors hover:bg-blue-50 ${\n                          activeChannel === `dm-${member.name}` ? 'bg-blue-100 border border-blue-300' : ''\n                        }`}\n                        data-testid={`member-${idx}`}\n                      >\n                        <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                          <span className=\"text-sm font-medium text-blue-600\">\n                            {member.name.charAt(0)}\n                          </span>\n                        </div>\n                        <div className=\"flex-1 min-w-0 text-left\">\n                          <p className=\"text-sm font-medium text-gray-900\">{member.name}</p>\n                          <p className=\"text-xs text-gray-600\">{member.role}</p>\n                          <div className=\"flex flex-wrap gap-1 mt-1\">\n                            {member.expertise?.slice(0, 2).map((exp: string, i: number) => (\n                              <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                                {exp}\n                              </Badge>\n                            ))}\n                          </div>\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              {currentPhase !== 'release' && (\n                <Card data-testid=\"card-phase-progression\">\n                  <CardContent className=\"pt-6\">\n                    {canAdvancePhase ? (\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center gap-2 text-sm text-green-700 bg-green-50 px-3 py-2 rounded\">\n                          <CheckCircle2 className=\"h-4 w-4\" />\n                          <span className=\"font-medium\">Ready to advance!</span>\n                        </div>\n                        <Button\n                          onClick={advancePhase}\n                          className=\"w-full\"\n                          data-testid=\"button-next-phase\"\n                        >\n                          Complete {currentPhase.charAt(0).toUpperCase() + currentPhase.slice(1)} & Continue\n                          <ChevronRight className=\"h-4 w-4 ml-2\" />\n                        </Button>\n                      </div>\n                    ) : (\n                      <div className=\"space-y-3\">\n                        <div className=\"text-sm text-gray-600 text-center\">\n                          Complete at least {Math.ceil(totalObjectives * 0.5)} objectives to continue\n                        </div>\n                        <Button\n                          disabled\n                          className=\"w-full\"\n                          data-testid=\"button-next-phase-disabled\"\n                        >\n                          Continue to Next Phase\n                        </Button>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n              )}\n            </div>\n\n            {/* Center - Main Content Area */}\n            <div className=\"lg:col-span-2 flex flex-col h-full overflow-hidden\">\n              <Tabs defaultValue=\"chat\" className=\"flex-1 flex flex-col overflow-hidden\">\n                <TabsList className=\"grid w-full grid-cols-3\">\n                  <TabsTrigger value=\"chat\" data-testid=\"tab-chat\">\n                    <MessageSquare className=\"h-4 w-4 mr-2\" />\n                    Team Chat\n                  </TabsTrigger>\n                  <TabsTrigger value=\"codebase\" data-testid=\"tab-codebase\">\n                    <FileCode className=\"h-4 w-4 mr-2\" />\n                    Codebase\n                  </TabsTrigger>\n                  <TabsTrigger value=\"requirements\" data-testid=\"tab-requirements\">\n                    <Target className=\"h-4 w-4 mr-2\" />\n                    Requirements\n                  </TabsTrigger>\n                </TabsList>\n\n                <TabsContent value=\"chat\" className=\"flex-1 flex flex-col mt-4 overflow-hidden\">\n                  <Card className=\"flex-1 flex flex-col overflow-hidden\">\n                    <CardHeader className=\"flex-shrink-0\">\n                      <div className=\"flex items-center gap-2 mb-3 overflow-x-auto\">\n                        <Button\n                          variant={activeChannel === 'team-chat' ? 'default' : 'outline'}\n                          size=\"sm\"\n                          onClick={() => setActiveChannel('team-chat')}\n                          data-testid=\"button-team-chat\"\n                        >\n                          <MessageSquare className=\"h-3 w-3 mr-1\" />\n                          Team Chat\n                        </Button>\n                        {openDMs.map((dmChannel) => {\n                          const memberName = dmChannel.replace('dm-', '');\n                          return (\n                            <Button\n                              key={dmChannel}\n                              variant={activeChannel === dmChannel ? 'default' : 'outline'}\n                              size=\"sm\"\n                              onClick={() => setActiveChannel(dmChannel)}\n                              data-testid={`button-dm-${memberName}`}\n                            >\n                              <AtSign className=\"h-3 w-3 mr-1\" />\n                              {memberName}\n                            </Button>\n                          );\n                        })}\n                      </div>\n                      <CardTitle className=\"text-lg\">\n                        {activeChannel === 'team-chat' ? 'Team Chat' : `DM with ${activeChannel.replace('dm-', '')}`}\n                      </CardTitle>\n                      <CardDescription>\n                        {activeChannel === 'team-chat' ? 'Collaborate with your AI teammates' : 'Private conversation'}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent className=\"flex-1 flex flex-col overflow-hidden p-0\">\n                      <div className=\"flex-1 overflow-y-auto p-6 space-y-4\" data-testid=\"chat-messages\">\n                        {interactionsLoading ? (\n                          <div className=\"text-center py-8 text-gray-500\">Loading messages...</div>\n                        ) : channelInteractions.length === 0 ? (\n                          <div className=\"text-center py-8 text-gray-500\">\n                            <MessageSquare className=\"h-12 w-12 mx-auto mb-3 text-gray-400\" />\n                            <p>No messages yet. Start the conversation!</p>\n                          </div>\n                        ) : (\n                          <>\n                            {channelInteractions.map((interaction: any) => {\n                              const isUser = interaction.sender === 'User' || interaction.sender === 'user';\n                              return (\n                                <div\n                                  key={interaction.id}\n                                  className={`flex gap-3 ${\n                                    isUser ? 'flex-row-reverse' : ''\n                                  }`}\n                                  data-testid={`message-${interaction.id}`}\n                                >\n                                  <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                                    <span className=\"text-sm font-medium text-blue-600\">\n                                      {isUser ? 'U' : interaction.sender.charAt(0)}\n                                    </span>\n                                  </div>\n                                  <div\n                                    className={`flex-1 max-w-lg ${\n                                      isUser ? 'text-right' : ''\n                                    }`}\n                                  >\n                                    <div className=\"flex items-center gap-2 mb-1\">\n                                      <span className=\"text-sm font-medium text-gray-900\">\n                                        {isUser ? 'You' : interaction.sender}\n                                      </span>\n                                      <span className=\"text-xs text-gray-500\">{interaction.senderRole}</span>\n                                    </div>\n                                    <div\n                                      className={`inline-block rounded-lg px-4 py-2 ${\n                                        isUser\n                                          ? 'bg-blue-600 text-white'\n                                          : 'bg-gray-100 text-gray-900'\n                                      }`}\n                                    >\n                                      <p className=\"text-sm whitespace-pre-wrap\">{interaction.content}</p>\n                                    </div>\n                                  </div>\n                                </div>\n                              );\n                            })}\n                            \n                            {/* Typing indicator */}\n                            {typingIndicator && (\n                              <div className=\"flex gap-3\" data-testid=\"typing-indicator\">\n                                <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                                  <span className=\"text-sm font-medium text-blue-600\">\n                                    {typingIndicator.charAt(0)}\n                                  </span>\n                                </div>\n                                <div className=\"flex-1 max-w-lg\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"text-sm font-medium text-gray-900\">{typingIndicator}</span>\n                                  </div>\n                                  <div className=\"inline-block rounded-lg px-4 py-2 bg-gray-100\">\n                                    <div className=\"flex gap-1\">\n                                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></span>\n                                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></span>\n                                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></span>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>\n                            )}\n                            \n                            <div ref={messagesEndRef} />\n                          </>\n                        )}\n                      </div>\n                      <div className=\"flex-shrink-0 border-t p-4 relative\">\n                        {/* Mention autocomplete dropdown */}\n                        {showMentionMenu && filteredMembers.length > 0 && (\n                          <div className=\"absolute bottom-full left-4 right-4 mb-2 bg-white border rounded-lg shadow-lg max-h-48 overflow-y-auto z-10\">\n                            {filteredMembers.map((member: any, idx: number) => (\n                              <button\n                                key={idx}\n                                onClick={() => insertMention(member.name)}\n                                className=\"w-full px-4 py-2 hover:bg-gray-100 flex items-center gap-3 text-left\"\n                                data-testid={`mention-option-${member.name}`}\n                              >\n                                <div className=\"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0\">\n                                  <span className=\"text-sm font-medium text-blue-600\">\n                                    {member.name.charAt(0)}\n                                  </span>\n                                </div>\n                                <div>\n                                  <div className=\"text-sm font-medium text-gray-900\">{member.name}</div>\n                                  <div className=\"text-xs text-gray-600\">{member.role}</div>\n                                </div>\n                              </button>\n                            ))}\n                          </div>\n                        )}\n                        \n                        <div className=\"flex gap-2\">\n                          <Textarea\n                            ref={textareaRef}\n                            value={message}\n                            onChange={handleMessageChange}\n                            placeholder=\"Type @ to mention someone, or just ask your team...\"\n                            className=\"min-h-[60px]\"\n                            onKeyDown={(e) => {\n                              if (e.key === 'Enter' && !e.shiftKey) {\n                                e.preventDefault();\n                                handleSendMessage();\n                              }\n                            }}\n                            data-testid=\"input-message\"\n                          />\n                          <Button\n                            onClick={handleSendMessage}\n                            disabled={!message.trim() || sendMessageMutation.isPending}\n                            data-testid=\"button-send\"\n                          >\n                            <Send className=\"h-4 w-4\" />\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </TabsContent>\n\n                <TabsContent value=\"codebase\" className=\"flex-1 mt-4 overflow-y-auto\">\n                  <CodebaseExplorer \n                    codebaseData={simulatedCodebase}\n                    productInfo={existingProduct}\n                  />\n                </TabsContent>\n\n                <TabsContent value=\"requirements\" className=\"flex-1 mt-4 overflow-y-auto\">\n                  <div className=\"mb-6\">\n                    <Card>\n                      <CardHeader>\n                        <CardTitle className=\"flex items-center gap-2\">\n                          <FileCode className=\"h-5 w-5\" />\n                          Product Documentation\n                        </CardTitle>\n                        <CardDescription>\n                          Click any document to open it in a new tab for easy reading\n                        </CardDescription>\n                      </CardHeader>\n                      <CardContent>\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                          <a\n                            href={`/workspace/${session.id}/document/executive-summary`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-colors group\"\n                            data-testid=\"doc-executive-summary\"\n                          >\n                            <Target className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">Executive Summary</div>\n                              <div className=\"text-xs text-gray-500\">Strategic overview</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/feature-requirements`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-colors group\"\n                            data-testid=\"doc-feature-requirements\"\n                          >\n                            <CheckCircle2 className=\"h-5 w-5 text-green-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">Feature Requirements</div>\n                              <div className=\"text-xs text-gray-500\">Technical specs & criteria</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/stakeholder-analysis`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-purple-300 transition-colors group\"\n                            data-testid=\"doc-stakeholder-analysis\"\n                          >\n                            <Users className=\"h-5 w-5 text-purple-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-purple-600\">Stakeholder Analysis</div>\n                              <div className=\"text-xs text-gray-500\">Key stakeholders & priorities</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-purple-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/user-stories`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-colors group\"\n                            data-testid=\"doc-user-stories\"\n                          >\n                            <Users className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">User Stories & Personas</div>\n                              <div className=\"text-xs text-gray-500\">Target users & goals</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/success-metrics`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-green-300 transition-colors group\"\n                            data-testid=\"doc-success-metrics\"\n                          >\n                            <Target className=\"h-5 w-5 text-green-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-green-600\">Success Metrics & KPIs</div>\n                              <div className=\"text-xs text-gray-500\">Measurable outcomes</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-green-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/roadmap-context`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-orange-300 transition-colors group\"\n                            data-testid=\"doc-roadmap-context\"\n                          >\n                            <Clock className=\"h-5 w-5 text-orange-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-orange-600\">Roadmap Context</div>\n                              <div className=\"text-xs text-gray-500\">Strategic timeline</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-orange-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/competitive-analysis`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-colors group\"\n                            data-testid=\"doc-competitive-analysis\"\n                          >\n                            <FileCode className=\"h-5 w-5 text-gray-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">Competitive Analysis</div>\n                              <div className=\"text-xs text-gray-500\">Market positioning</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/gtm-strategy`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-blue-300 transition-colors group\"\n                            data-testid=\"doc-gtm-strategy\"\n                          >\n                            <Target className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">Go-to-Market Strategy</div>\n                              <div className=\"text-xs text-gray-500\">Launch plan</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/risk-assessment`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-red-300 transition-colors group\"\n                            data-testid=\"doc-risk-assessment\"\n                          >\n                            <MessageSquare className=\"h-5 w-5 text-red-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-red-600\">Risk Assessment</div>\n                              <div className=\"text-xs text-gray-500\">Risks & mitigation</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-red-600\" />\n                          </a>\n\n                          <a\n                            href={`/workspace/${session.id}/document/resource-planning`}\n                            target=\"_blank\"\n                            rel=\"noopener noreferrer\"\n                            className=\"flex items-center gap-3 p-4 border rounded-lg hover:bg-gray-50 hover:border-gray-300 transition-colors group\"\n                            data-testid=\"doc-resource-planning\"\n                          >\n                            <Users className=\"h-5 w-5 text-gray-600 flex-shrink-0\" />\n                            <div className=\"flex-1\">\n                              <div className=\"font-medium text-gray-900 group-hover:text-blue-600\">Resource Planning</div>\n                              <div className=\"text-xs text-gray-500\">Team & budget</div>\n                            </div>\n                            <ChevronRight className=\"h-4 w-4 text-gray-400 group-hover:text-blue-600\" />\n                          </a>\n                        </div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                  <div className=\"space-y-6 hidden\">\n                    {/* Executive Summary */}\n                    {productDocumentation.executiveSummary && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Target className=\"h-5 w-5 text-blue-600\" />\n                            Executive Summary\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent>\n                          <p className=\"text-sm text-gray-700 leading-relaxed\">{productDocumentation.executiveSummary}</p>\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Feature Requirements */}\n                    <Card>\n                      <CardHeader>\n                        <CardTitle>Feature Requirements</CardTitle>\n                        <CardDescription>{featureRequest.title}</CardDescription>\n                      </CardHeader>\n                      <CardContent className=\"space-y-6\">\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900 mb-2\">Business Context</h4>\n                          <p className=\"text-sm text-gray-700\">{featureRequest.businessContext}</p>\n                        </div>\n\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900 mb-2\">Technical Requirements</h4>\n                          <ul className=\"space-y-2\">\n                            {featureRequest.requirements?.map((req: string, idx: number) => (\n                              <li key={idx} className=\"flex items-start gap-2\">\n                                <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                                <span className=\"text-sm text-gray-700\">{req}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n\n                        <div>\n                          <h4 className=\"font-semibold text-gray-900 mb-2\">Acceptance Criteria</h4>\n                          <ul className=\"space-y-2\">\n                            {featureRequest.acceptanceCriteria?.map((criteria: string, idx: number) => (\n                              <li key={idx} className=\"flex items-start gap-2\">\n                                <div className=\"h-4 w-4 rounded border-2 border-gray-400 mt-0.5 flex-shrink-0\" />\n                                <span className=\"text-sm text-gray-700\">{criteria}</span>\n                              </li>\n                            ))}\n                          </ul>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    {/* Stakeholder Analysis */}\n                    {productDocumentation.stakeholders && productDocumentation.stakeholders.length > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Users className=\"h-5 w-5 text-purple-600\" />\n                            Stakeholder Analysis\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          {productDocumentation.stakeholders.map((stakeholder: any, idx: number) => (\n                            <div key={idx} className=\"border-l-4 border-purple-300 pl-4 py-2\">\n                              <div className=\"flex items-start justify-between mb-2\">\n                                <div>\n                                  <h5 className=\"font-semibold text-gray-900\">{stakeholder.name}</h5>\n                                  <p className=\"text-sm text-gray-600\">{stakeholder.title}</p>\n                                </div>\n                                <Badge variant=\"outline\" className=\"text-xs\">{stakeholder.priority}</Badge>\n                              </div>\n                              <div className=\"space-y-2 text-sm\">\n                                <div>\n                                  <span className=\"font-medium text-gray-700\">Concerns:</span>\n                                  <ul className=\"list-disc list-inside ml-2 text-gray-600\">\n                                    {stakeholder.concerns.map((concern: string, i: number) => (\n                                      <li key={i}>{concern}</li>\n                                    ))}\n                                  </ul>\n                                </div>\n                                <div>\n                                  <span className=\"font-medium text-gray-700\">Success Metrics:</span>\n                                  <ul className=\"list-disc list-inside ml-2 text-gray-600\">\n                                    {stakeholder.successMetrics.map((metric: string, i: number) => (\n                                      <li key={i}>{metric}</li>\n                                    ))}\n                                  </ul>\n                                </div>\n                              </div>\n                            </div>\n                          ))}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* User Stories */}\n                    {productDocumentation.userStories && productDocumentation.userStories.length > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>User Stories & Personas</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          {productDocumentation.userStories.map((story: any, idx: number) => (\n                            <div key={idx} className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                              <div className=\"flex items-start gap-3 mb-3\">\n                                <div className=\"w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0\">\n                                  <span className=\"text-white font-semibold text-lg\">{story.persona.charAt(0)}</span>\n                                </div>\n                                <div className=\"flex-1\">\n                                  <h5 className=\"font-semibold text-gray-900\">{story.persona}</h5>\n                                  <p className=\"text-sm text-blue-700 font-medium\">{story.goal}</p>\n                                </div>\n                              </div>\n                              <p className=\"text-sm text-gray-700 italic mb-2\">{story.story}</p>\n                              <div className=\"space-y-1 text-sm\">\n                                <div className=\"flex gap-2\">\n                                  <span className=\"font-medium text-gray-700\">Pain Point:</span>\n                                  <span className=\"text-gray-600\">{story.painPoint}</span>\n                                </div>\n                                <div className=\"flex gap-2\">\n                                  <span className=\"font-medium text-gray-700\">Key Jobs:</span>\n                                  <span className=\"text-gray-600\">{story.jobs.join(', ')}</span>\n                                </div>\n                              </div>\n                            </div>\n                          ))}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Success Metrics */}\n                    {productDocumentation.successMetrics && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Target className=\"h-5 w-5 text-green-600\" />\n                            Success Metrics & KPIs\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          {productDocumentation.successMetrics.primary && (\n                            <div>\n                              <h4 className=\"font-semibold text-gray-900 mb-2 flex items-center gap-2\">\n                                <Badge className=\"bg-green-600\">Primary</Badge>\n                              </h4>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.successMetrics.primary.map((metric: string, idx: number) => (\n                                  <li key={idx} className=\"flex items-start gap-2\">\n                                    <CheckCircle2 className=\"h-4 w-4 text-green-600 mt-0.5 flex-shrink-0\" />\n                                    <span className=\"text-sm text-gray-700\">{metric}</span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                          {productDocumentation.successMetrics.secondary && (\n                            <div>\n                              <h4 className=\"font-semibold text-gray-900 mb-2 flex items-center gap-2\">\n                                <Badge variant=\"outline\">Secondary</Badge>\n                              </h4>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.successMetrics.secondary.map((metric: string, idx: number) => (\n                                  <li key={idx} className=\"flex items-start gap-2\">\n                                    <ChevronRight className=\"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                                    <span className=\"text-sm text-gray-600\">{metric}</span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                          {productDocumentation.successMetrics.technical && (\n                            <div>\n                              <h4 className=\"font-semibold text-gray-900 mb-2 flex items-center gap-2\">\n                                <Badge variant=\"outline\" className=\"bg-gray-100\">Technical</Badge>\n                              </h4>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.successMetrics.technical.map((metric: string, idx: number) => (\n                                  <li key={idx} className=\"flex items-start gap-2\">\n                                    <FileCode className=\"h-4 w-4 text-gray-500 mt-0.5 flex-shrink-0\" />\n                                    <span className=\"text-sm text-gray-600\">{metric}</span>\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Roadmap Context */}\n                    {productDocumentation.roadmapContext && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle className=\"flex items-center gap-2\">\n                            <Clock className=\"h-5 w-5 text-orange-600\" />\n                            Roadmap Context\n                          </CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-3\">\n                            <h4 className=\"font-semibold text-gray-900 mb-1\">{productDocumentation.roadmapContext.quarterlyTheme}</h4>\n                            <p className=\"text-sm text-gray-700\">{productDocumentation.roadmapContext.positioning}</p>\n                          </div>\n                          \n                          {productDocumentation.roadmapContext.dependencies && (\n                            <div>\n                              <h4 className=\"font-semibold text-gray-900 mb-2\">Dependencies</h4>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.roadmapContext.dependencies.map((dep: string, idx: number) => (\n                                  <li key={idx} className=\"text-sm text-gray-700 flex items-start gap-2\">\n                                    <ChevronRight className=\"h-4 w-4 text-orange-500 mt-0.5 flex-shrink-0\" />\n                                    {dep}\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n\n                          {productDocumentation.roadmapContext.futureEnhancements && (\n                            <div>\n                              <h4 className=\"font-semibold text-gray-900 mb-2\">Future Enhancements</h4>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.roadmapContext.futureEnhancements.map((enhancement: string, idx: number) => (\n                                  <li key={idx} className=\"text-sm text-gray-600 flex items-start gap-2\">\n                                    <ChevronRight className=\"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                                    {enhancement}\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Competitive Analysis */}\n                    {productDocumentation.competitiveAnalysis && productDocumentation.competitiveAnalysis.length > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>Competitive Analysis</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-3\">\n                          {productDocumentation.competitiveAnalysis.map((comp: any, idx: number) => (\n                            <div key={idx} className=\"border rounded-lg p-3 space-y-2\">\n                              <h5 className=\"font-semibold text-gray-900\">{comp.competitor}</h5>\n                              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 text-sm\">\n                                <div className=\"bg-gray-50 rounded p-2\">\n                                  <span className=\"font-medium text-gray-700\">Their Capability:</span>\n                                  <p className=\"text-gray-600 mt-1\">{comp.theirCapability}</p>\n                                </div>\n                                <div className=\"bg-green-50 rounded p-2\">\n                                  <span className=\"font-medium text-green-800\">Our Differentiator:</span>\n                                  <p className=\"text-green-700 mt-1\">{comp.ourDifferentiator}</p>\n                                </div>\n                              </div>\n                              <div className=\"bg-blue-50 border-l-4 border-blue-400 p-2\">\n                                <span className=\"font-medium text-blue-800 text-sm\">Gap: </span>\n                                <span className=\"text-blue-700 text-sm\">{comp.gap}</span>\n                              </div>\n                            </div>\n                          ))}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Go-to-Market Strategy */}\n                    {productDocumentation.goToMarketStrategy && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>Go-to-Market Strategy</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          <div className=\"grid grid-cols-2 gap-4\">\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-1 text-sm\">Launch Date</h5>\n                              <p className=\"text-sm text-gray-700\">{productDocumentation.goToMarketStrategy.launchDate}</p>\n                            </div>\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-1 text-sm\">Pricing</h5>\n                              <p className=\"text-sm text-gray-700\">{productDocumentation.goToMarketStrategy.pricing}</p>\n                            </div>\n                          </div>\n\n                          <div>\n                            <h5 className=\"font-semibold text-gray-900 mb-2 text-sm\">Target Segment</h5>\n                            <p className=\"text-sm text-gray-700\">{productDocumentation.goToMarketStrategy.targetSegment}</p>\n                          </div>\n\n                          {productDocumentation.goToMarketStrategy.messagingPillars && (\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-2 text-sm\">Messaging Pillars</h5>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.goToMarketStrategy.messagingPillars.map((pillar: string, idx: number) => (\n                                  <li key={idx} className=\"text-sm text-gray-700 flex items-start gap-2\">\n                                    <CheckCircle2 className=\"h-4 w-4 text-blue-600 mt-0.5 flex-shrink-0\" />\n                                    {pillar}\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n\n                          {productDocumentation.goToMarketStrategy.launchActivities && (\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-2 text-sm\">Launch Activities</h5>\n                              <ul className=\"space-y-1\">\n                                {productDocumentation.goToMarketStrategy.launchActivities.map((activity: string, idx: number) => (\n                                  <li key={idx} className=\"text-sm text-gray-600 flex items-start gap-2\">\n                                    <ChevronRight className=\"h-4 w-4 text-gray-400 mt-0.5 flex-shrink-0\" />\n                                    {activity}\n                                  </li>\n                                ))}\n                              </ul>\n                            </div>\n                          )}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Risk Assessment */}\n                    {productDocumentation.riskAssessment && productDocumentation.riskAssessment.length > 0 && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>Risk Assessment</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-3\">\n                          {productDocumentation.riskAssessment.map((risk: any, idx: number) => (\n                            <div key={idx} className=\"border-l-4 border-red-300 pl-4 py-2\">\n                              <div className=\"flex items-start justify-between mb-2\">\n                                <h5 className=\"font-semibold text-gray-900\">{risk.risk}</h5>\n                                <div className=\"flex gap-2\">\n                                  <Badge variant=\"outline\" className=\"text-xs\">P: {risk.probability}</Badge>\n                                  <Badge variant=\"outline\" className=\"text-xs\">I: {risk.impact}</Badge>\n                                </div>\n                              </div>\n                              <p className=\"text-sm text-gray-700 mb-1\"><span className=\"font-medium\">Mitigation:</span> {risk.mitigation}</p>\n                            </div>\n                          ))}\n                        </CardContent>\n                      </Card>\n                    )}\n\n                    {/* Resource Planning */}\n                    {productDocumentation.resourcePlanning && (\n                      <Card>\n                        <CardHeader>\n                          <CardTitle>Resource Planning</CardTitle>\n                        </CardHeader>\n                        <CardContent className=\"space-y-4\">\n                          {productDocumentation.resourcePlanning.teamAllocation && (\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-2 text-sm\">Team Allocation</h5>\n                              <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                                {Object.entries(productDocumentation.resourcePlanning.teamAllocation).map(([role, allocation]: [string, any]) => (\n                                  <div key={role} className=\"bg-gray-50 rounded p-2\">\n                                    <span className=\"font-medium text-gray-700 capitalize\">{role}:</span>\n                                    <span className=\"text-gray-600 ml-2\">{allocation}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n\n                          {productDocumentation.resourcePlanning.timeline && (\n                            <div className=\"bg-blue-50 border border-blue-200 rounded p-3\">\n                              <h5 className=\"font-semibold text-gray-900 mb-1 text-sm\">Timeline</h5>\n                              <p className=\"text-sm text-gray-700\">{productDocumentation.resourcePlanning.timeline}</p>\n                            </div>\n                          )}\n\n                          {productDocumentation.resourcePlanning.budget && (\n                            <div>\n                              <h5 className=\"font-semibold text-gray-900 mb-2 text-sm\">Budget</h5>\n                              <div className=\"grid grid-cols-2 gap-2 text-sm\">\n                                {Object.entries(productDocumentation.resourcePlanning.budget).map(([item, cost]: [string, any]) => (\n                                  <div key={item} className=\"flex justify-between bg-gray-50 rounded p-2\">\n                                    <span className=\"font-medium text-gray-700 capitalize\">{item}:</span>\n                                    <span className=\"text-gray-900 font-semibold\">{cost}</span>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n                        </CardContent>\n                      </Card>\n                    )}\n                  </div>\n                </TabsContent>\n              </Tabs>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":68159,"size_tokens":null},"server/services/workspace-orchestrator.ts":{"content":"import Groq from \"groq-sdk\";\n\nconst groq = new Groq({ \n  apiKey: process.env.GROQ_API_KEY\n});\n\nexport interface TeamMember {\n  name: string;\n  role: string;\n  personality: string;\n  expertise: string[];\n  availability: string; // 'always', 'usually', 'sometimes'\n}\n\nexport interface WorkspaceContext {\n  projectName: string;\n  projectDescription: string;\n  currentSprint: string;\n  teamMembers: TeamMember[];\n  userRole: string;\n  phase: string; // 'onboarding', 'sprint', 'retro'\n  currentDay?: number; // Day 1, Day 2, etc. for intern onboarding\n  dayActivities?: string[]; // What the user should be doing today\n  completedActivities?: string[]; // What the user has already done today\n}\n\nexport interface ChannelMessage {\n  sender: string;\n  senderRole: string;\n  content: string;\n  timestamp: Date;\n  metadata?: {\n    closed?: boolean;\n    [key: string]: any;\n  };\n}\n\nexport interface WorkspaceAction {\n  type: string; // 'send-message', 'update-task', 'create-artifact', 'request-review'\n  channel: string;\n  data: any;\n}\n\nexport class WorkspaceOrchestrator {\n  private conversationMemory: Map<string, ChannelMessage[]> = new Map();\n  private closedChannels: Map<string, boolean> = new Map();\n  private maxMemoryPerChannel = 15;\n\n  /**\n   * Detect if user is trying to close/wrap-up the conversation\n   */\n  private detectClosureIntent(userMessage: string, conversationHistory: ChannelMessage[] = []): { isClosing: boolean; isFinal: boolean } {\n    const message = userMessage.toLowerCase().trim();\n    \n    // Strong closure signals - user is definitely done\n    const strongClosurePatterns = [\n      /^thanks\\.?$/i,\n      /^thank you\\.?$/i,\n      /^perfect\\.? thanks\\.?$/i,\n      /^perfect,? thank(s| you)\\.?$/i,\n      /^great,? thanks\\.?$/i,\n      /^awesome,? thanks\\.?$/i,\n      /^cool,? thanks\\.?$/i,\n      /^sounds good,? thanks\\.?$/i,\n      /^got it,? thanks\\.?$/i,\n      /^okay,? thanks\\.?$/i,\n      /^ok,? thanks\\.?$/i,\n      /^that'?s? (all|it)\\.?$/i,\n      /^nothing else\\.?$/i,\n      /^no(pe)?,? (that'?s?|i'?m?) (all|good|fine)\\.?$/i,\n      /^(i'?m? )?(all )?good\\.? thanks\\.?$/i,\n      /^no more questions\\.?$/i,\n      /^no questions\\.?$/i,\n    ];\n\n    // Check for strong closure - these should end the conversation\n    for (const pattern of strongClosurePatterns) {\n      if (pattern.test(message)) {\n        return { isClosing: true, isFinal: true };\n      }\n    }\n\n    // Moderate closure signals - user seems to be wrapping up\n    const moderateClosurePatterns = [\n      /thanks (a lot|so much|very much)/i,\n      /thank you (so|very) much/i,\n      /appreciate (it|that|your help)/i,\n      /happy to be (here|part of|on)/i,\n      /looking forward to/i,\n      /see you tomorrow/i,\n      /talk (to you )?later/i,\n      /have a (good|great|nice)/i,\n    ];\n\n    // Check conversation history for previous closure attempts\n    const recentMessages = conversationHistory.slice(-4);\n    const userClosureAttempts = recentMessages.filter(m => \n      m.sender === 'User' && \n      (moderateClosurePatterns.some(p => p.test(m.content.toLowerCase())) ||\n       strongClosurePatterns.some(p => p.test(m.content.toLowerCase().trim())))\n    ).length;\n\n    // If user has already tried to close once and is saying thanks again, it's final\n    if (userClosureAttempts >= 1) {\n      for (const pattern of moderateClosurePatterns) {\n        if (pattern.test(message)) {\n          return { isClosing: true, isFinal: true };\n        }\n      }\n    }\n\n    // First moderate closure - acknowledge but don't force end\n    for (const pattern of moderateClosurePatterns) {\n      if (pattern.test(message)) {\n        return { isClosing: true, isFinal: false };\n      }\n    }\n\n    return { isClosing: false, isFinal: false };\n  }\n\n  /**\n   * Reopen a closed channel to allow continued conversation\n   */\n  reopenChannel(channel: string): void {\n    this.closedChannels.set(channel, false);\n  }\n\n  /**\n   * Get a brief farewell response without calling Groq\n   */\n  private getFarewellResponse(teamMember: TeamMember): string {\n    const farewells = [\n      `You're all set! Have a great rest of your day, and I'll see you tomorrow. `,\n      `Perfect! Don't hesitate to reach out if anything comes up. See you tomorrow!`,\n      `Sounds good! Enjoy the rest of your day - we'll pick up tomorrow. `,\n      `Great! Take care and see you at tomorrow's check-in.`,\n      `All good! Rest up and we'll dive in more tomorrow. Welcome to the team! `,\n    ];\n    return farewells[Math.floor(Math.random() * farewells.length)];\n  }\n\n  /**\n   * Generate AI team member response in a specific channel\n   */\n  async generateTeamMemberResponse(\n    teamMember: TeamMember,\n    context: WorkspaceContext,\n    userMessage: string,\n    channel: string,\n    conversationHistory: ChannelMessage[] = []\n  ): Promise<{ content: string; metadata?: any }> {\n    // Check if this channel was already closed\n    const channelKey = `${channel}`;\n    if (this.closedChannels.get(channelKey)) {\n      // User is re-engaging after closure - check if it's substantive\n      const closureCheck = this.detectClosureIntent(userMessage, conversationHistory);\n      if (closureCheck.isClosing) {\n        // Still trying to close, give brief response\n        return { content: this.getFarewellResponse(teamMember), metadata: { closed: true } };\n      }\n      // Substantive message - reopen the channel\n      this.closedChannels.set(channelKey, false);\n    }\n\n    // Check for closure intent\n    const closureIntent = this.detectClosureIntent(userMessage, conversationHistory);\n    \n    if (closureIntent.isFinal) {\n      // User is definitely done - give brief farewell and mark channel closed\n      this.closedChannels.set(channelKey, true);\n      return { content: this.getFarewellResponse(teamMember), metadata: { closed: true } };\n    }\n\n    const prompt = this.buildTeamMemberPrompt(teamMember, context, userMessage, channel, conversationHistory, closureIntent.isClosing);\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.3-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: this.getSystemPrompt(teamMember, channel, closureIntent.isClosing)\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        temperature: 0.8,\n      });\n\n      const content = response.choices[0].message.content || '';\n      return { content, metadata: { sentiment: 'neutral' } };\n    } catch (error) {\n      console.error('Groq API Error:', error instanceof Error ? error.message : error);\n      return this.getFallbackResponse(teamMember, userMessage, channel);\n    }\n  }\n\n  /**\n   * Generate daily standup updates from all team members\n   */\n  async generateStandupUpdates(\n    context: WorkspaceContext,\n    completedTasks: any[]\n  ): Promise<{ member: string; update: string }[]> {\n    const updates: { member: string; update: string }[] = [];\n\n    for (const member of context.teamMembers) {\n      const memberTasks = completedTasks.filter(t => t.assignedRole === member.role);\n      const update = await this.generateStandupUpdate(member, context, memberTasks);\n      updates.push({ member: member.name, update });\n    }\n\n    return updates;\n  }\n\n  private async generateStandupUpdate(\n    member: TeamMember,\n    context: WorkspaceContext,\n    tasks: any[]\n  ): Promise<string> {\n    const taskSummary = tasks.length > 0 \n      ? tasks.map(t => t.title).join(', ') \n      : 'setting up environment';\n\n    const standupTemplates = {\n      Developer: [\n        `Yesterday: Worked on ${taskSummary}. Today: Will continue with implementation and write tests. No blockers.`,\n        `Progress: Completed ${tasks.length} task(s). Planning to tackle the API integration next. Need clarification on the auth flow.`,\n        `Update: Made good progress on ${taskSummary}. Today focusing on code review and bug fixes. All good here!`\n      ],\n      'Product Manager': [\n        `Yesterday: Refined requirements for ${taskSummary}. Today: Will prioritize the backlog and schedule stakeholder sync. No blockers.`,\n        `Update: User stories are ready for ${context.currentSprint}. Today planning the next sprint. Need team input on timeline.`,\n        `Progress: Gathered user feedback. Today: Will update roadmap and communicate with stakeholders. Looking good!`\n      ],\n      Designer: [\n        `Yesterday: Created designs for ${taskSummary}. Today: Will gather feedback and iterate. Waiting on product requirements.`,\n        `Update: Wireframes complete. Today: Working on high-fidelity mockups. Need dev input on technical constraints.`,\n        `Progress: Design system updates done. Today: Will conduct user testing and refine flows. All set!`\n      ],\n      QA: [\n        `Yesterday: Tested ${taskSummary}. Today: Will create automated tests and verify bug fixes. Found 2 issues.`,\n        `Update: Regression testing complete. Today: Focusing on edge cases. Need clarity on expected behavior for feature X.`,\n        `Progress: ${tasks.length} test cases written. Today: Will execute tests and document results. No blockers!`\n      ],\n      DevOps: [\n        `Yesterday: Configured deployment pipeline. Today: Will monitor performance and optimize infrastructure. Deployment ready.`,\n        `Update: Infrastructure updates deployed. Today: Will review security configurations. Monitoring shows all green.`,\n        `Progress: CI/CD pipeline improved. Today: Will work on database optimization. Everything running smoothly!`\n      ]\n    };\n\n    const templates = standupTemplates[member.role as keyof typeof standupTemplates] || standupTemplates.Developer;\n    return templates[Math.floor(Math.random() * templates.length)];\n  }\n\n  /**\n   * Generate code review feedback\n   */\n  async generateCodeReviewFeedback(\n    reviewer: TeamMember,\n    codeContent: string,\n    userRole: string\n  ): Promise<{ content: string; approved: boolean; suggestions: string[] }> {\n    const prompt = `You are ${reviewer.name}, a ${reviewer.role} reviewing code submitted by a ${userRole}.\n\nCode to review:\n${codeContent.substring(0, 500)}...\n\nProvide constructive code review feedback in a realistic, professional manner. Include:\n1. What looks good\n2. Potential improvements\n3. Whether you'd approve or request changes\n\nFormat as JSON:\n{\n  \"content\": \"your review comment\",\n  \"approved\": boolean,\n  \"suggestions\": [\"suggestion1\", \"suggestion2\"]\n}`;\n\n    try {\n      if (!process.env.GROQ_API_KEY) {\n        throw new Error('Invalid API key');\n      }\n\n      const response = await groq.chat.completions.create({\n        model: \"llama-3.1-70b-versatile\",\n        messages: [\n          {\n            role: \"system\",\n            content: `You are ${reviewer.name}, a ${reviewer.personality} ${reviewer.role}. Provide helpful, professional code reviews.`\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" },\n      });\n\n      const result = JSON.parse(response.choices[0].message.content || '{}');\n      return {\n        content: result.content || \"Looks good overall! A few minor suggestions.\",\n        approved: result.approved !== false,\n        suggestions: result.suggestions || []\n      };\n    } catch (error) {\n      return this.getFallbackCodeReview(reviewer);\n    }\n  }\n\n  /**\n   * Evaluate user action and provide micro-feedback\n   */\n  async evaluateAction(\n    action: WorkspaceAction,\n    context: WorkspaceContext\n  ): Promise<{ score: number; feedback: string; impact: string }> {\n    const actionQuality = this.assessActionQuality(action, context);\n    \n    return {\n      score: actionQuality.score,\n      feedback: actionQuality.feedback,\n      impact: actionQuality.impact\n    };\n  }\n\n  /**\n   * Generate artifacts (code, designs, documentation)\n   */\n  async generateArtifact(\n    type: string,\n    description: string,\n    role: string\n  ): Promise<{ content: any; metadata: any }> {\n    const artifactTemplates: Record<string, any> = {\n      'code-snippet': {\n        language: 'typescript',\n        code: `// ${description}\\nfunction example() {\\n  // Implementation here\\n  return true;\\n}`,\n        comments: 'Basic implementation structure'\n      },\n      'design-mockup': {\n        type: 'wireframe',\n        description: description,\n        components: ['Header', 'Main Content', 'Footer'],\n        notes: 'Initial design concept'\n      },\n      'test-case': {\n        title: description,\n        steps: ['Setup test data', 'Execute action', 'Verify result'],\n        expectedResult: 'Functionality works as expected'\n      },\n      'documentation': {\n        title: description,\n        sections: ['Overview', 'Usage', 'Examples'],\n        content: 'Documentation content here'\n      }\n    };\n\n    const template = artifactTemplates[type] || artifactTemplates['documentation'];\n    \n    return {\n      content: template,\n      metadata: {\n        createdBy: role,\n        status: 'draft',\n        version: 1\n      }\n    };\n  }\n\n  /**\n   * Orchestrate multi-agent conversation\n   */\n  async orchestrateConversation(\n    userMessage: string,\n    channel: string,\n    context: WorkspaceContext,\n    sessionId: number\n  ): Promise<ChannelMessage[]> {\n    const responses: ChannelMessage[] = [];\n    \n    // Store user message in memory\n    this.addToMemory(sessionId, channel, {\n      sender: 'User',\n      senderRole: context.userRole,\n      content: userMessage,\n      timestamp: new Date()\n    });\n\n    // Determine which team members should respond\n    const respondingMembers = this.selectRespondingMembers(userMessage, channel, context);\n\n    for (const member of respondingMembers) {\n      const history = this.getMemory(sessionId, channel);\n      const response = await this.generateTeamMemberResponse(member, context, userMessage, channel, history);\n      \n      // Simulate realistic typing speed: 190-200 characters per minute\n      // 190 CPM = 315.8 ms/char, 200 CPM = 300 ms/char\n      const charsPerMinute = 190 + Math.random() * 10; // Random between 190-200\n      const msPerChar = 60000 / charsPerMinute; // Convert to milliseconds per character\n      const typingDelay = response.content.length * msPerChar;\n      \n      // Add small thinking delay (1-2 seconds) before typing starts\n      const thinkingDelay = 1000 + Math.random() * 1000;\n      \n      // Cap maximum delay at 8-12 seconds for better UX\n      const maxDelay = 8000 + Math.random() * 4000; // 8-12 seconds max\n      const calculatedDelay = thinkingDelay + typingDelay;\n      const totalDelay = Math.min(calculatedDelay, maxDelay);\n      \n      console.log(`[Typing] ${member.name} typing ${response.content.length} chars at ${Math.round(charsPerMinute)} CPM = ${Math.round(totalDelay)}ms total (calculated: ${Math.round(calculatedDelay)}ms, capped: ${totalDelay < calculatedDelay})`);\n      \n      await new Promise(resolve => setTimeout(resolve, totalDelay));\n      \n      const message: ChannelMessage = {\n        sender: member.name,\n        senderRole: member.role,\n        content: response.content,\n        timestamp: new Date(),\n        metadata: response.metadata\n      };\n\n      this.addToMemory(sessionId, channel, message);\n      responses.push(message);\n\n      // Add brief pause between multiple responses (500ms-1s)\n      if (respondingMembers.length > 1) {\n        await new Promise(resolve => setTimeout(resolve, 500 + Math.random() * 500));\n      }\n    }\n\n    return responses;\n  }\n\n  // Helper methods\n\n  private buildTeamMemberPrompt(\n    member: TeamMember,\n    context: WorkspaceContext,\n    userMessage: string,\n    channel: string,\n    history: ChannelMessage[],\n    isClosing: boolean = false\n  ): string {\n    const recentHistory = history.slice(-5).map(m => `${m.sender}: ${m.content}`).join('\\n');\n    \n    // Build day context for intern onboarding\n    let dayContext = '';\n    if (context.currentDay) {\n      dayContext = `\\nIntern's Current Day: Day ${context.currentDay} of their onboarding week`;\n      \n      if (context.dayActivities && context.dayActivities.length > 0) {\n        dayContext += `\\nToday's activities for the intern: ${context.dayActivities.join(', ')}`;\n      }\n      \n      if (context.completedActivities && context.completedActivities.length > 0) {\n        dayContext += `\\nAlready completed today: ${context.completedActivities.join(', ')}`;\n      }\n    }\n\n    // Add closure guidance if user seems to be wrapping up\n    let closureGuidance = '';\n    if (isClosing) {\n      closureGuidance = `\n\nIMPORTANT: The user seems to be wrapping up this conversation (they've expressed gratitude, said thanks, or indicated they're done). Keep your response BRIEF (1-2 sentences max). Simply acknowledge their message warmly and wish them well. Do NOT ask follow-up questions or extend the conversation. Let them go gracefully.`;\n    }\n    \n    return `You are ${member.name}, a ${member.personality} ${member.role} working on ${context.projectName}.\n\nProject: ${context.projectDescription}\nCurrent Phase: ${context.phase}${dayContext}\nChannel: ${channel}\nYour expertise: ${member.expertise.join(', ')}\n\nRecent conversation:\n${recentHistory || 'No previous messages'}\n\nUser (${context.userRole}): ${userMessage}\n\nRespond naturally and helpfully as ${member.name}. Keep it conversational and realistic. Be aware of what day of onboarding the intern is on and what they should be working on. ${channel === 'standup' ? 'Keep it brief and focused.' : channel === 'email' ? 'Be professional and structured.' : 'Be casual and collaborative.'}${closureGuidance}`;\n  }\n\n  private getSystemPrompt(member: TeamMember, channel: string, isClosing: boolean = false): string {\n    const channelGuidance = {\n      chat: 'casual, quick, collaborative',\n      email: 'professional, structured, detailed',\n      standup: 'brief, focused, status-oriented',\n      'code-review': 'technical, constructive, specific'\n    };\n\n    let basePrompt = `You are ${member.name}, a ${member.personality} ${member.role}. Communicate in a ${channelGuidance[channel as keyof typeof channelGuidance] || 'professional'} manner. Be helpful, realistic, and stay in character.`;\n    \n    if (isClosing) {\n      basePrompt += ` The user is wrapping up the conversation - keep your response very brief (1-2 sentences). Don't ask new questions or extend the conversation.`;\n    }\n    \n    return basePrompt;\n  }\n\n  private getFallbackResponse(member: TeamMember, userMessage: string, channel: string): { content: string; metadata: any } {\n    // Generate contextual response based on message content and member role\n    const message = userMessage.toLowerCase();\n    \n    // Greeting responses\n    if (message.match(/^(hi|hello|hey|greetings)/)) {\n      const greetings = [\n        `Hey! Great to have you on the team. I'm ${member.name}, the ${member.role}. ${this.getRoleIntro(member.role)}`,\n        `Hi there! Welcome aboard. Looking forward to working together on this project!`,\n        `Hello! I'm ${member.name}. ${this.getRoleIntro(member.role)} Let me know how I can help!`,\n        `Hey there! ${member.name} here. Excited to be working with you on this! ${this.getRoleIntro(member.role)}`,\n        `Hi! Good to see you in the chat. I'm ${member.name} - I'll be your ${member.role} on this project. Feel free to reach out anytime!`,\n        `Welcome! ${member.name} checking in. ${this.getRoleIntro(member.role)} Looking forward to collaborating!`\n      ];\n      return { content: greetings[Math.floor(Math.random() * greetings.length)], metadata: { sentiment: 'positive' } };\n    }\n\n    // Extract key topic from user message\n    const topic = this.extractTopic(userMessage);\n\n    // Task/priority questions - reference the actual topic\n    if (message.includes('task') || message.includes('priority') || message.includes('start') || message.includes('begin')) {\n      const advice = this.getTaskAdvice(member.role);\n      return { \n        content: topic ? `Regarding ${topic}, ${advice.charAt(0).toLowerCase() + advice.slice(1)}` : advice,\n        metadata: { sentiment: 'helpful' } \n      };\n    }\n\n    // Technical questions - be specific about what they're asking\n    if (message.includes('how') || message.includes('implement') || message.includes('approach') || message.includes('should we')) {\n      const technicalAdvice = this.getTechnicalAdvice(member.role, userMessage);\n      if (topic && !technicalAdvice.includes(topic)) {\n        return {\n          content: `Good question about ${topic}. ${technicalAdvice}`,\n          metadata: { sentiment: 'helpful' }\n        };\n      }\n      return { \n        content: technicalAdvice, \n        metadata: { sentiment: 'helpful' } \n      };\n    }\n\n    // Review/feedback requests - acknowledge what they want reviewed\n    if (message.includes('review') || message.includes('feedback') || message.includes('thoughts') || message.includes('opinion')) {\n      const reviewResponse = this.getReviewResponse(member.role);\n      return { \n        content: topic ? `I can definitely review ${topic}. ${reviewResponse}` : reviewResponse,\n        metadata: { sentiment: 'collaborative' } \n      };\n    }\n\n    // Status questions - be specific\n    if (message.includes('status') || message.includes('progress') || message.includes('update') || message.includes('how is')) {\n      const statusUpdate = this.getStatusUpdate(member.role);\n      return { \n        content: topic ? `For ${topic}, ${statusUpdate.charAt(0).toLowerCase() + statusUpdate.slice(1)}` : statusUpdate,\n        metadata: { sentiment: 'informative' } \n      };\n    }\n\n    // Generic but contextual fallback - reference what they said\n    const genericResponse = this.getGenericResponse(member.role, userMessage);\n    if (topic) {\n      return {\n        content: `Re: ${topic} - ${genericResponse} I can share some thoughts from my ${member.role} perspective if that would help.`,\n        metadata: { sentiment: 'neutral' }\n      };\n    }\n    \n    return { \n      content: `${genericResponse} Feel free to ping me if you need anything specific about ${member.expertise.slice(0, 2).join(' or ')}.`, \n      metadata: { sentiment: 'neutral' } \n    };\n  }\n\n  private extractTopic(userMessage: string): string {\n    const message = userMessage.toLowerCase();\n    \n    // Extract specific technical topics\n    const topics = [\n      'authentication', 'auth', 'login', 'signup', 'user management',\n      'database', 'api', 'backend', 'frontend', 'ui', 'ux', 'design',\n      'testing', 'deployment', 'ci/cd', 'infrastructure', 'security',\n      'performance', 'caching', 'validation', 'error handling',\n      'documentation', 'code review', 'refactoring', 'architecture'\n    ];\n    \n    for (const topic of topics) {\n      if (message.includes(topic)) {\n        return topic;\n      }\n    }\n    \n    // Extract quoted phrases or key nouns\n    const quotedMatch = userMessage.match(/\"([^\"]+)\"/);\n    if (quotedMatch) {\n      return quotedMatch[1];\n    }\n    \n    // Extract question subjects\n    const questionPatterns = [\n      /(?:about|regarding|concerning) (\\w+(?:\\s+\\w+)?)/i,\n      /(\\w+(?:\\s+\\w+)?)\\?/,\n      /(?:the|our|my) (\\w+(?:\\s+\\w+)?)/i\n    ];\n    \n    for (const pattern of questionPatterns) {\n      const match = userMessage.match(pattern);\n      if (match && match[1] && match[1].length > 3) {\n        return match[1];\n      }\n    }\n    \n    return '';\n  }\n\n  private getRoleIntro(role: string): string {\n    const intros: Record<string, string> = {\n      'Developer': \"I'll be handling most of the implementation work.\",\n      'Product Manager': \"I'm coordinating the project roadmap and priorities.\",\n      'Designer': \"I'm working on the UX/UI design for this project.\",\n      'QA Engineer': \"I'll be ensuring quality through testing and validation.\",\n      'DevOps Engineer': \"I'm managing the deployment and infrastructure.\"\n    };\n    return intros[role] || \"Excited to collaborate on this project.\";\n  }\n\n  private getTaskAdvice(role: string): string {\n    const advice: Record<string, string[]> = {\n      'Developer': [\n        \"I'd suggest starting with the authentication flow - it's foundational for everything else. After that, we can tackle the main features. Want me to create some initial tickets?\",\n        \"Let's start with setting up the project structure and database models. Once that's solid, we can build out the API endpoints. I can pair with you on this if helpful!\",\n        \"I'd recommend beginning with the core data models and API layer. Get that working first, then we can add the UI on top. Sound good?\"\n      ],\n      'Product Manager': [\n        \"Let's prioritize the MVP features first. I'd recommend focusing on user authentication, core CRUD operations, and basic UI. We can iterate from there based on feedback.\",\n        \"I've drafted a priority list: 1) User accounts 2) Main workflow 3) Data management. Let's tackle these in order and get user feedback early.\",\n        \"From a product perspective, we should focus on the highest-value features first. I'm thinking user login and the core task flow. What do you think?\"\n      ],\n      'Designer': [\n        \"From a design perspective, I'd start with the user flow mapping and wireframes. Once we align on that, I can create high-fidelity mockups for the key screens.\",\n        \"I'd recommend starting with user research and sketching out the main flows. Then we can move to wireframes and visual design. Want to sync on this tomorrow?\",\n        \"Let's begin with low-fidelity wireframes to validate the UX flow, then I'll create the high-fidelity designs and components. Does that work for you?\"\n      ],\n      'QA Engineer': [\n        \"I recommend setting up the testing framework early - it pays off later. We should also define acceptance criteria for each feature as we plan them.\",\n        \"Let's get test automation in place from the start. I'll set up the framework and we can write tests alongside development. Much easier than retrofitting!\",\n        \"I'd start by defining test scenarios for the critical paths, then build out the automation framework. Happy to walk through my testing approach if that helps.\"\n      ],\n      'DevOps Engineer': [\n        \"Let's get the CI/CD pipeline set up first so we can deploy frequently. I'll also configure staging and production environments.\",\n        \"I'd prioritize getting the deployment pipeline working early. That way we can push to staging regularly and catch issues fast. I'll handle the infrastructure setup.\",\n        \"Start with containerizing the app and setting up automated deployments. I'll configure monitoring too so we can track performance from day one.\"\n      ]\n    };\n    const responses = advice[role] || [\"Let me check the backlog and get back to you with specific recommendations based on our sprint goals.\"];\n    return responses[Math.floor(Math.random() * responses.length)];\n  }\n\n  private getTechnicalAdvice(role: string, question: string): string {\n    const message = question.toLowerCase();\n    \n    if (message.includes('auth') || message.includes('login')) {\n      if (role === 'Developer') {\n        return \"For authentication, I'd recommend using JWT tokens with refresh token rotation. We can implement OAuth2 for third-party logins. Want me to draft an architecture diagram?\";\n      } else if (role === 'Product Manager') {\n        return \"From a product standpoint, we should support email/password login and social auth (Google, GitHub). Two-factor authentication can be a phase 2 feature.\";\n      }\n    }\n\n    if (message.includes('api') || message.includes('backend')) {\n      if (role === 'Developer') {\n        return \"I'd suggest a RESTful API with proper error handling and validation. We should also add rate limiting and caching for performance. Happy to pair on this!\";\n      } else if (role === 'DevOps Engineer') {\n        return \"For the API, let's containerize it with Docker and use auto-scaling. I'll set up monitoring and logging so we can catch issues early.\";\n      }\n    }\n\n    if (message.includes('design') || message.includes('ui')) {\n      if (role === 'Designer') {\n        return \"Let's follow a mobile-first approach. I'm thinking clean, minimal UI with good use of white space. I can create a design system to keep everything consistent.\";\n      } else if (role === 'Developer') {\n        return \"From an implementation perspective, we should use a component library like Material UI or Tailwind for faster development. What's your preference?\";\n      }\n    }\n\n    return \"That's a great question. Based on my experience, I'd approach it systematically - break it into smaller parts, validate assumptions early, and keep the team in the loop. Want to hop on a quick call to discuss details?\";\n  }\n\n  private getReviewResponse(role: string): string {\n    const responses: Record<string, string> = {\n      'Developer': \"I'd be happy to review! Send over the PR or code snippet and I'll take a look. Generally I focus on code quality, performance, and whether it follows our team conventions.\",\n      'Product Manager': \"Sure, I can provide feedback from a product perspective. I'll check if it aligns with user needs and our roadmap. Share what you've got!\",\n      'Designer': \"I'd love to give feedback! From a UX standpoint, I'll look at usability, accessibility, and visual consistency with our design system.\",\n      'QA Engineer': \"Absolutely! I'll review it from a testing perspective - checking edge cases, error handling, and making sure it's testable. When can I see it?\",\n      'DevOps Engineer': \"Happy to review! I'll check for security issues, scalability considerations, and deployment implications. Fire away!\"\n    };\n    return responses[role] || \"I'd be glad to provide feedback. Share what you need reviewed and I'll get back to you with thoughtful comments.\";\n  }\n\n  private getStatusUpdate(role: string): string {\n    const updates: Record<string, string> = {\n      'Developer': \"Making good progress on the core features. Authentication module is about 80% complete, working on the API integration next. Should have something demo-able by end of week.\",\n      'Product Manager': \"Sprint is on track! We've completed 60% of planned stories. There's some scope creep we need to discuss, but overall timeline looks good. Stakeholders are happy with progress.\",\n      'Designer': \"Design phase is going well. Completed wireframes for all main flows, now working on high-fidelity screens. Will have designs ready for dev handoff in 2-3 days.\",\n      'QA Engineer': \"Testing is progressing smoothly. Found and reported 5 bugs so far, 3 are already fixed. Setting up automated tests for the new features. Coverage is at 75%.\",\n      'DevOps Engineer': \"Infrastructure is stable. Deployment pipeline is working great - we're doing 3-4 deployments per day with zero downtime. Monitoring shows all systems green.\"\n    };\n    return updates[role] || \"Everything is moving forward nicely. I'll have a detailed update ready for the next standup. No major blockers on my end.\";\n  }\n\n  private getGenericResponse(role: string, message: string): string {\n    const responses = [\n      \"Good point! Let me think through this and provide a thoughtful response.\",\n      \"That's worth exploring. Based on my experience with similar projects, we have a few good options here.\",\n      \"Interesting question. I'll do some research and get back to you with concrete recommendations.\",\n      \"Thanks for bringing this up. Let's make sure we're aligned with the team on this approach.\"\n    ];\n    return responses[Math.floor(Math.random() * responses.length)];\n  }\n\n  private getFallbackCodeReview(reviewer: TeamMember): { content: string; approved: boolean; suggestions: string[] } {\n    return {\n      content: \"Thanks for the submission! The overall structure looks good. I have a few suggestions to make it even better.\",\n      approved: true,\n      suggestions: [\n        \"Consider adding error handling for edge cases\",\n        \"Could benefit from additional unit tests\",\n        \"Nice work on code organization and clarity\"\n      ]\n    };\n  }\n\n  private selectRespondingMembers(userMessage: string, channel: string, context: WorkspaceContext): TeamMember[] {\n    // Handle DM channels - only the specific member responds\n    if (channel.startsWith('dm-')) {\n      const memberName = channel.replace('dm-', '').trim();\n      \n      // Case-insensitive and trimmed comparison for robust member matching\n      const member = context.teamMembers.find(m => \n        m.name.trim().toLowerCase() === memberName.toLowerCase()\n      );\n      \n      if (!member) {\n        console.error(`[DM] Could not find member \"${memberName}\" for channel \"${channel}\"`);\n        return [];\n      }\n      \n      return [member];\n    }\n    \n    // Identify \"standby\" members - those with same role as user (senior helping junior)\n    // They're active during onboarding but step back afterwards\n    const isOnboarding = context.phase === 'onboarding';\n    const activeMembers = context.teamMembers.filter(m => m.role !== context.userRole || isOnboarding);\n    \n    // Simple selection logic - can be enhanced with more sophisticated rules\n    if (channel === 'standup') {\n      // In standup, everyone responds except standby members (unless onboarding)\n      return activeMembers;\n    }\n\n    if (channel === 'code-review' && context.userRole === 'Developer') {\n      return activeMembers.filter(m => m.role === 'Developer' || m.role === 'QA').slice(0, 1);\n    }\n\n    // Check for direct mentions (@name or name in text)\n    const mentionedMembers = this.extractMentionedMembers(userMessage, context.teamMembers);\n    \n    if (mentionedMembers.length > 0) {\n      // Filter by availability - 'always' responds 100%, 'usually' 80%, 'sometimes' 40%\n      // Important: Standby members CAN respond to @mentions even after onboarding\n      const responding = mentionedMembers.filter(member => {\n        if (member.availability === 'always') return true;\n        if (member.availability === 'usually') return Math.random() > 0.2;\n        if (member.availability === 'sometimes') return Math.random() > 0.6;\n        return true;\n      });\n      \n      // If mentioned person is not available, someone else picks it up 50% of the time\n      if (responding.length === 0 && Math.random() > 0.5) {\n        const others = activeMembers.filter(m => !mentionedMembers.includes(m));\n        return others.slice(0, 1);\n      }\n      \n      return responding;\n    }\n    \n    // For chat, select relevant team members (excluding standby after onboarding)\n    const relevantMembers = this.findRelevantMembers(userMessage, activeMembers);\n    \n    // Shuffle to get variety\n    const shuffled = [...relevantMembers].sort(() => Math.random() - 0.5);\n    \n    // Return 1-2 members (reduced from 1-3 for more realistic conversations)\n    const count = Math.floor(Math.random() * 2) + 1; // 1 to 2 members\n    return shuffled.slice(0, Math.min(count, shuffled.length));\n  }\n\n  /**\n   * Extract team members mentioned in the message (via @mention or name in text)\n   * Case-insensitive to handle both \"@Claire\" and \"@claire\"\n   */\n  private extractMentionedMembers(message: string, teamMembers: TeamMember[]): TeamMember[] {\n    const mentioned: TeamMember[] = [];\n    const lowerMessage = message.toLowerCase();\n    \n    for (const member of teamMembers) {\n      const firstName = member.name.split(' ')[0].toLowerCase();\n      const fullName = member.name.toLowerCase();\n      \n      // Check for @mentions (e.g., @Claire, @Ravi, @claire)\n      // Case-insensitive comparison\n      if (lowerMessage.includes(`@${firstName}`) || lowerMessage.includes(`@${fullName}`)) {\n        mentioned.push(member);\n        continue;\n      }\n      \n      // Check for name mentions in text (e.g., \"hey Claire\", \"ask Ravi\", \"Louise can you\")\n      const namePatterns = [\n        `hey ${firstName}`,\n        `hi ${firstName}`,\n        `ask ${firstName}`,\n        `${firstName} can`,\n        `${firstName} could`,\n        `${firstName},`,\n        ` ${firstName} `,\n        `${firstName}?`\n      ];\n      \n      if (namePatterns.some(pattern => lowerMessage.includes(pattern))) {\n        mentioned.push(member);\n      }\n    }\n    \n    return mentioned;\n  }\n\n  private findRelevantMembers(message: string, teamMembers: TeamMember[]): TeamMember[] {\n    const lowerMessage = message.toLowerCase();\n    \n    // Match based on keywords\n    const relevant = teamMembers.filter(member => {\n      const keywords = member.expertise.join(' ').toLowerCase();\n      return keywords.split(' ').some(keyword => lowerMessage.includes(keyword)) ||\n             lowerMessage.includes(member.role.toLowerCase());\n    });\n\n    // If no match, return random 1-2 members instead of always the first one\n    if (relevant.length === 0) {\n      const shuffled = [...teamMembers].sort(() => Math.random() - 0.5);\n      return shuffled.slice(0, Math.floor(Math.random() * 2) + 1); // 1-2 random members\n    }\n\n    return relevant;\n  }\n\n  private assessActionQuality(action: WorkspaceAction, context: WorkspaceContext): { score: number; feedback: string; impact: string } {\n    let score = 70; // Base score\n    let feedback = '';\n    let impact = 'neutral';\n\n    switch (action.type) {\n      case 'send-message':\n        const messageLength = action.data.content?.length || 0;\n        if (messageLength < 10) {\n          score = 50;\n          feedback = 'Message is quite brief. Providing more context helps team collaboration.';\n          impact = 'low';\n        } else if (messageLength > 50) {\n          score = 85;\n          feedback = 'Clear and detailed communication. Good collaboration!';\n          impact = 'positive';\n        } else {\n          score = 70;\n          feedback = 'Good communication.';\n          impact = 'neutral';\n        }\n        break;\n\n      case 'update-task':\n        score = 80;\n        feedback = 'Good job keeping the task board updated!';\n        impact = 'positive';\n        break;\n\n      case 'create-artifact':\n        score = 85;\n        feedback = 'Creating documentation is valuable for the team!';\n        impact = 'positive';\n        break;\n\n      case 'request-review':\n        score = 90;\n        feedback = 'Excellent! Requesting reviews promotes code quality.';\n        impact = 'positive';\n        break;\n\n      default:\n        score = 70;\n        feedback = 'Action completed.';\n        impact = 'neutral';\n    }\n\n    return { score, feedback, impact };\n  }\n\n  private addToMemory(sessionId: number, channel: string, message: ChannelMessage): void {\n    const key = `${sessionId}-${channel}`;\n    const memory = this.conversationMemory.get(key) || [];\n    memory.push(message);\n\n    // Keep only recent messages\n    if (memory.length > this.maxMemoryPerChannel) {\n      memory.shift();\n    }\n\n    this.conversationMemory.set(key, memory);\n  }\n\n  private getMemory(sessionId: number, channel: string): ChannelMessage[] {\n    const key = `${sessionId}-${channel}`;\n    return this.conversationMemory.get(key) || [];\n  }\n\n  clearMemory(sessionId: number, channel?: string): void {\n    if (channel) {\n      const key = `${sessionId}-${channel}`;\n      this.conversationMemory.delete(key);\n    } else {\n      // Clear all memory for this session\n      Array.from(this.conversationMemory.keys())\n        .filter(key => key.startsWith(`${sessionId}-`))\n        .forEach(key => this.conversationMemory.delete(key));\n    }\n  }\n}\n\nexport const workspaceOrchestrator = new WorkspaceOrchestrator();\n","path":null,"size_bytes":39576,"size_tokens":null},"client/src/components/simulation/codebase-explorer.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Folder, \n  FileCode, \n  FileText,\n  ChevronRight, \n  ChevronDown,\n  Book,\n  Code2,\n  FileJson\n} from \"lucide-react\";\n\ninterface CodebaseExplorerProps {\n  codebaseData: {\n    structure: Record<string, string[]>;\n    keyFiles: Array<{\n      path: string;\n      description: string;\n      snippet: string;\n    }>;\n  };\n  productInfo: {\n    name: string;\n    description: string;\n    existingFeatures: string[];\n    techStack: string[];\n    codebaseSize: string;\n    architecture: string;\n  };\n}\n\nexport default function CodebaseExplorer({ codebaseData, productInfo }: CodebaseExplorerProps) {\n  const [expandedFolders, setExpandedFolders] = useState<Set<string>>(new Set());\n  const [selectedFile, setSelectedFile] = useState<string | null>(null);\n\n  const toggleFolder = (folder: string) => {\n    const newExpanded = new Set(expandedFolders);\n    if (newExpanded.has(folder)) {\n      newExpanded.delete(folder);\n    } else {\n      newExpanded.add(folder);\n    }\n    setExpandedFolders(newExpanded);\n  };\n\n  const getFileIcon = (filename: string) => {\n    if (filename.endsWith('.tsx') || filename.endsWith('.ts')) return FileCode;\n    if (filename.endsWith('.json')) return FileJson;\n    if (filename.endsWith('.md')) return FileText;\n    return FileCode;\n  };\n\n  const selectedFileData = codebaseData.keyFiles.find(f => f.path === selectedFile);\n\n  return (\n    <div className=\"space-y-4\">\n      <Card data-testid=\"card-product-overview\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Book className=\"h-5 w-5\" />\n            {productInfo.name}\n          </CardTitle>\n          <CardDescription>{productInfo.description}</CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Existing Features</h4>\n            <div className=\"flex flex-wrap gap-2\">\n              {productInfo.existingFeatures.map((feature, idx) => (\n                <Badge key={idx} variant=\"outline\" className=\"text-xs\">\n                  {feature}\n                </Badge>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div>\n              <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Tech Stack</h4>\n              <div className=\"flex flex-wrap gap-1\">\n                {productInfo.techStack.map((tech, idx) => (\n                  <Badge key={idx} className=\"text-xs bg-blue-100 text-blue-800\">\n                    {tech}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n            <div>\n              <h4 className=\"font-semibold text-sm text-gray-700 mb-2\">Codebase Info</h4>\n              <p className=\"text-sm text-gray-600\">{productInfo.codebaseSize}</p>\n              <p className=\"text-sm text-gray-600\">{productInfo.architecture}</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Tabs defaultValue=\"structure\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"structure\" data-testid=\"tab-structure\">File Structure</TabsTrigger>\n          <TabsTrigger value=\"keyfiles\" data-testid=\"tab-keyfiles\">Key Files</TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"structure\" className=\"mt-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Project Structure</CardTitle>\n              <CardDescription>Explore the codebase organization</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-1\" data-testid=\"file-tree\">\n                {Object.entries(codebaseData.structure).map(([folder, files]) => (\n                  <div key={folder}>\n                    <button\n                      onClick={() => toggleFolder(folder)}\n                      className=\"flex items-center gap-2 w-full px-2 py-1.5 hover:bg-gray-100 rounded text-left\"\n                      data-testid={`folder-${folder.replace(/\\//g, '-')}`}\n                    >\n                      {expandedFolders.has(folder) ? (\n                        <ChevronDown className=\"h-4 w-4 text-gray-500\" />\n                      ) : (\n                        <ChevronRight className=\"h-4 w-4 text-gray-500\" />\n                      )}\n                      <Folder className=\"h-4 w-4 text-blue-500\" />\n                      <span className=\"text-sm font-medium text-gray-700\">{folder}/</span>\n                      <span className=\"text-xs text-gray-500\">({files.length} files)</span>\n                    </button>\n                    \n                    {expandedFolders.has(folder) && (\n                      <div className=\"ml-6 space-y-0.5\">\n                        {files.map((file) => {\n                          const Icon = getFileIcon(file);\n                          return (\n                            <div\n                              key={file}\n                              className=\"flex items-center gap-2 px-2 py-1 text-sm text-gray-600\"\n                              data-testid={`file-${file}`}\n                            >\n                              <Icon className=\"h-3.5 w-3.5 text-gray-400\" />\n                              <span>{file}</span>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        <TabsContent value=\"keyfiles\" className=\"mt-4\">\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            <Card className=\"lg:col-span-1\">\n              <CardHeader>\n                <CardTitle className=\"text-lg\">Important Files</CardTitle>\n                <CardDescription>Files relevant to your feature</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2\">\n                  {codebaseData.keyFiles.map((file) => (\n                    <button\n                      key={file.path}\n                      onClick={() => setSelectedFile(file.path)}\n                      className={`w-full text-left px-3 py-2 rounded-lg border transition-colors ${\n                        selectedFile === file.path\n                          ? 'border-blue-500 bg-blue-50'\n                          : 'border-gray-200 hover:border-gray-300 hover:bg-gray-50'\n                      }`}\n                      data-testid={`keyfile-${file.path.replace(/\\//g, '-')}`}\n                    >\n                      <div className=\"flex items-center gap-2\">\n                        <Code2 className=\"h-4 w-4 text-gray-500\" />\n                        <span className=\"text-sm font-medium text-gray-900 truncate\">\n                          {file.path.split('/').pop()}\n                        </span>\n                      </div>\n                      <p className=\"text-xs text-gray-500 mt-1 line-clamp-2\">\n                        {file.description}\n                      </p>\n                    </button>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"lg:col-span-2\">\n              <CardHeader>\n                <CardTitle className=\"text-lg\">File Preview</CardTitle>\n                {selectedFileData && (\n                  <CardDescription>{selectedFileData.path}</CardDescription>\n                )}\n              </CardHeader>\n              <CardContent>\n                {selectedFileData ? (\n                  <div className=\"space-y-3\">\n                    <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3\">\n                      <p className=\"text-sm text-blue-900\">{selectedFileData.description}</p>\n                    </div>\n                    <div className=\"bg-gray-900 rounded-lg p-4 overflow-x-auto\">\n                      <pre className=\"text-sm text-gray-100 font-mono\">\n                        <code>{selectedFileData.snippet}</code>\n                      </pre>\n                    </div>\n                  </div>\n                ) : (\n                  <div className=\"text-center py-12 text-gray-500\" data-testid=\"no-file-selected\">\n                    <Code2 className=\"h-12 w-12 mx-auto mb-3 text-gray-400\" />\n                    <p>Select a file to view its details and code snippet</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </div>\n        </TabsContent>\n      </Tabs>\n    </div>\n  );\n}\n","path":null,"size_bytes":8912,"size_tokens":null},"frontend/vite.config.ts":{"content":"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\n// https://vitejs.dev/config/\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    host: '0.0.0.0',\n    port: 5175,\n    allowedHosts: ['.replit.dev', '.repl.co'],\n    hmr: false,\n  },\n})\n","path":null,"size_bytes":280,"size_tokens":null},"frontend/src/components/pagination/limiter.tsx":{"content":"import { PaginationControls } from '../../features/app/_store/state'\nimport styles from './limiter.module.css'\n\nconst Limiter = ({\n    count,\n    offset,\n    limit,\n    limits,\n    onLimitChange,\n}: Pick<PaginationControls, 'limit' | 'offset'> & {\n    count: number\n    limits: number[]\n    onLimitChange: (limit: number) => void\n}) => {\n    const itemFrom = offset! + 1\n    const itemTo = offset! + count\n\n    return (\n        <sl-dropdown placement=\"top\">\n            <sl-button slot=\"trigger\" className={styles.trigger} variant=\"default\">\n                <sl-icon slot=\"suffix\" name=\"chevron-down\"></sl-icon>\n                {itemFrom} - {itemTo}\n            </sl-button>\n            <sl-menu className={styles.menu}>\n                <sl-menu-label>Items per page</sl-menu-label>\n                {limits.map((l) => (\n                    <sl-menu-item\n                        key={l}\n                        checked={l == limit}\n                        onClick={() => onLimitChange(l)}\n                    >\n                        {l}\n                    </sl-menu-item>\n                ))}\n            </sl-menu>\n        </sl-dropdown>\n    )\n}\n\nexport default Limiter\n","path":null,"size_bytes":1172,"size_tokens":null},"frontend/src/components/logo/index.tsx":{"content":"import styles from './index.module.css'\n\ninterface LogoProps {\n    size?: string\n}\n\nconst Logo = ({ size = 'small' }: LogoProps) => (\n    <div className={`${styles.logo} ${styles[size]}`}>\n        <sl-icon slot=\"prefix\" name=\"star-fill\" />\n    </div>\n)\n\nexport default Logo\n","path":null,"size_bytes":274,"size_tokens":null},"frontend/src/features/auth/require-auth.tsx":{"content":"import { jwtDecode, JwtPayload } from 'jwt-decode'\nimport { FC, useCallback, useEffect, useRef, useState } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { isNone, isNullish } from '../../utils'\nimport { RootDispatch } from '../app/_store'\nimport { Status } from '../app/_store/state'\nimport navigation from '../app/navigation'\nimport { profile, refreshToken } from './_store/effects'\nimport { logout } from './_store/reducer'\nimport { ACCESS_TOKEN } from './_store/state'\nimport useAuth from './use-auth'\n\ntype DecodePayload = JwtPayload & {\n    token_type: 'refresh' | 'access'\n}\n\nexport const RequireAuth: FC = ({ children }) => {\n    const dispatch = useDispatch<RootDispatch>()\n    const { status, error, token, refresh } = useAuth()\n    const [isAuthenticated, setIsAuthenticated] = useState(false)\n    const isSuccess = status === Status.SUCCESS\n\n    const refreshTimerRef = useRef<number | undefined>()\n\n    const handleRefresh = useCallback(() => {\n        const token = globalThis.localStorage.getItem(ACCESS_TOKEN)\n\n        if (!isNone(token)) {\n            dispatch(refreshToken())\n        }\n    }, [dispatch])\n\n    const handleTokenValidation = useCallback(() => {\n        const decodedRefreshToken = jwtDecode(refresh!) as DecodePayload\n        const decodedAccessToken = jwtDecode(token!) as DecodePayload\n\n        if (\n            decodedRefreshToken.token_type !== 'refresh' ||\n            decodedAccessToken.token_type !== 'access'\n        ) {\n            throw new Error('Invalid Token')\n        }\n\n        const tokenExpirationDate = decodedAccessToken.exp!\n        const refreshTokenExpirationDate = decodedRefreshToken.exp!\n\n        const now = Date.now() / 1000\n\n        if (refreshTokenExpirationDate > now) {\n            if (tokenExpirationDate > now) {\n                setIsAuthenticated(true)\n\n                refreshTimerRef.current = globalThis.setTimeout(\n                    handleRefresh,\n                    (tokenExpirationDate - now) * 1000,\n                )\n\n                return\n            }\n            handleRefresh()\n        } else {\n            throw new Error('Authentication required')\n        }\n    }, [token, refresh, handleRefresh])\n\n    useEffect(() => {\n        try {\n            if (error && status === Status.ERROR) {\n                throw new Error(error)\n            }\n\n            handleTokenValidation()\n        } catch (err) {\n            setIsAuthenticated(false)\n            dispatch(logout())\n            navigation.goToLoginPage()\n        }\n\n        return () => {\n            globalThis.clearTimeout(refreshTimerRef.current)\n        }\n    }, [error, status, handleTokenValidation, dispatch])\n\n    useEffect(() => {\n        if (isAuthenticated && isSuccess && !isNone(token)) {\n            dispatch(profile())\n        }\n    }, [isAuthenticated, isSuccess, token, dispatch])\n\n    return !isNullish(token) && isAuthenticated ? <>{children}</> : null\n}\n","path":null,"size_bytes":2928,"size_tokens":null},"frontend/src/features/negotiation-feedback/index.tsx":{"content":"import { FC } from 'react'\nimport { useCallback, useEffect } from 'react'\nimport { useDispatch } from 'react-redux'\nimport DOMPurify from 'dompurify'\nimport SimulationHeader from '../../components/simulation-header'\nimport { isNullish } from '../../utils'\nimport { isNone } from '../../utils/is-none'\nimport { useOnce } from '../../utils/use-once'\nimport { RootDispatch } from '../app/_store'\nimport { Status } from '../app/_store/state'\nimport navigation from '../app/navigation'\nimport { SIMULATION_ICONS } from '../dashboard/models'\nimport {\n    resetOfferNegotiation,\n    setNegotiationSessionId,\n} from '../offer-negotiation/_store/reducer'\nimport useOfferNegotiation from '../offer-negotiation/_store/use-offer-negotiation'\nimport { generateNegotiationFeedback } from './_store/effects'\nimport { resetNegotiationFeedback } from './_store/reducer'\nimport { default as useNegotiationFeedback } from './_store/use-interview-feedback'\nimport Tabs from './_tabs'\nimport { NegotiationFeedbackTabs } from './_tabs/headers'\nimport styles from './index.module.css'\nimport NegotiatedOffer from './negotiated-offer'\nimport NegotiationHistory from './negotiation-history'\n\nconst Skeleton = () => {\n    return (\n        <center-l>\n            <stack-l space=\"var(--s-1)\">\n                Hang tight as we are generating the negotiation feedback.\n                <center-l andText>\n                    <h2>\n                        <sl-spinner></sl-spinner>\n                    </h2>\n                </center-l>\n            </stack-l>\n        </center-l>\n    )\n}\n\nconst Controls: FC<{\n    disabled: boolean\n    onRetake: () => void\n    onDone: () => void\n}> = ({ disabled, onDone, onRetake }) => {\n    return (\n        <cluster-l justify=\"flex-end\" className={styles.footer}>\n            <cluster-l space=\"var(--s-2)\">\n                <sl-button onClick={onRetake} disabled={disabled}>\n                    <sl-icon name=\"arrow-repeat\" slot=\"prefix\" />\n                    Repeat Simulation\n                </sl-button>\n                <sl-button\n                    onClick={onDone}\n                    variant=\"primary\"\n                    disabled={disabled}\n                >\n                    <sl-icon name=\"check\" slot=\"prefix\" />\n                    Done\n                </sl-button>\n            </cluster-l>\n        </cluster-l>\n    )\n}\n\nconst InterviewFeedback = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId } = useOfferNegotiation()\n    const { feedback, areas_for_improvement, status } = useNegotiationFeedback()\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (!isNullish(routeSessionId)) {\n            dispatch(setNegotiationSessionId(routeSessionId))\n            dispatch(\n                generateNegotiationFeedback({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    useEffect(() => {\n        if (!isNullish(sessionId)) {\n            navigation.goToSearchParams({\n                sessionId,\n            })\n        }\n    }, [sessionId])\n\n    const handleReset = useCallback(() => {\n        dispatch(resetNegotiationFeedback())\n        dispatch(resetOfferNegotiation())\n    }, [dispatch])\n\n    const handleRetake = useCallback(() => {\n        handleReset()\n        navigation.goToOfferNegotiation()\n    }, [handleReset])\n\n    const handleDone = useCallback(() => {\n        handleReset()\n        navigation.goToHome()\n    }, [handleReset])\n\n    const isPending = status === Status.PENDING\n\n    return (\n        <cover-l space=\"0\">\n            <SimulationHeader\n                icon={SIMULATION_ICONS.OFFER_NEGOTIATION}\n                title=\"Offer Negotiation\"\n                onExit={handleDone}\n            />\n            <stack-l space=\"0\" className={styles.tabWrapper}>\n                <Tabs isPending={isPending}>\n                    <sl-tab-panel\n                        name={NegotiationFeedbackTabs.FEEDBACK}\n                        active\n                    >\n                        <stack-l space=\"var(--s-2)\">\n                            {isPending ? (\n                                <Skeleton />\n                            ) : (\n                                <stack-l space=\"var(--s-1)\">\n                                    {!isNone(feedback) ? (\n                                        <stack-l\n                                            space=\"var(--s-3)\"\n                                            className={styles.feedback}\n                                        >\n                                            <h1>Negotiation Feedback</h1>\n\n                                            <div\n                                                className={styles.feedback}\n                                                dangerouslySetInnerHTML={{\n                                                    __html: DOMPurify.sanitize(\n                                                        feedback!,\n                                                    ),\n                                                }}\n                                            ></div>\n                                        </stack-l>\n                                    ) : null}\n\n                                    {!isNone(areas_for_improvement) ? (\n                                        <stack-l\n                                            space=\"var(--s-3)\"\n                                            className={styles.feedback}\n                                        >\n                                            <h3>Areas for Improvement</h3>\n                                            <div\n                                                className={styles.feedback}\n                                                dangerouslySetInnerHTML={{\n                                                    __html: DOMPurify.sanitize(\n                                                        areas_for_improvement!,\n                                                    ),\n                                                }}\n                                            ></div>\n                                        </stack-l>\n                                    ) : null}\n                                </stack-l>\n                            )}\n                        </stack-l>\n                    </sl-tab-panel>\n\n                    <sl-tab-panel name={NegotiationFeedbackTabs.OFFER}>\n                        <NegotiatedOffer />\n                    </sl-tab-panel>\n\n                    <sl-tab-panel\n                        name={NegotiationFeedbackTabs.REVIEW_QUESTIONS}\n                    >\n                        <NegotiationHistory />\n                    </sl-tab-panel>\n                </Tabs>\n            </stack-l>\n\n            <Controls\n                disabled={isPending}\n                onRetake={handleRetake}\n                onDone={handleDone}\n            />\n        </cover-l>\n    )\n}\n\nexport default InterviewFeedback\n","path":null,"size_bytes":6995,"size_tokens":null},"frontend/src/features/negotiation-feedback/negotiated-offer/index.tsx":{"content":"import DOMPurify from 'dompurify'\nimport useAuth from '../../auth/use-auth'\nimport useNegotiationFeedback from '../_store/use-interview-feedback'\nimport styles from './index.module.css'\n\nconst Offer = () => {\n    const { offer } = useNegotiationFeedback()\n    const { user } = useAuth()\n\n    return offer ? (\n        <stack-l space=\"0\" className={styles.wrapper}>\n            <cover-l minHeight=\"100vh\">\n                <center-l>\n                    <stack-l space=\"var(--s-1)\">\n                        <stack-l className={styles.card}>\n                            <stack-l space=\"var(--s-3)\">\n                                <h4>Job Offer</h4>\n\n                                <h5>{user?.get_full_name}</h5>\n                            </stack-l>\n                        </stack-l>\n\n                        <stack-l\n                            className={styles.card}\n                            space=\"var(--s-5)\"\n                            dangerouslySetInnerHTML={{\n                                __html: DOMPurify.sanitize(offer!),\n                            }}\n                        />\n                    </stack-l>\n                </center-l>\n            </cover-l>\n        </stack-l>\n    ) : null\n}\n\nexport default Offer\n","path":null,"size_bytes":1236,"size_tokens":null},"frontend/src/utils/use-resize-observer.ts":{"content":"import { RefObject } from 'react'\nimport { useEffect, useRef, useState } from 'react'\n\n/**\n * Custom hook that uses the ResizeObserver API to track changes in the size of an element.\n *\n * @param {RefObject<HTMLElement | null | undefined>} elRef - Reference to the observed element.\n * @returns {number} - The current width of the observed element.\n *\n * @example\n * // Example of using useResizeObserver with a functional component\n * const ResizableComponent = () => {\n *     const elRef = useRef(null);\n *     const width = useResizeObserver(elRef);\n *\n *     return (\n *         <div ref={elRef}>\n *             Element width: {width}px\n *         </div>\n *     );\n * };\n */\nexport function useResizeObserver(\n    elRef: RefObject<HTMLElement | null | undefined>,\n): number {\n    const initialSize = window && window.innerWidth\n\n    const [layoutSize, setLayoutSize] = useState<number>(initialSize)\n\n    const observer = useRef(\n        new ResizeObserver((entries) => {\n            const { width } = entries[0].contentRect\n            setLayoutSize(width)\n        }),\n    )\n\n    useEffect(() => {\n        const observerCurrent = observer.current\n        let el: HTMLDivElement | HTMLElement | null = null\n\n        if (elRef.current) {\n            el = elRef.current\n            observerCurrent.observe(elRef.current)\n        }\n\n        return () => {\n            if (el) {\n                observerCurrent.unobserve(el)\n            }\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [elRef.current, observer])\n\n    return layoutSize\n}\n","path":null,"size_bytes":1571,"size_tokens":null},"frontend/src/features/dashboard/account-form/career/index.tsx":{"content":"import { SlRadioGroup } from '@shoelace-style/shoelace'\nimport { FC } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { CareerEnum, UserProfileUpdateDto } from '../../../../__generated__/api'\nimport { CareerEnumString, toCareerChoice } from '../../../../utils/models'\nimport { FORM_NAMES } from '../models'\n\nconst Career: FC<{\n    formData?: UserProfileUpdateDto | null\n    handleChange: (e: CustomEvent) => void\n}> = ({ formData, handleChange }) => {\n    const radioRef = useRef<SlRadioGroup | null>(null)\n\n    useEffect(() => {\n        radioRef.current?.addEventListener('sl-change', (e) => {\n            handleChange(e)\n        })\n    }, [handleChange])\n\n    return (\n        <stack-l space=\"var(--s-2)\">\n            <sl-radio-group\n                ref={radioRef}\n                name={FORM_NAMES.CAREER}\n                label=\"Select career\"\n                required\n                value={formData?.career}\n            >\n                <cluster-l space=\"var(--s0)\">\n                    {Object.keys(CareerEnum)?.map((key) => (\n                        <sl-radio-button\n                            key={key}\n                            value={CareerEnum[key as CareerEnumString]}\n                        >\n                            {\n                                toCareerChoice[\n                                    CareerEnum[key as CareerEnumString]\n                                ]\n                            }\n                        </sl-radio-button>\n                    ))}\n                </cluster-l>\n            </sl-radio-group>\n        </stack-l>\n    )\n}\n\nexport default Career\n","path":null,"size_bytes":1614,"size_tokens":null},"frontend/src/components/circle-icon/index.tsx":{"content":"import { FC } from 'react'\nimport { SlButtonProps } from '../../ui/shoelace/shoelace'\nimport styles from './index.module.css'\n\nconst CircleIcon: FC<\n    {\n        icon: string\n        class?: string\n    } & SlButtonProps\n> = ({ icon, ...props }) => {\n    return (\n        <sl-button {...props} circle className={styles.circleIcon}>\n            <sl-icon name={icon}></sl-icon>\n        </sl-button>\n    )\n}\n\nexport default CircleIcon\n","path":null,"size_bytes":432,"size_tokens":null},"frontend/src/features/app/context.tsx":{"content":"import { createContext, useRef, ReactNode } from 'react'\n\nexport const rootContainer = document.querySelector('html') as HTMLElement\nexport const appContainer = document.getElementById('app') as HTMLDivElement\n\nexport interface AppContext {\n    containerElRef: React.React.MutableRefObjectObject<HTMLElement>\n}\nexport const AppContext = createContext<AppContext>({} as AppContext)\n\nexport type AppContextProviderProps = {\n    children: ReactNode\n}\n\nexport const AppContextProvider = ({\n    children,\n    ...appContext\n}: AppContextProviderProps) => {\n    const containerElRef = useRef<HTMLElement>(rootContainer)\n\n    return (\n        <AppContext.Provider value={{ ...appContext, containerElRef }}>\n            {children}\n        </AppContext.Provider>\n    )\n}\n","path":null,"size_bytes":761,"size_tokens":null},"frontend/src/components/intro-drawer/instructions/index.tsx":{"content":"import styles from './index.module.css'\n\nconst Instructions = () => {\n    return (\n        <stack-l className={styles.instructions} space=\"var(--s-2)\">\n            <h3>Instructions</h3>\n            <ul>\n                <li>\n                    Carefully read and review all the questions before\n                    answering. You can record your answer or type instead.\n                </li>\n                <li>\n                    Once youre done with all the questions, review your answers\n                    and explore tips and recommendations for each question.\n                </li>\n            </ul>\n        </stack-l>\n    )\n}\n\nexport default Instructions\n","path":null,"size_bytes":668,"size_tokens":null},"frontend/src/ui/shoelace/shoelace.d.ts":{"content":"import { SlRadioGroup } from '@shoelace-style/shoelace'\nimport { SlAlert } from '@shoelace-style/shoelace/dist/react/alert'\nimport { SlCard } from '@shoelace-style/shoelace/dist/react/card'\nimport { SlCheckbox } from '@shoelace-style/shoelace/dist/react/checkbox'\nimport { SlDialog } from '@shoelace-style/shoelace/dist/react/dialog'\nimport { SlSkeleton } from '@shoelace-style/shoelace/dist/react/skeleton'\nimport { SlTooltip } from '@shoelace-style/shoelace/dist/react/tooltip'\nimport { ReactNode } from 'react'\nimport { Ref } from 'react'\nimport { JSXInternal } from 'preact/src/jsx'\n\ntype WebComponentAttributes = JSX.IntrinsicAttributes &\n    Partial<JSX.ElementChildrenAttribute> & {\n        class?: string | undefined\n        slot?: string\n        style?: string | JSXInternal.CSSProperties | undefined\n    }\n\ntype Size = 'small' | 'medium' | 'large'\ntype Variant =\n    | 'primary'\n    | 'success'\n    | 'neutral'\n    | 'warning'\n    | 'danger'\n    | 'text'\n    | 'default'\n\ntype SkeletonEffect = 'pulse' | 'sheen' | 'none'\ntype Placement = 'top' | 'end' | 'bottom' | 'start'\ntype DropdownPlacement =\n    | 'top'\n    | 'top-start'\n    | 'top-end'\n    | 'bottom'\n    | 'bottom-start'\n    | 'bottom-end'\n    | 'right'\n    | 'right-start'\n    | 'right-end'\n    | 'left'\n    | 'left-start'\n    | 'left-end'\n\ninterface SlAlertProps {\n    closable?: boolean\n    duration?: string\n    open?: boolean\n    ref?: Ref<SlAlert | undefined>\n    variant?: Variant\n}\n\ninterface SlAvatarProps {\n    initials?: string\n    shape?: 'circle' | 'square' | 'rounded'\n    image?: string\n    loading?: 'eager' | 'lazy'\n}\n\ninterface SlBadgeProps {\n    pill?: true\n    variant?: Variant\n}\n\ninterface SlButtonProps {\n    caret?: boolean\n    circle?: true\n    disabled?: boolean\n    loading?: boolean\n    pill?: true\n    outline?: true\n    size?: Size\n    submit?: true\n    type?: 'button' | 'submit'\n    variant?: Variant\n    onClick?: JSXInternal.MouseEventHandler<HTMLButtonElement>\n}\n\ninterface SlButtonGroupProps {\n    label?: string\n}\n\ninterface SlCardProps {\n    class?: string\n    name?: string\n    ref?: Ref<SlCard | undefined>\n    onClick?: (e: Event) => void\n}\n\ninterface SlCheckboxProps {\n    input?: HTMLInputElement\n    name?: string\n    value?: string\n    disabled?: boolean\n    required?: boolean\n    checked?: boolean\n    indeterminate?: boolean\n    invalid?: boolean\n    ref?: Ref<SlCheckbox | undefined>\n}\n\ninterface SlDialogProps {\n    label?: string\n    open?: boolean\n    ref?: Ref<SlDialog | undefined>\n}\n\ninterface SlDrawerProps {\n    contained?: boolean\n    label?: string\n    noHeader?: boolean\n    open?: boolean\n    placement?: Placement\n}\n\ninterface SlDropDownProps {\n    containingElement?: HTMLElement\n    disabled?: boolean\n    distance?: number\n    hoist?: boolean\n    open?: boolean\n    panel?: HTMLElement\n    placement?: DropdownPlacement\n    positioner?: HTMLElement\n    trigger?: HTMLElement\n    skidding?: number\n    stayOpenOnSelect?: boolean\n    handleOpenChange?(): Promise<void>\n    hide?(): Promise<void>\n    show?(): Promise<void>\n}\n\ninterface SlIconProps {\n    name?: string\n    variant?: Variant\n    src?: string\n}\n\ninterface SlIconButtonProps extends SlButtonProps {\n    name?: string\n    onFocus?: JSXInternal.FocusEventHandler<HTMLButtonElement>\n}\n\ninterface SlInputProps\n    extends JSXInternal.DOMAttributes<HTMLInputElement>,\n        Omit<JSXInternal.HTMLAttributes<HTMLInputElement>, 'size'> {\n    'size'?: Size\n    'type'?:\n        | 'date'\n        | 'email'\n        | 'number'\n        | 'password'\n        | 'search'\n        | 'tel'\n        | 'text'\n        | 'url'\n    'name'?: string\n    'value'?: string\n    'filled'?: boolean\n    'pill'?: boolean\n    'label'?: string\n    'helpText'?: string\n    'clearable'?: boolean\n    'togglePassword'?: boolean\n    'placeholder'?: string\n    'disabled'?: boolean\n    'readonly'?: boolean\n    'minlength'?: number\n    'maxlength'?: number\n    'min'?: number | string\n    'max'?: number | string\n    'step'?: number\n    'pattern'?: string\n    'required'?: boolean\n    'invalid'?: boolean\n    'autocapitalize'?:\n        | 'off'\n        | 'none'\n        | 'on'\n        | 'sentences'\n        | 'words'\n        | 'characters'\n    'autocorrect'?: string\n    'autocomplete'?: string\n    'autofocus'?: boolean\n    'spellcheck'?: boolean\n    'inputmode'?:\n        | 'none'\n        | 'text'\n        | 'decimal'\n        | 'numeric'\n        | 'tel'\n        | 'search'\n        | 'email'\n        | 'url'\n    'valueAsDate'?: Date\n    'valueAsNumber'?: number\n    'sl-change'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-clear'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-input'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-focus'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-blur'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n}\n\ninterface SlMenuItemProps {\n    checked?: boolean\n    disabled?: boolean\n    value?: string\n    onClick?: JSXInternal.MouseEventHandler<HTMLButtonElement>\n}\ninterface SlMenuLabelProps {}\n\ninterface SlOptionProps {\n    value: string\n    disabled?: boolean\n}\n\ninterface SlPopupProps {\n    active?: boolean\n    anchor?: Element | string | VirtualElement\n    arrow?: boolean\n    arrowPadding?: number\n    arrowPlacement?: 'start' | 'end' | 'center' | 'anchor'\n    disabled?: boolean\n    distance?: number\n    flip?: boolean\n    flipBoundary?: Element | Element[]\n    flipFallbackPlacements?: string\n    flipFallbackStrategy?: 'best-fit' | 'initial'\n    flipPadding?: number\n    hoist?: boolean\n    open?: boolean\n    placement?:\n        | 'top'\n        | 'top-start'\n        | 'top-end'\n        | 'bottom'\n        | 'bottom-start'\n        | 'bottom-end'\n        | 'right'\n        | 'right-start'\n        | 'right-end'\n        | 'left'\n        | 'left-start'\n        | 'left-end'\n    popup?: HTMLElement\n    shift?: boolean\n    skidding?: number\n    strategy?: 'absolute' | 'fixed'\n}\n\ninterface SlRadioGroupProps {\n    name?: string\n    label?: string\n    required?: boolean\n    value?: string\n    onInput?: () => void\n    ref?: Ref<SlRadioGroup>\n}\ninterface SlRadioButtonProps {\n    value?: string\n    pill?: boolean\n    size?: Size\n}\n\ninterface SlSelectProps\n    extends JSXInternal.DOMAttributes<HTMLSelectElement>,\n        Omit<JSXInternal.HTMLAttributes<HTMLSelectElement>, 'size'> {\n    'clearable'?: boolean\n    'disabled'?: boolean\n    'filled'?: boolean\n    'helpText'?: string\n    'hoist'?: boolean\n    'invalid'?: boolean\n    'label'?: string\n    'maxTagsVisible'?: number\n    'multiple'?: boolean\n    'name'?: string\n    'pill'?: boolean\n    'placeholder'?: string\n    'required'?: boolean\n    'size'?: Size\n    'handleClearClick'?: (\n        e: JSXInternal.TargetedEvent<HTMLSelectElement>,\n    ) => void\n    'sl-blur'?: (e: JSXInternal.TargetedEvent<HTMLSelectElement>) => void\n    'sl-change'?: (e: JSXInternal.TargetedEvent<HTMLSelectElement>) => void\n    'sl-clear'?: (e: JSXInternal.TargetedEvent<HTMLSelectElement>) => void\n    'sl-focus'?: (e: JSXInternal.TargetedEvent<HTMLSelectElement>) => void\n    'sl-input'?: (e: JSXInternal.TargetedEvent<HTMLSelectElement>) => void\n    'value'?: string | Array<string>\n    'children'?: ReactNode\n}\n\ninterface SlSkeletonProps {\n    ref?: Ref<SlSkeleton | undefined>\n    effect?: SkeletonEffect\n    label?: string\n}\n\ninterface SlSpinnerProps {}\n\ninterface SlSwitchProps {\n    name?: string\n    value?: string\n    disabled?: boolean\n    required?: boolean\n    checked?: boolean\n    invalid?: boolean\n    handleClick?: () => void\n}\n\ninterface SlTabProps {\n    active?: boolean\n    closable?: boolean\n    disabled?: boolean\n    panel?: string\n}\n\ninterface SlTabGroupProps {\n    activation?: 'auto' | 'manual'\n    noScrollControls?: boolean\n    placement?: Placement\n}\n\ninterface SlTabPanelProps {\n    active?: boolean\n    name?: string\n}\ninterface SlTextareaProps\n    extends JSXInternal.DOMAttributes<HTMLTextAreaElement>,\n        Omit<JSXInternal.HTMLAttributes<HTMLTextAreaElement>, 'size'> {\n    'size'?: 'small' | 'medium' | 'large'\n    'name'?: string\n    'value'?: string\n    'filled'?: boolean\n    'label'?: string\n    'helpText'?: string\n    'placeholder'?: string\n    'rows'?: number\n    'resize'?: 'none' | 'vertical' | 'auto'\n    'disabled'?: boolean\n    'readonly'?: boolean\n    'minlength'?: number\n    'maxlength'?: number\n    'pattern'?: string\n    'required'?: boolean\n    'invalid'?: boolean\n    'autocapitalize'?:\n        | 'off'\n        | 'none'\n        | 'on'\n        | 'sentences'\n        | 'words'\n        | 'characters'\n    'autocorrect'?: string\n    'autocomplete'?: string\n    'autofocus'?: boolean\n    'spellcheck'?: boolean\n    'inputmode'?:\n        | 'none'\n        | 'text'\n        | 'decimal'\n        | 'numeric'\n        | 'tel'\n        | 'search'\n        | 'email'\n        | 'url'\n    'sl-change'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-clear'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-input'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-focus'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n    'sl-blur'?: (e: JSXInternal.TargetedEvent<HTMLInputElement>) => void\n}\n\ninterface SlTooltipProps {\n    positioner?: HTMLElement\n    tooltip?: HTMLElement\n    content?: string\n    placement?:\n        | 'top'\n        | 'top-start'\n        | 'top-end'\n        | 'right'\n        | 'right-start'\n        | 'right-end'\n        | 'bottom'\n        | 'bottom-start'\n        | 'bottom-end'\n        | 'left'\n        | 'left-start'\n        | 'left-end'\n    disabled?: boolean\n    distance?: number\n    open?: boolean\n    skidding?: number\n    trigger?: string\n    hoist?: boolean\n    ref?: Ref<SlTooltip | undefined>\n}\n\ndeclare global {\n    namespace JSX {\n        interface IntrinsicElements {\n            'sl-alert': SlAlertProps & WebComponentAttributes\n            'sl-avatar': SlAvatarProps & WebComponentAttributes\n            'sl-badge': SlBadgeProps & WebComponentAttributes\n            'sl-button': SlButtonProps & WebComponentAttributes\n            'sl-button-group': SlButtonGroupProps & WebComponentAttributes\n            'sl-card': SlCardProps & WebComponentAttributes\n            'sl-checkbox': SlCheckboxProps & WebComponentAttributes\n            'sl-dialog': SlDialogProps & WebComponentAttributes\n            'sl-drawer': SlDrawerProps & WebComponentAttributes\n            'sl-dropdown': SlDropDownProps & WebComponentAttributes\n            'sl-icon': SlIconProps & WebComponentAttributes\n            'sl-icon-button': SlIconButtonProps & WebComponentAttributes\n            'sl-input': SlInputProps & WebComponentAttributes\n            'sl-menu': WebComponentAttributes\n            'sl-menu-item': SlMenuItemProps & WebComponentAttributes\n            'sl-menu-label': SlMenuLabelProps & WebComponentAttributes\n            'sl-option': SlOptionProps & WebComponentAttributes\n            'sl-popup': SlPopupProps & WebComponentAttributes\n            'sl-radio-group': SlRadioGroupProps & WebComponentAttributes\n            'sl-radio-button': SlRadioButtonProps & WebComponentAttributes\n            'sl-select': SlSelectProps & WebComponentAttributes\n            'sl-skeleton': SlSkeletonProps & WebComponentAttributes\n            'sl-spinner': SlSpinnerProps & WebComponentAttributes\n            'sl-switch': SlSwitchProps & WebComponentAttributes\n            'sl-tab': SlTabProps & WebComponentAttributes\n            'sl-tab-group': SlTabGroupProps & WebComponentAttributes\n            'sl-tab-panel': SlTabPanelProps & WebComponentAttributes\n            'sl-textarea': SlTextareaProps & WebComponentAttributes\n            'sl-tooltip': SlTooltipProps & WebComponentAttributes\n        }\n    }\n}\n","path":null,"size_bytes":11757,"size_tokens":null},"frontend/src/features/offer-negotiation/index.tsx":{"content":"import { useCallback, useEffect } from 'react'\nimport { useDispatch } from 'react-redux'\nimport IntroDrawer, {\n    IntroDrawerHeaderProps,\n} from '../../components/intro-drawer'\nimport SimulationHeader from '../../components/simulation-header'\nimport { isNullish } from '../../utils'\nimport { useOnce } from '../../utils/use-once'\nimport { RootDispatch } from '../app/_store'\nimport navigation from '../app/navigation'\nimport { SIMULATION_ICONS } from '../dashboard/models'\nimport {\n    getNegotiationHistory,\n    startNegotiationSession,\n} from './_store/effects'\nimport {\n    resetOfferNegotiation,\n    setNegotiationSessionId,\n} from './_store/reducer'\nimport useOfferNegotiation from './_store/use-offer-negotiation'\nimport NegotiationChat from './chat'\nimport NegotiationDrawerFooter from './drawer-footer'\nimport InitialOffer from './offer'\n\nconst INTRO_DRAWER_CONTENT: IntroDrawerHeaderProps = {\n    title: 'Offer Negotiation',\n    description: 'Practice negotiating a job offer.',\n    icon: SIMULATION_ICONS.OFFER_NEGOTIATION,\n}\n\nconst OfferNegotiation = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId, showNegotiation } = useOfferNegotiation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (isNullish(sessionId) && !isNullish(routeSessionId)) {\n            dispatch(setNegotiationSessionId(routeSessionId))\n            dispatch(\n                getNegotiationHistory({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    useEffect(() => {\n        if (!isNullish(sessionId)) {\n            navigation.goToSearchParams({\n                sessionId,\n            })\n        }\n    }, [sessionId])\n\n    return showNegotiation ? <NegotiationChat /> : <InitialOffer />\n}\n\nconst OfferNegotiationFeature = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const dispatch = useDispatch<RootDispatch>()\n\n    const handleExit = useCallback(() => {\n        dispatch(resetOfferNegotiation())\n        navigation.goToHome()\n    }, [dispatch])\n\n    const handleStart = useCallback(() => {\n        dispatch(startNegotiationSession())\n    }, [dispatch])\n\n    return (\n        <cover-l space=\"0\">\n            <SimulationHeader\n                icon={SIMULATION_ICONS.OFFER_NEGOTIATION}\n                title=\"Offer Negotiation\"\n                onExit={handleExit}\n            />\n\n            <IntroDrawer\n                open={isNullish(routeSessionId)}\n                footer={<NegotiationDrawerFooter onStart={handleStart} />}\n                {...INTRO_DRAWER_CONTENT}\n            />\n\n            <OfferNegotiation />\n        </cover-l>\n    )\n}\n\nexport default OfferNegotiationFeature\n","path":null,"size_bytes":2788,"size_tokens":null},"frontend/src/features/dashboard/account-form/seniority/index.tsx":{"content":"import { SlRadioGroup } from '@shoelace-style/shoelace'\nimport { FC } from 'react'\nimport { useEffect, useRef } from 'react'\nimport {\n    SeniorityLevelEnum,\n    UserProfileUpdateDto,\n} from '../../../../__generated__/api'\nimport {\n    SeniorityLevelEnumString,\n    toSeniorityChoice,\n} from '../../../../utils/models'\nimport { FORM_NAMES } from '../models'\n\nconst Seniority: FC<{\n    formData?: UserProfileUpdateDto | null\n    handleChange: (e: CustomEvent) => void\n}> = ({ formData, handleChange }) => {\n    const radioRef = useRef<SlRadioGroup | null>(null)\n\n    useEffect(() => {\n        radioRef.current?.addEventListener('sl-change', (e) => {\n            handleChange(e)\n        })\n    }, [handleChange])\n\n    return (\n        <stack-l space=\"var(--s-2)\">\n            <sl-radio-group\n                ref={radioRef}\n                name={FORM_NAMES.SENIORITY}\n                label=\"Select your seniority\"\n                required\n                value={formData?.seniority_level}\n            >\n                <cluster-l space=\"var(--s0)\">\n                    {Object.keys(SeniorityLevelEnum)?.map((key) => (\n                        <sl-radio-button\n                            key={key}\n                            value={\n                                SeniorityLevelEnum[\n                                    key as SeniorityLevelEnumString\n                                ]\n                            }\n                        >\n                            {\n                                toSeniorityChoice[\n                                    SeniorityLevelEnum[\n                                        key as SeniorityLevelEnumString\n                                    ]\n                                ]\n                            }\n                        </sl-radio-button>\n                    ))}\n                </cluster-l>\n            </sl-radio-group>\n        </stack-l>\n    )\n}\n\nexport default Seniority\n","path":null,"size_bytes":1930,"size_tokens":null},"frontend/src/features/interview-feedback/_tabs/index.tsx":{"content":"import { FC } from 'react'\nimport TabHeaders from './headers'\n\nconst Tabs: FC<{\n    isPending: boolean\n}> = ({ isPending, children }) => {\n    return (\n        <sl-tab-group activation=\"auto\">\n            <TabHeaders isPending={isPending} />\n            {children}\n        </sl-tab-group>\n    )\n}\n\nexport default Tabs\n","path":null,"size_bytes":318,"size_tokens":null},"frontend/src/features/dashboard/header/index.tsx":{"content":"import Logo from '../../../components/logo'\nimport styles from './index.module.css'\nimport User from './user'\n\nconst Header = () => {\n    return (\n        <cluster-l justify=\"space-between\" className={styles.header} align=\"center\">\n            <Logo />\n            <User />\n        </cluster-l>\n    )\n}\n\nexport default Header\n","path":null,"size_bytes":326,"size_tokens":null},"frontend/src/features/auth/register/index.tsx":{"content":"import { FC, useCallback, useEffect, useRef, useState } from 'react'\nimport { useDispatch } from 'react-redux'\nimport InputField from '../../../components/field'\nimport Logo from '../../../components/logo'\nimport { isNullish } from '../../../utils'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport navigation from '../../app/navigation'\nimport { register } from '../_store/effects'\nimport useAuth from '../use-auth'\n\nconst CONTENT = {\n    TITLE: 'REGISTER',\n    CTA: 'Already have an account?',\n}\n\nconst RegistrationPage: FC = () => {\n    const dispatch = useDispatch<RootDispatch>()\n    const formRef = useRef<HTMLFormElement | null>(null)\n    const { status, token } = useAuth()\n    const [credentials, setCredentials] = useState({\n        username: '',\n        password: '',\n        email: '',\n    })\n\n        const isPending = status === Status.PENDING\n\n    const handleChange = useCallback((event: CustomEvent) => {\n        const target = event.target as HTMLInputElement\n\n        setCredentials((prevState) => {\n            return {\n                ...prevState,\n                [`${target.name}`]: target.value,\n            }\n        })\n    }, [])\n\n    const handleSubmit = useCallback(\n        (e: SubmitEvent) => {\n            e.preventDefault()\n\n            if (formRef.current?.checkValidity()) {\n                dispatch(register(credentials))\n            }\n        },\n        [credentials, dispatch, formRef],\n    )\n\n    useEffect(() => {\n        if (!isNullish(token)) {\n            navigation.goToHome()\n        }\n    }, [token])\n\n    return (\n        <cover-l space=\"0\" minHeight=\"80vh\" centered=\"stack-l\">\n            <stack-l space=\"var(--s0)\">\n                <center-l justify=\"center\">\n                    <Logo size=\"large\" />\n                </center-l>\n                <center-l>\n                    <h2>{CONTENT.TITLE}</h2>\n                </center-l>\n                <center-l>\n                    <form onSubmit={handleSubmit} ref={formRef}>\n                        <stack-l space=\"var(--s1)\">\n                            <stack-l space=\"var(--s-2)\">\n                                <InputField\n                                    helpText=\"This will be used when logging in\"\n                                    label=\"Username\"\n                                    name=\"username\"\n                                    placeholder=\"Enter your username\"\n                                    required\n                                    size=\"large\"\n                                    type=\"text\"\n                                    value={credentials.username}\n                                    onInput={handleChange}\n                                >\n                                    <sl-icon name=\"person-fill\" slot=\"prefix\" />\n                                </InputField>\n\n                                <InputField\n                                    label=\"Email\"\n                                    name=\"email\"\n                                    placeholder=\"Enter your email\"\n                                    required\n                                    size=\"large\"\n                                    type=\"email\"\n                                    value={credentials.email}\n                                    onInput={handleChange}\n                                >\n                                    <sl-icon name=\"person-fill\" slot=\"prefix\" />\n                                </InputField>\n\n                                <InputField\n                                    label=\"Password\"\n                                    name=\"password\"\n                                    placeholder=\"Enter your password\"\n                                    required\n                                    size=\"large\"\n                                    type=\"password\"\n                                    value={credentials.password}\n                                    onInput={handleChange}\n                                >\n                                    <sl-icon name=\"key-fill\" slot=\"prefix\" />\n                                </InputField>\n                            </stack-l>\n\n                            <center-l andText>\n                                <sl-button\n                                    type=\"submit\"\n                                    variant=\"primary\"\n                                    size=\"large\"\n                                    loading={isPending}\n                                    disabled={isPending}\n                                >\n                                    Register\n                                </sl-button>\n                            </center-l>\n                            <center-l andText>\n                                <stack-l space=\"var(--s-1)\">\n                                    <span>{CONTENT.CTA}</span>\n                                    <center-l>\n                                        <sl-button\n                                            variant=\"default\"\n                                            onClick={navigation.goToLoginPage}\n                                        >\n                                            Login\n                                        </sl-button>\n                                    </center-l>\n                                </stack-l>\n                            </center-l>\n                        </stack-l>\n                    </form>\n                </center-l>\n            </stack-l>\n        </cover-l>\n    )\n}\n\nexport default RegistrationPage\n","path":null,"size_bytes":5563,"size_tokens":null},"frontend/src/features/interview-practice/drawer-footer/index.tsx":{"content":"import { FC } from 'react'\n\nconst InterviewDrawerFooter: FC<{\n    onConfigureSimulation: () => void\n    onStart: () => void\n}> = ({ onConfigureSimulation, onStart }) => {\n    return (\n        <cluster-l slot=\"footer\" justify=\"flex-end\" space=\"var(--s-1)\">\n            <sl-button variant=\"neutral\" onClick={onConfigureSimulation}>\n                <sl-icon slot=\"prefix\" name=\"gear\" />\n                Configure\n            </sl-button>\n\n            <sl-button variant=\"primary\" onClick={onStart}>\n                <sl-icon slot=\"prefix\" name=\"flag\" />\n                Get started\n            </sl-button>\n        </cluster-l>\n    )\n}\n\nexport default InterviewDrawerFooter\n","path":null,"size_bytes":670,"size_tokens":null},"frontend/src/features/interview-practice/interview-message/index.tsx":{"content":"import { FC } from 'react'\nimport {\n    MessageOwnerTypeEnum,\n    type InterviewMessage,\n} from '../../../__generated__/api'\nimport CircleIcon from '../../../components/circle-icon'\nimport TypingDots from '../../../components/typing-dots'\nimport { isNone } from '../../../utils/is-none'\nimport { PENDING_MESSAGE } from '../_store/reducer'\nimport styles from './index.module.css'\n\nconst InterviewMessage: FC<{\n    message: InterviewMessage\n    showQuestionReason: boolean\n    isPending: boolean\n}> = ({ message, showQuestionReason }) => {\n    const isMessageLoading =\n        message.id === PENDING_MESSAGE.id &&\n        message.text === PENDING_MESSAGE.text\n    const isOwnerGpt = message.message_owner_type === MessageOwnerTypeEnum.Gpt\n    const owner = isOwnerGpt ? 'HR Manager' : 'You'\n\n    const wrapperCls = `${styles.wrapper} ${styles[message.message_owner_type]}`\n    const isNoQuestionReason = isNone(message.question_reason)\n\n    const showTooltip = !isNoQuestionReason && showQuestionReason\n\n    return (\n        <cluster-l className={wrapperCls}>\n            <stack-l space=\"var(--s-2)\">\n                <cluster-l\n                    align=\"flex-start\"\n                    space=\"var(--s-2)\"\n                    className={styles.name}\n                >\n                    <CircleIcon icon=\"person\" variant=\"primary\" size=\"small\" />\n                    {owner}\n                </cluster-l>\n                <sl-tooltip\n                    disabled={!showTooltip}\n                    placement=\"top-end\"\n                    trigger={showTooltip ? 'click' : ''}\n                    className={`${styles.tooltip} ${!showTooltip ? styles.hidden : ''}`}\n                    skidding={200}\n                    distance={20}\n                    hoist\n                >\n                    {showTooltip ? (\n                        <stack-l slot=\"content\" space=\"var(--s1)\">\n                            <cluster-l\n                                className={styles.header}\n                                align=\"center\"\n                                justify=\"space-between\"\n                            >\n                                <cluster-l\n                                    justify=\"flex-start\"\n                                    align=\"center\"\n                                    space=\"var(--s-1)\"\n                                >\n                                    <sl-icon\n                                        name=\"check2-circle\"\n                                        variant=\"success\"\n                                    />\n                                    <h3>Question Breakdown</h3>\n                                </cluster-l>\n\n                                <sl-icon variant=\"neutral\" name=\"x\"></sl-icon>\n                            </cluster-l>\n\n                            <span>{message.question_reason}</span>\n                        </stack-l>\n                    ) : null}\n\n                    <div className={styles.text}>\n                        {isMessageLoading ? <TypingDots /> : message.text}\n                    </div>\n                </sl-tooltip>\n            </stack-l>\n        </cluster-l>\n    )\n}\n\nexport default InterviewMessage\n","path":null,"size_bytes":3182,"size_tokens":null},"frontend/src/features/dashboard/header/user/index.tsx":{"content":"import { useCallback, useMemo } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { isNone } from '../../../../utils/is-none'\nimport { getInitials } from '../../../../utils/string'\nimport { logout } from '../../../auth/_store/reducer'\nimport useAuth from '../../../auth/use-auth'\nimport styles from './index.module.css'\n\nconst User = () => {\n    const { user } = useAuth()\n    const dispatch = useDispatch()\n\n    const initials = useMemo(() => {\n        const ins = !isNone(user?.get_full_name)\n            ? user?.get_full_name\n            : user?.username\n\n        return getInitials(ins)\n    }, [user])\n\n    const name = useMemo(\n        () => (!isNone(user?.first_name) ? user?.first_name : user?.username),\n        [user],\n    )\n\n    const handleLogout = useCallback(() => {\n        dispatch(logout())\n    }, [dispatch])\n\n    return (\n        <sl-dropdown placement=\"bottom-end\" className={styles.user}>\n            <sl-button slot=\"trigger\" caret size=\"large\">\n                <sl-avatar slot=\"prefix\" initials={initials} />\n                {name}\n            </sl-button>\n\n            <sl-menu>\n                <sl-menu-item onClick={handleLogout}>Logout</sl-menu-item>\n            </sl-menu>\n        </sl-dropdown>\n    )\n}\n\nexport default User\n","path":null,"size_bytes":1264,"size_tokens":null},"frontend/src/pages/interview-feedback.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../features/auth/require-auth'\nimport InterviewFeedback from '../features/interview-feedback'\n\nconst InterviewFeedbackPage: FC = () => {\n    return (\n        <RequireAuth>\n            <InterviewFeedback />\n        </RequireAuth>\n    )\n}\n\nexport default InterviewFeedbackPage\n","path":null,"size_bytes":331,"size_tokens":null},"frontend/src/features/dashboard/simulation-map/index.tsx":{"content":"import { useContext, useLayoutEffect, useState } from 'react'\nimport {\n    DropdownPlacement,\n    SlDropDownProps,\n} from '../../../ui/shoelace/shoelace'\nimport { DEVICE_SIZE } from '../../../utils/device-sizes'\nimport { keyify } from '../../../utils/string'\nimport { useResizeObserver } from '../../../utils/use-resize-observer'\nimport { AppContext } from '../../app/context'\nimport navigation from '../../app/navigation'\nimport { SIMULATION_ICONS, SimulationMapItems } from '../models'\nimport styles from './index.module.css'\nimport SimulationItem from './item'\n\ntype Simulation = {\n    description: string\n    icon: string\n    onClickHandler: () => void\n    title: string\n    highlighted?: boolean\n    mobilePlacement?: DropdownPlacement\n} & Pick<SlDropDownProps, 'stayOpenOnSelect' | 'placement'>\n\nconst SIMULATIONS: Simulation[] = [\n    {\n        title: SimulationMapItems.INTERVIEW_PRACTICE?.replace('-', ' '),\n        description:\n            'Learn to analyze company and job info before the interview',\n        onClickHandler: () => navigation.goToInterviewPracticePage(),\n        icon: SIMULATION_ICONS.INTERVIEW_PRACTICE,\n        placement: 'top-start',\n        mobilePlacement: 'left-start',\n        highlighted: true,\n    },\n    {\n        title: SimulationMapItems.OFFER_NEGOTIATION?.replace('-', ' '),\n        description:\n            'Learn to analyze company and job info before the interview',\n        onClickHandler: navigation.goToOfferNegotiation,\n        icon: SIMULATION_ICONS.OFFER_NEGOTIATION,\n        placement: 'bottom-start',\n        mobilePlacement: 'right-start',\n        highlighted: true,\n    },\n\n    {\n        title: SimulationMapItems.WORKPLACE_SIMULATION?.replace('-', ' '),\n        description:\n            'Learn to analyze company and job info before the interview',\n        onClickHandler: navigation.goToOfferNegotiation,\n        icon: SIMULATION_ICONS.WORKPLACE_SIMULATION,\n        placement: 'top-start',\n        mobilePlacement: 'left-start',\n    },\n]\n\nconst DesktopMap = () => {\n    return (\n        <cluster-l\n            space=\"calc(var(--measure) / (var(--r3)))\"\n            className={styles.progress}\n        >\n            {SIMULATIONS.map((simulation) => {\n                return (\n                    <sl-popup\n                        active\n                        disabled={!simulation.highlighted}\n                        distance={30}\n                        key={keyify(simulation.title)}\n                        placement={simulation.placement}\n                        shift\n                    >\n                        <SimulationItem\n                            title={simulation.title}\n                            description={simulation.description}\n                            onClick={simulation.onClickHandler}\n                            disabled={!simulation.highlighted}\n                        />\n\n                        <sl-button\n                            onClick={simulation.onClickHandler}\n                            circle\n                            disabled={!simulation.highlighted}\n                            slot=\"anchor\"\n                            variant={\n                                simulation.highlighted ? 'primary' : undefined\n                            }\n                        >\n                            <sl-icon name={simulation.icon} />\n                        </sl-button>\n                    </sl-popup>\n                )\n            })}\n        </cluster-l>\n    )\n}\n\nconst MobileMap = () => {\n    return (\n        <center-l>\n            <stack-l\n                className={styles.mobileMap}\n                space=\"calc(var(--measure) / (var(--r3)))\"\n            >\n                {SIMULATIONS.map((simulation) => {\n                    return (\n                        <sl-popup\n                            active\n                            disabled={!simulation.highlighted}\n                            distance={40}\n                            key={keyify(simulation.title)}\n                            placement={simulation.mobilePlacement}\n                        >\n                            <SimulationItem\n                                title={simulation.title}\n                                description={simulation.description}\n                                onClick={simulation.onClickHandler}\n                                disabled={!simulation.highlighted}\n                            />\n\n                            <sl-button\n                                onClick={simulation.onClickHandler}\n                                circle\n                                disabled={!simulation.highlighted}\n                                slot=\"anchor\"\n                                variant={\n                                    simulation.highlighted\n                                        ? 'primary'\n                                        : undefined\n                                }\n                            >\n                                <sl-icon name={simulation.icon} />\n                            </sl-button>\n                        </sl-popup>\n                    )\n                })}\n            </stack-l>\n        </center-l>\n    )\n}\n\nconst SimulationsMap = () => {\n    const [isDesktop, setIsDesktop] = useState(true)\n    const { containerElRef } = useContext(AppContext)\n    const layoutSize = useResizeObserver(containerElRef)\n\n    useLayoutEffect(() => {\n        if (layoutSize < DEVICE_SIZE.TABLET) {\n            setIsDesktop(false)\n        } else {\n            setIsDesktop(true)\n        }\n    }, [layoutSize])\n\n    return (\n        <cover-l\n            centered=\"cluster-l\"\n            minHeight=\"calc(var(--measure) / var(--r2))\"\n            className={styles.wrapper}\n        >\n            {isDesktop ? <DesktopMap /> : <MobileMap />}\n        </cover-l>\n    )\n}\n\nexport default SimulationsMap\n","path":null,"size_bytes":5847,"size_tokens":null},"frontend/src/components/intro-drawer/achievements/item/index.tsx":{"content":"import { FC } from 'react'\nimport CircleIcon from '../../../circle-icon'\nimport styles from './index.module.css'\n\nconst AchievementItem: FC<{\n    title: string\n    description: string\n}> = ({ title, description }) => {\n    return (\n        <cluster-l\n            align=\"flex-start\"\n            justify=\"flex-start\"\n            space=\"var(--s-1)\"\n            className={styles.achievement}\n        >\n            <CircleIcon icon=\"file-earmark-text\" variant=\"warning\" />\n            <stack-l space=\"0\">\n                <h4>{title}</h4>\n                <p>{description}</p>\n            </stack-l>\n        </cluster-l>\n    )\n}\n\nexport default AchievementItem\n","path":null,"size_bytes":655,"size_tokens":null},"frontend/src/pages/test/index.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../../features/auth/require-auth'\n\nconst TestPage: FC = () => {\n    return (\n        <RequireAuth>\n            <cover-l\n                centered=\"stack-l\"\n                minHeight=\"calc(100vh - calc(var(--side-menu-mobile-header-height) + var(--s1)))\"\n            >\n                <stack-l space=\"var(--s3)\">\n                    <stack-l space=\"var(--s2)\">\n                        <center-l>\n                            <h2>Buttons</h2>\n                        </center-l>\n\n                        <cluster-l space=\"var(--s1)\">\n                            <center-l andText>\n                                <stack-l space=\"var(--s1)\">\n                                    <p>Filled Buttons</p>\n                                    <cluster-l justify=\"center\" align=\"center\">\n                                        <sl-button>\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            default\n                                        </sl-button>\n                                        <sl-button variant=\"neutral\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            neutral\n                                        </sl-button>\n                                        <sl-button variant=\"warning\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            warning\n                                        </sl-button>\n                                        <sl-button variant=\"danger\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            danger\n                                        </sl-button>\n\n                                        <sl-button variant=\"success\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            success\n                                        </sl-button>\n\n                                        <sl-button variant=\"primary\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            primary\n                                        </sl-button>\n                                    </cluster-l>\n                                </stack-l>\n                            </center-l>\n\n                            <center-l andText>\n                                <stack-l space=\"var(--s1)\">\n                                    <p>Outlined Buttons</p>\n                                    <cluster-l justify=\"center\" align=\"center\">\n                                        <sl-button outline>\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            default\n                                        </sl-button>\n                                        <sl-button outline variant=\"neutral\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            neutral\n                                        </sl-button>\n                                        <sl-button outline variant=\"warning\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            warning\n                                        </sl-button>\n                                        <sl-button outline variant=\"danger\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            danger\n                                        </sl-button>\n\n                                        <sl-button outline variant=\"success\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            success\n                                        </sl-button>\n\n                                        <sl-button outline variant=\"primary\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            primary\n                                        </sl-button>\n                                    </cluster-l>\n                                </stack-l>\n                            </center-l>\n\n                            <center-l andText>\n                                <stack-l space=\"var(--s1)\">\n                                    <p>Disabled Buttons</p>\n                                    <cluster-l justify=\"center\" align=\"center\">\n                                        <sl-button disabled>\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            default\n                                        </sl-button>\n                                        <sl-button disabled variant=\"neutral\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            neutral\n                                        </sl-button>\n                                        <sl-button disabled variant=\"warning\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            warning\n                                        </sl-button>\n                                        <sl-button disabled variant=\"danger\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            danger\n                                        </sl-button>\n\n                                        <sl-button disabled variant=\"success\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            success\n                                        </sl-button>\n\n                                        <sl-button disabled variant=\"primary\">\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            primary\n                                        </sl-button>\n                                    </cluster-l>\n                                </stack-l>\n                            </center-l>\n\n                            <center-l andText>\n                                <stack-l space=\"var(--s1)\">\n                                    <p>Disabled Outlined Buttons</p>\n                                    <cluster-l justify=\"center\" align=\"center\">\n                                        <sl-button disabled outline>\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            default\n                                        </sl-button>\n                                        <sl-button\n                                            disabled\n                                            outline\n                                            variant=\"neutral\"\n                                        >\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            neutral\n                                        </sl-button>\n                                        <sl-button\n                                            disabled\n                                            outline\n                                            variant=\"warning\"\n                                        >\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            warning\n                                        </sl-button>\n                                        <sl-button\n                                            disabled\n                                            outline\n                                            variant=\"danger\"\n                                        >\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            danger\n                                        </sl-button>\n\n                                        <sl-button\n                                            disabled\n                                            outline\n                                            variant=\"success\"\n                                        >\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            success\n                                        </sl-button>\n\n                                        <sl-button\n                                            disabled\n                                            outline\n                                            variant=\"primary\"\n                                        >\n                                            <sl-icon\n                                                name=\"person\"\n                                                slot=\"prefix\"\n                                            ></sl-icon>\n                                            primary\n                                        </sl-button>\n                                    </cluster-l>\n                                </stack-l>\n                            </center-l>\n                        </cluster-l>\n                    </stack-l>\n\n                    <stack-l space=\"var(--s2)\">\n                        <center-l>\n                            <h2>Icons</h2>\n                        </center-l>\n                        <cluster-l\n                            space=\"var(--s2)\"\n                            justify=\"center\"\n                            align=\"center\"\n                        >\n                            <div>\n                                <sl-icon name=\"gear\" />\n                                <div>default</div>\n                            </div>\n                            <div>\n                                <sl-icon name=\"gear-fill\" variant=\"neutral\" />\n                                <div>neutral</div>\n                            </div>\n                            <div>\n                                <sl-icon\n                                    name=\"exclamation-triangle-fill\"\n                                    variant=\"warning\"\n                                />\n                                <div>warning</div>\n                            </div>\n                            <div>\n                                <sl-icon\n                                    name=\"exclamation-octagon-fill\"\n                                    variant=\"danger\"\n                                />\n                                <div>danger</div>\n                            </div>\n                            <div>\n                                <sl-icon\n                                    name=\"check-circle-fill\"\n                                    variant=\"success\"\n                                />\n                                <div>success</div>\n                            </div>\n                            <div>\n                                <sl-icon\n                                    name=\"info-circle-fill\"\n                                    variant=\"primary\"\n                                />\n                                <div>primary</div>\n                            </div>\n                        </cluster-l>\n                    </stack-l>\n                    <stack-l space=\"var(--s2)\">\n                        <center-l>\n                            <h2>Icon Buttons</h2>\n                        </center-l>\n                        <cluster-l\n                            space=\"var(--s2)\"\n                            justify=\"center\"\n                            align=\"center\"\n                        >\n                            <div>\n                                <sl-icon-button name=\"gear\" />\n                                <div>default</div>\n                            </div>\n                            <div>\n                                <sl-icon-button\n                                    name=\"gear-fill\"\n                                    variant=\"neutral\"\n                                />\n                                <div>neutral</div>\n                            </div>\n                            <div>\n                                <sl-icon-button\n                                    name=\"exclamation-triangle-fill\"\n                                    variant=\"warning\"\n                                />\n                                <div>warning</div>\n                            </div>\n                            <div>\n                                <sl-icon-button\n                                    name=\"exclamation-octagon-fill\"\n                                    variant=\"danger\"\n                                />\n                                <div>danger</div>\n                            </div>\n                            <div>\n                                <sl-icon-button\n                                    name=\"check-circle-fill\"\n                                    variant=\"success\"\n                                />\n                                <div>success</div>\n                            </div>\n                            <div>\n                                <sl-icon-button\n                                    name=\"info-circle-fill\"\n                                    variant=\"primary\"\n                                />\n                                <div>primary</div>\n                            </div>\n                        </cluster-l>\n                    </stack-l>\n                </stack-l>\n            </cover-l>\n        </RequireAuth>\n    )\n}\n\nexport default TestPage\n","path":null,"size_bytes":17341,"size_tokens":null},"frontend/src/components/simulation-chat/index.tsx":{"content":"import { FC, VNode } from 'react'\nimport styles from './index.module.css'\n\nconst SimulationChat: FC<{\n    messages: VNode\n    controls?: VNode | null\n}> = ({ messages, controls }) => {\n    return (\n        <cover-l space=\"0\" className={styles.wrapper}>\n            <stack-l space=\"var(--s-2)\">\n                {messages}\n                {controls}\n            </stack-l>\n        </cover-l>\n    )\n}\n\nexport default SimulationChat\n","path":null,"size_bytes":429,"size_tokens":null},"frontend/src/features/interview-practice/simulation-configuration-dialog/index.tsx":{"content":"import { SlDialog } from '@shoelace-style/shoelace'\nimport { FC, useCallback, useRef, useState } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { CareerEnum, SeniorityLevelEnum } from '../../../__generated__/api'\nimport {\n    CareerEnumString,\n    SeniorityLevelEnumString,\n    toCareerChoice,\n    toSeniorityChoice,\n} from '../../../utils/models'\nimport { setConfiguration } from '../_store/reducer'\nimport { SimConfiguration } from '../_store/state'\nimport useInterviewSimulation from '../_store/use-interview-details'\nimport styles from './index.module.css'\n\nconst SimulationConfigurationDialog: FC<{\n    dialogRef: React.MutableRefObject<SlDialog | null>\n}> = ({ dialogRef }) => {\n    const formRef = useRef<HTMLFormElement | null>(null)\n    const { configuration } = useInterviewSimulation()\n    const dispatch = useDispatch()\n    const [conf, setConf] = useState<SimConfiguration>(configuration ?? {})\n\n    const handleCancel = useCallback(() => {\n        dialogRef.current?.hide()\n        formRef.current?.reset()\n        dispatch(setConfiguration({}))\n        setConf({})\n    }, [dialogRef, dispatch])\n\n    const handleApply = useCallback(() => {\n        dispatch(setConfiguration(conf))\n        dialogRef.current?.hide()\n    }, [dispatch, conf, dialogRef])\n\n    const handleChange = useCallback((event: CustomEvent) => {\n        const target = event.target as HTMLInputElement | HTMLTextAreaElement\n\n        setConf((prevState) => {\n            return {\n                ...prevState,\n                [`${target.name}`]: target.value,\n            }\n        })\n    }, [])\n\n    return (\n        <sl-dialog\n            ref={dialogRef}\n            label=\"Configure simulation\"\n            className={styles.dialog}\n        >\n            <form ref={formRef}>\n                <stack-l space=\"var(--s-1)\" className={styles.body}>\n                    <sl-input\n                        label=\"Company name\"\n                        name=\"company\"\n                        placeholder=\"Enter company name\"\n                        value={conf?.company}\n                        onInput={handleChange}\n                        required\n                    />\n                    <sl-select\n                        name=\"seniority_level\"\n                        onsl-change={handleChange}\n                        label=\"Level\"\n                        placeholder=\"Enter level\"\n                        required\n                        value={conf?.seniority_level}\n                    >\n                        <sl-menu>\n                            {Object.keys(SeniorityLevelEnum).map((level) => {\n                                return (\n                                    <sl-option\n                                        value={\n                                            SeniorityLevelEnum[\n                                                level as SeniorityLevelEnumString\n                                            ]\n                                        }\n                                        key={level}\n                                    >\n                                        {\n                                            toSeniorityChoice[\n                                                SeniorityLevelEnum[\n                                                    level as SeniorityLevelEnumString\n                                                ]\n                                            ]\n                                        }\n                                    </sl-option>\n                                )\n                            })}\n                        </sl-menu>\n                    </sl-select>\n\n                    <sl-select\n                        label=\"Position\"\n                        name=\"career\"\n                        placeholder=\"Enter position (e.g. Front-End Developer)\"\n                        value={conf?.career}\n                        onsl-change={handleChange}\n                        required\n                    >\n                        <sl-menu>\n                            {Object.keys(CareerEnum).map((level) => {\n                                return (\n                                    <sl-option\n                                        value={\n                                            CareerEnum[\n                                                level as CareerEnumString\n                                            ]\n                                        }\n                                        key={level}\n                                    >\n                                        {\n                                            toCareerChoice[\n                                                CareerEnum[\n                                                    level as CareerEnumString\n                                                ]\n                                            ]\n                                        }\n                                    </sl-option>\n                                )\n                            })}\n                        </sl-menu>\n                    </sl-select>\n\n                    <sl-textarea\n                        label=\"Job Posting\"\n                        name=\"job_description\"\n                        placeholder=\"Enter job posting\"\n                        required\n                        resize=\"none\"\n                        onInput={handleChange}\n                        rows={10}\n                        value={conf?.job_description}\n                    />\n                </stack-l>\n            </form>\n            <cluster-l justify=\"flex-end\" space=\"var(--s-2)\" slot=\"footer\">\n                <sl-button variant=\"neutral\" onClick={handleCancel}>\n                    <sl-icon name=\"x-lg\" slot=\"prefix\"></sl-icon>\n                    Cancel\n                </sl-button>\n                <sl-button variant=\"primary\" onClick={handleApply}>\n                    <sl-icon name=\"check-lg\" slot=\"prefix\"></sl-icon>\n                    Apply\n                </sl-button>\n            </cluster-l>\n        </sl-dialog>\n    )\n}\n\nexport default SimulationConfigurationDialog\n","path":null,"size_bytes":6112,"size_tokens":null},"frontend/src/features/negotiation-feedback/_tabs/index.tsx":{"content":"import { FC } from 'react'\nimport TabHeaders from './headers'\n\nconst Tabs: FC<{\n    isPending: boolean\n}> = ({ isPending, children }) => {\n    return (\n        <sl-tab-group activation=\"auto\">\n            <TabHeaders isPending={isPending} />\n            {children}\n        </sl-tab-group>\n    )\n}\n\nexport default Tabs\n","path":null,"size_bytes":318,"size_tokens":null},"frontend/src/utils/use-once.ts":{"content":"/* eslint-disable react-hooks/exhaustive-deps */\nimport { EffectCallback, useEffect } from 'react'\n\n/**\n * Custom hook that executes an effect callback only once.\n *\n * @param {EffectCallback} effect - The effect callback to execute.\n *\n * @example\n * // Example of using useOnce to perform a one-time initialization\n * const MyComponent = () => {\n *     useOnce(() => {\n *         console.log('Effect executed once.');\n *         // ... initialization logic\n *     });\n *     // ... rest of the component logic\n * };\n */\nexport function useOnce(effect: EffectCallback) {\n    return useEffect(effect, [])\n}\n","path":null,"size_bytes":607,"size_tokens":null},"frontend/src/features/dashboard/account-form/gender/index.tsx":{"content":"import { SlRadioGroup } from '@shoelace-style/shoelace'\nimport { FC } from 'react'\nimport { useEffect, useRef } from 'react'\nimport { GenderEnum, UserProfileUpdateDto } from '../../../../__generated__/api'\nimport { FORM_NAMES } from '../models'\nimport styles from './index.module.css'\n\nexport type GenderEnumString = keyof typeof GenderEnum\n\nconst Gender: FC<{\n    formData?: UserProfileUpdateDto | null\n    handleChange: (e: CustomEvent) => void\n}> = ({ formData, handleChange }) => {\n    const radioRef = useRef<SlRadioGroup | null>(null)\n\n    useEffect(() => {\n        radioRef.current?.addEventListener('sl-change', (e) => {\n            handleChange(e)\n        })\n    }, [handleChange])\n\n    return (\n        <stack-l space=\"var(--s-2)\" className={styles.wrapper}>\n            <sl-radio-group\n                ref={radioRef}\n                name={FORM_NAMES.GENDER}\n                label=\"Select yout gender\"\n                required\n                value={formData?.gender}\n            >\n                <cluster-l space=\"var(--s0)\">\n                    {Object.keys(GenderEnum)?.map((key) => (\n                        <sl-radio-button\n                            key={key}\n                            value={GenderEnum[key as GenderEnumString]}\n                        >\n                            {GenderEnum[key as GenderEnumString]}\n                        </sl-radio-button>\n                    ))}\n                </cluster-l>\n            </sl-radio-group>\n        </stack-l>\n    )\n}\n\nexport default Gender\n","path":null,"size_bytes":1518,"size_tokens":null},"frontend/src/features/interview-practice/index.tsx":{"content":"import { SlDialog } from '@shoelace-style/shoelace'\nimport { FC } from 'react'\nimport { useCallback, useEffect, useRef } from 'react'\nimport { useDispatch } from 'react-redux'\nimport IntroDrawer, {\n    IntroDrawerHeaderProps,\n} from '../../components/intro-drawer'\nimport SimulationHeader from '../../components/simulation-header'\nimport { isNullish } from '../../utils'\nimport { useOnce } from '../../utils/use-once'\nimport { RootDispatch } from '../app/_store'\nimport navigation from '../app/navigation'\nimport { SIMULATION_ICONS } from '../dashboard/models'\nimport { getHistory, startInterviewSession } from './_store/effects'\nimport { resetSimulation, setSessionId } from './_store/reducer'\nimport useInterviewSimulation from './_store/use-interview-details'\nimport InterviewDrawerFooter from './drawer-footer'\nimport InterviewChat from './interview-chat'\nimport SimulationConfigurationDialog from './simulation-configuration-dialog'\n\nconst INTRO_DRAWER_CONTENT: IntroDrawerHeaderProps = {\n    title: 'Interview Practice',\n    description: 'Practice an interview and review your answers.',\n    icon: SIMULATION_ICONS.INTERVIEW_PRACTICE,\n}\n\nexport const InterviewPractice: FC = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId } = useInterviewSimulation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (isNullish(sessionId) && !isNullish(routeSessionId)) {\n            dispatch(setSessionId(routeSessionId))\n            dispatch(\n                getHistory({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    useEffect(() => {\n        if (!isNullish(sessionId)) {\n            navigation.goToSearchParams({\n                sessionId,\n            })\n        }\n    }, [sessionId])\n\n    return sessionId ? <InterviewChat /> : null\n}\n\nconst InterviewPracticeFeature = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const dispatch = useDispatch<RootDispatch>()\n\n    const dialogRef = useRef<SlDialog | null>(null)\n\n    const handleExit = useCallback(() => {\n        dispatch(resetSimulation())\n        navigation.goToHome()\n    }, [dispatch])\n\n    const handleStart = useCallback(() => {\n        dispatch(startInterviewSession())\n    }, [dispatch])\n\n    const handleConfigure = useCallback(() => {\n        dialogRef.current?.show()\n    }, [])\n\n    return (\n        <cover-l space=\"0\">\n            <SimulationConfigurationDialog dialogRef={dialogRef} />\n\n            <SimulationHeader\n                icon={SIMULATION_ICONS.INTERVIEW_PRACTICE}\n                title=\"Interview Practice\"\n                onExit={handleExit}\n            />\n            <IntroDrawer\n                open={isNullish(routeSessionId)}\n                {...INTRO_DRAWER_CONTENT}\n                footer={\n                    <InterviewDrawerFooter\n                        onStart={handleStart}\n                        onConfigureSimulation={handleConfigure}\n                    />\n                }\n            />\n            <InterviewPractice />\n        </cover-l>\n    )\n}\n\nexport default InterviewPracticeFeature\n","path":null,"size_bytes":3205,"size_tokens":null},"frontend/src/features/interview-feedback/_tabs/headers.tsx":{"content":"import { FC } from 'react'\nimport { keyify } from '../../../utils/string'\n\nexport enum InterviewFeedbackTabs {\n    FEEDBACK = 'feedback',\n    REVIEW_QUESTIONS = 'review-questions',\n}\n\nexport type InterviewFeedbackTabsString = keyof typeof InterviewFeedbackTabs\n\nconst TabHeaders: FC<{\n    isPending: boolean\n}> = ({ isPending }) => {\n    return (\n        <>\n            {(\n                Object.keys(\n                    InterviewFeedbackTabs,\n                ) as InterviewFeedbackTabsString[]\n            ).map((key) => (\n                <sl-tab\n                    key={keyify(key)}\n                    panel={InterviewFeedbackTabs[key]}\n                    disabled={isPending}\n                    active={\n                        InterviewFeedbackTabs.FEEDBACK ===\n                        InterviewFeedbackTabs[key]\n                    }\n                    slot=\"nav\"\n                >\n                    {(key.includes('_')\n                        ? key.replace('_', ' ')\n                        : key\n                    )?.toLowerCase()}\n                </sl-tab>\n            ))}\n        </>\n    )\n}\n\nexport default TabHeaders\n","path":null,"size_bytes":1138,"size_tokens":null},"frontend/src/features/offer-negotiation/offer/index.tsx":{"content":"import { useCallback } from 'react'\nimport { useDispatch } from 'react-redux'\nimport DOMPurify from 'dompurify'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport useAuth from '../../auth/use-auth'\nimport { setShowNegotiationChat } from '../_store/reducer'\nimport useOfferNegotiation from '../_store/use-offer-negotiation'\nimport Controls from './controls'\nimport styles from './index.module.css'\n\nconst Offer = () => {\n    const { initial_offer, offer, status } = useOfferNegotiation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const { user } = useAuth()\n\n    const isPending = status === Status.PENDING\n\n    const handleNegotiationStart = useCallback(() => {\n        dispatch(setShowNegotiationChat())\n    }, [dispatch])\n\n    return offer || initial_offer ? (\n        <stack-l space=\"0\" className={styles.wrapper}>\n            <cover-l minHeight=\"100vh\">\n                <center-l>\n                    <stack-l space=\"var(--s-1)\">\n                        <stack-l className={styles.card}>\n                            <stack-l space=\"var(--s-3)\">\n                                <h4>Job Offer</h4>\n\n                                {/* TODO (hom): replace with actual offer position and name */}\n                                <h5>{user?.get_full_name}</h5>\n                            </stack-l>\n                        </stack-l>\n\n                        <stack-l\n                            className={styles.card}\n                            space=\"var(--s-5)\"\n                            dangerouslySetInnerHTML={{\n                                __html: DOMPurify.sanitize(offer! ?? initial_offer!),\n                            }}\n                        />\n                    </stack-l>\n                </center-l>\n            </cover-l>\n\n            <Controls\n                disabled={isPending}\n                onNegotiation={handleNegotiationStart}\n            />\n        </stack-l>\n    ) : null\n}\n\nexport default Offer\n","path":null,"size_bytes":1997,"size_tokens":null},"frontend/src/pages/negotiation-feedback.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../features/auth/require-auth'\nimport NegotiationFeedbackFeature from '../features/negotiation-feedback'\n\nconst NegotiationFeedbackPage: FC = () => {\n    return (\n        <RequireAuth>\n            <NegotiationFeedbackFeature />\n        </RequireAuth>\n    )\n}\n\nexport default NegotiationFeedbackPage\n","path":null,"size_bytes":355,"size_tokens":null},"frontend/src/ui/layouts/components/globalLayoutProps.ts":{"content":"import { Ref } from 'react'\nimport { CSSProperties } from 'preact/compat'\nexport interface GlobalLayoutProps {\n    class?: string\n    className?: string\n    onClick?: () => unknown\n    ref?: Ref<HTMLElement>\n    style?: CSSProperties\n    title?: string\n    slot?: string\n    role?: string\n}\n","path":null,"size_bytes":291,"size_tokens":null},"frontend/src/features/negotiation-feedback/_tabs/headers.tsx":{"content":"import { FC } from 'react'\nimport { keyify } from '../../../utils/string'\n\nexport enum NegotiationFeedbackTabs {\n    FEEDBACK = 'feedback',\n    OFFER = 'offer',\n    REVIEW_QUESTIONS = 'review-questions',\n}\n\nexport type NegotiationFeedbackTabsString = keyof typeof NegotiationFeedbackTabs\n\nconst TabHeaders: FC<{\n    isPending: boolean\n}> = ({ isPending }) => {\n    return (\n        <>\n            {(\n                Object.keys(\n                    NegotiationFeedbackTabs,\n                ) as NegotiationFeedbackTabsString[]\n            ).map((key) => (\n                <sl-tab\n                    key={keyify(key)}\n                    panel={NegotiationFeedbackTabs[key]}\n                    disabled={isPending}\n                    active={\n                        NegotiationFeedbackTabs.FEEDBACK ===\n                        NegotiationFeedbackTabs[key]\n                    }\n                    slot=\"nav\"\n                >\n                    {(key.includes('_')\n                        ? key.replace('_', ' ')\n                        : key\n                    )?.toLowerCase()}\n                </sl-tab>\n            ))}\n        </>\n    )\n}\n\nexport default TabHeaders\n","path":null,"size_bytes":1175,"size_tokens":null},"frontend/src/pages/dashboard.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../features/auth/require-auth'\nimport Dashboard from '../features/dashboard'\n\nconst DashboardPage: FC = () => {\n    return (\n        <RequireAuth>\n            <Dashboard />\n        </RequireAuth>\n    )\n}\n\nexport default DashboardPage\n","path":null,"size_bytes":290,"size_tokens":null},"frontend/src/features/app/index.tsx":{"content":"import { FC, useEffect } from 'react'\nimport { BrowserRouter, Routes, Route, useNavigate } from 'react-router-dom'\nimport { Provider as StoreProvider } from 'react-redux'\nimport { ScrollToTop } from '../../components/scroll-to-top'\nimport PageNotFound from '../../pages/404'\nimport DashboardPage from '../../pages/dashboard'\nimport InterviewFeedbackPage from '../../pages/interview-feedback'\nimport InterviewPracticePage from '../../pages/interview-practice'\nimport NegotiationFeedbackPage from '../../pages/negotiation-feedback'\nimport OfferNegotiationPage from '../../pages/offer-negotiation'\nimport TestPage from '../../pages/test'\nimport LoginPage from '../auth/login'\nimport RegistrationPage from '../auth/register'\nimport { store } from './_store/index'\nimport { AppContextProvider } from './context'\nimport { APP_ROUTES } from './routes'\nimport { AppConfigProvider } from './use-config'\nimport { setNavigate } from './navigation'\n\nconst NavigateProvider: FC<{ children: React.ReactNode }> = ({ children }) => {\n    const navigate = useNavigate()\n    \n    useEffect(() => {\n        setNavigate(navigate)\n    }, [navigate])\n    \n    return <>{children}</>\n}\n\nconst AppRouter: FC = () => {\n    return (\n        <Routes>\n            <Route path={APP_ROUTES.LOGIN} element={<LoginPage />} />\n            <Route path={APP_ROUTES.REGISTER} element={<RegistrationPage />} />\n            <Route path={APP_ROUTES.TEST_PAGE} element={<TestPage />} />\n            <Route path={APP_ROUTES.DASHBOARD} element={<DashboardPage />} />\n            <Route path={APP_ROUTES.INTERVIEW_PRACTICE} element={<InterviewPracticePage />} />\n            <Route path={APP_ROUTES.INTERVIEW_FEEDBACK} element={<InterviewFeedbackPage />} />\n            <Route path={APP_ROUTES.OFFER_NEGOTIATION} element={<OfferNegotiationPage />} />\n            <Route path={APP_ROUTES.NEGOTIATION_FEEDBACK} element={<NegotiationFeedbackPage />} />\n            <Route path=\"*\" element={<PageNotFound />} />\n        </Routes>\n    )\n}\n\nconst App = () => {\n    return (\n        <AppContextProvider>\n            <AppConfigProvider>\n                <StoreProvider store={store}>\n                    <BrowserRouter>\n                        <ScrollToTop />\n                        <NavigateProvider>\n                            <AppRouter />\n                        </NavigateProvider>\n                    </BrowserRouter>\n                </StoreProvider>\n            </AppConfigProvider>\n        </AppContextProvider>\n    )\n}\n\nexport default App\n","path":null,"size_bytes":2498,"size_tokens":null},"frontend/src/features/dashboard/_tabs/to-dashboard-content.tsx":{"content":"import { VNode } from 'react'\nimport InterviewSessions from '../../interview-sessions'\nimport NegotiationSessions from '../../negotiation-sessions'\nimport { DashboardTabs } from '../models'\nimport SimulationMap from '../simulation-map'\n\nexport const DashboardTabsContentDefault = {\n    content: <SimulationMap />,\n}\n\nexport const DashboardTabsContent: {\n    [key in DashboardTabs]: {\n        content: VNode\n        disabled?: boolean\n    }\n} = {\n    [DashboardTabs.SIMULATIONS_MAP]: {\n        content: <SimulationMap />,\n    },\n    [DashboardTabs.INTERVIEW_SESSIONS]: {\n        content: <InterviewSessions />,\n    },\n    [DashboardTabs.NEGOTIATION_SESSIONS]: {\n        content: <NegotiationSessions />,\n    },\n    [DashboardTabs.WORKPLACE_SIMULATION]: {\n        content: <stack-l>no-content</stack-l>,\n        disabled: true,\n    },\n}\n","path":null,"size_bytes":835,"size_tokens":null},"frontend/src/features/dashboard/greeter/index.tsx":{"content":"import { useMemo } from 'react'\nimport { isNone } from '../../../utils/is-none'\nimport { getInitials } from '../../../utils/string'\nimport useAuth from '../../auth/use-auth'\nimport styles from './index.module.css'\nimport { MESSAGES } from './messages'\n\nconst Greeter = () => {\n    const { user } = useAuth()\n\n    const initials = useMemo(() => {\n        const ins = !isNone(user?.get_full_name)\n            ? user?.get_full_name\n            : user?.username\n\n        return getInitials(ins)\n    }, [user])\n\n    const name = useMemo(\n        () => (!isNone(user?.first_name) ? user?.first_name : user?.username),\n        [user],\n    )\n\n    return (\n        <cluster-l className={styles.greeter} align=\"flex-start\">\n            <sl-avatar initials={initials} className={styles.avatar} />\n            <stack-l space=\"var(--s-4)\" className={styles.message}>\n                <h2>\n                    {MESSAGES.GREETER_HEADER}, {name}\n                </h2>\n                <stack-l>{MESSAGES.GREETER_MESSAGE}</stack-l>\n            </stack-l>\n        </cluster-l>\n    )\n}\n\nexport default Greeter\n","path":null,"size_bytes":1089,"size_tokens":null},"frontend/src/features/interview-sessions/index.tsx":{"content":"import { useCallback, useLayoutEffect } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { SessionStatusEnum } from '../../__generated__/api'\nimport HistoryItem from '../../components/history-item'\nimport Pagination from '../../components/pagination'\nimport { keyify } from '../../utils/string'\nimport { RootDispatch } from '../app/_store'\nimport { PaginationControls, Status } from '../app/_store/state'\nimport navigation from '../app/navigation'\nimport { DashboardTabs } from '../dashboard/models'\nimport {\n    resetInterviewSessions,\n    setInterviewSessionsPagination,\n} from './_store/reducer'\nimport { initialInterviewSessionPagination } from './_store/state'\nimport useInterviewSessions from './_store/use-interview-sessions'\nimport styles from './index.module.css'\n\nconst InterviewSessions = () => {\n    const { status, error, data, pagination } = useInterviewSessions()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const isPending = status === Status.PENDING\n    const isError = status === Status.ERROR\n    const count = data && data?.length ? data?.length : 0\n\n    const title = DashboardTabs.INTERVIEW_SESSIONS?.replace('-', ' ')\n\n    useLayoutEffect(() => {\n        dispatch(\n            setInterviewSessionsPagination({\n                ...initialInterviewSessionPagination,\n            }),\n        )\n\n        return () => {\n            dispatch(resetInterviewSessions())\n        }\n    }, [dispatch])\n\n    const handlePaginationChange = useCallback(\n        (p: Pick<PaginationControls, 'offset' | 'limit'>) => {\n            dispatch(setInterviewSessionsPagination(p))\n        },\n        [dispatch],\n    )\n\n    return (\n        <cover-l className={styles.wrapper}>\n            {isPending ? (\n                <center-l andText>\n                    <sl-spinner></sl-spinner>\n                </center-l>\n            ) : isError ? (\n                <center-l>\n                    <stack-l space=\"var(--s-2)\">\n                        <h2>Something went wrong</h2>\n                        <p>{error?.message}</p>\n                    </stack-l>\n                </center-l>\n            ) : (\n                <>\n                    <stack-l space=\"var(--s0)\">\n                        <cluster-l justify=\"space-between\">\n                            <h3 className={styles.title}>{title}</h3>\n                            <sl-badge pill variant=\"primary\">\n                                {count}\n                            </sl-badge>\n                        </cluster-l>\n                        <stack-l space=\"var(--s-1)\">\n                            {data?.map((d) => (\n                                <HistoryItem\n                                    key={keyify(d.session_id)}\n                                    data={d}\n                                    prefix=\"Interview\"\n                                    onNavigation={\n                                        d.session_status ===\n                                        SessionStatusEnum.Done\n                                            ? navigation.goToInterviewFeedbackPage\n                                            : navigation.goToInterviewDetailsPage\n                                    }\n                                />\n                            ))}\n                        </stack-l>\n                    </stack-l>\n                    <Pagination\n                        count={count}\n                        pagination={pagination}\n                        onPaginationChange={handlePaginationChange}\n                    />\n                </>\n            )}\n        </cover-l>\n    )\n}\n\nexport default InterviewSessions\n","path":null,"size_bytes":3619,"size_tokens":null},"frontend/src/components/intro-drawer/achievements/index.tsx":{"content":"import { keyify } from '../../../utils/string'\nimport styles from './index.module.css'\nimport AchievementItem from './item'\n\nconst CONTENT = {\n    TITLE: `What youll learn from this simulation`,\n    ITEMS: [\n        {\n            label: `Practice common interview questions`,\n            description: 'description',\n        },\n        {\n            label: `Review your answers and get tips and recommendations`,\n            description: 'description',\n        },\n    ],\n}\n\nconst Achievements = () => {\n    return (\n        <stack-l space=\"var(--s-2)\" className={styles.achievements}>\n            <h3>{CONTENT.TITLE}</h3>\n            {CONTENT.ITEMS.map((item) => {\n                return (\n                    <AchievementItem\n                        key={keyify(item.label)}\n                        title={item.label}\n                        description={item.description}\n                    />\n                )\n            })}\n        </stack-l>\n    )\n}\n\nexport default Achievements\n","path":null,"size_bytes":989,"size_tokens":null},"frontend/src/features/app/navigation.ts":{"content":"import { isNullish, setSearchParams, SetSearchParamsOptions } from '../../utils'\nimport { APP_ROUTES } from './routes'\n\nlet navigateFunction: ((to: string) => void) | null = null\n\nexport const setNavigate = (navigate: (to: string) => void) => {\n    navigateFunction = navigate\n}\n\nconst goToHome = () => navigateFunction?.(APP_ROUTES.DASHBOARD)\nconst goToInterviewPracticePage = () => navigateFunction?.(APP_ROUTES.INTERVIEW_PRACTICE)\nconst goToJobSearchPage = () => navigateFunction?.(APP_ROUTES.JOB_SEARCH)\nconst goToLoginPage = () => navigateFunction?.(APP_ROUTES.LOGIN)\nconst goToRegistrationPage = () => navigateFunction?.(APP_ROUTES.REGISTER)\nconst goToTestPage = () => navigateFunction?.(APP_ROUTES.TEST_PAGE)\nconst goToWorkPage = () => navigateFunction?.(APP_ROUTES.WORK)\nconst goToOfferNegotiation = () => navigateFunction?.(APP_ROUTES.OFFER_NEGOTIATION)\n\nconst goToInterviewDetailsPage = (id: number | string) => {\n    navigateFunction?.(`${APP_ROUTES.INTERVIEW_PRACTICE}/?sessionId=${id}`)\n}\n\nconst goToInterviewFeedbackPage = (id: string) => {\n    navigateFunction?.(`${APP_ROUTES.INTERVIEW_FEEDBACK}/?sessionId=${id}`)\n}\n\nconst goToNegotiationFeedbackPage = (id: string) => {\n    navigateFunction?.(`${APP_ROUTES.NEGOTIATION_FEEDBACK}/?sessionId=${id}`)\n}\n\nconst goToNegotiationDetailsPage = (id: number | string) => {\n    navigateFunction?.(`${APP_ROUTES.OFFER_NEGOTIATION}/?sessionId=${id}`)\n}\n\nconst goToSearchParams = (\n    params: Record<string, unknown>,\n    url?: URL | null,\n    options?: SetSearchParamsOptions,\n) => {\n    url = (!isNullish(url) ? url : new URL(globalThis.location.href)) as URL\n    const next = setSearchParams(url, params, options)\n    navigateFunction?.(next.pathname + next.search)\n}\n\nconst navigation = {\n    goToHome,\n    goToInterviewDetailsPage,\n    goToInterviewFeedbackPage,\n    goToInterviewPracticePage,\n    goToJobSearchPage,\n    goToLoginPage,\n    goToNegotiationDetailsPage,\n    goToNegotiationFeedbackPage,\n    goToOfferNegotiation,\n    goToRegistrationPage,\n    goToSearchParams,\n    goToTestPage,\n    goToWorkPage,\n}\n\nexport default navigation\n","path":null,"size_bytes":2100,"size_tokens":null},"frontend/src/main.tsx":{"content":"import { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\n\n// Import Shoelace components and setup FIRST\nimport './ui/index'\n\n// Then import global styles\nimport './ui/styles/index.css'\n\nimport App from './features/app'\nimport { appContainer } from './features/app/context'\n\nif (appContainer) {\n    const root = createRoot(appContainer)\n    root.render(\n        <StrictMode>\n            <App />\n        </StrictMode>\n    )\n}\n","path":null,"size_bytes":448,"size_tokens":null},"frontend/src/features/interview-practice/interview-chat/controls.tsx":{"content":"import { FC } from 'react'\nimport { Ref, useCallback, useEffect, useState } from 'react'\nimport { InterviewMessage } from '../../../__generated__/api'\nimport { isNone } from '../../../utils/is-none'\nimport styles from './index.module.css'\n\nconst MESSAGES = {\n    VOICE_DISABLED: 'Sending voice answers is currently not supported',\n    SEND_TOOLTIP: 'Use Enter to send',\n}\n\nconst ChatControls: FC<{\n    messages: InterviewMessage[]\n    onSend: (input: string) => void\n    disabled: boolean\n    formRef: Ref<HTMLFormElement | null>\n}> = ({ messages, onSend, disabled, formRef }) => {\n    const [input, setInput] = useState<string>('')\n\n    const handleChange = useCallback((e: CustomEvent) => {\n        const target = e.target as HTMLTextAreaElement\n        setInput(target.value)\n    }, [])\n\n    const handleReset = useCallback(\n        (e: Event) => {\n            e.preventDefault()\n            setInput('')\n        },\n        [setInput],\n    )\n\n    const handleSubmit = useCallback(\n        (e: SubmitEvent) => {\n            e.preventDefault()\n            if (\n                formRef.current?.reportValidity() &&\n                !isNone(input) &&\n                input!.trim()!.length! > 0\n            ) {\n                onSend(input!)\n            }\n\n            formRef.current?.reset()\n        },\n        [input, onSend, formRef],\n    )\n\n    const handleKeyDown = useCallback(\n        (e: KeyboardEvent) => {\n            if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault()\n                formRef.current?.requestSubmit()\n                return true\n            }\n        },\n        [formRef],\n    )\n\n    const handleChatScroll = useCallback(() => {\n        globalThis.scrollTo(0, globalThis.document.body.offsetHeight)\n        formRef.current?.querySelector('sl-textarea')?.focus()\n    }, [formRef])\n\n    useEffect(() => {\n        if (messages.length > 0) {\n            handleChatScroll()\n        }\n    }, [messages, handleChatScroll])\n\n    return (\n        <form\n            onSubmit={handleSubmit}\n            onReset={handleReset}\n            disabled={disabled}\n            className={styles.controls}\n            ref={formRef}\n        >\n            <cluster-l align=\"center\" justify=\"center\" space=\"var(--s1)\">\n                <sl-textarea\n                    placeholder=\"Enter your answer\"\n                    size=\"large\"\n                    onInput={handleChange}\n                    onKeyDown={handleKeyDown}\n                    value={input}\n                    required\n                    disabled={disabled}\n                    rows={3}\n                />\n                <sl-tooltip placement=\"right-end\" disabled={disabled}>\n                    <span slot=\"content\">{MESSAGES.SEND_TOOLTIP}</span>\n                    <sl-button\n                        className={styles.send}\n                        variant=\"primary\"\n                        type=\"submit\"\n                        disabled={disabled}\n                    >\n                        <sl-icon slot=\"suffix\" name=\"send\" />\n                    </sl-button>\n                </sl-tooltip>\n                <sl-tooltip placement=\"right-end\">\n                    <span slot=\"content\">{MESSAGES.VOICE_DISABLED}</span>\n                    <sl-button\n                        variant=\"primary\"\n                        outline\n                        disabled={disabled || true}\n                    >\n                        <sl-icon slot=\"suffix\" name=\"mic\" />\n                    </sl-button>\n                </sl-tooltip>\n            </cluster-l>\n        </form>\n    )\n}\n\nexport default ChatControls\n","path":null,"size_bytes":3598,"size_tokens":null},"frontend/src/pages/404.tsx":{"content":"import { FC } from 'react'\nimport navigation from '../features/app/navigation'\n\nconst PageNotFound: FC = () => (\n    <center-l andText style={{ marginTop: 'var(--s5)' }}>\n        <stack-l>\n            <sl-icon\n                name=\"search\"\n                style={{ marginInline: 'auto', fontSize: 'var(--s5)' }}\n            />\n            <h2>404 Not Found</h2>\n            <sl-button variant=\"neutral\" outline onClick={navigation.goToHome}>\n                Go Home\n            </sl-button>\n        </stack-l>\n    </center-l>\n)\n\nexport default PageNotFound\n","path":null,"size_bytes":557,"size_tokens":null},"frontend/src/features/dashboard/index.tsx":{"content":"import { FC } from 'react'\nimport { ScrollToTop } from '../../components/scroll-to-top'\nimport { isNone } from '../../utils/is-none'\nimport useAuth from '../auth/use-auth'\nimport TabGroup from './_tabs'\nimport AccountForm from './account-form'\nimport Greeter from './greeter'\nimport Header from './header'\nimport styles from './index.module.css'\n\nconst Dashboard: FC = () => {\n    const { user } = useAuth()\n    // TODO (hom): Add new user\n    const isNewUser = isNone(user?.get_full_name)\n\n    return (\n        <cover-l className={styles.dashboard}>\n            <ScrollToTop />\n            {isNewUser ? (\n                <AccountForm />\n            ) : (\n                <>\n                    <Header />\n                    <Greeter />\n                    <TabGroup />\n                </>\n            )}\n        </cover-l>\n    )\n}\n\nexport default Dashboard\n","path":null,"size_bytes":859,"size_tokens":null},"frontend/src/features/dashboard/simulation-map/item/index.tsx":{"content":"import { FC } from 'react'\nimport { useCallback } from 'react'\nimport styles from './index.module.css'\n\nconst SimulationItem: FC<{\n    title: string\n    description: string\n    onClick: () => void\n    disabled: boolean\n}> = ({ title, description, onClick, disabled }) => {\n    const handleClick = useCallback(() => {\n        onClick()\n    }, [onClick])\n\n    return (\n        <stack-l space=\"var(--s-2)\" className={styles.item} disabled={disabled}>\n            <h4 className={styles.title}>{title}</h4>\n            <p>{description}</p>\n            <cluster-l justify=\"flex-start\">\n                <sl-button outline onClick={handleClick} disabled={disabled}>\n                    Start simulation\n                    <sl-icon slot=\"suffix\" name=\"box-arrow-up-right\"></sl-icon>\n                </sl-button>\n            </cluster-l>\n        </stack-l>\n    )\n}\n\nexport default SimulationItem\n","path":null,"size_bytes":887,"size_tokens":null},"start.sh":{"content":"#!/bin/bash\n\n# Colors for output\nGREEN='\\033[0;32m'\nBLUE='\\033[0;34m'\nYELLOW='\\033[1;33m'\nNC='\\033[0m' # No Color\n\necho -e \"${BLUE}${NC}\"\necho -e \"${BLUE}   Starting EdMap Django/React App     ${NC}\"\necho -e \"${BLUE}${NC}\"\necho \"\"\n\n# Set GROQ API key from secret\nexport DJANGO_APP_GROQ_API_KEY=\"${GROQ_API_KEY}\"\n\n# Run Django migrations\necho -e \"${YELLOW}[1/3] Running database migrations...${NC}\"\ncd backend && python manage.py migrate\necho \"\"\n\n# Start Django backend on port 8000\necho -e \"${YELLOW}[2/3] Starting Django REST API on port 8000...${NC}\"\npython manage.py runserver 0.0.0.0:8000 &\nBACKEND_PID=$!\necho -e \"${GREEN} Django backend started (PID: $BACKEND_PID)${NC}\"\necho \"\"\n\n# Go back to root and start frontend\ncd ..\n\n# Start Vite frontend on port 5175 (configured in package.json)\necho -e \"${YELLOW}[3/3] Starting React + Vite frontend on port 5175...${NC}\"\ncd frontend && npm run dev &\nFRONTEND_PID=$!\necho -e \"${GREEN} Vite frontend started (PID: $FRONTEND_PID)${NC}\"\necho \"\"\n\necho -e \"${BLUE}${NC}\"\necho -e \"${BLUE}        All Services Running!           ${NC}\"\necho -e \"${BLUE}${NC}\"\necho -e \"${GREEN}  Backend API:  http://0.0.0.0:8000     ${NC}\"\necho -e \"${GREEN}  Swagger Docs: http://0.0.0.0:8000/swagger/${NC}\"\necho -e \"${GREEN}  Admin Panel:  http://0.0.0.0:8000/admin/${NC}\"\necho -e \"${GREEN}  Frontend:     http://0.0.0.0:5175     ${NC}\"\necho -e \"${BLUE}${NC}\"\necho \"\"\n\n# Wait for both processes\nwait $BACKEND_PID $FRONTEND_PID\n","path":null,"size_bytes":2119,"size_tokens":null},"frontend/src/features/app/use-config.tsx":{"content":"import { createContext, FC, ReactNode, useContext } from 'react'\nimport { AppConfig, config as appConfig } from './config'\n\nexport type AppConfigContext = AppConfig\nconst AppConfigContext: React.Context<AppConfigContext> =\n    createContext(appConfig)\n\nexport const AppConfigProvider: FC<{ children: ReactNode }> = ({ children }) => {\n    return (\n        <AppConfigContext.Provider value={appConfig}>\n            {children}\n        </AppConfigContext.Provider>\n    )\n}\n\nexport const useAppConfig = (): AppConfigContext => useContext(AppConfigContext)\n","path":null,"size_bytes":552,"size_tokens":null},"frontend/src/features/dashboard/_tabs/index.tsx":{"content":"import {\n    useCallback,\n    useContext,\n    useLayoutEffect,\n    useState,\n} from 'react'\nimport { useSearchParams } from 'react-router-dom'\nimport { isNullish } from '../../../utils'\nimport { DEVICE_SIZE } from '../../../utils/device-sizes'\nimport { useResizeObserver } from '../../../utils/use-resize-observer'\nimport { AppContext } from '../../app/context'\nimport navigation from '../../app/navigation'\nimport { DashboardTabs } from '../models'\nimport TabHeaders from './headers'\nimport styles from './index.module.css'\nimport TabPanels from './panels'\n\nconst isValidTab = (tab: string) =>\n    Object.values(DashboardTabs).includes(tab as DashboardTabs)\n\nconst TabGroup = () => {\n    const [searchParams] = useSearchParams()\n    const activeTab = searchParams.get('tab')\n\n    const [isDesktop, setIsDesktop] = useState(true)\n    const { containerElRef } = useContext(AppContext)\n    const layoutSize = useResizeObserver(containerElRef)\n\n    useLayoutEffect(() => {\n        if (layoutSize < DEVICE_SIZE.TABLET) {\n            setIsDesktop(false)\n        } else {\n            setIsDesktop(true)\n        }\n    }, [layoutSize])\n\n    useLayoutEffect(() => {\n        if (isNullish(activeTab) || !isValidTab(activeTab!)) {\n            navigation.goToSearchParams({\n                tab: DashboardTabs.SIMULATIONS_MAP,\n            })\n        }\n    }, [activeTab])\n\n    const handleTabChange = useCallback((e: CustomEvent) => {\n        navigation.goToSearchParams(\n            {\n                tab: e.detail.name,\n            },\n            new URL(globalThis.location.href),\n            { clearSearch: true },\n        )\n    }, [])\n\n    return (\n        <sl-tab-group\n            placement={isDesktop ? 'start' : 'top'}\n            activation=\"auto\"\n            className={styles.wrapper}\n            onsl-tab-show={handleTabChange}\n        >\n            <TabHeaders />\n            <TabPanels />\n        </sl-tab-group>\n    )\n}\n\nexport default TabGroup\n","path":null,"size_bytes":1948,"size_tokens":null},"frontend/src/components/history-item/index.tsx":{"content":"import { FC } from 'react'\nimport { useCallback } from 'react'\nimport {\n    SessionDto,\n    SessionStatusEnum,\n    SimulationSessions,\n} from '../../__generated__/api'\nimport { Variant } from '../../ui/shoelace/shoelace'\nimport { formatDate } from '../../utils/date'\nimport { toCareerChoice, toSeniorityChoice } from '../../utils/models'\nimport styles from './index.module.css'\n\nconst toSessionStatusVariant = {\n    [SessionStatusEnum.Started]: 'neutral',\n    [SessionStatusEnum.Done]: 'primary',\n}\n\nconst toSessionStatusIcon = {\n    [SessionStatusEnum.Started]: 'arrow-repeat-circle-fill',\n    [SessionStatusEnum.Done]: 'check-circle-fill',\n}\n\nconst HistoryItem: FC<{\n    data: SimulationSessions\n    prefix?: string\n    onNavigation: (s: SessionDto['session_id']) => void\n}> = ({ data, onNavigation, prefix }) => {\n    const career = toCareerChoice[data.career]\n    const seniority = toSeniorityChoice[data.seniority_level]\n    const date = formatDate(data.creation_date)\n\n    const handleNavigation = useCallback(\n        (e: Event) => {\n            e.stopImmediatePropagation()\n            onNavigation(data.session_id)\n        },\n        [onNavigation, data],\n    )\n    return (\n        <sl-card className={styles.wrapper}>\n            <div slot=\"header\">\n                <i>{data?.session_id?.slice(0, 10)}</i>\n            </div>\n\n            <div onClick={handleNavigation}>\n                <stack-l space=\"var(--s-1)\">\n                    <h4>\n                        {prefix} Session for {seniority} {career}\n                    </h4>\n\n                    <cluster-l align=\"center\" space=\"var(--s-5)\">\n                        <sl-tooltip content=\"Started At\">\n                            <sl-icon name=\"calendar-event\"></sl-icon>\n                        </sl-tooltip>\n                        <p>{date}</p>\n                    </cluster-l>\n                </stack-l>\n\n                <cluster-l justify=\"flex-end\" className={styles.footer}>\n                    <cluster-l\n                        className={styles.status}\n                        space=\"var(--s-3)\"\n                        align=\"center\"\n                    >\n                        <sl-icon\n                            name={\n                                toSessionStatusIcon[\n                                    data?.session_status ??\n                                        SessionStatusEnum.Started\n                                ]\n                            }\n                            variant={\n                                toSessionStatusVariant[\n                                    data?.session_status ??\n                                        SessionStatusEnum.Started\n                                ] as Variant\n                            }\n                        />\n\n                        <em>{data.session_status}</em>\n                    </cluster-l>\n                </cluster-l>\n            </div>\n        </sl-card>\n    )\n}\n\nexport default HistoryItem\n","path":null,"size_bytes":2959,"size_tokens":null},"frontend/src/components/pagination/index.tsx":{"content":"import { FC } from 'react'\nimport { PAGINATION_LIMITS } from '../../features/app/_store/constants'\nimport { type PaginationControls } from '../../features/app/_store/state'\nimport Limiter from './limiter'\nimport Pager from './pager'\nimport styles from './pagination.module.css'\n\ninterface PaginationControlsProps {\n    count: number\n    pagination: PaginationControls\n    onPaginationChange: (\n        p: Pick<PaginationControls, 'offset' | 'limit'>,\n    ) => void\n}\n\nconst Pagination: FC<PaginationControlsProps> = ({\n    count,\n    pagination,\n    onPaginationChange,\n}) => {\n    const { hasMore, limit, offset } = pagination\n\n    if (count < 1) return null\n\n    return (\n        <center-l andText className={styles.pagination} data-landmark>\n            <Pager\n                count={count}\n                hasMore={hasMore}\n                limit={limit}\n                offset={offset}\n                onOffsetChange={(offset) => {\n                    onPaginationChange({ offset })\n                }}\n            >\n                <Limiter\n                    count={count}\n                    limit={limit}\n                    limits={PAGINATION_LIMITS}\n                    offset={offset}\n                    onLimitChange={(limit) => {\n                        onPaginationChange({ limit, offset: 0 })\n                    }}\n                />\n            </Pager>\n        </center-l>\n    )\n}\n\nexport default Pagination\n","path":null,"size_bytes":1427,"size_tokens":null},"frontend/src/components/pagination/pager.tsx":{"content":"import { ReactNode } from 'react'\nimport { PaginationControls } from '../../features/app/_store/state'\nimport styles from './pager.module.css'\n\nconst Pager = ({\n    children,\n    limit,\n    hasMore,\n    offset,\n    onOffsetChange,\n}: PaginationControls & {\n    count: number\n    onOffsetChange: (offset: number) => void\n    children: ReactNode\n}) => {\n    const prevDisabled = offset! <= 0\n    const nextDisabled = !hasMore\n\n    return (\n        <sl-button-group className={styles.pager}>\n            <sl-button\n                disabled={prevDisabled}\n                variant=\"default\"\n                onClick={\n                    !prevDisabled\n                        ? () => onOffsetChange(offset! - limit!)\n                        : null\n                }\n            >\n                <sl-icon slot=\"prefix\" name=\"chevron-left\" />\n            </sl-button>\n            {children}\n            <sl-button\n                disabled={!hasMore}\n                variant=\"default\"\n                onClick={\n                    !nextDisabled\n                        ? () => onOffsetChange(offset! + limit!)\n                        : null\n                }\n            >\n                <sl-icon slot=\"prefix\" name=\"chevron-right\" />\n            </sl-button>\n        </sl-button-group>\n    )\n}\n\nexport default Pager\n","path":null,"size_bytes":1310,"size_tokens":null},"frontend/src/components/intro-drawer/index.tsx":{"content":"import { FC, VNode } from 'react'\nimport Achievements from './achievements'\nimport DrawerHeader from './drawer-header'\nimport styles from './index.module.css'\nimport Instructions from './instructions'\n\nexport interface IntroDrawerProps {\n    description: string\n    footer: VNode\n    icon: string\n    open: boolean\n    title: string\n}\n\nexport type IntroDrawerHeaderProps = Omit<IntroDrawerProps, 'footer' | 'open'>\n\nconst IntroDrawer: FC<IntroDrawerProps> = ({\n    open,\n    footer,\n    ...props\n}) => {\n    return (\n        <sl-drawer open={open} className={styles.drawer} placement=\"start\">\n            <DrawerHeader {...props} />\n            <stack-l space=\"var(--s3)\">\n                <Instructions />\n                <Achievements />\n            </stack-l>\n            {footer}\n        </sl-drawer>\n    )\n}\n\nexport default IntroDrawer\n","path":null,"size_bytes":840,"size_tokens":null},"frontend/src/features/offer-negotiation/offer/controls.tsx":{"content":"import { FC } from 'react'\nimport styles from './index.module.css'\n\nconst Controls: FC<{\n    disabled: boolean\n    onNegotiation: () => void\n}> = ({ disabled, onNegotiation }) => {\n    return (\n        <cluster-l justify=\"flex-end\" className={styles.footer}>\n            <sl-button\n                variant=\"primary\"\n                outline\n                disabled={disabled}\n                onClick={onNegotiation}\n            >\n                Negotiate the Offer\n                <sl-icon slot=\"suffix\" name=\"arrow-right\" />\n            </sl-button>\n        </cluster-l>\n    )\n}\n\nexport default Controls\n","path":null,"size_bytes":606,"size_tokens":null},"frontend/src/components/intro-drawer/drawer-header/index.tsx":{"content":"import { FC } from 'react'\nimport { IntroDrawerHeaderProps } from '..'\nimport CircleIcon from '../../circle-icon'\nimport styles from './index.module.css'\n\nconst DrawerHeader: FC<IntroDrawerHeaderProps> = ({\n    title,\n    description,\n    icon,\n}) => {\n    return (\n        <stack-l className={styles.header} slot=\"label\" space=\"var(--s1)\">\n            <cluster-l\n                space=\"var(--s-1)\"\n                align=\"flex-start\"\n                justify=\"flex-start\"\n            >\n                <CircleIcon icon={icon} variant=\"primary\" size=\"large\" />\n                <stack-l space=\"0\">\n                    <h3 className={styles.title}>{title}</h3>\n                    <p>{description}</p>\n                </stack-l>\n            </cluster-l>\n\n            <cluster-l\n                align=\"center\"\n                space=\"var(--s-1)\"\n                className={styles.commitmentNote}\n            >\n                <sl-icon name=\"clock\" />\n                <p>15-20 minutes of commitment</p>\n            </cluster-l>\n        </stack-l>\n    )\n}\n\nexport default DrawerHeader\n","path":null,"size_bytes":1077,"size_tokens":null},"frontend/src/components/simulation-header/index.tsx":{"content":"import { FC } from 'react'\nimport { useCallback } from 'react'\nimport CircleIcon from '../circle-icon'\nimport styles from './index.module.css'\n\nconst SimulationHeader: FC<{\n    title: string\n    icon: string\n    onExit: () => void\n}> = ({ title, icon, onExit }) => {\n    const handleExit = useCallback(() => {\n        onExit()\n    }, [onExit])\n\n    return (\n        <cluster-l justify=\"space-between\" className={styles.header} align=\"center\">\n            <cluster-l space=\"var(--s-1)\" align=\"center\">\n                <CircleIcon className={styles.icon} variant=\"primary\" icon={icon} />\n                <h3>{title}</h3>\n            </cluster-l>\n\n            <sl-button outline onClick={handleExit}>\n                <sl-icon slot=\"prefix\" name=\"box-arrow-left\" />\n                Exit Simulation\n            </sl-button>\n        </cluster-l>\n    )\n}\n\nexport default SimulationHeader\n","path":null,"size_bytes":881,"size_tokens":null},"frontend/src/features/offer-negotiation/drawer-footer/index.tsx":{"content":"import { FC } from 'react'\n\nconst NegotiationDrawerFooter: FC<{\n    onStart: () => void\n}> = ({ onStart }) => {\n    return (\n        <cluster-l slot=\"footer\" justify=\"flex-end\" space=\"var(--s-1)\">\n            <sl-button variant=\"primary\" onClick={onStart}>\n                <sl-icon slot=\"prefix\" name=\"flag\" />\n                Get started\n            </sl-button>\n        </cluster-l>\n    )\n}\n\nexport default NegotiationDrawerFooter\n","path":null,"size_bytes":433,"size_tokens":null},"frontend/src/features/interview-feedback/index.tsx":{"content":"import { FC } from 'react'\nimport { useCallback, useEffect } from 'react'\nimport { useDispatch } from 'react-redux'\nimport DOMPurify from 'dompurify'\nimport SimulationHeader from '../../components/simulation-header'\nimport { isNullish } from '../../utils'\nimport { isNone } from '../../utils/is-none'\nimport { useOnce } from '../../utils/use-once'\nimport { RootDispatch } from '../app/_store'\nimport { Status } from '../app/_store/state'\nimport navigation from '../app/navigation'\nimport { SIMULATION_ICONS } from '../dashboard/models'\nimport {\n    resetSimulation,\n    setSessionId,\n} from '../interview-practice/_store/reducer'\nimport useInterviewSimulation from '../interview-practice/_store/use-interview-details'\nimport { generateInterviewFeedback } from './_store/effects'\nimport { resetFeedback } from './_store/reducer'\nimport useInterviewFeedback from './_store/use-interview-feedback'\nimport Tabs from './_tabs'\nimport { InterviewFeedbackTabs } from './_tabs/headers'\nimport styles from './index.module.css'\nimport InterviewHistory from './interview-history'\n\nconst Skeleton = () => {\n    return (\n        <center-l>\n            <stack-l space=\"var(--s-1)\">\n                Hang tight as we are generating the interview feedback.\n                <center-l andText>\n                    <h2>\n                        <sl-spinner></sl-spinner>\n                    </h2>\n                </center-l>\n            </stack-l>\n        </center-l>\n    )\n}\n\nconst Controls: FC<{\n    disabled: boolean\n    onRetake: () => void\n    onDone: () => void\n}> = ({ disabled, onDone, onRetake }) => {\n    return (\n        <cluster-l justify=\"flex-end\" className={styles.footer}>\n            <cluster-l space=\"var(--s-2)\">\n                <sl-button onClick={onRetake} disabled={disabled}>\n                    <sl-icon name=\"arrow-repeat\" slot=\"prefix\" />\n                    Repeat Simulation\n                </sl-button>\n                <sl-button\n                    onClick={onDone}\n                    variant=\"primary\"\n                    disabled={disabled}\n                >\n                    <sl-icon name=\"check\" slot=\"prefix\" />\n                    Done\n                </sl-button>\n            </cluster-l>\n        </cluster-l>\n    )\n}\n\nconst InterviewFeedback = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId } = useInterviewSimulation()\n    const { feedback, areas_for_improvement, status } = useInterviewFeedback()\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (!isNullish(routeSessionId)) {\n            dispatch(setSessionId(routeSessionId))\n            dispatch(\n                generateInterviewFeedback({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    useEffect(() => {\n        if (!isNullish(sessionId)) {\n            navigation.goToSearchParams({\n                sessionId,\n            })\n        }\n    }, [sessionId])\n\n    const handleReset = useCallback(() => {\n        dispatch(resetFeedback())\n        dispatch(resetSimulation())\n    }, [dispatch])\n\n    const handleRetake = useCallback(() => {\n        handleReset()\n        navigation.goToInterviewPracticePage()\n    }, [handleReset])\n\n    const handleDone = useCallback(() => {\n        handleReset()\n        navigation.goToHome()\n    }, [handleReset])\n\n    const isPending = status === Status.PENDING\n\n    return (\n        <cover-l space=\"0\">\n            <SimulationHeader\n                icon={SIMULATION_ICONS.INTERVIEW_PRACTICE}\n                title=\"Interview Practice\"\n                onExit={handleDone}\n            />\n            <stack-l space=\"0\" className={styles.tabWrapper}>\n                <Tabs isPending={isPending}>\n                    <sl-tab-panel name={InterviewFeedbackTabs.FEEDBACK} active>\n                        <stack-l space=\"var(--s-2)\">\n                            {isPending ? (\n                                <Skeleton />\n                            ) : (\n                                <stack-l space=\"var(--s-1)\">\n                                    {!isNone(feedback) ? (\n                                        <stack-l\n                                            space=\"var(--s-3)\"\n                                            className={styles.feedback}\n                                        >\n                                            <h1>Interview Feedback</h1>\n\n                                            <div\n                                                className={styles.feedback}\n                                                dangerouslySetInnerHTML={{\n                                                    __html: DOMPurify.sanitize(\n                                                        feedback!,\n                                                    ),\n                                                }}\n                                            ></div>\n                                        </stack-l>\n                                    ) : null}\n\n                                    {!isNone(areas_for_improvement) ? (\n                                        <stack-l\n                                            space=\"var(--s-3)\"\n                                            className={styles.feedback}\n                                        >\n                                            <h3>Areas for improvement</h3>\n                                            <div\n                                                className={styles.feedback}\n                                                dangerouslySetInnerHTML={{\n                                                    __html: DOMPurify.sanitize(\n                                                        areas_for_improvement!,\n                                                    ),\n                                                }}\n                                            ></div>\n                                        </stack-l>\n                                    ) : null}\n                                </stack-l>\n                            )}\n                        </stack-l>\n                    </sl-tab-panel>\n\n                    <sl-tab-panel name={InterviewFeedbackTabs.REVIEW_QUESTIONS}>\n                        <InterviewHistory />\n                    </sl-tab-panel>\n                </Tabs>\n            </stack-l>\n\n            <Controls\n                disabled={isPending}\n                onRetake={handleRetake}\n                onDone={handleDone}\n            />\n        </cover-l>\n    )\n}\n\nexport default InterviewFeedback\n","path":null,"size_bytes":6599,"size_tokens":null},"frontend/src/features/interview-practice/interview-chat/index.tsx":{"content":"import { useCallback, useRef } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { SessionStatusEnum } from '../../../__generated__/api'\nimport SimulationChat from '../../../components/simulation-chat'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport navigation from '../../app/navigation'\nimport { resetFeedback } from '../../interview-feedback/_store/reducer'\nimport { sendMessage, startInterviewSession } from '../_store/effects'\nimport { resetSimulation } from '../_store/reducer'\nimport useInterviewSimulation from '../_store/use-interview-details'\nimport InterviewMessage from '../interview-message'\nimport ChatControls from './controls'\nimport styles from './index.module.css'\n\nconst InterviewMessages = () => {\n    const { sessionId, messages, sessionState, status } =\n        useInterviewSimulation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const isPending = status === Status.PENDING\n    const isDone = sessionState === SessionStatusEnum.Done\n\n    const handleReset = useCallback(() => {\n        dispatch(resetFeedback())\n        dispatch(resetSimulation())\n    }, [dispatch])\n\n    const handleRetake = useCallback(() => {\n        handleReset()\n        dispatch(startInterviewSession())\n    }, [handleReset, dispatch])\n\n    const handleReview = useCallback(() => {\n        navigation.goToInterviewFeedbackPage(sessionId!)\n    }, [sessionId])\n\n    return (\n        <stack-l className={styles.messages} space=\"var(--s-2)\">\n            {messages.map((message) => {\n                return (\n                    <InterviewMessage\n                        key={message.id}\n                        message={message}\n                        isPending={isPending}\n                        showQuestionReason={false}\n                    />\n                )\n            })}\n\n            {isDone ? (\n                <cluster-l space=\"var(--s-2)\">\n                    <sl-button onClick={handleRetake}>\n                        <sl-icon name=\"arrow-repeat\" slot=\"prefix\" />\n                        Retake Simulation\n                    </sl-button>\n\n                    <sl-button onClick={handleReview}>\n                        <sl-icon name=\"check\" slot=\"prefix\" />\n                        Review and Finish\n                    </sl-button>\n                </cluster-l>\n            ) : null}\n        </stack-l>\n    )\n}\n\nconst InterviewChat = () => {\n    const { sessionId, messages, sessionState, status } =\n        useInterviewSimulation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const formRef = useRef<HTMLFormElement | null>(null)\n    const isPending = status === Status.PENDING\n    const isDone = sessionState === SessionStatusEnum.Done\n\n    const onSend = useCallback(\n        (message: string) => {\n            dispatch(\n                sendMessage({\n                    session_id: sessionId!,\n                    message,\n                }),\n            )\n        },\n        [dispatch, sessionId],\n    )\n\n    return (\n        <SimulationChat\n            messages={<InterviewMessages />}\n            controls={\n                <ChatControls\n                    messages={messages}\n                    disabled={isPending || isDone}\n                    onSend={onSend}\n                    formRef={formRef}\n                />\n            }\n        />\n    )\n}\n\nexport default InterviewChat\n","path":null,"size_bytes":3386,"size_tokens":null},"frontend/src/features/offer-negotiation/chat/index.tsx":{"content":"import { useCallback, useRef } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { SessionStatusEnum } from '../../../__generated__/api'\nimport SimulationChat from '../../../components/simulation-chat'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport navigation from '../../app/navigation'\nimport ChatControls from '../../interview-practice/interview-chat/controls'\nimport InterviewMessage from '../../interview-practice/interview-message'\nimport {\n    sendNegotiationMessage,\n    startNegotiationSession,\n} from '../_store/effects'\nimport { resetOfferNegotiation } from '../_store/reducer'\nimport useOfferNegotiation from '../_store/use-offer-negotiation'\nimport styles from './index.module.css'\n\nconst NegotiationMessages = () => {\n    const { messages, sessionState, status, sessionId } = useOfferNegotiation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const isPending = status === Status.PENDING\n    const isDone = sessionState === SessionStatusEnum.Done\n\n    const handleReset = useCallback(() => {\n        dispatch(resetOfferNegotiation())\n    }, [dispatch])\n\n    const handleRetake = useCallback(() => {\n        handleReset()\n        dispatch(startNegotiationSession())\n    }, [handleReset, dispatch])\n\n    const handleReview = useCallback(() => {\n        navigation.goToNegotiationFeedbackPage(sessionId!)\n    }, [sessionId])\n\n    return (\n        <stack-l className={styles.messages} space=\"var(--s-2)\">\n            {messages.map((message) => {\n                return (\n                    <InterviewMessage\n                        key={message.id}\n                        message={message}\n                        isPending={isPending}\n                        showQuestionReason={false}\n                    />\n                )\n            })}\n\n            {isDone ? (\n                <cluster-l space=\"var(--s-2)\">\n                    <sl-button onClick={handleRetake}>\n                        <sl-icon name=\"arrow-repeat\" slot=\"prefix\" />\n                        Retake Simulation\n                    </sl-button>\n\n                    <sl-button onClick={handleReview}>\n                        <sl-icon name=\"check\" slot=\"prefix\" />\n                        Review and Finish\n                    </sl-button>\n                </cluster-l>\n            ) : null}\n        </stack-l>\n    )\n}\n\nconst NegotiationChat = () => {\n    const { sessionId, messages, sessionState, status } = useOfferNegotiation()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const formRef = useRef<HTMLFormElement | null>(null)\n    const isPending = status === Status.PENDING\n    const isDone = sessionState === SessionStatusEnum.Done\n\n    const onSend = useCallback(\n        (message: string) => {\n            dispatch(\n                sendNegotiationMessage({\n                    session_id: sessionId!,\n                    message,\n                }),\n            )\n        },\n        [dispatch, sessionId],\n    )\n\n    return (\n        <SimulationChat\n            messages={<NegotiationMessages />}\n            controls={\n                <ChatControls\n                    messages={messages}\n                    disabled={isPending || isDone}\n                    onSend={onSend}\n                    formRef={formRef}\n                />\n            }\n        />\n    )\n}\n\nexport default NegotiationChat\n","path":null,"size_bytes":3372,"size_tokens":null},"frontend/src/components/field/index.tsx":{"content":"import { FC } from 'react'\nimport { SlInputProps } from '../../ui/shoelace/shoelace'\nimport styles from './index.module.css'\n\nconst InputField: FC<SlInputProps> = ({\n    children,\n    class: className,\n    ...props\n}) => {\n    const inputCls = `${styles.field} ${className}`\n\n    return (\n        <sl-input {...props} className={inputCls}>\n            {children}\n        </sl-input>\n    )\n}\n\nexport default InputField\n","path":null,"size_bytes":418,"size_tokens":null},"frontend/src/components/scroll-to-top/index.ts":{"content":"import { useLocation } from 'react-router-dom'\nimport { useEffect } from 'react'\n\nexport const ScrollToTop = () => {\n    const location = useLocation()\n\n    useEffect(() => {\n        globalThis.scrollTo(0, 0)\n    }, [location.pathname, location.search])\n\n    return null\n}\n","path":null,"size_bytes":273,"size_tokens":null},"frontend/src/pages/interview-practice.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../features/auth/require-auth'\nimport InterviewPractice from '../features/interview-practice'\n\nconst InterviewPracticePage: FC = () => {\n    return (\n        <RequireAuth>\n            <InterviewPractice />\n        </RequireAuth>\n    )\n}\n\nexport default InterviewPracticePage\n","path":null,"size_bytes":331,"size_tokens":null},"frontend/src/features/dashboard/account-form/index.tsx":{"content":"import { useCallback, useRef, useState } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { UserProfileUpdateDto } from '../../../__generated__/api'\nimport InputField from '../../../components/field'\nimport HelpText from '../../../components/help-text'\nimport { RootDispatch } from '../../app/_store'\nimport { updateProfile } from '../../auth/_store/effects'\nimport useAuth from '../../auth/use-auth'\nimport Career from './career'\nimport Gender from './gender'\nimport styles from './index.module.css'\nimport { FORM_NAMES } from './models'\nimport Seniority from './seniority'\n\nconst AccountForm = () => {\n    const { error } = useAuth()\n\n    const dispatch = useDispatch<RootDispatch>()\n    const formRef = useRef<HTMLFormElement | null>(null)\n\n    const [formData, setFormData] = useState<UserProfileUpdateDto | null>()\n\n    const handleChange = useCallback((e: CustomEvent) => {\n        const target = e.target as HTMLInputElement\n\n        setFormData((prevState) => {\n            return {\n                ...prevState,\n                [target.name]: target.value,\n            } as UserProfileUpdateDto\n        })\n    }, [])\n\n    const handleSubmit = useCallback(\n        (e: SubmitEvent) => {\n            e.preventDefault()\n\n            const target = e.target as HTMLFormElement\n\n            if (target.checkValidity()) {\n                dispatch(updateProfile(formData as UserProfileUpdateDto))\n            }\n        },\n        [formData, dispatch],\n    )\n\n    return (\n        <sl-dialog open label=\"Setup your profile\" className={styles.dialog}>\n            <form ref={formRef} onSubmit={handleSubmit}>\n                <stack-l space=\"var(--s1)\">\n                    <cluster-l space=\"var(--s-1)\">\n                        <InputField\n                            required\n                            label=\"First Name\"\n                            name={FORM_NAMES.FIRST_NAME}\n                            placeholder=\"Enter your first name\"\n                            onInput={handleChange}\n                            value={formData?.first_name}\n                        />\n                        <InputField\n                            required\n                            label=\"Last Name\"\n                            name={FORM_NAMES.LAST_NAME}\n                            placeholder=\"Enter your last name\"\n                            onInput={handleChange}\n                            value={formData?.last_name}\n                        />\n                    </cluster-l>\n                    <Gender formData={formData} handleChange={handleChange} />\n                    <Career formData={formData} handleChange={handleChange} />\n                    <Seniority\n                        formData={formData}\n                        handleChange={handleChange}\n                    />\n                </stack-l>\n\n                <cluster-l\n                    justify={error ? 'space-between' : 'flex-end'}\n                    slot=\"footer\"\n                >\n                    {error && <HelpText variant=\"danger\" text={error} />}\n\n                    <sl-button variant=\"primary\" type=\"submit\">\n                        Update\n                    </sl-button>\n                </cluster-l>\n            </form>\n        </sl-dialog>\n    )\n}\n\nexport default AccountForm\n","path":null,"size_bytes":3289,"size_tokens":null},"frontend/src/pages/offer-negotiation.tsx":{"content":"import { FC } from 'react'\nimport { RequireAuth } from '../features/auth/require-auth'\nimport OfferNegotiation from '../features/offer-negotiation'\n\nconst OfferNegotiationPage: FC = () => {\n    return (\n        <RequireAuth>\n            <OfferNegotiation />\n        </RequireAuth>\n    )\n}\n\nexport default OfferNegotiationPage\n","path":null,"size_bytes":326,"size_tokens":null},"frontend/src/components/help-text/index.tsx":{"content":"import { FC } from 'react'\nimport { Variant } from '../../ui/shoelace/shoelace'\nimport styles from './index.module.css'\n\nconst ICON_VARIANT_MAP = {\n    danger: {\n        name: 'exclamation-octagon-fill',\n    },\n    neutral: {\n        name: 'gear-fill',\n    },\n    primary: {\n        name: 'info-circle-fill',\n    },\n    success: {\n        name: 'check-circle-fill',\n    },\n    warning: {\n        name: 'exclamation-triangle-fill',\n    },\n    text: {\n        name: '',\n    },\n    default: {\n        name: '',\n    },\n}\n\nconst HelpText: FC<{\n    variant?: Variant | null\n    text: string\n    tooltip?: string\n    slot?: string\n}> = ({ variant, text, slot, tooltip, children, ...props }, ref) => {\n    const iconType = ICON_VARIANT_MAP[variant ?? 'neutral']\n    const shortText =\n        (text ?? '').length > 50 ? `${(text ?? '').substring(0, 47)}...` : text\n\n    return (\n        <sl-tooltip\n            slot={slot}\n            content={tooltip ?? text}\n            placement=\"bottom-start\"\n            className={styles.tooltip}\n        >\n            {children}\n            <cluster-l\n                className={`${styles.helpText} ${styles[variant ?? 'neutral']}`}\n                align=\"center\"\n                space=\"var(--s-3)\"\n                ref={ref}\n                {...props}\n            >\n                <sl-icon name={iconType.name} />\n                <span className=\"ellipsis\">{shortText}</span>\n            </cluster-l>\n        </sl-tooltip>\n    )\n}\n\nexport default HelpText\n","path":null,"size_bytes":1489,"size_tokens":null},"frontend/src/features/auth/login/index.tsx":{"content":"import { FC, useCallback, useEffect, useRef, useState } from 'react'\nimport { useDispatch } from 'react-redux'\nimport InputField from '../../../components/field'\nimport Logo from '../../../components/logo'\nimport { isNullish } from '../../../utils'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport navigation from '../../app/navigation'\nimport { login } from '../_store/effects'\nimport { logout } from '../_store/reducer'\nimport useAuth from '../use-auth'\n\nconst CONTENT = {\n    TITLE: 'LOGIN',\n    CTA: \"Don't have an account?\",\n}\n\nconst LoginPage: FC = () => {\n    const dispatch = useDispatch<RootDispatch>()\n    const formRef = useRef<HTMLFormElement | null>(null)\n    const { status, token } = useAuth()\n    const [credentials, setCredentials] = useState({\n        username: '',\n        password: '',\n    })\n\n    // Clear any stale auth state when landing on login page\n    useEffect(() => {\n        dispatch(logout())\n    }, [dispatch])\n\n    const isPending = status === Status.PENDING\n\n    const handleChange = useCallback((event: CustomEvent) => {\n        const target = event.target as HTMLInputElement\n\n        setCredentials((prevState) => {\n            return {\n                ...prevState,\n                [`${target.name}`]: target.value,\n            }\n        })\n    }, [])\n\n    const handleSubmit = useCallback(\n        (e: SubmitEvent) => {\n            e.preventDefault()\n\n            if (formRef.current?.checkValidity()) {\n                dispatch(login(credentials))\n            }\n        },\n        [credentials, dispatch, formRef],\n    )\n\n    useEffect(() => {\n        if (!isNullish(token)) {\n            navigation.goToHome()\n        }\n    }, [token])\n\n    return (\n        <stack-l space=\"0\">\n            <cover-l space=\"0\" minHeight=\"80vh\" centered=\"stack-l\">\n                <stack-l space=\"var(--s0)\">\n                    <center-l justify=\"center\">\n                        <Logo size=\"large\" />\n                    </center-l>\n                    <center-l>\n                        <h2>{CONTENT.TITLE}</h2>\n                    </center-l>\n\n                    <center-l>\n                        <form onSubmit={handleSubmit} ref={formRef}>\n                            <stack-l space=\"var(--s1)\">\n                                <stack-l space=\"var(--s-2)\">\n                                    <InputField\n                                        id=\"username\"\n                                        label=\"Username\"\n                                        name=\"username\"\n                                        placeholder=\"Enter your username\"\n                                        required\n                                        size=\"large\"\n                                        type=\"text\"\n                                        value={credentials.username}\n                                        onInput={handleChange}\n                                    >\n                                        <sl-icon\n                                            name=\"person-fill\"\n                                            slot=\"prefix\"\n                                        />\n                                    </InputField>\n\n                                    <InputField\n                                        id=\"password\"\n                                        label=\"Password\"\n                                        name=\"password\"\n                                        placeholder=\"Enter your password\"\n                                        required\n                                        size=\"large\"\n                                        type=\"password\"\n                                        value={credentials.password}\n                                        onInput={handleChange}\n                                    >\n                                        <sl-icon\n                                            name=\"key-fill\"\n                                            slot=\"prefix\"\n                                        />\n                                    </InputField>\n                                </stack-l>\n\n                                <center-l andText>\n                                    <sl-button\n                                        type=\"submit\"\n                                        variant=\"primary\"\n                                        size=\"large\"\n                                        loading={isPending || undefined}\n                                        disabled={isPending || undefined}\n                                    >\n                                        Login\n                                    </sl-button>\n                                </center-l>\n                                <center-l andText>\n                                    <stack-l space=\"var(--s-1)\">\n                                        <span>{CONTENT.CTA}</span>\n                                        <center-l>\n                                            <sl-button\n                                                variant=\"default\"\n                                                onClick={\n                                                    navigation.goToRegistrationPage\n                                                }\n                                            >\n                                                Register\n                                            </sl-button>\n                                        </center-l>\n                                    </stack-l>\n                                </center-l>\n                            </stack-l>\n                        </form>\n                    </center-l>\n                </stack-l>\n            </cover-l>\n        </stack-l>\n    )\n}\n\nexport default LoginPage\n","path":null,"size_bytes":5782,"size_tokens":null},"frontend/src/features/negotiation-sessions/index.tsx":{"content":"import { useCallback, useLayoutEffect } from 'react'\nimport { useDispatch } from 'react-redux'\nimport { SessionStatusEnum } from '../../__generated__/api'\nimport HistoryItem from '../../components/history-item'\nimport Pagination from '../../components/pagination'\nimport { keyify } from '../../utils/string'\nimport { RootDispatch } from '../app/_store'\nimport { PaginationControls, Status } from '../app/_store/state'\nimport navigation from '../app/navigation'\nimport { DashboardTabs } from '../dashboard/models'\nimport {\n    resetNegotiationSessions,\n    setNegotiationSessionsPagination,\n} from './_store/reducer'\nimport { initialNegotiationSessionsPagination } from './_store/state'\nimport useNegotiationSessions from './_store/use-negotiation-sessions'\nimport styles from './index.module.css'\n\nconst NegotiationSessions = () => {\n    const { status, error, data, pagination } = useNegotiationSessions()\n    const dispatch = useDispatch<RootDispatch>()\n\n    const isPending = status === Status.PENDING\n    const isError = status === Status.ERROR\n    const count = data && data?.length ? data?.length : 0\n\n    const title = DashboardTabs.NEGOTIATION_SESSIONS?.replace('-', ' ')\n\n    useLayoutEffect(() => {\n        dispatch(\n            setNegotiationSessionsPagination({\n                ...initialNegotiationSessionsPagination,\n            }),\n        )\n\n        return () => {\n            dispatch(resetNegotiationSessions())\n        }\n    }, [dispatch])\n\n    const handlePaginationChange = useCallback(\n        (p: Pick<PaginationControls, 'offset' | 'limit'>) => {\n            dispatch(setNegotiationSessionsPagination(p))\n        },\n        [dispatch],\n    )\n\n    return (\n        <cover-l className={styles.wrapper}>\n            {isPending ? (\n                <center-l andText>\n                    <sl-spinner></sl-spinner>\n                </center-l>\n            ) : isError ? (\n                <center-l>\n                    <stack-l space=\"var(--s-2)\">\n                        <h2>Something went wrong</h2>\n                        <p>{error?.message}</p>\n                    </stack-l>\n                </center-l>\n            ) : (\n                <>\n                    <stack-l space=\"var(--s0)\">\n                        <cluster-l justify=\"space-between\">\n                            <h3 className={styles.title}>{title}</h3>\n                            <sl-badge pill variant=\"primary\">\n                                {count}\n                            </sl-badge>\n                        </cluster-l>\n                        <stack-l space=\"var(--s-1)\">\n                            {data?.map((d) => (\n                                <HistoryItem\n                                    key={keyify(d.session_id)}\n                                    data={d}\n                                    prefix=\"Offer Negotiation\"\n                                    onNavigation={\n                                        d.session_status ===\n                                        SessionStatusEnum.Done\n                                            ? navigation.goToNegotiationFeedbackPage\n                                            : navigation.goToNegotiationDetailsPage\n                                    }\n                                />\n                            ))}\n                        </stack-l>\n                    </stack-l>\n                    <Pagination\n                        count={count}\n                        pagination={pagination}\n                        onPaginationChange={handlePaginationChange}\n                    />\n                </>\n            )}\n        </cover-l>\n    )\n}\n\nexport default NegotiationSessions\n","path":null,"size_bytes":3659,"size_tokens":null},"frontend/src/components/typing-dots/index.tsx":{"content":"import styles from './index.module.css'\n\nconst TypingDots = () => {\n    return <div className={styles.typing}></div>\n}\n\nexport default TypingDots\n","path":null,"size_bytes":146,"size_tokens":null},"frontend/src/features/interview-feedback/interview-history/index.tsx":{"content":"import { useDispatch } from 'react-redux'\nimport SimulationChat from '../../../components/simulation-chat'\nimport { isNullish } from '../../../utils'\nimport { useOnce } from '../../../utils/use-once'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport { getHistory } from '../../interview-practice/_store/effects'\nimport { setSessionId } from '../../interview-practice/_store/reducer'\nimport useInterviewSimulation from '../../interview-practice/_store/use-interview-details'\nimport InterviewMessage from '../../interview-practice/interview-message'\n\nconst InterviewMessages = () => {\n    const { messages, status } = useInterviewSimulation()\n    const isPending = status === Status.PENDING\n\n    return (\n        <stack-l space=\"var(--s-2)\">\n            {messages.map((message) => {\n                return (\n                    <InterviewMessage\n                        key={message.id}\n                        message={message}\n                        isPending={isPending}\n                        showQuestionReason={true}\n                    />\n                )\n            })}\n        </stack-l>\n    )\n}\n\n// NOTE (hom): redundant duplication\n// We should always have access to the store data\n// TODO (hom): this should be made into a generic and accept simulation store as a dependency\nconst InterviewHistory = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId } = useInterviewSimulation()\n\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (isNullish(sessionId) && !isNullish(routeSessionId)) {\n            dispatch(setSessionId(routeSessionId))\n            dispatch(\n                getHistory({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    return <SimulationChat messages={<InterviewMessages />} />\n}\n\nexport default InterviewHistory\n","path":null,"size_bytes":1955,"size_tokens":null},"frontend/src/features/negotiation-feedback/negotiation-history/index.tsx":{"content":"import { useDispatch } from 'react-redux'\nimport SimulationChat from '../../../components/simulation-chat'\nimport { isNullish } from '../../../utils'\nimport { useOnce } from '../../../utils/use-once'\nimport { RootDispatch } from '../../app/_store'\nimport { Status } from '../../app/_store/state'\nimport NegotiationMessage from '../../interview-practice/interview-message'\nimport { getNegotiationHistory } from '../../offer-negotiation/_store/effects'\nimport { setNegotiationSessionId } from '../../offer-negotiation/_store/reducer'\nimport useOfferNegotiation from '../../offer-negotiation/_store/use-offer-negotiation'\n\nconst NegotiationMessages = () => {\n    const { messages, status } = useOfferNegotiation()\n    const isPending = status === Status.PENDING\n\n    return (\n        <stack-l space=\"var(--s-2)\">\n            {messages.map((message) => {\n                return (\n                    <NegotiationMessage\n                        key={message.id}\n                        message={message}\n                        isPending={isPending}\n                        showQuestionReason={true}\n                    />\n                )\n            })}\n        </stack-l>\n    )\n}\n\nconst NegotiationHistory = () => {\n    const [{ matches }] = useRouter()\n    const routeSessionId = matches?.sessionId || null\n    const { sessionId } = useOfferNegotiation()\n\n    const dispatch = useDispatch<RootDispatch>()\n\n    useOnce(() => {\n        if (isNullish(sessionId) && !isNullish(routeSessionId)) {\n            dispatch(setNegotiationSessionId(routeSessionId))\n            dispatch(\n                getNegotiationHistory({\n                    sessionId: routeSessionId!,\n                }),\n            )\n        }\n    })\n\n    return <SimulationChat messages={<NegotiationMessages />} />\n}\n\nexport default NegotiationHistory\n","path":null,"size_bytes":1818,"size_tokens":null},"frontend/src/ui/index.ts":{"content":"import { setBasePath } from '@shoelace-style/shoelace/dist/utilities/base-path.js'\n\n// Import individual Shoelace components\nimport '@shoelace-style/shoelace/dist/components/avatar/avatar.js'\nimport '@shoelace-style/shoelace/dist/components/badge/badge.js'\nimport '@shoelace-style/shoelace/dist/components/button/button.js'\nimport '@shoelace-style/shoelace/dist/components/button-group/button-group.js'\nimport '@shoelace-style/shoelace/dist/components/card/card.js'\nimport '@shoelace-style/shoelace/dist/components/checkbox/checkbox.js'\nimport '@shoelace-style/shoelace/dist/components/dialog/dialog.js'\nimport '@shoelace-style/shoelace/dist/components/dropdown/dropdown.js'\nimport '@shoelace-style/shoelace/dist/components/icon/icon.js'\nimport '@shoelace-style/shoelace/dist/components/icon-button/icon-button.js'\nimport '@shoelace-style/shoelace/dist/components/input/input.js'\nimport '@shoelace-style/shoelace/dist/components/menu/menu.js'\nimport '@shoelace-style/shoelace/dist/components/menu-item/menu-item.js'\nimport '@shoelace-style/shoelace/dist/components/menu-label/menu-label.js'\nimport '@shoelace-style/shoelace/dist/components/option/option.js'\nimport '@shoelace-style/shoelace/dist/components/popup/popup.js'\nimport '@shoelace-style/shoelace/dist/components/radio-button/radio-button.js'\nimport '@shoelace-style/shoelace/dist/components/radio-group/radio-group.js'\nimport '@shoelace-style/shoelace/dist/components/select/select.js'\nimport '@shoelace-style/shoelace/dist/components/skeleton/skeleton.js'\nimport '@shoelace-style/shoelace/dist/components/spinner/spinner.js'\nimport '@shoelace-style/shoelace/dist/components/switch/switch.js'\nimport '@shoelace-style/shoelace/dist/components/tab/tab.js'\nimport '@shoelace-style/shoelace/dist/components/tab-group/tab-group.js'\nimport '@shoelace-style/shoelace/dist/components/tab-panel/tab-panel.js'\nimport '@shoelace-style/shoelace/dist/components/textarea/textarea.js'\nimport '@shoelace-style/shoelace/dist/components/tooltip/tooltip.js'\n\nimport './layouts'\n\n// Use CDN for Shoelace assets (icons, etc.)\nsetBasePath('https://cdn.jsdelivr.net/npm/@shoelace-style/shoelace@2.19.1/dist/')\n","path":null,"size_bytes":2148,"size_tokens":null},"frontend/src/features/auth/_store/state.ts":{"content":"import { UserTokenDto } from '../../../__generated__/api'\nimport { Status } from '../../app/_store/state'\n\nexport const ACCESS_TOKEN = 'ACCESS'\nexport const REFRESH_TOKEN = 'REFRESH'\nexport const USER = 'USER'\n\nexport type AuthState = {\n    status?: Status | null\n    error?: string | null\n    token?: string | null\n} & Omit<UserTokenDto, 'access'>\n\nconst getUserFromStorage = () => {\n    try {\n        const stored = globalThis.localStorage.getItem(USER)\n        return stored ? JSON.parse(stored) : null\n    } catch {\n        return null\n    }\n}\n\nexport const initialState: AuthState = {\n    user: getUserFromStorage(),\n    token: globalThis.localStorage.getItem(ACCESS_TOKEN) ?? null,\n    refresh: globalThis.localStorage.getItem(REFRESH_TOKEN) ?? null,\n    error: null,\n    status: null,\n}\n","path":null,"size_bytes":794,"size_tokens":null},"frontend/src/features/dashboard/_tabs/headers.tsx":{"content":"import { useSearchParams } from 'react-router-dom'\nimport { keyify } from '../../../utils/string'\nimport {\n    DashboardTabs,\n    DashboardTabsString,\n    toDashboardTabsIcons,\n} from '../models'\nimport {\n    DashboardTabsContent,\n    DashboardTabsContentDefault,\n} from './to-dashboard-content'\n\nconst TabHeaders = () => {\n    const [searchParams] = useSearchParams()\n    const activeTab = searchParams.get('tab')\n\n    return (\n        <>\n            {(Object.keys(DashboardTabs) as DashboardTabsString[]).map(\n                (key) => {\n                    const { disabled } =\n                        DashboardTabsContent[DashboardTabs[key]] ??\n                        DashboardTabsContentDefault\n\n                    return (\n                        <sl-tab\n                            key={keyify(key)}\n                            panel={DashboardTabs[key]}\n                            slot=\"nav\"\n                            disabled={disabled}\n                            active={activeTab === DashboardTabs[key]}\n                        >\n                            <sl-menu-item disabled={disabled}>\n                                <sl-icon\n                                    name={\n                                        toDashboardTabsIcons[DashboardTabs[key]]\n                                    }\n                                    slot=\"prefix\"\n                                />\n                                {(key.includes('_')\n                                    ? key.replace('_', ' ')\n                                    : key\n                                )?.toLowerCase()}\n                            </sl-menu-item>\n                        </sl-tab>\n                    )\n                },\n            )}\n        </>\n    )\n}\n\nexport default TabHeaders\n","path":null,"size_bytes":1782,"size_tokens":null},"frontend/src/features/dashboard/_tabs/panels.tsx":{"content":"import { useSearchParams } from 'react-router-dom'\nimport { keyify } from '../../../utils/string'\nimport { DashboardTabs, DashboardTabsString } from '../models'\nimport {\n    DashboardTabsContent,\n    DashboardTabsContentDefault,\n} from './to-dashboard-content'\n\nconst TabPanels = () => {\n    const [searchParams] = useSearchParams()\n    const activeTab = searchParams.get('tab')\n\n    return (\n        <>\n            {(Object.keys(DashboardTabs) as DashboardTabsString[]).map(\n                (tab) => {\n                    const { content } =\n                        DashboardTabsContent[DashboardTabs[tab]] ??\n                        DashboardTabsContentDefault\n\n                    return (\n                        <sl-tab-panel\n                            name={DashboardTabs[tab]}\n                            key={keyify(DashboardTabs[tab])}\n                            active={activeTab === DashboardTabs[tab]}\n                        >\n                            {activeTab === DashboardTabs[tab] && content}\n                        </sl-tab-panel>\n                    )\n                },\n            )}\n        </>\n    )\n}\n\nexport default TabPanels\n","path":null,"size_bytes":1158,"size_tokens":null},"client/src/pages/journey.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation, Link } from \"wouter\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Tabs, TabsList, TabsTrigger, TabsContent } from \"@/components/ui/tabs\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { OfferLetter } from \"@/components/OfferLetter\";\nimport { ModeBanner } from \"@/components/ModeBanner\";\nimport type { OfferDetails, InterviewSession, InterviewQuestion, InterviewFeedback } from \"@shared/schema\";\nimport { \n  Briefcase, Calendar, Check, ChevronRight, Clock, FileText, MapPin, \n  MessageCircle, Play, Target, Users, ArrowRight, ArrowLeft,\n  Rocket, Trophy, Video, Building2, Eye, Loader2, CheckCircle, AlertCircle, TrendingUp,\n  History, Star, MessageSquare, Code, UserCheck, Timer, Award, ChevronDown\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { format } from \"date-fns\";\n\ninterface Company {\n  id: number;\n  name: string;\n  logo: string | null;\n  industry: string;\n  size: string;\n}\n\ninterface JobPosting {\n  id: number;\n  title: string;\n  role: string;\n  seniority: string;\n  location: string;\n  interviewStages: number;\n  company: Company;\n}\n\ninterface ApplicationStage {\n  id: number;\n  applicationId: number;\n  stageOrder: number;\n  stageName: string;\n  stageType: string;\n  status: string;\n  scheduledAt: string | null;\n  completedAt: string | null;\n  score: number | null;\n  feedback: string | null;\n  interviewSessionId: number | null;\n}\n\ninterface JobApplication {\n  id: number;\n  userId: number;\n  jobPostingId: number;\n  status: string;\n  coverLetter: string | null;\n  currentStageIndex: number;\n  appliedAt: string | null;\n  job: JobPosting;\n  stages: ApplicationStage[];\n  offerDetails: OfferDetails | null;\n}\n\ninterface InterviewFeedbackData {\n  overallScore: number;\n  communicationScore: number;\n  technicalScore?: number;\n  problemSolvingScore: number;\n  cultureFitScore: number;\n  summary: string;\n  strengths: string[];\n  improvements: string[];\n  recommendations: string[];\n  hiringDecision: string;\n}\n\ninterface FeedbackResponse {\n  feedback: InterviewFeedbackData;\n  session: {\n    interviewType: string;\n    targetRole: string;\n    completedAt: string;\n  };\n}\n\n// Interview History Types\ninterface InterviewHistorySession {\n  id: number;\n  userId: number;\n  interviewType: string;\n  targetRole: string;\n  difficulty: string;\n  status: string;\n  currentQuestionIndex: number;\n  totalQuestions: number;\n  overallScore: number | null;\n  startedAt: string;\n  completedAt: string | null;\n}\n\ninterface InterviewHistoryQuestion {\n  id: number;\n  sessionId: number;\n  questionIndex: number;\n  questionText: string;\n  questionType: string;\n  candidateAnswer: string | null;\n  score: number | null;\n  feedback: string | null;\n  strengths: string[];\n  improvements: string[];\n  askedAt: string;\n  answeredAt: string | null;\n}\n\ninterface InterviewHistoryDetail {\n  session: InterviewHistorySession;\n  questions: InterviewHistoryQuestion[];\n  feedback: InterviewFeedbackData | null;\n}\n\nfunction FeedbackModal({ \n  isOpen, \n  onClose, \n  sessionId,\n  stageName\n}: { \n  isOpen: boolean; \n  onClose: () => void;\n  sessionId: number | null;\n  stageName: string;\n}) {\n  const { data, isLoading, error } = useQuery<FeedbackResponse>({\n    queryKey: [`/api/interviews/${sessionId}/feedback`],\n    enabled: isOpen && !!sessionId\n  });\n\n  const getHiringDecisionColor = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'bg-green-100 text-green-800';\n      case 'yes': return 'bg-green-50 text-green-700';\n      case 'maybe': return 'bg-yellow-100 text-yellow-800';\n      case 'no': return 'bg-red-50 text-red-700';\n      case 'strong_no': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getHiringDecisionText = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'Strong Hire';\n      case 'yes': return 'Hire';\n      case 'maybe': return 'Maybe';\n      case 'no': return 'No Hire';\n      case 'strong_no': return 'Strong No';\n      default: return decision;\n    }\n  };\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[85vh] overflow-y-auto\" data-testid=\"dialog-feedback\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <Trophy className=\"h-5 w-5 text-blue-600\" />\n            {stageName} - Interview Feedback\n          </DialogTitle>\n        </DialogHeader>\n\n        {isLoading && (\n          <div className=\"flex items-center justify-center py-12\">\n            <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\n          </div>\n        )}\n\n        {error && (\n          <div className=\"text-center py-8 text-gray-500\">\n            <AlertCircle className=\"h-12 w-12 mx-auto mb-3 text-gray-300\" />\n            <p>Unable to load feedback</p>\n          </div>\n        )}\n\n        {data?.feedback && (\n          <div className=\"space-y-6\">\n            <div className=\"text-center py-4\">\n              <div className=\"text-5xl font-bold text-blue-600 mb-2\" data-testid=\"text-modal-overall-score\">\n                {data.feedback.overallScore}\n              </div>\n              <p className=\"text-gray-500\">Overall Score</p>\n              <div className={cn(\n                \"inline-block px-4 py-2 rounded-full mt-3 font-medium\",\n                getHiringDecisionColor(data.feedback.hiringDecision)\n              )} data-testid=\"text-modal-hiring-decision\">\n                {getHiringDecisionText(data.feedback.hiringDecision)}\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n              <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                <div className=\"text-xl font-semibold text-gray-900 dark:text-white\" data-testid=\"text-modal-communication-score\">\n                  {data.feedback.communicationScore}\n                </div>\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">Communication</p>\n              </div>\n              {data.feedback.technicalScore !== null && data.feedback.technicalScore !== undefined && (\n                <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"text-xl font-semibold text-gray-900 dark:text-white\" data-testid=\"text-modal-technical-score\">\n                    {data.feedback.technicalScore}\n                  </div>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400\">Technical</p>\n                </div>\n              )}\n              <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                <div className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                  {data.feedback.problemSolvingScore}\n                </div>\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">Problem Solving</p>\n              </div>\n              <div className=\"text-center p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                <div className=\"text-xl font-semibold text-gray-900 dark:text-white\">\n                  {data.feedback.cultureFitScore}\n                </div>\n                <p className=\"text-xs text-gray-600 dark:text-gray-400\">Culture Fit</p>\n              </div>\n            </div>\n\n            <div className=\"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg\">\n              <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">Summary</h4>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">{data.feedback.summary}</p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg\">\n                <h4 className=\"font-medium text-green-800 dark:text-green-300 flex items-center gap-2 mb-3\">\n                  <CheckCircle className=\"h-4 w-4\" />\n                  Strengths\n                </h4>\n                <ul className=\"space-y-2\">\n                  {data.feedback.strengths.map((strength, i) => (\n                    <li key={i} className=\"text-sm text-green-700 dark:text-green-400 flex items-start gap-2\">\n                      <span className=\"text-green-500 mt-1\"></span>\n                      {strength}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n\n              <div className=\"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg\">\n                <h4 className=\"font-medium text-amber-800 dark:text-amber-300 flex items-center gap-2 mb-3\">\n                  <TrendingUp className=\"h-4 w-4\" />\n                  Areas to Improve\n                </h4>\n                <ul className=\"space-y-2\">\n                  {data.feedback.improvements.map((improvement, i) => (\n                    <li key={i} className=\"text-sm text-amber-700 dark:text-amber-400 flex items-start gap-2\">\n                      <span className=\"text-amber-500 mt-1\"></span>\n                      {improvement}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n\n            {data.feedback.recommendations.length > 0 && (\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n                <h4 className=\"font-medium text-blue-800 dark:text-blue-300 mb-3\">Recommendations</h4>\n                <ul className=\"space-y-2\">\n                  {data.feedback.recommendations.map((rec, i) => (\n                    <li key={i} className=\"text-sm text-blue-700 dark:text-blue-400 flex items-start gap-2\">\n                      <span className=\"text-blue-500 mt-1\">{i + 1}.</span>\n                      {rec}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction CelebrationModal({\n  isOpen,\n  onClose,\n  company,\n  job,\n  startDate,\n  onStartOnboarding\n}: {\n  isOpen: boolean;\n  onClose: () => void;\n  company: { name: string; logo: string | null };\n  job: { title: string; role: string };\n  startDate: string;\n  onStartOnboarding: () => void;\n}) {\n  return (\n    <Dialog open={isOpen} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-lg text-center\" data-testid=\"dialog-celebration\">\n        <div className=\"py-6\">\n          {/* Confetti/celebration visual */}\n          <div className=\"relative mb-6\">\n            <div className=\"absolute inset-0 flex items-center justify-center\">\n              <div className=\"w-32 h-32 rounded-full bg-gradient-to-br from-green-100 to-emerald-200 dark:from-green-900/30 dark:to-emerald-800/30 animate-pulse\" />\n            </div>\n            <div className=\"relative flex items-center justify-center\">\n              <div className=\"h-24 w-24 rounded-2xl bg-white dark:bg-gray-800 shadow-lg flex items-center justify-center text-4xl font-bold text-primary border-4 border-green-500\">\n                {company.name.charAt(0)}\n              </div>\n            </div>\n          </div>\n          \n          {/* Celebration text */}\n          <div className=\"space-y-2 mb-6\">\n            <h2 className=\"text-3xl font-extrabold text-gray-900 dark:text-white\">\n              Offer Accepted! \n            </h2>\n            <p className=\"text-lg text-gray-600 dark:text-gray-400\">\n              Welcome to <span className=\"font-semibold text-primary\">{company.name}</span>\n            </p>\n            <p className=\"text-gray-500 dark:text-gray-500\">\n              {job.title}\n            </p>\n          </div>\n          \n          {/* Start date */}\n          <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 mb-6\">\n            <p className=\"text-sm text-gray-500 dark:text-gray-400 mb-1\">Your start date</p>\n            <p className=\"text-xl font-bold text-gray-900 dark:text-white\" data-testid=\"text-celebration-start-date\">\n              {startDate}\n            </p>\n          </div>\n          \n          {/* CTA */}\n          <Button \n            onClick={onStartOnboarding}\n            size=\"lg\"\n            className=\"w-full h-14 text-lg font-semibold bg-green-600 hover:bg-green-700\"\n            data-testid=\"button-start-onboarding\"\n          >\n            <Rocket className=\"h-5 w-5 mr-2\" />\n            Start Onboarding Journey\n          </Button>\n          \n          <button\n            onClick={onClose}\n            className=\"mt-4 text-sm text-gray-500 hover:text-gray-700 dark:hover:text-gray-300\"\n          >\n            I'll start later\n          </button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nfunction getStatusColor(status: string): string {\n  switch (status) {\n    case \"submitted\": return \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\";\n    case \"interviewing\": return \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300\";\n    case \"offer\": return \"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\";\n    case \"rejected\": return \"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300\";\n    case \"withdrawn\": return \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\";\n    default: return \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\";\n  }\n}\n\nfunction getStageIcon(type: string) {\n  switch (type) {\n    case \"recruiter_call\": return <MessageCircle className=\"h-4 w-4\" />;\n    case \"behavioral\": return <Users className=\"h-4 w-4\" />;\n    case \"technical\": return <FileText className=\"h-4 w-4\" />;\n    case \"case_study\": return <Target className=\"h-4 w-4\" />;\n    case \"portfolio\": return <Briefcase className=\"h-4 w-4\" />;\n    case \"team\": return <Users className=\"h-4 w-4\" />;\n    case \"panel\": return <Users className=\"h-4 w-4\" />;\n    default: return <Calendar className=\"h-4 w-4\" />;\n  }\n}\n\nfunction getStageTypeLabel(type: string): string {\n  switch (type) {\n    case \"recruiter_call\": return \"Recruiter Call\";\n    case \"behavioral\": return \"Behavioral\";\n    case \"technical\": return \"Technical\";\n    case \"case_study\": return \"Case Study\";\n    case \"portfolio\": return \"Portfolio Review\";\n    case \"team\": return \"Team Interview\";\n    case \"panel\": return \"Panel Interview\";\n    default: return type;\n  }\n}\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    maximumFractionDigits: 0,\n  }).format(amount);\n}\n\n// Compact list item for the left panel\nfunction ApplicationListItem({ \n  application, \n  isSelected,\n  onClick\n}: { \n  application: JobApplication;\n  isSelected: boolean;\n  onClick: () => void;\n}) {\n  const completedStages = application.stages.filter(s => s.status === 'completed' || s.status === 'passed').length;\n  const progressPercent = (completedStages / application.stages.length) * 100;\n  \n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"w-full text-left p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors overflow-hidden\",\n        isSelected && \"bg-primary/5 dark:bg-primary/10 border-l-2 border-l-primary\"\n      )}\n      data-testid={`list-item-${application.id}`}\n    >\n      <div className=\"flex items-start gap-3 overflow-hidden\">\n        <div className=\"h-10 w-10 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-lg font-semibold text-primary shrink-0\">\n          {application.job.company.name.charAt(0)}\n        </div>\n        <div className=\"flex-1 min-w-0 overflow-hidden\">\n          <div className=\"flex items-center gap-2\">\n            <h3 className=\"font-medium text-gray-900 dark:text-white truncate text-sm flex-1 min-w-0\">\n              {application.job.title}\n            </h3>\n            <Badge className={cn(getStatusColor(application.status), \"text-xs shrink-0 whitespace-nowrap\")}>\n              {application.status === 'offer' ? ' Offer' : application.status}\n            </Badge>\n          </div>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">\n            {application.job.company.name}\n          </p>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <Progress value={progressPercent} className=\"h-1.5 flex-1\" />\n            <span className=\"text-xs text-gray-500 shrink-0\">\n              {completedStages}/{application.stages.length}\n            </span>\n          </div>\n        </div>\n      </div>\n    </button>\n  );\n}\n\n// Stage timeline for the detail panel\nfunction StageTimeline({ \n  stages, \n  currentIndex,\n  onStartInterview,\n  onViewFeedback\n}: { \n  stages: ApplicationStage[]; \n  currentIndex: number;\n  onStartInterview: (stage: ApplicationStage) => void;\n  onViewFeedback: (stage: ApplicationStage) => void;\n}) {\n  return (\n    <div className=\"relative\">\n      <div className=\"absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700\" />\n      \n      <div className=\"space-y-4\">\n        {stages.map((stage, index) => {\n          const isCompleted = stage.status === 'completed' || stage.status === 'passed';\n          const isCurrent = index === currentIndex && !isCompleted;\n          const hasFeedback = isCompleted && stage.interviewSessionId;\n          \n          return (\n            <div key={stage.id} className=\"relative flex items-start gap-4\">\n              <div \n                className={cn(\n                  \"relative z-10 flex items-center justify-center w-8 h-8 rounded-full border-2\",\n                  isCompleted && \"bg-green-500 border-green-500 text-white\",\n                  isCurrent && \"bg-primary border-primary text-white\",\n                  !isCompleted && !isCurrent && \"bg-white dark:bg-gray-800 border-gray-300 dark:border-gray-600 text-gray-400\"\n                )}\n              >\n                {isCompleted ? (\n                  <Check className=\"h-4 w-4\" />\n                ) : (\n                  <span className=\"text-xs font-medium\">{stage.stageOrder}</span>\n                )}\n              </div>\n              \n              <div className=\"flex-1 pb-4\">\n                <div className=\"flex items-center justify-between gap-2\">\n                  <div>\n                    <h4 className={cn(\n                      \"font-medium\",\n                      isCompleted && \"text-green-600\",\n                      isCurrent && \"text-gray-900 dark:text-white\",\n                      !isCompleted && !isCurrent && \"text-gray-400\"\n                    )}>\n                      {stage.stageName}\n                    </h4>\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500 mt-0.5\">\n                      {getStageIcon(stage.stageType)}\n                      <span>{getStageTypeLabel(stage.stageType)}</span>\n                    </div>\n                  </div>\n                  \n                  <div className=\"flex items-center gap-2\">\n                    {isCompleted && stage.score && (\n                      <Badge variant=\"outline\" className=\"text-green-600 border-green-200\">\n                        {stage.score}%\n                      </Badge>\n                    )}\n                    \n                    {hasFeedback && (\n                      <Button \n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => onViewFeedback(stage)}\n                        data-testid={`button-view-feedback-${stage.id}`}\n                        className=\"text-blue-600 border-blue-200 hover:bg-blue-50 dark:hover:bg-blue-900/20\"\n                      >\n                        <Eye className=\"h-3 w-3 mr-1\" />\n                        Feedback\n                      </Button>\n                    )}\n                    \n                    {isCurrent && (\n                      <Button \n                        size=\"sm\"\n                        onClick={() => onStartInterview(stage)}\n                        data-testid={`button-start-interview-${stage.id}`}\n                      >\n                        <Play className=\"h-3 w-3 mr-1\" />\n                        Start\n                      </Button>\n                    )}\n                  </div>\n                </div>\n                \n                {isCompleted && stage.feedback && (\n                  <p className=\"text-sm text-gray-500 mt-2 bg-gray-50 dark:bg-gray-800 p-2 rounded text-xs\">\n                    {stage.feedback}\n                  </p>\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\n// Detail panel showing selected application\nfunction ApplicationDetail({ \n  application,\n  onStartInterview,\n  onBack,\n  userId\n}: { \n  application: JobApplication;\n  onStartInterview: (stage: ApplicationStage) => void;\n  onBack: () => void;\n  userId?: number;\n}) {\n  const [, navigate] = useLocation();\n  const [feedbackModal, setFeedbackModal] = useState<{ isOpen: boolean; sessionId: number | null; stageName: string }>({\n    isOpen: false,\n    sessionId: null,\n    stageName: ''\n  });\n  const [celebrationModal, setCelebrationModal] = useState(false);\n  \n  const completedStages = application.stages.filter(s => s.status === 'completed' || s.status === 'passed').length;\n  const progressPercent = (completedStages / application.stages.length) * 100;\n\n  const [workspaceId, setWorkspaceId] = useState<number | null>(null);\n  \n  // Mutation to update application status\n  const updateStatusMutation = useMutation({\n    mutationFn: async (status: string) => {\n      const response = await apiRequest('PATCH', `/api/applications/${application.id}`, { status });\n      return response.json();\n    },\n    onSuccess: async (_, status) => {\n      if (userId) {\n        queryClient.invalidateQueries({ queryKey: [`/api/users/${userId}/applications`] });\n      }\n      \n      if (status === 'accepted') {\n        try {\n          const journeyResponse = await fetch(`/api/user/${userId}/journey`);\n          if (journeyResponse.ok) {\n            const journey = await journeyResponse.json();\n            const workspaceResponse = await fetch(`/api/journeys/${journey.id}/workspace`);\n            if (workspaceResponse.ok) {\n              const workspace = await workspaceResponse.json();\n              setWorkspaceId(workspace.id);\n            }\n          }\n        } catch (error) {\n          console.error('Failed to fetch workspace after offer acceptance:', error);\n        }\n        setCelebrationModal(true);\n      }\n    }\n  });\n\n  const handleViewFeedback = (stage: ApplicationStage) => {\n    if (stage.interviewSessionId) {\n      setFeedbackModal({\n        isOpen: true,\n        sessionId: stage.interviewSessionId,\n        stageName: stage.stageName\n      });\n    }\n  };\n\n  const handleAcceptOffer = () => {\n    updateStatusMutation.mutate('accepted');\n  };\n\n  const handleDeclineOffer = () => {\n    if (confirm('Are you sure you want to decline this offer? This action cannot be undone.')) {\n      updateStatusMutation.mutate('declined');\n    }\n  };\n\n  const handleStartOnboarding = () => {\n    setCelebrationModal(false);\n    if (workspaceId) {\n      navigate(`/workspace/${workspaceId}`);\n    } else {\n      navigate('/journey-dashboard');\n    }\n  };\n  \n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\n        <button \n          onClick={onBack}\n          className=\"md:hidden flex items-center gap-1 text-sm text-gray-500 mb-3 hover:text-gray-700\"\n          data-testid=\"button-back-to-list\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to list\n        </button>\n        \n        <div className=\"flex items-start gap-4\">\n          <div className=\"h-14 w-14 rounded-xl bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-2xl font-bold text-primary\">\n            {application.job.company.name.charAt(0)}\n          </div>\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n                {application.job.title}\n              </h2>\n              <Badge className={getStatusColor(application.status)}>\n                {application.status}\n              </Badge>\n            </div>\n            <p className=\"text-gray-600 dark:text-gray-400\">\n              {application.job.company.name}  {application.job.company.industry}\n            </p>\n            <div className=\"flex items-center gap-3 mt-2 text-sm text-gray-500\">\n              <span className=\"flex items-center gap-1\">\n                <MapPin className=\"h-3.5 w-3.5\" />\n                {application.job.location}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Building2 className=\"h-3.5 w-3.5\" />\n                {application.job.company.size}\n              </span>\n            </div>\n          </div>\n        </div>\n        \n        {/* Progress bar */}\n        <div className=\"mt-4\">\n          <div className=\"flex items-center justify-between text-sm mb-2\">\n            <span className=\"text-gray-500\">Interview Progress</span>\n            <span className=\"font-medium\">{completedStages}/{application.stages.length} stages</span>\n          </div>\n          <Progress value={progressPercent} className=\"h-2\" />\n        </div>\n      </div>\n      \n      {/* Content */}\n      <ScrollArea className=\"flex-1\">\n        <div className=\"p-4 space-y-6\">\n          {/* Show Offer Letter if status is offer */}\n          {application.status === 'offer' && application.offerDetails && (\n            <OfferLetter \n              offer={application.offerDetails}\n              company={application.job.company}\n              job={{\n                title: application.job.title,\n                role: application.job.role,\n                location: application.job.location,\n              }}\n              candidateName=\"Test User\"\n              onProceedToNegotiation={() => navigate(`/negotiation?applicationId=${application.id}`)}\n              onAcceptOffer={handleAcceptOffer}\n              onDeclineOffer={handleDeclineOffer}\n              isLoading={updateStatusMutation.isPending}\n            />\n          )}\n          \n          {application.status === 'offer' && !application.offerDetails && (\n            <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <Trophy className=\"h-8 w-8 text-green-500\" />\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-semibold text-green-700 dark:text-green-400\">\n                      Congratulations! You received an offer!\n                    </h4>\n                    <p className=\"text-sm text-green-600 dark:text-green-500\">\n                      Negotiate to maximize your compensation package\n                    </p>\n                  </div>\n                  <Button \n                    onClick={() => navigate(`/negotiation?applicationId=${application.id}`)}\n                    className=\"bg-green-600 hover:bg-green-700 text-white\"\n                  >\n                    Negotiate Your Offer\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n          \n          {/* Interview Stages */}\n          <div>\n            <h3 className=\"font-semibold text-gray-900 dark:text-white mb-4\">Interview Stages</h3>\n            <StageTimeline \n              stages={application.stages} \n              currentIndex={application.currentStageIndex}\n              onStartInterview={onStartInterview}\n              onViewFeedback={handleViewFeedback}\n            />\n          </div>\n        </div>\n      </ScrollArea>\n\n      <FeedbackModal\n        isOpen={feedbackModal.isOpen}\n        onClose={() => setFeedbackModal({ isOpen: false, sessionId: null, stageName: '' })}\n        sessionId={feedbackModal.sessionId}\n        stageName={feedbackModal.stageName}\n      />\n\n      <CelebrationModal\n        isOpen={celebrationModal}\n        onClose={() => setCelebrationModal(false)}\n        company={application.job.company}\n        job={{ title: application.job.title, role: application.job.role }}\n        startDate={application.offerDetails?.startDate || 'TBD'}\n        onStartOnboarding={handleStartOnboarding}\n      />\n    </div>\n  );\n}\n\n// Stats bar\nfunction JourneyStats({ applications }: { applications: JobApplication[] }) {\n  const stats = {\n    totalApplications: applications.length,\n    interviewing: applications.filter(a => a.status === 'interviewing' || a.status === 'submitted').length,\n    offers: applications.filter(a => a.status === 'offer').length,\n    interviewsCompleted: applications.reduce((acc, app) => \n      acc + app.stages.filter(s => s.status === 'completed' || s.status === 'passed').length, 0\n    ),\n  };\n  \n  return (\n    <div className=\"grid grid-cols-4 gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700 overflow-hidden shrink-0\">\n      <div className=\"text-center\">\n        <div className=\"text-lg font-bold text-gray-900 dark:text-white\">{stats.totalApplications}</div>\n        <div className=\"text-xs text-gray-500\">Apps</div>\n      </div>\n      <div className=\"text-center\">\n        <div className=\"text-lg font-bold text-yellow-600\">{stats.interviewing}</div>\n        <div className=\"text-xs text-gray-500\">Active</div>\n      </div>\n      <div className=\"text-center\">\n        <div className=\"text-lg font-bold text-purple-600\">{stats.interviewsCompleted}</div>\n        <div className=\"text-xs text-gray-500\">Interviews</div>\n      </div>\n      <div className=\"text-center\">\n        <div className=\"text-lg font-bold text-green-600\">{stats.offers}</div>\n        <div className=\"text-xs text-gray-500\">Offers</div>\n      </div>\n    </div>\n  );\n}\n\nfunction EmptyState() {\n  const [, navigate] = useLocation();\n  \n  return (\n    <div className=\"flex-1 flex items-center justify-center p-8\">\n      <div className=\"text-center\">\n        <div className=\"mx-auto h-20 w-20 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4\">\n          <Rocket className=\"h-10 w-10 text-gray-400\" />\n        </div>\n        <h3 className=\"font-semibold text-xl text-gray-900 dark:text-white mb-2\">\n          Start Your Job Journey\n        </h3>\n        <p className=\"text-gray-500 max-w-md mx-auto mb-6\">\n          Browse job listings, apply to positions, and complete your interviews.\n        </p>\n        <Button onClick={() => navigate('/jobs')} size=\"lg\" data-testid=\"button-browse-jobs\">\n          <Briefcase className=\"h-5 w-5 mr-2\" />\n          Browse Jobs\n        </Button>\n      </div>\n    </div>\n  );\n}\n\nfunction LoadingSkeleton() {\n  return (\n    <div className=\"flex h-full\">\n      <div className=\"w-80 border-r border-gray-200 dark:border-gray-700\">\n        <div className=\"p-3 border-b\">\n          <Skeleton className=\"h-6 w-full\" />\n        </div>\n        {Array.from({ length: 4 }).map((_, i) => (\n          <div key={i} className=\"p-4 border-b\">\n            <div className=\"flex gap-3\">\n              <Skeleton className=\"h-10 w-10 rounded-lg\" />\n              <div className=\"flex-1 space-y-2\">\n                <Skeleton className=\"h-4 w-3/4\" />\n                <Skeleton className=\"h-3 w-1/2\" />\n                <Skeleton className=\"h-1.5 w-full\" />\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n      <div className=\"flex-1 p-6\">\n        <div className=\"space-y-4\">\n          <div className=\"flex gap-4\">\n            <Skeleton className=\"h-14 w-14 rounded-xl\" />\n            <div className=\"space-y-2\">\n              <Skeleton className=\"h-6 w-48\" />\n              <Skeleton className=\"h-4 w-32\" />\n            </div>\n          </div>\n          <Skeleton className=\"h-2 w-full\" />\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Interview History Components\nfunction getInterviewTypeIcon(type: string) {\n  switch (type) {\n    case 'behavioral': return <Users className=\"h-4 w-4\" />;\n    case 'technical': return <Code className=\"h-4 w-4\" />;\n    case 'case_study': return <Target className=\"h-4 w-4\" />;\n    default: return <MessageSquare className=\"h-4 w-4\" />;\n  }\n}\n\nfunction getInterviewTypeLabel(type: string): string {\n  switch (type) {\n    case 'behavioral': return 'Behavioral';\n    case 'technical': return 'Technical';\n    case 'case_study': return 'Case Study';\n    default: return type;\n  }\n}\n\nfunction getRoleLabel(role: string): string {\n  switch (role) {\n    case 'developer': return 'Developer';\n    case 'pm': return 'Product Manager';\n    case 'designer': return 'Designer';\n    case 'data-scientist': return 'Data Scientist';\n    default: return role;\n  }\n}\n\nfunction getScoreColor(score: number | null): string {\n  if (!score) return 'text-gray-400';\n  if (score >= 70) return 'text-green-600 dark:text-green-400';\n  if (score >= 50) return 'text-yellow-600 dark:text-yellow-400';\n  return 'text-red-600 dark:text-red-400';\n}\n\nfunction getStatusBadge(status: string) {\n  switch (status) {\n    case 'completed':\n      return <Badge className=\"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\">Completed</Badge>;\n    case 'in_progress':\n      return <Badge className=\"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300\">In Progress</Badge>;\n    case 'abandoned':\n      return <Badge className=\"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\">Abandoned</Badge>;\n    default:\n      return <Badge>{status}</Badge>;\n  }\n}\n\nfunction InterviewSessionListItem({\n  session,\n  isSelected,\n  onClick\n}: {\n  session: InterviewHistorySession;\n  isSelected: boolean;\n  onClick: () => void;\n}) {\n  const startedAt = session.startedAt || session.startedAt;\n  const formattedDate = startedAt \n    ? format(new Date(startedAt), 'MMM d, yyyy')\n    : 'Unknown';\n  const formattedTime = startedAt \n    ? format(new Date(startedAt), 'h:mm a')\n    : '';\n  \n  const interviewType = session.interviewType || 'behavioral';\n  const targetRole = session.targetRole || 'developer';\n  const status = session.status || 'in_progress';\n  \n  return (\n    <button\n      onClick={onClick}\n      className={cn(\n        \"w-full text-left p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors\",\n        isSelected && \"bg-primary/5 dark:bg-primary/10 border-l-2 border-l-primary\"\n      )}\n      data-testid={`interview-session-${session.id}`}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={cn(\n          \"h-10 w-10 rounded-lg flex items-center justify-center shrink-0\",\n          status === 'completed' \n            ? \"bg-green-100 dark:bg-green-900/30 text-green-600\" \n            : \"bg-gray-100 dark:bg-gray-800 text-gray-500\"\n        )}>\n          {getInterviewTypeIcon(interviewType)}\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center justify-between gap-2\">\n            <h3 className=\"font-medium text-gray-900 dark:text-white truncate text-sm\">\n              {getInterviewTypeLabel(interviewType)} Interview\n            </h3>\n            {session.overallScore && (\n              <span className={cn(\"text-sm font-semibold\", getScoreColor(session.overallScore))}>\n                {session.overallScore}%\n              </span>\n            )}\n          </div>\n          <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n            {getRoleLabel(targetRole)}  {formattedDate}\n          </p>\n          <div className=\"flex items-center gap-2 mt-2\">\n            {getStatusBadge(status)}\n            <span className=\"text-xs text-gray-400\">{formattedTime}</span>\n          </div>\n        </div>\n      </div>\n    </button>\n  );\n}\n\nfunction InterviewTranscript({ questions }: { questions: InterviewHistoryQuestion[] }) {\n  if (!questions.length) {\n    return (\n      <div className=\"text-center py-8 text-gray-500\">\n        No transcript available for this session\n      </div>\n    );\n  }\n  \n  return (\n    <Accordion type=\"single\" collapsible className=\"space-y-2\">\n      {questions.map((q, index) => (\n        <AccordionItem \n          key={q.id} \n          value={`q-${q.id}`}\n          className=\"border rounded-lg bg-white dark:bg-gray-800/50 overflow-hidden\"\n        >\n          <AccordionTrigger className=\"px-4 py-3 hover:no-underline hover:bg-gray-50 dark:hover:bg-gray-800\">\n            <div className=\"flex items-start gap-3 text-left w-full pr-4\">\n              <div className={cn(\n                \"h-6 w-6 rounded-full flex items-center justify-center shrink-0 text-xs font-medium\",\n                q.score && q.score >= 7 \n                  ? \"bg-green-100 text-green-700 dark:bg-green-900/50 dark:text-green-400\"\n                  : q.score && q.score >= 5\n                    ? \"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/50 dark:text-yellow-400\"\n                    : q.score\n                      ? \"bg-red-100 text-red-700 dark:bg-red-900/50 dark:text-red-400\"\n                      : \"bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400\"\n              )}>\n                {index + 1}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-medium text-gray-900 dark:text-white line-clamp-2\">\n                  {q.questionText}\n                </p>\n                {q.score && (\n                  <Badge variant={q.score >= 7 ? \"default\" : q.score >= 5 ? \"secondary\" : \"destructive\"} className=\"mt-1\">\n                    {q.score}/10\n                  </Badge>\n                )}\n              </div>\n            </div>\n          </AccordionTrigger>\n          <AccordionContent className=\"px-4 pb-4\">\n            <div className=\"space-y-4 pt-2\">\n              {/* Candidate Answer */}\n              <div className=\"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-3\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <UserCheck className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                  <span className=\"text-xs font-medium text-blue-700 dark:text-blue-300\">Your Answer</span>\n                </div>\n                <p className=\"text-sm text-gray-700 dark:text-gray-300\">\n                  {q.candidateAnswer || <em className=\"text-gray-400\">No answer recorded</em>}\n                </p>\n              </div>\n              \n              {/* Feedback */}\n              {q.feedback && (\n                <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-3\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <MessageSquare className=\"h-4 w-4 text-gray-600 dark:text-gray-400\" />\n                    <span className=\"text-xs font-medium text-gray-700 dark:text-gray-300\">Feedback</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400\">{q.feedback}</p>\n                </div>\n              )}\n              \n              {/* Strengths & Improvements */}\n              <div className=\"grid grid-cols-2 gap-3\">\n                {q.strengths && q.strengths.length > 0 && (\n                  <div className=\"bg-green-50 dark:bg-green-900/20 rounded-lg p-3\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <CheckCircle className=\"h-4 w-4 text-green-600 dark:text-green-400\" />\n                      <span className=\"text-xs font-medium text-green-700 dark:text-green-300\">Strengths</span>\n                    </div>\n                    <ul className=\"space-y-1\">\n                      {q.strengths.map((s, i) => (\n                        <li key={i} className=\"text-xs text-green-700 dark:text-green-400\"> {s}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n                {q.improvements && q.improvements.length > 0 && (\n                  <div className=\"bg-amber-50 dark:bg-amber-900/20 rounded-lg p-3\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <TrendingUp className=\"h-4 w-4 text-amber-600 dark:text-amber-400\" />\n                      <span className=\"text-xs font-medium text-amber-700 dark:text-amber-300\">Improvements</span>\n                    </div>\n                    <ul className=\"space-y-1\">\n                      {q.improvements.map((s, i) => (\n                        <li key={i} className=\"text-xs text-amber-700 dark:text-amber-400\"> {s}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            </div>\n          </AccordionContent>\n        </AccordionItem>\n      ))}\n    </Accordion>\n  );\n}\n\nfunction InterviewSessionDetail({ \n  sessionId,\n  onBack\n}: { \n  sessionId: number;\n  onBack: () => void;\n}) {\n  const { data, isLoading } = useQuery<InterviewHistoryDetail>({\n    queryKey: [`/api/interviews/${sessionId}/detail`],\n    enabled: !!sessionId\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!data) {\n    return (\n      <div className=\"h-full flex items-center justify-center text-gray-500\">\n        Interview session not found\n      </div>\n    );\n  }\n\n  const { session, questions = [], feedback } = data;\n  \n  // Add defensive guards for session properties\n  const interviewType = session?.interviewType || 'behavioral';\n  const targetRole = session?.targetRole || 'developer';\n  const status = session?.status || 'in_progress';\n  const startedAt = session?.startedAt;\n  const completedAt = session?.completedAt;\n  \n  const formattedDate = startedAt \n    ? format(new Date(startedAt), 'MMMM d, yyyy')\n    : 'Unknown';\n  const duration = completedAt && startedAt\n    ? Math.round((new Date(completedAt).getTime() - new Date(startedAt).getTime()) / 60000)\n    : null;\n\n  return (\n    <div className=\"h-full flex flex-col\">\n      {/* Header */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\n        <button \n          onClick={onBack}\n          className=\"md:hidden flex items-center gap-2 text-sm text-gray-500 mb-3\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n          Back to list\n        </button>\n        \n        <div className=\"flex items-start gap-4\">\n          <div className={cn(\n            \"h-14 w-14 rounded-xl flex items-center justify-center shrink-0\",\n            status === 'completed'\n              ? \"bg-green-100 dark:bg-green-900/30 text-green-600\"\n              : \"bg-gray-100 dark:bg-gray-800 text-gray-500\"\n          )}>\n            {getInterviewTypeIcon(interviewType)}\n          </div>\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-1\">\n              <h2 className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                {getInterviewTypeLabel(interviewType)} Interview\n              </h2>\n              {getStatusBadge(status)}\n            </div>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {getRoleLabel(targetRole)}  {formattedDate}\n            </p>\n            <div className=\"flex items-center gap-4 mt-2 text-xs text-gray-500\">\n              {duration && (\n                <span className=\"flex items-center gap-1\">\n                  <Timer className=\"h-3 w-3\" />\n                  {duration} min\n                </span>\n              )}\n              <span className=\"flex items-center gap-1\">\n                <MessageSquare className=\"h-3 w-3\" />\n                {questions.length} questions\n              </span>\n              {session?.overallScore && (\n                <span className={cn(\"flex items-center gap-1 font-semibold\", getScoreColor(session.overallScore))}>\n                  <Award className=\"h-3 w-3\" />\n                  {session.overallScore}%\n                </span>\n              )}\n            </div>\n          </div>\n        </div>\n      </div>\n      \n      {/* Content Tabs */}\n      <div className=\"flex-1 overflow-hidden\">\n        <Tabs defaultValue=\"transcript\" className=\"h-full flex flex-col\">\n          <div className=\"px-4 pt-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\n            <TabsList className=\"grid w-full max-w-md grid-cols-2\">\n              <TabsTrigger value=\"transcript\" data-testid=\"tab-transcript\">Transcript</TabsTrigger>\n              <TabsTrigger value=\"insights\" data-testid=\"tab-insights\">Insights</TabsTrigger>\n            </TabsList>\n          </div>\n          \n          <ScrollArea className=\"flex-1\">\n            <TabsContent value=\"transcript\" className=\"p-4 m-0\">\n              <InterviewTranscript questions={questions} />\n            </TabsContent>\n            \n            <TabsContent value=\"insights\" className=\"p-4 m-0\">\n              {feedback ? (\n                <div className=\"space-y-6\">\n                  {/* Overall Score Card */}\n                  <Card className=\"bg-gradient-to-r from-primary/5 to-primary/10 border-primary/20\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div>\n                          <h3 className=\"text-lg font-semibold text-gray-900 dark:text-white\">Overall Performance</h3>\n                          <p className=\"text-sm text-gray-500\">{feedback.summary}</p>\n                        </div>\n                        <div className={cn(\n                          \"h-16 w-16 rounded-full flex items-center justify-center text-2xl font-bold\",\n                          feedback.overallScore >= 80 ? \"bg-green-100 text-green-700\" :\n                          feedback.overallScore >= 60 ? \"bg-yellow-100 text-yellow-700\" :\n                          \"bg-red-100 text-red-700\"\n                        )}>\n                          {feedback.overallScore}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                  \n                  {/* Score Breakdown */}\n                  <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                    <Card>\n                      <CardContent className=\"p-4 text-center\">\n                        <MessageSquare className=\"h-5 w-5 mx-auto mb-2 text-blue-500\" />\n                        <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                          {feedback.communicationScore}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">Communication</div>\n                      </CardContent>\n                    </Card>\n                    {feedback.technicalScore && (\n                      <Card>\n                        <CardContent className=\"p-4 text-center\">\n                          <Code className=\"h-5 w-5 mx-auto mb-2 text-purple-500\" />\n                          <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                            {feedback.technicalScore}\n                          </div>\n                          <div className=\"text-xs text-gray-500\">Technical</div>\n                        </CardContent>\n                      </Card>\n                    )}\n                    <Card>\n                      <CardContent className=\"p-4 text-center\">\n                        <Target className=\"h-5 w-5 mx-auto mb-2 text-orange-500\" />\n                        <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                          {feedback.problemSolvingScore}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">Problem Solving</div>\n                      </CardContent>\n                    </Card>\n                    <Card>\n                      <CardContent className=\"p-4 text-center\">\n                        <Users className=\"h-5 w-5 mx-auto mb-2 text-green-500\" />\n                        <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                          {feedback.cultureFitScore}\n                        </div>\n                        <div className=\"text-xs text-gray-500\">Culture Fit</div>\n                      </CardContent>\n                    </Card>\n                  </div>\n                  \n                  {/* Strengths & Improvements */}\n                  <div className=\"grid md:grid-cols-2 gap-4\">\n                    <div className=\"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg\">\n                      <h4 className=\"font-medium text-green-800 dark:text-green-300 mb-3 flex items-center gap-2\">\n                        <CheckCircle className=\"h-4 w-4\" />\n                        Strengths\n                      </h4>\n                      <ul className=\"space-y-2\">\n                        {feedback.strengths.map((s, i) => (\n                          <li key={i} className=\"text-sm text-green-700 dark:text-green-400 flex items-start gap-2\">\n                            <span className=\"text-green-500 mt-1\"></span>\n                            {s}\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                    <div className=\"bg-amber-50 dark:bg-amber-900/20 p-4 rounded-lg\">\n                      <h4 className=\"font-medium text-amber-800 dark:text-amber-300 mb-3 flex items-center gap-2\">\n                        <TrendingUp className=\"h-4 w-4\" />\n                        Areas to Improve\n                      </h4>\n                      <ul className=\"space-y-2\">\n                        {feedback.improvements.map((s, i) => (\n                          <li key={i} className=\"text-sm text-amber-700 dark:text-amber-400 flex items-start gap-2\">\n                            <span className=\"text-amber-500 mt-1\"></span>\n                            {s}\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  </div>\n                  \n                  {/* Recommendations */}\n                  {feedback.recommendations.length > 0 && (\n                    <div className=\"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg\">\n                      <h4 className=\"font-medium text-blue-800 dark:text-blue-300 mb-3\">Recommendations</h4>\n                      <ul className=\"space-y-2\">\n                        {feedback.recommendations.map((rec, i) => (\n                          <li key={i} className=\"text-sm text-blue-700 dark:text-blue-400 flex items-start gap-2\">\n                            <span className=\"text-blue-500 mt-1\">{i + 1}.</span>\n                            {rec}\n                          </li>\n                        ))}\n                      </ul>\n                    </div>\n                  )}\n                </div>\n              ) : (\n                <div className=\"text-center py-12 text-gray-500\">\n                  <Award className=\"h-12 w-12 mx-auto mb-4 text-gray-300\" />\n                  <p>No insights available for this session</p>\n                  <p className=\"text-sm mt-1\">Complete the interview to see your performance analysis</p>\n                </div>\n              )}\n            </TabsContent>\n          </ScrollArea>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n\nfunction InterviewHistoryPanel({ userId }: { userId: number }) {\n  const [selectedSessionId, setSelectedSessionId] = useState<number | null>(null);\n  const [showDetail, setShowDetail] = useState(false);\n  const [filter, setFilter] = useState<'all' | 'completed' | 'in_progress'>('all');\n\n  // Fetch journey-only interviews (tied to job applications)\n  const { data: sessions, isLoading } = useQuery<InterviewHistorySession[]>({\n    queryKey: [`/api/users/${userId}/interviews?mode=journey`],\n    enabled: !!userId\n  });\n\n  const filteredSessions = sessions?.filter(s => {\n    if (filter === 'all') return true;\n    return s.status === filter;\n  }) || [];\n\n  const stats = {\n    total: sessions?.length || 0,\n    completed: sessions?.filter(s => s.status === 'completed').length || 0,\n    avgScore: sessions?.filter(s => s.overallScore)\n      .reduce((acc, s, _, arr) => acc + (s.overallScore || 0) / arr.length, 0) || 0\n  };\n\n  const handleSelectSession = (id: number) => {\n    setSelectedSessionId(id);\n    setShowDetail(true);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full flex items-center justify-center\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-primary\" />\n      </div>\n    );\n  }\n\n  if (!sessions || sessions.length === 0) {\n    return (\n      <div className=\"flex-1 flex items-center justify-center p-8\">\n        <div className=\"text-center\">\n          <div className=\"mx-auto h-20 w-20 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4\">\n            <History className=\"h-10 w-10 text-gray-400\" />\n          </div>\n          <h3 className=\"font-semibold text-xl text-gray-900 dark:text-white mb-2\">\n            No Job Interviews Yet\n          </h3>\n          <p className=\"text-gray-500 max-w-md mx-auto mb-4\">\n            Complete interviews from your job applications to see them here.\n          </p>\n          <p className=\"text-sm text-gray-400\">\n            Looking for practice sessions?{' '}\n            <Link href=\"/interview/history\" className=\"text-blue-600 hover:underline\">\n              View Practice History \n            </Link>\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex-1 flex overflow-hidden\">\n      {/* Left Panel - Session List */}\n      <div className={cn(\n        \"w-full md:w-80 md:min-w-80 md:max-w-80 flex-shrink-0 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex flex-col\",\n        showDetail && \"hidden md:flex\"\n      )}>\n        {/* Stats Bar */}\n        <div className=\"grid grid-cols-3 gap-2 p-3 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"text-center\">\n            <div className=\"text-lg font-bold text-gray-900 dark:text-white\">{stats.total}</div>\n            <div className=\"text-xs text-gray-500\">Total</div>\n          </div>\n          <div className=\"text-center\">\n            <div className=\"text-lg font-bold text-green-600\">{stats.completed}</div>\n            <div className=\"text-xs text-gray-500\">Completed</div>\n          </div>\n          <div className=\"text-center\">\n            <div className={cn(\"text-lg font-bold\", getScoreColor(stats.avgScore))}>\n              {stats.avgScore > 0 ? Math.round(stats.avgScore) : '-'}\n            </div>\n            <div className=\"text-xs text-gray-500\">Avg Score</div>\n          </div>\n        </div>\n        \n        {/* Filter */}\n        <div className=\"p-3 border-b border-gray-200 dark:border-gray-700\">\n          <div className=\"flex gap-2\">\n            {(['all', 'completed', 'in_progress'] as const).map((f) => (\n              <button\n                key={f}\n                onClick={() => setFilter(f)}\n                className={cn(\n                  \"px-3 py-1 text-xs rounded-full transition-colors\",\n                  filter === f \n                    ? \"bg-primary text-white\" \n                    : \"bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700\"\n                )}\n                data-testid={`filter-${f}`}\n              >\n                {f === 'all' ? 'All' : f === 'completed' ? 'Completed' : 'In Progress'}\n              </button>\n            ))}\n          </div>\n        </div>\n        \n        <div className=\"flex-1 overflow-y-auto overflow-x-hidden\">\n          {filteredSessions.map((session) => (\n            <InterviewSessionListItem\n              key={session.id}\n              session={session}\n              isSelected={selectedSessionId === session.id}\n              onClick={() => handleSelectSession(session.id)}\n            />\n          ))}\n        </div>\n      </div>\n      \n      {/* Right Panel - Session Detail */}\n      <div className={cn(\n        \"flex-1 min-w-0 bg-gray-50 dark:bg-gray-900/50\",\n        !showDetail && \"hidden md:block\"\n      )}>\n        {selectedSessionId ? (\n          <InterviewSessionDetail\n            sessionId={selectedSessionId}\n            onBack={() => setShowDetail(false)}\n          />\n        ) : (\n          <div className=\"h-full flex items-center justify-center text-gray-500\">\n            Select an interview to view details\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default function Journey() {\n  const [, navigate] = useLocation();\n  const [selectedId, setSelectedId] = useState<number | null>(null);\n  const [showDetail, setShowDetail] = useState(false);\n  const [activeTab, setActiveTab] = useState<'applications' | 'history'>('applications');\n  \n  const { data: user } = useQuery<{ id: number }>({\n    queryKey: ['/api/user'],\n  });\n\n  const { data: applications, isLoading } = useQuery<JobApplication[]>({\n    queryKey: [user?.id ? `/api/users/${user.id}/applications` : null],\n    enabled: !!user?.id,\n  });\n\n  // Check for active journey\n  const { data: journeys } = useQuery<Array<{ id: number; status: string; journeyMetadata: any }>>({\n    queryKey: ['/api/journeys'],\n    enabled: !!user?.id,\n  });\n\n  const activeJourney = journeys?.find(j => j.status === 'in_progress' || j.status === 'active');\n\n  // Auto-select first application or most promising\n  const selectedApplication = applications?.find(a => a.id === selectedId) \n    || applications?.[0] \n    || null;\n\n  const handleSelectApplication = (id: number) => {\n    setSelectedId(id);\n    setShowDetail(true); // Show detail on mobile\n  };\n\n  const handleStartInterview = (stage: ApplicationStage) => {\n    if (!selectedApplication) return;\n    \n    const stageTypeToInterviewType: Record<string, string> = {\n      recruiter_call: 'behavioral',\n      behavioral: 'behavioral',\n      technical: 'technical',\n      case_study: 'case_study',\n      portfolio: 'behavioral',\n      team: 'team',\n      panel: 'team',\n    };\n    \n    const interviewType = stageTypeToInterviewType[stage.stageType] || 'behavioral';\n    navigate(`/interview?stageId=${stage.id}&type=${interviewType}&role=${selectedApplication.job.role}`);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"h-[calc(100vh-64px)]\">\n        <LoadingSkeleton />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-[calc(100vh-64px)] flex flex-col\">\n      {/* Active Journey Banner */}\n      {activeJourney && (\n        <div className=\"p-4 pb-0 bg-white dark:bg-gray-900\">\n          <Link href={`/journey/${activeJourney.id}`}>\n            <Card className=\"bg-gradient-to-r from-blue-500 to-blue-600 border-0 cursor-pointer hover:from-blue-600 hover:to-blue-700 transition-all\">\n              <CardContent className=\"p-4 flex items-center justify-between\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"bg-white/20 rounded-lg p-2\">\n                    <Rocket className=\"h-5 w-5 text-white\" />\n                  </div>\n                  <div>\n                    <h3 className=\"font-semibold text-white\">Active Onboarding Journey</h3>\n                    <p className=\"text-blue-100 text-sm\">\n                      {activeJourney.journeyMetadata?.companyName || 'Your Company'} - Sprint in progress\n                    </p>\n                  </div>\n                </div>\n                <Button variant=\"secondary\" size=\"sm\" className=\"bg-white/20 text-white border-0 hover:bg-white/30\">\n                  Open Dashboard\n                  <ChevronRight className=\"h-4 w-4 ml-1\" />\n                </Button>\n              </CardContent>\n            </Card>\n          </Link>\n        </div>\n      )}\n      \n      {/* Journey Mode Banner */}\n      <div className=\"p-4 pb-0 bg-white dark:bg-gray-900\">\n        <ModeBanner mode=\"journey\" variant=\"banner\" />\n      </div>\n      \n      {/* Header with Tabs */}\n      <div className=\"p-4 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <div>\n            <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">Your Job Journey</h1>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              Track applications and interview progress\n            </p>\n          </div>\n        </div>\n        \n        {/* Tab Navigation */}\n        <div className=\"flex gap-1 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg w-fit\">\n          <button\n            onClick={() => setActiveTab('applications')}\n            className={cn(\n              \"px-4 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2\",\n              activeTab === 'applications'\n                ? \"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm\"\n                : \"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white\"\n            )}\n            data-testid=\"tab-applications\"\n          >\n            <Briefcase className=\"h-4 w-4\" />\n            Applications\n          </button>\n          <button\n            onClick={() => setActiveTab('history')}\n            className={cn(\n              \"px-4 py-2 text-sm font-medium rounded-md transition-colors flex items-center gap-2\",\n              activeTab === 'history'\n                ? \"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm\"\n                : \"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white\"\n            )}\n            data-testid=\"tab-history\"\n          >\n            <History className=\"h-4 w-4\" />\n            Interview History\n          </button>\n        </div>\n      </div>\n      \n      {/* Tab Content */}\n      {activeTab === 'applications' ? (\n        // Applications Tab Content\n        (!applications || applications.length === 0) ? (\n          <EmptyState />\n        ) : (\n          <div className=\"flex-1 flex overflow-hidden\">\n            {/* Left Panel - Application List */}\n            <div className={cn(\n              \"w-full md:w-80 shrink-0 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 flex flex-col\",\n              showDetail && \"hidden md:flex\"\n            )}\n            style={{ maxWidth: '320px' }}\n            >\n              <JourneyStats applications={applications} />\n              <div className=\"flex-1 overflow-y-auto overflow-x-hidden\">\n                {applications.map((application) => (\n                  <ApplicationListItem\n                    key={application.id}\n                    application={application}\n                    isSelected={selectedApplication?.id === application.id}\n                    onClick={() => handleSelectApplication(application.id)}\n                  />\n                ))}\n              </div>\n            </div>\n            \n            {/* Right Panel - Application Detail */}\n            <div className={cn(\n              \"flex-1 min-w-0 bg-gray-50 dark:bg-gray-900/50\",\n              !showDetail && \"hidden md:block\"\n            )}>\n              {selectedApplication ? (\n                <ApplicationDetail\n                  application={selectedApplication}\n                  onStartInterview={handleStartInterview}\n                  onBack={() => setShowDetail(false)}\n                  userId={user?.id}\n                />\n              ) : (\n                <div className=\"h-full flex items-center justify-center text-gray-500\">\n                  Select an application to view details\n                </div>\n              )}\n            </div>\n          </div>\n        )\n      ) : (\n        // Interview History Tab Content\n        user?.id ? (\n          <InterviewHistoryPanel userId={user.id} />\n        ) : (\n          <div className=\"flex-1 flex items-center justify-center text-gray-500\">\n            Loading user data...\n          </div>\n        )\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":64722,"size_tokens":null},"backend/src/apps/UserProfile/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.8 on 2025-11-23 17:57\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='UserProfile',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('last_active', models.DateTimeField(blank=True, null=True)),\n                ('creation_date', models.DateTimeField(auto_now_add=True)),\n                ('date_of_birth', models.DateField(blank=True, null=True)),\n                ('gender', models.CharField(blank=True, choices=[('male', 'Male'), ('female', 'Female'), ('other', 'Other')], max_length=30)),\n                ('career', models.CharField(blank=True, choices=[('dev', 'Software Engineer'), ('dsgnr', 'Designer'), ('pm', 'Project Manager'), ('po', 'Product Owner'), ('mk', 'Marketer'), ('ds', 'Data Scientist'), ('cw', 'Content Writer')], default='dev', max_length=80, null=True)),\n                ('seniority_level', models.CharField(blank=True, choices=[('int', 'Intern'), ('jun', 'Junior'), ('mid', 'Middle'), ('snr', 'Senior')], default='jun', max_length=20, null=True)),\n                ('job_search_stage', models.CharField(blank=True, choices=[('act', 'Active'), ('open', 'Open to opportunities'), ('stopped', 'Not interested in any opportunities')], default='act', max_length=140, null=True)),\n                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'verbose_name_plural': 'User Profiles',\n            },\n        ),\n    ]\n","path":null,"size_bytes":1931,"size_tokens":null},"backend/src/apps/Simulation/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.8 on 2025-11-23 17:57\n\nimport django.db.models.deletion\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        ('UserProfile', '0001_initial'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='InterviewSession',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('session_id', models.CharField(max_length=256, unique=True)),\n                ('creation_date', models.DateTimeField(auto_now_add=True)),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('session_status', models.CharField(choices=[('started', 'Started'), ('done', 'Done')], default='started', max_length=25)),\n                ('feedback', models.TextField(blank=True, default='')),\n                ('areas_for_improvement', models.TextField(blank=True, default='')),\n                ('career', models.CharField(blank=True, choices=[('dev', 'Software Engineer'), ('dsgnr', 'Designer'), ('pm', 'Project Manager'), ('po', 'Product Owner'), ('mk', 'Marketer'), ('ds', 'Data Scientist'), ('cw', 'Content Writer')], default='dev', max_length=80, null=True)),\n                ('seniority_level', models.CharField(blank=True, choices=[('int', 'Intern'), ('jun', 'Junior'), ('mid', 'Middle'), ('snr', 'Senior')], default='jun', max_length=20, null=True)),\n                ('company', models.CharField(blank=True, default='edmap.io', max_length=144, null=True)),\n                ('job_description', models.TextField(blank=True, default='', null=True)),\n                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='interview_sessions', to='UserProfile.userprofile')),\n            ],\n            options={\n                'verbose_name_plural': '_Interview Sessions',\n            },\n        ),\n        migrations.CreateModel(\n            name='InterviewSessionMessage',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('message_owner_type', models.CharField(choices=[('user', 'User'), ('gpt', 'GPT')], max_length=8)),\n                ('text', models.TextField()),\n                ('creation_date', models.DateTimeField(auto_now_add=True)),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('question_reason', models.TextField(blank=True, default='')),\n                ('is_greeting', models.BooleanField(default=False)),\n                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='interview_messages', to='Simulation.interviewsession')),\n                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='UserProfile.userprofile')),\n            ],\n            options={\n                'verbose_name_plural': '_Interview Messages',\n            },\n        ),\n    ]\n","path":null,"size_bytes":3079,"size_tokens":null},"client/src/components/simulation/langchain-interview-session.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { \n  Send, \n  User, \n  Bot, \n  Clock, \n  Target, \n  CheckCircle2, \n  XCircle,\n  ArrowRight,\n  Trophy,\n  TrendingUp,\n  AlertCircle,\n  Loader2,\n  MessageCircle,\n  ClipboardCheck,\n  X\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { getPersonaStyle, type TeamPersona } from \"@/lib/persona-styles\";\nimport { \n  InterviewPanelHeader, \n  PersonaRoster, \n  PersonaTypingIndicator \n} from \"./team-interview-panel\";\n\ninterface InterviewQuestion {\n  id: number;\n  questionText: string;\n  questionType: string;\n  score?: number;\n  feedback?: string;\n  strengths?: string[];\n  improvements?: string[];\n}\n\ninterface InterviewSession {\n  id: number;\n  interviewType: string;\n  targetRole: string;\n  difficulty: string;\n  status: string;\n  currentQuestionIndex: number;\n  totalQuestions: number;\n  overallScore?: number;\n}\n\ninterface FinalReport {\n  overallScore: number;\n  communicationScore: number;\n  technicalScore?: number;\n  problemSolvingScore: number;\n  cultureFitScore: number;\n  summary: string;\n  strengths: string[];\n  improvements: string[];\n  recommendations: string[];\n  hiringDecision: string;\n}\n\ninterface PreludeMessage {\n  role: 'interviewer' | 'candidate';\n  content: string;\n  personaId?: string;\n}\n\ninterface PacingInfo {\n  elapsedMinutes: number;\n  progressPercent: number;\n  status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n}\n\ninterface LangchainInterviewSessionProps {\n  session: InterviewSession;\n  firstQuestion: InterviewQuestion;\n  introduction?: string;\n  preludeMessages?: PreludeMessage[];\n  onComplete: () => void;\n  mode?: \"practice\" | \"journey\";\n  isTeamInterview?: boolean;\n  teamPersonas?: TeamPersona[];\n}\n\nexport default function LangchainInterviewSession({ \n  session: initialSession, \n  firstQuestion,\n  introduction,\n  preludeMessages: initialPreludeMessages,\n  onComplete,\n  mode = \"practice\",\n  isTeamInterview = false,\n  teamPersonas: initialTeamPersonas = []\n}: LangchainInterviewSessionProps) {\n  const { toast } = useToast();\n  const [session, setSession] = useState(initialSession);\n  const [currentQuestion, setCurrentQuestion] = useState<InterviewQuestion>(firstQuestion);\n  const [answer, setAnswer] = useState(\"\");\n  \n  // Message type with evaluation, interim flag, and team persona info\n  type ChatMessage = {\n    role: 'interviewer' | 'candidate';\n    content: string;\n    evaluation?: any;\n    isInterim?: boolean; // Marks messages that triggered interim responses (not real answers)\n    personaId?: string; // For team interviews: which persona is speaking\n  };\n\n  // Track team personas (from props or updated from API responses)\n  const [teamPersonas, setTeamPersonas] = useState<TeamPersona[]>(initialTeamPersonas);\n  const [activePersonaId, setActivePersonaId] = useState<string | null>(\n    initialTeamPersonas.length > 0 ? initialTeamPersonas[0].id : null\n  );\n\n  // Initialize messages: prelude messages (if any) OR introduction (legacy), then first question\n  const buildInitialMessages = (): Array<ChatMessage> => {\n    const msgs: Array<ChatMessage> = [];\n    \n    // Prefer prelude messages (properly attributed) over introduction string\n    if (initialPreludeMessages && initialPreludeMessages.length > 0) {\n      initialPreludeMessages.forEach(pm => {\n        msgs.push({ \n          role: pm.role, \n          content: pm.content,\n          personaId: pm.personaId // Include persona for team interviews\n        });\n      });\n    } else if (introduction) {\n      // Legacy: single introduction from interviewer\n      msgs.push({ \n        role: 'interviewer', \n        content: introduction,\n        personaId: isTeamInterview && initialTeamPersonas.length > 0 ? initialTeamPersonas[0].id : undefined\n      });\n    }\n    \n    // Add first question (use current active persona for team interviews)\n    msgs.push({ \n      role: 'interviewer', \n      content: firstQuestion.questionText,\n      personaId: isTeamInterview && initialTeamPersonas.length > 0 ? initialTeamPersonas[0].id : undefined\n    });\n    return msgs;\n  };\n  \n  const [messages, setMessages] = useState(buildInitialMessages());\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [finalReport, setFinalReport] = useState<FinalReport | null>(null);\n  const [showTypingIndicator, setShowTypingIndicator] = useState(false);\n  const [showPreparingFeedback, setShowPreparingFeedback] = useState(false);\n  const [showInterviewEndModal, setShowInterviewEndModal] = useState(false);\n  const [pendingFinalReport, setPendingFinalReport] = useState<FinalReport | null>(null);\n  const [pacing, setPacing] = useState<PacingInfo>({ elapsedMinutes: 0, progressPercent: 0, status: 'starting' });\n  const [startTime] = useState(() => Date.now());\n  const [showFeedbackBanner, setShowFeedbackBanner] = useState(false);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages, showTypingIndicator]);\n\n  // Helper to show team interview closing sequence with separate persona messages\n  const showTeamClosingSequence = (\n    teamClosing: {\n      primary: { message: string; persona: { id: string; name: string; role: string; displayRole: string } };\n      secondary: { message: string; persona: { id: string; name: string; role: string; displayRole: string } } | null;\n    },\n    showEndModal: (report: any) => void,\n    finalReport: any\n  ) => {\n    // Show primary persona's closing (includes \"any questions for us?\")\n    setShowTypingIndicator(true);\n    setActivePersonaId(teamClosing.primary.persona.id);\n    setTimeout(() => {\n      setShowTypingIndicator(false);\n      setMessages(prev => [...prev, { \n        role: 'interviewer', \n        content: teamClosing.primary.message, \n        personaId: teamClosing.primary.persona.id \n      }]);\n      \n      // Then show secondary persona's closing (timeline/next steps)\n      if (teamClosing.secondary) {\n        setTimeout(() => {\n          setShowTypingIndicator(true);\n          setActivePersonaId(teamClosing.secondary!.persona.id);\n          setTimeout(() => {\n            setShowTypingIndicator(false);\n            setMessages(prev => [...prev, { \n              role: 'interviewer', \n              content: teamClosing.secondary!.message, \n              personaId: teamClosing.secondary!.persona.id \n            }]);\n            // Show modal after brief pause\n            setTimeout(() => {\n              showEndModal(finalReport);\n            }, 2000);\n          }, 1200);\n        }, 1500);\n      } else {\n        // No secondary, show modal after primary\n        setTimeout(() => {\n          showEndModal(finalReport);\n        }, 2000);\n      }\n    }, 1500);\n  };\n  \n  // Local timer to update elapsed time every 10 seconds for smooth display\n  useEffect(() => {\n    // Immediate update on mount\n    const elapsed = Math.floor((Date.now() - startTime) / 60000);\n    setPacing(prev => ({ ...prev, elapsedMinutes: elapsed }));\n    \n    const timer = setInterval(() => {\n      const elapsedNow = Math.floor((Date.now() - startTime) / 60000);\n      setPacing(prev => {\n        if (prev.elapsedMinutes !== elapsedNow) {\n          return { ...prev, elapsedMinutes: elapsedNow };\n        }\n        return prev;\n      });\n    }, 10000); // Update every 10 seconds for smoother UX\n    \n    return () => clearInterval(timer);\n  }, [startTime]);\n\n  const submitAnswerMutation = useMutation({\n    mutationFn: async ({ questionId, answer }: { questionId: number; answer: string }) => {\n      const response = await apiRequest(\"POST\", `/api/interviews/${session.id}/answer`, {\n        questionId,\n        answer\n      });\n      return response.json();\n    },\n    onSuccess: (result) => {\n      // Update team personas list if provided\n      if (result.teamPersonas && result.teamPersonas.length > 0) {\n        setTeamPersonas(result.teamPersonas);\n      }\n      \n      // Get current active persona ID for message attribution\n      // Use activePersona from response (the speaker of the main question)\n      const currentPersonaId = result.activePersona?.id || activePersonaId || undefined;\n      \n      // Only update activePersonaId if there's NO addressed response\n      // (if there IS an addressed response, we'll update after showing that message)\n      if (result.activePersona && !result.addressedPersonaResponse) {\n        setActivePersonaId(result.activePersona.id);\n      }\n      \n      // Handle interim responses (when AI responds to questions, confusion, comments, etc.)\n      if (result.interimResponse) {\n        // The AI is responding to a non-answer (question, confusion, etc.)\n        // The question is still pending - don't advance the interview\n        \n        // CRITICAL: Mark the last candidate message as interim IMMEDIATELY (before re-enabling input)\n        // This prevents a race where a fast follow-up answer gets incorrectly marked as interim\n        setMessages(prev => {\n          const updated = [...prev];\n          for (let i = updated.length - 1; i >= 0; i--) {\n            if (updated[i].role === 'candidate' && !updated[i].isInterim) {\n              updated[i] = { ...updated[i], isInterim: true };\n              break;\n            }\n          }\n          return updated;\n        });\n        \n        // Now re-enable input so user can respond\n        setIsSubmitting(false);\n        setAnswer(\"\");\n        \n        // Show typing indicator, then add the interim response\n        setShowTypingIndicator(true);\n        setTimeout(() => {\n          setShowTypingIndicator(false);\n          setMessages(prev => {\n            const updated = [...prev];\n            // Add interviewer's interim response (with persona for team interviews)\n            updated.push({ role: 'interviewer', content: result.interimResponse, personaId: currentPersonaId });\n            // If question should be repeated, also re-display it\n            if (result.questionRepeated && result.currentQuestionText) {\n              updated.push({ role: 'interviewer', content: result.currentQuestionText, personaId: currentPersonaId });\n            }\n            return updated;\n          });\n        }, 1200);\n        return;\n      }\n      \n      // Handle normal answer flow with evaluation\n      // Find the last candidate message that is NOT interim (skips messages that triggered interim responses)\n      if (result.evaluation) {\n        setMessages(prev => {\n          const updated = [...prev];\n          // Find the most recent candidate message that isn't interim to attach evaluation\n          for (let i = updated.length - 1; i >= 0; i--) {\n            if (updated[i].role === 'candidate' && !updated[i].evaluation && !updated[i].isInterim) {\n              updated[i] = {\n                ...updated[i],\n                evaluation: result.evaluation\n              };\n              break;\n            }\n          }\n          return updated;\n        });\n      }\n\n      // Check if there's a candidate question answer to show (for mixed content)\n      const hasCandidateQuestionAnswer = result.candidateQuestionAnswer && result.candidateQuestionAnswer.trim().length > 0;\n\n      if (result.finalReport) {\n        // Helper to show the interview end modal (instead of auto-transitioning)\n        const showEndModal = (report: FinalReport) => {\n          setPendingFinalReport(report);\n          setShowInterviewEndModal(true);\n        };\n        \n        // Show candidate question answer first if present, then closure\n        if (hasCandidateQuestionAnswer) {\n          setShowTypingIndicator(true);\n          setTimeout(() => {\n            setShowTypingIndicator(false);\n            setMessages(prev => [...prev, { role: 'interviewer', content: result.candidateQuestionAnswer, personaId: currentPersonaId }]);\n            // Then show closure if available\n            if (result.teamClosing) {\n              // Team interview: show separate closing messages from each persona\n              showTeamClosingSequence(result.teamClosing, showEndModal, result.finalReport);\n            } else if (result.closure) {\n              setTimeout(() => {\n                setShowTypingIndicator(true);\n                setTimeout(() => {\n                  setShowTypingIndicator(false);\n                  setMessages(prev => [...prev, { role: 'interviewer', content: result.closure, personaId: currentPersonaId }]);\n                  setTimeout(() => {\n                    showEndModal(result.finalReport);\n                  }, 2000);\n                }, 1200);\n              }, 1000);\n            } else {\n              setTimeout(() => {\n                showEndModal(result.finalReport);\n              }, 1500);\n            }\n          }, 1200);\n        } else if (result.teamClosing) {\n          // Team interview: show separate closing messages from each persona\n          showTeamClosingSequence(result.teamClosing, showEndModal, result.finalReport);\n        } else if (result.closure) {\n          setShowTypingIndicator(true);\n          setTimeout(() => {\n            setShowTypingIndicator(false);\n            setMessages(prev => [...prev, { role: 'interviewer', content: result.closure, personaId: currentPersonaId }]);\n            // Show modal after a brief pause to let user read closure\n            setTimeout(() => {\n              showEndModal(result.finalReport);\n            }, 2000);\n          }, 1500);\n        } else {\n          showEndModal(result.finalReport);\n        }\n      } else if (result.nextQuestion) {\n        // Update pacing info if provided\n        if (result.pacing) {\n          setPacing(result.pacing);\n        }\n        \n        // Update session state immediately to avoid stale state\n        setSession(prev => ({ ...prev, currentQuestionIndex: prev.currentQuestionIndex + 1 }));\n        setCurrentQuestion(result.nextQuestion);\n        \n        setShowTypingIndicator(true);\n        \n        // Show candidate question answer first (if any), then reflection, then question\n        const hasReflection = result.reflection && result.reflection.trim().length > 0;\n        \n        // Check if there's an addressed persona response (when one persona mentions another)\n        const hasAddressedResponse = result.addressedPersonaResponse?.content;\n        \n        setTimeout(() => {\n          setShowTypingIndicator(false);\n          \n          // Add all messages in a single state update to avoid race conditions\n          setMessages(prev => {\n            const newMessages = [...prev];\n            // Add candidate question answer first (if any)\n            if (hasCandidateQuestionAnswer) {\n              newMessages.push({ role: 'interviewer', content: result.candidateQuestionAnswer, personaId: currentPersonaId });\n            }\n            if (hasReflection) {\n              newMessages.push({ role: 'interviewer', content: result.reflection, personaId: currentPersonaId });\n            }\n            newMessages.push({ role: 'interviewer', content: result.nextQuestion.questionText, personaId: currentPersonaId });\n            return newMessages;\n          });\n          \n          // If another persona was addressed and responded, show their response after a delay\n          if (hasAddressedResponse) {\n            const addressedPersonaId = result.addressedPersonaResponse.personaId;\n            setTimeout(() => {\n              setShowTypingIndicator(true);\n              setActivePersonaId(addressedPersonaId);\n              setTimeout(() => {\n                setShowTypingIndicator(false);\n                setMessages(prev => [\n                  ...prev, \n                  { \n                    role: 'interviewer', \n                    content: result.addressedPersonaResponse.content, \n                    personaId: addressedPersonaId \n                  }\n                ]);\n              }, 1200);\n            }, 500);\n          }\n        }, hasCandidateQuestionAnswer ? 1800 : hasReflection ? 1500 : 1200);\n      }\n      \n      setIsSubmitting(false);\n    },\n    onError: (error) => {\n      setIsSubmitting(false);\n      setShowTypingIndicator(false);\n      toast({\n        title: \"Error\",\n        description: \"Failed to submit answer. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleSubmitAnswer = () => {\n    if (!answer.trim() || isSubmitting) return;\n\n    const trimmedAnswer = answer.trim();\n    \n    setIsSubmitting(true);\n    setMessages(prev => [...prev, { role: 'candidate', content: trimmedAnswer }]);\n    \n    // Clear input immediately so user sees their message was sent\n    setAnswer(\"\");\n    \n    // Show typing indicator immediately so user knows AI is processing\n    setShowTypingIndicator(true);\n    \n    submitAnswerMutation.mutate({\n      questionId: currentQuestion.id,\n      answer: trimmedAnswer\n    });\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmitAnswer();\n    }\n  };\n\n  const getHiringDecisionColor = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'text-green-600 bg-green-50';\n      case 'yes': return 'text-green-500 bg-green-50';\n      case 'maybe': return 'text-yellow-600 bg-yellow-50';\n      case 'no': return 'text-orange-600 bg-orange-50';\n      case 'strong_no': return 'text-red-600 bg-red-50';\n      default: return 'text-gray-600 bg-gray-50';\n    }\n  };\n\n  const getHiringDecisionText = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'Strong Yes - Highly Recommend';\n      case 'yes': return 'Yes - Recommend';\n      case 'maybe': return 'Maybe - Further Evaluation Needed';\n      case 'no': return 'No - Not Recommended';\n      case 'strong_no': return 'Strong No - Not a Fit';\n      default: return decision;\n    }\n  };\n\n  // Handle \"Stay in conversation\" - dismiss modal and show banner\n  const handleStayInConversation = () => {\n    setShowInterviewEndModal(false);\n    setShowFeedbackBanner(true);\n  };\n\n  // Handle \"View feedback\" - transition to feedback report\n  const handleViewFeedback = () => {\n    setShowInterviewEndModal(false);\n    setShowFeedbackBanner(false);\n    if (pendingFinalReport) {\n      setShowPreparingFeedback(true);\n      setTimeout(() => {\n        setShowPreparingFeedback(false);\n        setFinalReport(pendingFinalReport);\n        setSession(prev => ({ ...prev, status: 'completed', overallScore: pendingFinalReport.overallScore }));\n      }, 2500);\n    }\n  };\n\n  // Show \"Preparing feedback\" transition state\n  if (showPreparingFeedback) {\n    return (\n      <div className=\"h-[calc(100vh-80px)] flex items-center justify-center p-4\">\n        <Card className=\"max-w-md w-full\">\n          <CardContent className=\"pt-8 pb-8\">\n            <div className=\"text-center space-y-6\">\n              <div className=\"mx-auto w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center\">\n                <Loader2 className=\"h-10 w-10 text-blue-600 animate-spin\" />\n              </div>\n              <div className=\"space-y-2\">\n                <h2 className=\"text-xl font-semibold text-gray-900\">Preparing Your Feedback</h2>\n                <p className=\"text-gray-500\">\n                  We're analyzing your interview performance...\n                </p>\n              </div>\n              <div className=\"space-y-3 text-left bg-gray-50 rounded-lg p-4\">\n                <div className=\"flex items-center space-x-3\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n                  <span className=\"text-sm text-gray-600\">Interview completed</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500\" />\n                  <span className=\"text-sm text-gray-600\">Responses analyzed</span>\n                </div>\n                <div className=\"flex items-center space-x-3\">\n                  <Loader2 className=\"h-5 w-5 text-blue-500 animate-spin\" />\n                  <span className=\"text-sm text-gray-600\">Generating personalized feedback...</span>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (finalReport) {\n    return (\n      <div className=\"p-8 max-w-4xl mx-auto\">\n        <Card>\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\n              <Trophy className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <CardTitle className=\"text-2xl\">Interview Complete!</CardTitle>\n            <p className=\"text-gray-600 mt-2\">Here's your performance summary</p>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"text-5xl font-bold text-blue-600 mb-2\">{finalReport.overallScore}</div>\n              <p className=\"text-gray-500\">Overall Score</p>\n              <div className={cn(\"inline-block px-4 py-2 rounded-full mt-4 font-medium\", getHiringDecisionColor(finalReport.hiringDecision))}>\n                {getHiringDecisionText(finalReport.hiringDecision)}\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\">{finalReport.communicationScore}</div>\n                <p className=\"text-sm text-gray-600\">Communication</p>\n              </div>\n              {finalReport.technicalScore && (\n                <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"text-2xl font-semibold text-gray-900\">{finalReport.technicalScore}</div>\n                  <p className=\"text-sm text-gray-600\">Technical</p>\n                </div>\n              )}\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\">{finalReport.problemSolvingScore}</div>\n                <p className=\"text-sm text-gray-600\">Problem Solving</p>\n              </div>\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\">{finalReport.cultureFitScore}</div>\n                <p className=\"text-sm text-gray-600\">Culture Fit</p>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 p-4 rounded-lg\">\n              <h4 className=\"font-semibold text-gray-900 mb-2\">Summary</h4>\n              <p className=\"text-gray-700\">{finalReport.summary}</p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500 mr-2\" />\n                  Strengths\n                </h4>\n                <ul className=\"space-y-2\">\n                  {finalReport.strengths.map((strength, i) => (\n                    <li key={i} className=\"flex items-start\">\n                      <span className=\"text-green-500 mr-2\"></span>\n                      <span className=\"text-gray-700\">{strength}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                  <TrendingUp className=\"h-5 w-5 text-orange-500 mr-2\" />\n                  Areas to Improve\n                </h4>\n                <ul className=\"space-y-2\">\n                  {finalReport.improvements.map((improvement, i) => (\n                    <li key={i} className=\"flex items-start\">\n                      <span className=\"text-orange-500 mr-2\"></span>\n                      <span className=\"text-gray-700\">{improvement}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                <AlertCircle className=\"h-5 w-5 text-blue-500 mr-2\" />\n                Recommendations\n              </h4>\n              <ul className=\"space-y-2\">\n                {finalReport.recommendations.map((rec, i) => (\n                  <li key={i} className=\"flex items-start bg-gray-50 p-3 rounded-lg\">\n                    <ArrowRight className=\"h-5 w-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-gray-700\">{rec}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            <div className=\"flex justify-center pt-4\">\n              <Button onClick={onComplete} size=\"lg\" data-testid=\"button-back-to-setup\">\n                Back to Interview Setup\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-[calc(100vh-80px)] flex flex-col p-4 relative\">\n      {/* Interview End Modal */}\n      {showInterviewEndModal && (\n        <div \n          className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-in fade-in duration-200\"\n          data-testid=\"modal-interview-end\"\n        >\n          <Card className=\"max-w-md w-full mx-4 animate-in zoom-in-95 duration-200\">\n            <CardContent className=\"pt-8 pb-6\">\n              <div className=\"text-center space-y-6\">\n                {/* Interviewer avatar */}\n                <div className=\"mx-auto w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <Bot className=\"h-10 w-10 text-blue-600\" />\n                </div>\n                \n                {/* Heading */}\n                <div className=\"space-y-2\">\n                  <h2 className=\"text-2xl font-semibold text-gray-900\">Interview Complete</h2>\n                  <p className=\"text-gray-500 px-4\">\n                    Great job! Take a moment to review your conversation, or jump straight to your feedback report.\n                  </p>\n                </div>\n                \n                {/* Action buttons */}\n                <div className=\"flex flex-col gap-3 pt-2\">\n                  <Button \n                    onClick={handleViewFeedback}\n                    size=\"lg\"\n                    className=\"w-full\"\n                    data-testid=\"button-view-feedback\"\n                  >\n                    <ClipboardCheck className=\"h-5 w-5 mr-2\" />\n                    View Feedback Report\n                  </Button>\n                  <Button \n                    onClick={handleStayInConversation}\n                    variant=\"ghost\"\n                    size=\"lg\"\n                    className=\"w-full text-gray-600 hover:text-gray-900\"\n                    data-testid=\"button-stay-in-chat\"\n                  >\n                    <MessageCircle className=\"h-5 w-5 mr-2\" />\n                    Stay in Conversation\n                  </Button>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n      \n      <Card className=\"flex-1 flex flex-col overflow-hidden\">\n        {/* Enhanced Interview Panel Header for team interviews */}\n        {isTeamInterview ? (\n          <InterviewPanelHeader\n            jobTitle={session.targetRole}\n            difficulty={session.difficulty}\n            currentQuestionIndex={session.currentQuestionIndex}\n            totalQuestions={session.totalQuestions}\n            elapsedMinutes={pacing.elapsedMinutes}\n            isTeamInterview={isTeamInterview}\n            teamPersonas={teamPersonas}\n            activePersonaId={activePersonaId}\n          />\n        ) : (\n          <CardHeader className=\"flex-shrink-0 border-b\">\n            {/* Feedback ready banner */}\n            {showFeedbackBanner && (\n              <div className=\"mb-3 -mt-2 -mx-2 p-3 bg-blue-50 border border-blue-100 rounded-lg flex items-center justify-between\">\n                <div className=\"flex items-center gap-2 text-blue-700\">\n                  <CheckCircle2 className=\"h-5 w-5\" />\n                  <span className=\"text-sm font-medium\">Your feedback report is ready!</span>\n                </div>\n                <Button \n                  onClick={handleViewFeedback}\n                  size=\"sm\"\n                  variant=\"outline\"\n                  className=\"border-blue-200 text-blue-700 hover:bg-blue-100\"\n                  data-testid=\"button-view-feedback-banner\"\n                >\n                  View Report\n                </Button>\n              </div>\n            )}\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <CardTitle className=\"text-xl\">\n                  {session.interviewType.charAt(0).toUpperCase() + session.interviewType.slice(1)} Interview\n                </CardTitle>\n                <p className=\"text-sm text-gray-500 mt-1\">\n                  {session.targetRole}  {session.difficulty.charAt(0).toUpperCase() + session.difficulty.slice(1)} level\n                </p>\n              </div>\n              <div className=\"flex items-center space-x-4\">\n                {/* Time-based pacing indicator */}\n                <div className=\"flex items-center space-x-2\">\n                  <Clock className=\"h-5 w-5 text-gray-400\" />\n                  <span className=\"text-sm text-gray-600\">\n                    {pacing.elapsedMinutes} min\n                  </span>\n                </div>\n                \n                {/* Status chip */}\n                <Badge \n                  variant=\"outline\" \n                  className={cn(\n                    \"text-xs px-2 py-0.5\",\n                    pacing.status === 'starting' && \"border-blue-200 bg-blue-50 text-blue-700\",\n                    pacing.status === 'on_track' && \"border-green-200 bg-green-50 text-green-700\",\n                    pacing.status === 'mid_interview' && \"border-yellow-200 bg-yellow-50 text-yellow-700\",\n                    pacing.status === 'wrapping_soon' && \"border-orange-200 bg-orange-50 text-orange-700\",\n                    pacing.status === 'overtime' && \"border-red-200 bg-red-50 text-red-700\"\n                  )}\n                  data-testid=\"badge-pacing-status\"\n                >\n                  {pacing.status === 'starting' && 'Getting started'}\n                  {pacing.status === 'on_track' && 'On track'}\n                  {pacing.status === 'mid_interview' && 'In progress'}\n                  {pacing.status === 'wrapping_soon' && 'Wrapping up soon'}\n                  {pacing.status === 'overtime' && 'Overtime'}\n                </Badge>\n                \n                {/* Progress ring (visual indicator) */}\n                <div className=\"relative w-8 h-8\">\n                  <svg className=\"w-8 h-8 transform -rotate-90\">\n                    <circle\n                      cx=\"16\"\n                      cy=\"16\"\n                      r=\"12\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"3\"\n                      fill=\"none\"\n                      className=\"text-gray-200\"\n                    />\n                    <circle\n                      cx=\"16\"\n                      cy=\"16\"\n                      r=\"12\"\n                      stroke=\"currentColor\"\n                      strokeWidth=\"3\"\n                      fill=\"none\"\n                      strokeDasharray={`${pacing.progressPercent * 0.75} 100`}\n                      className={cn(\n                        pacing.status === 'starting' && \"text-blue-500\",\n                        pacing.status === 'on_track' && \"text-green-500\",\n                        pacing.status === 'mid_interview' && \"text-yellow-500\",\n                        pacing.status === 'wrapping_soon' && \"text-orange-500\",\n                        pacing.status === 'overtime' && \"text-red-500\"\n                      )}\n                      strokeLinecap=\"round\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n          </CardHeader>\n        )}\n        \n        {/* Feedback ready banner for team interviews */}\n        {isTeamInterview && showFeedbackBanner && (\n          <div className=\"mx-4 mt-3 p-3 bg-blue-50 border border-blue-100 rounded-lg flex items-center justify-between\">\n            <div className=\"flex items-center gap-2 text-blue-700\">\n              <CheckCircle2 className=\"h-5 w-5\" />\n              <span className=\"text-sm font-medium\">Your feedback report is ready!</span>\n            </div>\n            <Button \n              onClick={handleViewFeedback}\n              size=\"sm\"\n              variant=\"outline\"\n              className=\"border-blue-200 text-blue-700 hover:bg-blue-100\"\n              data-testid=\"button-view-feedback-banner\"\n            >\n              View Report\n            </Button>\n          </div>\n        )}\n\n        {/* Main content area with optional PersonaRoster sidebar for team interviews */}\n        <div className=\"flex-1 flex overflow-hidden\">\n          {/* Persona Roster Sidebar - only for team interviews */}\n          {isTeamInterview && teamPersonas.length > 0 && (\n            <PersonaRoster\n              teamPersonas={teamPersonas}\n              activePersonaId={activePersonaId}\n              isTyping={showTypingIndicator}\n              className=\"hidden md:block\"\n            />\n          )}\n\n          <CardContent className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n          {messages.map((msg, index) => {\n            const personaStyle = msg.role === 'interviewer' ? getPersonaStyle(msg.personaId, isTeamInterview, teamPersonas) : null;\n            \n            return (\n            <div\n              key={index}\n              className={cn(\n                \"flex items-start space-x-3\",\n                msg.role === 'candidate' && \"flex-row-reverse space-x-reverse\"\n              )}\n              data-testid={`message-${msg.role}-${index}`}\n            >\n              <Avatar className={cn(\n                \"h-10 w-10 shrink-0\",\n                msg.role === 'interviewer' \n                  ? (personaStyle?.bgColor || \"bg-blue-100\") \n                  : \"bg-green-100\"\n              )}>\n                <AvatarFallback className={cn(\n                  \"font-semibold\",\n                  msg.role === 'interviewer' ? personaStyle?.textColor : \"text-green-600\"\n                )}>\n                  {msg.role === 'interviewer' ? (\n                    isTeamInterview && personaStyle?.initials ? personaStyle.initials : <Bot className={cn(\"h-5 w-5\", personaStyle?.iconColor || \"text-blue-600\")} />\n                  ) : (\n                    <User className=\"h-5 w-5 text-green-600\" />\n                  )}\n                </AvatarFallback>\n              </Avatar>\n              <div className={cn(\n                \"max-w-[70%] rounded-lg p-4\",\n                msg.role === 'interviewer' \n                  ? cn(\n                      personaStyle?.messageBg || \"bg-blue-50\",\n                      \"text-gray-900 dark:text-gray-100\",\n                      isTeamInterview && personaStyle && \"border-l-4\",\n                      isTeamInterview && personaStyle?.borderColor\n                    )\n                  : \"bg-green-50 dark:bg-green-900/20 text-gray-900 dark:text-gray-100\"\n              )}>\n                {/* Show persona name and role for team interviews with enhanced styling */}\n                {isTeamInterview && msg.role === 'interviewer' && personaStyle && personaStyle.name !== 'Interviewer' && (\n                  <div className=\"mb-2 pb-2 border-b border-gray-200/50 flex items-center gap-2\">\n                    <span className={cn(\"font-semibold text-sm\", personaStyle.textColor)}>\n                      {personaStyle.name}\n                    </span>\n                    {personaStyle.displayRole && (\n                      <Badge variant=\"outline\" className={cn(\"text-[10px] px-1.5 py-0\", personaStyle.borderColor)}>\n                        {personaStyle.displayRole}\n                      </Badge>\n                    )}\n                  </div>\n                )}\n                <p className=\"whitespace-pre-wrap\">{msg.content}</p>\n                {msg.evaluation && (\n                  <div className=\"mt-3 pt-3 border-t border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center space-x-2 mb-2\">\n                      <Badge variant={msg.evaluation.score >= 7 ? \"default\" : msg.evaluation.score >= 5 ? \"secondary\" : \"destructive\"}>\n                        Score: {msg.evaluation.score}/10\n                      </Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600 dark:text-gray-400\">{msg.evaluation.feedback}</p>\n                  </div>\n                )}\n              </div>\n            </div>\n          );\n          })}\n          \n          {showTypingIndicator && (() => {\n            const typingPersonaStyle = getPersonaStyle(activePersonaId, isTeamInterview, teamPersonas);\n            \n            // Use enhanced PersonaTypingIndicator for team interviews\n            if (isTeamInterview && typingPersonaStyle.name !== 'Interviewer') {\n              return <PersonaTypingIndicator persona={typingPersonaStyle} />;\n            }\n            \n            // Default typing indicator for non-team interviews\n            return (\n            <div className=\"flex items-start space-x-3\">\n              <Avatar className={cn(\"h-10 w-10\", typingPersonaStyle.bgColor)}>\n                <AvatarFallback>\n                  <Bot className={cn(\"h-5 w-5\", typingPersonaStyle.iconColor)} />\n                </AvatarFallback>\n              </Avatar>\n              <div className={cn(typingPersonaStyle.messageBg, \"rounded-lg p-4\")}>\n                <div className=\"flex items-center gap-2\">\n                  <div className=\"flex space-x-1\">\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                    <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                  </div>\n                  <span className=\"text-xs text-gray-500\">typing...</span>\n                </div>\n              </div>\n            </div>\n          );\n          })()}\n          \n          <div ref={messagesEndRef} />\n        </CardContent>\n        </div>\n\n        <div className=\"flex-shrink-0 border-t p-4\">\n          <div className=\"flex space-x-3\">\n            <Textarea\n              value={answer}\n              onChange={(e) => setAnswer(e.target.value)}\n              onKeyDown={handleKeyDown}\n              placeholder={showFeedbackBanner ? \"Interview complete - view your feedback report above\" : \"Type your answer here... (Press Enter to send, Shift+Enter for new line)\"}\n              className=\"flex-1 min-h-[80px] resize-none\"\n              disabled={isSubmitting || showFeedbackBanner}\n              data-testid=\"input-answer\"\n            />\n            <Button \n              onClick={handleSubmitAnswer}\n              disabled={!answer.trim() || isSubmitting || showFeedbackBanner}\n              className=\"self-end\"\n              data-testid=\"button-submit-answer\"\n            >\n              {isSubmitting ? (\n                <Loader2 className=\"h-5 w-5 animate-spin\" />\n              ) : (\n                <Send className=\"h-5 w-5\" />\n              )}\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":40326,"size_tokens":null},"server/services/github.ts":{"content":"import { Octokit } from '@octokit/rest'\n\nlet connectionSettings: any;\n\nasync function getAccessToken() {\n  if (connectionSettings && connectionSettings.settings.expires_at && new Date(connectionSettings.settings.expires_at).getTime() > Date.now()) {\n    return connectionSettings.settings.access_token;\n  }\n  \n  const hostname = process.env.REPLIT_CONNECTORS_HOSTNAME\n  const xReplitToken = process.env.REPL_IDENTITY \n    ? 'repl ' + process.env.REPL_IDENTITY \n    : process.env.WEB_REPL_RENEWAL \n    ? 'depl ' + process.env.WEB_REPL_RENEWAL \n    : null;\n\n  if (!xReplitToken) {\n    throw new Error('X_REPLIT_TOKEN not found for repl/depl');\n  }\n\n  connectionSettings = await fetch(\n    'https://' + hostname + '/api/v2/connection?include_secrets=true&connector_names=github',\n    {\n      headers: {\n        'Accept': 'application/json',\n        'X_REPLIT_TOKEN': xReplitToken\n      }\n    }\n  ).then(res => res.json()).then(data => data.items?.[0]);\n\n  const accessToken = connectionSettings?.settings?.access_token || connectionSettings.settings?.oauth?.credentials?.access_token;\n\n  if (!connectionSettings || !accessToken) {\n    throw new Error('GitHub not connected');\n  }\n  return accessToken;\n}\n\n// WARNING: Never cache this client.\n// Access tokens expire, so a new client must be created each time.\n// Always call this function again to get a fresh client.\nexport async function getGitHubClient() {\n  const accessToken = await getAccessToken();\n  return new Octokit({ auth: accessToken });\n}\n\nexport async function getUser() {\n  const octokit = await getGitHubClient();\n  const response = await octokit.users.getAuthenticated();\n  return response.data;\n}\n\nexport async function getOrganizations() {\n  const octokit = await getGitHubClient();\n  const response = await octokit.orgs.listForAuthenticatedUser();\n  return response.data;\n}\n\nexport async function getRepository(owner: string, repo: string) {\n  const octokit = await getGitHubClient();\n  const response = await octokit.repos.get({\n    owner,\n    repo\n  });\n  return response.data;\n}\n\nexport async function createRepository(org: string, name: string, description?: string) {\n  const octokit = await getGitHubClient();\n  const response = await octokit.repos.createInOrg({\n    org,\n    name,\n    description,\n    private: false,\n    auto_init: false\n  });\n  return response.data;\n}\n","path":null,"size_bytes":2346,"size_tokens":null},"client/src/pages/job-board.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { ModeBanner } from \"@/components/ModeBanner\";\nimport { \n  Search, MapPin, DollarSign, Briefcase, Building2, Users, Clock, \n  ChevronRight, Sparkles, BookOpen, Filter, X, CheckCircle, ArrowRight,\n  Target, Lightbulb, GraduationCap\n} from \"lucide-react\";\n\ninterface Company {\n  id: number;\n  name: string;\n  logo: string | null;\n  industry: string;\n  size: string;\n  description: string;\n  culture: string;\n  values: string[];\n  benefits: string[];\n  interviewStyle: string;\n}\n\ninterface JobPosting {\n  id: number;\n  companyId: number;\n  title: string;\n  role: string;\n  seniority: string;\n  department: string;\n  location: string;\n  employmentType: string;\n  salaryMin: number | null;\n  salaryMax: number | null;\n  description: string;\n  responsibilities: string[];\n  requirements: string[];\n  niceToHave: string[];\n  highlightedTerms: string[];\n  interviewStages: number;\n  isActive: boolean;\n  postedAt: string;\n  company: Company;\n}\n\ninterface GlossaryTerm {\n  id: number;\n  term: string;\n  definition: string;\n  category: string | null;\n}\n\nfunction formatSalary(min: number | null, max: number | null): string {\n  if (!min && !max) return \"Competitive\";\n  const formatNum = (n: number) => {\n    if (n >= 1000) return `$${Math.round(n / 1000)}k`;\n    return `$${n}`;\n  };\n  if (min && max) return `${formatNum(min)} - ${formatNum(max)}`;\n  if (min) return `From ${formatNum(min)}`;\n  return `Up to ${formatNum(max!)}`;\n}\n\nfunction getSeniorityColor(seniority: string): string {\n  switch (seniority) {\n    case \"junior\": return \"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\";\n    case \"mid\": return \"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\";\n    case \"senior\": return \"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\";\n    case \"lead\": return \"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300\";\n    default: return \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300\";\n  }\n}\n\nfunction getCompanySizeLabel(size: string): string {\n  switch (size) {\n    case \"startup\": return \"1-50 employees\";\n    case \"mid-size\": return \"50-500 employees\";\n    case \"enterprise\": return \"500+ employees\";\n    default: return size;\n  }\n}\n\nfunction HighlightedText({ \n  text, \n  terms, \n  glossary,\n  onTermClick \n}: { \n  text: string; \n  terms: string[]; \n  glossary: GlossaryTerm[];\n  onTermClick: (term: GlossaryTerm) => void;\n}) {\n  if (!terms.length) return <>{text}</>;\n  \n  const parts = text.split(new RegExp(`(${terms.map(t => t.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&')).join('|')})`, 'gi'));\n  \n  return (\n    <>\n      {parts.map((part, i) => {\n        const matchedTerm = terms.find(t => t.toLowerCase() === part.toLowerCase());\n        if (matchedTerm) {\n          const glossaryEntry = glossary.find(g => g.term.toLowerCase() === matchedTerm.toLowerCase());\n          if (glossaryEntry) {\n            return (\n              <Tooltip key={i}>\n                <TooltipTrigger asChild>\n                  <button\n                    onClick={() => onTermClick(glossaryEntry)}\n                    className=\"text-primary font-medium underline decoration-dotted underline-offset-4 hover:decoration-solid cursor-pointer\"\n                    data-testid={`term-${matchedTerm.replace(/\\s+/g, '-').toLowerCase()}`}\n                  >\n                    {part}\n                  </button>\n                </TooltipTrigger>\n                <TooltipContent side=\"top\" className=\"max-w-xs\">\n                  <p className=\"text-sm\">{glossaryEntry.definition}</p>\n                </TooltipContent>\n              </Tooltip>\n            );\n          }\n          return (\n            <span key={i} className=\"text-primary font-medium\">\n              {part}\n            </span>\n          );\n        }\n        return <span key={i}>{part}</span>;\n      })}\n    </>\n  );\n}\n\nfunction JobCard({ \n  job, \n  glossary,\n  onSelect,\n  onTermClick,\n  isSelected \n}: { \n  job: JobPosting; \n  glossary: GlossaryTerm[];\n  onSelect: () => void;\n  onTermClick: (term: GlossaryTerm) => void;\n  isSelected: boolean;\n}) {\n  return (\n    <Card \n      className={`cursor-pointer transition-all hover:shadow-md ${\n        isSelected ? 'ring-2 ring-primary shadow-md' : ''\n      }`}\n      onClick={onSelect}\n      data-testid={`job-card-${job.id}`}\n    >\n      <CardContent className=\"p-5\">\n        <div className=\"flex items-start gap-4\">\n          <div className=\"h-12 w-12 rounded-lg bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center text-2xl shrink-0\">\n            {job.company.logo || ''}\n          </div>\n          \n          <div className=\"flex-1 min-w-0\">\n            <div className=\"flex items-start justify-between gap-2\">\n              <div>\n                <h3 className=\"font-semibold text-base text-gray-900 dark:text-white truncate\">\n                  {job.title}\n                </h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  {job.company.name}\n                </p>\n              </div>\n              <Badge className={`shrink-0 ${getSeniorityColor(job.seniority)}`}>\n                {job.seniority}\n              </Badge>\n            </div>\n            \n            <div className=\"mt-3 flex flex-wrap items-center gap-x-4 gap-y-2 text-sm text-gray-500 dark:text-gray-400\">\n              <span className=\"flex items-center gap-1\">\n                <MapPin className=\"h-3.5 w-3.5\" />\n                {job.location}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <DollarSign className=\"h-3.5 w-3.5\" />\n                {formatSalary(job.salaryMin, job.salaryMax)}\n              </span>\n              <span className=\"flex items-center gap-1\">\n                <Briefcase className=\"h-3.5 w-3.5\" />\n                {job.interviewStages} stages\n              </span>\n            </div>\n\n            <p className=\"mt-3 text-sm text-gray-600 dark:text-gray-400 line-clamp-2\">\n              <HighlightedText \n                text={job.description} \n                terms={job.highlightedTerms}\n                glossary={glossary}\n                onTermClick={onTermClick}\n              />\n            </p>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction JobDetails({ \n  job, \n  glossary,\n  onApply,\n  onTermClick,\n  isApplying\n}: { \n  job: JobPosting; \n  glossary: GlossaryTerm[];\n  onApply: () => void;\n  onTermClick: (term: GlossaryTerm) => void;\n  isApplying: boolean;\n}) {\n  return (\n    <div className=\"p-6 h-full overflow-y-auto\">\n      <div className=\"flex items-start gap-4 mb-6\">\n        <div className=\"h-16 w-16 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-800 flex items-center justify-center text-3xl shrink-0\">\n          {job.company.logo || ''}\n        </div>\n        <div className=\"flex-1\">\n          <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">\n            {job.title}\n          </h2>\n          <p className=\"text-gray-600 dark:text-gray-400\">\n            {job.company.name}\n          </p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <Badge className={getSeniorityColor(job.seniority)}>\n              {job.seniority}\n            </Badge>\n            <span className=\"text-sm text-gray-500\">\n              {job.department}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-3 mb-6\">\n        <div className=\"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n          <MapPin className=\"h-4 w-4 text-gray-400\" />\n          <span className=\"text-sm\">{job.location}</span>\n        </div>\n        <div className=\"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n          <DollarSign className=\"h-4 w-4 text-gray-400\" />\n          <span className=\"text-sm\">{formatSalary(job.salaryMin, job.salaryMax)}</span>\n        </div>\n        <div className=\"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n          <Users className=\"h-4 w-4 text-gray-400\" />\n          <span className=\"text-sm\">{getCompanySizeLabel(job.company.size)}</span>\n        </div>\n        <div className=\"flex items-center gap-2 p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n          <Clock className=\"h-4 w-4 text-gray-400\" />\n          <span className=\"text-sm\">{job.employmentType}</span>\n        </div>\n      </div>\n\n      <Button \n        className=\"w-full mb-6\" \n        size=\"lg\"\n        onClick={onApply}\n        disabled={isApplying}\n        data-testid=\"button-apply\"\n      >\n        {isApplying ? \"Applying...\" : \"Apply Now\"} \n        <ArrowRight className=\"ml-2 h-4 w-4\" />\n      </Button>\n\n      <div className=\"space-y-6\">\n        <section>\n          <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n            <Target className=\"h-4 w-4\" />\n            About the Role\n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed\">\n            <HighlightedText \n              text={job.description} \n              terms={job.highlightedTerms}\n              glossary={glossary}\n              onTermClick={onTermClick}\n            />\n          </p>\n        </section>\n\n        <section>\n          <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n            <Briefcase className=\"h-4 w-4\" />\n            Responsibilities\n          </h3>\n          <ul className=\"space-y-2\">\n            {job.responsibilities.map((resp, i) => (\n              <li key={i} className=\"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                <ChevronRight className=\"h-4 w-4 text-primary shrink-0 mt-0.5\" />\n                <HighlightedText \n                  text={resp} \n                  terms={job.highlightedTerms}\n                  glossary={glossary}\n                  onTermClick={onTermClick}\n                />\n              </li>\n            ))}\n          </ul>\n        </section>\n\n        <section>\n          <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n            <GraduationCap className=\"h-4 w-4\" />\n            Requirements\n          </h3>\n          <ul className=\"space-y-2\">\n            {job.requirements.map((req, i) => (\n              <li key={i} className=\"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                <CheckCircle className=\"h-4 w-4 text-green-500 shrink-0 mt-0.5\" />\n                <HighlightedText \n                  text={req} \n                  terms={job.highlightedTerms}\n                  glossary={glossary}\n                  onTermClick={onTermClick}\n                />\n              </li>\n            ))}\n          </ul>\n        </section>\n\n        {job.niceToHave && job.niceToHave.length > 0 && (\n          <section>\n            <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n              <Lightbulb className=\"h-4 w-4\" />\n              Nice to Have\n            </h3>\n            <ul className=\"space-y-2\">\n              {job.niceToHave.map((item, i) => (\n                <li key={i} className=\"flex items-start gap-2 text-sm text-gray-600 dark:text-gray-400\">\n                  <Sparkles className=\"h-4 w-4 text-yellow-500 shrink-0 mt-0.5\" />\n                  <HighlightedText \n                    text={item} \n                    terms={job.highlightedTerms}\n                    glossary={glossary}\n                    onTermClick={onTermClick}\n                  />\n                </li>\n              ))}\n            </ul>\n          </section>\n        )}\n\n        <section className=\"border-t pt-6\">\n          <h3 className=\"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2\">\n            <Building2 className=\"h-4 w-4\" />\n            About {job.company.name}\n          </h3>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n            {job.company.description}\n          </p>\n          \n          <div className=\"space-y-3\">\n            <div>\n              <span className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Culture</span>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                {job.company.culture}\n              </p>\n            </div>\n            \n            <div>\n              <span className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Values</span>\n              <div className=\"flex flex-wrap gap-2 mt-1\">\n                {job.company.values.map((value, i) => (\n                  <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                    {value}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n            \n            <div>\n              <span className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">Benefits</span>\n              <div className=\"flex flex-wrap gap-2 mt-1\">\n                {job.company.benefits.map((benefit, i) => (\n                  <Badge key={i} variant=\"secondary\" className=\"text-xs\">\n                    {benefit}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <section className=\"bg-gradient-to-r from-primary/5 to-primary/10 rounded-lg p-4\">\n          <h4 className=\"font-medium text-gray-900 dark:text-white mb-2\">\n            Interview Process\n          </h4>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n            This role has <span className=\"font-semibold text-primary\">{job.interviewStages} interview stages</span>. \n            {job.company.interviewStyle === 'rigorous' && \" Expect a thorough evaluation process focused on technical depth.\"}\n            {job.company.interviewStyle === 'balanced' && \" The process balances technical assessment with cultural fit.\"}\n            {job.company.interviewStyle === 'casual' && \" The interview focuses on conversation and practical problem-solving.\"}\n          </p>\n        </section>\n      </div>\n    </div>\n  );\n}\n\nfunction TermDefinitionModal({ \n  term, \n  onClose \n}: { \n  term: GlossaryTerm | null; \n  onClose: () => void;\n}) {\n  if (!term) return null;\n  \n  return (\n    <Dialog open={!!term} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle className=\"flex items-center gap-2\">\n            <BookOpen className=\"h-5 w-5 text-primary\" />\n            {term.term}\n          </DialogTitle>\n          {term.category && (\n            <Badge variant=\"outline\" className=\"w-fit\">\n              {term.category}\n            </Badge>\n          )}\n        </DialogHeader>\n        <p className=\"text-gray-600 dark:text-gray-400 text-sm leading-relaxed\">\n          {term.definition}\n        </p>\n        <DialogFooter>\n          <Button onClick={onClose} data-testid=\"button-close-term\">Got it</Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport default function JobBoard() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedJob, setSelectedJob] = useState<JobPosting | null>(null);\n  const [selectedTerm, setSelectedTerm] = useState<GlossaryTerm | null>(null);\n  const [showApplyDialog, setShowApplyDialog] = useState(false);\n  const [coverLetter, setCoverLetter] = useState(\"\");\n  const [cvFile, setCvFile] = useState<File | null>(null);\n  const [roleFilter, setRoleFilter] = useState<string | null>(null);\n\n  const { data: jobs, isLoading: jobsLoading } = useQuery<JobPosting[]>({\n    queryKey: ['/api/jobs'],\n  });\n\n  const { data: glossary = [] } = useQuery<GlossaryTerm[]>({\n    queryKey: ['/api/glossary'],\n  });\n\n  const { data: user } = useQuery<{ id: number }>({\n    queryKey: ['/api/user'],\n  });\n\n  const applyMutation = useMutation({\n    mutationFn: async (data: { userId: number; jobPostingId: number; coverLetter?: string; cv?: File }) => {\n      const formData = new FormData();\n      formData.append('userId', data.userId.toString());\n      formData.append('jobPostingId', data.jobPostingId.toString());\n      if (data.coverLetter) {\n        formData.append('coverLetter', data.coverLetter);\n      }\n      if (data.cv) {\n        formData.append('cv', data.cv);\n      }\n      \n      const response = await fetch('/api/applications', {\n        method: 'POST',\n        body: formData,\n      });\n      \n      if (!response.ok) {\n        throw new Error('Failed to submit application');\n      }\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Application submitted!\",\n        description: \"Your application has been received. Check your journey to track progress.\",\n      });\n      setShowApplyDialog(false);\n      setCoverLetter(\"\");\n      setCvFile(null);\n      if (user?.id) {\n        queryClient.invalidateQueries({ queryKey: [`/api/users/${user.id}/applications`] });\n      }\n      navigate(`/journey`);\n    },\n    onError: () => {\n      toast({\n        title: \"Application failed\",\n        description: \"There was an error submitting your application. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const filteredJobs = useMemo(() => {\n    if (!jobs) return [];\n    \n    return jobs.filter(job => {\n      const matchesSearch = searchQuery === \"\" || \n        job.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        job.company.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        job.description.toLowerCase().includes(searchQuery.toLowerCase());\n      \n      const matchesRole = !roleFilter || job.role === roleFilter;\n      \n      return matchesSearch && matchesRole;\n    });\n  }, [jobs, searchQuery, roleFilter]);\n\n  const roles = useMemo(() => {\n    if (!jobs) return [];\n    return Array.from(new Set(jobs.map(j => j.role)));\n  }, [jobs]);\n\n  const handleApply = () => {\n    if (!user || !selectedJob) return;\n    \n    applyMutation.mutate({\n      userId: user.id,\n      jobPostingId: selectedJob.id,\n      coverLetter: coverLetter || undefined,\n      cv: cvFile || undefined,\n    });\n  };\n\n  return (\n    <div className=\"p-6 max-w-screen-2xl mx-auto\">\n      <div className=\"mb-6\">\n        <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Job Board</h1>\n        <p className=\"text-gray-500 dark:text-gray-400 mt-1\">\n          Discover opportunities and start your journey. Click highlighted terms to learn more.\n        </p>\n      </div>\n\n      <ModeBanner \n        mode=\"journey\" \n        variant=\"banner\"\n      />\n\n      <div className=\"flex items-center gap-4 mb-6\">\n        <div className=\"relative flex-1 max-w-md\">\n          <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400\" />\n          <Input\n            placeholder=\"Search jobs, companies...\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            className=\"pl-10\"\n            data-testid=\"input-search\"\n          />\n        </div>\n        \n        <div className=\"flex items-center gap-2\">\n          <Filter className=\"h-4 w-4 text-gray-400\" />\n          <div className=\"flex gap-2\">\n            <Button\n              variant={roleFilter === null ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setRoleFilter(null)}\n              data-testid=\"filter-all\"\n            >\n              All\n            </Button>\n            {roles.map(role => (\n              <Button\n                key={role}\n                variant={roleFilter === role ? \"default\" : \"outline\"}\n                size=\"sm\"\n                onClick={() => setRoleFilter(role)}\n                data-testid={`filter-${role}`}\n              >\n                {role.toUpperCase()}\n              </Button>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 min-h-[calc(100vh-220px)]\">\n        <div className=\"space-y-4 overflow-y-auto pr-2\" style={{ maxHeight: 'calc(100vh - 220px)' }}>\n          {jobsLoading ? (\n            Array.from({ length: 5 }).map((_, i) => (\n              <Card key={i}>\n                <CardContent className=\"p-5\">\n                  <div className=\"flex items-start gap-4\">\n                    <Skeleton className=\"h-12 w-12 rounded-lg\" />\n                    <div className=\"flex-1 space-y-2\">\n                      <Skeleton className=\"h-5 w-3/4\" />\n                      <Skeleton className=\"h-4 w-1/2\" />\n                      <Skeleton className=\"h-4 w-full\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : filteredJobs.length === 0 ? (\n            <Card>\n              <CardContent className=\"p-8 text-center\">\n                <Briefcase className=\"h-12 w-12 mx-auto text-gray-300 mb-4\" />\n                <h3 className=\"font-medium text-gray-900 dark:text-white mb-1\">No jobs found</h3>\n                <p className=\"text-sm text-gray-500\">\n                  {searchQuery || roleFilter \n                    ? \"Try adjusting your search or filters\" \n                    : \"Check back soon for new opportunities\"}\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            filteredJobs.map(job => (\n              <JobCard\n                key={job.id}\n                job={job}\n                glossary={glossary}\n                onSelect={() => setSelectedJob(job)}\n                onTermClick={setSelectedTerm}\n                isSelected={selectedJob?.id === job.id}\n              />\n            ))\n          )}\n        </div>\n\n        <div className=\"bg-white dark:bg-gray-900 rounded-xl border shadow-sm overflow-hidden\" style={{ maxHeight: 'calc(100vh - 220px)' }}>\n          {selectedJob ? (\n            <JobDetails\n              job={selectedJob}\n              glossary={glossary}\n              onApply={() => setShowApplyDialog(true)}\n              onTermClick={setSelectedTerm}\n              isApplying={applyMutation.isPending}\n            />\n          ) : (\n            <div className=\"h-full flex flex-col items-center justify-center p-8 text-center\">\n              <div className=\"h-20 w-20 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center mb-4\">\n                <Briefcase className=\"h-10 w-10 text-gray-400\" />\n              </div>\n              <h3 className=\"font-medium text-gray-900 dark:text-white mb-1\">\n                Select a job to view details\n              </h3>\n              <p className=\"text-sm text-gray-500 max-w-xs\">\n                Click on any job posting to see the full description, requirements, and company information.\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <TermDefinitionModal \n        term={selectedTerm} \n        onClose={() => setSelectedTerm(null)} \n      />\n\n      <Dialog open={showApplyDialog} onOpenChange={setShowApplyDialog}>\n        <DialogContent className=\"sm:max-w-lg\">\n          <DialogHeader>\n            <DialogTitle>Apply to {selectedJob?.title}</DialogTitle>\n            <DialogDescription>\n              at {selectedJob?.company.name}\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\n                Upload CV (PDF or Word)\n              </label>\n              <input\n                type=\"file\"\n                accept=\".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document\"\n                onChange={(e) => setCvFile(e.target.files?.[0] || null)}\n                className=\"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white\"\n                data-testid=\"input-cv-upload\"\n              />\n              {cvFile && (\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Selected: {cvFile.name}\n                </p>\n              )}\n            </div>\n            \n            <div>\n              <label className=\"text-sm font-medium text-gray-700 dark:text-gray-300 mb-1.5 block\">\n                Cover Letter (optional)\n              </label>\n              <Textarea\n                placeholder=\"Tell them why you're interested in this role...\"\n                value={coverLetter}\n                onChange={(e) => setCoverLetter(e.target.value)}\n                rows={4}\n                data-testid=\"input-cover-letter\"\n              />\n            </div>\n            \n            <div className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\n              <h4 className=\"text-sm font-medium text-gray-900 dark:text-white mb-2\">\n                What happens next?\n              </h4>\n              <ol className=\"text-sm text-gray-600 dark:text-gray-400 space-y-1.5\">\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"flex items-center justify-center h-5 w-5 rounded-full bg-primary text-white text-xs shrink-0\">1</span>\n                  Your application will be submitted\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"flex items-center justify-center h-5 w-5 rounded-full bg-gray-300 dark:bg-gray-600 text-white text-xs shrink-0\">2</span>\n                  Track your progress in the Journey dashboard\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <span className=\"flex items-center justify-center h-5 w-5 rounded-full bg-gray-300 dark:bg-gray-600 text-white text-xs shrink-0\">3</span>\n                  Complete {selectedJob?.interviewStages} interview stages\n                </li>\n              </ol>\n            </div>\n          </div>\n          \n          <DialogFooter>\n            <Button variant=\"outline\" onClick={() => setShowApplyDialog(false)} data-testid=\"button-cancel-apply\">\n              Cancel\n            </Button>\n            <Button onClick={handleApply} disabled={applyMutation.isPending} data-testid=\"button-submit-application\">\n              {applyMutation.isPending ? \"Submitting...\" : \"Submit Application\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":27352,"size_tokens":null},"backend/src/apps/Subscriber/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.8 on 2025-11-23 17:57\n\nimport django.db.models.deletion\nfrom django.conf import settings\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        migrations.swappable_dependency(settings.AUTH_USER_MODEL),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='Subscriber',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('email_address', models.EmailField(max_length=254, unique=True)),\n                ('name', models.CharField(blank=True, default='', max_length=120, null=True)),\n                ('is_user', models.BooleanField(default=False, verbose_name='Is Registered User')),\n                ('is_subscribed', models.BooleanField(default=True, verbose_name='Is Subscribed')),\n                ('creation_date', models.DateTimeField(auto_now_add=True, verbose_name='Subscription Date')),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('user', models.OneToOneField(blank=True, default=None, null=True, on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),\n            ],\n            options={\n                'verbose_name_plural': 'Subscribed emails listing',\n            },\n        ),\n    ]\n","path":null,"size_bytes":1388,"size_tokens":null},"client/src/pages/journey-map.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ModeBanner } from \"@/components/ModeBanner\";\nimport { \n  Search, Briefcase, MessageCircle, Handshake, Users, Check, Lock, \n  ChevronRight, Zap, Target, TrendingUp, Flame, Star\n} from \"lucide-react\";\n\ninterface JobApplication {\n  id: number;\n  status: string;\n  currentStageIndex: number;\n  appliedAt?: string | null;\n  stages: { status: string; score?: number | null; completedAt?: string | null }[];\n  offerDetails?: any;\n}\n\ninterface Phase {\n  id: string;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  color: string;\n  bgColor: string;\n  status: \"completed\" | \"active\" | \"locked\";\n  progress: number;\n  stats: { label: string; value: string | number }[];\n  href?: string;\n  action?: string;\n}\n\nexport default function JourneyMap() {\n  const [, navigate] = useLocation();\n\n  const { data: user } = useQuery<{ id: number }>({\n    queryKey: [\"/api/user\"],\n  });\n\n  const { data: applications = [] } = useQuery<JobApplication[]>({\n    queryKey: [user?.id ? `/api/users/${user.id}/applications` : null],\n    enabled: !!user?.id,\n  });\n\n  // Calculate phase statuses\n  const totalApplications = applications.length;\n  const applicationsInProgress = applications.filter(\n    a => a.status === \"submitted\" || a.status === \"interviewing\"\n  ).length;\n  const offersApplications = applications.filter(a => a.status === \"offer\");\n  const applicationsWithOffers = offersApplications.length;\n  // Get first application with offer for navigation\n  const firstOfferApplication = offersApplications[0];\n  const totalInterviewsCompleted = applications.reduce(\n    (acc, app) => acc + app.stages.filter(s => s.status === \"completed\" || s.status === \"passed\").length,\n    0\n  );\n\n  // Calculate streak (simulated based on completed stages)\n  const calculateStreak = () => {\n    if (totalInterviewsCompleted === 0) return 0;\n    // Mock: assume 1 interview per day in the past week if they have completed interviews\n    return Math.min(totalInterviewsCompleted, 7);\n  };\n\n  // Calculate performance insights\n  const calculatePerformance = () => {\n    const completedStages = applications.flatMap(app => \n      app.stages.filter(s => (s.status === \"completed\" || s.status === \"passed\") && s.score !== null)\n    );\n    \n    if (completedStages.length === 0) {\n      return {\n        averageScore: 0,\n        completionRate: 0,\n        topStrength: \"Keep practicing!\",\n        improvementArea: \"All areas\"\n      };\n    }\n\n    const scores = completedStages.map(s => s.score as number);\n    const averageScore = Math.round(scores.reduce((a, b) => a + b, 0) / scores.length);\n    const completionRate = Math.round((totalInterviewsCompleted / (totalApplications * 3 + 1)) * 100);\n\n    const scoreDistribution = {\n      excellent: scores.filter(s => s >= 80).length,\n      good: scores.filter(s => s >= 70 && s < 80).length,\n      needsWork: scores.filter(s => s < 70).length,\n    };\n\n    return {\n      averageScore,\n      completionRate,\n      topStrength: scoreDistribution.excellent > 0 ? \"Strong Technical Skills\" : \"Consistent Progress\",\n      improvementArea: scoreDistribution.needsWork > 0 ? \"Communication\" : \"System Design\"\n    };\n  };\n\n  const performance = calculatePerformance();\n  const streak = calculateStreak();\n\n  // Determine phase statuses\n  const getPhaseStatus = (phaseId: string): \"completed\" | \"active\" | \"locked\" => {\n    switch (phaseId) {\n      case \"job-search\":\n        return totalApplications > 0 ? \"active\" : \"active\";\n      case \"interview\":\n        return applicationsInProgress > 0 ? \"active\" : totalApplications > 0 ? \"completed\" : \"locked\";\n      case \"negotiations\":\n        return applicationsWithOffers > 0 ? \"active\" : \"locked\";\n      case \"workspace\":\n        return \"locked\";\n      default:\n        return \"locked\";\n    }\n  };\n\n  const phases: Phase[] = [\n    {\n      id: \"job-search\",\n      title: \"Job Search\",\n      description: \"Explore opportunities and submit applications\",\n      icon: <Search className=\"h-8 w-8\" />,\n      color: \"from-blue-500 to-blue-600\",\n      bgColor: \"bg-blue-50 dark:bg-blue-950\",\n      status: getPhaseStatus(\"job-search\"),\n      progress: totalApplications > 0 ? 100 : 0,\n      stats: [\n        { label: \"Applications\", value: totalApplications },\n        { label: \"Status\", value: totalApplications > 0 ? \"Active\" : \"Ready to Start\" },\n      ],\n      href: \"/jobs\",\n      action: \"Browse Jobs\",\n    },\n    {\n      id: \"interview\",\n      title: \"Interview\",\n      description: \"Practice and complete interview stages\",\n      icon: <MessageCircle className=\"h-8 w-8\" />,\n      color: \"from-purple-500 to-purple-600\",\n      bgColor: \"bg-purple-50 dark:bg-purple-950\",\n      status: getPhaseStatus(\"interview\"),\n      progress: totalApplications > 0 \n        ? Math.round((totalInterviewsCompleted / (totalApplications * 3)) * 100)\n        : 0,\n      stats: [\n        { label: \"In Progress\", value: applicationsInProgress },\n        { label: \"Completed\", value: totalInterviewsCompleted },\n      ],\n      href: \"/journey\",\n      action: \"View Details\",\n    },\n    {\n      id: \"negotiations\",\n      title: \"Negotiations\",\n      description: \"Negotiate offers and maximize compensation\",\n      icon: <Handshake className=\"h-8 w-8\" />,\n      color: \"from-green-500 to-green-600\",\n      bgColor: \"bg-green-50 dark:bg-green-950\",\n      status: getPhaseStatus(\"negotiations\"),\n      progress: applicationsWithOffers > 0 ? 50 : 0,\n      stats: [\n        { label: \"Offers Received\", value: applicationsWithOffers },\n        { label: \"Status\", value: applicationsWithOffers > 0 ? \"Ready\" : \"Awaiting Offers\" },\n      ],\n      // Pass full Journey context params when navigating\n      href: getPhaseStatus(\"negotiations\") !== \"locked\" \n        ? (firstOfferApplication ? `/negotiation?journeyMode=configure&applicationId=${firstOfferApplication.id}` : \"/negotiation\")\n        : undefined,\n      action: getPhaseStatus(\"negotiations\") !== \"locked\" ? \"Start\" : \"Unlock\",\n    },\n    {\n      id: \"workspace\",\n      title: \"Workspace\",\n      description: \"Onboard and practice in a virtual team environment\",\n      icon: <Users className=\"h-8 w-8\" />,\n      color: \"from-orange-500 to-orange-600\",\n      bgColor: \"bg-orange-50 dark:bg-orange-950\",\n      status: getPhaseStatus(\"workspace\"),\n      progress: 0,\n      stats: [\n        { label: \"Readiness\", value: \"Coming Soon\" },\n        { label: \"Status\", value: \"Awaiting Offer\" },\n      ],\n    },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-6\">\n      <div className=\"max-w-6xl mx-auto\">\n        {/* Journey Mode Banner */}\n        <ModeBanner \n          mode=\"journey\" \n          variant=\"banner\"\n        />\n\n        {/* Header */}\n        <div className=\"mb-12\">\n          <h1 className=\"text-4xl font-bold text-gray-900 dark:text-white mb-2\">\n            Your Job Journey\n          </h1>\n          <p className=\"text-lg text-gray-600 dark:text-gray-400\">\n            Navigate through the four phases of your professional journey\n          </p>\n        </div>\n\n        {/* First-Time User Onboarding */}\n        {totalApplications === 0 && (\n          <div className=\"mb-12 p-6 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/30 dark:to-indigo-900/30 rounded-lg border border-blue-200 dark:border-blue-800\">\n            <div className=\"flex items-start gap-4\">\n              <div className=\"p-3 bg-blue-100 dark:bg-blue-900 rounded-lg\">\n                <Search className=\"h-6 w-6 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white mb-2\">\n                  Ready to start your job journey?\n                </h3>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n                  Begin by exploring opportunities that match your career goals. Apply to 2-3 positions to get started with interviews and build your skills.\n                </p>\n                <Button \n                  onClick={() => navigate('/jobs')}\n                  data-testid=\"button-onboarding-browse\"\n                >\n                  <Search className=\"h-4 w-4 mr-2\" />\n                  Browse Job Listings\n                </Button>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Streak & Performance Highlight */}\n        {totalInterviewsCompleted > 0 && (\n          <div className=\"mb-12 p-4 bg-gradient-to-r from-orange-50 to-red-50 dark:from-orange-900/20 dark:to-red-900/20 rounded-lg border border-orange-200 dark:border-orange-800 flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <Flame className=\"h-6 w-6 text-orange-500\" />\n              <div>\n                <div className=\"font-semibold text-gray-900 dark:text-white\">\n                  {streak}-Day Streak! \n                </div>\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                  You completed {totalInterviewsCompleted} interviews\n                </div>\n              </div>\n            </div>\n            <Badge className=\"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\">\n              Keep it up!\n            </Badge>\n          </div>\n        )}\n\n        {/* Overview Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4 mb-12\">\n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    {totalApplications}\n                  </div>\n                  <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    Applications\n                  </div>\n                </div>\n                <Briefcase className=\"h-8 w-8 text-blue-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    {applicationsInProgress}\n                  </div>\n                  <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    In Progress\n                  </div>\n                </div>\n                <Zap className=\"h-8 w-8 text-yellow-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    {totalInterviewsCompleted}\n                  </div>\n                  <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    Interviews Done\n                  </div>\n                </div>\n                <Check className=\"h-8 w-8 text-green-500\" />\n              </div>\n            </CardContent>\n          </Card>\n          \n          <Card>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                    {applicationsWithOffers}\n                  </div>\n                  <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                    Offers\n                  </div>\n                </div>\n                <Target className=\"h-8 w-8 text-green-600\" />\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        {/* Performance Insights Card */}\n        {totalInterviewsCompleted > 0 && (\n          <div className=\"mb-12 grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg\">\n                    <TrendingUp className=\"h-5 w-5 text-blue-600 dark:text-blue-400\" />\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                      Average Score\n                    </div>\n                    <div className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n                      {performance.averageScore}%\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-green-100 dark:bg-green-900 rounded-lg\">\n                    <Star className=\"h-5 w-5 text-green-600 dark:text-green-400\" />\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                      Strength\n                    </div>\n                    <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                      {performance.topStrength}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"p-2 bg-amber-100 dark:bg-amber-900 rounded-lg\">\n                    <Target className=\"h-5 w-5 text-amber-600 dark:text-amber-400\" />\n                  </div>\n                  <div>\n                    <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                      Focus Area\n                    </div>\n                    <div className=\"text-lg font-semibold text-gray-900 dark:text-white\">\n                      {performance.improvementArea}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        )}\n\n        {/* Phase Cards */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n          {phases.map((phase) => (\n            <Card key={phase.id} className=\"overflow-hidden hover:shadow-lg transition-shadow\">\n              <CardContent className=\"p-0\">\n                {/* Header with gradient */}\n                <div className={`bg-gradient-to-r ${phase.color} p-6 text-white relative overflow-hidden`}>\n                  <div className=\"absolute -right-8 -top-8 opacity-10\">\n                    <div className=\"text-8xl\">{phase.icon}</div>\n                  </div>\n                  <div className=\"relative z-10 flex items-start justify-between\">\n                    <div className=\"flex items-start gap-4\">\n                      <div className=\"p-3 bg-white/20 rounded-lg\">\n                        {phase.icon}\n                      </div>\n                      <div>\n                        <h3 className=\"text-2xl font-bold\">{phase.title}</h3>\n                        <p className=\"text-sm text-white/80 mt-1\">{phase.description}</p>\n                      </div>\n                    </div>\n                    <div>\n                      {phase.status === \"completed\" && (\n                        <Badge className=\"bg-white/30 text-white border-white/50\">\n                          <Check className=\"h-3 w-3 mr-1\" />\n                          Completed\n                        </Badge>\n                      )}\n                      {phase.status === \"active\" && (\n                        <Badge className=\"bg-white/30 text-white border-white/50\">\n                          <Zap className=\"h-3 w-3 mr-1\" />\n                          Active\n                        </Badge>\n                      )}\n                      {phase.status === \"locked\" && (\n                        <Badge variant=\"outline\" className=\"bg-white/10 text-white border-white/50\">\n                          <Lock className=\"h-3 w-3 mr-1\" />\n                          Locked\n                        </Badge>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                {/* Content */}\n                <div className=\"p-6\">\n                  {/* Progress */}\n                  <div className=\"mb-4\">\n                    <div className=\"flex items-center justify-between mb-2\">\n                      <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n                        Progress\n                      </span>\n                      <span className=\"text-sm font-semibold text-gray-900 dark:text-white\">\n                        {phase.progress}%\n                      </span>\n                    </div>\n                    <Progress value={phase.progress} className=\"h-2\" />\n                  </div>\n\n                  {/* Stats */}\n                  <div className=\"grid grid-cols-2 gap-4 mb-6\">\n                    {phase.stats.map((stat, idx) => (\n                      <div key={idx} className=\"p-3 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                        <div className=\"text-xs text-gray-500 uppercase tracking-wide\">\n                          {stat.label}\n                        </div>\n                        <div className=\"text-lg font-bold text-gray-900 dark:text-white mt-1\">\n                          {stat.value}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  {/* Action Button */}\n                  <Button\n                    onClick={() => {\n                      if (phase.href) {\n                        navigate(phase.href);\n                      }\n                    }}\n                    disabled={phase.status === \"locked\" && !phase.href}\n                    className=\"w-full\"\n                    variant={phase.status === \"locked\" ? \"outline\" : \"default\"}\n                    data-testid={`button-${phase.id}`}\n                  >\n                    {phase.action || \"View\"} \n                    {phase.status !== \"locked\" && <ChevronRight className=\"h-4 w-4 ml-2\" />}\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":18765,"size_tokens":null},"server/services/interview-chains.ts":{"content":"import { ChatGroq } from \"@langchain/groq\";\nimport { PromptTemplate } from \"@langchain/core/prompts\";\nimport { RunnableSequence } from \"@langchain/core/runnables\";\nimport { StringOutputParser } from \"@langchain/core/output_parsers\";\n\n/**\n * Strip Qwen3's <think>...</think> reasoning tags from output\n * Qwen3 is a reasoning model that outputs its chain-of-thought in these tags\n */\nexport function stripThinkingTags(text: string): string {\n  // Remove <think>...</think> blocks (including multiline)\n  let cleaned = text.replace(/<think>[\\s\\S]*?<\\/think>/gi, '').trim();\n  \n  // Remove wrapping quotation marks if the entire response is quoted\n  if ((cleaned.startsWith('\"') && cleaned.endsWith('\"')) ||\n      (cleaned.startsWith(\"'\") && cleaned.endsWith(\"'\"))) {\n    cleaned = cleaned.slice(1, -1).trim();\n  }\n  \n  return cleaned;\n}\n\n// Using Qwen3-32B for better reasoning quality (latency is acceptable - gives \"thinking\" feel)\nconst MODEL_NAME = \"qwen/qwen3-32b\";\n\nconst model = new ChatGroq({\n  model: MODEL_NAME,\n  temperature: 0.6,\n  topP: 0.95,\n  apiKey: process.env.GROQ_API_KEY,\n});\n\nconst questionModel = new ChatGroq({\n  model: MODEL_NAME,\n  temperature: 0.6,\n  topP: 0.95,\n  apiKey: process.env.GROQ_API_KEY,\n});\n\nconst evaluatorModel = new ChatGroq({\n  model: MODEL_NAME,\n  temperature: 0.6,\n  topP: 0.95,\n  apiKey: process.env.GROQ_API_KEY,\n});\n\nexport type InterviewStage = \"greeting\" | \"intro_exchange\" | \"opening\" | \"core\" | \"wrapup\" | \"closure\";\n\nexport function getInterviewStage(questionIndex: number, totalQuestions: number): InterviewStage {\n  if (questionIndex === 0) return \"opening\";\n  if (questionIndex >= totalQuestions - 1) return \"wrapup\";\n  return \"core\";\n}\n\nexport function getPreludeStage(preludeStep: number): InterviewStage {\n  if (preludeStep === 0) return \"greeting\";\n  if (preludeStep === 1) return \"intro_exchange\";\n  return \"opening\";\n}\n\nexport function shouldGenerateReflection(answer: string, stage: InterviewStage): boolean {\n  if (stage === \"opening\") return false;\n  if (stage === \"wrapup\") return false;\n  const wordCount = answer.trim().split(/\\s+/).length;\n  if (wordCount < 15) return false;\n  return Math.random() < 0.4;\n}\n\nexport function extractCvHighlights(cvText: string): string {\n  if (!cvText || cvText.length < 50) {\n    return \"No CV provided\";\n  }\n  \n  const highlights: string[] = [];\n  \n  const experienceMatch = cvText.match(/(\\d+)\\+?\\s*years?/i);\n  if (experienceMatch) {\n    highlights.push(`- Years of experience: ${experienceMatch[0]}`);\n  }\n  \n  const companies = [\n    { pattern: /rabobank/i, name: \"Rabobank\" },\n    { pattern: /redkite/i, name: \"RedKite\" },\n    { pattern: /unicef/i, name: \"UNICEF\" },\n    { pattern: /unfpa|united nations population fund/i, name: \"UNFPA\" },\n    { pattern: /world bank/i, name: \"World Bank\" },\n    { pattern: /maastricht university/i, name: \"Maastricht University\" },\n    { pattern: /tilburg university/i, name: \"Tilburg University\" },\n    { pattern: /american university of armenia/i, name: \"American University of Armenia\" },\n    { pattern: /yerevan state university/i, name: \"Yerevan State University\" },\n  ];\n  \n  const foundCompanies: string[] = [];\n  const foundEducation: string[] = [];\n  \n  for (const { pattern, name } of companies) {\n    if (pattern.test(cvText)) {\n      if (name.includes(\"University\")) {\n        foundEducation.push(name);\n      } else {\n        foundCompanies.push(name);\n      }\n    }\n  }\n  \n  if (foundCompanies.length > 0) {\n    highlights.push(`- Companies worked at: ${foundCompanies.join(\", \")}`);\n  }\n  \n  if (foundEducation.length > 0) {\n    highlights.push(`- Education: ${foundEducation.join(\", \")}`);\n  }\n  \n  const rolePatterns = [\n    /snr\\.?\\s*data\\s*scientist/i,\n    /senior\\s*data\\s*scientist/i,\n    /lead\\s*data\\s*scientist/i,\n    /data\\s*scientist/i,\n    /phd\\s*candidate/i,\n    /data\\s*analy[sz]t/i,\n    /program\\s*manager/i,\n  ];\n  \n  const foundRoles: string[] = [];\n  for (const pattern of rolePatterns) {\n    const match = cvText.match(pattern);\n    if (match && !foundRoles.some(r => r.toLowerCase() === match[0].toLowerCase())) {\n      foundRoles.push(match[0]);\n    }\n  }\n  \n  if (foundRoles.length > 0) {\n    highlights.push(`- Roles held: ${foundRoles.slice(0, 3).join(\", \")}`);\n  }\n  \n  const phdMatch = cvText.match(/ph\\.?d\\.?|philosophy\\s*doctor/i);\n  const masterMatch = cvText.match(/m\\.?s\\.?c?\\.?|master/i);\n  if (phdMatch) {\n    highlights.push(`- Highest degree: PhD`);\n  } else if (masterMatch) {\n    highlights.push(`- Highest degree: Master's`);\n  }\n  \n  const skillPatterns = [\n    /python/i, /r(?:\\s|,|$)/i, /sql/i, /machine\\s*learning/i, \n    /power\\s*bi/i, /tableau/i, /spark|pyspark/i, /statistics/i\n  ];\n  const foundSkills: string[] = [];\n  for (const pattern of skillPatterns) {\n    if (pattern.test(cvText)) {\n      const skill = cvText.match(pattern)?.[0].trim();\n      if (skill && skill.length > 1) foundSkills.push(skill);\n    }\n  }\n  if (foundSkills.length > 0) {\n    highlights.push(`- Key skills: ${foundSkills.slice(0, 5).join(\", \")}`);\n  }\n  \n  return highlights.length > 0 \n    ? highlights.join(\"\\n\") \n    : \"CV provided but key details not extracted\";\n}\n\nexport interface InterviewConfig {\n  interviewType: string;\n  targetRole: string;\n  difficulty: string;\n  totalQuestions: number;\n  companyName?: string;\n  companyDescription?: string;\n  jobTitle?: string;\n  jobRequirements?: string;\n  candidateCv?: string;\n  interviewerName?: string;\n  // Stage runtime settings for dynamic interview flow\n  stageSettings?: StageRuntimeSettings;\n}\n\n// Stage-specific runtime settings for dynamic interview flow\nexport interface StageRuntimeSettings {\n  minDurationMs: number;      // Minimum interview duration in milliseconds\n  maxDurationMs: number;      // Maximum interview duration in milliseconds\n  minQuestions: number;       // Minimum core questions to ask\n  maxQuestions: number;       // Hard limit on questions (prevents endless interviews)\n  criticalCriteria: AssessmentCriterion[]; // Must-cover criteria for this stage\n  sufficiencyThresholds: {\n    overall: number;          // Required overall coverage (0-1)\n    critical: number;         // Required coverage for critical criteria (0-1)\n    confidence: number;       // Required evaluator confidence for early end (0-1)\n  };\n}\n\n// Interview stage type definitions\nexport type InterviewStageType = 'hr_screening' | 'technical' | 'behavioral' | 'final' | 'case_study';\n\n// Default stage settings for each interview type\nexport const DEFAULT_STAGE_SETTINGS: Record<InterviewStageType, StageRuntimeSettings> = {\n  hr_screening: {\n    minDurationMs: 15 * 60 * 1000,  // 15 minutes\n    maxDurationMs: 30 * 60 * 1000,  // 30 minutes\n    minQuestions: 4,\n    maxQuestions: 12,\n    criticalCriteria: ['background', 'motivation', 'culture_fit'],\n    sufficiencyThresholds: {\n      overall: 0.70,\n      critical: 0.60,\n      confidence: 0.75\n    }\n  },\n  technical: {\n    minDurationMs: 35 * 60 * 1000,  // 35 minutes\n    maxDurationMs: 55 * 60 * 1000,  // 55 minutes\n    minQuestions: 6,\n    maxQuestions: 18,\n    criticalCriteria: ['skills', 'background'],\n    sufficiencyThresholds: {\n      overall: 0.75,\n      critical: 0.70,\n      confidence: 0.80\n    }\n  },\n  behavioral: {\n    minDurationMs: 25 * 60 * 1000,  // 25 minutes\n    maxDurationMs: 40 * 60 * 1000,  // 40 minutes\n    minQuestions: 5,\n    maxQuestions: 15,\n    criticalCriteria: ['behavioral', 'culture_fit', 'motivation'],\n    sufficiencyThresholds: {\n      overall: 0.70,\n      critical: 0.65,\n      confidence: 0.75\n    }\n  },\n  final: {\n    minDurationMs: 25 * 60 * 1000,  // 25 minutes\n    maxDurationMs: 40 * 60 * 1000,  // 40 minutes\n    minQuestions: 5,\n    maxQuestions: 12,\n    criticalCriteria: ['culture_fit', 'motivation', 'logistics'],\n    sufficiencyThresholds: {\n      overall: 0.75,\n      critical: 0.70,\n      confidence: 0.80\n    }\n  },\n  case_study: {\n    minDurationMs: 40 * 60 * 1000,  // 40 minutes\n    maxDurationMs: 60 * 60 * 1000,  // 60 minutes\n    minQuestions: 3,\n    maxQuestions: 8,\n    criticalCriteria: ['skills', 'behavioral'],\n    sufficiencyThresholds: {\n      overall: 0.80,\n      critical: 0.75,\n      confidence: 0.85\n    }\n  }\n};\n\n// Helper to get stage settings from interview type\nexport function getStageSettings(interviewType: string): StageRuntimeSettings {\n  const typeMapping: Record<string, InterviewStageType> = {\n    'hr': 'hr_screening',\n    'hr_screening': 'hr_screening',\n    'recruiter_call': 'hr_screening',\n    'behavioral': 'behavioral',\n    'technical': 'technical',\n    'case_study': 'case_study',\n    'final': 'final'\n  };\n  \n  const stageType = typeMapping[interviewType.toLowerCase()] || 'hr_screening';\n  return DEFAULT_STAGE_SETTINGS[stageType];\n}\n\nexport interface QuestionContext {\n  config: InterviewConfig;\n  questionIndex: number;\n  previousQuestions: string[];\n  previousAnswers: string[];\n  previousScores: number[];\n  lastAnswer?: string;\n  activeProject?: string | null;\n  prioritizedTopic?: 'background' | 'skills' | 'behavioral' | 'motivation' | 'culture_fit' | 'logistics';\n}\n\nexport interface EvaluationResult {\n  score: number;\n  feedback: string;\n  strengths: string[];\n  improvements: string[];\n  projectMentioned?: string | null;\n}\n\nexport interface FollowUpDecision {\n  action: \"next_question\" | \"follow_up\" | \"adjust_difficulty\" | \"end_interview\";\n  reason: string;\n  difficultyAdjustment?: \"easier\" | \"harder\" | \"same\";\n}\n\nexport interface FinalReport {\n  overallScore: number;\n  communicationScore: number;\n  technicalScore: number;\n  problemSolvingScore: number;\n  cultureFitScore: number;\n  summary: string;\n  strengths: string[];\n  improvements: string[];\n  recommendations: string[];\n  hiringDecision: string;\n}\n\n// Pre-conversation preparation types\nexport type AssessmentCriterion = 'background' | 'skills' | 'behavioral' | 'motivation' | 'culture_fit' | 'logistics';\n\nexport interface PlannedQuestion {\n  id: string;\n  question: string;\n  criterion: AssessmentCriterion;\n  priority: number; // 1 = highest priority\n  rationale: string;\n  desiredDepth: 'brief' | 'detailed' | 'in-depth';\n  status: 'pending' | 'asked' | 'covered_proactively' | 'skipped';\n  keywords: string[]; // For detecting proactive coverage\n}\n\nexport interface InterviewPlan {\n  candidateStrengths: string[];\n  areasToProbe: string[];\n  potentialConcerns: string[];\n  questions: PlannedQuestion[];\n}\n\n// Enhanced follow-up decision with more nuanced outcomes\nexport interface TriageDecision {\n  outcome: 'satisfied' | 'partial' | 'vague' | 'has_question' | 'proactive_coverage';\n  action: 'proceed_next' | 'follow_up' | 'answer_then_proceed' | 'acknowledge_coverage';\n  reason: string;\n  followUpPrompt?: string; // Specific follow-up if needed\n  candidateQuestion?: string; // The question the candidate asked (if has_question)\n  coveredQuestionIds?: string[]; // Questions proactively covered by this answer\n  acknowledgment?: string; // Natural acknowledgment for proactive coverage\n}\n\nconst introductionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly {interviewerRole} at {companyName}.\n\nYou're starting a {interviewType} interview with a candidate for the {jobTitle} position.\n\nCOMPANY INFO:\n{companyDescription}\n\nCANDIDATE'S CV (USE EXACT FACTS - DO NOT INVENT):\n{candidateCv}\n\nWrite a warm, natural opening as if you're genuinely excited to meet this person. \n\nFirst paragraph: Thank them for joining, introduce yourself casually (just name and role), and mention what {companyName} does in a way that sounds like you're proud to work therenot reading a script.\n\nSecond paragraph: Briefly preview what you'll chat about today. If their CV mentions something interesting (a company, project, or skill), reference it naturally to show you've done your homework. End with an easy transition like \"Whenever you're ready, I'd love to hear a bit about you\" or \"Sound good? Let's dive in.\"\n\nTONE: Warm but professional. Like a friendly colleague, not a formal interviewer. No numbered lists or bullet pointsjust speak naturally.\n\nOutput ONLY the introduction (4-6 sentences). Don't ask the first interview question yet.\n`);\n\n// New conversational prelude prompts for natural interview flow\nconst greetingPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly {interviewerRole} at {companyName}.\n\nThe candidate ({candidateName}) just joined the call for a {interviewType} interview for the {jobTitle} position.\n\nWrite a brief, warm greetingjust like you'd start any video call with someone new. Include:\n1. A friendly hello using their first name\n2. Introduce yourself (just name and role, nothing more)\n3. A simple \"How are you doing today?\" or similar\n\nKEEP IT SHORT. This is just the opening moment, not your life story.\n\nExamples:\n- \"Hi Samvel! I'm Sarah, an HR recruiter here at DataViz Pro. How's your day going so far?\"\n- \"Hey Marcus! Nice to meet youI'm Sarah from the People team. How are you doing today?\"\n\nOutput ONLY the greeting (1-2 sentences max).\n`);\n\nconst introExchangePrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly {interviewerRole} at {companyName}.\n\nThe candidate just responded to your greeting: \"{candidateResponse}\"\n\nIMPORTANT: If the candidate asked how YOU are doing (e.g., \"You?\", \"How about you?\", \"And you?\", \"How are you?\"), you MUST answer that question first before continuing.\n\nAcknowledge their response naturally, answer any question they asked about you, then propose doing a round of introductions.\n\nExamples:\n- If they said \"I'm good, thanks. You?\": \"I'm doing great, thanks for asking! Shall we do a quick round of intros before we dive inI'll start, then you?\"\n- If they said \"Doing well!\": \"Great to hear! So, I thought we could start with quick introsI'll go first, then you?\"\n- If they said \"Good morning, how are you?\": \"Good morning! I'm doing well, thanks! How about we kick things off with brief introductions?\"\n\nKeep it casual and brief. Don't launch into your full intro yetjust propose the format.\n\nOutput ONLY your response (1-2 sentences max).\n`);\n\nconst selfIntroPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly {interviewerRole} at {companyName}.\n\nCOMPANY INFO:\n{companyDescription}\n\nJOB INFO:\n{jobTitle}\n\nKEY REQUIREMENTS (use these EXACT details):\n{jobRequirements}\n\nGive a brief role overview and invite them to share their background.\n\nSTRUCTURE (exactly like Julia):\n1. Transition: \"Great! To get us started, I'll give you a quick overview of the role and then would love to hear more about you.\"\n2. Role summary using REAL job requirements: \"We're hiring a [role] to [main responsibilities from requirements][key tasks]. The role also involves [collaboration aspect from requirements].\"\n3. Invite background: \"Before we dive deeper, could you tell me a bit about your background?\"\n\nREAL EXAMPLE:\n\"Great! To get us started, I'll give you a quick overview of the role and then would love to hear more about you. We're hiring a Senior Data Scientist to lead development of AI/ML featuresmainly anomaly detection and predictive forecastingfor our analytics platform. The role also involves working closely with engineers and running A/B tests in production. Before we dive deeper, could you tell me a bit about your background?\"\n\nKEY RULES:\n- Use ACTUAL job requirements from above, not generic descriptions\n- Keep it to 3 sentences\n- Don't give a personal intro about yourselfgo straight to the role\n- Sound natural and conversational\n\nOutput ONLY your role overview + invitation (3 sentences).\n`);\n\nconst closurePrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a human HR recruiter at {companyName}. The screening conversation is ending.\n\nCOMPANY: {companyName}\nROLE: {jobTitle}\nCANDIDATE NAME: {candidateName}\n\nWrite a warm, genuine closing like a real person would end a good conversation.\n\nSTRUCTURE (2-3 sentences):\n1. A sincere thank-you: \"Well, this was a great conversation, {candidateName}.\"\n2. Next steps: \"I'll share this with the hiring team. If they'd like to move forward, the next step will be [next round].\"\n3. Warm sign-off: \"Thanks again for your time!\" or \"Have a great rest of your day!\"\n\nEXAMPLE:\n\"Well, this was a great conversation, {candidateName}. I'll share this with the hiring team. If they'd like to move forward, the next step will be a technical conversation with the Lead Data Scientist.\"\n\nTONE:\n- Sound like you genuinely enjoyed the chat\n- Be warm but professional\n- Keep it briefdon't drag out the goodbye\n- IMPORTANT: Use the candidate's actual name \"{candidateName}\" - do not use placeholder names\n\nAVOID:\n- Summarizing the whole interview\n- \"I really enjoyed learning about...\" (overused)\n- Robotic phrases\n- Over-promising timelines\n\nKeep it to 2-3 sentences. Sound human.\n`);\n\nconst wrapupQuestionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a human HR recruiter at {companyName}. The conversation is winding down.\n\nROLE: {jobTitle}\nCOMPANY: {companyName}\n\nAsk ONE final quick question. Keep it light and natural.\n\nPICK ONE (based on what feels right):\n- Salary: \"And what are your salary expectations?\"\n- Location/visa: \"A couple more quick questionswhere are you currently based, and do you need visa support?\"\n- Availability: \"What's your timeline if things move forward?\"\n- Open-ended: \"Is there anything you'd like to ask me about the role?\"\n\nEXAMPLES FROM REAL HR:\n- \"A couple more quick questions: Where are you currently based, and do you need visa support?\"\n- \"Great. And what are your salary expectations?\"\n- \"Totally understandable. Well, this was a great conversation.\"\n\nTONE:\n- Brief and casual\n- Like you're wrapping up a friendly chat\n- Not interrogating\n\nKeep it to 1-2 sentences. Be natural.\n`);\n\nconst hrScreeningQuestionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a human HR recruiter at {companyName}.\nYour job is to conduct a realistic, natural HR screening interviewlike Julia at DataViz Pro.\nThe conversation must feel human, warm, and professional.\n\nROLE: {jobTitle}\nCOMPANY: {companyName}\n\nCANDIDATE'S CV (use these EXACT factsdo not invent):\n{candidateCv}\n\nCV KEY FACTS:\n{cvHighlights}\n\nJOB REQUIREMENTS:\n{jobRequirements}\n\nCONVERSATION SO FAR:\n- Question {questionIndex} of {totalQuestions}\n- Topics discussed: {previousQuestions}\n- Their last answer: \"{lastAnswer}\"\n\nCURRENT PHASE:\n{currentGoal}\n\nJULIA'S STYLE (follow this):\n- Ask ONE question at a time\n- Acknowledge briefly: \"Got it.\" / \"Thanks, that's helpful.\" / \"That sounds very aligned.\"\n- Reference specific facts from their CV when relevant: \"I noticed you were at [company]...\"\n- Keep it conversationalyou're chatting, not interrogating\n\nBRIEF ACKNOWLEDGMENTS FOR QUESTIONS 2+:\n- \"Thanks, that's helpful.\" (then ask)\n- \"That sounds very aligned.\" (then ask)\n- \"Got it.\" (then ask)\n- \"Makes sense.\" (then ask)\n- Just \"So,\" or \"And,\" for quick pivots\n\nEXAMPLES FROM JULIA:\n- \"Thanks, that's helpful. The team here works heavily with Python, scikit-learn, and either TensorFlow or PyTorch. How comfortable are you with those tools?\"\n- \"That sounds very aligned. The role also involves statistical analysis and hypothesis testing. Do you have hands-on experience with that?\"\n- \"Great. Since our product roadmap is focused on time-series forecasting, could you walk me through your experience in that area?\"\n\nWHAT TO AVOID:\n- Multi-part questions (ask ONE thing only)\n- Lengthy praise or summarizing their answer back\n- Sounding robotic or like you're checking boxes\n- Inventing CV facts\n\nOutput ONLY your question (with optional brief acknowledgment). Nothing else.\n`);\n\nconst technicalQuestionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a {interviewerRole} at {companyName} conducting a {interviewType} interview for a {targetRole} position.\n\nCOMPANY: {companyName}\nJOB TITLE: {jobTitle}\n\nCANDIDATE'S CV (USE EXACT FACTS - DO NOT INVENT):\n{candidateCv}\n\nJOB REQUIREMENTS:\n{jobRequirements}\n\nInterview Progress:\n- Question {questionIndex} of {totalQuestions}\n- Topics covered: {previousQuestions}\n- Last answer: {lastAnswer}\n- Project/example they mentioned: {activeProject}\n\nINTERVIEW TYPE FOCUS:\n{interviewTypeFocus}\n\nHOW TO TRANSITION (Questions 2+):\nUse a brief connector before your question when it feels natural:\n- \"Makes sense\" or \"Got it\" (then pivot)\n- \"Interesting approach\" (then follow up)\n- Or just \"So,\" / \"And,\" / \"Now,\" for quick pivots\n\nAVOID:\n- Long praise or feedback (\"That's a really excellent point about...\")\n- Summarizing their answer back to them\n- Generic filler (\"Thanks for sharing that\")\n\nGUIDELINES:\n1. TIE QUESTIONS TO JOB REQUIREMENTS\n2. PERSONALIZE WITH CV - use exact facts only\n3. DRILL DOWN ON THEIR PROJECT when relevant ({activeProject})\n4. PIVOT after 2-3 questions on same topic\n5. NEVER REPEAT a question already asked\n\nFOR QUESTION 1:\nReference something specific from their CV or the job requirements.\n\nOutput ONLY the question (with optional brief connector). Nothing else.\n`);\n\nconst questionGeneratorPrompt = PromptTemplate.fromTemplate(`\nYou are Sarah, a friendly hiring manager conducting a {interviewType} interview for a {targetRole} position.\n\nInterview Progress:\n- Question {questionIndex} of {totalQuestions}\n- Topics covered: {previousQuestions}\n- Last answer: {lastAnswer}\n- Project/example they mentioned: {activeProject}\n\nHOW TO TRANSITION (Questions 2+):\nUse a brief connector when it feels natural:\n- \"Nice\" or \"Okay\" (then pivot)\n- \"That's helpful context\" (if genuinely useful)\n- Or just \"So,\" / \"And,\" for quick pivots\n\nAVOID:\n- Over-the-top praise (\"What a fantastic example!\")\n- Summarizing their answer back\n- Generic filler that sounds scripted\n\nGUIDELINES:\n1. DRILL DOWN ON THEIR PROJECT when relevant ({activeProject})\n2. PIVOT after 2-3 questions on same topic\n3. NEVER REPEAT a question already asked\n\nFOR QUESTION 1 - THE OPENING:\nCreate a warm, role-specific opener. Examples:\n- Developer: \"Hey! What's the most interesting technical problem you've tackled recently?\"\n- PM: \"Hi! What's a product decision you've made recently that you're proud of?\"\n- Designer: \"Hey! I'd love to hear about a design challenge you've worked through lately.\"\n\nOutput ONLY the question (with optional brief connector). Nothing else.\n`);\n\nconst evaluatorPrompt = PromptTemplate.fromTemplate(`\nYou are evaluating a candidate's interview response as a supportive coach.\n\nContext: {interviewType} interview for {targetRole} ({difficulty} level)\n\nQuestion: {question}\n\nAnswer: {answer}\n\nProvide feedback as JSON:\n{{\n  \"score\": <1-10>,\n  \"feedback\": \"<brief, encouraging feedback. Start positive, then 1 actionable tip. 2-3 sentences max.>\",\n  \"strengths\": [\"<specific strength>\", \"<another if applicable>\"],\n  \"improvements\": [\"<one concrete tip>\"],\n  \"projectMentioned\": \"<if they mentioned a specific project, product, or initiative by name, extract it here. Otherwise null>\"\n}}\n\nScoring: 9-10 exceptional, 7-8 strong, 5-6 solid, 3-4 developing, 1-2 needs work\n\nKeep feedback concise and actionable. No fluff.\nRespond with ONLY valid JSON.\n`);\n\nconst reflectionPrompt = PromptTemplate.fromTemplate(`\nYou're {interviewerName}, a human HR recruiter in conversation with a candidate.\n\nTHEIR ANSWER:\n{candidateAnswer}\n\nLAST THING YOU SAID (don't repeat similar phrasing):\n{previousReflection}\n\nRespond with a brief, natural acknowledgment like a real person would.\n\nUSE THESE BRIEF ACKNOWLEDGMENTS:\n- \"Got it.\"\n- \"Thanks for that.\"\n- \"That's helpful.\"\n- \"Makes sense.\"\n- \"Okay.\"\n- \"Nice.\"\n\nOR SLIGHTLY LONGER (if they gave a detailed answer):\n- \"Thanks for sharing that.\"\n- \"That's helpful context.\"\n- Reference ONE specific thing: \"The [X] background makes sense.\"\n\nEXAMPLES FROM REAL HR CONVERSATIONS:\n- \"Thanks, that's helpful.\"\n- \"Great.\"\n- \"That sounds very aligned.\"\n- \"Nice.\"\n- \"That makes sense.\"\n\nNEVER DO:\n- Effusive praise (\"What a fantastic answer!\")\n- Summarize what they said back\n- Sound like a chatbot\n- Use filler phrases\n\nRULE: Keep it to 2-5 words. Be human. Brief is better.\n\nOutput ONLY the acknowledgment. If no acknowledgment fits, output \"\".\n`);\n\nconst followUpPrompt = PromptTemplate.fromTemplate(`\nYou are an interview flow manager deciding the next step.\n\nCurrent Progress:\n- Question {questionIndex} of {totalQuestions}\n- Latest score: {latestScore}/10\n- Average score so far: {averageScore}/10\n- Difficulty: {difficulty}\n\nPrevious Scores: {previousScores}\n\nDecide what to do next and respond with JSON:\n{{\n  \"action\": \"<next_question | follow_up | adjust_difficulty | end_interview>\",\n  \"reason\": \"<brief explanation>\",\n  \"difficultyAdjustment\": \"<easier | harder | same>\"\n}}\n\nGuidelines:\n- If score < 4: Consider a follow-up or easier question\n- If score > 8: Consider a harder question\n- If this is the last question: action should be \"end_interview\"\n- Balance challenge with candidate experience\n\nRespond with ONLY valid JSON.\n`);\n\nconst scoringPrompt = PromptTemplate.fromTemplate(`\nYou are a senior hiring manager generating a final interview report.\n\nInterview Summary:\n- Type: {interviewType}\n- Role: {targetRole}\n- Difficulty: {difficulty}\n- Total Questions: {totalQuestions}\n\nQuestions and Evaluations:\n{questionsAndAnswers}\n\nIndividual Scores: {scores}\nAverage Score: {averageScore}\n\nGenerate a comprehensive final report as JSON:\n{{\n  \"overallScore\": <0-100>,\n  \"communicationScore\": <0-100>,\n  \"technicalScore\": <0-100 or null if not applicable>,\n  \"problemSolvingScore\": <0-100>,\n  \"cultureFitScore\": <0-100>,\n  \"summary\": \"<2-3 sentence overall assessment>\",\n  \"strengths\": [\"<key strength 1>\", \"<key strength 2>\", \"<key strength 3>\"],\n  \"improvements\": [\"<improvement area 1>\", \"<improvement area 2>\"],\n  \"recommendations\": [\"<specific recommendation 1>\", \"<specific recommendation 2>\"],\n  \"hiringDecision\": \"<strong_yes | yes | maybe | no | strong_no>\"\n}}\n\nBe fair, constructive, and specific in your assessment.\nRespond with ONLY valid JSON.\n`);\n\nexport class IntroductionChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      introductionPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig): Promise<string> {\n    const interviewerRole = this.getInterviewerRole(config.interviewType);\n    \n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || this.getDefaultInterviewerName(config.interviewType),\n      interviewerRole,\n      companyName: config.companyName || \"the company\",\n      companyDescription: config.companyDescription || \"A growing technology company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      jobRequirements: config.jobRequirements || \"Standard requirements for this role\",\n      candidateCv: config.candidateCv || \"CV not provided\",\n      interviewType: config.interviewType,\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"HR Recruiter\";\n      case \"technical\":\n        return \"Senior Engineer\";\n      case \"system-design\":\n        return \"Engineering Manager\";\n      case \"case-study\":\n        return \"Product Leader\";\n      default:\n        return \"Hiring Manager\";\n    }\n  }\n\n  private getDefaultInterviewerName(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"Sarah\";\n      case \"technical\":\n        return \"Michael\";\n      case \"system-design\":\n        return \"David\";\n      case \"case-study\":\n        return \"Jennifer\";\n      default:\n        return \"Alex\";\n    }\n  }\n}\n\n// New prelude chains for conversational interview flow\nexport class GreetingChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      greetingPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig, candidateName: string): Promise<string> {\n    const interviewerRole = this.getInterviewerRole(config.interviewType);\n    \n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || this.getDefaultInterviewerName(config.interviewType),\n      interviewerRole,\n      companyName: config.companyName || \"the company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      candidateName,\n      interviewType: config.interviewType,\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"HR Recruiter\";\n      case \"technical\":\n        return \"Senior Engineer\";\n      default:\n        return \"Hiring Manager\";\n    }\n  }\n\n  private getDefaultInterviewerName(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"Sarah\";\n      case \"technical\":\n        return \"Michael\";\n      default:\n        return \"Alex\";\n    }\n  }\n}\n\nexport class IntroExchangeChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      introExchangePrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig, candidateResponse: string): Promise<string> {\n    const interviewerRole = this.getInterviewerRole(config.interviewType);\n    \n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || \"Sarah\",\n      interviewerRole,\n      companyName: config.companyName || \"the company\",\n      candidateResponse,\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"HR Recruiter\";\n      case \"technical\":\n        return \"Senior Engineer\";\n      default:\n        return \"Hiring Manager\";\n    }\n  }\n}\n\nexport class SelfIntroChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      selfIntroPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig): Promise<string> {\n    const interviewerRole = this.getInterviewerRole(config.interviewType);\n    \n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || \"Sarah\",\n      interviewerRole,\n      companyName: config.companyName || \"the company\",\n      companyDescription: config.companyDescription || \"A growing technology company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      jobRequirements: config.jobRequirements || \"Standard requirements for this role\",\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"HR Recruiter\";\n      case \"technical\":\n        return \"Senior Engineer\";\n      default:\n        return \"Hiring Manager\";\n    }\n  }\n}\n\nexport class ReflectionChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      reflectionPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(candidateAnswer: string, previousReflection: string, interviewerName: string = \"Sarah\"): Promise<string> {\n    const result = await this.chain.invoke({\n      candidateAnswer,\n      previousReflection,\n      interviewerName,\n    });\n    \n    return stripThinkingTags(result).trim();\n  }\n}\n\nexport class ClosureChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      closurePrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig, candidateName?: string): Promise<string> {\n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || \"Sarah\",\n      companyName: config.companyName || \"the company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      candidateName: candidateName || \"there\",\n    });\n    return stripThinkingTags(result).trim();\n  }\n}\n\nexport class WrapupChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      wrapupQuestionPrompt,\n      questionModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(config: InterviewConfig): Promise<string> {\n    const result = await this.chain.invoke({\n      interviewerName: config.interviewerName || \"Sarah\",\n      companyName: config.companyName || \"the company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n    });\n    return stripThinkingTags(result).trim();\n  }\n}\n\nexport class QuestionGeneratorChain {\n  private defaultChain: RunnableSequence;\n  private hrChain: RunnableSequence;\n  private technicalChain: RunnableSequence;\n\n  constructor() {\n    this.defaultChain = RunnableSequence.from([\n      questionGeneratorPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n    this.hrChain = RunnableSequence.from([\n      hrScreeningQuestionPrompt,\n      questionModel,\n      new StringOutputParser(),\n    ]);\n    this.technicalChain = RunnableSequence.from([\n      technicalQuestionPrompt,\n      questionModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generate(context: QuestionContext): Promise<string> {\n    const lastAnswer = context.previousAnswers.length > 0 \n      ? context.previousAnswers[context.previousAnswers.length - 1]\n      : \"This is the first question\";\n\n    const config = context.config;\n    const hasJobContext = config.companyName || config.jobRequirements || config.candidateCv;\n    \n    // Use appropriate chain based on interview type and available context\n    if (hasJobContext) {\n      if (config.interviewType === \"behavioral\" || config.interviewType === \"recruiter_call\") {\n        // HR Screening - use HR-specific prompt\n        return this.generateHrQuestion(context, lastAnswer);\n      } else {\n        // Technical/Case Study - use technical prompt\n        return this.generateTechnicalQuestion(context, lastAnswer);\n      }\n    }\n    \n    // Fallback to default prompt for practice mode without job context\n    const result = await this.defaultChain.invoke({\n      interviewType: config.interviewType,\n      targetRole: config.targetRole,\n      difficulty: config.difficulty,\n      questionIndex: context.questionIndex + 1,\n      totalQuestions: config.totalQuestions,\n      previousQuestions: context.previousQuestions.length > 0 \n        ? context.previousQuestions.join(\"\\n- \") \n        : \"None yet - this is the first question\",\n      lastAnswer: lastAnswer,\n      activeProject: context.activeProject || \"No specific project mentioned yet\",\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private async generateHrQuestion(context: QuestionContext, lastAnswer: string): Promise<string> {\n    const config = context.config;\n    const questionNum = context.questionIndex + 1;\n    \n    const cvHighlights = config.candidateCv \n      ? extractCvHighlights(config.candidateCv)\n      : \"No CV provided\";\n    \n    // Use prioritized topic from coverage tracking if available, otherwise use fixed goals\n    const currentGoal = context.prioritizedTopic \n      ? this.getGoalForTopic(context.prioritizedTopic)\n      : this.getHrQuestionGoal(questionNum, config.totalQuestions);\n    \n    // Include full CV context for more natural, personalized questions\n    const candidateCvContext = config.candidateCv || \"CV not provided\";\n    \n    const result = await this.hrChain.invoke({\n      interviewerName: config.interviewerName || \"Sarah\",\n      companyName: config.companyName || \"the company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      targetRole: config.targetRole,\n      cvHighlights: cvHighlights,\n      candidateCv: candidateCvContext,\n      jobRequirements: config.jobRequirements || \"Standard requirements for this role\",\n      questionIndex: questionNum,\n      totalQuestions: config.totalQuestions,\n      previousQuestions: context.previousQuestions.length > 0 \n        ? context.previousQuestions.join(\"\\n- \") \n        : \"None yet - this is the first question\",\n      lastAnswer: lastAnswer || \"N/A (first question)\",\n      currentGoal: currentGoal,\n    });\n    return stripThinkingTags(result).trim();\n  }\n  \n  private getGoalForTopic(topic: 'background' | 'skills' | 'behavioral' | 'motivation' | 'culture_fit' | 'logistics'): string {\n    switch (topic) {\n      case 'background':\n        return `BACKGROUND: We need more information about their professional background.\nAsk about their experience, past roles, or career journey.\nExample: \"I'd love to hear more about your backgroundwhat brought you to this field?\"\nKeep it open-ended.`;\n      \n      case 'skills':\n        return `SKILLS/TECHNICAL FIT: We need to assess their technical capabilities.\nAsk about specific skills mentioned in job requirements or their CV.\nExample: \"You mentioned working with [technology]. Can you tell me more about that experience?\"\nFocus on practical, hands-on experience.`;\n      \n      case 'behavioral':\n        return `BEHAVIORAL: We need examples of how they work with others.\nAsk about collaboration, handling challenges, or team dynamics.\nExample: \"Can you walk me through a time when you had to work through a disagreement with a colleague?\"\nLook for STAR-format answers.`;\n      \n      case 'motivation':\n        return `MOTIVATION: We need to understand what drives them.\nAsk about their interest in this role, career goals, or what excites them.\nExample: \"What attracted you to this opportunity?\" or \"What are you looking for in your next role?\"\nShow genuine interest in their aspirations.`;\n      \n      case 'culture_fit':\n        return `CULTURE FIT: We need to assess team compatibility.\nAsk about work style, preferred environment, or values.\nExample: \"What kind of team environment do you thrive in?\" or \"How do you prefer to receive feedback?\"\nKeep it conversational.`;\n      \n      case 'logistics':\n        return `LOGISTICS: We need practical information.\nAsk about availability, location, or timeline. Pick ONE:\n- \"What's your availability like if we move forward?\"\n- \"Where are you currently based?\"\n- \"What's your timeline looking like?\"\nKeep it brief and respectful.`;\n      \n      default:\n        return `GENERAL: Ask a relevant follow-up based on the conversation so far.`;\n    }\n  }\n  \n  private getHrQuestionGoal(questionNum: number, totalQuestions: number): string {\n    // Adaptive phasing based on total questions\n    // Structure follows Julia's example: Background  Technical Fit  Motivation  Logistics  Wrap-up\n    \n    const lastQuestion = totalQuestions;\n    const secondToLast = totalQuestions - 1;\n    \n    // Always start with background\n    if (questionNum === 1) {\n      return `BACKGROUND: Ask them to tell you about their background and experience. \nExample: \"To get us started, could you tell me a bit about your background?\"\nKeep it open-ended. Let them share their story.`;\n    }\n    \n    // Wrap-up is always the last question\n    if (questionNum === lastQuestion) {\n      return `WRAP-UP: This is the final question. Pick ONE that feels natural:\n- Salary expectations (ask lightly): \"And what are your salary expectations?\"\n- Availability: \"What's your timeline looking like?\"\n- Or simply: \"Is there anything else you'd like to share or ask about the role?\"\nKeep it brief. You're winding down.`;\n    }\n    \n    // Logistics comes second-to-last if there are 5+ questions\n    if (questionNum === secondToLast && totalQuestions >= 5) {\n      return `LOGISTICS: Ask about practical matters. Pick ONE:\n- Location: \"Where are you currently based?\"\n- Work authorization: \"Do you need any visa sponsorship?\"\n- Notice period: \"What's your availability if we move forward?\"\nKeep it simple and respectful.`;\n    }\n    \n    // Motivation comes before logistics\n    if (questionNum === secondToLast - 1 && totalQuestions >= 5) {\n      return `MOTIVATION: Understand what draws them to this opportunity.\nExample: \"I'd love to hearwhat motivated you to explore this role at our company?\"\nOr: \"What are you looking for in your next role?\"\nShow genuine interest in their goals.`;\n    }\n    \n    // Technical fit questions fill the middle\n    // These should adapt based on job requirements and what they've shared\n    if (questionNum === 2) {\n      return `TECHNICAL FIT (Tools): The job involves specific technical skills. Ask about ONE key skill from the requirements.\nExample: \"The team here works heavily with [specific tool/language]. How comfortable are you with that?\"\nReference the job requirements naturally.`;\n    }\n    \n    if (questionNum === 3) {\n      return `TECHNICAL FIT (Experience): Dig deeper into a specific area mentioned in the requirements.\nAsk about hands-on experience with ONE topic: statistical analysis, A/B testing, ML, etc.\nExample: \"The role involves [specific task]. Do you have hands-on experience with that?\"`;\n    }\n    \n    if (questionNum === 4) {\n      return `TECHNICAL FIT (Domain): Ask about domain-specific experience relevant to the role.\nThis could be: time-series work, anomaly detection, forecasting, production ML, etc.\nExample: \"Could you walk me through your experience with [domain area]?\"`;\n    }\n    \n    // For longer interviews, continue exploring fit\n    return `CONTINUED FIT: Continue exploring their experience based on what they've shared.\nOptions:\n- Working with engineers to productionize models\n- Communicating technical results to non-technical stakeholders\n- Collaborative work style\nPick what feels natural given the conversation so far.`;\n  }\n\n  private async generateTechnicalQuestion(context: QuestionContext, lastAnswer: string): Promise<string> {\n    const config = context.config;\n    const interviewTypeFocus = this.getInterviewTypeFocus(config.interviewType);\n    \n    const result = await this.technicalChain.invoke({\n      interviewerName: config.interviewerName || this.getInterviewerName(config.interviewType),\n      interviewerRole: this.getInterviewerRole(config.interviewType),\n      companyName: config.companyName || \"the company\",\n      jobTitle: config.jobTitle || `${config.targetRole} position`,\n      targetRole: config.targetRole,\n      candidateCv: config.candidateCv || \"CV not provided\",\n      jobRequirements: config.jobRequirements || \"Standard requirements for this role\",\n      interviewType: config.interviewType,\n      interviewTypeFocus,\n      questionIndex: context.questionIndex + 1,\n      totalQuestions: config.totalQuestions,\n      previousQuestions: context.previousQuestions.length > 0 \n        ? context.previousQuestions.join(\"\\n- \") \n        : \"None yet - this is the first question\",\n      lastAnswer: lastAnswer,\n      activeProject: context.activeProject || \"No specific project mentioned yet\",\n    });\n    return stripThinkingTags(result).trim();\n  }\n\n  private getInterviewTypeFocus(interviewType: string): string {\n    switch (interviewType) {\n      case \"technical\":\n        return \"Focus on technical skills, coding practices, problem-solving approach, and hands-on experience with relevant technologies.\";\n      case \"system-design\":\n        return \"Focus on architecture decisions, scalability thinking, trade-off analysis, and system design experience.\";\n      case \"case-study\":\n        return \"Focus on analytical thinking, business acumen, structured problem-solving, and communication of complex ideas.\";\n      default:\n        return \"Focus on relevant skills and experience for the role.\";\n    }\n  }\n\n  private getInterviewerName(interviewType: string): string {\n    switch (interviewType) {\n      case \"technical\": return \"Michael\";\n      case \"system-design\": return \"David\";\n      case \"case-study\": return \"Jennifer\";\n      default: return \"Alex\";\n    }\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"technical\": return \"Senior Engineer\";\n      case \"system-design\": return \"Engineering Manager\";\n      case \"case-study\": return \"Product Leader\";\n      default: return \"Hiring Manager\";\n    }\n  }\n}\n\nexport class EvaluatorChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      evaluatorPrompt,\n      evaluatorModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async evaluate(\n    config: InterviewConfig,\n    question: string,\n    answer: string\n  ): Promise<EvaluationResult> {\n    // CRITICAL: Pre-check for non-answers and very short responses\n    // This prevents the LLM from hallucinating content that wasn't there\n    const trimmedAnswer = answer.trim().toLowerCase();\n    const wordCount = answer.trim().split(/\\s+/).length;\n    \n    // Detect non-answers: single words, refusals, or meaningless responses\n    const nonAnswerPatterns = [\n      /^(no|nope|nah|np|n\\/a|na|idk|dunno|nothing|none|skip|pass|next)\\.?$/i,\n      /^not really\\.?$/i,\n      /^i (don'?t|cant|can'?t|won'?t|cannot) (know|say|tell|answer|remember|recall|think of).*$/i,\n      /^(um+|uh+|hmm+|er+|ah+)\\.?$/i,\n    ];\n    \n    const isNonAnswer = nonAnswerPatterns.some(p => p.test(trimmedAnswer));\n    const isTooShort = wordCount <= 3 && !trimmedAnswer.includes(' '); // Single word or very short\n    \n    if (isNonAnswer || (isTooShort && wordCount === 1)) {\n      console.log('[Evaluator] Detected non-answer or too short response:', answer);\n      return {\n        score: 1,\n        feedback: \"Your response was too brief to evaluate. Please provide a detailed answer with specific examples from your experience.\",\n        strengths: [],\n        improvements: [\n          \"Share specific examples from your work\",\n          \"Explain your thought process or approach\",\n          \"Include relevant details and context\"\n        ],\n      };\n    }\n    \n    // Very brief answers (2-5 words) should get low scores\n    if (wordCount <= 5) {\n      console.log('[Evaluator] Very brief response detected:', answer);\n      return {\n        score: 2,\n        feedback: \"Your response was very brief. Consider sharing specific projects, challenges, or accomplishments to demonstrate your experience.\",\n        strengths: [],\n        improvements: [\n          \"Provide more context about your experience\",\n          \"Include specific examples or metrics\",\n          \"Explain the impact of your work\"\n        ],\n      };\n    }\n    \n    const result = await this.chain.invoke({\n      interviewType: config.interviewType,\n      targetRole: config.targetRole,\n      difficulty: config.difficulty,\n      question,\n      answer,\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      return JSON.parse(cleanedResult);\n    } catch (error) {\n      console.error(\"Failed to parse evaluation result:\", result);\n      return {\n        score: 5,\n        feedback: \"Unable to fully evaluate the response.\",\n        strengths: [],\n        improvements: [\"Please provide more detail in your response.\"],\n      };\n    }\n  }\n}\n\nexport class FollowUpChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      followUpPrompt,\n      model,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async decide(\n    config: InterviewConfig,\n    questionIndex: number,\n    latestScore: number,\n    previousScores: number[]\n  ): Promise<FollowUpDecision> {\n    const averageScore = previousScores.length > 0\n      ? previousScores.reduce((a, b) => a + b, 0) / previousScores.length\n      : latestScore;\n\n    const result = await this.chain.invoke({\n      questionIndex: questionIndex + 1,\n      totalQuestions: config.totalQuestions,\n      latestScore,\n      averageScore: averageScore.toFixed(1),\n      difficulty: config.difficulty,\n      previousScores: previousScores.join(\", \") || \"None\",\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      return JSON.parse(cleanedResult);\n    } catch (error) {\n      console.error(\"Failed to parse follow-up decision:\", result);\n      return {\n        action: questionIndex >= config.totalQuestions - 1 ? \"end_interview\" : \"next_question\",\n        reason: \"Proceeding to next step\",\n        difficultyAdjustment: \"same\",\n      };\n    }\n  }\n}\n\nexport class ScoringChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      scoringPrompt,\n      evaluatorModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generateReport(\n    config: InterviewConfig,\n    questionsAndAnswers: Array<{ question: string; answer: string; score: number; feedback: string }>,\n    scores: number[]\n  ): Promise<FinalReport> {\n    const averageScore = scores.reduce((a, b) => a + b, 0) / scores.length;\n    \n    const formattedQA = questionsAndAnswers.map((qa, i) => \n      `Q${i + 1}: ${qa.question}\\nA: ${qa.answer}\\nScore: ${qa.score}/10\\nFeedback: ${qa.feedback}`\n    ).join(\"\\n\\n\");\n\n    const result = await this.chain.invoke({\n      interviewType: config.interviewType,\n      targetRole: config.targetRole,\n      difficulty: config.difficulty,\n      totalQuestions: config.totalQuestions,\n      questionsAndAnswers: formattedQA,\n      scores: scores.join(\", \"),\n      averageScore: averageScore.toFixed(1),\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      return JSON.parse(cleanedResult);\n    } catch (error) {\n      console.error(\"Failed to parse final report:\", result);\n      const scaledScore = Math.round(averageScore * 10);\n      return {\n        overallScore: scaledScore,\n        communicationScore: scaledScore,\n        technicalScore: scaledScore,\n        problemSolvingScore: scaledScore,\n        cultureFitScore: scaledScore,\n        summary: \"Interview completed. Please review individual question feedback for details.\",\n        strengths: [\"Completed the interview\"],\n        improvements: [\"Review individual feedback\"],\n        recommendations: [\"Consider practicing with more mock interviews\"],\n        hiringDecision: scaledScore >= 70 ? \"yes\" : scaledScore >= 50 ? \"maybe\" : \"no\",\n      };\n    }\n  }\n}\n\n// Pre-conversation preparation prompt\nconst preparationPlannerPrompt = PromptTemplate.fromTemplate(`\nYou are an experienced HR recruiter preparing for an interview. Before starting, you review the job requirements and candidate's CV to plan your questions strategically.\n\nJOB TITLE: {jobTitle}\nCOMPANY: {companyName}\n\nJOB REQUIREMENTS:\n{jobRequirements}\n\nCANDIDATE'S CV:\n{candidateCv}\n\nAnalyze this information and create an interview plan. Your goal is to:\n1. Identify the candidate's strengths that match the role\n2. Find areas that need deeper exploration\n3. Note any potential concerns or gaps\n4. Prepare tailored questions that flow naturally\n\nOutput a JSON object with this structure:\n{{\n  \"candidateStrengths\": [\"strength1\", \"strength2\", ...],\n  \"areasToProbe\": [\"area1\", \"area2\", ...],\n  \"potentialConcerns\": [\"concern1\", ...],\n  \"questions\": [\n    {{\n      \"id\": \"q1\",\n      \"question\": \"Your first question - make it natural, not robotic\",\n      \"criterion\": \"background|skills|behavioral|motivation|culture_fit|logistics\",\n      \"priority\": 1,\n      \"rationale\": \"Why you're asking this\",\n      \"desiredDepth\": \"brief|detailed|in-depth\",\n      \"keywords\": [\"keyword1\", \"keyword2\"]\n    }},\n    ...more questions (5-8 total)\n  ]\n}}\n\nIMPORTANT:\n- Questions should feel conversational, not like a checklist\n- Reference specific things from their CV when relevant\n- Include keywords that would indicate the candidate has covered this topic\n- Priority 1 = must ask, Priority 2 = important, Priority 3 = if time permits\n- Balance across criteria: background, skills, behavioral, motivation\n- Always include at least one logistics question (availability/location)\n\nOutput ONLY the JSON object, no other text.\n`);\n\n// Response triage prompt - decides how to proceed after each answer\nconst triagePrompt = PromptTemplate.fromTemplate(`\nYou are an HR recruiter evaluating a candidate's response to decide your next action.\n\nQUESTION ASKED: {questionAsked}\nCANDIDATE'S RESPONSE: {candidateResponse}\n\nREMAINING PLANNED QUESTIONS:\n{remainingQuestions}\n\nAnalyze the response and decide:\n1. Was the answer complete with specific examples/details? (satisfied)  Move to next question\n2. Did they partially answer but miss key aspects? (partial)  Ask targeted follow-up\n3. Was the answer too vague/generic without specifics? (vague)  Probe for concrete example\n4. Did they ask YOU a question? (has_question)  Answer their question first\n5. Did they cover topics from remaining questions? (proactive_coverage)  Acknowledge and skip those\n\nCRITICAL RULES FOR FOLLOW-UPS:\n- NEVER rephrase or repeat the original question\n- For VAGUE: Ask for ONE specific example (\"Can you give me a specific example of that?\")\n- For PARTIAL: Ask about the MISSING piece only (\"You mentioned X, but what about Y?\")\n- Keep follow-ups SHORT (1 sentence, under 20 words)\n\nEXAMPLES:\nOriginal Q: \"Walk me through your experience with model deployment\"\nVague answer: \"I have experience deploying models\"\nBAD follow-up: \"Can you walk me through your experience with model deployment in detail?\"\nGOOD follow-up: \"Can you give me a specific example of a model you deployed?\"\n\nOriginal Q: \"How do you handle stakeholder communication?\"\nPartial answer: \"I create reports and dashboards\"\nBAD follow-up: \"Can you elaborate on how you handle stakeholder communication?\"\nGOOD follow-up: \"How do you handle it when stakeholders disagree with your findings?\"\n\nOutput a JSON object:\n{{\n  \"outcome\": \"satisfied|partial|vague|has_question|proactive_coverage\",\n  \"action\": \"proceed_next|follow_up|answer_then_proceed|acknowledge_coverage\",\n  \"reason\": \"Brief explanation of what's missing or what they asked\",\n  \"followUpPrompt\": \"SHORT, SPECIFIC follow-up (only if partial/vague) - max 20 words\",\n  \"candidateQuestion\": \"The question they asked you (only if has_question)\",\n  \"coveredQuestionIds\": [\"q2\", \"q3\"] or null,\n  \"acknowledgment\": \"Natural acknowledgment for proactive coverage\"\n}}\n\nOutput ONLY the JSON object.\n`);\n\nfunction stripMarkdownCodeBlocks(text: string): string {\n  // First strip Qwen3 thinking tags\n  let cleaned = stripThinkingTags(text);\n  \n  if (cleaned.startsWith('```json')) {\n    cleaned = cleaned.slice(7);\n  } else if (cleaned.startsWith('```')) {\n    cleaned = cleaned.slice(3);\n  }\n  if (cleaned.endsWith('```')) {\n    cleaned = cleaned.slice(0, -3);\n  }\n  return cleaned.trim();\n}\n\nexport class PreparationPlannerChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      preparationPlannerPrompt,\n      questionModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generatePlan(config: InterviewConfig): Promise<InterviewPlan> {\n    const result = await this.chain.invoke({\n      jobTitle: config.jobTitle || config.targetRole,\n      companyName: config.companyName || \"the company\",\n      jobRequirements: config.jobRequirements || \"Standard requirements for this role\",\n      candidateCv: config.candidateCv || \"No CV provided\",\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      const parsed = JSON.parse(cleanedResult);\n      // Ensure all questions have proper status\n      parsed.questions = parsed.questions.map((q: PlannedQuestion) => ({\n        ...q,\n        status: 'pending' as const,\n      }));\n      return parsed;\n    } catch (error) {\n      console.error(\"Failed to parse interview plan:\", result);\n      // Return a minimal default plan\n      return {\n        candidateStrengths: [],\n        areasToProbe: [\"background\", \"skills\", \"motivation\"],\n        potentialConcerns: [],\n        questions: [\n          {\n            id: \"q1\",\n            question: \"Could you tell me a bit about your background?\",\n            criterion: \"background\" as AssessmentCriterion,\n            priority: 1,\n            rationale: \"Opening question to understand their experience\",\n            desiredDepth: \"detailed\" as const,\n            status: \"pending\" as const,\n            keywords: [\"experience\", \"background\", \"worked\", \"role\"],\n          },\n        ],\n      };\n    }\n  }\n}\n\nexport class TriageChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      triagePrompt,\n      questionModel,\n      new StringOutputParser(),\n    ]);\n  }\n\n  async evaluate(\n    questionAsked: string,\n    candidateResponse: string,\n    remainingQuestions: PlannedQuestion[]\n  ): Promise<TriageDecision> {\n    const formattedQuestions = remainingQuestions\n      .map(q => `[${q.id}] ${q.question} (keywords: ${q.keywords.join(\", \")})`)\n      .join(\"\\n\");\n\n    const result = await this.chain.invoke({\n      questionAsked,\n      candidateResponse,\n      remainingQuestions: formattedQuestions || \"No remaining planned questions\",\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      return JSON.parse(cleanedResult);\n    } catch (error) {\n      console.error(\"Failed to parse triage decision:\", result);\n      return {\n        outcome: \"satisfied\",\n        action: \"proceed_next\",\n        reason: \"Proceeding to next question\",\n      };\n    }\n  }\n}\n\n// =============================================================================\n// UNIFIED INTERVIEW TURN CHAIN\n// =============================================================================\n// This replaces the fragmented multi-chain approach (TriageChain, ReflectionChain, \n// QuestionGeneratorChain, EvaluatorChain, FollowUpChain) with a single contextful call\n// per conversation turn. Inspired by the simpler workspace chat architecture that\n// lets the LLM handle natural conversation flow.\n\nexport interface UnifiedTurnInput {\n  interviewerName: string;\n  interviewerRole: string;\n  companyName: string;\n  companyDescription: string;\n  jobTitle: string;\n  jobRequirements: string;\n  candidateName: string;\n  conversationHistory: Array<{ role: 'interviewer' | 'candidate'; content: string }>;\n  questionBacklog: PlannedQuestion[];\n  coverageStatus: {\n    background: number;\n    skills: number;\n    behavioral: number;\n    motivation: number;\n    culture_fit: number;\n    logistics: number;\n  };\n  questionsAskedCount: number;\n  maxQuestions: number;\n  lastQuestionId?: string;\n  // Track consecutive probes on the same criterion to prevent repetitive questioning\n  consecutiveCriterionProbes?: {\n    criterion: string | null;\n    count: number;\n  };\n}\n\nexport interface UnifiedTurnOutput {\n  response: string;\n  actionType: 'continue' | 'follow_up' | 'wrap_up' | 'answer_question';\n  questionId?: string;\n  evaluation: {\n    score: number;\n    strengths: string[];\n    areasToImprove: string[];\n    criterionCovered: AssessmentCriterion;\n    coverageContribution: number;\n  };\n  coveredQuestionIds: string[];\n  candidateAskedQuestion?: boolean;\n  wrapUpReason?: string;\n}\n\nconst unifiedTurnPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a {interviewerRole} at {companyName}, conducting a screening interview.\n\nCONTEXT:\n- Company: {companyName}\n- Job Title: {jobTitle}\n- Candidate: {candidateName}\n- Questions Asked: {questionsAskedCount}/{maxQuestions}\n\nJOB REQUIREMENTS:\n{jobRequirements}\n\nQUESTION BACKLOG (prioritized):\n{questionBacklog}\n\nCURRENT COVERAGE LEVELS (0-1 scale):\n{coverageStatus}\n\nCONVERSATION SO FAR:\n{conversationHistory}\n\n---\n\nThe candidate just responded. As a natural conversationalist, you need to:\n1. Process their response (evaluate quality, extract key information)\n2. Respond naturally (acknowledge if appropriate, then continue)\n3. Decide what to do next (follow-up, new question, or wrap up)\n\nINTERVIEW FLOW GUIDELINES:\n- Short/vague answers: Probe once for specifics, then move on if still vague\n- Good answers: Brief acknowledgment (~30% of time) then next question\n- Detailed answers: Genuine appreciation, then transition\n- Candidate asks question: Answer briefly, then continue with your agenda\n- Near max questions with gaps: Mention time and prioritize key areas\n- Good coverage achieved: Begin natural wrap-up\n\nTOPIC ROTATION RULE (CRITICAL):\n{criterionProbeStatus}\n- NEVER ask more than 2 consecutive questions on the same topic/criterion\n- If you've already probed a topic twice and got limited responses, SWITCH to a different criterion\n- Rotate between: technical skills, behavioral, motivation, culture_fit, logistics\n- Example: After 2 Git questions with vague answers, switch to \"What excites you about this role?\"\n\nNATURAL CONVERSATION RULES:\n- Don't robotically evaluate out loud - be conversational\n- Acknowledgments should be brief and varied: \"That's helpful\", \"I see\", \"Thanks for that\"\n- Transitions should feel natural, not scripted\n- If they covered something from the backlog proactively, note it naturally\n- Match their energy - if they're enthusiastic, reflect that slightly\n\nWRAP-UP CRITERIA (do this when ANY is true):\n- Questions asked >= {maxQuestions} - 1\n- All critical areas (background, skills, motivation) have coverage >= 0.6\n- Candidate seems fatigued or giving consistently short answers\n\nWRAP-UP INSTRUCTIONS:\n- Simply ask \"Do you have any questions for me about the role or the team?\"\n- Do NOT summarize their performance, strengths, or areas for improvement\n- Do NOT give feedback on how they did - that comes later in a separate feedback report\n- Keep it brief and conversational\n\nOUTPUT FORMAT:\nReturn a JSON object with:\n{{\n  \"response\": \"Your natural response as the interviewer\",\n  \"actionType\": \"continue|follow_up|wrap_up|answer_question\",\n  \"questionId\": \"ID of backlog question you're asking (if applicable)\",\n  \"evaluation\": {{\n    \"score\": 1-10,\n    \"strengths\": [\"strength1\", \"strength2\"],\n    \"areasToImprove\": [\"area1\"],\n    \"criterionCovered\": \"background|skills|behavioral|motivation|culture_fit|logistics\",\n    \"coverageContribution\": 0.0-0.3\n  }},\n  \"coveredQuestionIds\": [\"q2\", \"q5\"],\n  \"candidateAskedQuestion\": false,\n  \"wrapUpReason\": \"only if actionType is wrap_up\"\n}}\n\nOutput ONLY valid JSON.\n`);\n\nexport class UnifiedInterviewTurnChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      unifiedTurnPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7, // Slightly higher for more natural conversation\n        topP: 0.95,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n  }\n\n  async processTurn(input: UnifiedTurnInput): Promise<UnifiedTurnOutput> {\n    const formattedHistory = input.conversationHistory\n      .slice(-8) // Keep last 8 exchanges for context\n      .map(msg => `${msg.role === 'interviewer' ? input.interviewerName : input.candidateName}: ${msg.content}`)\n      .join('\\n');\n\n    const formattedBacklog = input.questionBacklog\n      .filter(q => q.status === 'pending')\n      .slice(0, 6) // Show top 6 pending questions\n      .map(q => `[${q.id}] (${q.criterion}, P${q.priority}) ${q.question}`)\n      .join('\\n');\n\n    const formattedCoverage = Object.entries(input.coverageStatus)\n      .map(([key, value]) => `- ${key}: ${(value * 100).toFixed(0)}%`)\n      .join('\\n');\n\n    // Format criterion probe status for topic rotation\n    const probeInfo = input.consecutiveCriterionProbes;\n    const criterionProbeStatus = probeInfo && probeInfo.criterion && probeInfo.count >= 2\n      ? `WARNING: You have asked ${probeInfo.count} consecutive questions about \"${probeInfo.criterion}\". You MUST switch to a different topic now.`\n      : probeInfo && probeInfo.criterion && probeInfo.count === 1\n      ? `Note: Last question was about \"${probeInfo.criterion}\". Consider varying topics if response was limited.`\n      : 'No topic rotation concerns.';\n\n    const result = await this.chain.invoke({\n      interviewerName: input.interviewerName,\n      interviewerRole: input.interviewerRole,\n      companyName: input.companyName,\n      companyDescription: input.companyDescription,\n      jobTitle: input.jobTitle,\n      jobRequirements: input.jobRequirements,\n      candidateName: input.candidateName,\n      conversationHistory: formattedHistory,\n      questionBacklog: formattedBacklog || 'No remaining questions',\n      coverageStatus: formattedCoverage,\n      questionsAskedCount: input.questionsAskedCount,\n      maxQuestions: input.maxQuestions,\n      lastQuestionId: input.lastQuestionId || 'none',\n      criterionProbeStatus,\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      const parsed = JSON.parse(cleanedResult);\n      \n      // Ensure required fields have defaults\n      return {\n        response: parsed.response || \"I appreciate that. Let me ask you something else.\",\n        actionType: parsed.actionType || 'continue',\n        questionId: parsed.questionId,\n        evaluation: {\n          score: parsed.evaluation?.score || 5,\n          strengths: parsed.evaluation?.strengths || [],\n          areasToImprove: parsed.evaluation?.areasToImprove || [],\n          criterionCovered: parsed.evaluation?.criterionCovered || 'background',\n          coverageContribution: parsed.evaluation?.coverageContribution || 0.1,\n        },\n        coveredQuestionIds: parsed.coveredQuestionIds || [],\n        candidateAskedQuestion: parsed.candidateAskedQuestion || false,\n        wrapUpReason: parsed.wrapUpReason,\n      };\n    } catch (error) {\n      console.error(\"Failed to parse unified turn response:\", result);\n      // Fallback response\n      return {\n        response: \"Thank you for sharing that. Could you tell me more about your experience?\",\n        actionType: 'continue',\n        evaluation: {\n          score: 5,\n          strengths: [],\n          areasToImprove: [],\n          criterionCovered: 'background',\n          coverageContribution: 0.1,\n        },\n        coveredQuestionIds: [],\n        candidateAskedQuestion: false,\n      };\n    }\n  }\n}\n","path":null,"size_bytes":66085,"size_tokens":null},"client/src/pages/document-viewer.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useRoute } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Target, \n  Users, \n  Clock, \n  CheckCircle2, \n  ChevronRight,\n  FileCode,\n  FileText\n} from \"lucide-react\";\n\nexport default function DocumentViewer() {\n  const [, params] = useRoute(\"/workspace/:sessionId/document/:docType\");\n  const sessionId = params?.sessionId;\n  const docType = params?.docType;\n\n  const { data: session } = useQuery<any>({\n    queryKey: [`/api/sessions/${sessionId}`],\n    enabled: !!sessionId,\n  });\n\n  const { data: project } = useQuery<any>({\n    queryKey: [`/api/workspace/projects/${(session?.configuration as any)?.projectId}`],\n    enabled: !!session && !!(session?.configuration as any)?.projectId,\n  });\n\n  const requirements = (project?.requirements as any) || {};\n  const productDocumentation = requirements.productDocumentation || {};\n  const featureRequest = requirements.featureRequest || {};\n\n  if (!session || !project) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n        <div className=\"text-gray-500\">Loading document...</div>\n      </div>\n    );\n  }\n\n  const renderDocument = () => {\n    switch (docType) {\n      case 'executive-summary':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Target className=\"h-6 w-6 text-blue-600\" />\n                Executive Summary\n              </CardTitle>\n              <CardDescription>Strategic overview and business context</CardDescription>\n            </CardHeader>\n            <CardContent>\n              <p className=\"text-gray-700 leading-relaxed text-base\">\n                {productDocumentation.executiveSummary}\n              </p>\n            </CardContent>\n          </Card>\n        );\n\n      case 'feature-requirements':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>Feature Requirements</CardTitle>\n              <CardDescription>{featureRequest.title}</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 text-lg\">Business Context</h4>\n                <p className=\"text-gray-700 leading-relaxed\">{featureRequest.businessContext}</p>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 text-lg\">Technical Requirements</h4>\n                <ul className=\"space-y-3\">\n                  {featureRequest.requirements?.map((req: string, idx: number) => (\n                    <li key={idx} className=\"flex items-start gap-3\">\n                      <CheckCircle2 className=\"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0\" />\n                      <span className=\"text-gray-700\">{req}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 text-lg\">Acceptance Criteria</h4>\n                <ul className=\"space-y-3\">\n                  {featureRequest.acceptanceCriteria?.map((criteria: string, idx: number) => (\n                    <li key={idx} className=\"flex items-start gap-3\">\n                      <div className=\"h-5 w-5 rounded border-2 border-gray-400 mt-0.5 flex-shrink-0\" />\n                      <span className=\"text-gray-700\">{criteria}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n        );\n\n      case 'stakeholder-analysis':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Users className=\"h-6 w-6 text-purple-600\" />\n                Stakeholder Analysis\n              </CardTitle>\n              <CardDescription>Key stakeholders, priorities, and success criteria</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.stakeholders?.map((stakeholder: any, idx: number) => (\n                <div key={idx} className=\"border-l-4 border-purple-300 pl-6 py-3\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <div>\n                      <h5 className=\"font-semibold text-gray-900 text-lg\">{stakeholder.name}</h5>\n                      <p className=\"text-gray-600\">{stakeholder.title}</p>\n                    </div>\n                    <Badge variant=\"outline\">{stakeholder.priority}</Badge>\n                  </div>\n                  <div className=\"space-y-3\">\n                    <div>\n                      <span className=\"font-medium text-gray-700\">Concerns:</span>\n                      <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n                        {stakeholder.concerns.map((concern: string, i: number) => (\n                          <li key={i} className=\"text-gray-600\">{concern}</li>\n                        ))}\n                      </ul>\n                    </div>\n                    <div>\n                      <span className=\"font-medium text-gray-700\">Success Metrics:</span>\n                      <ul className=\"list-disc list-inside ml-4 mt-2 space-y-1\">\n                        {stakeholder.successMetrics.map((metric: string, i: number) => (\n                          <li key={i} className=\"text-gray-600\">{metric}</li>\n                        ))}\n                      </ul>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        );\n\n      case 'user-stories':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>User Stories & Personas</CardTitle>\n              <CardDescription>Target users, their goals, and pain points</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.userStories?.map((story: any, idx: number) => (\n                <div key={idx} className=\"bg-blue-50 border border-blue-200 rounded-lg p-6\">\n                  <div className=\"flex items-start gap-4 mb-4\">\n                    <div className=\"w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0\">\n                      <span className=\"text-white font-semibold text-2xl\">{story.persona.charAt(0)}</span>\n                    </div>\n                    <div className=\"flex-1\">\n                      <h5 className=\"font-semibold text-gray-900 text-lg\">{story.persona}</h5>\n                      <p className=\"text-blue-700 font-medium\">{story.goal}</p>\n                    </div>\n                  </div>\n                  <p className=\"text-gray-700 italic mb-3 text-base\">{story.story}</p>\n                  <div className=\"space-y-2\">\n                    <div className=\"flex gap-2\">\n                      <span className=\"font-medium text-gray-700\">Pain Point:</span>\n                      <span className=\"text-gray-600\">{story.painPoint}</span>\n                    </div>\n                    <div className=\"flex gap-2\">\n                      <span className=\"font-medium text-gray-700\">Key Jobs:</span>\n                      <span className=\"text-gray-600\">{story.jobs.join(', ')}</span>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        );\n\n      case 'success-metrics':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Target className=\"h-6 w-6 text-green-600\" />\n                Success Metrics & KPIs\n              </CardTitle>\n              <CardDescription>Measurable outcomes and performance indicators</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.successMetrics?.primary && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2 text-lg\">\n                    <Badge className=\"bg-green-600\">Primary Metrics</Badge>\n                  </h4>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.successMetrics.primary.map((metric: string, idx: number) => (\n                      <li key={idx} className=\"flex items-start gap-3\">\n                        <CheckCircle2 className=\"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0\" />\n                        <span className=\"text-gray-700\">{metric}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n              {productDocumentation.successMetrics?.secondary && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2 text-lg\">\n                    <Badge variant=\"outline\">Secondary Metrics</Badge>\n                  </h4>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.successMetrics.secondary.map((metric: string, idx: number) => (\n                      <li key={idx} className=\"flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        <span className=\"text-gray-600\">{metric}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n              {productDocumentation.successMetrics?.technical && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center gap-2 text-lg\">\n                    <Badge variant=\"outline\" className=\"bg-gray-100\">Technical Metrics</Badge>\n                  </h4>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.successMetrics.technical.map((metric: string, idx: number) => (\n                      <li key={idx} className=\"flex items-start gap-3\">\n                        <FileCode className=\"h-5 w-5 text-gray-500 mt-0.5 flex-shrink-0\" />\n                        <span className=\"text-gray-600\">{metric}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      case 'roadmap-context':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Clock className=\"h-6 w-6 text-orange-600\" />\n                Roadmap Context\n              </CardTitle>\n              <CardDescription>Strategic positioning and timeline</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"bg-orange-50 border border-orange-200 rounded-lg p-4\">\n                <h4 className=\"font-semibold text-gray-900 mb-2 text-lg\">\n                  {productDocumentation.roadmapContext?.quarterlyTheme}\n                </h4>\n                <p className=\"text-gray-700\">{productDocumentation.roadmapContext?.positioning}</p>\n              </div>\n              \n              {productDocumentation.roadmapContext?.dependencies && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3 text-lg\">Dependencies</h4>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.roadmapContext.dependencies.map((dep: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-700 flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-orange-500 mt-0.5 flex-shrink-0\" />\n                        {dep}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {productDocumentation.roadmapContext?.futureEnhancements && (\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-3 text-lg\">Future Enhancements</h4>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.roadmapContext.futureEnhancements.map((enhancement: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-600 flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        {enhancement}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      case 'competitive-analysis':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>Competitive Analysis</CardTitle>\n              <CardDescription>Market positioning and differentiation</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.competitiveAnalysis?.map((comp: any, idx: number) => (\n                <div key={idx} className=\"border rounded-lg p-4 space-y-3\">\n                  <h5 className=\"font-semibold text-gray-900 text-lg\">{comp.competitor}</h5>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <div className=\"bg-gray-50 rounded p-3\">\n                      <span className=\"font-medium text-gray-700\">Their Capability:</span>\n                      <p className=\"text-gray-600 mt-2\">{comp.theirCapability}</p>\n                    </div>\n                    <div className=\"bg-green-50 rounded p-3\">\n                      <span className=\"font-medium text-green-800\">Our Differentiator:</span>\n                      <p className=\"text-green-700 mt-2\">{comp.ourDifferentiator}</p>\n                    </div>\n                  </div>\n                  <div className=\"bg-blue-50 border-l-4 border-blue-400 p-3\">\n                    <span className=\"font-medium text-blue-800\">Gap: </span>\n                    <span className=\"text-blue-700\">{comp.gap}</span>\n                  </div>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        );\n\n      case 'gtm-strategy':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>Go-to-Market Strategy</CardTitle>\n              <CardDescription>Launch plan and market approach</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <div className=\"grid grid-cols-2 gap-6\">\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-2\">Launch Date</h5>\n                  <p className=\"text-gray-700\">{productDocumentation.goToMarketStrategy?.launchDate}</p>\n                </div>\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-2\">Pricing</h5>\n                  <p className=\"text-gray-700\">{productDocumentation.goToMarketStrategy?.pricing}</p>\n                </div>\n              </div>\n\n              <div>\n                <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Target Segment</h5>\n                <p className=\"text-gray-700\">{productDocumentation.goToMarketStrategy?.targetSegment}</p>\n              </div>\n\n              {productDocumentation.goToMarketStrategy?.messagingPillars && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Messaging Pillars</h5>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.goToMarketStrategy.messagingPillars.map((pillar: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-700 flex items-start gap-3\">\n                        <CheckCircle2 className=\"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n                        {pillar}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {productDocumentation.goToMarketStrategy?.salesEnablement && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Sales Enablement</h5>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.goToMarketStrategy.salesEnablement.map((item: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-600 flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        {item}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n\n              {productDocumentation.goToMarketStrategy?.launchActivities && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Launch Activities</h5>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.goToMarketStrategy.launchActivities.map((activity: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-600 flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        {activity}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      case 'risk-assessment':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>Risk Assessment</CardTitle>\n              <CardDescription>Identified risks and mitigation strategies</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.riskAssessment?.map((risk: any, idx: number) => (\n                <div key={idx} className=\"border-l-4 border-red-300 pl-6 py-3\">\n                  <div className=\"flex items-start justify-between mb-3\">\n                    <h5 className=\"font-semibold text-gray-900 text-lg\">{risk.risk}</h5>\n                    <div className=\"flex gap-2\">\n                      <Badge variant=\"outline\">Probability: {risk.probability}</Badge>\n                      <Badge variant=\"outline\">Impact: {risk.impact}</Badge>\n                    </div>\n                  </div>\n                  <p className=\"text-gray-700\">\n                    <span className=\"font-medium\">Mitigation:</span> {risk.mitigation}\n                  </p>\n                </div>\n              ))}\n            </CardContent>\n          </Card>\n        );\n\n      case 'resource-planning':\n        return (\n          <Card>\n            <CardHeader>\n              <CardTitle>Resource Planning</CardTitle>\n              <CardDescription>Team allocation, timeline, and budget</CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              {productDocumentation.resourcePlanning?.teamAllocation && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Team Allocation</h5>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    {Object.entries(productDocumentation.resourcePlanning.teamAllocation).map(([role, allocation]: [string, any]) => (\n                      <div key={role} className=\"bg-gray-50 rounded p-3\">\n                        <span className=\"font-medium text-gray-700 capitalize\">{role}:</span>\n                        <span className=\"text-gray-600 ml-2\">{allocation}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {productDocumentation.resourcePlanning?.timeline && (\n                <div className=\"bg-blue-50 border border-blue-200 rounded p-4\">\n                  <h5 className=\"font-semibold text-gray-900 mb-2 text-lg\">Timeline</h5>\n                  <p className=\"text-gray-700\">{productDocumentation.resourcePlanning.timeline}</p>\n                </div>\n              )}\n\n              {productDocumentation.resourcePlanning?.budget && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Budget</h5>\n                  <div className=\"grid grid-cols-2 gap-3\">\n                    {Object.entries(productDocumentation.resourcePlanning.budget).map(([item, cost]: [string, any]) => (\n                      <div key={item} className=\"flex justify-between bg-gray-50 rounded p-3\">\n                        <span className=\"font-medium text-gray-700 capitalize\">{item}:</span>\n                        <span className=\"text-gray-900 font-semibold\">{cost}</span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {productDocumentation.resourcePlanning?.dependencies && (\n                <div>\n                  <h5 className=\"font-semibold text-gray-900 mb-3 text-lg\">Dependencies</h5>\n                  <ul className=\"space-y-2\">\n                    {productDocumentation.resourcePlanning.dependencies.map((dep: string, idx: number) => (\n                      <li key={idx} className=\"text-gray-700 flex items-start gap-3\">\n                        <ChevronRight className=\"h-5 w-5 text-gray-400 mt-0.5 flex-shrink-0\" />\n                        {dep}\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        );\n\n      default:\n        return (\n          <Card>\n            <CardContent className=\"py-12\">\n              <p className=\"text-center text-gray-500\">Document not found</p>\n            </CardContent>\n          </Card>\n        );\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <div className=\"max-w-4xl mx-auto py-8 px-4\">\n        <div className=\"mb-6\">\n          <div className=\"flex items-center gap-2 text-sm text-gray-600 mb-2\">\n            <FileText className=\"h-4 w-4\" />\n            <span>{project.name}</span>\n          </div>\n          <h1 className=\"text-2xl font-bold text-gray-900\">Product Documentation</h1>\n        </div>\n        \n        {renderDocument()}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":22363,"size_tokens":null},"backend/src/apps/OfferNegotiation/migrations/0001_initial.py":{"content":"# Generated by Django 5.2.8 on 2025-11-23 17:57\n\nimport django.db.models.deletion\nfrom django.db import migrations, models\n\n\nclass Migration(migrations.Migration):\n\n    initial = True\n\n    dependencies = [\n        ('UserProfile', '0001_initial'),\n    ]\n\n    operations = [\n        migrations.CreateModel(\n            name='OfferNegotiationSession',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('session_id', models.CharField(max_length=256, unique=True)),\n                ('creation_date', models.DateTimeField(auto_now_add=True)),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('session_status', models.CharField(choices=[('started', 'Started'), ('done', 'Done')], default='started', max_length=25)),\n                ('initial_offer', models.TextField(blank=True, default='')),\n                ('offer', models.TextField(blank=True, default='')),\n                ('feedback', models.TextField(blank=True, default='')),\n                ('areas_for_improvement', models.TextField(blank=True, default='')),\n                ('career', models.CharField(blank=True, choices=[('dev', 'Software Engineer'), ('dsgnr', 'Designer'), ('pm', 'Project Manager'), ('po', 'Product Owner'), ('mk', 'Marketer'), ('ds', 'Data Scientist'), ('cw', 'Content Writer')], default='dev', max_length=80, null=True)),\n                ('seniority_level', models.CharField(blank=True, choices=[('int', 'Intern'), ('jun', 'Junior'), ('mid', 'Middle'), ('snr', 'Senior')], default='jun', max_length=20, null=True)),\n                ('user', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='offer_negotiations', to='UserProfile.userprofile')),\n            ],\n            options={\n                'verbose_name_plural': '_Offer Negotiation Sessions',\n            },\n        ),\n        migrations.CreateModel(\n            name='NegotiationSessionMessage',\n            fields=[\n                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),\n                ('message_owner_type', models.CharField(choices=[('user', 'User'), ('gpt', 'GPT')], max_length=8)),\n                ('text', models.TextField()),\n                ('creation_date', models.DateTimeField(auto_now_add=True)),\n                ('update_date', models.DateTimeField(auto_now=True)),\n                ('is_greeting', models.BooleanField(default=False)),\n                ('user', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='UserProfile.userprofile')),\n                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='negotiation_messages', to='OfferNegotiation.offernegotiationsession')),\n            ],\n            options={\n                'verbose_name_plural': '_Offer Negotiation message',\n            },\n        ),\n    ]\n","path":null,"size_bytes":2989,"size_tokens":null},"server/services/interview-orchestrator.ts":{"content":"import {\n  QuestionGeneratorChain,\n  EvaluatorChain,\n  FollowUpChain,\n  ScoringChain,\n  IntroductionChain,\n  ReflectionChain,\n  ClosureChain,\n  WrapupChain,\n  GreetingChain,\n  IntroExchangeChain,\n  SelfIntroChain,\n  PreparationPlannerChain,\n  TriageChain,\n  UnifiedInterviewTurnChain,\n  UnifiedTurnInput,\n  UnifiedTurnOutput,\n  InterviewConfig,\n  QuestionContext,\n  EvaluationResult,\n  FollowUpDecision,\n  FinalReport,\n  InterviewStage,\n  InterviewPlan,\n  PlannedQuestion,\n  TriageDecision,\n  StageRuntimeSettings,\n  getInterviewStage,\n  getPreludeStage,\n  shouldGenerateReflection,\n  getStageSettings,\n} from \"./interview-chains\";\n\nconst USE_UNIFIED_CHAIN = true;\nimport { storage } from \"../storage\";\nimport type { InterviewSession, InterviewQuestion } from \"@shared/schema\";\nimport { responseClassifier, CandidateIntent, ClassificationResult } from \"./response-classifier\";\nimport { responseHandler } from \"./response-handler\";\nimport { \n  evaluateCompletion, \n  CompletionDecisionResult, \n  CompletionAction,\n  generatePacingNotice,\n  getWrapUpMessage,\n  getStageRuntimeConfig,\n  StageRuntimeConfig\n} from \"./completion-decision\";\nimport { \n  TeamInterviewTurnChain, \n  TeamInterviewGreetingChain,\n  TeamInterviewWrapUpChain,\n  getTeamInterviewSettings,\n  getLevelExpectationsText,\n} from \"./team-interview-chain\";\nimport { \n  selectQuestionsForInterview,\n  TeamInterviewQuestion,\n} from \"./team-interview-questions\";\nimport { \n  ExperienceLevel,\n  TeamInterviewSettings,\n  TeamInterviewPersona,\n  TEAM_INTERVIEW_PRESETS,\n} from \"@shared/schema\";\n\nexport interface JobContext {\n  companyName?: string;\n  companyDescription?: string;\n  jobTitle?: string;\n  jobRequirements?: string;\n  candidateCv?: string;\n}\n\n// Assessment criteria for dynamic interview completion\nexport type AssessmentCriterion = \n  | 'background'      // Professional background & roles\n  | 'skills'          // Core competencies vs. role requirements\n  | 'behavioral'      // Behavioral & collaboration examples\n  | 'motivation'      // Motivation & career goals\n  | 'culture_fit'     // Cultural/team fit\n  | 'logistics';      // Availability, salary, visa status\n\ninterface CoverageScore {\n  score: number;        // 0-1 coverage level\n  notes: string[];      // Key points gathered\n  questionsAsked: number;\n}\n\ninterface CoverageTracker {\n  background: CoverageScore;\n  skills: CoverageScore;\n  behavioral: CoverageScore;\n  motivation: CoverageScore;\n  culture_fit: CoverageScore;\n  logistics: CoverageScore;\n}\n\n// Thresholds for determining interview sufficiency\nconst SUFFICIENCY_CONFIG = {\n  maxQuestions: 15,              // Hard limit\n  timeWarningThreshold: 0.75,    // Warn at 75% of max questions\n  criticalThreshold: 0.6,        // Minimum coverage for critical areas\n  overallThreshold: 0.7,         // Overall sufficiency threshold\n  criticalAreas: ['background', 'skills', 'motivation'] as AssessmentCriterion[],\n};\n\n// Session telemetry for dynamic interview flow\ninterface SessionTelemetry {\n  startedAt: number;            // Unix timestamp when interview started\n  firstQuestionAt?: number;     // Unix timestamp when first core question was asked\n  followUpsUsed: number;        // Number of follow-up questions asked\n  lowScoreStreak: number;       // Consecutive answers with score < 4\n  highScoreStreak: number;      // Consecutive answers with score >= 8\n  avgConfidence: number;        // Running average of evaluator confidence\n}\n\ninterface ConversationMemory {\n  questions: string[];\n  answers: string[];\n  scores: number[];\n  evaluations: EvaluationResult[];\n  activeProject: string | null;\n  projectMentionCount: number;\n  jobContext?: JobContext;\n  lastReflection: string;\n  currentStage: InterviewStage;\n  preludeStep: number; // 0 = greeting, 1 = intro exchange, 2 = self-intro, 3+ = questions\n  preludeResponses: string[]; // Store candidate's prelude responses\n  candidateName?: string;\n  candidateWentFirst?: boolean; // Track if candidate introduced themselves first\n  awaitingCandidateIntro?: boolean; // Waiting for candidate to share their intro\n  lastQuestionAsked?: string; // Track the last question for response classification\n  lastCandidateIntent?: CandidateIntent; // Last classified intent\n  // Dynamic interview completion tracking\n  coverage: CoverageTracker;\n  totalQuestionsAsked: number;\n  timeWarningGiven: boolean;\n  // Pre-planned interview structure\n  interviewPlan?: InterviewPlan;\n  currentQuestionId?: string; // ID of the question currently being asked\n  pendingFollowUp?: string; // Follow-up question to ask if response was partial/vague\n  pendingCandidateQuestion?: string; // Question the candidate asked that needs answering\n  // Session telemetry for dynamic completion\n  telemetry: SessionTelemetry;\n  // Track question repeats to prevent infinite loops (max 2 repeats before moving on)\n  currentQuestionRepeatCount: number;\n  // Track consecutive minimal/negative responses to force topic change\n  consecutiveMinimalResponses: number;\n  // Flag to force switching to a completely different topic after repeated refusals\n  forceTopicSwitch?: boolean;\n  // Track consecutive follow-ups on the same criterion to prevent repetitive questioning\n  consecutiveCriterionProbes: {\n    criterion: AssessmentCriterion | null;\n    count: number;\n  };\n  // Unified chain: conversation history for context\n  conversationHistory: Array<{ role: 'interviewer' | 'candidate'; content: string; personaId?: string }>;\n  // Team interview specific fields\n  isTeamInterview?: boolean;\n  teamSettings?: import('@shared/schema').TeamInterviewSettings;\n  activePersonaId?: string;\n  personaQuestionCounts?: Record<string, number>;\n  teamQuestionBacklog?: import('./team-interview-questions').TeamInterviewQuestion[];\n  questionBacklog?: import('./team-interview-questions').TeamInterviewQuestion[]; // Alias for consistency\n  askedQuestionIds?: Set<string>; // Track which questions have been asked to prevent repetition\n  forcedNextPersonaId?: string; // Force next turn to go to this persona (e.g., when addressed by name)\n  consecutivePersonaTurns?: Record<string, number>; // Track consecutive turns per persona for handoff cooldown\n  // Two-phase wrap-up: Wait for candidate response to \"any questions?\" before finalizing\n  pendingWrapUp?: {\n    wrapUpReason: string;\n    timestamp: number;\n    closurePromptAsked: boolean; // True if we asked \"any questions?\"\n  };\n}\n\nexport class InterviewOrchestrator {\n  private questionGenerator: QuestionGeneratorChain;\n  private evaluator: EvaluatorChain;\n  private followUp: FollowUpChain;\n  private scoring: ScoringChain;\n  private introduction: IntroductionChain;\n  private reflection: ReflectionChain;\n  private closure: ClosureChain;\n  private wrapup: WrapupChain;\n  private greeting: GreetingChain;\n  private introExchange: IntroExchangeChain;\n  private selfIntro: SelfIntroChain;\n  private preparationPlanner: PreparationPlannerChain;\n  private triage: TriageChain;\n  private unifiedTurn: UnifiedInterviewTurnChain;\n  private teamTurn: TeamInterviewTurnChain;\n  private teamGreeting: TeamInterviewGreetingChain;\n  private teamWrapUp: TeamInterviewWrapUpChain;\n  private memory: Map<number, ConversationMemory>;\n\n  constructor() {\n    this.questionGenerator = new QuestionGeneratorChain();\n    this.evaluator = new EvaluatorChain();\n    this.followUp = new FollowUpChain();\n    this.scoring = new ScoringChain();\n    this.introduction = new IntroductionChain();\n    this.reflection = new ReflectionChain();\n    this.closure = new ClosureChain();\n    this.wrapup = new WrapupChain();\n    this.greeting = new GreetingChain();\n    this.introExchange = new IntroExchangeChain();\n    this.selfIntro = new SelfIntroChain();\n    this.preparationPlanner = new PreparationPlannerChain();\n    this.triage = new TriageChain();\n    this.unifiedTurn = new UnifiedInterviewTurnChain();\n    this.teamTurn = new TeamInterviewTurnChain();\n    this.teamGreeting = new TeamInterviewGreetingChain();\n    this.teamWrapUp = new TeamInterviewWrapUpChain();\n    this.memory = new Map();\n  }\n\n  private initializeCoverage(): CoverageTracker {\n    const emptyCoverage = (): CoverageScore => ({\n      score: 0,\n      notes: [],\n      questionsAsked: 0,\n    });\n    return {\n      background: emptyCoverage(),\n      skills: emptyCoverage(),\n      behavioral: emptyCoverage(),\n      motivation: emptyCoverage(),\n      culture_fit: emptyCoverage(),\n      logistics: emptyCoverage(),\n    };\n  }\n\n  private initializeTelemetry(): SessionTelemetry {\n    return {\n      startedAt: Date.now(),\n      followUpsUsed: 0,\n      lowScoreStreak: 0,\n      highScoreStreak: 0,\n      avgConfidence: 0,\n    };\n  }\n\n  private getMemory(sessionId: number): ConversationMemory {\n    if (!this.memory.has(sessionId)) {\n      this.memory.set(sessionId, {\n        questions: [],\n        answers: [],\n        scores: [],\n        evaluations: [],\n        activeProject: null,\n        projectMentionCount: 0,\n        lastReflection: \"None yet\",\n        currentStage: \"greeting\",\n        preludeStep: 0,\n        coverage: this.initializeCoverage(),\n        totalQuestionsAsked: 0,\n        timeWarningGiven: false,\n        preludeResponses: [],\n        telemetry: this.initializeTelemetry(),\n        currentQuestionRepeatCount: 0,\n        consecutiveMinimalResponses: 0,\n        consecutiveCriterionProbes: { criterion: null, count: 0 },\n        conversationHistory: [],\n      });\n    }\n    return this.memory.get(sessionId)!;\n  }\n\n  private getConfig(session: InterviewSession, jobContext?: JobContext): InterviewConfig {\n    return {\n      interviewType: session.interviewType,\n      targetRole: session.targetRole,\n      difficulty: session.difficulty,\n      totalQuestions: session.totalQuestions,\n      companyName: jobContext?.companyName,\n      companyDescription: jobContext?.companyDescription,\n      jobTitle: jobContext?.jobTitle,\n      jobRequirements: jobContext?.jobRequirements,\n      candidateCv: jobContext?.candidateCv,\n      stageSettings: getStageSettings(session.interviewType),\n    };\n  }\n\n  private mapDifficultyToLevel(difficulty: string): ExperienceLevel {\n    const mapping: Record<string, ExperienceLevel> = {\n      'easy': 'intern',\n      'intern': 'intern',\n      'junior': 'junior',\n      'medium': 'junior',\n      'mid': 'mid',\n      'senior': 'senior',\n      'hard': 'senior',\n      'lead': 'lead',\n      'expert': 'lead',\n    };\n    return mapping[difficulty.toLowerCase()] || 'junior';\n  }\n\n  /**\n   * Classify which assessment criteria a question/answer pair covers\n   */\n  private classifyQuestionCriteria(question: string, answer: string): AssessmentCriterion[] {\n    const criteria: AssessmentCriterion[] = [];\n    const lowerQ = question.toLowerCase();\n    const lowerA = answer.toLowerCase();\n    const combined = lowerQ + ' ' + lowerA;\n\n    // Background: experience, roles, career history\n    if (/background|experience|career|role|position|previous|worked at|company|years/i.test(combined)) {\n      criteria.push('background');\n    }\n\n    // Skills: technical abilities, competencies, tools\n    if (/skill|technical|technology|tool|framework|proficient|expert|knowledge|ability|capable/i.test(combined)) {\n      criteria.push('skills');\n    }\n\n    // Behavioral: teamwork, challenges, examples, situations\n    if (/team|collaborate|challenge|difficult|situation|example|time when|how did you|conflict|problem/i.test(combined)) {\n      criteria.push('behavioral');\n    }\n\n    // Motivation: why this role/company, goals, interests\n    if (/why|interest|motivat|goal|passion|excit|drawn|appeal|looking for/i.test(combined)) {\n      criteria.push('motivation');\n    }\n\n    // Culture fit: values, work style, team dynamics\n    if (/culture|value|work style|environment|prefer|ideal|team dynamic|diversity|remote|office/i.test(combined)) {\n      criteria.push('culture_fit');\n    }\n\n    // Logistics: availability, salary, visa, location\n    if (/availab|start|notice|salary|compensation|expect|visa|relocat|location|timeline/i.test(combined)) {\n      criteria.push('logistics');\n    }\n\n    // If no specific criteria detected, default to background (general info)\n    return criteria.length > 0 ? criteria : ['background'];\n  }\n\n  /**\n   * Calculate coverage delta based on answer quality\n   */\n  private calculateCoverageDelta(answer: string, score: number): number {\n    const wordCount = answer.split(/\\s+/).length;\n    \n    // Base delta from score (0-10  0-0.3)\n    const scoreDelta = (score / 10) * 0.3;\n    \n    // Length bonus (longer, more detailed answers contribute more)\n    const lengthBonus = Math.min(wordCount / 100, 0.2); // Max 0.2 bonus for 100+ words\n    \n    // Combine for total delta (max ~0.5 per answer)\n    return Math.min(scoreDelta + lengthBonus, 0.5);\n  }\n\n  /**\n   * Update coverage scores based on a question/answer pair\n   */\n  private updateCoverage(\n    memory: ConversationMemory,\n    question: string,\n    answer: string,\n    score: number\n  ): void {\n    const criteria = this.classifyQuestionCriteria(question, answer);\n    const delta = this.calculateCoverageDelta(answer, score);\n    \n    for (const criterion of criteria) {\n      const coverage = memory.coverage[criterion];\n      // Update score with diminishing returns (cap at 1.0)\n      coverage.score = Math.min(coverage.score + delta / criteria.length, 1.0);\n      coverage.questionsAsked++;\n      \n      // Extract a brief note about what was covered\n      const firstSentence = answer.split(/[.!?]/)[0].trim();\n      if (firstSentence.length > 10 && firstSentence.length < 200) {\n        coverage.notes.push(firstSentence);\n      }\n    }\n  }\n\n  /**\n   * Calculate overall interview sufficiency\n   */\n  private calculateSufficiency(memory: ConversationMemory): {\n    overall: number;\n    criticalMet: boolean;\n    gaps: AssessmentCriterion[];\n    prioritizedGaps: AssessmentCriterion[];\n  } {\n    const coverage = memory.coverage;\n    \n    // Calculate overall average\n    const scores = Object.values(coverage).map(c => c.score);\n    const overall = scores.reduce((a, b) => a + b, 0) / scores.length;\n    \n    // Check critical areas\n    const criticalMet = SUFFICIENCY_CONFIG.criticalAreas.every(\n      area => coverage[area].score >= SUFFICIENCY_CONFIG.criticalThreshold\n    );\n    \n    // Find gaps (areas below threshold)\n    const gaps: AssessmentCriterion[] = [];\n    const allCriteria: AssessmentCriterion[] = ['background', 'skills', 'behavioral', 'motivation', 'culture_fit', 'logistics'];\n    \n    for (const criterion of allCriteria) {\n      if (coverage[criterion].score < SUFFICIENCY_CONFIG.criticalThreshold) {\n        gaps.push(criterion);\n      }\n    }\n    \n    // Prioritize gaps: critical areas first, then by lowest score\n    const prioritizedGaps = [...gaps].sort((a, b) => {\n      const aIsCritical = SUFFICIENCY_CONFIG.criticalAreas.includes(a);\n      const bIsCritical = SUFFICIENCY_CONFIG.criticalAreas.includes(b);\n      if (aIsCritical !== bIsCritical) return aIsCritical ? -1 : 1;\n      return coverage[a].score - coverage[b].score;\n    });\n    \n    return { overall, criticalMet, gaps, prioritizedGaps };\n  }\n\n  /**\n   * Determine if the interview should wrap up based on coverage sufficiency\n   * Now uses the CompletionDecision engine for dynamic, time-based decisions\n   */\n  private shouldWrapUp(memory: ConversationMemory, config?: InterviewConfig): {\n    shouldEnd: boolean;\n    reason: 'sufficient' | 'max_reached' | 'time_pressure' | 'continue';\n    message?: string;\n    pacing?: CompletionDecisionResult['pacing'];\n    prioritizedTopic?: AssessmentCriterion;\n  } {\n    // Get stage settings from config or use defaults\n    const stageSettings = config?.stageSettings || getStageSettings('hr_screening');\n    \n    // Calculate average score\n    const avgScore = memory.scores.length > 0 \n      ? memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length \n      : 5;\n    \n    // Count pending questions in backlog\n    const pendingBacklogCount = memory.interviewPlan?.questions\n      .filter(q => q.status === 'pending').length || 0;\n    \n    // Use the completion decision engine\n    const decision = evaluateCompletion({\n      coverage: memory.coverage,\n      telemetry: memory.telemetry,\n      questionsAsked: memory.totalQuestionsAsked,\n      stageSettings,\n      pendingBacklogCount,\n      avgScore\n    });\n    \n    // Map the new decision format to the existing return type\n    if (decision.action.type === 'wrap_up') {\n      const reasonMap: Record<string, 'sufficient' | 'max_reached' | 'time_pressure'> = {\n        'sufficient_coverage': 'sufficient',\n        'high_confidence_positive': 'sufficient',\n        'high_confidence_negative': 'sufficient',\n        'time_limit': 'time_pressure',\n        'max_questions': 'max_reached',\n        'candidate_fatigue': 'max_reached'\n      };\n      \n      return {\n        shouldEnd: true,\n        reason: reasonMap[decision.action.reason] || 'sufficient',\n        message: decision.action.message || getWrapUpMessage(decision.action.reason),\n        pacing: decision.pacing\n      };\n    }\n    \n    if (decision.action.type === 'prioritize') {\n      // Time pressure with topic prioritization\n      if (!memory.timeWarningGiven) {\n        memory.timeWarningGiven = true;\n      }\n      return {\n        shouldEnd: false,\n        reason: 'time_pressure',\n        message: decision.action.reason,\n        pacing: decision.pacing,\n        prioritizedTopic: decision.action.topic\n      };\n    }\n    \n    // Continue normally\n    return { \n      shouldEnd: false, \n      reason: 'continue',\n      pacing: decision.pacing\n    };\n  }\n  \n  /**\n   * Update telemetry after each answer is scored\n   */\n  private updateTelemetry(memory: ConversationMemory, score: number): void {\n    const { telemetry } = memory;\n    \n    // Update score streaks\n    if (score < 4) {\n      telemetry.lowScoreStreak++;\n      telemetry.highScoreStreak = 0;\n    } else if (score >= 8) {\n      telemetry.highScoreStreak++;\n      telemetry.lowScoreStreak = 0;\n    } else {\n      // Reset streaks for mid-range scores\n      telemetry.lowScoreStreak = 0;\n      telemetry.highScoreStreak = 0;\n    }\n    \n    // Track first question time\n    if (!telemetry.firstQuestionAt && memory.totalQuestionsAsked === 1) {\n      telemetry.firstQuestionAt = Date.now();\n    }\n  }\n  \n  /**\n   * Calculate pacing info for frontend display\n   */\n  private getPacingInfo(memory: ConversationMemory, config: StageRuntimeConfig): {\n    elapsedMinutes: number;\n    progressPercent: number;\n    status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n  } {\n    const { telemetry } = memory;\n    const elapsedMs = Date.now() - telemetry.startedAt;\n    const elapsedMinutes = Math.floor(elapsedMs / 60000);\n    \n    const { minTimeMinutes, maxTimeMinutes } = config;\n    const targetTime = (minTimeMinutes + maxTimeMinutes) / 2;\n    \n    // Calculate progress as percentage of target time\n    const progressPercent = Math.min(100, Math.round((elapsedMinutes / targetTime) * 100));\n    \n    // Determine status based on time\n    let status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n    if (elapsedMinutes < 3) {\n      status = 'starting';\n    } else if (elapsedMinutes < minTimeMinutes * 0.5) {\n      status = 'on_track';\n    } else if (elapsedMinutes < minTimeMinutes * 0.85) {\n      status = 'mid_interview';\n    } else if (elapsedMinutes < maxTimeMinutes) {\n      status = 'wrapping_soon';\n    } else {\n      status = 'overtime';\n    }\n    \n    return { elapsedMinutes, progressPercent, status };\n  }\n\n  /**\n   * Evaluate team interview completion using coverage-based logic (similar to HR screening)\n   * This mirrors the HR screening approach with team-specific considerations\n   */\n  private evaluateTeamCompletion(\n    memory: ConversationMemory,\n    settings: TeamInterviewSettings,\n    turnResult: { actionType: string; evaluation: { score: number } }\n  ): {\n    shouldWrapUp: boolean;\n    reason: string;\n    message: string;\n    coverageSummary: { overall: number; critical: number };\n  } {\n    const { maxQuestions } = settings;\n    // minQuestions is derived: at least half of maxQuestions for coverage-based wrap-up\n    const minQuestions = Math.ceil(maxQuestions / 2);\n    const questionsAsked = memory.totalQuestionsAsked;\n    \n    // Calculate team-specific coverage (using team interview criteria mapping)\n    const coverageStatus = {\n      learning_mindset: memory.coverage.behavioral.score,\n      collaboration: memory.coverage.culture_fit.score,\n      problem_solving: memory.coverage.skills.score,\n      technical_foundations: memory.coverage.background.score,\n    };\n    \n    const coverageValues = Object.values(coverageStatus);\n    const overallCoverage = coverageValues.reduce((a, b) => a + b, 0) / coverageValues.length;\n    const criticalCoverage = (coverageStatus.learning_mindset + coverageStatus.collaboration) / 2;\n    \n    // Calculate average score\n    const avgScore = memory.scores.length > 0 \n      ? memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length \n      : 5;\n    \n    // Check persona participation (both should have spoken at least once)\n    const personaCounts = memory.personaQuestionCounts || {};\n    const allPersonasParticipated = settings.personas.every(p => (personaCounts[p.id] || 0) > 0);\n    \n    // Telemetry: track score streaks\n    const { telemetry } = memory;\n    \n    // Define thresholds (aligned with HR screening's completion-decision.ts)\n    // Team interviews are shorter, so thresholds are slightly lower than HR's 0.5/0.6\n    // These thresholds ensure we don't wrap up until collaboration/learning criteria are covered\n    const overallSufficiencyThreshold = 0.35; // 35% overall coverage (HR uses 0.5)\n    const criticalSufficiencyThreshold = 0.40; // 40% for critical areas - collaboration/learning mindset (HR uses 0.6)\n    const minCategoryThreshold = 0.20; // 20% minimum coverage per category (aligned with prompt guidance)\n    const minQuestionsForWrapUp = minQuestions || 4;\n    \n    // Check if all categories have at least minimum coverage\n    const allCategoriesCovered = Object.values(coverageStatus).every(v => v >= minCategoryThreshold);\n    \n    // 1. Hard limit: Max questions exceeded (failsafe, +1 buffer)\n    if (questionsAsked > maxQuestions) {\n      return {\n        shouldWrapUp: true,\n        reason: 'max_questions_exceeded',\n        message: \"We've covered a lot of ground today\",\n        coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n      };\n    }\n    \n    // 2. Candidate fatigue: Too many consecutive low scores (3+)\n    if (telemetry.lowScoreStreak >= 3 && questionsAsked >= minQuestionsForWrapUp) {\n      return {\n        shouldWrapUp: true,\n        reason: 'candidate_fatigue',\n        message: \"I think we have a good sense of your background\",\n        coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n      };\n    }\n    \n    // 3. High confidence negative: Low average and consistent pattern\n    if (avgScore < 4 && questionsAsked >= minQuestionsForWrapUp && telemetry.lowScoreStreak >= 2) {\n      return {\n        shouldWrapUp: true,\n        reason: 'high_confidence_negative',\n        message: \"We appreciate you taking the time to speak with us today\",\n        coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n      };\n    }\n    \n    // 4. High confidence positive: Excellent performance with sufficient coverage\n    // Requires BOTH overall AND critical coverage thresholds to be met, AND all categories touched\n    if (avgScore >= 8 && telemetry.highScoreStreak >= 2 && questionsAsked >= minQuestionsForWrapUp) {\n      if (overallCoverage >= overallSufficiencyThreshold && \n          criticalCoverage >= criticalSufficiencyThreshold && \n          allCategoriesCovered &&\n          allPersonasParticipated) {\n        return {\n          shouldWrapUp: true,\n          reason: 'high_confidence_positive',\n          message: \"We're really impressed with what you've shared\",\n          coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n        };\n      }\n    }\n    \n    // 5. Sufficient coverage: Met BOTH thresholds + min questions + all personas participated + all categories touched\n    if (questionsAsked >= minQuestionsForWrapUp &&\n        overallCoverage >= overallSufficiencyThreshold &&\n        criticalCoverage >= criticalSufficiencyThreshold &&\n        allCategoriesCovered &&\n        allPersonasParticipated) {\n      return {\n        shouldWrapUp: true,\n        reason: 'sufficient_coverage',\n        message: \"We have a great picture of your experience\",\n        coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n      };\n    }\n    \n    // 6. Approaching max with good coverage (soft wrap-up)\n    // Requires FULL thresholds AND persona participation AND all categories touched - no shortcuts\n    if (questionsAsked >= maxQuestions - 1 && \n        overallCoverage >= overallSufficiencyThreshold &&\n        criticalCoverage >= criticalSufficiencyThreshold &&\n        allCategoriesCovered &&\n        allPersonasParticipated) {\n      return {\n        shouldWrapUp: true,\n        reason: 'approaching_max_with_coverage',\n        message: \"We've covered the key areas we wanted to discuss\",\n        coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n      };\n    }\n    \n    // 7. Default: Continue\n    return {\n      shouldWrapUp: false,\n      reason: 'continue',\n      message: '',\n      coverageSummary: { overall: overallCoverage, critical: criticalCoverage }\n    };\n  }\n\n  /**\n   * Get the next question topic based on coverage gaps\n   */\n  private getPrioritizedTopic(memory: ConversationMemory): AssessmentCriterion | null {\n    const sufficiency = this.calculateSufficiency(memory);\n    return sufficiency.prioritizedGaps[0] || null;\n  }\n\n  /**\n   * Get the next pending question from the interview plan\n   */\n  private getNextPlannedQuestion(memory: ConversationMemory): PlannedQuestion | null {\n    if (!memory.interviewPlan) return null;\n    \n    // Sort by priority and get first pending question\n    const pendingQuestions = memory.interviewPlan.questions\n      .filter(q => q.status === 'pending')\n      .sort((a, b) => a.priority - b.priority);\n    \n    return pendingQuestions[0] || null;\n  }\n\n  /**\n   * Get all remaining questions that haven't been asked or covered\n   */\n  private getRemainingQuestions(memory: ConversationMemory): PlannedQuestion[] {\n    if (!memory.interviewPlan) return [];\n    return memory.interviewPlan.questions.filter(q => q.status === 'pending');\n  }\n\n  /**\n   * Mark a question as asked\n   */\n  private markQuestionAsked(memory: ConversationMemory, questionId: string): void {\n    if (!memory.interviewPlan) return;\n    const question = memory.interviewPlan.questions.find(q => q.id === questionId);\n    if (question) {\n      question.status = 'asked';\n    }\n    memory.currentQuestionId = questionId;\n  }\n\n  /**\n   * Mark questions as proactively covered by the candidate\n   */\n  private markQuestionsAsCovered(memory: ConversationMemory, questionIds: string[]): void {\n    if (!memory.interviewPlan) return;\n    for (const id of questionIds) {\n      const question = memory.interviewPlan.questions.find(q => q.id === id);\n      if (question) {\n        question.status = 'covered_proactively';\n      }\n    }\n  }\n\n  /**\n   * Generate a natural acknowledgment when candidate covers planned questions\n   */\n  private generateProactiveCoverageAck(coveredQuestions: PlannedQuestion[]): string {\n    const acks = [\n      \"That's great - you actually touched on something I was planning to ask about.\",\n      \"Perfect, that answers what I was going to ask next.\",\n      \"You're ahead of me - I was curious about that exact thing.\",\n      \"Excellent, you've covered what was next on my list.\",\n      \"That's helpful - you've addressed what I wanted to explore.\",\n    ];\n    return acks[Math.floor(Math.random() * acks.length)];\n  }\n\n  async startInterview(\n    userId: number,\n    interviewType: string,\n    targetRole: string,\n    difficulty: string = \"medium\",\n    totalQuestions: number = 5,\n    jobContext?: JobContext,\n    candidateName?: string,\n    mode: 'practice' | 'journey' = 'practice',\n    applicationStageId?: number\n  ): Promise<{ \n    session: InterviewSession; \n    firstQuestion?: InterviewQuestion; \n    greeting?: string;\n    introduction?: string;\n    isPreludeMode?: boolean;\n    isTeamInterview?: boolean;\n    teamPersonas?: Array<{ id: string; name: string; role: string; displayRole: string }>;\n    activePersonaId?: string;\n  }> {\n    const session = await storage.createInterviewSession({\n      userId,\n      interviewType,\n      targetRole,\n      difficulty,\n      totalQuestions,\n      status: \"in_progress\",\n      currentQuestionIndex: 0,\n      mode,\n      applicationStageId: applicationStageId || null,\n    });\n\n    const config = this.getConfig(session, jobContext);\n    const memory = this.getMemory(session.id);\n    \n    // Store job context in memory for use in subsequent questions\n    if (jobContext) {\n      memory.jobContext = jobContext;\n    }\n    \n    // Store candidate name for personalized greeting\n    if (candidateName) {\n      memory.candidateName = candidateName;\n    }\n\n    // Check if this is a team interview (both 'team' and 'panel' use multi-persona interviews)\n    // Note: panel is treated as an alias for team interviews - they share the same persona configuration\n    const isTeamInterview = interviewType === \"team\" || interviewType === \"panel\";\n    \n    if (isTeamInterview && jobContext?.companyName && candidateName) {\n      // Get seniority from difficulty (maps to experience level)\n      const experienceLevel = this.mapDifficultyToLevel(difficulty);\n      const teamSettings = getTeamInterviewSettings(experienceLevel);\n      \n      console.log('[Team Interview] Starting with settings:', {\n        experienceLevel,\n        personas: teamSettings.personas.map(p => p.name),\n        maxQuestions: teamSettings.maxQuestions,\n      });\n      \n      // Initialize team interview memory\n      memory.isTeamInterview = true;\n      memory.teamSettings = teamSettings;\n      memory.activePersonaId = teamSettings.personas[0].id;\n      memory.personaQuestionCounts = {};\n      teamSettings.personas.forEach(p => {\n        memory.personaQuestionCounts![p.id] = 0;\n      });\n      \n      // Select level-appropriate questions\n      memory.teamQuestionBacklog = selectQuestionsForInterview(\n        experienceLevel,\n        teamSettings.questionWeights,\n        teamSettings.maxQuestions\n      );\n      \n      console.log('[Team Interview] Question backlog:', {\n        total: memory.teamQuestionBacklog.length,\n        byCategory: {\n          learning: memory.teamQuestionBacklog.filter(q => q.category === 'learning').length,\n          collaboration: memory.teamQuestionBacklog.filter(q => q.category === 'collaboration').length,\n          technical: memory.teamQuestionBacklog.filter(q => q.category === 'technical').length,\n          curiosity: memory.teamQuestionBacklog.filter(q => q.category === 'curiosity').length,\n        },\n      });\n      \n      // Generate team greeting (Marcus introduces both himself and Sarah)\n      const { greeting: marcusGreeting, activePersonaId: marcusPersonaId } = await this.teamGreeting.generateGreeting(\n        teamSettings,\n        jobContext.companyName,\n        jobContext.companyDescription || '',\n        jobContext.jobTitle || targetRole,\n        candidateName\n      );\n      \n      // Track Marcus's greeting in conversation history\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: marcusGreeting,\n        personaId: marcusPersonaId,\n      });\n      \n      // Since Marcus invites Sarah to introduce herself, generate Sarah's intro immediately\n      // This creates a natural flow: Marcus speaks, then Sarah, then candidate can respond\n      const { intro: sarahIntro, activePersonaId: sarahPersonaId } = await this.teamGreeting.generateSecondaryIntro(\n        teamSettings,\n        jobContext.companyName,\n        candidateName\n      );\n      \n      // Track Sarah's intro in conversation history\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: sarahIntro,\n        personaId: sarahPersonaId,\n      });\n      \n      memory.activePersonaId = sarahPersonaId; // Sarah spoke last\n      memory.currentStage = \"intro_exchange\";\n      memory.preludeStep = 2; // Skip to step 2 since both intros are done\n      \n      // Combine both greetings for the frontend\n      // Format: Marcus's greeting + marker + Sarah's greeting\n      const combinedGreeting = JSON.stringify({\n        messages: [\n          { personaId: marcusPersonaId, content: marcusGreeting },\n          { personaId: sarahPersonaId, content: sarahIntro },\n        ]\n      });\n      \n      return {\n        session,\n        greeting: combinedGreeting,\n        isPreludeMode: true,\n        // Include team interview info for frontend\n        isTeamInterview: true,\n        teamPersonas: teamSettings.personas.map(p => ({\n          id: p.id,\n          name: p.name,\n          role: p.role,\n          displayRole: p.displayRole,\n        })),\n        activePersonaId: sarahPersonaId,\n      };\n    }\n    \n    // For HR/behavioral interviews with job context, use conversational prelude\n    const usePrelude = jobContext?.companyName && \n      (interviewType === \"behavioral\" || interviewType === \"recruiter_call\");\n    \n    if (usePrelude && candidateName) {\n      // PREPARATION PHASE: Generate interview plan before starting\n      // This happens \"behind the scenes\" - the HR reviews CV and job before the call\n      console.log('[Interview Prep] Generating interview plan for', candidateName);\n      const plan = await this.preparationPlanner.generatePlan(config);\n      memory.interviewPlan = plan;\n      console.log('[Interview Prep] Plan ready:', {\n        strengths: plan.candidateStrengths.length,\n        concerns: plan.potentialConcerns.length,\n        questions: plan.questions.length,\n      });\n      \n      // Start with greeting phase - don't generate questions yet\n      const greetingText = await this.greeting.generate(config, candidateName);\n      memory.currentStage = \"greeting\";\n      memory.preludeStep = 0;\n      \n      // Track interviewer's greeting in conversation history (for unified chain)\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: greetingText,\n      });\n      \n      return { \n        session, \n        greeting: greetingText,\n        isPreludeMode: true \n      };\n    }\n\n    // Fallback to old flow for practice mode or technical interviews\n    let introduction: string | undefined;\n    if (jobContext?.companyName) {\n      introduction = await this.introduction.generate(config);\n    }\n\n    const questionText = await this.questionGenerator.generate({\n      config,\n      questionIndex: 0,\n      previousQuestions: memory.questions,\n      previousAnswers: memory.answers,\n      previousScores: memory.scores,\n    });\n\n    memory.questions.push(questionText);\n    memory.currentStage = \"opening\";\n    memory.preludeStep = 3; // Skip prelude\n\n    const question = await storage.createInterviewQuestion({\n      sessionId: session.id,\n      questionIndex: 0,\n      questionText,\n      questionType: \"opening\",\n      expectedCriteria: this.getExpectedCriteria(config, 0),\n    });\n\n    return { session, firstQuestion: question, introduction, isPreludeMode: false };\n  }\n\n  /**\n   * Classify candidate's response to intro exchange proposal\n   * Returns: 'interviewer_first' | 'candidate_first' | 'skip_intros' | 'unclear'\n   */\n  private classifyIntroResponse(response: string): 'interviewer_first' | 'candidate_first' | 'skip_intros' | 'unclear' {\n    const lower = response.toLowerCase();\n    \n    // Candidate wants to go first\n    const candidateFirstPatterns = [\n      /i('d| would) (like to|prefer to|want to) (go |start )?first/i,\n      /let me (go |start )?first/i,\n      /can i (go |start )?first/i,\n      /i('ll| will) (go |start )?first/i,\n      /me first/i,\n      /i start/i,\n      /i'd rather start/i,\n    ];\n    \n    for (const pattern of candidateFirstPatterns) {\n      if (pattern.test(response)) {\n        return 'candidate_first';\n      }\n    }\n    \n    // Candidate wants to skip intros\n    const skipPatterns = [\n      /skip (the )?intro/i,\n      /no (need for )?intro/i,\n      /let's (just )?get (right )?(to|into)/i,\n      /skip (to|ahead)/i,\n      /don't need intro/i,\n    ];\n    \n    for (const pattern of skipPatterns) {\n      if (pattern.test(response)) {\n        return 'skip_intros';\n      }\n    }\n    \n    // Default: agrees to let interviewer go first (or unclear = default to interviewer first)\n    // Common agreement patterns\n    const agreePatterns = [\n      /sure|okay|yes|sounds good|go ahead|please/i,\n      /that works|that's fine|perfect|great/i,\n    ];\n    \n    for (const pattern of agreePatterns) {\n      if (pattern.test(response)) {\n        return 'interviewer_first';\n      }\n    }\n    \n    // If unclear, default to interviewer first\n    return 'interviewer_first';\n  }\n\n  /**\n   * Check if the candidate's response is a conversational question (like \"how're you?\")\n   * that should be responded to before continuing with the interview\n   */\n  private isConversationalQuestion(response: string): boolean {\n    const lower = response.toLowerCase();\n    \n    // Patterns for conversational questions directed at the interviewer\n    const conversationalPatterns = [\n      /how('re| are) you/i,\n      /how about you/i,\n      /and you\\??/i,\n      /what about you/i,\n      /how's (it going|your day|things)/i,\n      /before (that|we (start|begin|dive))/i,\n    ];\n    \n    for (const pattern of conversationalPatterns) {\n      if (pattern.test(response)) {\n        return true;\n      }\n    }\n    \n    return false;\n  }\n\n  /**\n   * Check if the candidate's response is a substantive answer about their background\n   * (not just \"okay\", \"sure\", or a brief acknowledgment)\n   */\n  private isSubstantiveBackgroundAnswer(response: string): boolean {\n    const lower = response.toLowerCase().trim();\n    const wordCount = response.split(/\\s+/).length;\n    \n    // Too short to be a real answer\n    if (wordCount < 10) {\n      return false;\n    }\n    \n    // Check for background-related keywords that indicate they're actually answering\n    const backgroundKeywords = [\n      /i('m| am) (a |an |the |currently )/i,\n      /i (work|worked|have been|was|am) (at|in|as|for)/i,\n      /my (background|experience|role|job|career|work)/i,\n      /(years?|months?) (of )?(experience|in)/i,\n      /senior|junior|lead|manager|director|engineer|developer|scientist|analyst/i,\n      /team|company|organization|department/i,\n      /currently|previously|before|after/i,\n    ];\n    \n    for (const pattern of backgroundKeywords) {\n      if (pattern.test(response)) {\n        return true;\n      }\n    }\n    \n    // If it's reasonably long (20+ words), assume it's substantive\n    if (wordCount >= 20) {\n      return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Generate a warm, friendly response to conversational questions\n   */\n  private generateWarmResponse(response: string): string {\n    const lower = response.toLowerCase();\n    \n    // Respond to \"how are you\" type questions\n    if (/how('re| are) you/i.test(lower) || /how about you/i.test(lower) || /and you\\??/i.test(lower)) {\n      const responses = [\n        \"I'm doing great, thanks for asking! It's always nice when candidates take a moment to connect.\",\n        \"I'm doing well, thank you! I appreciate you asking.\",\n        \"Doing well, thanks! It's great to meet candidates who are personable.\",\n      ];\n      return responses[Math.floor(Math.random() * responses.length)] + \" Now, to get us started, could you tell me a bit about your background?\";\n    }\n    \n    // Respond to \"before that\" type interjections\n    if (/before (that|we)/i.test(lower)) {\n      return \"Of course, happy to chat! I'm doing well, thanks for asking. Now, to get us started, could you tell me a bit about your background?\";\n    }\n    \n    // Default warm response\n    return \"I appreciate that! I'm doing well. Now, let's get started with the interview - could you tell me a bit about your background?\";\n  }\n\n  /**\n   * Generate a warm response that also includes the role overview\n   * Used when candidate asks a conversational question during the intro exchange\n   */\n  private async generateWarmResponseWithIntro(response: string, config: InterviewConfig): Promise<string> {\n    const lower = response.toLowerCase();\n    \n    // Get the role overview\n    const roleOverview = await this.selfIntro.generate(config);\n    \n    // Generate appropriate warm prefix based on their question\n    let warmPrefix: string;\n    \n    if (/how('re| are) you/i.test(lower) || /how about you/i.test(lower) || /and you\\??/i.test(lower)) {\n      const responses = [\n        \"I'm doing great, thanks for asking!\",\n        \"I'm doing well, thank you for asking!\",\n        \"Doing well, thanks! I appreciate you asking.\",\n      ];\n      warmPrefix = responses[Math.floor(Math.random() * responses.length)];\n    } else if (/before (that|we)/i.test(lower)) {\n      warmPrefix = \"Of course! I'm doing well, thanks for asking.\";\n    } else {\n      warmPrefix = \"I appreciate you asking! I'm doing well.\";\n    }\n    \n    return `${warmPrefix} ${roleOverview}`;\n  }\n\n  /**\n   * Handle candidate responses during the conversational prelude phase\n   * Returns the interviewer's next prelude message, or the first question when prelude is complete\n   */\n  async handlePreludeResponse(\n    sessionId: number,\n    candidateResponse: string\n  ): Promise<{\n    preludeMessage?: string;\n    firstQuestion?: InterviewQuestion;\n    preludeComplete: boolean;\n    activePersonaId?: string;\n    isTeamInterview?: boolean;\n  }> {\n    const session = await storage.getInterviewSession(sessionId);\n    if (!session) {\n      throw new Error(\"Interview session not found\");\n    }\n\n    const memory = this.getMemory(sessionId);\n    const config = this.getConfig(session, memory.jobContext);\n\n    // Store the candidate's response\n    memory.preludeResponses.push(candidateResponse);\n    \n    // Track candidate's response in conversation history (for unified chain)\n    memory.conversationHistory.push({\n      role: 'candidate',\n      content: candidateResponse,\n    });\n\n    // Advance prelude step\n    memory.preludeStep++;\n\n    // TEAM INTERVIEW: Simplified prelude flow\n    // Step 0 -> 1: After Marcus greeting, Sarah introduces herself\n    // Step 1 -> 2: After Sarah's intro & candidate responds, transition to questions\n    if (memory.isTeamInterview && memory.teamSettings) {\n      return this.handleTeamInterviewPrelude(session, memory, config, candidateResponse);\n    }\n\n    if (memory.preludeStep === 1) {\n      // Step 1: After greeting, propose introductions\n      const introExchangeText = await this.introExchange.generate(config, candidateResponse);\n      memory.currentStage = \"intro_exchange\";\n      \n      // Track interviewer's response in conversation history\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: introExchangeText,\n      });\n      \n      return { \n        preludeMessage: introExchangeText, \n        preludeComplete: false,\n        activePersonaId: memory.activePersonaId,\n        isTeamInterview: memory.isTeamInterview,\n      };\n    }\n\n    if (memory.preludeStep === 2) {\n      // Check if we're waiting for candidate to share their intro (they went first)\n      if (memory.awaitingCandidateIntro) {\n        // Candidate just shared their intro - now give role overview\n        memory.awaitingCandidateIntro = false;\n        memory.candidateWentFirst = true;\n        \n        // Acknowledge their intro and give role overview\n        const selfIntroText = await this.selfIntro.generate(config);\n        const ackAndIntro = `Thanks for sharing that! ${selfIntroText}`;\n        \n        // Track interviewer's response in conversation history\n        memory.conversationHistory.push({\n          role: 'interviewer',\n          content: ackAndIntro,\n        });\n        \n        return { \n          preludeMessage: ackAndIntro, \n          preludeComplete: false,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      // Check if the candidate is asking a conversational question alongside their response\n      // e.g., \"Sure. But before that, how are you?\"\n      const hasConversationalQuestion = this.isConversationalQuestion(candidateResponse);\n      \n      if (hasConversationalQuestion) {\n        // Answer their question and then proceed with role overview\n        const warmResponse = await this.generateWarmResponseWithIntro(candidateResponse, config);\n        // Don't decrement - we're answering and proceeding to role overview in one message\n        \n        // Track interviewer's response in conversation history\n        memory.conversationHistory.push({\n          role: 'interviewer',\n          content: warmResponse,\n        });\n        \n        return { \n          preludeMessage: warmResponse, \n          preludeComplete: false,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      // Step 2: Parse candidate's response to intro exchange proposal\n      const introPreference = this.classifyIntroResponse(candidateResponse);\n      \n      if (introPreference === 'candidate_first') {\n        // Candidate wants to go first - acknowledge and wait for their intro\n        const ackMessage = \"Of course, please go ahead! I'd love to hear about you first.\";\n        memory.awaitingCandidateIntro = true;\n        memory.preludeStep = 1; // Stay at step 1 so next increment brings us back to step 2\n        \n        // Track interviewer's response in conversation history\n        memory.conversationHistory.push({\n          role: 'interviewer',\n          content: ackMessage,\n        });\n        \n        return { \n          preludeMessage: ackMessage, \n          preludeComplete: false,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      if (introPreference === 'skip_intros') {\n        // Skip straight to questions - mark prelude complete\n        memory.currentStage = \"opening\";\n        memory.preludeStep = 3; // Mark prelude as complete for isInPreludeMode check\n        \n        const questionText = await this.questionGenerator.generate({\n          config,\n          questionIndex: 0,\n          previousQuestions: memory.questions,\n          previousAnswers: memory.answers,\n          previousScores: memory.scores,\n        });\n\n        memory.questions.push(questionText);\n\n        const question = await storage.createInterviewQuestion({\n          sessionId: session.id,\n          questionIndex: 0,\n          questionText,\n          questionType: \"opening\",\n          expectedCriteria: this.getExpectedCriteria(config, 0),\n        });\n\n        return { \n          firstQuestion: question, \n          preludeComplete: true,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      // Default: interviewer goes first with role overview\n      const selfIntroText = await this.selfIntro.generate(config);\n      \n      // Track interviewer's response in conversation history\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: selfIntroText,\n      });\n      \n      return { \n        preludeMessage: selfIntroText, \n        preludeComplete: false,\n        activePersonaId: memory.activePersonaId,\n        isTeamInterview: memory.isTeamInterview,\n      };\n    }\n\n    if (memory.preludeStep >= 3) {\n      // Step 3+: Check if the candidate is asking a conversational question\n      // before proceeding to the first real interview question\n      const isConversationalQuestion = this.isConversationalQuestion(candidateResponse);\n      \n      if (isConversationalQuestion) {\n        // Respond warmly to conversational questions like \"how're you?\"\n        const warmResponse = this.generateWarmResponse(candidateResponse);\n        memory.preludeStep--; // Stay at current step to ask question after responding\n        return { \n          preludeMessage: warmResponse, \n          preludeComplete: false,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      // The self-intro ALWAYS ends with \"could you tell me a bit about your background?\"\n      // So we ALWAYS treat the candidate's response as an answer to that question\n      // This prevents the interviewer from repeating the same question\n      memory.currentStage = \"core\";\n      \n      // IMPORTANT: Mark any \"background\" criterion questions in the interview plan as \"asked\"\n      // since the self-intro already covers this topic\n      if (memory.interviewPlan) {\n        const backgroundQuestions = memory.interviewPlan.questions.filter(\n          q => q.criterion === 'background' && q.status === 'pending'\n        );\n        for (const q of backgroundQuestions) {\n          q.status = 'asked';\n          console.log('[Prelude] Marked planned background question as asked:', q.id);\n        }\n      }\n      \n      // Store the background question and their answer\n      const backgroundQuestion = \"Could you tell me a bit about your background?\";\n      memory.questions.push(backgroundQuestion);\n      memory.answers.push(candidateResponse);\n      \n      // Create the first question record with their answer\n      const question = await storage.createInterviewQuestion({\n        sessionId: session.id,\n        questionIndex: 0,\n        questionText: backgroundQuestion,\n        questionType: \"opening\",\n        expectedCriteria: this.getExpectedCriteria(config, 0),\n        candidateAnswer: candidateResponse,\n        answeredAt: new Date(),\n      });\n      \n      // Evaluate their background answer\n      const evaluation = await this.evaluator.evaluate(\n        config,\n        backgroundQuestion,\n        candidateResponse\n      );\n      \n      memory.scores.push(evaluation.score);\n      memory.evaluations.push(evaluation);\n      \n      // Update coverage tracking for background criterion\n      this.updateCoverage(memory, backgroundQuestion, candidateResponse, evaluation.score);\n      memory.totalQuestionsAsked++;\n      \n      // Update the question with evaluation\n      await storage.updateInterviewQuestion(question.id, {\n        score: evaluation.score,\n        feedback: evaluation.feedback,\n        strengths: evaluation.strengths,\n        improvements: evaluation.improvements,\n      });\n      \n      // Update session to move to next question\n      await storage.updateInterviewSession(session.id, {\n        currentQuestionIndex: 1,\n      });\n      \n      // Check if the answer was brief - if so, ask a follow-up for more details\n      // rather than jumping to a completely new topic\n      const wordCount = candidateResponse.split(/\\s+/).length;\n      const isBriefAnswer = wordCount < 10;\n      \n      if (isBriefAnswer) {\n        // Generate a natural follow-up to get more details about their background\n        const followUpQuestion = \"Thanks for sharing that! Could you tell me a bit more about your current role and what you've been working on?\";\n        \n        memory.questions.push(followUpQuestion);\n        \n        const followUpQuestionRecord = await storage.createInterviewQuestion({\n          sessionId: session.id,\n          questionIndex: 1,\n          questionText: followUpQuestion,\n          questionType: \"core\",\n          expectedCriteria: this.getExpectedCriteria(config, 1),\n        });\n        \n        return { \n          firstQuestion: followUpQuestionRecord, \n          preludeComplete: true,\n          activePersonaId: memory.activePersonaId,\n          isTeamInterview: memory.isTeamInterview,\n        };\n      }\n      \n      // Substantive answer - generate a reflection and move to next topic\n      const reflectionText = await this.reflection.generate(candidateResponse, memory.lastReflection, \"Sarah\");\n      memory.lastReflection = reflectionText;\n      \n      // Generate the second question (since first was already answered well)\n      const nextQuestionText = await this.questionGenerator.generate({\n        config,\n        questionIndex: 1,\n        previousQuestions: memory.questions,\n        previousAnswers: memory.answers,\n        previousScores: memory.scores,\n      });\n      \n      memory.questions.push(nextQuestionText);\n      \n      const nextQuestion = await storage.createInterviewQuestion({\n        sessionId: session.id,\n        questionIndex: 1,\n        questionText: nextQuestionText,\n        questionType: \"core\",\n        expectedCriteria: this.getExpectedCriteria(config, 1),\n      });\n      \n      return { \n        firstQuestion: nextQuestion, \n        preludeComplete: true,\n        activePersonaId: memory.activePersonaId,\n        isTeamInterview: memory.isTeamInterview,\n      };\n    }\n\n    // Should not reach here\n    return { \n      preludeComplete: false,\n      activePersonaId: memory.activePersonaId,\n      isTeamInterview: memory.isTeamInterview,\n    };\n  }\n\n  /**\n   * Handle team interview specific prelude flow\n   * Step 1: After Marcus greeting, Sarah introduces herself\n   * Step 2: After candidate responds to Sarah, transition to first question\n   */\n  private async handleTeamInterviewPrelude(\n    session: any,\n    memory: ConversationMemory,\n    config: InterviewConfig,\n    candidateResponse: string\n  ): Promise<{\n    preludeMessage?: string;\n    firstQuestion?: InterviewQuestion;\n    preludeComplete: boolean;\n    activePersonaId?: string;\n    isTeamInterview?: boolean;\n  }> {\n    const teamSettings = memory.teamSettings!;\n\n    if (memory.preludeStep === 1) {\n      // Step 1: After Marcus greeting, Sarah introduces herself\n      const { intro, activePersonaId } = await this.teamGreeting.generateSecondaryIntro(\n        teamSettings,\n        memory.jobContext?.companyName || 'the company',\n        memory.candidateName || 'Candidate'\n      );\n\n      memory.activePersonaId = activePersonaId;\n      memory.currentStage = \"intro_exchange\";\n\n      // Track Sarah's intro in conversation history\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: intro,\n        personaId: activePersonaId,\n      });\n\n      return {\n        preludeMessage: intro,\n        preludeComplete: false,\n        activePersonaId: activePersonaId,\n        isTeamInterview: true,\n      };\n    }\n\n    if (memory.preludeStep >= 2) {\n      // Step 2+: Candidate has responded to Sarah's intro, transition to first question\n      memory.currentStage = \"core\";\n      memory.preludeStep = 3; // Mark prelude complete\n\n      // Track candidate's prelude response in conversation history\n      memory.conversationHistory.push({\n        role: 'candidate',\n        content: candidateResponse,\n      });\n\n      // Generate first team interview question\n      const firstQuestion = await this.generateTeamFirstQuestion(session, memory, teamSettings);\n      return {\n        firstQuestion,\n        preludeComplete: true,\n        activePersonaId: memory.activePersonaId,\n        isTeamInterview: true,\n      };\n    }\n\n    return {\n      preludeComplete: false,\n      activePersonaId: memory.activePersonaId,\n      isTeamInterview: true,\n    };\n  }\n\n  /**\n   * Generate first question for team interview\n   * Includes a natural transition that acknowledges the candidate's self-introduction\n   */\n  private async generateTeamFirstQuestion(\n    session: any,\n    memory: ConversationMemory,\n    teamSettings: TeamInterviewSettings\n  ): Promise<InterviewQuestion> {\n    // Pick first question from backlog\n    const backlog = memory.teamQuestionBacklog || memory.questionBacklog;\n    const firstBacklogItem = backlog?.[0];\n    const rawQuestion = firstBacklogItem?.question || \n      \"How do you approach learning something new?\";\n    \n    // Mark question as asked\n    if (firstBacklogItem) {\n      memory.askedQuestionIds = memory.askedQuestionIds || new Set();\n      memory.askedQuestionIds.add(firstBacklogItem.id);\n    }\n\n    // Set Marcus as the active persona for starting questions\n    memory.activePersonaId = teamSettings.personas[0].id;\n\n    // Get the candidate's self-introduction from conversation history\n    const candidateIntro = memory.conversationHistory\n      .filter(msg => msg.role === 'candidate')\n      .slice(-1)[0]?.content || '';\n\n    // Generate a natural transition that acknowledges what the candidate shared\n    let questionText = rawQuestion;\n    if (candidateIntro && memory.jobContext?.companyName) {\n      try {\n        questionText = await this.teamGreeting.generateTransitionToFirstQuestion(\n          teamSettings,\n          memory.jobContext.companyName,\n          candidateIntro,\n          rawQuestion\n        );\n      } catch (error) {\n        console.error('[Team Interview] Failed to generate transition, using raw question:', error);\n        questionText = rawQuestion;\n      }\n    }\n\n    const question = await storage.createInterviewQuestion({\n      sessionId: session.id,\n      questionIndex: 0,\n      questionText,\n      questionType: \"opening\",\n      expectedCriteria: firstBacklogItem?.category || \"learning_mindset\",\n    });\n\n    memory.questions.push(questionText);\n    memory.totalQuestionsAsked++;\n\n    // Track in conversation history\n    memory.conversationHistory.push({\n      role: 'interviewer',\n      content: questionText,\n      personaId: memory.activePersonaId,\n    });\n\n    return question;\n  }\n\n  /**\n   * Check if a session is currently in prelude mode\n   */\n  isInPreludeMode(sessionId: number): boolean {\n    const memory = this.memory.get(sessionId);\n    return memory ? memory.preludeStep < 3 : false;\n  }\n\n  /**\n   * Get current prelude step for a session\n   */\n  getPreludeStep(sessionId: number): number {\n    const memory = this.memory.get(sessionId);\n    return memory ? memory.preludeStep : 0;\n  }\n\n  async submitAnswer(\n    sessionId: number,\n    questionId: number,\n    answer: string\n  ): Promise<{\n    evaluation?: EvaluationResult;\n    decision?: FollowUpDecision;\n    nextQuestion?: InterviewQuestion;\n    reflection?: string;\n    finalReport?: FinalReport;\n    closure?: string;\n    // New fields for responsive handling\n    interimResponse?: string; // Response when not proceeding with evaluation\n    questionRepeated?: boolean; // Whether the same question should be re-asked\n    candidateIntent?: CandidateIntent;\n    currentQuestionText?: string; // The question that's still pending (for interim responses)\n    candidateQuestionAnswer?: string; // Answer to a question the candidate asked (for mixed content)\n    // Pacing info for frontend\n    pacing?: {\n      elapsedMinutes: number;\n      progressPercent: number;\n      status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n    };\n  }> {\n    const session = await storage.getInterviewSession(sessionId);\n    if (!session) {\n      throw new Error(\"Interview session not found\");\n    }\n\n    const question = await storage.getInterviewQuestion(questionId);\n    if (!question) {\n      throw new Error(\"Question not found\");\n    }\n\n    const memory = this.getMemory(sessionId);\n    const config = this.getConfig(session, memory.jobContext);\n    \n    // Store the last question for classification context\n    memory.lastQuestionAsked = question.questionText;\n    \n    // Classify the candidate's response (synchronous - heuristics only, no LLM call)\n    const classification = responseClassifier.classify(\n      answer,\n      question.questionText,\n      config.jobTitle || config.targetRole\n    );\n    \n    memory.lastCandidateIntent = classification.intent;\n    \n    // Track any candidate question for later answering\n    let candidateQuestionAnswer: string | undefined;\n    \n    // Handle non-answer intents (pure questions, confusion, comments, etc.)\n    if (classification.intent !== 'substantive_answer') {\n      const handlerResult = await responseHandler.handleResponse(\n        classification,\n        question.questionText,\n        {\n          interviewerName: this.getInterviewerName(session.interviewType),\n          companyName: config.companyName,\n          companyDescription: config.companyDescription,\n          jobTitle: config.jobTitle,\n          jobRequirements: config.jobRequirements\n        }\n      );\n      \n      // If we shouldn't proceed with evaluation, return the interim response\n      if (!handlerResult.shouldProceedWithEvaluation) {\n        // Track question repeats to prevent infinite loops\n        if (handlerResult.questionRepeated) {\n          memory.currentQuestionRepeatCount++;\n          \n          // After 2 repeats, force move to the next question\n          const MAX_QUESTION_REPEATS = 2;\n          if (memory.currentQuestionRepeatCount >= MAX_QUESTION_REPEATS) {\n            // Reset repeat counter and proceed with low-score evaluation\n            memory.currentQuestionRepeatCount = 0;\n            \n            // Treat repeated refusals as a minimal answer and proceed\n            // The evaluation will score this appropriately low\n            // Don't return here - fall through to normal evaluation flow\n          } else {\n            // Return the interim response along with the current question\n            // so the frontend knows what question is still pending\n            return {\n              interimResponse: handlerResult.response,\n              questionRepeated: handlerResult.questionRepeated,\n              candidateIntent: classification.intent,\n              // Include the current question so the frontend can track state\n              currentQuestionText: question.questionText\n            };\n          }\n        } else {\n          // Non-repeated interim (like clarification) - return as normal\n          return {\n            interimResponse: handlerResult.response,\n            questionRepeated: handlerResult.questionRepeated,\n            candidateIntent: classification.intent,\n            currentQuestionText: question.questionText\n          };\n        }\n      }\n    } else if (classification.candidateQuestion) {\n      // Mixed content: substantive answer WITH a question\n      // Generate an inline answer to include with the reflection\n      const handlerResult = await responseHandler.handleResponse(\n        { ...classification, intent: 'question_for_recruiter' }, // Force question handling\n        question.questionText,\n        {\n          interviewerName: this.getInterviewerName(session.interviewType),\n          companyName: config.companyName,\n          companyDescription: config.companyDescription,\n          jobTitle: config.jobTitle,\n          jobRequirements: config.jobRequirements\n        }\n      );\n      // Don't include elaboration offer acknowledgments in mixed content\n      // The triage chain will handle whether we need more info\n      if (!handlerResult.isElaborationOffer) {\n        candidateQuestionAnswer = handlerResult.response;\n      }\n    }\n\n    // =========================================================================\n    // TEAM INTERVIEW PATH: Multi-persona interview with level calibration\n    // =========================================================================\n    if (memory.isTeamInterview && memory.teamSettings && memory.teamQuestionBacklog) {\n      console.log('[Telemetry] Chain activation:', {\n        chainType: 'team_interview',\n        experienceLevel: memory.teamSettings.experienceLevel,\n        activePersona: memory.activePersonaId,\n        mode: session.mode,\n        sessionId,\n        questionsAsked: memory.totalQuestionsAsked,\n        reason: 'Team interview mode with multi-persona flow',\n      });\n      return this.processAnswerTeam(sessionId, questionId, answer, session, question);\n    }\n\n    // =========================================================================\n    // UNIFIED CHAIN PATH: Single LLM call per turn (feature flagged)\n    // =========================================================================\n    if (USE_UNIFIED_CHAIN && memory.interviewPlan) {\n      console.log('[Telemetry] Chain activation:', {\n        chainType: 'unified',\n        featureFlag: USE_UNIFIED_CHAIN,\n        hasInterviewPlan: !!memory.interviewPlan,\n        mode: session.mode,\n        sessionId,\n        questionIndex: session.currentQuestionIndex,\n        questionsAsked: memory.totalQuestionsAsked,\n        reason: 'Journey mode with interview plan - using single LLM call per turn',\n      });\n      return this.processAnswerUnified(sessionId, questionId, answer, session, question);\n    }\n    \n    // Log when legacy chain is used and why\n    console.log('[Telemetry] Chain activation:', {\n      chainType: 'legacy',\n      featureFlag: USE_UNIFIED_CHAIN,\n      hasInterviewPlan: !!memory.interviewPlan,\n      mode: session.mode,\n      sessionId,\n      reason: !USE_UNIFIED_CHAIN \n        ? 'Feature flag disabled' \n        : 'No interview plan (practice mode or technical interview)',\n    });\n\n    // =========================================================================\n    // LEGACY PATH: Multi-chain fragmented approach (kept for fallback)\n    // =========================================================================\n    \n    // Use sanitized text for evaluation (protects against injection)\n    const sanitizedAnswer = classification.sanitizedText;\n\n    const evaluation = await this.evaluator.evaluate(\n      config,\n      question.questionText,\n      sanitizedAnswer\n    );\n\n    memory.answers.push(answer);\n    memory.scores.push(evaluation.score);\n    memory.evaluations.push(evaluation);\n    memory.totalQuestionsAsked++;\n    \n    // Update coverage tracking for dynamic completion\n    this.updateCoverage(memory, question.questionText, sanitizedAnswer, evaluation.score);\n    \n    // Update telemetry for dynamic interview flow\n    this.updateTelemetry(memory, evaluation.score);\n    \n    if (evaluation.projectMentioned) {\n      if (evaluation.projectMentioned !== memory.activeProject) {\n        memory.activeProject = evaluation.projectMentioned;\n        memory.projectMentionCount = 1;\n      } else {\n        memory.projectMentionCount++;\n      }\n    }\n\n    await storage.updateInterviewQuestion(questionId, {\n      candidateAnswer: answer,\n      score: evaluation.score,\n      feedback: evaluation.feedback,\n      strengths: evaluation.strengths,\n      improvements: evaluation.improvements,\n      answeredAt: new Date(),\n    });\n\n    const decision = await this.followUp.decide(\n      config,\n      session.currentQuestionIndex,\n      evaluation.score,\n      memory.scores\n    );\n\n    // Check dynamic interview completion based on coverage sufficiency\n    const wrapUpCheck = this.shouldWrapUp(memory, config);\n    \n    // Determine stages: what stage was the question we just answered, and what's next\n    const answeredQuestionStage = getInterviewStage(session.currentQuestionIndex, config.totalQuestions);\n    memory.currentStage = answeredQuestionStage;\n    \n    // Use dynamic sufficiency check instead of fixed question count\n    const shouldEndInterview = wrapUpCheck.shouldEnd || decision.action === \"end_interview\";\n    \n    if (shouldEndInterview) {\n      // Calculate backlog metrics for legacy path (may not have interview plan)\n      const pendingQuestionsLegacy = memory.interviewPlan?.questions.filter(q => q.status === 'pending').length || 0;\n      const coveredQuestionsLegacy = memory.interviewPlan?.questions.filter(q => q.status === 'covered_proactively').length || 0;\n      const askedQuestionsLegacy = memory.interviewPlan?.questions.filter(q => q.status === 'asked').length || 0;\n      \n      // Log wrap-up telemetry for legacy path\n      console.log('[Telemetry] Wrap-up triggered:', {\n        sessionId,\n        trigger: 'legacy_chain_decision',\n        reason: wrapUpCheck.reason,\n        questionsAsked: memory.totalQuestionsAsked,\n        finalCoverage: {\n          overall: Math.round(\n            (memory.coverage.background.score + memory.coverage.skills.score + \n             memory.coverage.behavioral.score + memory.coverage.motivation.score +\n             memory.coverage.culture_fit.score + memory.coverage.logistics.score) / 6 * 100\n          ) / 100,\n          background: Math.round(memory.coverage.background.score * 100) / 100,\n          skills: Math.round(memory.coverage.skills.score * 100) / 100,\n          behavioral: Math.round(memory.coverage.behavioral.score * 100) / 100,\n          motivation: Math.round(memory.coverage.motivation.score * 100) / 100,\n          culture_fit: Math.round(memory.coverage.culture_fit.score * 100) / 100,\n          logistics: Math.round(memory.coverage.logistics.score * 100) / 100,\n        },\n        backlogStatus: {\n          pending: pendingQuestionsLegacy,\n          asked: askedQuestionsLegacy,\n          coveredProactively: coveredQuestionsLegacy,\n          total: memory.interviewPlan?.questions.length || 0,\n          hasInterviewPlan: !!memory.interviewPlan,\n        },\n        avgScore: memory.scores.length > 0 \n          ? Math.round((memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length) * 10) / 10\n          : 0,\n        sessionDurationMs: Date.now() - memory.telemetry.startedAt,\n      });\n      \n      // Check if the candidate asked a question (e.g., when wrapup asked \"do you have questions?\")\n      // We should answer their question before closing\n      let closingQuestionAnswer: string | undefined;\n      \n      const closingClassification = responseClassifier.classify(\n        answer,\n        question.questionText,\n        config.jobTitle || config.targetRole\n      );\n      \n      // If the candidate asked a question in their final response, answer it first\n      if (closingClassification.candidateQuestion || closingClassification.intent === 'question_for_recruiter') {\n        const handlerResult = await responseHandler.handleResponse(\n          { ...closingClassification, intent: 'question_for_recruiter' },\n          question.questionText,\n          {\n            interviewerName: this.getInterviewerName(session.interviewType),\n            companyName: config.companyName,\n            companyDescription: config.companyDescription,\n            jobTitle: config.jobTitle,\n            jobRequirements: config.jobRequirements\n          }\n        );\n        closingQuestionAnswer = handlerResult.response;\n      }\n      \n      // Generate closure message before ending (use candidate's actual name)\n      const closureMessage = await this.closure.generate(config, memory.candidateName);\n      \n      const finalReport = await this.generateFinalReport(sessionId);\n      \n      await storage.updateInterviewSession(sessionId, {\n        status: \"completed\",\n        overallScore: finalReport.overallScore,\n        completedAt: new Date(),\n      });\n\n      this.memory.delete(sessionId);\n\n      // Include the answer to any candidate question before the closure\n      const fullClosure = closingQuestionAnswer \n        ? `${closingQuestionAnswer}\\n\\n${closureMessage}`\n        : closureMessage;\n\n      return { evaluation, decision, finalReport, closure: fullClosure, candidateQuestionAnswer };\n    }\n\n    const nextQuestionIndex = session.currentQuestionIndex + 1;\n    \n    await storage.updateInterviewSession(sessionId, {\n      currentQuestionIndex: nextQuestionIndex,\n    });\n\n    const shouldClearProject = memory.projectMentionCount >= 3;\n    if (shouldClearProject) {\n      memory.activeProject = null;\n      memory.projectMentionCount = 0;\n    }\n    \n    // Track consecutive minimal/negative responses to prevent infinite probing\n    const MAX_CONSECUTIVE_MINIMAL = 2;\n    const isMinimalResponse = classification.intent === 'minimal_response';\n    \n    if (isMinimalResponse) {\n      memory.consecutiveMinimalResponses++;\n      console.log(`[Interview] Minimal response detected (${memory.consecutiveMinimalResponses}/${MAX_CONSECUTIVE_MINIMAL})`);\n    } else {\n      // Reset counter on substantive response\n      memory.consecutiveMinimalResponses = 0;\n    }\n    \n    // Force skip follow-ups after too many minimal responses\n    const shouldForceNewTopic = memory.consecutiveMinimalResponses >= MAX_CONSECUTIVE_MINIMAL;\n    if (shouldForceNewTopic) {\n      console.log('[Interview] Forcing new topic after consecutive minimal responses');\n      memory.pendingFollowUp = undefined; // Clear any pending follow-up\n      memory.consecutiveMinimalResponses = 0; // Reset counter\n      \n      // Track that we need to switch to a completely different topic\n      // Avoid asking for \"examples\" or \"details\" about the same area\n      memory.forceTopicSwitch = true;\n    }\n    \n    // Use triage chain to evaluate response and decide next action\n    let triageDecision: TriageDecision | null = null;\n    let proactiveCoverageAck = '';\n    \n    if (memory.interviewPlan) {\n      const remainingQuestions = this.getRemainingQuestions(memory);\n      triageDecision = await this.triage.evaluate(\n        question.questionText,\n        sanitizedAnswer,\n        remainingQuestions\n      );\n      \n      // Handle proactive coverage - mark questions as covered\n      if (triageDecision.outcome === 'proactive_coverage' && triageDecision.coveredQuestionIds) {\n        this.markQuestionsAsCovered(memory, triageDecision.coveredQuestionIds);\n        const coveredQuestions = memory.interviewPlan.questions\n          .filter(q => triageDecision!.coveredQuestionIds?.includes(q.id));\n        proactiveCoverageAck = triageDecision.acknowledgment || \n          this.generateProactiveCoverageAck(coveredQuestions);\n      }\n      \n      // If pending follow-up needed, store it (unless forced to skip due to consecutive minimal responses)\n      if ((triageDecision.outcome === 'partial' || triageDecision.outcome === 'vague') && \n          triageDecision.followUpPrompt && !shouldForceNewTopic) {\n        memory.pendingFollowUp = triageDecision.followUpPrompt;\n      }\n      \n      // Handle candidate asking a question - we need to answer it first\n      if (triageDecision.outcome === 'has_question' && triageDecision.candidateQuestion) {\n        memory.pendingCandidateQuestion = triageDecision.candidateQuestion;\n      }\n    }\n    \n    // Adaptive reflection: skip for wrapup answers, only ~40% for core with longer answers\n    let reflectionText: string | undefined;\n    if (answeredQuestionStage === \"core\" && shouldGenerateReflection(answer, answeredQuestionStage)) {\n      const interviewerName = this.getInterviewerName(session.interviewType);\n      reflectionText = await this.reflection.generate(answer, memory.lastReflection, interviewerName);\n      memory.lastReflection = reflectionText;\n    }\n    \n    // Add proactive coverage acknowledgment to reflection if applicable\n    if (proactiveCoverageAck) {\n      reflectionText = reflectionText \n        ? `${reflectionText} ${proactiveCoverageAck}`\n        : proactiveCoverageAck;\n    }\n    \n    // Add time pressure messaging if we're running short\n    let timePressurePrefix = '';\n    if (wrapUpCheck.reason === 'time_pressure' && wrapUpCheck.message) {\n      timePressurePrefix = wrapUpCheck.message + ' ';\n    }\n    \n    // Handle candidate's question if they asked one\n    let candidateQuestionAnswerPrefix = '';\n    let responseAlreadyContainsQuestion = false;\n    let isElaborationOffer = false;\n    \n    if (memory.pendingCandidateQuestion && triageDecision?.outcome === 'has_question') {\n      // Generate answer to the candidate's question using response handler\n      const answerResult = await responseHandler.handleResponse(\n        { \n          intent: 'question_for_recruiter', \n          candidateQuestion: memory.pendingCandidateQuestion,\n          confidence: 0.9,\n          sanitizedText: sanitizedAnswer,\n          injectionDetected: false,\n        },\n        question.questionText,\n        {\n          interviewerName: this.getInterviewerName(session.interviewType),\n          companyName: config.companyName || memory.jobContext?.companyName,\n          companyDescription: config.companyDescription || memory.jobContext?.companyDescription,\n          jobTitle: config.targetRole || config.jobTitle || memory.jobContext?.jobTitle,\n          jobRequirements: config.jobRequirements || memory.jobContext?.jobRequirements,\n        }\n      );\n      if (answerResult.response) {\n        candidateQuestionAnswerPrefix = answerResult.response + ' ';\n        \n        // Check if this is an elaboration offer - if so, use the response alone\n        isElaborationOffer = answerResult.isElaborationOffer || false;\n        \n        // Also check if response ends with ? (fallback for normal questions with redirect)\n        const trimmedResponse = answerResult.response.trim();\n        responseAlreadyContainsQuestion = trimmedResponse.endsWith('?');\n      }\n      memory.pendingCandidateQuestion = undefined; // Clear after handling\n    }\n    \n    // Generate next question based on triage decision and interview plan\n    let nextQuestionText: string;\n    let pendingPlannedQuestion: PlannedQuestion | null = null;\n    \n    // Check if we should do a final wrapup (approaching max questions with good coverage)\n    const sufficiency = this.calculateSufficiency(memory);\n    const isNearingEnd = memory.totalQuestionsAsked >= SUFFICIENCY_CONFIG.maxQuestions - 2;\n    const shouldDoWrapup = isNearingEnd || (sufficiency.overall >= 0.65 && sufficiency.criticalMet);\n    \n    // If forceTopicSwitch is set, we need to pick a completely different topic\n    // Skip background/skills questions and move to motivation, culture_fit, or logistics\n    let forcedTopic: AssessmentCriterion | undefined;\n    if (memory.forceTopicSwitch) {\n      console.log('[Interview] Force topic switch - avoiding example/detail questions');\n      // Pick a topic that hasn't been heavily covered yet\n      const softTopics: AssessmentCriterion[] = ['motivation', 'culture_fit', 'logistics'];\n      forcedTopic = softTopics.find(t => memory.coverage[t].score < 0.5) || 'motivation';\n      memory.forceTopicSwitch = false; // Reset the flag\n    }\n    \n    if (shouldDoWrapup && !sufficiency.gaps.includes('logistics')) {\n      // We have good coverage - do a natural wrapup\n      nextQuestionText = await this.wrapup.generate(config);\n    } else if (memory.pendingFollowUp && triageDecision?.action === 'follow_up' && !forcedTopic) {\n      // Use the follow-up question for partial/vague answers (unless forcing topic switch)\n      nextQuestionText = memory.pendingFollowUp;\n      memory.pendingFollowUp = undefined; // Clear after use\n      memory.telemetry.followUpsUsed++; // Track follow-up usage for telemetry\n    } else if (memory.interviewPlan && !forcedTopic) {\n      // Use the next planned question from the backlog (unless forcing topic switch)\n      pendingPlannedQuestion = this.getNextPlannedQuestion(memory);\n      if (pendingPlannedQuestion) {\n        nextQuestionText = pendingPlannedQuestion.question;\n        // Note: We'll mark this as asked ONLY after we confirm we're using it (see below)\n      } else {\n        // Fallback to dynamic generation if no more planned questions\n        const prioritizedTopic = this.getPrioritizedTopic(memory);\n        nextQuestionText = await this.questionGenerator.generate({\n          config,\n          questionIndex: nextQuestionIndex,\n          previousQuestions: memory.questions,\n          previousAnswers: memory.answers,\n          previousScores: memory.scores,\n          activeProject: memory.activeProject,\n          prioritizedTopic: prioritizedTopic || undefined,\n        });\n      }\n    } else {\n      // Fallback: Generate a focused question based on coverage gaps or forced topic\n      const prioritizedTopic = forcedTopic || this.getPrioritizedTopic(memory);\n      nextQuestionText = await this.questionGenerator.generate({\n        config: {\n          ...config,\n          difficulty: decision.difficultyAdjustment === \"easier\" \n            ? this.adjustDifficulty(config.difficulty, -1)\n            : decision.difficultyAdjustment === \"harder\"\n            ? this.adjustDifficulty(config.difficulty, 1)\n            : config.difficulty,\n        },\n        questionIndex: nextQuestionIndex,\n        previousQuestions: memory.questions,\n        previousAnswers: memory.answers,\n        previousScores: memory.scores,\n        activeProject: memory.activeProject,\n        prioritizedTopic: prioritizedTopic || undefined,\n      });\n    }\n    \n    // Prepend time pressure message if applicable\n    if (timePressurePrefix) {\n      nextQuestionText = timePressurePrefix + nextQuestionText;\n    }\n    \n    // Track whether we actually used the planned question\n    let usedPlannedQuestion = true;\n    \n    // Handle candidate's question answer:\n    // - If it's an elaboration offer, use just the response (let them elaborate first)\n    // - If response ends with ?, use just the response (it already prompts them)\n    // - Otherwise, prepend the answer to the next planned question\n    if (candidateQuestionAnswerPrefix) {\n      if (isElaborationOffer) {\n        // Candidate offered to elaborate - just acknowledge and let them continue\n        // Don't add another question, keep the planned question for after they elaborate\n        nextQuestionText = candidateQuestionAnswerPrefix.trim();\n        usedPlannedQuestion = false; // Keep the planned question pending\n      } else if (responseAlreadyContainsQuestion) {\n        // Our response already ends with a question - use it as-is without appending another\n        // This avoids redundant double-questions like \"Could you walk me through it? Also, can you give an example?\"\n        nextQuestionText = candidateQuestionAnswerPrefix.trim();\n        usedPlannedQuestion = false; // Keep the planned question pending\n      } else {\n        // Our response is a statement - prepend it to the planned question\n        nextQuestionText = candidateQuestionAnswerPrefix + nextQuestionText;\n      }\n    }\n    \n    // Mark the planned question as asked ONLY if we actually used it\n    if (usedPlannedQuestion && pendingPlannedQuestion) {\n      this.markQuestionAsked(memory, pendingPlannedQuestion.id);\n    }\n\n    memory.questions.push(nextQuestionText);\n    \n    // Reset repeat counter when moving to a new question\n    memory.currentQuestionRepeatCount = 0;\n\n    const nextQuestion = await storage.createInterviewQuestion({\n      sessionId,\n      questionIndex: nextQuestionIndex,\n      questionText: nextQuestionText,\n      questionType: this.getQuestionType(nextQuestionIndex, config.totalQuestions, decision),\n      expectedCriteria: this.getExpectedCriteria(config, nextQuestionIndex),\n    });\n\n    // Calculate pacing info for frontend\n    const stageConfig = getStageRuntimeConfig(config.interviewType as 'hr' | 'technical' | 'final');\n    const pacing = this.getPacingInfo(memory, stageConfig);\n    \n    return { evaluation, decision, nextQuestion, reflection: reflectionText, candidateQuestionAnswer, pacing };\n  }\n\n  async generateFinalReport(sessionId: number): Promise<FinalReport> {\n    const session = await storage.getInterviewSession(sessionId);\n    if (!session) {\n      throw new Error(\"Interview session not found\");\n    }\n\n    const questions = await storage.getInterviewQuestions(sessionId);\n    const memory = this.memory.get(sessionId);\n    const config = this.getConfig(session, memory?.jobContext);\n\n    const questionsAndAnswers = questions\n      .filter(q => q.candidateAnswer)\n      .map(q => ({\n        question: q.questionText,\n        answer: q.candidateAnswer!,\n        score: q.score || 5,\n        feedback: q.feedback || \"\",\n      }));\n\n    const scores = questionsAndAnswers.map(qa => qa.score);\n\n    const report = await this.scoring.generateReport(config, questionsAndAnswers, scores);\n\n    await storage.createInterviewFeedback({\n      sessionId,\n      overallScore: report.overallScore,\n      communicationScore: report.communicationScore,\n      technicalScore: report.technicalScore,\n      problemSolvingScore: report.problemSolvingScore,\n      cultureFitScore: report.cultureFitScore,\n      summary: report.summary,\n      strengths: report.strengths,\n      improvements: report.improvements,\n      recommendations: report.recommendations,\n      hiringDecision: report.hiringDecision,\n    });\n\n    return report;\n  }\n\n  async getInterviewStatus(sessionId: number) {\n    const session = await storage.getInterviewSession(sessionId);\n    if (!session) {\n      throw new Error(\"Interview session not found\");\n    }\n\n    const questions = await storage.getInterviewQuestions(sessionId);\n    const feedback = await storage.getInterviewFeedback(sessionId);\n\n    return {\n      session,\n      questions,\n      feedback,\n      progress: {\n        current: session.currentQuestionIndex + 1,\n        total: session.totalQuestions,\n        percentage: Math.round(((session.currentQuestionIndex + 1) / session.totalQuestions) * 100),\n      },\n    };\n  }\n\n  private getExpectedCriteria(config: InterviewConfig, questionIndex: number): object {\n    const baseCriteria = {\n      clarity: \"Response should be clear and well-structured\",\n      relevance: \"Response should directly address the question\",\n      depth: \"Response should demonstrate appropriate depth of knowledge\",\n    };\n\n    if (config.interviewType === \"behavioral\") {\n      return {\n        ...baseCriteria,\n        starMethod: \"Response should follow STAR format (Situation, Task, Action, Result)\",\n        specificity: \"Response should include specific examples\",\n      };\n    }\n\n    if (config.interviewType === \"technical\") {\n      return {\n        ...baseCriteria,\n        technicalAccuracy: \"Response should be technically accurate\",\n        problemSolving: \"Response should demonstrate problem-solving approach\",\n      };\n    }\n\n    return baseCriteria;\n  }\n\n  private getQuestionType(\n    index: number, \n    total: number, \n    decision: FollowUpDecision\n  ): string {\n    if (decision.action === \"follow_up\") return \"follow-up\";\n    if (index === 0) return \"opening\";\n    if (index === total - 1) return \"closing\";\n    return \"main\";\n  }\n\n  private adjustDifficulty(current: string, delta: number): string {\n    const levels = [\"easy\", \"medium\", \"hard\"];\n    const currentIndex = levels.indexOf(current);\n    const newIndex = Math.max(0, Math.min(levels.length - 1, currentIndex + delta));\n    return levels[newIndex];\n  }\n\n  private getInterviewerName(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"Sarah\";\n      case \"technical\":\n        return \"Michael\";\n      case \"system-design\":\n        return \"David\";\n      case \"case-study\":\n        return \"Jennifer\";\n      default:\n        return \"Alex\";\n    }\n  }\n\n  private getInterviewerRole(interviewType: string): string {\n    switch (interviewType) {\n      case \"behavioral\":\n      case \"recruiter_call\":\n        return \"HR Recruiter\";\n      case \"technical\":\n        return \"Engineering Manager\";\n      case \"system-design\":\n        return \"Senior Architect\";\n      case \"case-study\":\n        return \"Business Analyst\";\n      default:\n        return \"Hiring Manager\";\n    }\n  }\n\n  /**\n   * Process a conversation turn using the unified chain (single LLM call per turn).\n   * This replaces the fragmented multi-chain approach with a more natural flow.\n   */\n  private async processAnswerUnified(\n    sessionId: number,\n    questionId: number,\n    answer: string,\n    session: InterviewSession,\n    question: InterviewQuestion\n  ): Promise<{\n    evaluation?: EvaluationResult;\n    decision?: FollowUpDecision;\n    nextQuestion?: InterviewQuestion;\n    reflection?: string;\n    finalReport?: FinalReport;\n    closure?: string;\n    pacing?: {\n      elapsedMinutes: number;\n      progressPercent: number;\n      status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n    };\n  }> {\n    const memory = this.getMemory(sessionId);\n    const config = this.getConfig(session, memory.jobContext);\n    const interviewerName = this.getInterviewerName(session.interviewType);\n    const interviewerRole = this.getInterviewerRole(session.interviewType);\n\n    // =========================================================================\n    // TWO-PHASE WRAP-UP: Check if we're waiting for candidate's response to \"any questions?\"\n    // =========================================================================\n    if (memory.pendingWrapUp) {\n      console.log('[Unified Chain] Completing pending wrap-up after candidate response');\n      \n      // Add candidate's answer to conversation history\n      memory.conversationHistory.push({\n        role: 'candidate',\n        content: answer,\n      });\n      \n      // Save candidate's response to the closing question (no score - not an evaluation question)\n      await storage.updateInterviewQuestion(questionId, {\n        candidateAnswer: answer,\n        feedback: 'Closing question response - not scored',\n        answeredAt: new Date(),\n      });\n      \n      // Generate a brief closure message (thanking them, next steps)\n      const closureMessage = await this.closure.generate(config, memory.candidateName);\n      \n      // Add closure to conversation history for completeness\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: closureMessage,\n      });\n      \n      // Clear the pending wrap-up flag before generating report\n      const wrapUpReason = memory.pendingWrapUp.wrapUpReason;\n      memory.pendingWrapUp = undefined;\n      \n      // Generate final report (uses only actual scored questions from memory.scores)\n      const finalReport = await this.generateFinalReport(sessionId);\n      \n      console.log('[Telemetry] Wrap-up completed:', {\n        sessionId,\n        trigger: 'pending_wrap_up_resolved',\n        reason: wrapUpReason,\n        questionsAsked: memory.totalQuestionsAsked,\n        avgScore: memory.scores.length > 0 \n          ? Math.round((memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length) * 10) / 10\n          : 0,\n        sessionDurationMs: Date.now() - memory.telemetry.startedAt,\n      });\n      \n      await storage.updateInterviewSession(sessionId, {\n        status: \"completed\",\n        overallScore: finalReport.overallScore,\n        completedAt: new Date(),\n      });\n\n      this.memory.delete(sessionId);\n\n      return {\n        finalReport,\n        closure: closureMessage,\n      };\n    }\n\n    // Add candidate's answer to conversation history\n    memory.conversationHistory.push({\n      role: 'candidate',\n      content: answer,\n    });\n\n    // Capture coverage BEFORE this turn for telemetry\n    const coverageBefore = {\n      background: memory.coverage.background.score,\n      skills: memory.coverage.skills.score,\n      behavioral: memory.coverage.behavioral.score,\n      motivation: memory.coverage.motivation.score,\n      culture_fit: memory.coverage.culture_fit.score,\n      logistics: memory.coverage.logistics.score,\n    };\n    \n    // Calculate overall coverage before\n    const overallBefore = Object.values(coverageBefore).reduce((a, b) => a + b, 0) / 6;\n\n    // Build coverage status for the unified chain\n    const coverageStatus = coverageBefore;\n\n    // Call the unified chain with criterion probe tracking\n    const turnResult = await this.unifiedTurn.processTurn({\n      interviewerName,\n      interviewerRole,\n      companyName: config.companyName || 'the company',\n      companyDescription: config.companyDescription || '',\n      jobTitle: config.jobTitle || config.targetRole,\n      jobRequirements: config.jobRequirements || '',\n      candidateName: memory.candidateName || 'Candidate',\n      conversationHistory: memory.conversationHistory,\n      questionBacklog: memory.interviewPlan?.questions || [],\n      coverageStatus,\n      questionsAskedCount: memory.totalQuestionsAsked,\n      maxQuestions: config.stageSettings?.maxQuestions || 12,\n      lastQuestionId: memory.currentQuestionId,\n      consecutiveCriterionProbes: memory.consecutiveCriterionProbes,\n    });\n\n    console.log('[Unified Chain] Turn result:', {\n      actionType: turnResult.actionType,\n      questionId: turnResult.questionId,\n      score: turnResult.evaluation.score,\n      criterion: turnResult.evaluation.criterionCovered,\n    });\n\n    // Update memory with evaluation\n    const evaluation: EvaluationResult = {\n      score: turnResult.evaluation.score,\n      feedback: `Score: ${turnResult.evaluation.score}/10`,\n      strengths: turnResult.evaluation.strengths,\n      improvements: turnResult.evaluation.areasToImprove,\n      projectMentioned: null,\n    };\n\n    memory.answers.push(answer);\n    memory.scores.push(evaluation.score);\n    memory.evaluations.push(evaluation);\n    memory.totalQuestionsAsked++;\n\n    // Update coverage from unified chain's evaluation\n    const criterion = turnResult.evaluation.criterionCovered;\n    if (memory.coverage[criterion]) {\n      memory.coverage[criterion].score = Math.min(1, \n        memory.coverage[criterion].score + turnResult.evaluation.coverageContribution\n      );\n      memory.coverage[criterion].questionsAsked++;\n    }\n    \n    // Track consecutive criterion probes to prevent repetitive questioning\n    if (criterion === memory.consecutiveCriterionProbes.criterion) {\n      memory.consecutiveCriterionProbes.count++;\n    } else {\n      // Different criterion - reset counter\n      memory.consecutiveCriterionProbes = { criterion, count: 1 };\n    }\n    \n    console.log('[Topic Rotation] Criterion probe tracking:', {\n      criterion,\n      consecutiveCount: memory.consecutiveCriterionProbes.count,\n    });\n    \n    // Capture coverage AFTER this turn for telemetry\n    const coverageAfter = {\n      background: memory.coverage.background.score,\n      skills: memory.coverage.skills.score,\n      behavioral: memory.coverage.behavioral.score,\n      motivation: memory.coverage.motivation.score,\n      culture_fit: memory.coverage.culture_fit.score,\n      logistics: memory.coverage.logistics.score,\n    };\n    const overallAfter = Object.values(coverageAfter).reduce((a, b) => a + b, 0) / 6;\n    \n    // Log coverage telemetry with deltas\n    console.log('[Telemetry] Coverage update:', {\n      sessionId,\n      turn: memory.totalQuestionsAsked,\n      criterionUpdated: criterion,\n      contributionAdded: turnResult.evaluation.coverageContribution,\n      before: {\n        overall: Math.round(overallBefore * 100) / 100,\n        ...Object.fromEntries(\n          Object.entries(coverageBefore).map(([k, v]) => [k, Math.round(v * 100) / 100])\n        ),\n      },\n      after: {\n        overall: Math.round(overallAfter * 100) / 100,\n        ...Object.fromEntries(\n          Object.entries(coverageAfter).map(([k, v]) => [k, Math.round(v * 100) / 100])\n        ),\n      },\n      delta: {\n        overall: Math.round((overallAfter - overallBefore) * 100) / 100,\n        [criterion]: Math.round(turnResult.evaluation.coverageContribution * 100) / 100,\n      },\n    });\n\n    // Mark covered questions from backlog\n    if (turnResult.coveredQuestionIds.length > 0 && memory.interviewPlan) {\n      for (const id of turnResult.coveredQuestionIds) {\n        const q = memory.interviewPlan.questions.find(q => q.id === id);\n        if (q) q.status = 'covered_proactively';\n      }\n    }\n\n    // Mark the question as asked if applicable\n    if (turnResult.questionId && memory.interviewPlan) {\n      const q = memory.interviewPlan.questions.find(q => q.id === turnResult.questionId);\n      if (q) {\n        q.status = 'asked';\n        memory.currentQuestionId = turnResult.questionId;\n      }\n    }\n\n    // Update telemetry\n    this.updateTelemetry(memory, evaluation.score);\n\n    // Add interviewer's response to conversation history\n    memory.conversationHistory.push({\n      role: 'interviewer',\n      content: turnResult.response,\n    });\n\n    // Save evaluation to database\n    await storage.updateInterviewQuestion(questionId, {\n      candidateAnswer: answer,\n      score: evaluation.score,\n      feedback: evaluation.feedback,\n      strengths: evaluation.strengths,\n      improvements: evaluation.improvements,\n      answeredAt: new Date(),\n    });\n\n    // Handle wrap-up\n    if (turnResult.actionType === 'wrap_up') {\n      // Log wrap-up telemetry\n      const pendingQuestions = memory.interviewPlan?.questions.filter(q => q.status === 'pending').length || 0;\n      const coveredQuestions = memory.interviewPlan?.questions.filter(q => q.status === 'covered_proactively').length || 0;\n      const askedQuestions = memory.interviewPlan?.questions.filter(q => q.status === 'asked').length || 0;\n      \n      console.log('[Telemetry] Wrap-up triggered:', {\n        sessionId,\n        trigger: 'unified_chain_decision',\n        questionsAsked: memory.totalQuestionsAsked,\n        finalCoverage: {\n          overall: Math.round(overallAfter * 100) / 100,\n          background: Math.round(coverageAfter.background * 100) / 100,\n          skills: Math.round(coverageAfter.skills * 100) / 100,\n          behavioral: Math.round(coverageAfter.behavioral * 100) / 100,\n          motivation: Math.round(coverageAfter.motivation * 100) / 100,\n          culture_fit: Math.round(coverageAfter.culture_fit * 100) / 100,\n          logistics: Math.round(coverageAfter.logistics * 100) / 100,\n        },\n        backlogStatus: {\n          pending: pendingQuestions,\n          asked: askedQuestions,\n          coveredProactively: coveredQuestions,\n          total: memory.interviewPlan?.questions.length || 0,\n        },\n        avgScore: memory.scores.length > 0 \n          ? Math.round((memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length) * 10) / 10\n          : 0,\n        sessionDurationMs: Date.now() - memory.telemetry.startedAt,\n      });\n      \n      // TWO-PHASE WRAP-UP: Always defer if wrapUpReason indicates a conversational close\n      // The chain sets wrapUpReason when it decides to wrap up - trust that signal\n      const shouldDeferWrapUp = !!turnResult.wrapUpReason;\n      \n      if (shouldDeferWrapUp) {\n        console.log('[Unified Chain] Deferring wrap-up - waiting for candidate response', {\n          wrapUpReason: turnResult.wrapUpReason,\n          hasQuestion: turnResult.response.includes('?'),\n        });\n        \n        // Set pending wrap-up state\n        memory.pendingWrapUp = {\n          wrapUpReason: turnResult.wrapUpReason || 'sufficient_coverage',\n          timestamp: Date.now(),\n          closurePromptAsked: true,\n        };\n        \n        // Continue the interview to get the candidate's response to \"any questions?\"\n        const nextQuestionIndex = session.currentQuestionIndex + 1;\n        \n        await storage.updateInterviewSession(sessionId, {\n          currentQuestionIndex: nextQuestionIndex,\n        });\n        \n        // Create the wrap-up prompt as a closing question (not core)\n        const nextQuestion = await storage.createInterviewQuestion({\n          sessionId: session.id,\n          questionIndex: nextQuestionIndex,\n          questionText: turnResult.response,\n          questionType: 'closing', // Distinct from core questions\n          expectedCriteria: {},\n        });\n        \n        // Don't increment totalQuestionsAsked for closing prompts - they're not evaluation questions\n        memory.questions.push(turnResult.response);\n        memory.currentStage = 'wrapup';\n        \n        // Calculate pacing info for frontend (show wrapping_soon status)\n        const stageConfig = getStageRuntimeConfig(config.interviewType as 'hr' | 'technical' | 'final');\n        const pacing = this.getPacingInfo(memory, stageConfig);\n        // Override status to indicate wrap-up phase\n        pacing.status = 'wrapping_soon';\n        \n        return {\n          evaluation,\n          nextQuestion,\n          decision: {\n            action: 'next_question',\n            reason: 'Wrap-up question - waiting for candidate response',\n          },\n          pacing,\n        };\n      }\n      \n      // Direct closure (no question in response) - finalize immediately\n      const finalReport = await this.generateFinalReport(sessionId);\n\n      await storage.updateInterviewSession(sessionId, {\n        status: \"completed\",\n        overallScore: finalReport.overallScore,\n        completedAt: new Date(),\n      });\n\n      this.memory.delete(sessionId);\n\n      return {\n        evaluation,\n        finalReport,\n        closure: turnResult.response,\n      };\n    }\n\n    // Continue with next question\n    const nextQuestionIndex = session.currentQuestionIndex + 1;\n\n    await storage.updateInterviewSession(sessionId, {\n      currentQuestionIndex: nextQuestionIndex,\n    });\n\n    // Create next question record\n    const nextQuestion = await storage.createInterviewQuestion({\n      sessionId: session.id,\n      questionIndex: nextQuestionIndex,\n      questionText: turnResult.response,\n      questionType: turnResult.actionType === 'follow_up' ? 'follow_up' : 'core',\n      expectedCriteria: this.getExpectedCriteria(config, nextQuestionIndex),\n    });\n\n    memory.questions.push(turnResult.response);\n    memory.currentStage = 'core';\n\n    // Calculate pacing info for frontend\n    const stageConfig = getStageRuntimeConfig(config.interviewType as 'hr' | 'technical' | 'final');\n    const pacing = this.getPacingInfo(memory, stageConfig);\n\n    return {\n      evaluation,\n      nextQuestion,\n      decision: {\n        action: turnResult.actionType === 'follow_up' ? 'follow_up' : 'next_question',\n        reason: 'Unified chain decision',\n      },\n      pacing,\n    };\n  }\n\n  /**\n   * Process a conversation turn for team interviews with multi-persona support\n   * and level-calibrated evaluation.\n   */\n  private async processAnswerTeam(\n    sessionId: number,\n    questionId: number,\n    answer: string,\n    session: InterviewSession,\n    question: InterviewQuestion\n  ): Promise<{\n    evaluation?: EvaluationResult;\n    decision?: FollowUpDecision;\n    nextQuestion?: InterviewQuestion;\n    reflection?: string;\n    finalReport?: FinalReport;\n    closure?: string;\n    teamClosing?: {\n      primary: {\n        message: string;\n        persona: { id: string; name: string; role: string; displayRole: string };\n      };\n      secondary: {\n        message: string;\n        persona: { id: string; name: string; role: string; displayRole: string };\n      } | null;\n    };\n    pacing?: {\n      elapsedMinutes: number;\n      progressPercent: number;\n      status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n    };\n    activePersona?: { id: string; name: string; role: string; displayRole: string };\n    teamPersonas?: Array<{ id: string; name: string; role: string; displayRole: string }>;\n  }> {\n    const memory = this.getMemory(sessionId);\n    const config = this.getConfig(session, memory.jobContext);\n    const settings = memory.teamSettings!;\n    \n    // Initialize tracking if needed\n    memory.askedQuestionIds = memory.askedQuestionIds || new Set();\n    memory.personaQuestionCounts = memory.personaQuestionCounts || {};\n    for (const p of settings.personas) {\n      if (!memory.personaQuestionCounts[p.id]) {\n        memory.personaQuestionCounts[p.id] = 0;\n      }\n    }\n\n    // PERSONA ROTATION GOVERNANCE\n    const primaryPersona = settings.personas[0];\n    const secondaryPersona = settings.personas[1];\n    \n    // FIRST: Check if another persona was forced (e.g., mentioned by name previously)\n    // This takes priority over all other persona selection logic\n    let activePersona: TeamInterviewPersona;\n    if (memory.forcedNextPersonaId) {\n      const forcedPersona = settings.personas.find(p => p.id === memory.forcedNextPersonaId);\n      if (forcedPersona) {\n        activePersona = forcedPersona;\n        memory.activePersonaId = forcedPersona.id;\n        console.log('[Team Interview] Forced persona switch to:', forcedPersona.name);\n      } else {\n        activePersona = settings.personas.find(p => p.id === memory.activePersonaId) || primaryPersona;\n      }\n      // Clear the forced flag after use\n      memory.forcedNextPersonaId = undefined;\n    } else {\n      // Normal persona selection\n      activePersona = settings.personas.find(p => p.id === memory.activePersonaId) || primaryPersona;\n    }\n    \n    // SECOND: Force rotation if one persona is dominating (more than 3 consecutive turns)\n    // Only apply if no forced persona and secondary hasn't spoken\n    if (!memory.forcedNextPersonaId && secondaryPersona) {\n      const primaryCount = memory.personaQuestionCounts[primaryPersona.id] || 0;\n      const secondaryCount = memory.personaQuestionCounts[secondaryPersona.id] || 0;\n      \n      // If secondary persona hasn't spoken and primary has asked 3+ questions, force switch\n      if (secondaryCount === 0 && primaryCount >= 3 && activePersona.id === primaryPersona.id) {\n        activePersona = secondaryPersona;\n        memory.activePersonaId = secondaryPersona.id;\n        console.log('[Team Interview] Forcing secondary persona turn - imbalance detected');\n      }\n    }\n\n    // Add candidate's answer to conversation history\n    memory.conversationHistory.push({\n      role: 'candidate',\n      content: answer,\n    });\n\n    // Filter out already-asked questions from backlog\n    const filteredBacklog = (memory.teamQuestionBacklog || []).filter(q => {\n      return !memory.askedQuestionIds?.has(q.id);\n    });\n\n    // Build coverage status for team interview criteria\n    const coverageStatus: Record<string, number> = {\n      learning_mindset: memory.coverage.behavioral.score,\n      collaboration: memory.coverage.culture_fit.score,\n      problem_solving: memory.coverage.skills.score,\n      technical_foundations: memory.coverage.background.score,\n    };\n\n    // Call the team interview chain with filtered backlog\n    const turnResult = await this.teamTurn.processTurn({\n      activePersona,\n      allPersonas: settings.personas,\n      experienceLevel: settings.experienceLevel,\n      companyName: config.companyName || 'the company',\n      companyDescription: config.companyDescription || '',\n      jobTitle: config.jobTitle || config.targetRole,\n      candidateName: memory.candidateName || 'Candidate',\n      conversationHistory: memory.conversationHistory,\n      questionBacklog: filteredBacklog, // Use filtered backlog to prevent repetition\n      coverageStatus,\n      questionsAskedCount: memory.totalQuestionsAsked,\n      maxQuestions: settings.maxQuestions,\n      currentQuestionId: memory.currentQuestionId,\n      levelExpectations: getLevelExpectationsText(settings),\n    });\n\n    // Track asked question to prevent repetition\n    if (turnResult.questionId) {\n      memory.askedQuestionIds!.add(turnResult.questionId);\n    }\n    // Also mark any questions the chain indicated were covered\n    if (turnResult.coveredQuestionIds) {\n      for (const qId of turnResult.coveredQuestionIds) {\n        memory.askedQuestionIds!.add(qId);\n      }\n    }\n\n    console.log('[Team Interview] Turn result:', {\n      activePersona: activePersona.name,\n      actionType: turnResult.actionType,\n      nextPersona: turnResult.nextPersonaId,\n      score: turnResult.evaluation.score,\n      criterion: turnResult.evaluation.criterionCovered,\n    });\n\n    // Evaluate team completion using coverage-based logic (similar to HR screening)\n    const completionDecision = this.evaluateTeamCompletion(memory, settings, turnResult);\n    \n    if (completionDecision.shouldWrapUp && turnResult.actionType !== 'wrap_up') {\n      console.log('[Team Interview] Completion evaluator triggered wrap-up:', {\n        reason: completionDecision.reason,\n        questionsAsked: memory.totalQuestionsAsked,\n        maxQuestions: settings.maxQuestions,\n        coverage: completionDecision.coverageSummary,\n      });\n      turnResult.actionType = 'wrap_up';\n      turnResult.wrapUpReason = completionDecision.message;\n    }\n\n    // Update memory with evaluation\n    const evaluation: EvaluationResult = {\n      score: turnResult.evaluation.score,\n      feedback: `Score: ${turnResult.evaluation.score}/10 (${settings.experienceLevel} level)`,\n      strengths: turnResult.evaluation.strengths,\n      improvements: turnResult.evaluation.areasToImprove,\n      projectMentioned: null,\n    };\n\n    memory.answers.push(answer);\n    memory.scores.push(evaluation.score);\n    memory.evaluations.push(evaluation);\n    memory.totalQuestionsAsked++;\n    memory.personaQuestionCounts![activePersona.id] = (memory.personaQuestionCounts![activePersona.id] || 0) + 1;\n\n    // Map team interview criteria to coverage tracker\n    const criterionMapping: Record<string, keyof CoverageTracker> = {\n      'learning_mindset': 'behavioral',\n      'collaboration': 'culture_fit',\n      'problem_solving': 'skills',\n      'technical_foundations': 'background',\n    };\n    const mappedCriterion = criterionMapping[turnResult.evaluation.criterionCovered] || 'behavioral';\n    if (memory.coverage[mappedCriterion]) {\n      memory.coverage[mappedCriterion].score = Math.min(1,\n        memory.coverage[mappedCriterion].score + turnResult.evaluation.coverageContribution\n      );\n      memory.coverage[mappedCriterion].questionsAsked++;\n    }\n\n    // Handle persona handoff with cooldown enforcement\n    // Prevent ping-pong by requiring at least 2 consecutive turns before allowing handoff\n    // Initialize tracking if needed\n    memory.consecutivePersonaTurns = memory.consecutivePersonaTurns || {};\n    \n    // Always increment the current persona's turn count FIRST (before evaluating handoff)\n    memory.consecutivePersonaTurns[activePersona.id] = (memory.consecutivePersonaTurns[activePersona.id] || 0) + 1;\n    const currentPersonaTurns = memory.consecutivePersonaTurns[activePersona.id];\n    \n    if (turnResult.actionType === 'hand_off' && turnResult.nextPersonaId) {\n      // Enforce handoff cooldown: need at least 2 turns before handoff allowed\n      const MIN_TURNS_BEFORE_HANDOFF = 2;\n      if (currentPersonaTurns < MIN_TURNS_BEFORE_HANDOFF) {\n        console.log('[Team Interview] Handoff blocked - cooldown active:', {\n          persona: activePersona.name,\n          turns: currentPersonaTurns,\n          required: MIN_TURNS_BEFORE_HANDOFF,\n        });\n        // Convert to 'continue' instead - stay with current persona\n        turnResult.actionType = 'continue';\n      } else {\n        // Handoff allowed - switch active persona\n        // Keep current persona's count so they can't immediately hand back if they return\n        memory.activePersonaId = turnResult.nextPersonaId;\n        // Initialize new persona's count to 0 (they need to build up turns before they can hand off)\n        memory.consecutivePersonaTurns[turnResult.nextPersonaId] = 0;\n        const nextPersona = settings.personas.find(p => p.id === turnResult.nextPersonaId);\n        console.log('[Team Interview] Handoff to:', nextPersona?.name);\n      }\n    }\n\n    // ADDRESSED PERSONA DETECTION\n    // Check if the response mentions another persona by name (e.g., \"Sarah, do you have any questions?\")\n    // If so, immediately generate their response (no waiting for user input)\n    const responseLower = turnResult.response.toLowerCase();\n    let addressedPersona: typeof settings.personas[0] | null = null;\n    let addressedResponse: string | null = null;\n    \n    for (const persona of settings.personas) {\n      if (persona.id !== activePersona.id) {\n        const namePattern = new RegExp(`\\\\b${persona.name.toLowerCase()}\\\\b`, 'i');\n        // Check for patterns like asking Sarah directly\n        if (namePattern.test(responseLower) && \n            (responseLower.includes('?') || // Contains a question\n             responseLower.includes('would you') ||\n             responseLower.includes('do you') ||\n             responseLower.includes('any questions') ||\n             responseLower.includes('want to'))) {\n          addressedPersona = persona;\n          console.log('[Team Interview] Detected address to:', persona.name, '- generating immediate response');\n          break;\n        }\n      }\n    }\n    \n    // If another persona was addressed, generate their immediate response\n    if (addressedPersona) {\n      // Generate the addressed persona's response\n      const addressedTurnResult = await this.teamTurn.processTurn({\n        activePersona: addressedPersona,\n        allPersonas: settings.personas,\n        experienceLevel: settings.experienceLevel,\n        companyName: config.companyName || 'the company',\n        companyDescription: config.companyDescription || '',\n        jobTitle: config.jobTitle || config.targetRole,\n        candidateName: memory.candidateName || 'Candidate',\n        conversationHistory: [\n          ...memory.conversationHistory,\n          { role: 'interviewer', content: turnResult.response, personaId: activePersona.id }\n        ],\n        questionBacklog: (memory.teamQuestionBacklog || []).filter(q => !memory.askedQuestionIds?.has(q.id)),\n        coverageStatus: {\n          learning_mindset: memory.coverage.behavioral.score,\n          collaboration: memory.coverage.culture_fit.score,\n          problem_solving: memory.coverage.skills.score,\n          technical_foundations: memory.coverage.background.score,\n        },\n        questionsAskedCount: memory.totalQuestionsAsked,\n        maxQuestions: settings.maxQuestions,\n        currentQuestionId: memory.currentQuestionId,\n        levelExpectations: getLevelExpectationsText(settings),\n      });\n      \n      addressedResponse = addressedTurnResult.response;\n      memory.activePersonaId = addressedPersona.id;\n      \n      // Track the addressed persona's question\n      if (addressedTurnResult.questionId) {\n        memory.askedQuestionIds!.add(addressedTurnResult.questionId);\n      }\n    }\n\n    // Update telemetry\n    this.updateTelemetry(memory, evaluation.score);\n\n    // Add interviewer's response to conversation history with persona info\n    memory.conversationHistory.push({\n      role: 'interviewer',\n      content: turnResult.response,\n      personaId: activePersona.id,\n    });\n    \n    // If there was an addressed response, add it too\n    if (addressedPersona && addressedResponse) {\n      memory.conversationHistory.push({\n        role: 'interviewer',\n        content: addressedResponse,\n        personaId: addressedPersona.id,\n      });\n    }\n\n    // Save evaluation to database\n    await storage.updateInterviewQuestion(questionId, {\n      candidateAnswer: answer,\n      score: evaluation.score,\n      feedback: evaluation.feedback,\n      strengths: evaluation.strengths,\n      improvements: evaluation.improvements,\n      answeredAt: new Date(),\n    });\n\n    // Handle wrap-up\n    if (turnResult.actionType === 'wrap_up') {\n      console.log('[Team Interview] Wrap-up triggered:', {\n        sessionId,\n        experienceLevel: settings.experienceLevel,\n        questionsAsked: memory.totalQuestionsAsked,\n        personaBreakdown: memory.personaQuestionCounts,\n        avgScore: memory.scores.length > 0\n          ? Math.round((memory.scores.reduce((a, b) => a + b, 0) / memory.scores.length) * 10) / 10\n          : 0,\n        reason: turnResult.wrapUpReason,\n      });\n\n      // Generate team closing with both personas\n      const topicsCovered = Object.entries(memory.coverage)\n        .filter(([_, v]) => v.score > 0.3)\n        .map(([k, _]) => k);\n\n      const closingResult = await this.teamWrapUp.generateClosing(\n        settings,\n        config.companyName || 'the company',\n        config.jobTitle || config.targetRole,\n        memory.candidateName || 'Candidate',\n        memory.totalQuestionsAsked,\n        topicsCovered\n      );\n\n      console.log('[Team Interview] Closing generated:', {\n        hasPrimaryClosing: !!closingResult.primaryClosing,\n        hasSecondaryClosing: !!closingResult.secondaryClosing,\n      });\n\n      const finalReport = await this.generateFinalReport(sessionId);\n\n      await storage.updateInterviewSession(sessionId, {\n        status: \"completed\",\n        overallScore: finalReport.overallScore,\n        completedAt: new Date(),\n      });\n\n      this.memory.delete(sessionId);\n\n      // Return separate closing messages with persona info for proper UI display\n      const primaryPersona = settings.personas[0];\n      const secondaryPersona = settings.personas[1];\n\n      return {\n        evaluation,\n        finalReport,\n        closure: closingResult.combinedClosing, // Keep for backward compatibility\n        // New: separate closings with persona info\n        teamClosing: {\n          primary: {\n            message: closingResult.primaryClosing,\n            persona: {\n              id: primaryPersona.id,\n              name: primaryPersona.name,\n              role: primaryPersona.role,\n              displayRole: primaryPersona.displayRole,\n            },\n          },\n          secondary: secondaryPersona ? {\n            message: closingResult.secondaryClosing,\n            persona: {\n              id: secondaryPersona.id,\n              name: secondaryPersona.name,\n              role: secondaryPersona.role,\n              displayRole: secondaryPersona.displayRole,\n            },\n          } : null,\n        },\n      };\n    }\n\n    // Continue with next question\n    const nextQuestionIndex = session.currentQuestionIndex + 1;\n\n    await storage.updateInterviewSession(sessionId, {\n      currentQuestionIndex: nextQuestionIndex,\n    });\n\n    // Create next question record\n    const nextQuestion = await storage.createInterviewQuestion({\n      sessionId: session.id,\n      questionIndex: nextQuestionIndex,\n      questionText: turnResult.response,\n      questionType: turnResult.actionType === 'follow_up' ? 'follow_up' : 'core',\n      expectedCriteria: this.getExpectedCriteria(config, nextQuestionIndex),\n    });\n\n    memory.questions.push(turnResult.response);\n    memory.currentStage = 'core';\n\n    // Calculate pacing info for frontend\n    const stageConfig = getStageRuntimeConfig('hr'); // Team interviews use HR pacing\n    const pacing = this.getPacingInfo(memory, stageConfig);\n\n    // Build the result with optional follow-up from addressed persona\n    const result: any = {\n      evaluation,\n      nextQuestion,\n      decision: {\n        action: turnResult.actionType === 'follow_up' ? 'follow_up' : 'next_question',\n        reason: `Team interview - ${activePersona.name}`,\n      },\n      pacing,\n      // Include persona info for team interview UI\n      activePersona: {\n        id: activePersona.id,\n        name: activePersona.name,\n        role: activePersona.role,\n        displayRole: activePersona.displayRole,\n      },\n      teamPersonas: settings.personas.map(p => ({\n        id: p.id,\n        name: p.name,\n        role: p.role,\n        displayRole: p.displayRole,\n      })),\n    };\n    \n    // If another persona was addressed and responded, include their response\n    if (addressedPersona && addressedResponse) {\n      result.addressedPersonaResponse = {\n        personaId: addressedPersona.id,\n        personaName: addressedPersona.name,\n        personaRole: addressedPersona.displayRole,\n        content: addressedResponse,\n      };\n      // Track who should be active AFTER both messages are shown\n      // activePersona stays as the original speaker for their question\n      result.nextActivePersona = {\n        id: addressedPersona.id,\n        name: addressedPersona.name,\n        role: addressedPersona.role,\n        displayRole: addressedPersona.displayRole,\n      };\n    }\n    \n    return result;\n  }\n}\n\nexport const interviewOrchestrator = new InterviewOrchestrator();\n","path":null,"size_bytes":119628,"size_tokens":null},"client/src/components/OfferLetter.tsx":{"content":"import { useState } from \"react\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  Building2, Calendar, DollarSign, Briefcase, Heart, Users, \n  Clock, Gift, CheckCircle2, Sparkles,\n  Medal, ChevronDown, ChevronUp\n} from \"lucide-react\";\nimport type { OfferDetails } from \"@shared/schema\";\n\ninterface Company {\n  id: number;\n  name: string;\n  logo: string | null;\n  industry: string;\n}\n\ninterface JobPosting {\n  title: string;\n  role: string;\n  location: string;\n  department?: string;\n}\n\ninterface OfferLetterProps {\n  offer: OfferDetails;\n  company: Company;\n  job: JobPosting;\n  candidateName: string;\n  onProceedToNegotiation: () => void;\n  onAcceptOffer?: () => void;\n  onDeclineOffer?: () => void;\n  isLoading?: boolean;\n}\n\nfunction formatCurrency(amount: number): string {\n  return new Intl.NumberFormat('en-US', {\n    style: 'currency',\n    currency: 'USD',\n    maximumFractionDigits: 0,\n  }).format(amount);\n}\n\nfunction calculateTotalComp(offer: OfferDetails): {\n  base: number;\n  bonus: number;\n  equity: number;\n  signing: number;\n  totalAnnual: number;\n  totalFirstYear: number;\n} {\n  const base = offer.baseSalary;\n  const bonus = offer.annualBonus \n    ? Math.round(base * (offer.annualBonus.targetPercent / 100))\n    : 0;\n  const equity = offer.equity \n    ? Math.round(offer.equity.amount / 4)\n    : 0;\n  const signing = offer.signingBonus || 0;\n  \n  return {\n    base,\n    bonus,\n    equity,\n    signing,\n    totalAnnual: base + bonus + equity,\n    totalFirstYear: base + bonus + equity + signing,\n  };\n}\n\nexport function OfferLetter({ offer, company, job, candidateName, onProceedToNegotiation, onAcceptOffer, onDeclineOffer, isLoading }: OfferLetterProps) {\n  const [isExpanded, setIsExpanded] = useState(true);\n  const comp = calculateTotalComp(offer);\n  \n  return (\n    <Card className=\"border border-gray-200 dark:border-gray-700 overflow-hidden\">\n      {/* Compact Summary Header - Always Visible */}\n      <div className=\"p-5\">\n        <div className=\"flex items-start justify-between gap-4\">\n          {/* Left: Company & Role Info */}\n          <div className=\"flex items-center gap-4 min-w-0\">\n            <div className=\"h-12 w-12 rounded-lg bg-gray-100 dark:bg-gray-800 flex items-center justify-center text-xl font-bold text-primary border border-gray-200 dark:border-gray-700 flex-shrink-0\">\n              {company.name.charAt(0)}\n            </div>\n            <div className=\"min-w-0\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <h3 className=\"font-semibold text-gray-900 dark:text-white truncate\">\n                  {company.name}\n                </h3>\n                <Badge variant=\"outline\" className=\"border-amber-500 text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 flex-shrink-0\" data-testid=\"badge-offer-pending\">\n                  <Clock className=\"h-3 w-3 mr-1\" />\n                  Pending\n                </Badge>\n              </div>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                {job.title}  {job.location}\n              </p>\n            </div>\n          </div>\n\n          {/* Center: Key Compensation Summary */}\n          <div className=\"hidden md:flex items-center gap-6 flex-shrink-0\">\n            <div className=\"text-right\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide\">Base</p>\n              <p className=\"text-lg font-bold text-gray-900 dark:text-white\" data-testid=\"text-base-salary\">\n                {formatCurrency(offer.baseSalary)}\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide\">First Year</p>\n              <p className=\"text-lg font-bold text-green-600 dark:text-green-400\" data-testid=\"text-first-year-total\">\n                {formatCurrency(comp.totalFirstYear)}\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wide\">Respond By</p>\n              <p className=\"text-sm font-medium text-amber-600 dark:text-amber-400\" data-testid=\"text-deadline\">\n                {offer.responseDeadline}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Actions */}\n          <div className=\"flex items-center gap-2 flex-shrink-0\">\n            <Button \n              variant=\"outline\"\n              size=\"sm\"\n              onClick={onDeclineOffer}\n              disabled={isLoading}\n              className=\"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 border-red-200 dark:border-red-800\"\n              data-testid=\"button-decline\"\n            >\n              {isLoading ? 'Processing...' : 'Decline'}\n            </Button>\n            <Button \n              onClick={onProceedToNegotiation}\n              size=\"sm\"\n              className=\"bg-primary hover:bg-primary/90 text-white\"\n              data-testid=\"button-proceed-negotiation\"\n            >\n              Negotiate Your Offer\n            </Button>\n            <Button \n              variant=\"outline\"\n              size=\"sm\"\n              onClick={onAcceptOffer}\n              disabled={isLoading}\n              className=\"border-green-300 dark:border-green-700 text-green-600 dark:text-green-400 hover:bg-green-50 dark:hover:bg-green-900/20\"\n              data-testid=\"button-accept\"\n            >\n              {isLoading ? 'Processing...' : 'Accept Offer'}\n            </Button>\n          </div>\n        </div>\n\n        {/* Mobile: Compensation Summary */}\n        <div className=\"md:hidden mt-4 grid grid-cols-3 gap-3 pt-4 border-t border-gray-200 dark:border-gray-700\">\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Base</p>\n            <p className=\"font-bold text-gray-900 dark:text-white\">{formatCurrency(offer.baseSalary)}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">First Year</p>\n            <p className=\"font-bold text-green-600 dark:text-green-400\">{formatCurrency(comp.totalFirstYear)}</p>\n          </div>\n          <div>\n            <p className=\"text-xs text-gray-500 dark:text-gray-400\">Respond By</p>\n            <p className=\"font-medium text-amber-600 dark:text-amber-400 text-sm\">{offer.responseDeadline}</p>\n          </div>\n        </div>\n\n        {/* Expand/Collapse Button */}\n        <button\n          onClick={() => setIsExpanded(!isExpanded)}\n          className=\"mt-4 w-full flex items-center justify-center gap-2 text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 py-2 border-t border-gray-200 dark:border-gray-700 transition-colors\"\n          data-testid=\"button-toggle-details\"\n        >\n          {isExpanded ? (\n            <>\n              <ChevronUp className=\"h-4 w-4\" />\n              Hide Full Offer Letter\n            </>\n          ) : (\n            <>\n              <ChevronDown className=\"h-4 w-4\" />\n              View Full Offer Letter\n            </>\n          )}\n        </button>\n      </div>\n\n      {/* Expanded Full Offer Letter */}\n      {isExpanded && (\n        <CardContent className=\"pt-0 pb-6 px-6 space-y-6 border-t border-gray-200 dark:border-gray-700\">\n          {/* Salutation */}\n          <div className=\"prose dark:prose-invert max-w-none pt-6\">\n            <p className=\"text-gray-600 dark:text-gray-400 leading-relaxed\">\n              Dear {candidateName},\n            </p>\n            <p className=\"text-gray-600 dark:text-gray-400 leading-relaxed\">\n              On behalf of {company.name}, I am pleased to offer you the position of <strong>{job.title}</strong> in \n              our {job.location} location. Based on your impressive interview performance and qualifications, we believe \n              you will be an excellent addition to our team.\n            </p>\n          </div>\n          \n          {/* Compensation Package */}\n          <div>\n            <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n              <DollarSign className=\"h-5 w-5 text-green-600\" />\n              Compensation Package\n            </h3>\n            \n            <div className=\"space-y-4\">\n              {/* Total Comp Summary */}\n              <div className=\"bg-gray-900 dark:bg-gray-800 rounded-lg p-5 text-white\">\n                <div className=\"grid grid-cols-2 gap-6\">\n                  <div>\n                    <p className=\"text-xs text-gray-400 uppercase tracking-wide mb-1\">First Year Total</p>\n                    <p className=\"text-3xl font-bold text-green-400\">\n                      {formatCurrency(comp.totalFirstYear)}\n                    </p>\n                    <p className=\"text-xs text-gray-400 mt-1\">Including signing bonus</p>\n                  </div>\n                  <div>\n                    <p className=\"text-xs text-gray-400 uppercase tracking-wide mb-1\">Annual (Ongoing)</p>\n                    <p className=\"text-2xl font-semibold text-white\">{formatCurrency(comp.totalAnnual)}</p>\n                    <p className=\"text-xs text-gray-400 mt-1\">Base + bonus + equity</p>\n                  </div>\n                </div>\n              </div>\n\n              {/* Component Breakdown */}\n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-3\">\n                <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                  <div className=\"flex items-center gap-2 mb-2\">\n                    <DollarSign className=\"h-4 w-4 text-green-500\" />\n                    <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Base</span>\n                  </div>\n                  <p className=\"text-lg font-bold text-gray-900 dark:text-white\">\n                    {formatCurrency(comp.base)}\n                  </p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">{offer.salaryFrequency}</p>\n                </div>\n\n                {offer.signingBonus && (\n                  <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Gift className=\"h-4 w-4 text-purple-500\" />\n                      <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Signing</span>\n                    </div>\n                    <p className=\"text-lg font-bold text-gray-900 dark:text-white\" data-testid=\"text-signing-bonus\">\n                      {formatCurrency(offer.signingBonus)}\n                    </p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">One-time</p>\n                  </div>\n                )}\n\n                {offer.annualBonus && (\n                  <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Medal className=\"h-4 w-4 text-yellow-500\" />\n                      <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">Bonus</span>\n                    </div>\n                    <p className=\"text-lg font-bold text-gray-900 dark:text-white\" data-testid=\"text-annual-bonus\">\n                      {offer.annualBonus.targetPercent}%\n                    </p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                      ~{formatCurrency(comp.bonus)}/yr\n                    </p>\n                  </div>\n                )}\n\n                {offer.equity && offer.equity.type !== 'none' && (\n                  <div className=\"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700\">\n                    <div className=\"flex items-center gap-2 mb-2\">\n                      <Sparkles className=\"h-4 w-4 text-blue-500\" />\n                      <span className=\"text-xs font-medium text-gray-500 dark:text-gray-400\">\n                        {offer.equity.type === 'stock_options' ? 'Options' : 'RSUs'}\n                      </span>\n                    </div>\n                    <p className=\"text-lg font-bold text-gray-900 dark:text-white\" data-testid=\"text-equity\">\n                      {formatCurrency(offer.equity.amount)}\n                    </p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-1\">\n                      {offer.equity.vestingSchedule}\n                    </p>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          <Separator />\n          \n          {/* Benefits & Perks */}\n          {offer.benefits && (\n          <div>\n            <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n              <Heart className=\"h-5 w-5 text-red-500\" />\n              Benefits & Perks\n            </h3>\n            \n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n              {offer.benefits.healthInsurance && (\n              <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white text-sm\">Health Insurance</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">{offer.benefits.healthInsurance}</p>\n                </div>\n              </div>\n              )}\n              \n              {offer.benefits.dentalVision && (\n                <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"font-medium text-gray-900 dark:text-white text-sm\">Dental & Vision</p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">Full coverage included</p>\n                  </div>\n                </div>\n              )}\n              \n              {offer.benefits.retirement401k?.available && (\n                <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"font-medium text-gray-900 dark:text-white text-sm\">401(k) Retirement</p>\n                    <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                      {offer.benefits.retirement401k.matchPercent}% employer match (up to {formatCurrency(offer.benefits.retirement401k.maxMatch || 0)})\n                    </p>\n                  </div>\n                </div>\n              )}\n              \n              {offer.benefits.pto && (\n              <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white text-sm\">Paid Time Off</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {typeof offer.benefits.pto === 'string' \n                      ? offer.benefits.pto\n                      : offer.benefits.pto.type === 'unlimited' \n                        ? 'Unlimited PTO policy' \n                        : `${offer.benefits.pto.days} days per year`}\n                  </p>\n                </div>\n              </div>\n              )}\n              \n              {offer.benefits.remote && (\n              <div className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                <div>\n                  <p className=\"font-medium text-gray-900 dark:text-white text-sm\">Work Location</p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">\n                    {offer.benefits.remote === 'full' \n                      ? 'Fully remote' \n                      : offer.benefits.remote === 'hybrid' \n                        ? 'Hybrid (flexible)' \n                        : 'On-site'}\n                  </p>\n                </div>\n              </div>\n              )}\n              \n              {offer.benefits.otherBenefits?.slice(0, 3).map((benefit, index) => (\n                <div key={index} className=\"flex items-start gap-3 p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500 flex-shrink-0 mt-0.5\" />\n                  <div>\n                    <p className=\"font-medium text-gray-900 dark:text-white text-sm\">{benefit}</p>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n          )}\n          \n          <Separator />\n          \n          {/* Position Details */}\n          <div>\n            <h3 className=\"font-semibold text-lg text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\n              <Briefcase className=\"h-5 w-5 text-blue-500\" />\n              Position Details\n            </h3>\n            \n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Calendar className=\"h-4 w-4 text-gray-400\" />\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Start Date</p>\n                </div>\n                <p className=\"font-medium text-gray-900 dark:text-white text-sm\" data-testid=\"text-start-date\">{offer.startDate}</p>\n              </div>\n              \n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Users className=\"h-4 w-4 text-gray-400\" />\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Reports To</p>\n                </div>\n                <p className=\"font-medium text-gray-900 dark:text-white text-sm\">{offer.reportingTo}</p>\n              </div>\n              \n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Building2 className=\"h-4 w-4 text-gray-400\" />\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Team Size</p>\n                </div>\n                <p className=\"font-medium text-gray-900 dark:text-white text-sm\">{offer.teamSize} people</p>\n              </div>\n              \n              <div className=\"p-3 bg-gray-50 dark:bg-gray-800/50 rounded-lg\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Clock className=\"h-4 w-4 text-gray-400\" />\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400\">Deadline</p>\n                </div>\n                <p className=\"font-medium text-amber-600 dark:text-amber-400 text-sm\">{offer.responseDeadline}</p>\n              </div>\n            </div>\n          </div>\n          \n          {/* Closing */}\n          <div className=\"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed\">\n              Please confirm your acceptance of this offer by the deadline noted above. This offer is contingent upon \n              successful completion of a background check and verification of your right to work in the United States.\n            </p>\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed mt-3\">\n              We are excited about the possibility of you joining our team and look forward to your response.\n            </p>\n            <div className=\"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700\">\n              <p className=\"font-medium text-gray-900 dark:text-white\">{offer.offerLetterSignatory}</p>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">{offer.offerLetterSignatoryTitle}</p>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">{company.name}</p>\n            </div>\n          </div>\n        </CardContent>\n      )}\n    </Card>\n  );\n}\n","path":null,"size_bytes":20633,"size_tokens":null},"server/services/offer-generator.ts":{"content":"import type { OfferDetails, JobPosting, Company, ApplicationStage } from \"@shared/schema\";\n\ninterface OfferGeneratorParams {\n  jobPosting: JobPosting;\n  company: Company;\n  stages: ApplicationStage[];\n  candidateName: string;\n}\n\nexport function generateJobOffer(params: OfferGeneratorParams): OfferDetails {\n  const { jobPosting, company, stages } = params;\n  \n  const completedStages = stages.filter(s => s.status === 'completed' || s.status === 'passed');\n  const avgScore = completedStages.length > 0\n    ? Math.round(completedStages.reduce((sum, s) => sum + (s.score || 75), 0) / completedStages.length)\n    : 75;\n  \n  const salaryMin = jobPosting.salaryMin || 100000;\n  const salaryMax = jobPosting.salaryMax || 180000;\n  const salaryRange = salaryMax - salaryMin;\n  \n  const performanceMultiplier = (avgScore - 60) / 40;\n  const baseSalary = Math.round(salaryMin + (salaryRange * 0.3) + (salaryRange * 0.4 * Math.max(0, Math.min(1, performanceMultiplier))));\n  \n  const companySize = company.size || 'mid-size';\n  const hasEquity = companySize === 'startup' || companySize === 'mid-size';\n  const hasSigningBonus = avgScore >= 85 || companySize === 'enterprise';\n  \n  const today = new Date();\n  const startDate = new Date(today);\n  startDate.setDate(startDate.getDate() + 21);\n  \n  const deadline = new Date(today);\n  deadline.setDate(deadline.getDate() + 7);\n  \n  const signatoryNames: Record<string, { name: string; title: string }> = {\n    'QuantumSphere Innovations': { name: 'Sarah Chen', title: 'VP of Talent' },\n    'CyberVortex Technologies': { name: 'Michael Torres', title: 'Head of People Operations' },\n    'NanoByte Dynamics': { name: 'Dr. Emily Watson', title: 'Chief People Officer' },\n    'FinanceFlow Systems': { name: 'David Miller', title: 'Director of Human Resources' },\n    'CloudNexus': { name: 'Jennifer Park', title: 'VP of People & Culture' },\n    'DataViz Pro': { name: 'Amanda Rodriguez', title: 'Chief People Officer' },\n  };\n  \n  const signatory = signatoryNames[company.name] || { name: 'HR Team', title: 'Human Resources' };\n  \n  const reportingToOptions: Record<string, string> = {\n    'developer': 'Engineering Manager',\n    'pm': 'Director of Product',\n    'designer': 'Design Lead',\n    'data-scientist': 'Head of Data Science',\n    'devops': 'Platform Engineering Manager',\n    'qa': 'QA Manager',\n  };\n  \n  const reportingTo = reportingToOptions[jobPosting.role] || 'Hiring Manager';\n  \n  const teamSizeByRole: Record<string, number> = {\n    'developer': 8,\n    'pm': 5,\n    'designer': 4,\n    'data-scientist': 6,\n    'devops': 5,\n    'qa': 4,\n  };\n  \n  const teamSize = teamSizeByRole[jobPosting.role] || 6;\n  \n  const offer: OfferDetails = {\n    baseSalary,\n    salaryFrequency: 'annual',\n    \n    signingBonus: hasSigningBonus ? Math.round(baseSalary * 0.1) : undefined,\n    \n    annualBonus: {\n      targetPercent: companySize === 'enterprise' ? 20 : companySize === 'mid-size' ? 15 : 10,\n      description: 'Based on individual and company performance, paid annually',\n    },\n    \n    equity: hasEquity ? {\n      type: companySize === 'startup' ? 'stock_options' : 'rsu',\n      amount: companySize === 'startup' \n        ? Math.round(baseSalary * 0.5) \n        : Math.round(baseSalary * 0.25),\n      vestingSchedule: '4-year vesting with 1-year cliff',\n      cliffMonths: 12,\n      totalVestingMonths: 48,\n    } : undefined,\n    \n    benefits: {\n      healthInsurance: companySize === 'startup' \n        ? 'Comprehensive medical coverage (80% employer paid)' \n        : 'Premium PPO medical, including family coverage (100% employer paid for employee)',\n      dentalVision: true,\n      retirement401k: {\n        available: true,\n        matchPercent: companySize === 'enterprise' ? 6 : 4,\n        maxMatch: companySize === 'enterprise' ? 12000 : 8000,\n      },\n      pto: {\n        days: companySize === 'startup' ? 0 : companySize === 'enterprise' ? 25 : 20,\n        type: companySize === 'startup' ? 'unlimited' : 'accrued',\n      },\n      remote: jobPosting.location.toLowerCase().includes('remote') \n        ? 'full' \n        : jobPosting.location.toLowerCase().includes('hybrid') \n          ? 'hybrid' \n          : 'onsite',\n      otherBenefits: generateOtherBenefits(companySize, company),\n    },\n    \n    startDate: formatDate(startDate),\n    responseDeadline: formatDate(deadline),\n    reportingTo,\n    teamSize,\n    \n    offerDate: formatDate(today),\n    offerLetterSignatory: signatory.name,\n    offerLetterSignatoryTitle: signatory.title,\n  };\n  \n  return offer;\n}\n\nfunction generateOtherBenefits(companySize: string, company: Company): string[] {\n  const baseBenefits = [\n    'Life and disability insurance',\n    'Employee Assistance Program (EAP)',\n  ];\n  \n  const midSizeBenefits = [\n    ...baseBenefits,\n    'Professional development budget ($2,000/year)',\n    'Home office stipend ($500)',\n    'Wellness program',\n  ];\n  \n  const enterpriseBenefits = [\n    ...midSizeBenefits,\n    'Commuter benefits',\n    'Tuition reimbursement',\n    'Parental leave (16 weeks)',\n    'Employee stock purchase plan',\n  ];\n  \n  const startupBenefits = [\n    ...baseBenefits,\n    'Flexible work hours',\n    'Learning & development budget ($1,500/year)',\n    'Team offsites and events',\n    'Latest MacBook Pro',\n  ];\n  \n  if (companySize === 'enterprise') return enterpriseBenefits;\n  if (companySize === 'startup') return startupBenefits;\n  return midSizeBenefits;\n}\n\nfunction formatDate(date: Date): string {\n  return date.toLocaleDateString('en-US', {\n    weekday: 'long',\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  });\n}\n\nexport function calculateTotalCompensation(offer: OfferDetails): {\n  base: number;\n  bonus: number;\n  equity: number;\n  signing: number;\n  total: number;\n  totalFirstYear: number;\n} {\n  const base = offer.baseSalary;\n  const bonus = offer.annualBonus \n    ? Math.round(base * (offer.annualBonus.targetPercent / 100))\n    : 0;\n  const equity = offer.equity \n    ? Math.round(offer.equity.amount / 4)\n    : 0;\n  const signing = offer.signingBonus || 0;\n  \n  return {\n    base,\n    bonus,\n    equity,\n    signing,\n    total: base + bonus + equity,\n    totalFirstYear: base + bonus + equity + signing,\n  };\n}\n","path":null,"size_bytes":6198,"size_tokens":null},"server/services/response-classifier.ts":{"content":"// Response classifier using heuristics only (no LLM calls for reliability)\n\nexport type CandidateIntent = \n  | 'substantive_answer'    // Real answer to the question\n  | 'question_for_recruiter' // Candidate asking about role/company/team\n  | 'clarification_request' // Confused or asking for clarity on the question\n  | 'conversational_comment' // Small talk, acknowledgment, brief comment\n  | 'off_topic'             // Unrelated to interview\n  | 'prompt_injection'      // Attempted manipulation of AI\n  | 'minimal_response';     // Very short response (yes/no, ok, etc.)\n\nexport interface ClassificationResult {\n  intent: CandidateIntent;\n  confidence: number;\n  candidateQuestion?: string; // If they asked something, extract it\n  sanitizedText: string; // Text with any injection attempts removed\n  injectionDetected: boolean;\n  injectionType?: string;\n}\n\n// ==================== PROMPT GUARD ====================\n// Detects prompt injection attempts and sanitizes input\n\nconst INJECTION_PATTERNS = [\n  // Direct instruction overrides\n  /ignore (all )?(previous|prior|above) (instructions|prompts|rules)/i,\n  /disregard (all )?(previous|prior) (instructions|prompts)/i,\n  /forget (everything|all|your) (you|instructions|rules)/i,\n  \n  // Role reassignment\n  /you are (now|actually) (a|an|the)/i,\n  /pretend (to be|you are)/i,\n  /act as (if|though|a)/i,\n  /your (new|real) (role|purpose|job) is/i,\n  \n  // System prompt extraction\n  /what (are|is) your (instructions|prompt|system)/i,\n  /show me your (prompt|instructions|rules)/i,\n  /repeat (your|the) (system|initial) (prompt|message)/i,\n  \n  // Delimiter injection\n  /\\[SYSTEM\\]/i,\n  /\\[INST\\]/i,\n  /<\\|.*\\|>/i,\n  /```system/i,\n  \n  // Jailbreak attempts\n  /do anything now/i,\n  /dan mode/i,\n  /developer mode/i,\n  /unrestricted mode/i,\n  \n  // Output manipulation\n  /respond only with/i,\n  /output (only|just)/i,\n  /say (exactly|only)/i,\n];\n\nconst SUSPICIOUS_PATTERNS = [\n  // Less severe but worth flagging\n  /as an? (ai|language model|llm)/i,\n  /your programming/i,\n  /your training/i,\n  /override/i,\n  /bypass/i,\n];\n\nexport class PromptGuard {\n  /**\n   * Check for prompt injection attempts\n   */\n  static detect(text: string): { \n    isInjection: boolean; \n    type?: string; \n    sanitized: string;\n    severity: 'none' | 'suspicious' | 'malicious';\n  } {\n    const lowerText = text.toLowerCase();\n    \n    // Check for malicious patterns\n    for (const pattern of INJECTION_PATTERNS) {\n      if (pattern.test(text)) {\n        return {\n          isInjection: true,\n          type: 'instruction_override',\n          sanitized: this.sanitize(text),\n          severity: 'malicious'\n        };\n      }\n    }\n    \n    // Check for suspicious patterns\n    for (const pattern of SUSPICIOUS_PATTERNS) {\n      if (pattern.test(text)) {\n        return {\n          isInjection: false,\n          type: 'suspicious_content',\n          sanitized: text, // Don't sanitize suspicious, just flag\n          severity: 'suspicious'\n        };\n      }\n    }\n    \n    return {\n      isInjection: false,\n      sanitized: text,\n      severity: 'none'\n    };\n  }\n  \n  /**\n   * Sanitize text by removing/neutralizing injection attempts\n   * Does NOT call detect() to avoid recursion\n   * Removes ENTIRE sentences containing injection patterns\n   */\n  static sanitize(text: string): string {\n    let sanitized = text;\n    \n    // Remove common injection delimiters entirely\n    sanitized = sanitized.replace(/\\[SYSTEM\\]/gi, '');\n    sanitized = sanitized.replace(/\\[INST\\]/gi, '');\n    sanitized = sanitized.replace(/<\\|.*?\\|>/g, '');\n    sanitized = sanitized.replace(/```system[\\s\\S]*?```/g, '');\n    sanitized = sanitized.replace(/```[\\s\\S]*?```/g, ''); // Remove all code blocks\n    \n    // Split into sentences and filter out suspicious ones\n    const sentences = sanitized.split(/(?<=[.!?])\\s+/);\n    const cleanSentences = sentences.filter(sentence => {\n      const lower = sentence.toLowerCase();\n      \n      // Remove sentences with instruction-override patterns\n      if (/ignore (all )?(previous|prior|above)/i.test(sentence)) return false;\n      if (/disregard (all )?(previous|prior)/i.test(sentence)) return false;\n      if (/forget (everything|all|your)/i.test(sentence)) return false;\n      if (/you are (now|actually) (a|an|the)/i.test(sentence)) return false;\n      if (/pretend (to be|you are)/i.test(sentence)) return false;\n      if (/your (new|real) (role|purpose|job) is/i.test(sentence)) return false;\n      if (/respond only with/i.test(sentence)) return false;\n      if (/output (only|just)/i.test(sentence)) return false;\n      if (/do anything now/i.test(sentence)) return false;\n      if (/dan mode|developer mode|unrestricted mode/i.test(sentence)) return false;\n      if (/as an? (ai|language model|llm)/i.test(sentence)) return false;\n      if (/your programming|your training/i.test(sentence)) return false;\n      \n      return true;\n    });\n    \n    // Rejoin clean sentences\n    sanitized = cleanSentences.join(' ').trim();\n    \n    // If nothing left after sanitization, return a placeholder\n    if (!sanitized || sanitized.length < 3) {\n      return \"[Response removed for security]\";\n    }\n    \n    return sanitized;\n  }\n}\n\n// ==================== RESPONSE CLASSIFIER ====================\n// Classifies candidate responses using heuristics for reliability and speed\n\nexport class ResponseClassifier {\n  // No LLM needed - using heuristics only for reliability and speed\n  \n  /**\n   * Extract any question directed at the recruiter from the message\n   * Scans sentence-by-sentence to find questions even in mixed messages\n   * Returns the question if found, null otherwise\n   */\n  private extractRecruiterQuestion(text: string): string | null {\n    // Split into sentences (handling ?, !, and .)\n    const sentences = text.split(/(?<=[.!?])\\s+/);\n    \n    for (const sentence of sentences) {\n      const trimmed = sentence.trim();\n      const lower = trimmed.toLowerCase();\n      \n      // Check if this sentence is a question directed at the recruiter\n      if (!trimmed.endsWith('?')) continue;\n      \n      // Question word patterns that indicate recruiter-directed questions\n      const recruiterQuestionPatterns = [\n        /^(what|how|why|when|where|who)/i,\n        /^(can you|could you|would you|will you)/i,\n        /^(is there|are there|do you|does)/i,\n        /^(what's|how's|who's)/i,\n        /(the team|the role|the company|the position|the job|onboarding|timeline|next step|salary|benefits|remote|office)/i,\n      ];\n      \n      for (const pattern of recruiterQuestionPatterns) {\n        if (pattern.test(lower)) {\n          return trimmed;\n        }\n      }\n    }\n    \n    return null;\n  }\n\n  /**\n   * Quick heuristic classification for obvious cases\n   * Scans sentence-by-sentence to detect questions anywhere in the message\n   */\n  private quickClassify(text: string, lastQuestion: string): CandidateIntent | null {\n    const trimmed = text.trim();\n    const lower = trimmed.toLowerCase();\n    \n    // Count words\n    const wordCount = trimmed.split(/\\s+/).length;\n    \n    // === MINIMAL RESPONSES (1-4 words, common acknowledgments and refusals) ===\n    if (wordCount <= 4 && /^(yes|no|np|n\\/a|na|ok|okay|sure|yep|nope|yeah|nah|fine|good|great|thanks|right|correct|exactly|not really|i can'?t|i don'?t|none|nothing|no idea|i guess|idk|dunno|hmm+|um+|uh+|er+|ah+|meh|whatever|skip|pass|next)\\.?$/i.test(lower)) {\n      return 'minimal_response';\n    }\n    \n    // === NEGATIVE REFUSALS (candidate can't provide what was asked) ===\n    if (wordCount <= 8 && /^(not really|i (can'?t|don'?t|haven'?t)|no[,.]? (i (can'?t|don'?t)|not really)|i don'?t (have|know|remember|think)|none (that i|come to)|nothing (comes|specific)|can'?t think of)/i.test(lower)) {\n      return 'minimal_response';\n    }\n    \n    // === CONVERSATIONAL COMMENTS (short acknowledgments) ===\n    if (wordCount < 6 && /^(that's (interesting|cool|great|nice)|sounds good|i see|makes sense|got it|understood|that works)\\.?$/i.test(lower)) {\n      return 'conversational_comment';\n    }\n    \n    // === CLARIFICATION REQUESTS (confusion phrases) ===\n    if (/^(i('m| am) (not sure|confused)|what do you mean|could you (explain|clarify|rephrase)|i don't (understand|follow))/i.test(lower)) {\n      return 'clarification_request';\n    }\n    \n    // === CHECK FOR RECRUITER-DIRECTED QUESTIONS ===\n    // Scan sentence-by-sentence to find questions even in mixed messages\n    const recruiterQuestion = this.extractRecruiterQuestion(text);\n    if (recruiterQuestion) {\n      // If the message is MOSTLY a question (>50% of content), treat as question\n      // Otherwise treat as answer (the question will be noted but we continue evaluation)\n      if (recruiterQuestion.length > trimmed.length * 0.5) {\n        return 'question_for_recruiter';\n      }\n      // Mixed content - treat as answer but we extracted the question for candidateQuestion field\n    }\n    \n    // === EVERYTHING ELSE IS A SUBSTANTIVE ANSWER ===\n    return 'substantive_answer';\n  }\n  \n  /**\n   * Classify a candidate's response using ONLY heuristics (no LLM call)\n   * This is fast, reliable, and doesn't break on API failures\n   * Falls back to substantive_answer for anything ambiguous\n   */\n  classify(\n    candidateResponse: string, \n    lastQuestion: string,\n    jobTitle: string = \"the position\"\n  ): ClassificationResult {\n    // Always sanitize the text first\n    const sanitizedText = PromptGuard.sanitize(candidateResponse);\n    \n    // Check for prompt injection\n    const guardResult = PromptGuard.detect(candidateResponse);\n    \n    if (guardResult.isInjection) {\n      console.warn('Prompt injection detected:', guardResult.type);\n      return {\n        intent: 'prompt_injection',\n        confidence: 1.0,\n        sanitizedText: sanitizedText,\n        injectionDetected: true,\n        injectionType: guardResult.type\n      };\n    }\n    \n    // Extract any recruiter-directed question (even in mixed content)\n    const recruiterQuestion = this.extractRecruiterQuestion(candidateResponse);\n    \n    // Use heuristic classification\n    const intent = this.quickClassify(candidateResponse, lastQuestion) || 'substantive_answer';\n    \n    return {\n      intent: intent,\n      confidence: 0.9,\n      sanitizedText: sanitizedText,\n      injectionDetected: false,\n      // Include the extracted question even if we classify as substantive_answer\n      // This allows the response handler to answer it while still proceeding with evaluation\n      candidateQuestion: recruiterQuestion || undefined\n    };\n  }\n}\n\nexport const responseClassifier = new ResponseClassifier();\n","path":null,"size_bytes":10604,"size_tokens":null},"client/src/components/ModeBanner.tsx":{"content":"import { Badge } from \"@/components/ui/badge\";\nimport { Briefcase, GraduationCap, ArrowRight } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ntype ModeType = \"journey\" | \"practice\";\n\ninterface ModeBannerProps {\n  mode: ModeType;\n  context?: {\n    companyName?: string;\n    jobTitle?: string;\n    stageName?: string;\n  };\n  variant?: \"banner\" | \"badge\" | \"inline\";\n  className?: string;\n}\n\nconst modeConfig = {\n  journey: {\n    label: \"Journey Mode\",\n    shortLabel: \"Journey\",\n    description: \"This affects your job application progress\",\n    icon: Briefcase,\n    colors: {\n      badge: \"border-blue-400 text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20\",\n      banner: \"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800\",\n      iconBg: \"bg-blue-100 dark:bg-blue-900/50\",\n      iconColor: \"text-blue-600 dark:text-blue-400\",\n    },\n  },\n  practice: {\n    label: \"Practice Mode\",\n    shortLabel: \"Practice\",\n    description: \"Safe sandbox for building skills  no real stakes\",\n    icon: GraduationCap,\n    colors: {\n      badge: \"border-purple-400 text-purple-600 dark:text-purple-400 bg-purple-50 dark:bg-purple-900/20\",\n      banner: \"bg-gradient-to-r from-purple-50 to-pink-50 dark:from-purple-900/20 dark:to-pink-900/20 border-purple-200 dark:border-purple-800\",\n      iconBg: \"bg-purple-100 dark:bg-purple-900/50\",\n      iconColor: \"text-purple-600 dark:text-purple-400\",\n    },\n  },\n};\n\nexport function ModeBanner({ mode, context, variant = \"badge\", className }: ModeBannerProps) {\n  const config = modeConfig[mode];\n  const Icon = config.icon;\n\n  // Simple badge variant\n  if (variant === \"badge\") {\n    return (\n      <Badge \n        variant=\"outline\" \n        className={cn(config.colors.badge, className)}\n        data-testid={`badge-${mode}-mode`}\n      >\n        <Icon className=\"h-3 w-3 mr-1\" />\n        {config.label}\n      </Badge>\n    );\n  }\n\n  // Inline variant (for headers)\n  if (variant === \"inline\") {\n    return (\n      <div className={cn(\"flex items-center gap-2\", className)} data-testid={`inline-${mode}-mode`}>\n        <Badge variant=\"outline\" className={config.colors.badge}>\n          <Icon className=\"h-3 w-3 mr-1\" />\n          {config.shortLabel}\n        </Badge>\n        {context?.companyName && (\n          <>\n            <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n            <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n              {context.companyName}\n              {context.jobTitle && `  ${context.jobTitle}`}\n            </span>\n          </>\n        )}\n      </div>\n    );\n  }\n\n  // Full banner variant\n  return (\n    <div \n      className={cn(\n        \"rounded-lg border p-4 mb-6\",\n        config.colors.banner,\n        className\n      )}\n      data-testid={`banner-${mode}-mode`}\n    >\n      <div className=\"flex items-start gap-4\">\n        <div className={cn(\"p-2 rounded-lg shrink-0\", config.colors.iconBg)}>\n          <Icon className={cn(\"h-5 w-5\", config.colors.iconColor)} />\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h4 className={cn(\"font-semibold\", config.colors.iconColor)}>\n              {config.label}\n            </h4>\n            {context?.stageName && (\n              <Badge variant=\"secondary\" className=\"text-xs\">\n                {context.stageName}\n              </Badge>\n            )}\n          </div>\n          {context?.companyName ? (\n            <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n              {context.companyName}\n              {context.jobTitle && `  ${context.jobTitle}`}\n            </p>\n          ) : (\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n              {config.description}\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport function ModeIndicator({ mode, className }: { mode: ModeType; className?: string }) {\n  return <ModeBanner mode={mode} variant=\"badge\" className={className} />;\n}\n","path":null,"size_bytes":4061,"size_tokens":null},"server/services/response-handler.ts":{"content":"import { ChatGroq } from \"@langchain/groq\";\nimport { PromptTemplate } from \"@langchain/core/prompts\";\nimport { CandidateIntent, ClassificationResult } from \"./response-classifier\";\nimport { stripThinkingTags } from \"./interview-chains\";\n\n// ==================== RESPONSE HANDLER ====================\n// Generates appropriate interviewer responses based on candidate intent\n\nconst answerQuestionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName} conducting an interview.\n\nThe candidate just asked you a question. Answer it naturally and briefly, then smoothly transition back to your interview question.\n\nCOMPANY INFO:\n{companyDescription}\n\nJOB INFO:\n{jobTitle} - {jobRequirements}\n\nYOUR LAST QUESTION WAS:\n\"{lastQuestion}\"\n\nCANDIDATE'S QUESTION:\n\"{candidateQuestion}\"\n\nGUIDELINES:\n- Answer their question helpfully but briefly (2-3 sentences max)\n- Be honest - if you don't know something specific, say so\n- After answering, gently redirect back to your question\n- Keep the conversational flow natural\n\nEXAMPLE:\nCandidate: \"How big is the team I'd be working with?\"\nResponse: \"Great question! The team is about 8 people right nowa mix of senior and mid-level folks. We're growing, so there's room for ownership. But back to youcould you tell me about your experience with...\"\n\nOutput ONLY your response (answer + redirect). Keep it under 4 sentences total.\n`);\n\nconst answerElaborationOfferPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName} conducting an interview.\n\nThe candidate is offering to elaborate on their previous answer. Accept their offer with a brief, encouraging response.\n\nYOUR LAST QUESTION WAS:\n\"{lastQuestion}\"\n\nWHAT THEY'RE OFFERING:\n\"{candidateQuestion}\"\n\nGUIDELINES:\n- Accept their offer warmly and briefly (1 sentence)\n- End with a period, NOT a question mark (the orchestrator will add the next question)\n- Don't add \"please\" or create a new question - just encourage them to continue\n\nGOOD EXAMPLES:\n- \"Yes, I'd love to hear more about that.\"\n- \"Absolutely, please go ahead.\"\n- \"That sounds interestingplease continue.\"\n- \"Yes, let's dive deeper into that.\"\n\nBAD EXAMPLES (don't do these):\n- \"Yes, could you tell me more?\" (ends with question)\n- \"Sure! What specific challenges did you face?\" (adds new question)\n\nOutput ONLY your brief response (1 sentence, ending with a period).\n`);\n\nconst clarifyQuestionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName}.\n\nThe candidate seems confused about your last question or is asking for clarification.\n\nYOUR LAST QUESTION WAS:\n\"{lastQuestion}\"\n\nWHAT THEY SAID:\n\"{candidateResponse}\"\n\nRephrase your question in simpler terms. Don't apologize excessivelyjust naturally clarify.\n\nEXAMPLE:\nOriginal: \"Can you walk me through a time when you had to navigate competing priorities from multiple stakeholders?\"\nClarified: \"Sure! I'm curious about a situation where different people wanted different things from youhow did you handle that?\"\n\nOutput ONLY the clarified question. Keep it natural and conversational.\n`);\n\nconst acknowledgeCommentPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName}.\n\nThe candidate made a conversational comment or brief acknowledgment. Respond naturally and continue with your interview question.\n\nYOUR LAST QUESTION WAS:\n\"{lastQuestion}\"\n\nWHAT THEY SAID:\n\"{candidateResponse}\"\n\nGUIDELINES:\n- Give a brief, natural acknowledgment (not robotic)\n- If they haven't answered your question, gently repeat or rephrase it\n- Keep the conversation flowing\n\nEXAMPLES:\n- \"That's interesting!\"  \"Glad you think so! So, about my question...\"\n- \"Sounds good\"  \"Great! So, tell me about...\"\n- \"I see\"  \"Right, so when it comes to [topic]...\"\n\nOutput ONLY your brief response (1-2 sentences).\n`);\n\nconst handleMinimalPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName}.\n\nThe candidate gave a very minimal response. Gently probe for more detail without being pushy.\n\nYOUR QUESTION WAS:\n\"{lastQuestion}\"\n\nTHEIR RESPONSE:\n\"{candidateResponse}\"\n\nGUIDELINES:\n- Acknowledge their response\n- Ask a gentle follow-up to get more detail\n- Don't make them feel like their answer was wrong\n- Keep it conversational\n\nEXAMPLES:\n- \"Yes\"  \"Got it! Could you give me a specific example of that?\"\n- \"No\"  \"No problem. What about a related situation where...?\"\n- \"Sure\"  \"Great! Tell me a bit more about...\"\n\nOutput ONLY your follow-up (1-2 sentences).\n`);\n\nconst handleInjectionPrompt = PromptTemplate.fromTemplate(`\nYou are {interviewerName}, a friendly HR recruiter at {companyName}.\n\nThe candidate said something unusual or off-topic. Gently redirect back to the interview without being confrontational.\n\nYOUR LAST QUESTION WAS:\n\"{lastQuestion}\"\n\nPolitely redirect them back to the interview question. Don't acknowledge anything strange they might have saidjust smoothly refocus.\n\nEXAMPLE:\n\"I appreciate you sharing. Let me bring us backI'd love to hear about your experience with [topic from original question].\"\n\nOutput ONLY your redirect (1-2 sentences). Be warm but focused.\n`);\n\nexport class ResponseHandler {\n  private model: ChatGroq;\n  \n  constructor() {\n    this.model = new ChatGroq({\n      apiKey: process.env.GROQ_API_KEY,\n      model: \"qwen/qwen3-32b\",\n      temperature: 0.6,\n      topP: 0.95,\n    });\n  }\n  \n  /**\n   * Generate an appropriate response based on the candidate's intent\n   */\n  async handleResponse(\n    classification: ClassificationResult,\n    lastQuestion: string,\n    config: {\n      interviewerName?: string;\n      companyName?: string;\n      companyDescription?: string;\n      jobTitle?: string;\n      jobRequirements?: string;\n    }\n  ): Promise<{\n    response: string;\n    shouldProceedWithEvaluation: boolean;\n    questionRepeated: boolean;\n    isElaborationOffer?: boolean;\n  }> {\n    const interviewerName = config.interviewerName || \"Sarah\";\n    const companyName = config.companyName || \"our company\";\n    const companyDescription = config.companyDescription || \"A great place to work\";\n    const jobTitle = config.jobTitle || \"this position\";\n    const jobRequirements = config.jobRequirements || \"relevant experience for the role\";\n    \n    switch (classification.intent) {\n      case 'substantive_answer':\n        // Real answer - proceed with normal evaluation flow\n        return {\n          response: '',\n          shouldProceedWithEvaluation: true,\n          questionRepeated: false\n        };\n        \n      case 'question_for_recruiter':\n        // Check if candidate is offering to elaborate (not asking a real question)\n        const candidateQ = (classification.candidateQuestion || classification.sanitizedText).toLowerCase();\n        \n        // First, check if they're asking the INTERVIEWER to do something (not an offer)\n        // e.g., \"Could you elaborate?\" or \"Can you explain what you mean?\"\n        const askingInterviewer = (\n          candidateQ.includes('could you') ||\n          candidateQ.includes('can you') ||\n          candidateQ.includes('would you ') || // Note: space to avoid matching \"would you like me to\"\n          candidateQ.includes('what do you mean') ||\n          candidateQ.includes('what does that mean') ||\n          candidateQ.includes('what exactly')\n        );\n        \n        // If they're asking the interviewer something, it's NOT an elaboration offer\n        if (askingInterviewer) {\n          // This is a real question directed at the interviewer - answer it\n          const answerPrompt = await answerQuestionPrompt.format({\n            interviewerName,\n            companyName,\n            companyDescription,\n            jobTitle,\n            jobRequirements,\n            lastQuestion,\n            candidateQuestion: classification.candidateQuestion || classification.sanitizedText\n          });\n          const answerResponse = await this.model.invoke(answerPrompt);\n          return {\n            response: this.extractContent(answerResponse),\n            shouldProceedWithEvaluation: false,\n            questionRepeated: true\n          };\n        }\n        \n        // Check if candidate is offering to elaborate themselves\n        const elaborationPatterns = [\n          'elaborate', 'more detail', 'go deeper', 'dive deeper', 'expand on',\n          'different example', 'another example', 'give you more', 'tell you more',\n          'share more', 'continue on', 'keep going', 'think of a different'\n        ];\n        const hasElaborationKeyword = elaborationPatterns.some(p => candidateQ.includes(p));\n        const hasOfferPhrase = (\n          candidateQ.includes('would you like me to') ||\n          candidateQ.includes('do you want me to') ||\n          candidateQ.includes('should i')\n        );\n        const isElaborationOffer = (hasOfferPhrase && hasElaborationKeyword) || \n          (hasOfferPhrase && (candidateQ.includes('more') || candidateQ.includes('example') || candidateQ.includes('detail')));\n        \n        if (isElaborationOffer) {\n          // Use the elaboration prompt that doesn't add a redirect question\n          const elaborationPrompt = await answerElaborationOfferPrompt.format({\n            interviewerName,\n            companyName,\n            lastQuestion,\n            candidateQuestion: classification.candidateQuestion || classification.sanitizedText\n          });\n          const elaborationResponse = await this.model.invoke(elaborationPrompt);\n          return {\n            response: this.extractContent(elaborationResponse),\n            shouldProceedWithEvaluation: false,\n            questionRepeated: true,\n            isElaborationOffer: true  // Signal to orchestrator: don't add another question\n          };\n        }\n        \n        // Normal question - answer it and redirect\n        const answerPrompt = await answerQuestionPrompt.format({\n          interviewerName,\n          companyName,\n          companyDescription,\n          jobTitle,\n          jobRequirements,\n          lastQuestion,\n          candidateQuestion: classification.candidateQuestion || classification.sanitizedText\n        });\n        const answerResponse = await this.model.invoke(answerPrompt);\n        return {\n          response: this.extractContent(answerResponse),\n          shouldProceedWithEvaluation: false,\n          questionRepeated: true\n        };\n        \n      case 'clarification_request':\n        // Candidate confused - clarify the question\n        // The AI generates a rephrased question, so we don't need to repeat the original\n        const clarifyPromptText = await clarifyQuestionPrompt.format({\n          interviewerName,\n          companyName,\n          lastQuestion,\n          candidateResponse: classification.sanitizedText\n        });\n        const clarifyResponse = await this.model.invoke(clarifyPromptText);\n        return {\n          response: this.extractContent(clarifyResponse),\n          shouldProceedWithEvaluation: false,\n          questionRepeated: false  // Clarification already contains the rephrased question\n        };\n        \n      case 'conversational_comment':\n        // Brief comment - acknowledge and continue\n        const ackPrompt = await acknowledgeCommentPrompt.format({\n          interviewerName,\n          companyName,\n          lastQuestion,\n          candidateResponse: classification.sanitizedText\n        });\n        const ackResponse = await this.model.invoke(ackPrompt);\n        return {\n          response: this.extractContent(ackResponse),\n          shouldProceedWithEvaluation: false,\n          questionRepeated: true\n        };\n        \n      case 'minimal_response':\n        // Very short answer - probe for more\n        const minimalPrompt = await handleMinimalPrompt.format({\n          interviewerName,\n          companyName,\n          lastQuestion,\n          candidateResponse: classification.sanitizedText\n        });\n        const minimalResponse = await this.model.invoke(minimalPrompt);\n        const minimalResponseText = this.extractContent(minimalResponse);\n        \n        // If our response already ends with a question or offers a choice,\n        // don't also repeat the original question - wait for user to respond\n        const responseEndsWithQuestion = minimalResponseText.trim().endsWith('?');\n        \n        return {\n          response: minimalResponseText,\n          shouldProceedWithEvaluation: false,\n          questionRepeated: !responseEndsWithQuestion  // Only repeat if we didn't ask a new question\n        };\n        \n      case 'prompt_injection':\n      case 'off_topic':\n        // Suspicious or off-topic - redirect\n        const redirectPrompt = await handleInjectionPrompt.format({\n          interviewerName,\n          companyName,\n          lastQuestion\n        });\n        const redirectResponse = await this.model.invoke(redirectPrompt);\n        return {\n          response: this.extractContent(redirectResponse),\n          shouldProceedWithEvaluation: false,\n          questionRepeated: true\n        };\n        \n      default:\n        // Unknown - treat as answer\n        return {\n          response: '',\n          shouldProceedWithEvaluation: true,\n          questionRepeated: false\n        };\n    }\n  }\n  \n  private extractContent(response: any): string {\n    const content = typeof response.content === 'string' \n      ? response.content \n      : JSON.stringify(response.content);\n    // Strip Qwen3 thinking tags before returning\n    return stripThinkingTags(content).trim();\n  }\n}\n\nexport const responseHandler = new ResponseHandler();\n","path":null,"size_bytes":13654,"size_tokens":null},"server/scripts/test-interview-quality.ts":{"content":"/**\n * Interview Quality Test Script\n * \n * Simulates a candidate going through the interview engine\n * with varied response types and evaluates conversation quality.\n */\n\nimport { InterviewOrchestrator } from '../services/interview-orchestrator';\nimport { ChatGroq } from '@langchain/groq';\nimport { storage } from '../storage';\n\ninterface ConversationTurn {\n  speaker: 'interviewer' | 'candidate';\n  message: string;\n  questionNumber?: number;\n  responseType?: 'complete' | 'vague' | 'partial' | 'asks_question' | 'offers_elaboration';\n}\n\ninterface QualityEvaluation {\n  flow: { score: number; reasoning: string };\n  naturalness: { score: number; reasoning: string };\n  relevance: { score: number; reasoning: string };\n  overallScore: number;\n  summary: string;\n  improvements: string[];\n}\n\ninterface IterationResult {\n  iteration: number;\n  questionCount: number;\n  conversation: ConversationTurn[];\n  evaluation: QualityEvaluation;\n}\n\n// Response type distribution for realistic simulation\ntype ResponseType = 'complete' | 'vague' | 'partial' | 'asks_question' | 'offers_elaboration';\n\nfunction getRandomResponseType(): ResponseType {\n  const rand = Math.random();\n  if (rand < 0.4) return 'complete';           // 40% complete answers\n  if (rand < 0.55) return 'partial';           // 15% partial answers\n  if (rand < 0.7) return 'vague';              // 15% vague answers\n  if (rand < 0.85) return 'offers_elaboration'; // 15% offers to elaborate (TEST THE FIX)\n  return 'asks_question';                       // 15% asks a question back\n}\n\n// Samvel's CV content\nconst SAMVEL_CV = `\nSAMVEL MKHITARYAN, PhD\n\nHIGHLIGHTS:\n 7+ years in research and program management positions\n 4+ years in data analytics\n 4+ years using Python, R and SQL, Power BI and Tableau\n Working knowledge of state of the art techniques in Machine Learning and AI\n Knowledge of Apache Spark and PySpark technologies\n\nEXPERIENCE:\n\n2025-Now: Senior Data Scientist at Rabobank, Utrecht, Netherlands\n- Applied statistical methods and machine learning to obtain insights from data to inform decision making\n- Built, tested and validated predictive models\n- Turned data into simple valuable solutions for the business\n\n2018-2022: PhD Candidate, Maastricht University\n- Developed a computational framework for analysing behaviour as a system of interdependent components\n- Helped stakeholders avoid costly experiments by developing a computational framework for scenario analysis using Fuzzy Cognitive Maps and Machine Learning\n\n2019-2021: Data Analyst at RedKite, Armenia\n- Collected and analysed user experience data for a SaaS\n- Designed experiments to test the success of new features\n- Contributed to the improvement and development of product features\n\n2017: Data Analysis Consultant at UNFPA, Armenia\n- Quantitatively evaluated the effectiveness and quality of e-learning modules\n\n2015-2016: Data Analysis Consultant at World Bank, Armenia\n- Designed and analysed baseline and follow-up evaluation surveys\n\n2011-2014: Program Manager at UNICEF, Armenia\n- Statistics, Monitoring and Evaluation Unit\n- Conducted Multiple Overlapping Deprivation Analysis\n\nEDUCATION:\n- PhD, Maastricht University (2018-2022)\n- Research Master of Sciences, Tilburg University (2016-2018)\n- Master of Public Health, American University of Armenia (2013-2015)\n- Bachelor's, Psychology, Yerevan State University (2007-2011)\n\nTRAINING:\n- Complex System Modeling Winter School at MIT/NECSI (2020)\n- Advanced Statistics and Data Mining, Universidad Politcnica de Madrid (2017)\n- Big Data on AWS, Pluralsight (2020)\n\nPUBLICATIONS:\n- FCMpy: A Python Module for Constructing and Analyzing Fuzzy Cognitive Maps\n- How to Use Machine Learning and Fuzzy Cognitive Maps to Test Hypothetical Scenarios\n- Dealing with complexity: How to use a hybrid approach to incorporate complexity in health behavior interventions\n\nLANGUAGES: English, Dutch, Russian, Spanish, Armenian\n`;\n\n// Simulated candidate with varied response behaviors\nclass SimulatedCandidate {\n  private model: ChatGroq;\n  private profile: {\n    name: string;\n    cv: string;\n  };\n\n  constructor(name: string, cv: string) {\n    this.profile = { name, cv };\n    this.model = new ChatGroq({\n      model: \"llama-3.1-8b-instant\",\n      temperature: 0.8,\n    });\n  }\n\n  async respond(\n    interviewerMessage: string, \n    conversationHistory: ConversationTurn[],\n    responseType: ResponseType\n  ): Promise<string> {\n    const historyText = conversationHistory.slice(-6)\n      .map(turn => `${turn.speaker === 'interviewer' ? 'Interviewer' : 'You'}: ${turn.message}`)\n      .join('\\n');\n\n    const responseInstructions = {\n      'complete': `Give a COMPLETE answer with ONE specific example. \n        Keep it SHORT: 2-3 sentences max. Be conversational, not formal.\n        Example: \"Yes, I built a churn model at Rabobank using Python and scikit-learn. It reduced churn by 15%.\"`,\n      \n      'vague': `Give a VAGUE, short answer. Be general and non-committal.\n        ONE sentence only. No specific examples or numbers.\n        Examples: \"Yeah, I've worked with that before.\" or \"I have some experience there.\"`,\n      \n      'partial': `Give a PARTIAL answer - address part but miss something.\n        1-2 sentences. Mention something relevant but leave gaps.\n        Example: \"I've used Python for ML projects.\" (missing which projects, outcomes)`,\n      \n      'asks_question': `Ask a CLARIFYING QUESTION instead of answering.\n        1-2 sentences. Show interest but need more context.\n        Example: \"What kind of scale are we talking about here?\"`,\n      \n      'offers_elaboration': `Give a brief answer then OFFER TO ELABORATE more.\n        2 sentences. Provide some info, then ask if they want more details.\n        Examples: \n        - \"I worked on a churn model at Rabobank. Would you like me to elaborate on the technical details?\"\n        - \"Yes, I have experience with that. Should I go into more detail about how I implemented it?\"\n        - \"I already mentioned the predictive model. Would you like me to go deeper into the methodology?\"`,\n    };\n\n    const prompt = `You are ${this.profile.name}, a candidate in a job interview for a Senior Data Scientist position.\n\nYOUR CV/BACKGROUND:\n${this.profile.cv}\n\nCONVERSATION SO FAR:\n${historyText}\n\nINTERVIEWER'S LATEST MESSAGE:\n${interviewerMessage}\n\nRESPONSE INSTRUCTION (${responseType.toUpperCase()}):\n${responseInstructions[responseType]}\n\nRespond naturally as this candidate would, staying authentic to your CV background.\nYOUR RESPONSE (just the response, no prefix):`;\n\n    const response = await this.model.invoke(prompt);\n    return response.content.toString().trim();\n  }\n}\n\n// Quality evaluator\nclass QualityEvaluator {\n  private model: ChatGroq;\n\n  constructor() {\n    this.model = new ChatGroq({\n      model: \"llama-3.1-8b-instant\",\n      temperature: 0.2,\n    });\n  }\n\n  async evaluate(\n    conversation: ConversationTurn[],\n    jobTitle: string,\n    candidateLevel: string\n  ): Promise<QualityEvaluation> {\n    const conversationText = conversation\n      .map(turn => {\n        const typeLabel = turn.responseType ? ` [${turn.responseType}]` : '';\n        return `[${turn.speaker.toUpperCase()}${turn.questionNumber ? ` Q${turn.questionNumber}` : ''}${typeLabel}]: ${turn.message}`;\n      })\n      .join('\\n\\n');\n\n    const prompt = `You are an expert at evaluating interview quality. Analyze this interview for a ${jobTitle} position (${candidateLevel} level).\n\nNote: Response types [vague], [partial], [asks_question] indicate intentionally limited candidate answers to test how the interviewer handles them.\n\nCONVERSATION:\n${conversationText}\n\nEvaluate the INTERVIEWER's performance:\n\n1. FLOW (1-10): \n   - Were transitions smooth?\n   - Did follow-ups make sense after vague/partial answers?\n   - Was there logical structure?\n   - Any awkward repetitions?\n\n2. NATURALNESS (1-10):\n   - Did it feel scripted or authentic?\n   - Did interviewer adapt to varied response quality?\n   - Were acknowledgments appropriate?\n   - Did interviewer probe deeper when answers were vague?\n\n3. RELEVANCE (1-10):\n   - Were questions appropriate for ${candidateLevel} ${jobTitle}?\n   - Did questions leverage the candidate's specific CV/background?\n   - Were technical depth and behavioral questions balanced?\n\nAlso provide 3-5 specific improvements to make the flow more like a real interview.\n\nRespond in JSON:\n{\n  \"flow\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"naturalness\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"relevance\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"overallScore\": <weighted average>,\n  \"summary\": \"<overall assessment>\",\n  \"improvements\": [\"<improvement 1>\", \"<improvement 2>\", ...]\n}`;\n\n    const response = await this.model.invoke(prompt);\n    let content = response.content.toString().trim();\n    \n    // Strip markdown\n    if (content.startsWith('```json')) content = content.slice(7);\n    else if (content.startsWith('```')) content = content.slice(3);\n    if (content.endsWith('```')) content = content.slice(0, -3);\n    \n    try {\n      return JSON.parse(content.trim());\n    } catch (e) {\n      console.error('Parse error:', content);\n      return {\n        flow: { score: 0, reasoning: 'Parse error' },\n        naturalness: { score: 0, reasoning: 'Parse error' },\n        relevance: { score: 0, reasoning: 'Parse error' },\n        overallScore: 0,\n        summary: 'Failed to parse',\n        improvements: []\n      };\n    }\n  }\n}\n\nasync function runSingleInterview(iteration: number): Promise<IterationResult> {\n  console.log(`\\n${'='.repeat(80)}`);\n  console.log(`ITERATION ${iteration}`);\n  console.log('='.repeat(80));\n  \n  const orchestrator = new InterviewOrchestrator();\n  \n  const jobContext = {\n    companyName: \"DataViz Pro\",\n    companyDescription: \"A leading data visualization and analytics company helping enterprises make data-driven decisions.\",\n    jobTitle: \"Senior Data Scientist\",\n    jobRequirements: `\n      - 5+ years of experience in data science or machine learning\n      - Strong proficiency in Python, scikit-learn, TensorFlow or PyTorch\n      - Experience with statistical analysis and A/B testing\n      - Ability to communicate findings to non-technical stakeholders\n      - Experience building and deploying ML models to production\n      - Background in anomaly detection or forecasting preferred\n    `,\n    candidateCv: SAMVEL_CV\n  };\n  \n  const candidate = new SimulatedCandidate(\"Samvel\", SAMVEL_CV);\n  const conversation: ConversationTurn[] = [];\n  let questionCount = 0;\n  \n  // Start interview\n  const { session, greeting, isPreludeMode } = await orchestrator.startInterview(\n    1, \"behavioral\", \"Data Scientist\", \"medium\", 10, jobContext, \"Samvel\"\n  );\n  \n  console.log(`\\n[INTERVIEWER - Greeting]: ${greeting}`);\n  conversation.push({ speaker: 'interviewer', message: greeting || '' });\n  \n  // Handle prelude with complete responses (greetings should be natural)\n  let candidateResponse = await candidate.respond(greeting || '', conversation, 'complete');\n  console.log(`[CANDIDATE]: ${candidateResponse}\\n`);\n  conversation.push({ speaker: 'candidate', message: candidateResponse, responseType: 'complete' });\n  \n  if (isPreludeMode) {\n    // Intro exchange\n    const prelude1 = await orchestrator.handlePreludeResponse(session.id, candidateResponse);\n    if (prelude1.preludeMessage) {\n      console.log(`[INTERVIEWER]: ${prelude1.preludeMessage}`);\n      conversation.push({ speaker: 'interviewer', message: prelude1.preludeMessage });\n      \n      candidateResponse = await candidate.respond(prelude1.preludeMessage, conversation, 'complete');\n      console.log(`[CANDIDATE]: ${candidateResponse}\\n`);\n      conversation.push({ speaker: 'candidate', message: candidateResponse, responseType: 'complete' });\n      \n      // Self-intro\n      const prelude2 = await orchestrator.handlePreludeResponse(session.id, candidateResponse);\n      if (prelude2.preludeMessage) {\n        console.log(`[INTERVIEWER]: ${prelude2.preludeMessage}`);\n        conversation.push({ speaker: 'interviewer', message: prelude2.preludeMessage });\n        \n        // First real answer - use varied response\n        const responseType = getRandomResponseType();\n        candidateResponse = await candidate.respond(prelude2.preludeMessage, conversation, responseType);\n        console.log(`[CANDIDATE] (${responseType}): ${candidateResponse}\\n`);\n        conversation.push({ speaker: 'candidate', message: candidateResponse, responseType });\n        \n        // Get first question\n        const prelude3 = await orchestrator.handlePreludeResponse(session.id, candidateResponse);\n        if (prelude3.firstQuestion) {\n          questionCount++;\n          console.log(`[INTERVIEWER - Q${questionCount}]: ${prelude3.firstQuestion.questionText}`);\n          conversation.push({ \n            speaker: 'interviewer', \n            message: prelude3.firstQuestion.questionText,\n            questionNumber: questionCount\n          });\n        }\n      }\n    }\n  }\n  \n  // Main interview loop - let it run until natural wrap-up (no artificial limit)\n  const maxQuestions = 20; // Safety limit only, should wrap up naturally before this\n  \n  while (questionCount < maxQuestions) {\n    const currentSession = await storage.getInterviewSession(session.id);\n    if (!currentSession || currentSession.status === 'completed') break;\n    \n    const questions = await storage.getInterviewQuestions(session.id);\n    const currentQuestion = questions[questions.length - 1];\n    if (!currentQuestion) break;\n    \n    // Varied response type\n    const responseType = getRandomResponseType();\n    candidateResponse = await candidate.respond(currentQuestion.questionText, conversation, responseType);\n    console.log(`[CANDIDATE] (${responseType}): ${candidateResponse}\\n`);\n    conversation.push({ speaker: 'candidate', message: candidateResponse, responseType });\n    \n    const result = await orchestrator.submitAnswer(session.id, currentQuestion.id, candidateResponse);\n    \n    if (result.finalReport) {\n      if (result.closure) {\n        console.log(`[INTERVIEWER - Closure]: ${result.closure}`);\n        conversation.push({ speaker: 'interviewer', message: result.closure });\n      }\n      break;\n    }\n    \n    if (result.nextQuestion) {\n      questionCount++;\n      let response = '';\n      if (result.reflection) response += result.reflection + ' ';\n      response += result.nextQuestion.questionText;\n      \n      console.log(`[INTERVIEWER - Q${questionCount}]: ${response}`);\n      conversation.push({ \n        speaker: 'interviewer', \n        message: response,\n        questionNumber: questionCount\n      });\n    }\n  }\n  \n  // Evaluate\n  const evaluator = new QualityEvaluator();\n  const evaluation = await evaluator.evaluate(conversation, \"Senior Data Scientist\", \"Senior\");\n  \n  console.log(`\\n--- Iteration ${iteration} Scores ---`);\n  console.log(`Flow: ${evaluation.flow.score}/10 | Naturalness: ${evaluation.naturalness.score}/10 | Relevance: ${evaluation.relevance.score}/10`);\n  console.log(`Overall: ${evaluation.overallScore}/10`);\n  \n  return { iteration, questionCount, conversation, evaluation };\n}\n\nasync function runAllIterations() {\n  console.log('\\n' + ''.repeat(80));\n  console.log('INTERVIEW QUALITY TEST - 5 ITERATIONS');\n  console.log('Candidate: Samvel Mkhitaryan, PhD (Senior Data Scientist at Rabobank)');\n  console.log('Position: Senior Data Scientist at DataViz Pro');\n  console.log(''.repeat(80));\n  \n  const results: IterationResult[] = [];\n  \n  for (let i = 1; i <= 1; i++) {\n    try {\n      const result = await runSingleInterview(i);\n      results.push(result);\n      \n      // Brief pause between iterations\n      await new Promise(resolve => setTimeout(resolve, 1000));\n    } catch (error: any) {\n      console.error(`\\nIteration ${i} failed:`, error.message);\n      if (error.message?.includes('Rate limit')) {\n        console.log('Rate limit hit - stopping test');\n        break;\n      }\n    }\n  }\n  \n  // Aggregate results\n  console.log('\\n' + ''.repeat(80));\n  console.log('AGGREGATE RESULTS');\n  console.log(''.repeat(80));\n  \n  if (results.length === 0) {\n    console.log('No successful iterations');\n    return;\n  }\n  \n  const avgFlow = results.reduce((sum, r) => sum + r.evaluation.flow.score, 0) / results.length;\n  const avgNatural = results.reduce((sum, r) => sum + r.evaluation.naturalness.score, 0) / results.length;\n  const avgRelevance = results.reduce((sum, r) => sum + r.evaluation.relevance.score, 0) / results.length;\n  const avgOverall = results.reduce((sum, r) => sum + r.evaluation.overallScore, 0) / results.length;\n  \n  console.log(`\\nAVERAGE SCORES (${results.length} iterations):`);\n  console.log(`  Flow:        ${avgFlow.toFixed(1)}/10`);\n  console.log(`  Naturalness: ${avgNatural.toFixed(1)}/10`);\n  console.log(`  Relevance:   ${avgRelevance.toFixed(1)}/10`);\n  console.log(`  Overall:     ${avgOverall.toFixed(1)}/10`);\n  \n  // Collect all improvements\n  const allImprovements = results.flatMap(r => r.evaluation.improvements);\n  const improvementCounts = new Map<string, number>();\n  allImprovements.forEach(imp => {\n    const key = imp.toLowerCase().slice(0, 50);\n    improvementCounts.set(key, (improvementCounts.get(key) || 0) + 1);\n  });\n  \n  console.log('\\nTOP IMPROVEMENTS SUGGESTED:');\n  results.forEach((r, i) => {\n    console.log(`\\n  Iteration ${i + 1}:`);\n    r.evaluation.improvements.forEach((imp, j) => {\n      console.log(`    ${j + 1}. ${imp}`);\n    });\n  });\n  \n  console.log('\\nSUMMARIES:');\n  results.forEach((r, i) => {\n    console.log(`  [${i + 1}] ${r.evaluation.summary}`);\n  });\n  \n  // Check for CV knowledge usage\n  console.log('\\n' + '-'.repeat(80));\n  console.log('CV KNOWLEDGE CHECK:');\n  console.log('-'.repeat(80));\n  \n  const cvKeywords = ['Rabobank', 'Maastricht', 'PhD', 'Fuzzy Cognitive Maps', 'FCMpy', 'UNICEF', 'UNFPA', 'RedKite', 'PySpark', 'Armenia'];\n  \n  results.forEach((r, i) => {\n    const interviewerMessages = r.conversation\n      .filter(t => t.speaker === 'interviewer')\n      .map(t => t.message)\n      .join(' ');\n    \n    const usedKeywords = cvKeywords.filter(kw => \n      interviewerMessages.toLowerCase().includes(kw.toLowerCase())\n    );\n    \n    console.log(`  Iteration ${i + 1}: CV references used: ${usedKeywords.length > 0 ? usedKeywords.join(', ') : 'None detected'}`);\n  });\n  \n  console.log('\\n' + ''.repeat(80));\n  console.log('TEST COMPLETE');\n  console.log(''.repeat(80));\n}\n\nrunAllIterations()\n  .then(() => process.exit(0))\n  .catch(error => {\n    console.error('Test failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":18622,"size_tokens":null},"server/scripts/test-qwq-comparison.ts":{"content":"/**\n * QwQ-32B vs Llama Comparison Test\n * \n * Compares the interview quality between the two models.\n */\n\nimport { ChatGroq } from '@langchain/groq';\nimport { PromptTemplate } from '@langchain/core/prompts';\nimport { StringOutputParser } from '@langchain/core/output_parsers';\n\n// Samvel's CV\nconst SAMVEL_CV = `\nSAMVEL MKHITARYAN, PhD\n\nHIGHLIGHTS:\n 7+ years in research and program management positions\n 4+ years in data analytics\n 4+ years using Python, R and SQL, Power BI and Tableau\n Working knowledge of Machine Learning and AI\n Knowledge of Apache Spark and PySpark technologies\n\nEXPERIENCE:\n2025-Now: Senior Data Scientist at Rabobank, Utrecht, Netherlands\n- Applied statistical methods and machine learning to obtain insights from data\n- Built, tested and validated predictive models\n\n2018-2022: PhD Candidate, Maastricht University\n- Developed computational framework using Fuzzy Cognitive Maps and Machine Learning\n\n2019-2021: Data Analyst at RedKite, Armenia\n- Collected and analysed user experience data for a SaaS\n- Designed experiments to test new features\n\nEDUCATION:\n- PhD, Maastricht University (2018-2022)\n- Research Master of Sciences, Tilburg University (2016-2018)\n`;\n\nconst JOB_REQUIREMENTS = `\n- 5+ years of experience in data science or machine learning\n- Strong proficiency in Python, scikit-learn, TensorFlow or PyTorch\n- Experience with statistical analysis and A/B testing\n- Ability to communicate findings to non-technical stakeholders\n- Experience building and deploying ML models to production\n`;\n\n// Test prompt - interview question generation\nconst testPrompt = PromptTemplate.fromTemplate(`\nYou are an HR recruiter preparing for an interview.\n\nCANDIDATE CV:\n{cv}\n\nJOB REQUIREMENTS:\n{requirements}\n\nGenerate 3 interview questions that:\n1. Reference specific details from the candidate's CV\n2. Are relevant to the job requirements\n3. Would help assess the candidate's fit\n\nFormat: Return just the 3 questions, numbered.\n`);\n\n// Response evaluation prompt\nconst evaluationPrompt = PromptTemplate.fromTemplate(`\nYou are evaluating an interview question.\n\nQUESTION: {question}\nCANDIDATE ANSWER: {answer}\n\nEvaluate the answer and decide:\n1. Was it complete with specific examples? (satisfied)\n2. Was it partial - addressed some but missed key aspects? (partial) \n3. Was it vague without specifics? (vague)\n\nIf partial or vague, provide a SHORT follow-up question (max 15 words) that probes for specifics.\n\nOutput JSON:\n{{\n  \"outcome\": \"satisfied|partial|vague\",\n  \"followUp\": \"specific follow-up question if needed\"\n}}\n`);\n\nasync function testModel(modelName: string, modelConfig: { temperature: number; top_p?: number }) {\n  console.log(`\\n${'='.repeat(60)}`);\n  console.log(`Testing: ${modelName}`);\n  console.log(`Config: temperature=${modelConfig.temperature}${modelConfig.top_p ? `, top_p=${modelConfig.top_p}` : ''}`);\n  console.log('='.repeat(60));\n\n  const model = new ChatGroq({\n    model: modelName,\n    temperature: modelConfig.temperature,\n    ...(modelConfig.top_p && { topP: modelConfig.top_p }),\n  });\n\n  const startTime = Date.now();\n\n  // Test 1: Generate interview questions\n  console.log('\\n[Test 1] Generating interview questions...');\n  const questionChain = testPrompt.pipe(model).pipe(new StringOutputParser());\n  \n  const questions = await questionChain.invoke({\n    cv: SAMVEL_CV,\n    requirements: JOB_REQUIREMENTS,\n  });\n\n  const questionTime = Date.now() - startTime;\n  console.log(`Generated in ${questionTime}ms:`);\n  \n  // Strip thinking tokens if present (for QwQ)\n  let cleanQuestions = questions;\n  if (questions.includes('<think>')) {\n    const thinkEnd = questions.indexOf('</think>');\n    if (thinkEnd !== -1) {\n      cleanQuestions = questions.slice(thinkEnd + 8).trim();\n      console.log(`[Thinking tokens removed - ${questions.indexOf('</think>')} chars]`);\n    }\n  }\n  console.log(cleanQuestions);\n\n  // Test 2: Evaluate a partial answer\n  console.log('\\n[Test 2] Evaluating partial answer...');\n  const evalStart = Date.now();\n  \n  const evalChain = evaluationPrompt.pipe(model).pipe(new StringOutputParser());\n  \n  const evaluation = await evalChain.invoke({\n    question: \"Can you walk me through your experience with model deployment?\",\n    answer: \"I have experience deploying models at Rabobank using Python.\",\n  });\n\n  const evalTime = Date.now() - evalStart;\n  console.log(`Evaluated in ${evalTime}ms:`);\n  \n  // Strip thinking tokens\n  let cleanEval = evaluation;\n  if (evaluation.includes('<think>')) {\n    const thinkEnd = evaluation.indexOf('</think>');\n    if (thinkEnd !== -1) {\n      cleanEval = evaluation.slice(thinkEnd + 8).trim();\n      console.log(`[Thinking tokens removed]`);\n    }\n  }\n  // Strip markdown code blocks\n  if (cleanEval.startsWith('```json')) cleanEval = cleanEval.slice(7);\n  if (cleanEval.startsWith('```')) cleanEval = cleanEval.slice(3);\n  if (cleanEval.endsWith('```')) cleanEval = cleanEval.slice(0, -3);\n  \n  console.log(cleanEval.trim());\n\n  // Test 3: Evaluate a vague answer\n  console.log('\\n[Test 3] Evaluating vague answer...');\n  const vagueStart = Date.now();\n  \n  const vagueEval = await evalChain.invoke({\n    question: \"How do you stay up-to-date with ML developments?\",\n    answer: \"I read blogs and papers.\",\n  });\n\n  const vagueTime = Date.now() - vagueStart;\n  console.log(`Evaluated in ${vagueTime}ms:`);\n  \n  let cleanVague = vagueEval;\n  if (vagueEval.includes('<think>')) {\n    const thinkEnd = vagueEval.indexOf('</think>');\n    if (thinkEnd !== -1) {\n      cleanVague = vagueEval.slice(thinkEnd + 8).trim();\n      console.log(`[Thinking tokens removed]`);\n    }\n  }\n  if (cleanVague.startsWith('```json')) cleanVague = cleanVague.slice(7);\n  if (cleanVague.startsWith('```')) cleanVague = cleanVague.slice(3);\n  if (cleanVague.endsWith('```')) cleanVague = cleanVague.slice(0, -3);\n  \n  console.log(cleanVague.trim());\n\n  const totalTime = Date.now() - startTime;\n  console.log(`\\nTotal time: ${totalTime}ms`);\n  \n  return {\n    model: modelName,\n    questionTime,\n    evalTime,\n    vagueTime,\n    totalTime,\n  };\n}\n\nasync function main() {\n  console.log(''.repeat(60));\n  console.log('QwQ-32B vs Llama-3.1-8B Comparison');\n  console.log(''.repeat(60));\n\n  const results: any[] = [];\n\n  try {\n    // Test Llama first (smaller, faster)\n    const llamaResult = await testModel('llama-3.1-8b-instant', { \n      temperature: 0.3 \n    });\n    results.push(llamaResult);\n  } catch (error: any) {\n    console.error('Llama test failed:', error.message);\n  }\n\n  try {\n    // Test Qwen3-32B (replacement for deprecated qwen-qwq-32b)\n    const qwqResult = await testModel('qwen/qwen3-32b', { \n      temperature: 0.6,\n      top_p: 0.95,\n    });\n    results.push(qwqResult);\n  } catch (error: any) {\n    console.error('Qwen3 test failed:', error.message);\n  }\n\n  // Summary\n  console.log('\\n' + ''.repeat(60));\n  console.log('SUMMARY');\n  console.log(''.repeat(60));\n  \n  results.forEach(r => {\n    console.log(`\\n${r.model}:`);\n    console.log(`  Question generation: ${r.questionTime}ms`);\n    console.log(`  Partial eval: ${r.evalTime}ms`);\n    console.log(`  Vague eval: ${r.vagueTime}ms`);\n    console.log(`  Total: ${r.totalTime}ms`);\n  });\n}\n\nmain()\n  .then(() => process.exit(0))\n  .catch(error => {\n    console.error('Test failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":7326,"size_tokens":null},"client/src/pages/interview-history.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  ArrowLeft, \n  Trophy, \n  CheckCircle2, \n  TrendingUp, \n  AlertCircle, \n  ArrowRight,\n  Calendar,\n  Clock,\n  Target,\n  ChevronRight,\n  Loader2\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface InterviewSession {\n  id: number;\n  interviewType: string;\n  targetRole: string;\n  difficulty: string;\n  status: string;\n  overallScore?: number;\n  startedAt: string;\n  completedAt?: string;\n}\n\ninterface InterviewFeedback {\n  overallScore: number;\n  communicationScore: number;\n  technicalScore?: number;\n  problemSolvingScore: number;\n  cultureFitScore: number;\n  summary: string;\n  strengths: string[];\n  improvements: string[];\n  recommendations: string[];\n  hiringDecision: string;\n}\n\ninterface InterviewQuestion {\n  id: number;\n  questionText: string;\n  candidateAnswer?: string;\n  score?: number;\n  feedback?: string;\n}\n\nexport default function InterviewHistory() {\n  const [selectedSessionId, setSelectedSessionId] = useState<number | null>(null);\n  \n  // Fetch practice-only interviews\n  const { data: sessions, isLoading: sessionsLoading } = useQuery<InterviewSession[]>({\n    queryKey: ['/api/users/1/interviews?mode=practice']\n  });\n\n  const { data: feedbackData, isLoading: feedbackLoading } = useQuery<{\n    feedback: InterviewFeedback;\n    session: InterviewSession;\n    questions: InterviewQuestion[];\n  }>({\n    queryKey: [`/api/interviews/${selectedSessionId}/feedback`],\n    enabled: !!selectedSessionId\n  });\n\n  const completedSessions = sessions?.filter(s => s.status === 'completed') || [];\n\n  const getHiringDecisionColor = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'bg-green-100 text-green-800';\n      case 'yes': return 'bg-green-50 text-green-700';\n      case 'maybe': return 'bg-yellow-100 text-yellow-800';\n      case 'no': return 'bg-red-50 text-red-700';\n      case 'strong_no': return 'bg-red-100 text-red-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getHiringDecisionText = (decision: string) => {\n    switch (decision) {\n      case 'strong_yes': return 'Strong Hire';\n      case 'yes': return 'Hire';\n      case 'maybe': return 'Maybe';\n      case 'no': return 'No Hire';\n      case 'strong_no': return 'Strong No';\n      default: return decision;\n    }\n  };\n\n  const formatDate = (dateString: string) => {\n    return new Date(dateString).toLocaleDateString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (sessionsLoading) {\n    return (\n      <div className=\"p-8 flex items-center justify-center min-h-[400px]\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-blue-600\" />\n      </div>\n    );\n  }\n\n  if (selectedSessionId && feedbackLoading) {\n    return (\n      <div className=\"p-8 flex items-center justify-center min-h-[400px]\">\n        <div className=\"text-center space-y-4\">\n          <Loader2 className=\"h-8 w-8 animate-spin text-blue-600 mx-auto\" />\n          <p className=\"text-gray-600\">Loading feedback...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (selectedSessionId && feedbackData) {\n    const { feedback, session, questions } = feedbackData;\n    \n    return (\n      <div className=\"p-8 max-w-4xl mx-auto\">\n        <Button \n          variant=\"ghost\" \n          onClick={() => setSelectedSessionId(null)}\n          className=\"mb-6\"\n          data-testid=\"button-back-to-list\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back to History\n        </Button>\n        \n        <Card>\n          <CardHeader className=\"text-center\">\n            <div className=\"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4\">\n              <Trophy className=\"h-8 w-8 text-blue-600\" />\n            </div>\n            <CardTitle className=\"text-2xl\">Interview Feedback</CardTitle>\n            <p className=\"text-gray-600 mt-2\">\n              {session.interviewType.charAt(0).toUpperCase() + session.interviewType.slice(1)} Interview - {session.targetRole}\n            </p>\n            <p className=\"text-sm text-gray-400\">\n              {formatDate(session.completedAt || session.startedAt)}\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"text-center\">\n              <div className=\"text-5xl font-bold text-blue-600 mb-2\" data-testid=\"text-overall-score\">{feedback.overallScore}</div>\n              <p className=\"text-gray-500\">Overall Score</p>\n              <div className={cn(\"inline-block px-4 py-2 rounded-full mt-4 font-medium\", getHiringDecisionColor(feedback.hiringDecision))} data-testid=\"text-hiring-decision\">\n                {getHiringDecisionText(feedback.hiringDecision)}\n              </div>\n            </div>\n\n            <Separator />\n\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\" data-testid=\"text-communication-score\">{feedback.communicationScore}</div>\n                <p className=\"text-sm text-gray-600\">Communication</p>\n              </div>\n              {feedback.technicalScore && (\n                <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                  <div className=\"text-2xl font-semibold text-gray-900\" data-testid=\"text-technical-score\">{feedback.technicalScore}</div>\n                  <p className=\"text-sm text-gray-600\">Technical</p>\n                </div>\n              )}\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\">{feedback.problemSolvingScore}</div>\n                <p className=\"text-sm text-gray-600\">Problem Solving</p>\n              </div>\n              <div className=\"text-center p-4 bg-gray-50 rounded-lg\">\n                <div className=\"text-2xl font-semibold text-gray-900\">{feedback.cultureFitScore}</div>\n                <p className=\"text-sm text-gray-600\">Culture Fit</p>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50 p-4 rounded-lg\">\n              <h4 className=\"font-semibold text-gray-900 mb-2\">Summary</h4>\n              <p className=\"text-gray-700\">{feedback.summary}</p>\n            </div>\n\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-500 mr-2\" />\n                  Strengths\n                </h4>\n                <ul className=\"space-y-2\">\n                  {feedback.strengths.map((strength, i) => (\n                    <li key={i} className=\"flex items-start\">\n                      <span className=\"text-green-500 mr-2\"></span>\n                      <span className=\"text-gray-700\">{strength}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n              <div>\n                <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                  <TrendingUp className=\"h-5 w-5 text-orange-500 mr-2\" />\n                  Areas to Improve\n                </h4>\n                <ul className=\"space-y-2\">\n                  {feedback.improvements.map((improvement, i) => (\n                    <li key={i} className=\"flex items-start\">\n                      <span className=\"text-orange-500 mr-2\"></span>\n                      <span className=\"text-gray-700\">{improvement}</span>\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            </div>\n\n            <div>\n              <h4 className=\"font-semibold text-gray-900 mb-3 flex items-center\">\n                <AlertCircle className=\"h-5 w-5 text-blue-500 mr-2\" />\n                Recommendations\n              </h4>\n              <ul className=\"space-y-2\">\n                {feedback.recommendations.map((rec, i) => (\n                  <li key={i} className=\"flex items-start bg-gray-50 p-3 rounded-lg\">\n                    <ArrowRight className=\"h-5 w-5 text-blue-500 mr-2 mt-0.5 flex-shrink-0\" />\n                    <span className=\"text-gray-700\">{rec}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n\n            {questions && questions.length > 0 && (\n              <>\n                <Separator />\n                <div>\n                  <h4 className=\"font-semibold text-gray-900 mb-4\">Questions & Answers</h4>\n                  <div className=\"space-y-4\">\n                    {questions.filter(q => q.candidateAnswer).map((question, i) => (\n                      <div key={question.id} className=\"bg-gray-50 p-4 rounded-lg\">\n                        <div className=\"flex items-start justify-between mb-2\">\n                          <p className=\"font-medium text-gray-900\">Q{i + 1}: {question.questionText}</p>\n                          {question.score && (\n                            <Badge variant={question.score >= 7 ? \"default\" : question.score >= 5 ? \"secondary\" : \"destructive\"}>\n                              {question.score}/10\n                            </Badge>\n                          )}\n                        </div>\n                        <p className=\"text-gray-600 text-sm mb-2\">{question.candidateAnswer}</p>\n                        {question.feedback && (\n                          <p className=\"text-xs text-gray-500 italic\">{question.feedback}</p>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </>\n            )}\n\n            <div className=\"flex justify-center pt-4\">\n              <Link href=\"/interview\">\n                <Button size=\"lg\" data-testid=\"button-practice-again\">\n                  Practice Again\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-4xl mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <div>\n            <h1 className=\"text-2xl font-bold text-gray-900\">Practice History</h1>\n            <p className=\"text-gray-600 mt-1\">Track your interview practice sessions and progress</p>\n          </div>\n          <Link href=\"/interview\">\n            <Button data-testid=\"button-new-interview\">\n              New Practice\n            </Button>\n          </Link>\n        </div>\n        \n        {/* Cross-link to Journey interviews */}\n        <div className=\"mb-6 text-sm text-gray-500\">\n          Looking for job application interviews?{' '}\n          <Link href=\"/journey\" className=\"text-blue-600 hover:underline\">\n            View Journey History \n          </Link>\n        </div>\n\n        {completedSessions.length === 0 ? (\n          <Card>\n            <CardContent className=\"py-12 text-center\">\n              <Target className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No practice sessions yet</h3>\n              <p className=\"text-gray-500 mb-6\">Start your first practice interview to build your history</p>\n              <Link href=\"/interview\">\n                <Button data-testid=\"button-start-first-interview\">Start Your First Practice</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        ) : (\n          <div className=\"space-y-4\">\n            {completedSessions.map((session) => (\n              <Card \n                key={session.id} \n                className=\"cursor-pointer hover:shadow-md transition-shadow\"\n                onClick={() => setSelectedSessionId(session.id)}\n                data-testid={`card-session-${session.id}`}\n              >\n                <CardContent className=\"py-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className={cn(\n                        \"w-12 h-12 rounded-full flex items-center justify-center\",\n                        session.overallScore && session.overallScore >= 70 \n                          ? \"bg-green-100\" \n                          : session.overallScore && session.overallScore >= 50 \n                            ? \"bg-yellow-100\" \n                            : \"bg-red-100\"\n                      )}>\n                        <span className={cn(\n                          \"text-lg font-bold\",\n                          session.overallScore && session.overallScore >= 70 \n                            ? \"text-green-600\" \n                            : session.overallScore && session.overallScore >= 50 \n                              ? \"text-yellow-600\" \n                              : \"text-red-600\"\n                        )}>\n                          {session.overallScore || ''}\n                        </span>\n                      </div>\n                      <div>\n                        <h3 className=\"font-medium text-gray-900\">\n                          {session.interviewType.charAt(0).toUpperCase() + session.interviewType.slice(1)} Interview\n                        </h3>\n                        <div className=\"flex items-center space-x-3 text-sm text-gray-500\">\n                          <span className=\"flex items-center\">\n                            <Target className=\"h-3 w-3 mr-1\" />\n                            {session.targetRole}\n                          </span>\n                          <span className=\"flex items-center\">\n                            <Calendar className=\"h-3 w-3 mr-1\" />\n                            {formatDate(session.completedAt || session.startedAt)}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-3\">\n                      <Badge variant=\"outline\" className=\"capitalize\">\n                        {session.difficulty}\n                      </Badge>\n                      <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14672,"size_tokens":null},"server/services/completion-decision.ts":{"content":"/**\n * CompletionDecision Engine\n * \n * Determines when an interview should continue, prioritize specific topics,\n * or wrap up based on coverage, confidence, time, and telemetry data.\n */\n\nimport { \n  StageRuntimeSettings, \n  AssessmentCriterion \n} from \"./interview-chains\";\n\n// Coverage tracking types (matching orchestrator)\ninterface CoverageScore {\n  score: number;\n  notes: string[];\n  questionsAsked: number;\n}\n\ninterface CoverageTracker {\n  background: CoverageScore;\n  skills: CoverageScore;\n  behavioral: CoverageScore;\n  motivation: CoverageScore;\n  culture_fit: CoverageScore;\n  logistics: CoverageScore;\n}\n\n// Session telemetry\ninterface SessionTelemetry {\n  startedAt: number;\n  firstQuestionAt?: number;\n  followUpsUsed: number;\n  lowScoreStreak: number;\n  highScoreStreak: number;\n  avgConfidence: number;\n}\n\n// Decision outcomes\nexport type CompletionAction = \n  | { type: 'continue' }\n  | { type: 'prioritize'; topic: AssessmentCriterion; reason: string }\n  | { type: 'wrap_up'; reason: WrapUpReason; message?: string };\n\nexport type WrapUpReason = \n  | 'sufficient_coverage'      // Enough info collected\n  | 'time_limit'               // Approaching max duration\n  | 'max_questions'            // Hit question limit\n  | 'high_confidence_positive' // Clearly qualified candidate\n  | 'high_confidence_negative' // Clearly unqualified candidate\n  | 'candidate_fatigue';       // Too many low scores in a row\n\n// Input for the decision engine\nexport interface CompletionDecisionInput {\n  coverage: CoverageTracker;\n  telemetry: SessionTelemetry;\n  questionsAsked: number;\n  stageSettings: StageRuntimeSettings;\n  pendingBacklogCount: number; // Questions still pending in backlog\n  avgScore: number;            // Average score across all answers\n}\n\n// Result includes pacing info for the frontend\nexport interface CompletionDecisionResult {\n  action: CompletionAction;\n  pacing: {\n    elapsedMs: number;\n    elapsedMinutes: number;\n    progressPercent: number;  // 0-100 based on time\n    status: 'starting' | 'on_track' | 'mid_interview' | 'wrapping_soon' | 'overtime';\n    timeRemaining?: string;   // Human-readable time remaining\n  };\n  coverageSummary: {\n    overall: number;\n    critical: number;\n    gaps: AssessmentCriterion[];\n  };\n}\n\n/**\n * Analyzes interview state and returns a completion decision\n */\nexport function evaluateCompletion(input: CompletionDecisionInput): CompletionDecisionResult {\n  const { coverage, telemetry, questionsAsked, stageSettings, pendingBacklogCount, avgScore } = input;\n  \n  // Calculate elapsed time\n  const elapsedMs = Date.now() - telemetry.startedAt;\n  const elapsedMinutes = Math.floor(elapsedMs / 60000);\n  \n  // Calculate pacing\n  const pacing = calculatePacing(elapsedMs, stageSettings);\n  \n  // Calculate coverage scores\n  const coverageSummary = calculateCoverageSummary(coverage, stageSettings.criticalCriteria);\n  \n  // Decision logic\n  const action = determineAction({\n    coverage,\n    coverageSummary,\n    telemetry,\n    questionsAsked,\n    stageSettings,\n    pendingBacklogCount,\n    avgScore,\n    elapsedMs,\n    pacing\n  });\n  \n  return {\n    action,\n    pacing,\n    coverageSummary\n  };\n}\n\nfunction calculatePacing(\n  elapsedMs: number, \n  settings: StageRuntimeSettings\n): CompletionDecisionResult['pacing'] {\n  const { minDurationMs, maxDurationMs } = settings;\n  const midPointMs = (minDurationMs + maxDurationMs) / 2;\n  \n  // Progress as percentage of max duration\n  const progressPercent = Math.min(100, Math.round((elapsedMs / maxDurationMs) * 100));\n  \n  // Determine status\n  let status: CompletionDecisionResult['pacing']['status'];\n  if (elapsedMs < minDurationMs * 0.3) {\n    status = 'starting';\n  } else if (elapsedMs < minDurationMs) {\n    status = 'on_track';\n  } else if (elapsedMs < midPointMs) {\n    status = 'mid_interview';\n  } else if (elapsedMs < maxDurationMs * 0.9) {\n    status = 'wrapping_soon';\n  } else {\n    status = 'overtime';\n  }\n  \n  // Calculate remaining time\n  const remainingMs = Math.max(0, maxDurationMs - elapsedMs);\n  const remainingMinutes = Math.ceil(remainingMs / 60000);\n  const timeRemaining = remainingMinutes > 0 ? `${remainingMinutes} min remaining` : 'Time up';\n  \n  return {\n    elapsedMs,\n    elapsedMinutes: Math.floor(elapsedMs / 60000),\n    progressPercent,\n    status,\n    timeRemaining\n  };\n}\n\nfunction calculateCoverageSummary(\n  coverage: CoverageTracker,\n  criticalCriteria: AssessmentCriterion[]\n): CompletionDecisionResult['coverageSummary'] {\n  const allCriteria: AssessmentCriterion[] = [\n    'background', 'skills', 'behavioral', 'motivation', 'culture_fit', 'logistics'\n  ];\n  \n  // Calculate overall coverage (weighted average)\n  let totalScore = 0;\n  let count = 0;\n  for (const criterion of allCriteria) {\n    totalScore += coverage[criterion].score;\n    count++;\n  }\n  const overall = count > 0 ? totalScore / count : 0;\n  \n  // Calculate critical coverage\n  let criticalTotal = 0;\n  let criticalCount = 0;\n  for (const criterion of criticalCriteria) {\n    criticalTotal += coverage[criterion].score;\n    criticalCount++;\n  }\n  const critical = criticalCount > 0 ? criticalTotal / criticalCount : 0;\n  \n  // Find gaps (criteria with score < 0.3)\n  const gaps: AssessmentCriterion[] = [];\n  for (const criterion of criticalCriteria) {\n    if (coverage[criterion].score < 0.3) {\n      gaps.push(criterion);\n    }\n  }\n  \n  return { overall, critical, gaps };\n}\n\ninterface DecisionContext {\n  coverage: CoverageTracker;\n  coverageSummary: CompletionDecisionResult['coverageSummary'];\n  telemetry: SessionTelemetry;\n  questionsAsked: number;\n  stageSettings: StageRuntimeSettings;\n  pendingBacklogCount: number;\n  avgScore: number;\n  elapsedMs: number;\n  pacing: CompletionDecisionResult['pacing'];\n}\n\nfunction determineAction(ctx: DecisionContext): CompletionAction {\n  const { coverageSummary, telemetry, questionsAsked, stageSettings, avgScore, elapsedMs, pacing } = ctx;\n  const { minQuestions, maxQuestions, sufficiencyThresholds } = stageSettings;\n  \n  // 1. Hard limit: Max questions reached\n  if (questionsAsked >= maxQuestions) {\n    return { \n      type: 'wrap_up', \n      reason: 'max_questions',\n      message: \"We've covered a lot of ground today\"\n    };\n  }\n  \n  // 2. Time limit: Approaching or exceeding max duration\n  if (pacing.status === 'overtime') {\n    return { \n      type: 'wrap_up', \n      reason: 'time_limit',\n      message: \"We're running up against our time limit\"\n    };\n  }\n  \n  // 3. Candidate fatigue: Too many consecutive low scores\n  if (telemetry.lowScoreStreak >= 3 && questionsAsked >= minQuestions) {\n    return { \n      type: 'wrap_up', \n      reason: 'candidate_fatigue',\n      message: \"I think I have a good sense of your background\"\n    };\n  }\n  \n  // 4. High confidence negative: Low average and consistent pattern\n  if (avgScore < 4 && questionsAsked >= minQuestions && telemetry.lowScoreStreak >= 2) {\n    return { \n      type: 'wrap_up', \n      reason: 'high_confidence_negative',\n      message: \"I appreciate you taking the time to speak with me today\"\n    };\n  }\n  \n  // 5. High confidence positive: Excellent performance\n  if (avgScore >= 8 && telemetry.highScoreStreak >= 3 && questionsAsked >= minQuestions) {\n    // Check if we have sufficient coverage too\n    if (coverageSummary.overall >= sufficiencyThresholds.overall && \n        coverageSummary.critical >= sufficiencyThresholds.critical) {\n      return { \n        type: 'wrap_up', \n        reason: 'high_confidence_positive',\n        message: \"I'm really impressed with what you've shared\"\n      };\n    }\n  }\n  \n  // 6. Sufficient coverage: Met all thresholds\n  if (questionsAsked >= minQuestions &&\n      coverageSummary.overall >= sufficiencyThresholds.overall &&\n      coverageSummary.critical >= sufficiencyThresholds.critical) {\n    return { \n      type: 'wrap_up', \n      reason: 'sufficient_coverage',\n      message: \"I have a great picture of your experience\"\n    };\n  }\n  \n  // 7. Approaching time limit with gaps - prioritize critical topics\n  if (pacing.status === 'wrapping_soon' && coverageSummary.gaps.length > 0) {\n    const priorityTopic = coverageSummary.gaps[0];\n    return { \n      type: 'prioritize', \n      topic: priorityTopic,\n      reason: `Let's focus our remaining time on ${formatCriterion(priorityTopic)}`\n    };\n  }\n  \n  // 8. Default: Continue normally\n  return { type: 'continue' };\n}\n\nfunction formatCriterion(criterion: AssessmentCriterion): string {\n  const labels: Record<AssessmentCriterion, string> = {\n    background: 'your background',\n    skills: 'your technical skills',\n    behavioral: 'how you work in teams',\n    motivation: 'what motivates you',\n    culture_fit: 'your work style',\n    logistics: 'logistics like availability'\n  };\n  return labels[criterion] || criterion;\n}\n\n/**\n * Generate a natural pacing notice for the interviewer to say\n */\nexport function generatePacingNotice(\n  pacing: CompletionDecisionResult['pacing'],\n  gaps: AssessmentCriterion[]\n): string | null {\n  // Only generate notices when wrapping soon with gaps\n  if (pacing.status !== 'wrapping_soon' || gaps.length === 0) {\n    return null;\n  }\n  \n  const topicLabel = formatCriterion(gaps[0]);\n  return `Before we wrap up, I'd like to touch on ${topicLabel}.`;\n}\n\n/**\n * Get the wrap-up message for the closure chain\n */\nexport function getWrapUpMessage(reason: WrapUpReason): string {\n  switch (reason) {\n    case 'sufficient_coverage':\n      return \"I have a great picture of your experience and qualifications.\";\n    case 'time_limit':\n      return \"We're running up against our time, but I've learned a lot about you.\";\n    case 'max_questions':\n      return \"We've covered a lot of ground in our conversation.\";\n    case 'high_confidence_positive':\n      return \"I'm really impressed with everything you've shared.\";\n    case 'high_confidence_negative':\n      return \"I appreciate you taking the time to speak with me today.\";\n    case 'candidate_fatigue':\n      return \"I think I have a good understanding of your background now.\";\n    default:\n      return \"Thank you for the great conversation.\";\n  }\n}\n\n/**\n * Stage runtime configuration for frontend pacing display\n */\nexport interface StageRuntimeConfig {\n  minTimeMinutes: number;\n  maxTimeMinutes: number;\n  targetTimeMinutes: number;\n}\n\n/**\n * Get stage runtime config from interview type for frontend pacing\n */\nexport function getStageRuntimeConfig(interviewType: 'hr' | 'technical' | 'final'): StageRuntimeConfig {\n  switch (interviewType) {\n    case 'hr':\n      return { minTimeMinutes: 15, maxTimeMinutes: 30, targetTimeMinutes: 22 };\n    case 'technical':\n      return { minTimeMinutes: 35, maxTimeMinutes: 55, targetTimeMinutes: 45 };\n    case 'final':\n      return { minTimeMinutes: 25, maxTimeMinutes: 40, targetTimeMinutes: 32 };\n    default:\n      return { minTimeMinutes: 15, maxTimeMinutes: 30, targetTimeMinutes: 22 };\n  }\n}\n","path":null,"size_bytes":10878,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/components/simulation/intern-onboarding-session.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nimport standupScriptData from \"@shared/catalogue/workspace/standup-script.json\";\nimport devSetupStepsData from \"@shared/catalogue/workspace/dev-setup-steps.json\";\nimport gitWorkflowStepsData from \"@shared/catalogue/workspace/git-workflow-steps.json\";\nimport codebaseStructureData from \"@shared/catalogue/workspace/codebase-structure.json\";\nimport codeExerciseData from \"@shared/catalogue/workspace/code-exercise-timezone.json\";\nimport branchCreationData from \"@shared/catalogue/workspace/branch-creation.json\";\nimport {\n  validateSetupCommand,\n  validateGitCommand,\n  validateBranchName as validateBranchNameFromCatalogue,\n  validateCodeBlank,\n  interpolateUserName,\n  type SetupStep,\n  type GitStep,\n  type CodeBlank\n} from \"@shared/catalogue/loaders\";\nimport { \n  Send, \n  CheckCircle2, \n  Clock, \n  Target,\n  Users,\n  FileText,\n  MessageSquare,\n  ChevronRight,\n  ChevronDown,\n  Calendar,\n  BookOpen,\n  Coffee,\n  ArrowLeft,\n  Sparkles,\n  Store,\n  CreditCard,\n  Globe,\n  Bug,\n  GitBranch,\n  Code,\n  Lightbulb,\n  ArrowRight,\n  Monitor,\n  Rocket,\n  Folder,\n  FolderOpen,\n  File,\n  Terminal,\n  Play,\n  Check,\n  X,\n  Sun,\n  Clipboard,\n  GitCommit,\n  GitPullRequest,\n  PenLine,\n  MessageCircle,\n  Minimize2,\n  Star\n} from \"lucide-react\";\n\ninterface DayProgress {\n  docsRead?: boolean;\n  introProgress?: Record<string, boolean>;\n  comprehensionComplete?: boolean;\n  docSectionsRead?: Record<string, boolean>;\n  closedConversations?: Record<string, boolean>;\n  standupComplete?: boolean;\n  devSetupComplete?: boolean;\n  ticketReviewed?: boolean;\n  branchCreated?: boolean;\n  codebaseExplored?: boolean;\n  codeFixComplete?: boolean;\n  testFixComplete?: boolean;\n  gitWorkflowComplete?: boolean;\n  prCreated?: boolean;\n  reflectionComplete?: boolean;\n  codeInputs?: Record<string, string>;\n  gitInputs?: Record<string, string>;\n}\n\ninterface InternOnboardingSessionProps {\n  session: any;\n  project: any;\n  onComplete: () => void;\n  mode?: 'practice' | 'journey';\n  savedProgress?: DayProgress;\n  savedProgressId?: number;\n  initialDay?: number;\n  user?: any;\n}\n\ntype ViewMode = 'overview' | 'team-intro' | 'documentation' | 'comprehension-check' | \n  'day2-standup' | 'day2-dev-setup' | 'day2-ticket' | 'day2-branch' | 'day2-codebase' | 'day2-code-fix' | \n  'day2-test-fix' | 'day2-git' | 'day2-pr' | 'day2-reflection';\n\ninterface TeamMember {\n  name: string;\n  role: string;\n  personality: string;\n  expertise: string[];\n  availability: string;\n  bio?: string;\n}\n\n// Floating Team Chat Component\ninterface FloatingTeamChatProps {\n  isOpen: boolean;\n  onToggle: () => void;\n  teamMembers: TeamMember[];\n  activeChatMember: TeamMember | null;\n  onSelectMember: (member: TeamMember) => void;\n  message: string;\n  onMessageChange: (message: string) => void;\n  onSendMessage: () => void;\n  isSending: boolean;\n  interactions: any[];\n  typingIndicator: string | null;\n}\n\nfunction FloatingTeamChat({\n  isOpen,\n  onToggle,\n  teamMembers,\n  activeChatMember,\n  onSelectMember,\n  message,\n  onMessageChange,\n  onSendMessage,\n  isSending,\n  interactions,\n  typingIndicator\n}: FloatingTeamChatProps) {\n  const chatEndRef = useRef<HTMLDivElement>(null);\n  \n  useEffect(() => {\n    if (isOpen && chatEndRef.current) {\n      chatEndRef.current.scrollIntoView({ behavior: 'smooth' });\n    }\n  }, [interactions, isOpen]);\n\n  const filteredMessages = activeChatMember \n    ? interactions.filter((i: any) => \n        i.channel === `dm-${activeChatMember.name}` || \n        (i.sender === activeChatMember.name && i.channel === 'dm-You') ||\n        i.channel === `floating-dm-${activeChatMember.name}`\n      )\n    : [];\n\n  // Get initials for avatar\n  const getInitials = (name: string) => name.split(' ').map(n => n[0]).join('').toUpperCase();\n\n  // Get color for member\n  const getMemberColor = (name: string) => {\n    const colors: Record<string, string> = {\n      'Sarah': 'bg-blue-500',\n      'Marcus': 'bg-green-500',\n      'Priya': 'bg-purple-500',\n      'Alex': 'bg-orange-500',\n      'Jordan': 'bg-teal-500'\n    };\n    return colors[name] || 'bg-gray-500';\n  };\n\n  // Get avatar URL for team member using DiceBear API\n  const getAvatarUrl = (name: string) => {\n    const avatarSeeds: Record<string, { seed: string; style: string }> = {\n      'Sarah': { seed: 'sarah-tech-lead', style: 'avataaars' },\n      'Marcus': { seed: 'marcus-senior-dev', style: 'avataaars' },\n      'Priya': { seed: 'priya-product-mgr', style: 'avataaars' },\n      'Alex': { seed: 'alex-qa-engineer', style: 'avataaars' },\n      'Jordan': { seed: 'jordan-intern', style: 'avataaars' }\n    };\n    const config = avatarSeeds[name] || { seed: name, style: 'avataaars' };\n    return `https://api.dicebear.com/7.x/${config.style}/svg?seed=${config.seed}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`;\n  };\n\n  return (\n    <>\n      {/* Floating Chat Button - Bottom right corner (FAB style) */}\n      <button\n        onClick={onToggle}\n        className={`fixed right-6 bottom-6 z-40 flex items-center gap-2 px-4 py-3 rounded-full shadow-lg transition-all duration-200 ${\n          isOpen \n            ? 'bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300' \n            : 'bg-blue-600 hover:bg-blue-700 text-white hover:scale-105'\n        }`}\n        data-testid=\"button-floating-chat\"\n      >\n        <MessageCircle className=\"h-5 w-5\" />\n        {!isOpen && <span className=\"text-sm font-medium\">Ask Team</span>}\n      </button>\n\n      {/* Chat Panel - Bottom right, partial height */}\n      <div \n        className={`fixed right-6 bottom-20 w-80 sm:w-96 bg-white dark:bg-gray-800 shadow-2xl z-50 transform transition-all duration-300 ease-in-out rounded-2xl border border-gray-200 dark:border-gray-700 flex flex-col ${\n          isOpen ? 'opacity-100 scale-100 translate-y-0' : 'opacity-0 scale-95 translate-y-4 pointer-events-none'\n        }`}\n        style={{ height: 'clamp(420px, 70vh, 640px)' }}\n      >\n        {/* Header */}\n        <div className=\"flex items-center justify-between p-4 border-b dark:border-gray-700 bg-gray-50 dark:bg-gray-900\">\n          <h3 className=\"font-semibold text-gray-900 dark:text-white flex items-center gap-2\">\n            <MessageCircle className=\"h-5 w-5 text-blue-600\" />\n            Team Chat\n          </h3>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onToggle} data-testid=\"button-close-chat\">\n            <Minimize2 className=\"h-4 w-4\" />\n          </Button>\n        </div>\n\n        {/* Team Member Tabs */}\n        <div className=\"p-2 border-b dark:border-gray-700\">\n          <div className=\"flex gap-1 overflow-x-auto pb-1\">\n            {teamMembers.slice(0, 5).map((member) => (\n              <button\n                key={member.name}\n                onClick={() => onSelectMember(member)}\n                className={`flex flex-col items-center p-2 rounded-lg min-w-[60px] transition-colors ${\n                  activeChatMember?.name === member.name\n                    ? 'bg-blue-50 dark:bg-blue-900/30 ring-2 ring-blue-500'\n                    : 'hover:bg-gray-100 dark:hover:bg-gray-700'\n                }`}\n                data-testid={`button-chat-member-${member.name.toLowerCase()}`}\n              >\n                <Avatar className=\"h-8 w-8 ring-2 ring-white shadow-sm\">\n                  <AvatarImage src={getAvatarUrl(member.name)} alt={member.name} />\n                  <AvatarFallback className={`text-white text-xs ${getMemberColor(member.name)}`}>\n                    {getInitials(member.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <span className=\"text-xs mt-1 text-gray-600 dark:text-gray-300 truncate w-full text-center\">\n                  {member.name.split(' ')[0]}\n                </span>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Chat Content */}\n        {activeChatMember ? (\n          <div className=\"flex flex-col flex-1 min-h-0\">\n            {/* Active member info */}\n            <div className=\"px-4 py-2 bg-gray-50 dark:bg-gray-900/50 border-b dark:border-gray-700\">\n              <p className=\"text-sm font-medium text-gray-900 dark:text-white\">{activeChatMember.name}</p>\n              <p className=\"text-xs text-gray-500 dark:text-gray-400\">{activeChatMember.role}</p>\n            </div>\n\n            {/* Messages */}\n            <ScrollArea className=\"flex-1 p-4\">\n              <div className=\"space-y-3\">\n                {filteredMessages.length === 0 && (\n                  <div className=\"text-center py-6 text-gray-500 dark:text-gray-400\">\n                    <MessageCircle className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                    <p className=\"text-sm\">Send a message to {activeChatMember.name}</p>\n                    <p className=\"text-xs mt-1\">Ask for help or clarification</p>\n                  </div>\n                )}\n                {filteredMessages.map((interaction: any, idx: number) => (\n                  <div\n                    key={idx}\n                    className={`flex gap-2 ${interaction.sender === 'You' ? 'justify-end' : 'justify-start'}`}\n                  >\n                    {interaction.sender !== 'You' && (\n                      <Avatar className=\"h-7 w-7 flex-shrink-0\">\n                        <AvatarImage src={getAvatarUrl(interaction.sender)} alt={interaction.sender} />\n                        <AvatarFallback className={`text-white text-xs ${getMemberColor(interaction.sender)}`}>\n                          {getInitials(interaction.sender)}\n                        </AvatarFallback>\n                      </Avatar>\n                    )}\n                    <div\n                      className={`max-w-[80%] rounded-lg px-3 py-2 ${\n                        interaction.sender === 'You'\n                          ? 'bg-blue-600 text-white'\n                          : 'bg-gray-100 dark:bg-gray-700'\n                      }`}\n                    >\n                      <p className={`text-sm ${interaction.sender === 'You' ? 'text-white' : 'text-gray-800 dark:text-gray-200'}`}>\n                        {interaction.content}\n                      </p>\n                    </div>\n                  </div>\n                ))}\n                {typingIndicator && (\n                  <div className=\"flex justify-start\">\n                    <div className=\"bg-gray-100 dark:bg-gray-700 rounded-lg px-3 py-2\">\n                      <p className=\"text-xs text-gray-500 dark:text-gray-400\">{typingIndicator} is typing...</p>\n                    </div>\n                  </div>\n                )}\n                <div ref={chatEndRef} />\n              </div>\n            </ScrollArea>\n\n            {/* Input */}\n            <div className=\"p-3 border-t dark:border-gray-700\">\n              <div className=\"flex gap-2\">\n                <Textarea\n                  value={message}\n                  onChange={(e) => onMessageChange(e.target.value)}\n                  placeholder={`Ask ${activeChatMember.name}...`}\n                  className=\"min-h-[50px] max-h-[100px] resize-none text-sm\"\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault();\n                      onSendMessage();\n                    }\n                  }}\n                  data-testid=\"input-floating-chat\"\n                />\n                <Button \n                  size=\"sm\"\n                  onClick={onSendMessage}\n                  disabled={!message.trim() || isSending}\n                  className=\"self-end\"\n                  data-testid=\"button-send-floating-chat\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n        ) : (\n          <div className=\"flex items-center justify-center flex-1 text-gray-500 dark:text-gray-400\">\n            <div className=\"text-center\">\n              <Users className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n              <p className=\"text-sm\">Select a teammate to chat</p>\n            </div>\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n\nexport default function InternOnboardingSession({ \n  session, \n  project, \n  onComplete,\n  mode = 'journey',\n  savedProgress,\n  savedProgressId,\n  initialDay,\n  user\n}: InternOnboardingSessionProps) {\n  const [currentDay, setCurrentDay] = useState(initialDay || 1);\n  const [viewMode, setViewMode] = useState<ViewMode>('overview');\n  const [selectedMember, setSelectedMember] = useState<TeamMember | null>(null);\n  const [message, setMessage] = useState(\"\");\n  const [introProgress, setIntroProgress] = useState<Record<string, boolean>>(savedProgress?.introProgress || {});\n  const [docsRead, setDocsRead] = useState(savedProgress?.docsRead || false);\n  const [comprehensionComplete, setComprehensionComplete] = useState(savedProgress?.comprehensionComplete || false);\n  const [typingIndicator, setTypingIndicator] = useState<string | null>(null);\n  \n  const [docSectionsRead, setDocSectionsRead] = useState<Record<string, boolean>>(savedProgress?.docSectionsRead || {});\n  const [expandedSections, setExpandedSections] = useState<Record<string, boolean>>({});\n  const [showDay2Preview, setShowDay2Preview] = useState(false);\n  const [activeDocTab, setActiveDocTab] = useState<string>('product');\n  \n  // Day 2 state\n  const [standupComplete, setStandupComplete] = useState(savedProgress?.standupComplete || false);\n  const [devSetupComplete, setDevSetupComplete] = useState(savedProgress?.devSetupComplete || false);\n  const [ticketReviewed, setTicketReviewed] = useState(savedProgress?.ticketReviewed || false);\n  const [branchCreated, setBranchCreated] = useState(savedProgress?.branchCreated || false);\n  const [codebaseExplored, setCodebaseExplored] = useState(savedProgress?.codebaseExplored || false);\n  const [codeFixComplete, setCodeFixComplete] = useState(savedProgress?.codeFixComplete || false);\n  const [testFixComplete, setTestFixComplete] = useState(savedProgress?.testFixComplete || false);\n  const [gitWorkflowComplete, setGitWorkflowComplete] = useState(savedProgress?.gitWorkflowComplete || false);\n  const [prCreated, setPrCreated] = useState(savedProgress?.prCreated || false);\n  const [reflectionComplete, setReflectionComplete] = useState(savedProgress?.reflectionComplete || false);\n  const [currentFile, setCurrentFile] = useState<string | null>(null);\n  const [codeInputs, setCodeInputs] = useState<Record<string, string>>(savedProgress?.codeInputs || {});\n  const [gitInputs, setGitInputs] = useState<Record<string, string>>(savedProgress?.gitInputs || {});\n  const [gitStep, setGitStep] = useState(0);\n  const [gitCommands, setGitCommands] = useState<string[]>([]);\n  const [commitMessage, setCommitMessage] = useState(\"\");\n  const [prDescription, setPrDescription] = useState(\"\");\n  const [reflectionText, setReflectionText] = useState(\"\");\n  \n  // Day 2 Standup state\n  const [standupStarted, setStandupStarted] = useState(false);\n  const [standupVisibleMessages, setStandupVisibleMessages] = useState(0);\n  // Initialize from savedProgress to persist across reloads\n  const [standupUserSpoke, setStandupUserSpoke] = useState(savedProgress?.standupComplete || false);\n  \n  // Day 2 Test Fix state\n  const [testState, setTestState] = useState<'before' | 'running' | 'after'>('before');\n  \n  // Day 2 PR state  \n  const [prTitle, setPrTitle] = useState('');\n  const [prDescriptionLocal, setPrDescriptionLocal] = useState('');\n  const [prSubmittedLocal, setPrSubmittedLocal] = useState(false);\n  \n  // Day 2 Branch creation state\n  const [branchInput, setBranchInput] = useState('');\n  const [branchError, setBranchError] = useState('');\n  const [branchSuccess, setBranchSuccess] = useState(false);\n  \n  // Floating chat state\n  const [floatingChatOpen, setFloatingChatOpen] = useState(false);\n  const [floatingChatMember, setFloatingChatMember] = useState<TeamMember | null>(null);\n  const [floatingChatMessage, setFloatingChatMessage] = useState(\"\");\n  const [floatingTypingIndicator, setFloatingTypingIndicator] = useState<string | null>(null);\n  \n  // Track closed conversations (when user says goodbye)\n  const [closedConversations, setClosedConversations] = useState<Record<string, boolean>>(savedProgress?.closedConversations || {});\n  // Track if showing all-intros-complete screen\n  const [showAllIntrosComplete, setShowAllIntrosComplete] = useState(false);\n  // Track if all-intros-complete dialog has been dismissed (to prevent showing again)\n  const [introsDialogDismissed, setIntrosDialogDismissed] = useState(false);\n  \n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  const docsScrollRef = useRef<HTMLDivElement>(null);\n  const progressIdRef = useRef<number | null>(savedProgressId || null);\n  const saveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const pendingSaveRef = useRef<any>(null);\n\n  const requirements = project.requirements || {};\n  const dailyStructure = requirements.dailyStructure || [];\n  const teamMembers: TeamMember[] = project.teamStructure || [];\n  const scenarioScript = project.scenarioScript || {};\n  const projectInfo = requirements.project || {};\n\n  // Avatar helper functions\n  const getTeamAvatarUrl = (name: string) => {\n    const avatarSeeds: Record<string, { seed: string; style: string }> = {\n      'Sarah': { seed: 'sarah-tech-lead', style: 'avataaars' },\n      'Marcus': { seed: 'marcus-senior-dev', style: 'avataaars' },\n      'Priya': { seed: 'priya-product-mgr', style: 'avataaars' },\n      'Alex': { seed: 'alex-qa-engineer', style: 'avataaars' },\n      'Jordan': { seed: 'jordan-intern', style: 'avataaars' }\n    };\n    const config = avatarSeeds[name] || { seed: name, style: 'avataaars' };\n    return `https://api.dicebear.com/7.x/${config.style}/svg?seed=${config.seed}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`;\n  };\n\n  const getTeamMemberColor = (name: string) => {\n    const colors: Record<string, string> = {\n      'Sarah': 'bg-blue-500',\n      'Marcus': 'bg-green-500',\n      'Priya': 'bg-purple-500',\n      'Alex': 'bg-orange-500',\n      'Jordan': 'bg-teal-500'\n    };\n    return colors[name] || 'bg-gray-500';\n  };\n\n  const getTeamMemberInitials = (name: string) => name.split(' ').map(n => n[0]).join('').toUpperCase();\n\n  const currentDayData = dailyStructure.find((d: any) => d.day === currentDay) || dailyStructure[0];\n  \n  const teamMembersToMeet = teamMembers.filter((m: TeamMember) => m.name !== 'Sarah');\n  const completedIntroCount = teamMembersToMeet.filter((m: TeamMember) => introProgress[m.name]).length;\n  const allTeamMet = completedIntroCount === teamMembersToMeet.length;\n\n  function calculateDayProgress() {\n    if (currentDay === 1) {\n      const totalIntros = teamMembersToMeet.length;\n      const completedIntros = completedIntroCount;\n      const docsWeight = 30;\n      const introWeight = 40;\n      const comprehensionWeight = 30;\n      \n      let progress = 0;\n      if (docsRead) progress += docsWeight;\n      progress += (completedIntros / totalIntros) * introWeight;\n      if (comprehensionComplete) progress += comprehensionWeight;\n      \n      return Math.round(progress);\n    }\n    \n    if (currentDay === 2) {\n      let progress = 0;\n      if (standupComplete) progress += 10;\n      if (devSetupComplete) progress += 10;\n      if (ticketReviewed) progress += 5;\n      if (branchCreated) progress += 5;\n      if (codebaseExplored) progress += 10;\n      if (codeFixComplete) progress += 20;\n      if (testFixComplete) progress += 10;\n      if (gitWorkflowComplete) progress += 15;\n      if (prCreated) progress += 10;\n      if (reflectionComplete) progress += 5;\n      return progress;\n    }\n    \n    return 0;\n  }\n\n  const dayProgress = calculateDayProgress();\n\n  // Helper to get today's activities based on current day\n  function getDayActivities(): string[] {\n    if (currentDay === 1) {\n      return [\n        'Meet the team (1-on-1 introductions with Sarah, Marcus, Priya, Alex, Jordan)',\n        'Read project documentation (Product & Users, How We Work)',\n        'Comprehension check with Sarah'\n      ];\n    }\n    if (currentDay === 2) {\n      return [\n        'Morning standup with Sarah',\n        'Set up dev environment (clone, install, run)',\n        'Review your ticket',\n        'Create a feature branch',\n        'Explore the codebase and find the bug',\n        'Fix the timezone bug',\n        'Test your fix locally',\n        'Git workflow (branch, commit, push)',\n        'Create pull request',\n        'End-of-day reflection'\n      ];\n    }\n    if (currentDay === 3) {\n      return [\n        'Respond to Sarah\\'s code review feedback',\n        'Revise and update your code based on feedback'\n      ];\n    }\n    if (currentDay === 4) {\n      return [\n        'Write README documentation section',\n        'Get feedback on documentation'\n      ];\n    }\n    if (currentDay === 5) {\n      return [\n        'Fix edge case bug',\n        'Final evaluation with Sarah'\n      ];\n    }\n    return [];\n  }\n\n  // Helper to get completed activities based on current state\n  function getCompletedActivities(): string[] {\n    const completed: string[] = [];\n    \n    if (currentDay === 1) {\n      if (docsRead) completed.push('Read project documentation');\n      const introsCompleted = Object.entries(introProgress).filter(([_, done]) => done).map(([name]) => `Met ${name}`);\n      completed.push(...introsCompleted);\n      if (comprehensionComplete) completed.push('Completed comprehension check');\n    }\n    \n    if (currentDay === 2) {\n      if (standupComplete) completed.push('Morning standup completed');\n      if (devSetupComplete) completed.push('Dev environment set up');\n      if (ticketReviewed) completed.push('Reviewed ticket');\n      if (codebaseExplored) completed.push('Explored codebase and found dateFormatters.ts');\n      if (codeFixComplete) completed.push('Fixed the timezone bug');\n      if (testFixComplete) completed.push('Tested the fix');\n      if (gitWorkflowComplete) completed.push('Completed Git workflow');\n      if (prCreated) completed.push('Created pull request');\n      if (reflectionComplete) completed.push('Completed end-of-day reflection');\n    }\n    \n    return completed;\n  }\n\n  const { data: interactions, isLoading: interactionsLoading } = useQuery({\n    queryKey: ['/api/workspace', session.id, 'interactions'],\n    queryFn: () => fetch(`/api/workspace/${session.id}/interactions`).then(res => res.json()),\n    refetchInterval: 2000\n  });\n\n  const sendMessageMutation = useMutation({\n    mutationFn: async ({ userMessage, targetMember }: { userMessage: string; targetMember?: TeamMember }) => {\n      const member = targetMember || selectedMember;\n      const channel = member ? `dm-${member.name}` : 'team-chat';\n      \n      if (member) {\n        setTypingIndicator(member.name);\n      }\n      \n      const response = await apiRequest(\"POST\", `/api/workspace/${session.id}/action`, {\n        type: 'send-message',\n        channel,\n        data: { content: userMessage },\n        currentDay,\n        dayActivities: getDayActivities(),\n        completedActivities: getCompletedActivities()\n      });\n      return response.json();\n    },\n    onMutate: async ({ userMessage, targetMember }: { userMessage: string; targetMember?: TeamMember }) => {\n      // Cancel any outgoing refetches so they don't overwrite optimistic update\n      await queryClient.cancelQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n      \n      // Snapshot previous value\n      const previousInteractions = queryClient.getQueryData(['/api/workspace', session.id, 'interactions']);\n      \n      // Optimistically add user's message immediately\n      const member = targetMember || selectedMember;\n      const channel = member ? `dm-${member.name}` : 'team-chat';\n      const optimisticMessage = {\n        id: `temp-${Date.now()}`,\n        sessionId: session.id,\n        channel,\n        sender: 'You',\n        senderRole: 'Intern',\n        content: userMessage,\n        createdAt: new Date().toISOString(),\n        isOptimistic: true\n      };\n      \n      queryClient.setQueryData(\n        ['/api/workspace', session.id, 'interactions'],\n        (old: any[] | undefined) => [...(old || []), optimisticMessage]\n      );\n      \n      // Clear input immediately for snappy feel\n      setMessage(\"\");\n      \n      return { previousInteractions, member };\n    },\n    onSuccess: (data, _variables, context) => {\n      setTypingIndicator(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n      \n      const member = context?.member;\n      if (member && !introProgress[member.name]) {\n        setIntroProgress(prev => ({ ...prev, [member.name]: true }));\n      }\n      \n      // Check if conversation was closed by the team member\n      if (data?.conversationClosed && member) {\n        setClosedConversations(prev => {\n          const newClosed = { ...prev, [member.name]: true };\n          \n          // Check if all intros are now complete using the new state\n          // Only show dialog if NOT already in comprehension-check mode and dialog hasn't been dismissed\n          const teamMembersToMeet = teamMembers.filter((m: TeamMember) => m.name !== 'Sarah');\n          const allClosed = teamMembersToMeet.every((m: TeamMember) => newClosed[m.name]);\n          \n          if (allClosed && viewMode !== 'comprehension-check' && !introsDialogDismissed) {\n            // Also ensure all are marked as met\n            setIntroProgress(prevIntro => {\n              const newIntro = { ...prevIntro, [member.name]: true };\n              const allMet = teamMembersToMeet.every((m: TeamMember) => newIntro[m.name]);\n              if (allMet) {\n                setTimeout(() => setShowAllIntrosComplete(true), 1000);\n              }\n              return newIntro;\n            });\n          }\n          \n          return newClosed;\n        });\n      }\n    },\n    onError: (_err, _variables, context) => {\n      setTypingIndicator(null);\n      // Rollback on error\n      if (context?.previousInteractions) {\n        queryClient.setQueryData(\n          ['/api/workspace', session.id, 'interactions'],\n          context.previousInteractions\n        );\n      }\n    }\n  });\n\n  // Floating chat mutation - separate from main chat to avoid state conflicts\n  const floatingChatMutation = useMutation({\n    mutationFn: async (userMessage: string) => {\n      if (!floatingChatMember) return;\n      \n      const channel = `dm-${floatingChatMember.name}`;\n      setFloatingTypingIndicator(floatingChatMember.name);\n      \n      const response = await apiRequest(\"POST\", `/api/workspace/${session.id}/action`, {\n        type: 'send-message',\n        channel,\n        data: { content: userMessage },\n        currentDay,\n        dayActivities: getDayActivities(),\n        completedActivities: getCompletedActivities()\n      });\n      return response.json();\n    },\n    onMutate: async (userMessage: string) => {\n      if (!floatingChatMember) return;\n      \n      await queryClient.cancelQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n      const previousInteractions = queryClient.getQueryData(['/api/workspace', session.id, 'interactions']);\n      \n      const channel = `dm-${floatingChatMember.name}`;\n      const optimisticMessage = {\n        id: `temp-floating-${Date.now()}`,\n        sessionId: session.id,\n        channel,\n        sender: 'You',\n        senderRole: 'Intern',\n        content: userMessage,\n        createdAt: new Date().toISOString(),\n        isOptimistic: true\n      };\n      \n      queryClient.setQueryData(\n        ['/api/workspace', session.id, 'interactions'],\n        (old: any[] | undefined) => [...(old || []), optimisticMessage]\n      );\n      \n      setFloatingChatMessage(\"\");\n      return { previousInteractions };\n    },\n    onSuccess: () => {\n      setFloatingTypingIndicator(null);\n      queryClient.invalidateQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n    },\n    onError: (_err, _userMessage, context) => {\n      setFloatingTypingIndicator(null);\n      if (context?.previousInteractions) {\n        queryClient.setQueryData(\n          ['/api/workspace', session.id, 'interactions'],\n          context.previousInteractions\n        );\n      }\n    }\n  });\n\n  const handleFloatingChatSend = () => {\n    if (!floatingChatMessage.trim() || floatingChatMutation.isPending || !floatingChatMember) return;\n    floatingChatMutation.mutate(floatingChatMessage);\n  };\n\n  const handleFloatingChatToggle = () => {\n    setFloatingChatOpen(!floatingChatOpen);\n    // Default to Sarah (team lead) if no member selected\n    if (!floatingChatOpen && !floatingChatMember && teamMembers.length > 0) {\n      const sarah = teamMembers.find(m => m.name === 'Sarah') || teamMembers[0];\n      setFloatingChatMember(sarah);\n    }\n  };\n\n  const saveProgressMutation = useMutation({\n    mutationFn: async (progressData: any) => {\n      if (progressIdRef.current) {\n        const response = await apiRequest(\"PATCH\", `/api/workspace/progress/${progressIdRef.current}`, progressData);\n        return response.json();\n      } else {\n        const response = await apiRequest(\"POST\", `/api/workspace/progress`, {\n          sessionId: session.id,\n          userId: 1,\n          projectId: project.id,\n          role: session.configuration?.activeRole || 'Developer',\n          mode: mode,\n          currentDay,\n          ...progressData\n        });\n        const result = await response.json();\n        progressIdRef.current = result.id;\n        return result;\n      }\n    }\n  });\n\n  const buildProgressData = () => ({\n    currentDay,\n    dayProgress: {\n      docsRead,\n      introProgress,\n      comprehensionComplete,\n      docSectionsRead,\n      closedConversations,\n      standupComplete,\n      devSetupComplete,\n      ticketReviewed,\n      branchCreated,\n      codebaseExplored,\n      codeFixComplete,\n      testFixComplete,\n      gitWorkflowComplete,\n      prCreated,\n      reflectionComplete,\n      codeInputs\n    },\n    overallProgress: dayProgress,\n    status: dayProgress === 100 ? 'completed' : 'in_progress'\n  });\n\n  const saveProgress = () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n    }\n    \n    const progressData = buildProgressData();\n    pendingSaveRef.current = progressData;\n    \n    saveTimeoutRef.current = setTimeout(() => {\n      saveProgressMutation.mutate(progressData);\n      pendingSaveRef.current = null;\n    }, 1000);\n  };\n\n  const flushPendingSave = async () => {\n    if (saveTimeoutRef.current) {\n      clearTimeout(saveTimeoutRef.current);\n      saveTimeoutRef.current = null;\n    }\n    \n    if (pendingSaveRef.current) {\n      try {\n        const progressData = pendingSaveRef.current;\n        if (progressIdRef.current) {\n          await apiRequest(\"PATCH\", `/api/workspace/progress/${progressIdRef.current}`, progressData);\n        } else {\n          const response = await apiRequest(\"POST\", `/api/workspace/progress`, {\n            sessionId: session.id,\n            userId: 1,\n            projectId: project.id,\n            role: session.configuration?.activeRole || 'Developer',\n            mode: mode,\n            currentDay,\n            ...progressData\n          });\n          const result = await response.json();\n          progressIdRef.current = result.id;\n        }\n        pendingSaveRef.current = null;\n      } catch (error) {\n        console.error('Failed to flush pending save:', error);\n      }\n    }\n  };\n\n  const isInitialMount = useRef(true);\n  \n  useEffect(() => {\n    // Skip auto-save on initial mount - progress is already created by handleStartPractice/handleStartJourney\n    if (isInitialMount.current) {\n      isInitialMount.current = false;\n      return;\n    }\n    saveProgress();\n  }, [docsRead, introProgress, comprehensionComplete, docSectionsRead, closedConversations, standupComplete, devSetupComplete, ticketReviewed, branchCreated, codebaseExplored, codeFixComplete, testFixComplete, gitWorkflowComplete, prCreated, reflectionComplete, codeInputs, currentDay]);\n\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      if (document.hidden) {\n        flushPendingSave();\n      }\n    };\n    \n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    \n    return () => {\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n      flushPendingSave();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (viewMode === 'overview' && scenarioScript.onboarding) {\n      const timers: NodeJS.Timeout[] = [];\n      let cumulativeDelay = 0;\n      \n      scenarioScript.onboarding.forEach((event: any) => {\n        const baseDelay = 2000;\n        const randomDelay = Math.random() * 3000;\n        cumulativeDelay += baseDelay + randomDelay;\n        \n        const timer = setTimeout(async () => {\n          try {\n            await apiRequest(\"POST\", `/api/workspace/${session.id}/interactions`, {\n              sessionId: session.id,\n              channel: 'team-chat',\n              sender: event.from,\n              senderRole: teamMembers.find((m: TeamMember) => m.name === event.from)?.role || 'Team Member',\n              content: event.message\n            });\n            queryClient.invalidateQueries({ queryKey: ['/api/workspace', session.id, 'interactions'] });\n          } catch (error) {\n            console.error('Failed to send auto message:', error);\n          }\n        }, cumulativeDelay);\n        timers.push(timer);\n      });\n\n      return () => {\n        timers.forEach(timer => clearTimeout(timer));\n      };\n    }\n  }, [viewMode]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [interactions]);\n\n  // Day 2 standup script - loaded from JSON catalogue\n  const userName = user?.firstName || user?.username || 'there';\n  const standupScript = standupScriptData.content.script.map(msg => ({\n    sender: msg.sender,\n    role: msg.role,\n    content: msg.isUserCue ? msg.content.replace('{{userName}}', userName) : msg.content,\n    delay: msg.delay\n  }));\n\n  useEffect(() => {\n    if (standupStarted && standupVisibleMessages < standupScript.length) {\n      const timer = setTimeout(() => {\n        setStandupVisibleMessages(prev => prev + 1);\n      }, standupScript[standupVisibleMessages]?.delay || 1500);\n      return () => clearTimeout(timer);\n    }\n  }, [standupStarted, standupVisibleMessages]);\n\n  function handleSendMessage(targetMember?: TeamMember) {\n    if (!message.trim() || sendMessageMutation.isPending) return;\n    sendMessageMutation.mutate({ userMessage: message, targetMember });\n  }\n\n  function startTeamIntro(member: TeamMember) {\n    setSelectedMember(member);\n    setViewMode('team-intro');\n  }\n\n  function getFilteredInteractions() {\n    if (!Array.isArray(interactions)) return [];\n    \n    if (viewMode === 'team-intro' && selectedMember) {\n      return interactions.filter((i: any) => \n        i.channel === `dm-${selectedMember.name}` || \n        (i.sender === selectedMember.name && i.channel === 'dm-You')\n      );\n    }\n    \n    if (viewMode === 'comprehension-check') {\n      return interactions.filter((i: any) => \n        i.channel === 'dm-Sarah' || \n        (i.sender === 'Sarah' && i.channel === 'dm-You')\n      );\n    }\n    \n    return interactions.filter((i: any) => i.channel === 'team-chat');\n  }\n\n  const filteredInteractions = getFilteredInteractions();\n\n  function renderOverview() {\n    return (\n      <div className=\"space-y-6\">\n        <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-blue-100 rounded-lg\">\n                <Sparkles className=\"h-6 w-6 text-blue-600\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-xl text-blue-900\">\n                  Welcome to {projectInfo.name || 'NovaPay'}!\n                </CardTitle>\n                <CardDescription className=\"text-blue-700\">\n                  Day {currentDay}: {currentDayData?.theme || 'Welcome aboard'}\n                </CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-blue-800\">\n              {projectInfo.description || 'Your first week as a software engineering intern starts now. Take your time getting to know the team and understanding the project.'}\n            </p>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid gap-4\">\n          <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Today's Activities\n          </h3>\n          \n          <div className=\"grid gap-3\">\n            {/* Step 1: Documentation - Always available first */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                docsRead ? 'border-green-200 bg-green-50' : ''\n              }`}\n              onClick={() => setViewMode('documentation')}\n              data-testid=\"card-documentation\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"flex items-center justify-center w-6 h-6 rounded-full bg-orange-100 text-orange-700 text-xs font-bold\">1</div>\n                    <div className=\"p-2 bg-orange-100 rounded-lg\">\n                      <BookOpen className=\"h-5 w-5 text-orange-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">Read Onboarding Docs</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Learn about the product and your mission\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {docsRead && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Step 2: Meet the Team - Unlocks after docs */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                allTeamMet ? 'border-green-200 bg-green-50' : ''\n              } ${!docsRead ? 'opacity-60' : ''}`}\n              onClick={() => docsRead && setViewMode('team-intro')}\n              data-testid=\"card-team-intros\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className={`flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${docsRead ? 'bg-purple-100 text-purple-700' : 'bg-gray-100 text-gray-400'}`}>2</div>\n                    <div className={`p-2 rounded-lg ${docsRead ? 'bg-purple-100' : 'bg-gray-100'}`}>\n                      <Users className={`h-5 w-5 ${docsRead ? 'text-purple-600' : 'text-gray-400'}`} />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">Meet the Team</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        1:1 introductions with your teammates\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!docsRead && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Read docs first\n                      </Badge>\n                    )}\n                    {docsRead && (\n                      <Badge variant=\"outline\">\n                        {completedIntroCount}/{teamMembersToMeet.length}\n                      </Badge>\n                    )}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Step 3: Check in with Sarah - Unlocks after meeting all team members */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                comprehensionComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!allTeamMet ? 'opacity-60' : ''}`}\n              onClick={() => allTeamMet && setViewMode('comprehension-check')}\n              data-testid=\"card-comprehension-check\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className={`flex items-center justify-center w-6 h-6 rounded-full text-xs font-bold ${allTeamMet ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-400'}`}>3</div>\n                    <div className={`p-2 rounded-lg ${allTeamMet ? 'bg-blue-100' : 'bg-gray-100'}`}>\n                      <MessageSquare className={`h-5 w-5 ${allTeamMet ? 'text-blue-600' : 'text-gray-400'}`} />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">Check in with Sarah</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Share what you've learned with your lead\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!allTeamMet && (\n                      <Badge variant=\"outline\" className=\"text-xs\">\n                        Meet the team first\n                      </Badge>\n                    )}\n                    {comprehensionComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n\n        {currentDayData?.overnightEvent && (\n          <Card className=\"bg-amber-50 border-amber-200\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-amber-800\">\n                <Clock className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Coming tomorrow:</span>\n                <span>{currentDayData.overnightEvent}</span>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2Overview() {\n    return (\n      <div className=\"space-y-6\">\n        <Card className=\"bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200\">\n          <CardHeader>\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-orange-100 rounded-lg\">\n                <Bug className=\"h-6 w-6 text-orange-600\" />\n              </div>\n              <div>\n                <CardTitle className=\"text-xl text-orange-900\">\n                  Day 2: Your First Ticket\n                </CardTitle>\n                <CardDescription className=\"text-orange-700\">\n                  Time to fix the timezone bug!\n                </CardDescription>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-orange-800\">\n              Today you'll experience the full developer workflow: set up your environment, understand your ticket, write code, test it, and submit your first PR.\n            </p>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid gap-4\">\n          <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n            <Target className=\"h-5 w-5\" />\n            Today's Activities\n          </h3>\n          \n          <div className=\"grid gap-3\">\n            {/* 1. Morning Standup */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                standupComplete ? 'border-green-200 bg-green-50' : ''\n              }`}\n              onClick={() => setViewMode('day2-standup')}\n              data-testid=\"card-day2-standup\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-yellow-100 rounded-lg\">\n                      <Sun className=\"h-5 w-5 text-yellow-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">1. Morning Standup</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Sync with Sarah on your ticket\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {standupComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 2. Dev Environment Setup */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                devSetupComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!standupComplete ? 'opacity-60' : ''}`}\n              onClick={() => standupComplete && setViewMode('day2-dev-setup')}\n              data-testid=\"card-day2-dev-setup\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-blue-100 rounded-lg\">\n                      <Terminal className=\"h-5 w-5 text-blue-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">2. Set Up Dev Environment</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Clone the repo, install dependencies, run locally\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!standupComplete && <Badge variant=\"outline\" className=\"text-xs\">Complete standup first</Badge>}\n                    {devSetupComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 3. Review Your Ticket */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                ticketReviewed ? 'border-green-200 bg-green-50' : ''\n              } ${!devSetupComplete ? 'opacity-60' : ''}`}\n              onClick={() => devSetupComplete && setViewMode('day2-ticket')}\n              data-testid=\"card-day2-ticket\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-purple-100 rounded-lg\">\n                      <Clipboard className=\"h-5 w-5 text-purple-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">3. Review Your Ticket</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Understand the requirements and acceptance criteria\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!devSetupComplete && <Badge variant=\"outline\" className=\"text-xs\">Set up environment first</Badge>}\n                    {ticketReviewed && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 4. Create Branch */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                branchCreated ? 'border-green-200 bg-green-50' : ''\n              } ${!ticketReviewed ? 'opacity-60' : ''}`}\n              onClick={() => ticketReviewed && setViewMode('day2-branch')}\n              data-testid=\"card-day2-branch\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-cyan-100 rounded-lg\">\n                      <GitBranch className=\"h-5 w-5 text-cyan-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">4. Create a Branch</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Create a feature branch before making changes\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!ticketReviewed && <Badge variant=\"outline\" className=\"text-xs\">Review ticket first</Badge>}\n                    {branchCreated && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 5. Explore Codebase */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                codebaseExplored ? 'border-green-200 bg-green-50' : ''\n              } ${!branchCreated ? 'opacity-60' : ''}`}\n              onClick={() => branchCreated && setViewMode('day2-codebase')}\n              data-testid=\"card-day2-codebase\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-teal-100 rounded-lg\">\n                      <FolderOpen className=\"h-5 w-5 text-teal-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">5. Explore the Codebase</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Find the file where the bug lives\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!branchCreated && <Badge variant=\"outline\" className=\"text-xs\">Create branch first</Badge>}\n                    {codebaseExplored && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 6. Fix the Code */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                codeFixComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!codebaseExplored ? 'opacity-60' : ''}`}\n              onClick={() => codebaseExplored && setViewMode('day2-code-fix')}\n              data-testid=\"card-day2-code-fix\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-orange-100 rounded-lg\">\n                      <Code className=\"h-5 w-5 text-orange-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">6. Fix the Bug</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Write the timezone fix\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!codebaseExplored && <Badge variant=\"outline\" className=\"text-xs\">Explore codebase first</Badge>}\n                    {codeFixComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 7. Test Your Fix */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                testFixComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!codeFixComplete ? 'opacity-60' : ''}`}\n              onClick={() => codeFixComplete && setViewMode('day2-test-fix')}\n              data-testid=\"card-day2-test-fix\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-green-100 rounded-lg\">\n                      <Play className=\"h-5 w-5 text-green-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">7. Test Your Fix</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Verify it works in the browser\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!codeFixComplete && <Badge variant=\"outline\" className=\"text-xs\">Fix the bug first</Badge>}\n                    {testFixComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 8. Git Workflow */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                gitWorkflowComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!testFixComplete ? 'opacity-60' : ''}`}\n              onClick={() => testFixComplete && setViewMode('day2-git')}\n              data-testid=\"card-day2-git\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-gray-100 rounded-lg\">\n                      <GitCommit className=\"h-5 w-5 text-gray-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">8. Stage & Commit</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Stage and commit your changes to the branch\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!testFixComplete && <Badge variant=\"outline\" className=\"text-xs\">Test your fix first</Badge>}\n                    {gitWorkflowComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 9. Create PR */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                prCreated ? 'border-green-200 bg-green-50' : ''\n              } ${!gitWorkflowComplete ? 'opacity-60' : ''}`}\n              onClick={() => gitWorkflowComplete && setViewMode('day2-pr')}\n              data-testid=\"card-day2-pr\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-purple-100 rounded-lg\">\n                      <GitPullRequest className=\"h-5 w-5 text-purple-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">9. Create Pull Request</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        Submit your work for review\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!gitWorkflowComplete && <Badge variant=\"outline\" className=\"text-xs\">Commit your changes first</Badge>}\n                    {prCreated && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* 10. Reflection */}\n            <Card \n              className={`cursor-pointer transition-all hover:shadow-md ${\n                reflectionComplete ? 'border-green-200 bg-green-50' : ''\n              } ${!prCreated ? 'opacity-60' : ''}`}\n              onClick={() => prCreated && setViewMode('day2-reflection')}\n              data-testid=\"card-day2-reflection\"\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 bg-indigo-100 rounded-lg\">\n                      <PenLine className=\"h-5 w-5 text-indigo-600\" />\n                    </div>\n                    <div>\n                      <h4 className=\"font-medium text-gray-900\">10. Day 2 Reflection</h4>\n                      <p className=\"text-sm text-gray-600\">\n                        What did you learn today?\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {!prCreated && <Badge variant=\"outline\" className=\"text-xs\">Create PR first</Badge>}\n                    {reflectionComplete && <CheckCircle2 className=\"h-5 w-5 text-green-600\" />}\n                    <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Track when user speaks in standup (moved to useEffect to avoid setState in render)\n  const userHasSpokenInStandup = filteredInteractions.some((i: any) => i.sender === 'You' && viewMode === 'day2-standup');\n  useEffect(() => {\n    if (userHasSpokenInStandup && !standupUserSpoke) {\n      setStandupUserSpoke(true);\n    }\n  }, [userHasSpokenInStandup, standupUserSpoke]);\n\n  function renderDay2Standup() {\n    // Use stable state so it doesn't flash during query invalidation\n    const userHasSpoken = standupUserSpoke || userHasSpokenInStandup;\n    const standupInteractions = filteredInteractions;\n    const isUserTurn = standupVisibleMessages >= standupScript.length;\n\n    // If standup is already complete, show a summary instead of regenerating the chat\n    if (standupComplete) {\n      return (\n        <div className=\"h-full flex flex-col items-center justify-center\">\n          <Card className=\"max-w-md\">\n            <CardHeader className=\"text-center\">\n              <div className=\"mx-auto p-3 bg-green-100 rounded-full w-fit mb-2\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\n              </div>\n              <CardTitle>Standup Complete</CardTitle>\n              <CardDescription>\n                You participated in the morning standup\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"bg-gradient-to-r from-teal-50 to-green-50 border border-teal-200 rounded-lg p-4\">\n                <p className=\"text-sm text-teal-700\">\n                  You shared your update with the team and learned what everyone is working on today.\n                </p>\n              </div>\n              <Button \n                className=\"w-full\"\n                variant=\"outline\"\n                onClick={() => setViewMode('overview')}\n                data-testid=\"button-back-to-overview\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Overview\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    if (!standupStarted) {\n      return (\n        <div className=\"h-full flex flex-col items-center justify-center\">\n          <Card className=\"max-w-md\">\n            <CardHeader className=\"text-center\">\n              <div className=\"mx-auto p-3 bg-yellow-100 rounded-full w-fit mb-2\">\n                <Users className=\"h-8 w-8 text-yellow-700\" />\n              </div>\n              <CardTitle>Daily Standup</CardTitle>\n              <CardDescription>\n                Payments Team  9:00 AM\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"bg-gray-50 rounded-lg p-4\">\n                <p className=\"text-sm font-medium text-gray-700 mb-2\">Standup format:</p>\n                <ol className=\"text-sm text-gray-600 space-y-1\">\n                  <li>1. What I did yesterday</li>\n                  <li>2. What I'm doing today</li>\n                  <li>3. Any blockers?</li>\n                </ol>\n              </div>\n              <p className=\"text-sm text-gray-600 text-center\">\n                Sarah is starting the meeting. You'll share your update after Marcus.\n              </p>\n              <Button \n                className=\"w-full\"\n                onClick={() => {\n                  setStandupStarted(true);\n                  setStandupVisibleMessages(1);\n                }}\n                data-testid=\"button-join-standup\"\n              >\n                <Play className=\"h-4 w-4 mr-2\" />\n                Join Standup\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n    \n    return (\n      <div className=\"h-full flex flex-col\">\n        {/* Meeting Header */}\n        <div className=\"bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-lg p-3 mb-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"p-2 bg-yellow-100 rounded-lg\">\n                <Users className=\"h-5 w-5 text-yellow-700\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-gray-900\">Daily Standup</h3>\n                <p className=\"text-sm text-gray-600\">Payments Team</p>\n              </div>\n            </div>\n            <Badge variant=\"outline\" className=\"text-green-600 border-green-300\">\n              <div className=\"w-2 h-2 bg-green-500 rounded-full mr-1.5 animate-pulse\" />\n              Live\n            </Badge>\n          </div>\n        </div>\n\n        {/* Conversation */}\n        <ScrollArea className=\"flex-1 pr-2 mb-4\">\n          <div className=\"space-y-4\">\n            {standupScript.slice(0, standupVisibleMessages).map((msg, idx) => (\n              <div key={idx} className=\"flex gap-3\">\n                <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                  <AvatarImage src={getTeamAvatarUrl(msg.sender)} alt={msg.sender} />\n                  <AvatarFallback className={msg.sender === 'Marcus' ? 'bg-purple-500 text-white' : 'bg-blue-500 text-white'}>\n                    {msg.sender[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <div className=\"flex items-center gap-2 mb-1\">\n                    <span className=\"text-sm font-medium text-gray-900\">{msg.sender}</span>\n                    <Badge variant=\"outline\" className=\"text-xs py-0 h-5\">{msg.role}</Badge>\n                  </div>\n                  <div className=\"bg-white border rounded-lg p-3 shadow-sm\">\n                    <p className=\"text-sm text-gray-700\">{msg.content}</p>\n                  </div>\n                </div>\n              </div>\n            ))}\n\n            {/* Typing indicator while script is playing */}\n            {standupVisibleMessages > 0 && standupVisibleMessages < standupScript.length && (\n              <div className=\"flex gap-3\">\n                <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                  <AvatarImage src={getTeamAvatarUrl(standupScript[standupVisibleMessages].sender)} alt=\"\" />\n                  <AvatarFallback className=\"bg-purple-500 text-white\">\n                    {standupScript[standupVisibleMessages].sender[0]}\n                  </AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <div className=\"bg-gray-100 rounded-lg px-4 py-3 inline-block\">\n                    <div className=\"flex gap-1\">\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {/* User's messages and responses */}\n            {standupInteractions.map((interaction: any, idx: number) => {\n              const getSenderRole = (sender: string) => {\n                if (sender === 'You') return 'Intern';\n                if (sender === 'Sarah') return 'Tech Lead';\n                if (sender === 'Marcus') return 'Senior Engineer';\n                if (sender === 'Priya') return 'Product Manager';\n                if (sender === 'Alex') return 'QA Engineer';\n                return interaction.senderRole || 'Team Member';\n              };\n              \n              return (\n                <div key={`user-${idx}`} className=\"flex gap-3\">\n                  <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                    {interaction.sender === 'You' ? (\n                      <AvatarFallback className=\"bg-teal-500 text-white\">\n                        {userName?.[0]?.toUpperCase() || 'Y'}\n                      </AvatarFallback>\n                    ) : (\n                      <>\n                        <AvatarImage src={getTeamAvatarUrl(interaction.sender)} alt={interaction.sender} />\n                        <AvatarFallback className=\"bg-blue-500 text-white\">\n                          {interaction.sender[0]}\n                        </AvatarFallback>\n                      </>\n                    )}\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-sm font-medium text-gray-900\">\n                        {interaction.sender === 'You' ? userName : interaction.sender}\n                      </span>\n                      <Badge variant=\"outline\" className=\"text-xs py-0 h-5\">\n                        {getSenderRole(interaction.sender)}\n                      </Badge>\n                    </div>\n                    <div className={`rounded-lg p-3 shadow-sm ${\n                      interaction.sender === 'You' \n                        ? 'bg-teal-50 border border-teal-200' \n                        : 'bg-white border'\n                    }`}>\n                      <p className=\"text-sm text-gray-700\">{interaction.content}</p>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n\n            {typingIndicator && (\n              <div className=\"flex gap-3\">\n                <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                  <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                  <AvatarFallback className=\"bg-blue-500 text-white\">S</AvatarFallback>\n                </Avatar>\n                <div className=\"flex-1\">\n                  <div className=\"bg-gray-100 rounded-lg px-4 py-3 inline-block\">\n                    <div className=\"flex gap-1\">\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n        </ScrollArea>\n\n        {/* Your turn prompt */}\n        {isUserTurn && !userHasSpoken && (\n          <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-3\">\n            <div className=\"flex items-center gap-2 text-blue-800\">\n              <Sparkles className=\"h-4 w-4\" />\n              <span className=\"text-sm font-medium\">Your turn!</span>\n            </div>\n            <p className=\"text-xs text-blue-600 mt-1\">\n              Share your update when you're ready.\n            </p>\n          </div>\n        )}\n\n        {/* Input area - show when it's user's turn */}\n        {isUserTurn && (\n          <div className=\"flex gap-2 mb-3\">\n            <Textarea\n              value={message}\n              onChange={(e) => setMessage(e.target.value)}\n              placeholder=\"Yesterday: got set up. Today: working on the timezone bug. Blockers: I have a question about...\"\n              className=\"min-h-[70px] resize-none text-sm\"\n              onKeyDown={(e) => {\n                if (e.key === 'Enter' && !e.shiftKey) {\n                  e.preventDefault();\n                  handleSendMessage();\n                }\n              }}\n              data-testid=\"input-standup-message\"\n            />\n            <Button \n              onClick={() => handleSendMessage()}\n              disabled={!message.trim() || sendMessageMutation.isPending}\n              size=\"sm\"\n              className=\"self-end\"\n              data-testid=\"button-send-standup\"\n            >\n              <Send className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        )}\n        \n        {/* Wrap up section - show once user has spoken */}\n        {userHasSpoken && (\n          <div className=\"space-y-3\">\n            {/* Sarah's closing message */}\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <Avatar className=\"h-8 w-8 flex-shrink-0\">\n                  <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                  <AvatarFallback className=\"bg-blue-500 text-white\">S</AvatarFallback>\n                </Avatar>\n                <div>\n                  <p className=\"text-sm font-medium text-gray-900\">Sarah</p>\n                  <p className=\"text-sm text-green-800 mt-1\">\n                    Thanks {userName}! Good luck with the timezone ticket - ping me or Marcus if you get stuck. Alright everyone, let's have a great day!\n                  </p>\n                </div>\n              </div>\n            </div>\n            \n            {/* Accomplishment */}\n            <div className=\"bg-gradient-to-r from-teal-50 to-green-50 border border-teal-200 rounded-lg p-4\">\n              <div className=\"flex items-center gap-2 text-teal-800 mb-2\">\n                <CheckCircle2 className=\"h-5 w-5 text-teal-600\" />\n                <span className=\"font-medium\">Standup Complete!</span>\n              </div>\n              <p className=\"text-sm text-teal-700\">\n                You participated in your first daily standup. This is how teams stay aligned and unblock each other.\n              </p>\n            </div>\n            \n            <Button \n              className=\"w-full\"\n              onClick={() => {\n                setStandupComplete(true);\n                setViewMode('overview');\n              }}\n              data-testid=\"button-complete-standup\"\n            >\n              Continue to Dev Setup\n              <ArrowRight className=\"h-4 w-4 ml-2\" />\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2DevSetup() {\n    // Load setup steps from JSON catalogue\n    const setupSteps = devSetupStepsData.content.steps;\n\n    const currentStep = setupSteps.findIndex(step => !gitInputs[step.id]);\n    const allComplete = currentStep === -1;\n\n    const handleCommand = (stepId: string, input: string) => {\n      const step = setupSteps.find(s => s.id === stepId);\n      if (step && validateSetupCommand(input, step as SetupStep)) {\n        setGitInputs(prev => ({ ...prev, [stepId]: input }));\n      }\n    };\n\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-blue-50 border-blue-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Terminal className=\"h-6 w-6 text-blue-600\" />\n              <div>\n                <p className=\"font-medium text-blue-900\">Set Up Your Dev Environment</p>\n                <p className=\"text-sm text-blue-700\">\n                  Before you can work on the code, you need to get it on your machine and running locally.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Terminal className=\"h-4 w-4\" />\n              Terminal\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm space-y-4\">\n              {setupSteps.map((step, idx) => {\n                const isComplete = gitInputs[step.id];\n                const isCurrent = idx === currentStep;\n                const isFuture = idx > currentStep && currentStep !== -1;\n\n                return (\n                  <div key={step.id} className={isFuture ? 'opacity-40' : ''}>\n                    <p className=\"text-gray-400 text-xs mb-1\"># {step.instruction}</p>\n                    {isComplete ? (\n                      <>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-green-400\">$</span>\n                          <span className=\"text-white\">{gitInputs[step.id]}</span>\n                          <Check className=\"h-4 w-4 text-green-400 ml-2\" />\n                        </div>\n                        {step.successOutput && (\n                          <pre className=\"text-gray-400 text-xs mt-1 whitespace-pre-wrap\">{step.successOutput}</pre>\n                        )}\n                      </>\n                    ) : isCurrent ? (\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-green-400\">$</span>\n                        <input\n                          type=\"text\"\n                          className=\"bg-transparent text-white flex-1 outline-none\"\n                          placeholder=\"Type your command...\"\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              handleCommand(step.id, e.currentTarget.value);\n                            }\n                          }}\n                          data-testid={`input-setup-${step.id}`}\n                        />\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-gray-600\">$</span>\n                        <span className=\"text-gray-600\">...</span>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {currentStep !== -1 && currentStep < setupSteps.length && (\n              <div className=\"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200\">\n                <p className=\"text-sm text-amber-800\">\n                  <strong>Hint:</strong> {setupSteps[currentStep].hint}\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {allComplete && (\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-green-800\">\n                <CheckCircle2 className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Dev environment ready!</span>\n              </div>\n              <p className=\"text-sm text-green-700 mt-1\">\n                The app is running locally. You can see it at http://localhost:5173\n              </p>\n              <Button \n                className=\"mt-3\"\n                onClick={() => {\n                  setDevSetupComplete(true);\n                  setViewMode('overview');\n                }}\n                data-testid=\"button-dev-setup-complete\"\n              >\n                Continue to Review Ticket\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2Ticket() {\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-purple-50 border-purple-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Clipboard className=\"h-6 w-6 text-purple-600\" />\n              <div>\n                <p className=\"font-medium text-purple-900\">Review Your Ticket</p>\n                <p className=\"text-sm text-purple-700\">\n                  Before writing any code, understand exactly what you're building.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-2 border-purple-200\">\n          <CardHeader className=\"bg-purple-50 border-b border-purple-200\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Badge className=\"bg-orange-100 text-orange-700 border-orange-300\">Bug</Badge>\n                <Badge variant=\"outline\" className=\"text-purple-600 border-purple-300\">In Progress</Badge>\n              </div>\n              <span className=\"text-sm text-gray-500 font-mono\">PAY-1234</span>\n            </div>\n            <CardTitle className=\"text-lg mt-2\">\n              Transactions show incorrect time for non-UTC merchants\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"p-4 space-y-4\">\n            <div>\n              <p className=\"text-sm font-medium text-gray-700 mb-1\">Description</p>\n              <p className=\"text-gray-600 text-sm\">\n                Merchants in timezones other than UTC see transaction timestamps in UTC instead of their local time. \n                For example, a transaction at 8pm CST shows as 2am the next day, causing confusion during daily reconciliation.\n              </p>\n            </div>\n\n            <div>\n              <p className=\"text-sm font-medium text-gray-700 mb-1\">Acceptance Criteria</p>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li className=\"flex items-start gap-2\">\n                  <div className=\"h-4 w-4 rounded border border-gray-300 mt-0.5\" />\n                  <span>Transactions display in the merchant's configured timezone</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <div className=\"h-4 w-4 rounded border border-gray-300 mt-0.5\" />\n                  <span>Date filters work correctly with local dates</span>\n                </li>\n                <li className=\"flex items-start gap-2\">\n                  <div className=\"h-4 w-4 rounded border border-gray-300 mt-0.5\" />\n                  <span>Existing tests pass</span>\n                </li>\n              </ul>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-4 pt-2 border-t\">\n              <div>\n                <p className=\"text-xs text-gray-500\">Assignee</p>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Avatar className=\"h-5 w-5\">\n                    <AvatarFallback className=\"text-xs bg-teal-100 text-teal-700\">Y</AvatarFallback>\n                  </Avatar>\n                  <span className=\"text-sm\">You</span>\n                </div>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-500\">Reporter</p>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Avatar className=\"h-5 w-5\">\n                    <AvatarFallback className=\"text-xs bg-pink-100 text-pink-700\">P</AvatarFallback>\n                  </Avatar>\n                  <span className=\"text-sm\">Priya</span>\n                </div>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-500\">Priority</p>\n                <Badge variant=\"outline\" className=\"mt-1 text-orange-600 border-orange-300\">Medium</Badge>\n              </div>\n              <div>\n                <p className=\"text-xs text-gray-500\">Sprint</p>\n                <span className=\"text-sm\">Sprint 14</span>\n              </div>\n            </div>\n\n            <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n              <p className=\"text-sm font-medium text-blue-900 mb-1\">Files to investigate</p>\n              <div className=\"font-mono text-xs text-blue-700 space-y-1\">\n                <p>client/src/utils/dateFormatters.ts</p>\n                <p>client/src/components/TransactionList.tsx</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Button \n          className=\"w-full\"\n          onClick={() => {\n            setTicketReviewed(true);\n            setViewMode('overview');\n          }}\n          data-testid=\"button-ticket-reviewed\"\n        >\n          <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n          I understand the ticket - Continue to Create Branch\n        </Button>\n      </div>\n    );\n  }\n\n  function renderDay2CreateBranch() {\n    // Load branch creation config from JSON catalogue\n    const branchConfig = branchCreationData.content;\n    \n    const validateBranchName = (name: string) => {\n      const normalized = name.trim().toLowerCase();\n      if (!normalized) return { valid: false, error: 'Enter a branch name' };\n      if (normalized === 'main' || normalized === 'master') {\n        return { valid: false, error: \"Don't work on main/master directly!\" };\n      }\n      return validateBranchNameFromCatalogue(name, branchConfig.validation);\n    };\n\n    const handleCreateBranch = () => {\n      const result = validateBranchName(branchInput);\n      if (!result.valid) {\n        setBranchError(result.error || '');\n        return;\n      }\n      setBranchError('');\n      setBranchSuccess(true);\n    };\n\n    if (branchCreated) {\n      return (\n        <div className=\"h-full flex flex-col items-center justify-center\">\n          <Card className=\"max-w-md\">\n            <CardHeader className=\"text-center\">\n              <div className=\"mx-auto p-3 bg-green-100 rounded-full w-fit mb-2\">\n                <CheckCircle2 className=\"h-8 w-8 text-green-600\" />\n              </div>\n              <CardTitle>Branch Created</CardTitle>\n              <CardDescription>\n                You're now working on your feature branch\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"bg-gradient-to-r from-cyan-50 to-green-50 border border-cyan-200 rounded-lg p-4\">\n                <p className=\"text-sm text-cyan-700\">\n                  All your changes will be isolated from the main branch until your PR is merged.\n                </p>\n              </div>\n              <Button \n                className=\"w-full\"\n                variant=\"outline\"\n                onClick={() => setViewMode('overview')}\n                data-testid=\"button-back-to-overview\"\n              >\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back to Overview\n              </Button>\n            </CardContent>\n          </Card>\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-cyan-50 border-cyan-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <GitBranch className=\"h-6 w-6 text-cyan-600\" />\n              <div>\n                <p className=\"font-medium text-cyan-900\">Create a Feature Branch</p>\n                <p className=\"text-sm text-cyan-700\">\n                  Before making any changes, create a branch to isolate your work.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg\">Why Create a Branch?</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <div className=\"flex items-start gap-2\">\n                <Check className=\"h-4 w-4 text-green-600 mt-0.5\" />\n                <span className=\"text-sm text-gray-700\">Your changes are isolated from main</span>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Check className=\"h-4 w-4 text-green-600 mt-0.5\" />\n                <span className=\"text-sm text-gray-700\">You can experiment without affecting others</span>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Check className=\"h-4 w-4 text-green-600 mt-0.5\" />\n                <span className=\"text-sm text-gray-700\">Easy to abandon if your approach doesn't work</span>\n              </div>\n              <div className=\"flex items-start gap-2\">\n                <Check className=\"h-4 w-4 text-green-600 mt-0.5\" />\n                <span className=\"text-sm text-gray-700\">Your PR shows exactly what changed</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-lg flex items-center gap-2\">\n              <Terminal className=\"h-5 w-5\" />\n              Create Your Branch\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm\">\n              <div className=\"text-gray-400 mb-2\">$ git checkout -b <span className=\"text-cyan-400\">[branch-name]</span></div>\n              <p className=\"text-gray-500 text-xs mt-2\">\n                Common patterns: fix/timezone-bug, feature/user-auth, bugfix/payment-error\n              </p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium text-gray-700\">Enter your git command:</label>\n              <div className=\"flex gap-2\">\n                <div className=\"flex-1 relative\">\n                  <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-mono text-sm\">$</span>\n                  <input\n                    type=\"text\"\n                    value={branchInput}\n                    onChange={(e) => {\n                      setBranchInput(e.target.value);\n                      setBranchError('');\n                      setBranchSuccess(false);\n                    }}\n                    placeholder=\"git checkout -b fix/timezone-bug\"\n                    className=\"w-full pl-7 pr-3 py-2 border rounded-lg font-mono text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500\"\n                    data-testid=\"input-branch-name\"\n                  />\n                </div>\n                <Button \n                  onClick={handleCreateBranch}\n                  disabled={!branchInput.trim()}\n                  data-testid=\"button-create-branch\"\n                >\n                  Run\n                </Button>\n              </div>\n              {branchError && (\n                <p className=\"text-sm text-red-600 flex items-center gap-1\">\n                  <X className=\"h-4 w-4\" />\n                  {branchError}\n                </p>\n              )}\n            </div>\n\n            {branchSuccess && (\n              <div className=\"space-y-3\">\n                <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm text-green-400\">\n                  <p>Switched to a new branch '{branchInput.replace('git checkout -b ', '').trim()}'</p>\n                </div>\n                <div className=\"bg-green-50 border border-green-200 rounded-lg p-3\">\n                  <div className=\"flex items-center gap-2 text-green-800\">\n                    <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                    <span className=\"font-medium\">Branch created successfully!</span>\n                  </div>\n                  <p className=\"text-sm text-green-700 mt-1\">\n                    You're now on your feature branch. All changes will be isolated here.\n                  </p>\n                </div>\n                <Button \n                  className=\"w-full\"\n                  onClick={() => {\n                    setBranchCreated(true);\n                    setViewMode('overview');\n                  }}\n                  data-testid=\"button-branch-complete\"\n                >\n                  Continue to Explore Codebase\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\n                </Button>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  function renderDay2Codebase() {\n    // Load codebase structure from JSON catalogue\n    const fileStructure = codebaseStructureData.content.fileStructure;\n    const targetFile = codebaseStructureData.content.targetFile;\n\n    const renderFileTree = (items: any[], depth = 0) => {\n      return items.map((item, idx) => (\n        <div key={idx} style={{ marginLeft: depth * 16 }}>\n          <div \n            className={`flex items-center gap-2 py-1 px-2 rounded cursor-pointer hover:bg-gray-100 ${\n              item.highlight ? 'bg-yellow-50' : ''\n            } ${item.target && currentFile === item.name ? 'bg-blue-100 border-l-2 border-blue-500' : ''}`}\n            onClick={() => {\n              if (item.type === 'file') {\n                setCurrentFile(item.name);\n                if (item.target) {\n                  setCodebaseExplored(true);\n                }\n              }\n            }}\n            data-testid={`file-${item.name}`}\n          >\n            {item.type === 'folder' ? (\n              <FolderOpen className=\"h-4 w-4 text-blue-500\" />\n            ) : (\n              <File className={`h-4 w-4 ${item.highlight ? 'text-orange-500' : 'text-gray-500'}`} />\n            )}\n            <span className={`text-sm ${item.highlight ? 'font-medium text-orange-700' : 'text-gray-700'}`}>\n              {item.name}\n            </span>\n            {item.target && <Badge className=\"ml-2 text-xs bg-orange-100 text-orange-700\">Fix here</Badge>}\n          </div>\n          {item.children && renderFileTree(item.children, depth + 1)}\n        </div>\n      ));\n    };\n\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-blue-50 border-blue-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <FolderOpen className=\"h-6 w-6 text-blue-600\" />\n              <div>\n                <p className=\"font-medium text-blue-900\">Explore the Codebase</p>\n                <p className=\"text-sm text-blue-700\">\n                  Navigate to <code className=\"bg-blue-100 px-1 rounded\">dateFormatters.ts</code> - that's where the timezone fix needs to happen.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Terminal className=\"h-4 w-4\" />\n              merchant-dashboard/\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-gray-50 rounded-lg p-3 font-mono text-sm\">\n              {renderFileTree(fileStructure)}\n            </div>\n          </CardContent>\n        </Card>\n\n        {currentFile === 'dateFormatters.ts' && (\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-green-800\">\n                <CheckCircle2 className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Found it!</span>\n              </div>\n              <p className=\"text-sm text-green-700 mt-1\">\n                This is where dates are formatted for display. You'll fix the timezone handling here.\n              </p>\n              <Button \n                className=\"mt-3\"\n                onClick={() => setViewMode('overview')}\n                data-testid=\"button-continue-to-fix\"\n              >\n                Continue to Fix Code\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2CodeFix() {\n    // Load code exercise from JSON catalogue\n    const codeExercise = codeExerciseData.content;\n    const blank = codeExercise.blanks[0];\n    \n    const isCorrect = validateCodeBlank(codeInputs['blank1'] || '', blank as CodeBlank);\n    \n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-purple-50 border-purple-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Code className=\"h-6 w-6 text-purple-600\" />\n              <div>\n                <p className=\"font-medium text-purple-900\">Fix the Timezone Bug</p>\n                <p className=\"text-sm text-purple-700\">\n                  Complete the code by filling in the missing value. The function should use the merchant's timezone, not UTC.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <File className=\"h-4 w-4\" />\n              client/src/utils/dateFormatters.ts\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm text-green-400 overflow-x-auto\">\n              <pre className=\"whitespace-pre-wrap\">\n{`export function formatTransactionDate(\n  timestamp: string,\n  merchantTimezone: string = 'UTC'\n): string {\n  const date = new Date(timestamp);\n  \n  // TODO: Convert to merchant's timezone\n  const options: Intl.DateTimeFormatOptions = {\n    year: 'numeric',\n    month: 'short',\n    day: 'numeric',\n    hour: '2-digit',\n    minute: '2-digit',\n    timeZone: `}<span className=\"inline-flex items-center bg-gray-800 border border-gray-600 rounded px-1\">\n                  <input\n                    type=\"text\"\n                    value={codeInputs['blank1'] || ''}\n                    onChange={(e) => setCodeInputs(prev => ({ ...prev, blank1: e.target.value }))}\n                    placeholder=\"???\"\n                    className=\"bg-transparent text-yellow-400 w-32 outline-none font-mono\"\n                    data-testid=\"input-code-blank\"\n                  />\n                </span>{`  // Fill in the timezone\n  };\n  \n  return date.toLocaleString('en-US', options);\n}`}\n              </pre>\n            </div>\n            \n            <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\n              <p className=\"text-sm text-blue-800\">\n                <strong>Hint:</strong> Look at the function parameter - what variable holds the merchant's timezone preference?\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n\n        {codeInputs['blank1'] && (\n          <Card className={isCorrect ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'}>\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2\">\n                {isCorrect ? (\n                  <>\n                    <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                    <span className=\"font-medium text-green-800\">Correct!</span>\n                  </>\n                ) : (\n                  <>\n                    <X className=\"h-5 w-5 text-red-600\" />\n                    <span className=\"font-medium text-red-800\">Not quite - check the function parameter name</span>\n                  </>\n                )}\n              </div>\n              {isCorrect && (\n                <>\n                  <p className=\"text-sm text-green-700 mt-1\">\n                    By using <code className=\"bg-green-100 px-1 rounded\">merchantTimezone</code>, transactions will now display in the merchant's local time!\n                  </p>\n                  <Button \n                    className=\"mt-3\"\n                    onClick={() => {\n                      setCodeFixComplete(true);\n                      setViewMode('overview');\n                    }}\n                    data-testid=\"button-code-fix-complete\"\n                  >\n                    Continue to Test Your Fix\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2TestFix() {\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-green-50 border-green-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Play className=\"h-6 w-6 text-green-600\" />\n              <div>\n                <p className=\"font-medium text-green-900\">Test Your Fix</p>\n                <p className=\"text-sm text-green-700\">\n                  Before committing, always verify your changes work in the browser.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Monitor className=\"h-4 w-4\" />\n              Merchant Dashboard - Transactions\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"border rounded-lg overflow-hidden\">\n              <div className=\"bg-gray-100 p-2 flex items-center gap-2 border-b\">\n                <div className=\"flex gap-1\">\n                  <div className=\"w-3 h-3 rounded-full bg-red-400\" />\n                  <div className=\"w-3 h-3 rounded-full bg-yellow-400\" />\n                  <div className=\"w-3 h-3 rounded-full bg-green-400\" />\n                </div>\n                <div className=\"flex-1 bg-white rounded px-2 py-1 text-xs text-gray-500\">\n                  localhost:5173/transactions\n                </div>\n              </div>\n              \n              <div className=\"p-4 bg-white\">\n                <div className=\"flex items-center justify-between mb-4\">\n                  <h3 className=\"font-semibold text-gray-900\">Recent Transactions</h3>\n                  <Badge variant=\"outline\">Maria's Coffee Shop (CST)</Badge>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded border\">\n                    <div>\n                      <p className=\"font-medium\">$24.50 - Card Payment</p>\n                      <p className={`text-sm ${testState === 'after' ? 'text-green-600' : 'text-red-600'}`}>\n                        {testState === 'after' ? 'Feb 14, 8:30 PM CST' : 'Feb 15, 2:30 AM UTC'}\n                      </p>\n                    </div>\n                    {testState === 'after' && <CheckCircle2 className=\"h-5 w-5 text-green-500\" />}\n                    {testState === 'before' && <X className=\"h-5 w-5 text-red-400\" />}\n                  </div>\n                  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded border\">\n                    <div>\n                      <p className=\"font-medium\">$8.75 - Card Payment</p>\n                      <p className={`text-sm ${testState === 'after' ? 'text-green-600' : 'text-red-600'}`}>\n                        {testState === 'after' ? 'Feb 14, 7:15 PM CST' : 'Feb 15, 1:15 AM UTC'}\n                      </p>\n                    </div>\n                    {testState === 'after' && <CheckCircle2 className=\"h-5 w-5 text-green-500\" />}\n                    {testState === 'before' && <X className=\"h-5 w-5 text-red-400\" />}\n                  </div>\n                  <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded border\">\n                    <div>\n                      <p className=\"font-medium\">$15.00 - Card Payment</p>\n                      <p className={`text-sm ${testState === 'after' ? 'text-green-600' : 'text-red-600'}`}>\n                        {testState === 'after' ? 'Feb 14, 6:45 PM CST' : 'Feb 15, 12:45 AM UTC'}\n                      </p>\n                    </div>\n                    {testState === 'after' && <CheckCircle2 className=\"h-5 w-5 text-green-500\" />}\n                    {testState === 'before' && <X className=\"h-5 w-5 text-red-400\" />}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {testState === 'before' && (\n              <div className=\"mt-4 p-3 bg-red-50 rounded-lg border border-red-200\">\n                <p className=\"text-sm text-red-800\">\n                  <strong>Bug visible:</strong> Transactions show UTC time (next day at 2am) instead of Maria's local CST time (8pm same day).\n                </p>\n              </div>\n            )}\n\n            {testState === 'running' && (\n              <div className=\"mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200 flex items-center gap-2\">\n                <div className=\"animate-spin h-4 w-4 border-2 border-blue-600 border-t-transparent rounded-full\" />\n                <p className=\"text-sm text-blue-800\">Refreshing with your fix...</p>\n              </div>\n            )}\n\n            {testState === 'after' && (\n              <div className=\"mt-4 p-3 bg-green-50 rounded-lg border border-green-200\">\n                <p className=\"text-sm text-green-800\">\n                  <strong>Fix working!</strong> Transactions now show in Maria's local timezone (CST). The dates make sense for her daily reconciliation.\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {testState === 'before' && (\n          <Button \n            className=\"w-full\"\n            onClick={() => {\n              setTestState('running');\n              setTimeout(() => setTestState('after'), 1500);\n            }}\n            data-testid=\"button-run-test\"\n          >\n            <Play className=\"h-4 w-4 mr-2\" />\n            Refresh Page to Test Fix\n          </Button>\n        )}\n\n        {testState === 'after' && (\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-green-800\">\n                <CheckCircle2 className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Your fix works!</span>\n              </div>\n              <p className=\"text-sm text-green-700 mt-1\">\n                Time to save your work with git and create a pull request.\n              </p>\n              <Button \n                className=\"mt-3\"\n                onClick={() => {\n                  setTestFixComplete(true);\n                  setViewMode('overview');\n                }}\n                data-testid=\"button-test-complete\"\n              >\n                Continue to Git Workflow\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2Git() {\n    // Load git workflow steps from JSON catalogue\n    const gitSteps = gitWorkflowStepsData.content.steps;\n\n    const currentStepIdx = gitSteps.findIndex(step => !gitInputs[step.id]);\n    const allComplete = currentStepIdx === -1;\n\n    const handleGitCommand = (stepId: string, input: string) => {\n      const step = gitSteps.find(s => s.id === stepId);\n      if (step && validateGitCommand(input, step as GitStep)) {\n        setGitInputs(prev => ({ ...prev, [stepId]: input }));\n      }\n    };\n\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-gray-50 border-gray-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <GitCommit className=\"h-6 w-6 text-gray-600\" />\n              <div>\n                <p className=\"font-medium text-gray-900\">Git Workflow</p>\n                <p className=\"text-sm text-gray-700\">\n                  Save your work by staging, committing, and pushing your changes.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Terminal className=\"h-4 w-4\" />\n              Terminal\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"bg-gray-900 rounded-lg p-4 font-mono text-sm space-y-4\">\n              {gitSteps.map((step, idx) => {\n                const isComplete = gitInputs[step.id];\n                const isCurrent = idx === currentStepIdx;\n                const isFuture = idx > currentStepIdx && currentStepIdx !== -1;\n\n                return (\n                  <div key={step.id} className={isFuture ? 'opacity-40' : ''}>\n                    <p className=\"text-gray-400 text-xs mb-1\"># {step.instruction}</p>\n                    {isComplete ? (\n                      <>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-green-400\">$</span>\n                          <span className=\"text-white\">{gitInputs[step.id]}</span>\n                          <Check className=\"h-4 w-4 text-green-400 ml-2\" />\n                        </div>\n                        {step.successOutput && (\n                          <pre className=\"text-gray-400 text-xs mt-1 whitespace-pre-wrap\">{step.successOutput}</pre>\n                        )}\n                      </>\n                    ) : isCurrent ? (\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-green-400\">$</span>\n                        <input\n                          type=\"text\"\n                          className=\"bg-transparent text-white flex-1 outline-none\"\n                          placeholder=\"Type your command...\"\n                          onKeyDown={(e) => {\n                            if (e.key === 'Enter') {\n                              handleGitCommand(step.id, e.currentTarget.value);\n                            }\n                          }}\n                          data-testid={`input-git-${step.id}`}\n                        />\n                      </div>\n                    ) : (\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"text-gray-600\">$</span>\n                        <span className=\"text-gray-600\">...</span>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {currentStepIdx !== -1 && currentStepIdx < gitSteps.length && (\n              <div className=\"mt-3 p-3 bg-amber-50 rounded-lg border border-amber-200\">\n                <p className=\"text-sm text-amber-800\">\n                  <strong>Hint:</strong> {gitSteps[currentStepIdx].hint}\n                </p>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {allComplete && (\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-green-800\">\n                <CheckCircle2 className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Changes pushed!</span>\n              </div>\n              <p className=\"text-sm text-green-700 mt-1\">\n                Your code is now on GitHub. Time to create a pull request for review.\n              </p>\n              <Button \n                className=\"mt-3\"\n                onClick={() => {\n                  setGitWorkflowComplete(true);\n                  setViewMode('overview');\n                }}\n                data-testid=\"button-git-complete\"\n              >\n                Continue to Create PR\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2PR() {\n    const isValidPR = prTitle.trim().length > 10 && prDescriptionLocal.trim().length > 20;\n\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-purple-50 border-purple-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <GitPullRequest className=\"h-6 w-6 text-purple-600\" />\n              <div>\n                <p className=\"font-medium text-purple-900\">Create Pull Request</p>\n                <p className=\"text-sm text-purple-700\">\n                  A good PR helps reviewers understand your changes quickly.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {!prSubmittedLocal ? (\n          <Card>\n            <CardHeader className=\"pb-3 bg-gray-50 border-b\">\n              <div className=\"flex items-center gap-2\">\n                <GitPullRequest className=\"h-5 w-5 text-green-600\" />\n                <span className=\"font-medium\">Open a pull request</span>\n              </div>\n              <div className=\"flex items-center gap-2 mt-2 text-sm text-gray-600\">\n                <Badge variant=\"outline\" className=\"text-xs\">fix/timezone-display</Badge>\n                <ArrowRight className=\"h-3 w-3\" />\n                <Badge variant=\"outline\" className=\"text-xs\">main</Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-4 space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Title</label>\n                <Input\n                  value={prTitle}\n                  onChange={(e) => setPrTitle(e.target.value)}\n                  placeholder=\"Fix timezone display for merchant transactions\"\n                  data-testid=\"input-pr-title\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">Summarize what this PR does</p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">Description</label>\n                <Textarea\n                  value={prDescriptionLocal}\n                  onChange={(e) => setPrDescriptionLocal(e.target.value)}\n                  placeholder={`## What changed\n- Updated formatTransactionDate to use merchant's timezone\n\n## Why\nMerchants were seeing transactions in UTC instead of their local time, causing confusion during reconciliation.\n\n## Testing\nTested with CST timezone, transactions now display correctly.`}\n                  className=\"min-h-[150px] font-mono text-sm\"\n                  data-testid=\"input-pr-description\"\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between pt-2\">\n                <div className=\"text-sm text-gray-500\">\n                  Reviewers: Sarah (auto-assigned)\n                </div>\n                <Button \n                  disabled={!isValidPR}\n                  onClick={() => setPrSubmittedLocal(true)}\n                  data-testid=\"button-create-pr\"\n                >\n                  Create Pull Request\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        ) : (\n          <Card className=\"border-green-200 bg-green-50\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-2 text-green-800 mb-3\">\n                <CheckCircle2 className=\"h-5 w-5\" />\n                <span className=\"font-medium\">Pull Request Created!</span>\n              </div>\n              \n              <div className=\"bg-white rounded-lg p-4 border mb-3\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <GitPullRequest className=\"h-4 w-4 text-green-600\" />\n                  <span className=\"font-medium text-gray-900\">{prTitle || 'Fix timezone display'}</span>\n                  <Badge className=\"bg-green-100 text-green-700 text-xs\">Open</Badge>\n                </div>\n                <p className=\"text-sm text-gray-600\">#47 opened just now by you</p>\n                <div className=\"flex items-center gap-4 mt-2 text-sm text-gray-500\">\n                  <span className=\"flex items-center gap-1\">\n                    <MessageSquare className=\"h-3 w-3\" />\n                    0 comments\n                  </span>\n                  <span className=\"flex items-center gap-1\">\n                    <File className=\"h-3 w-3\" />\n                    1 file changed\n                  </span>\n                </div>\n              </div>\n\n              <p className=\"text-sm text-green-700\">\n                Sarah will review this tomorrow morning. Great work on your first PR!\n              </p>\n              <Button \n                className=\"mt-3\"\n                onClick={() => {\n                  setPrCreated(true);\n                  setViewMode('overview');\n                }}\n                data-testid=\"button-pr-complete\"\n              >\n                Continue to Reflection\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    );\n  }\n\n  function renderDay2Reflection() {\n    return (\n      <div className=\"space-y-4\">\n        <Card className=\"bg-indigo-50 border-indigo-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <PenLine className=\"h-6 w-6 text-indigo-600\" />\n              <div>\n                <p className=\"font-medium text-indigo-900\">Day 2 Reflection</p>\n                <p className=\"text-sm text-indigo-700\">\n                  Great work today! Before wrapping up, think about what you'd like to confirm with QA tomorrow.\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base\">What will you confirm with Alex (QA) tomorrow?</CardTitle>\n            <CardDescription>\n              Think about edge cases, testing scenarios, or anything you're unsure about.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Textarea\n              value={reflectionText}\n              onChange={(e) => setReflectionText(e.target.value)}\n              placeholder=\"For example: I want to confirm that the timezone fix works for merchants in different timezones, especially those with daylight saving time...\"\n              className=\"min-h-[120px]\"\n              data-testid=\"input-reflection\"\n            />\n            \n            <div className=\"mt-3 p-3 bg-gray-50 rounded-lg\">\n              <p className=\"text-sm text-gray-600 font-medium mb-2\">Good things to think about:</p>\n              <ul className=\"text-sm text-gray-600 space-y-1\">\n                <li> Edge cases (daylight saving time, international date line)</li>\n                <li> Different timezone formats</li>\n                <li> How the fix affects date filters</li>\n                <li> Mobile vs desktop display</li>\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n\n        {reflectionText.length >= 20 && (\n          <Button \n            className=\"w-full\"\n            onClick={() => {\n              setReflectionComplete(true);\n              setViewMode('overview');\n            }}\n            data-testid=\"button-complete-day2\"\n          >\n            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n            Complete Day 2\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  function renderTeamIntroView() {\n    if (selectedMember) {\n      return (\n        <div className=\"h-full flex flex-col\">\n          {/* Chat Header - styled like standup */}\n          <div className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-3 mb-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\" \n                  onClick={() => setSelectedMember(null)}\n                  className=\"mr-1\"\n                  data-testid=\"button-back-to-team-list\"\n                >\n                  <ArrowLeft className=\"h-4 w-4\" />\n                </Button>\n                <Avatar className=\"h-10 w-10 ring-2 ring-white shadow-md\">\n                  <AvatarImage src={getTeamAvatarUrl(selectedMember.name)} alt={selectedMember.name} />\n                  <AvatarFallback className={`text-white ${getTeamMemberColor(selectedMember.name)}`}>\n                    {getTeamMemberInitials(selectedMember.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <div className=\"flex items-center gap-2\">\n                    <h3 className=\"font-semibold text-gray-900\">{selectedMember.name}</h3>\n                    <Badge variant=\"outline\" className=\"text-xs py-0 h-5\">{selectedMember.role}</Badge>\n                  </div>\n                  <p className=\"text-xs text-gray-600\">Direct Message</p>\n                </div>\n              </div>\n              {introProgress[selectedMember.name] && (\n                <Badge className=\"bg-green-100 text-green-800 border-green-300\">\n                  <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                  Introduced\n                </Badge>\n              )}\n            </div>\n          </div>\n\n          {selectedMember.bio && (\n            <Card className=\"mb-4 bg-gradient-to-r from-gray-50 to-slate-50 border-gray-200\">\n              <CardContent className=\"p-3 text-sm text-gray-700\">\n                <p className=\"text-xs font-medium text-gray-500 mb-1\">About {selectedMember.name}</p>\n                {selectedMember.bio}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Messages - styled like standup */}\n          <ScrollArea className=\"flex-1 pr-2 mb-4\">\n            <div className=\"space-y-4\">\n              {filteredInteractions.length === 0 && (\n                <div className=\"text-center py-8 text-gray-500\">\n                  <Coffee className=\"h-8 w-8 mx-auto mb-2 opacity-50\" />\n                  <p className=\"font-medium\">Say hello to {selectedMember.name}!</p>\n                  <p className=\"text-sm\">Introduce yourself and ask about their role.</p>\n                </div>\n              )}\n              {filteredInteractions.map((interaction: any, idx: number) => {\n                const isUserMsg = interaction.sender === 'You' || interaction.sender === 'User';\n                return (\n                <div key={idx} className=\"flex gap-3\" data-testid={`message-${idx}`}>\n                  <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                    <AvatarImage \n                      src={isUserMsg \n                        ? `https://api.dicebear.com/7.x/avataaars/svg?seed=user-intern&backgroundColor=b6e3f4`\n                        : getTeamAvatarUrl(interaction.sender)\n                      } \n                      alt={interaction.sender} \n                    />\n                    <AvatarFallback className={`text-white text-xs ${\n                      isUserMsg ? 'bg-blue-500' : getTeamMemberColor(interaction.sender)\n                    }`}>\n                      {isUserMsg ? 'ME' : getTeamMemberInitials(interaction.sender)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-sm font-medium text-gray-900\">\n                        {isUserMsg ? 'You' : interaction.sender}\n                      </span>\n                      <Badge variant=\"outline\" className=\"text-xs py-0 h-5\">\n                        {isUserMsg ? 'Intern' : selectedMember.role}\n                      </Badge>\n                    </div>\n                    <div className={`rounded-lg p-3 shadow-sm ${\n                      isUserMsg\n                        ? 'bg-blue-50 border border-blue-200'\n                        : 'bg-white border'\n                    }`}>\n                      <p className=\"text-sm text-gray-700\">{interaction.content}</p>\n                    </div>\n                  </div>\n                </div>\n              );})}\n              {typingIndicator && (\n                <div className=\"flex gap-3\">\n                  <Avatar className=\"h-9 w-9 flex-shrink-0\">\n                    <AvatarImage src={getTeamAvatarUrl(typingIndicator)} alt={typingIndicator} />\n                    <AvatarFallback className={`text-white text-xs ${getTeamMemberColor(typingIndicator)}`}>\n                      {getTeamMemberInitials(typingIndicator)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2 mb-1\">\n                      <span className=\"text-sm font-medium text-gray-900\">{typingIndicator}</span>\n                    </div>\n                    <div className=\"bg-gray-100 rounded-lg p-3 inline-block\">\n                      <div className=\"flex gap-1\">\n                        <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                        <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                        <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              )}\n              <div ref={messagesEndRef} />\n            </div>\n          </ScrollArea>\n\n          {/* Input Area or Completion Card */}\n          {closedConversations[selectedMember.name] ? (\n            <div className=\"border-t pt-4\">\n              <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <div className=\"w-10 h-10 bg-green-100 rounded-full flex items-center justify-center\">\n                    <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\n                  </div>\n                  <div>\n                    <h4 className=\"font-semibold text-green-800\">Intro Complete!</h4>\n                    <p className=\"text-sm text-green-600\">You've met {selectedMember.name}</p>\n                  </div>\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button \n                    variant=\"outline\"\n                    size=\"sm\"\n                    className=\"flex-1\"\n                    onClick={async () => {\n                      // Notify backend to reopen the channel\n                      try {\n                        const response = await apiRequest(\"POST\", `/api/workspace/${session.id}/reopen-channel`, {\n                          channel: `dm-${selectedMember.name}`\n                        });\n                        const result = await response.json();\n                        if (result.success) {\n                          setClosedConversations(prev => ({ ...prev, [selectedMember.name]: false }));\n                        } else {\n                          console.error('Failed to reopen channel:', result.message);\n                        }\n                      } catch (error) {\n                        console.error('Failed to reopen channel:', error);\n                        // Still allow local reopen even if backend fails\n                        setClosedConversations(prev => ({ ...prev, [selectedMember.name]: false }));\n                      }\n                    }}\n                    data-testid=\"button-reopen-chat\"\n                  >\n                    <MessageCircle className=\"h-4 w-4 mr-2\" />\n                    Reopen Chat\n                  </Button>\n                  <Button \n                    size=\"sm\"\n                    className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                    onClick={() => {\n                      setSelectedMember(null);\n                      // Find next team member to meet\n                      const teamMembersToMeet = teamMembers.filter((m: TeamMember) => m.name !== 'Sarah');\n                      const nextMember = teamMembersToMeet.find((m: TeamMember) => !closedConversations[m.name]);\n                      if (nextMember) {\n                        setTimeout(() => startTeamIntro(nextMember), 300);\n                      }\n                    }}\n                    data-testid=\"button-next-teammate\"\n                  >\n                    {teamMembers.filter((m: TeamMember) => m.name !== 'Sarah').every((m: TeamMember) => closedConversations[m.name] || m.name === selectedMember.name) \n                      ? 'All Done!' \n                      : 'Meet Next Teammate'}\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"border-t pt-4\">\n              <div className=\"flex gap-2\">\n                <Textarea\n                  value={message}\n                  onChange={(e) => setMessage(e.target.value)}\n                  placeholder={`Message ${selectedMember.name}...`}\n                  className=\"min-h-[60px] resize-none bg-white\"\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault();\n                      handleSendMessage();\n                    }\n                  }}\n                  data-testid=\"input-message\"\n                />\n                <Button \n                  onClick={() => handleSendMessage()}\n                  disabled={!message.trim() || sendMessageMutation.isPending}\n                  className=\"self-end\"\n                  data-testid=\"button-send-message\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"text-lg font-semibold text-gray-900\">Your Team</h3>\n          <Badge variant=\"outline\">\n            {completedIntroCount}/{teamMembersToMeet.length} introduced\n          </Badge>\n        </div>\n        <p className=\"text-sm text-gray-500\">\n          Meet your teammates! Sarah (your lead) will check in with you after you've read the docs.\n        </p>\n        \n        <div className=\"grid gap-3\">\n          {teamMembersToMeet.map((member: TeamMember, idx: number) => (\n            <Card \n              key={idx}\n              className={`cursor-pointer transition-all hover:shadow-md ${\n                introProgress[member.name] ? 'border-green-200' : ''\n              }`}\n              onClick={() => startTeamIntro(member)}\n              data-testid={`team-member-card-${idx}`}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Avatar className=\"h-10 w-10 ring-2 ring-white shadow-sm\">\n                      <AvatarImage src={getTeamAvatarUrl(member.name)} alt={member.name} />\n                      <AvatarFallback className={`text-white ${getTeamMemberColor(member.name)}`}>\n                        {getTeamMemberInitials(member.name)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium text-gray-900\">{member.name}</p>\n                        {introProgress[member.name] && (\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-600\">{member.role}</p>\n                      <p className=\"text-xs text-gray-500 italic\">{member.personality}</p>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-1 max-w-[200px]\">\n                    {member.expertise?.slice(0, 2).map((skill: string, i: number) => (\n                      <Badge key={i} variant=\"outline\" className=\"text-xs\">\n                        {skill}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  function toggleSection(section: string, open: boolean) {\n    setExpandedSections(prev => ({ ...prev, [section]: open }));\n    if (open) {\n      setDocSectionsRead(prev => ({ ...prev, [section]: true }));\n    }\n  }\n\n  const allSectionsRead = Boolean(\n    docSectionsRead['product'] && \n    docSectionsRead['users'] && \n    docSectionsRead['norms'] && \n    docSectionsRead['workflow']\n  );\n\n  function handleFinishDocs() {\n    if (!allSectionsRead) return;\n    setDocsRead(true);\n    setViewMode('overview');\n  }\n\n  function renderDocumentation() {\n    return (\n      <div className=\"space-y-4\" ref={docsScrollRef}>\n        {/* Welcome Card */}\n        <Card className=\"bg-gradient-to-r from-purple-50 to-blue-50 border-purple-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-start gap-3\">\n              <div className=\"h-10 w-10 rounded-full bg-purple-100 flex items-center justify-center\">\n                <Sparkles className=\"h-5 w-5 text-purple-600\" />\n              </div>\n              <div className=\"flex-1\">\n                <p className=\"font-semibold text-purple-900\">Welcome to your first day!</p>\n                <p className=\"text-sm text-purple-800 mt-1\">\n                  Before you meet the team, take 5-10 minutes to read through these onboarding docs. \n                  You'll learn what NovaPay does and what you'll be working on this week.\n                </p>\n                <div className=\"flex items-center gap-2 mt-2 text-xs text-purple-600\">\n                  <Clock className=\"h-3 w-3\" />\n                  <span>4 short sections to read</span>\n                </div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"flex items-center justify-between mb-2\">\n          <h3 className=\"text-lg font-semibold text-gray-900 flex items-center gap-2\">\n            <BookOpen className=\"h-5 w-5\" />\n            Day 1 Onboarding Docs\n          </h3>\n          <Badge variant={allSectionsRead ? \"default\" : \"outline\"} className={allSectionsRead ? \"bg-green-600\" : \"\"}>\n            {Object.keys(docSectionsRead).length}/4 sections\n          </Badge>\n        </div>\n\n        <Tabs value={activeDocTab} onValueChange={setActiveDocTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-2\">\n            <TabsTrigger value=\"product\" className=\"flex items-center gap-2\" data-testid=\"tab-product\">\n              <Store className=\"h-4 w-4\" />\n              Product & Users\n              {docSectionsRead['product'] && docSectionsRead['users'] && (\n                <CheckCircle2 className=\"h-3 w-3 text-green-600 ml-1\" />\n              )}\n            </TabsTrigger>\n            <TabsTrigger value=\"howwework\" className=\"flex items-center gap-2\" data-testid=\"tab-howwework\">\n              <Users className=\"h-4 w-4\" />\n              How We Work\n              {docSectionsRead['norms'] && docSectionsRead['workflow'] && (\n                <CheckCircle2 className=\"h-3 w-3 text-green-600 ml-1\" />\n              )}\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"product\" className=\"space-y-4 mt-4\">\n            <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <Lightbulb className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                  <div>\n                    <p className=\"font-medium text-blue-900\">TL;DR</p>\n                    <p className=\"text-sm text-blue-800\">\n                      Merchant Dashboard helps small business owners track their money. You'll be fixing a timezone bug in the Transactions page.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Collapsible open={expandedSections['product']} onOpenChange={(open) => toggleSection('product', open)}>\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid=\"section-product\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <Store className=\"h-4 w-4 text-purple-600\" />\n                        What is Merchant Dashboard?\n                        {docSectionsRead['product'] && <CheckCircle2 className=\"h-4 w-4 text-green-600\" />}\n                      </CardTitle>\n                      {expandedSections['product'] ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                    </div>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0 space-y-4\">\n                    <p className=\"text-gray-700\">\n                      <strong>Merchant Dashboard</strong> is the admin panel where NovaPay's business customers manage their payment operations. Think of it as their \"mission control\" for money.\n                    </p>\n                    \n                    <div className=\"grid gap-3\">\n                      <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                        <CreditCard className=\"h-5 w-5 text-green-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Transactions</p>\n                          <p className=\"text-sm text-gray-600\">View all customer payments, refunds, and chargebacks in real-time</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                        <Calendar className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Payouts</p>\n                          <p className=\"text-sm text-gray-600\">See when money hits their bank account (usually every 2 business days)</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-start gap-3 p-3 bg-gray-50 rounded-lg\">\n                        <FileText className=\"h-5 w-5 text-orange-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-gray-900\">Settings</p>\n                          <p className=\"text-sm text-gray-600\">Update bank details, business info, and notification preferences</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"flex flex-wrap gap-2 pt-2\">\n                      <span className=\"text-sm text-gray-500\">Tech:</span>\n                      {['React', 'Node.js', 'PostgreSQL', 'TypeScript'].map((tech, idx) => (\n                        <Badge key={idx} variant=\"secondary\">{tech}</Badge>\n                      ))}\n                    </div>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n\n            <Collapsible open={expandedSections['users']} onOpenChange={(open) => toggleSection('users', open)}>\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid=\"section-users\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <Users className=\"h-4 w-4 text-purple-600\" />\n                        Who Uses It?\n                        {docSectionsRead['users'] && <CheckCircle2 className=\"h-4 w-4 text-green-600\" />}\n                      </CardTitle>\n                      {expandedSections['users'] ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                    </div>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0 space-y-4\">\n                    <Card className=\"bg-amber-50 border-amber-200\">\n                      <CardContent className=\"p-4\">\n                        <div className=\"flex items-start gap-4\">\n                          <Avatar className=\"h-12 w-12 bg-amber-100\">\n                            <AvatarFallback className=\"text-amber-700 text-lg\">M</AvatarFallback>\n                          </Avatar>\n                          <div>\n                            <p className=\"font-semibold text-amber-900\">Meet Maria - Coffee Shop Owner</p>\n                            <p className=\"text-sm text-amber-800 mt-1\">\n                              Maria runs \"Bean There\" in Austin, TX. Every morning she checks her dashboard to see yesterday's sales, verify tips were processed correctly, and confirm her weekly payout is on schedule.\n                            </p>\n                            <div className=\"flex gap-2 mt-2\">\n                              <Badge variant=\"outline\" className=\"text-xs\">Small Business</Badge>\n                              <Badge variant=\"outline\" className=\"text-xs\">50-100 transactions/day</Badge>\n                              <Badge variant=\"outline\" className=\"text-xs\">CST Timezone</Badge>\n                            </div>\n                          </div>\n                        </div>\n                      </CardContent>\n                    </Card>\n\n                    <div>\n                      <p className=\"font-medium text-gray-900 mb-2\">Maria's Daily Workflow:</p>\n                      <ol className=\"space-y-2 text-sm text-gray-700\">\n                        <li className=\"flex items-center gap-2\">\n                          <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-blue-100 text-blue-700 text-xs font-medium\">1</span>\n                          Opens dashboard, checks total sales from yesterday\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-blue-100 text-blue-700 text-xs font-medium\">2</span>\n                          Filters transactions by payment type (card vs cash)\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-blue-100 text-blue-700 text-xs font-medium\">3</span>\n                          Checks if Friday's payout arrived in her bank\n                        </li>\n                        <li className=\"flex items-center gap-2\">\n                          <span className=\"flex items-center justify-center w-5 h-5 rounded-full bg-blue-100 text-blue-700 text-xs font-medium\">4</span>\n                          Downloads weekly report for her accountant\n                        </li>\n                      </ol>\n                    </div>\n\n                    <div className=\"p-3 bg-red-50 rounded-lg border border-red-200\">\n                      <p className=\"text-sm text-red-800\">\n                        <strong>The Problem:</strong> Maria is in Austin (CST) but transactions show in UTC. A sale at 8pm Monday shows as 2am Tuesday - confusing her daily reconciliation!\n                      </p>\n                    </div>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n\n            {docSectionsRead['product'] && docSectionsRead['users'] && (\n              <Card className=\"bg-gradient-to-r from-orange-50 to-amber-50 border-orange-200 mt-4\">\n                <CardContent className=\"p-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center gap-3\">\n                      <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                      <div>\n                        <p className=\"font-medium text-orange-900\">Section Complete!</p>\n                        <p className=\"text-sm text-orange-700\">2 of 4 sections done. Learn how the team works next.</p>\n                      </div>\n                    </div>\n                    <Button \n                      onClick={() => {\n                        setActiveDocTab('howwework');\n                        setTimeout(() => {\n                          docsScrollRef.current?.scrollIntoView({ behavior: 'smooth', block: 'start' });\n                        }, 50);\n                      }}\n                      className=\"bg-orange-600 hover:bg-orange-700\"\n                      data-testid=\"button-continue-howwework\"\n                    >\n                      Continue to How We Work\n                      <ArrowRight className=\"h-4 w-4 ml-2\" />\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"howwework\" className=\"space-y-4 mt-4\">\n            <Card className=\"bg-gradient-to-r from-purple-50 to-indigo-50 border-purple-200\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <Users className=\"h-5 w-5 text-purple-600 mt-0.5\" />\n                  <div>\n                    <p className=\"font-medium text-purple-900\">How the Team Works</p>\n                    <p className=\"text-sm text-purple-800\">\n                      Before diving into code, learn how we collaborate, communicate, and ship features together.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Collapsible open={expandedSections['norms']} onOpenChange={(open) => toggleSection('norms', open)}>\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid=\"section-norms\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <MessageCircle className=\"h-4 w-4 text-purple-600\" />\n                        Team Norms & Culture\n                        {docSectionsRead['norms'] && <CheckCircle2 className=\"h-4 w-4 text-green-600\" />}\n                      </CardTitle>\n                      {expandedSections['norms'] ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                    </div>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0 space-y-4\">\n                    <p className=\"text-gray-700\">\n                      Every team has its own rhythm. Here's how we work together at NovaPay.\n                    </p>\n\n                    <div className=\"grid gap-3\">\n                      <div className=\"flex items-start gap-3 p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                        <Clock className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-blue-900\">Daily Standup at 10am</p>\n                          <p className=\"text-sm text-blue-800\">Quick 15-min sync. Share what you did, what you're doing, and any blockers.</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-start gap-3 p-3 bg-green-50 rounded-lg border border-green-200\">\n                        <MessageCircle className=\"h-5 w-5 text-green-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-green-900\">Ask Early, Ask Often</p>\n                          <p className=\"text-sm text-green-800\">Stuck for more than 15 minutes? Reach out. No question is too small.</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-start gap-3 p-3 bg-amber-50 rounded-lg border border-amber-200\">\n                        <GitPullRequest className=\"h-5 w-5 text-amber-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-amber-900\">Reviews = Learning</p>\n                          <p className=\"text-sm text-amber-800\">Code review feedback is about the code, not about you. It's how we all improve.</p>\n                        </div>\n                      </div>\n                      <div className=\"flex items-start gap-3 p-3 bg-purple-50 rounded-lg border border-purple-200\">\n                        <PenLine className=\"h-5 w-5 text-purple-600 mt-0.5\" />\n                        <div>\n                          <p className=\"font-medium text-purple-900\">Document As You Go</p>\n                          <p className=\"text-sm text-purple-800\">Comments and READMEs save future headaches. Write for future-you.</p>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"p-3 bg-gray-50 rounded-lg\">\n                      <p className=\"font-medium text-gray-900 mb-2\">Communication Channels:</p>\n                      <ul className=\"text-sm text-gray-700 space-y-1\">\n                        <li> <strong>Slack #team-payments</strong> - Day-to-day team chat</li>\n                        <li> <strong>Slack DMs</strong> - Quick questions to individuals</li>\n                        <li> <strong>GitHub PRs</strong> - Code discussions and reviews</li>\n                        <li> <strong>Notion</strong> - Documentation and specs</li>\n                      </ul>\n                    </div>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n\n            <Collapsible open={expandedSections['workflow']} onOpenChange={(open) => toggleSection('workflow', open)}>\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid=\"section-workflow\">\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <GitBranch className=\"h-4 w-4 text-teal-600\" />\n                        Development Flow\n                        {docSectionsRead['workflow'] && <CheckCircle2 className=\"h-4 w-4 text-green-600\" />}\n                      </CardTitle>\n                      {expandedSections['workflow'] ? <ChevronDown className=\"h-4 w-4\" /> : <ChevronRight className=\"h-4 w-4\" />}\n                    </div>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0 space-y-4\">\n                    <div>\n                      <p className=\"font-medium text-gray-900 mb-3\">How We Ship Features:</p>\n                      <div className=\"flex items-center gap-2 flex-wrap text-sm\">\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-gray-50\">\n                          <span className=\"text-gray-500\">1</span> Pick ticket\n                        </Badge>\n                        <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-blue-50\">\n                          <span className=\"text-blue-600\">2</span> Branch\n                        </Badge>\n                        <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-purple-50\">\n                          <span className=\"text-purple-600\">3</span> Code\n                        </Badge>\n                        <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-amber-50\">\n                          <span className=\"text-amber-600\">4</span> PR\n                        </Badge>\n                        <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-orange-50\">\n                          <span className=\"text-orange-600\">5</span> Review\n                        </Badge>\n                        <ArrowRight className=\"h-3 w-3 text-gray-400\" />\n                        <Badge variant=\"outline\" className=\"flex items-center gap-1 bg-green-100\">\n                          <span className=\"text-green-700\">6</span> Merge\n                        </Badge>\n                      </div>\n                    </div>\n\n                    <div className=\"p-4 bg-gray-50 rounded-lg border\">\n                      <p className=\"font-medium text-gray-900 mb-3\">Our Codebase:</p>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-start gap-3\">\n                          <Folder className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n                          <div>\n                            <p className=\"font-medium text-gray-900\">Repository: novapay/merchant-dashboard</p>\n                            <p className=\"text-sm text-gray-600\">Monorepo with client, server, and shared code</p>\n                          </div>\n                        </div>\n                        <div className=\"grid grid-cols-3 gap-2 text-xs font-mono\">\n                          <div className=\"p-2 bg-white rounded border\">\n                            <FolderOpen className=\"h-3 w-3 inline mr-1 text-blue-500\" />\n                            client/\n                            <p className=\"text-gray-500 mt-1\">React frontend</p>\n                          </div>\n                          <div className=\"p-2 bg-white rounded border\">\n                            <FolderOpen className=\"h-3 w-3 inline mr-1 text-green-500\" />\n                            server/\n                            <p className=\"text-gray-500 mt-1\">Node.js API</p>\n                          </div>\n                          <div className=\"p-2 bg-white rounded border\">\n                            <FolderOpen className=\"h-3 w-3 inline mr-1 text-purple-500\" />\n                            shared/\n                            <p className=\"text-gray-500 mt-1\">Types & utils</p>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n\n                    <div className=\"p-3 bg-blue-50 rounded-lg border border-blue-200\">\n                      <p className=\"font-medium text-blue-900 mb-2\">Conventions:</p>\n                      <ul className=\"text-sm text-blue-800 space-y-1\">\n                        <li> <strong>Branch names:</strong> fix/description or feature/description</li>\n                        <li> <strong>Commits:</strong> Clear, descriptive messages (\"Fix timezone display in transactions\")</li>\n                        <li> <strong>PRs:</strong> Include what, why, and how to test</li>\n                        <li> <strong>Comments:</strong> Explain the \"why\", not the \"what\"</li>\n                      </ul>\n                    </div>\n\n                    <div>\n                      <p className=\"font-medium text-gray-900 mb-2\">Who to Ask:</p>\n                      <div className=\"grid gap-2 text-sm\">\n                        <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarFallback className=\"text-xs bg-blue-100 text-blue-700\">S</AvatarFallback>\n                          </Avatar>\n                          <span><strong>Sarah</strong> - Code questions, PR reviews, architecture</span>\n                        </div>\n                        <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarFallback className=\"text-xs bg-pink-100 text-pink-700\">P</AvatarFallback>\n                          </Avatar>\n                          <span><strong>Priya</strong> - Requirements, user context, priorities</span>\n                        </div>\n                        <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarFallback className=\"text-xs bg-green-100 text-green-700\">M</AvatarFallback>\n                          </Avatar>\n                          <span><strong>Marcus</strong> - Tricky bugs, system design</span>\n                        </div>\n                        <div className=\"flex items-center gap-2 p-2 bg-gray-50 rounded\">\n                          <Avatar className=\"h-6 w-6\">\n                            <AvatarFallback className=\"text-xs bg-orange-100 text-orange-700\">A</AvatarFallback>\n                          </Avatar>\n                          <span><strong>Alex</strong> - Testing, QA process, edge cases</span>\n                        </div>\n                      </div>\n                    </div>\n\n                    <Collapsible>\n                      <CollapsibleTrigger className=\"w-full\">\n                        <div className=\"flex items-center justify-between p-3 bg-gray-900 rounded-lg text-white hover:bg-gray-800 transition-colors\">\n                          <div className=\"flex items-center gap-2\">\n                            <Terminal className=\"h-4 w-4 text-green-400\" />\n                            <span className=\"text-sm font-medium\">Quick Reference: Git Commands</span>\n                          </div>\n                          <ChevronDown className=\"h-4 w-4\" />\n                        </div>\n                      </CollapsibleTrigger>\n                      <CollapsibleContent>\n                        <div className=\"bg-gray-900 rounded-b-lg p-4 font-mono text-sm text-green-400 -mt-2 border-t border-gray-700\">\n                          <pre className=\"whitespace-pre-wrap\">{`# Start a new feature:\ngit checkout main\ngit pull origin main\ngit checkout -b fix/your-feature-name\n\n# Save your work:\ngit add .\ngit commit -m \"Your descriptive message\"\n\n# Push and create PR:\ngit push origin fix/your-feature-name\n# Then open a PR on GitHub`}</pre>\n                        </div>\n                      </CollapsibleContent>\n                    </Collapsible>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n          </TabsContent>\n        </Tabs>\n\n        <div className=\"pt-4 space-y-3\">\n          <div className=\"flex items-center justify-between text-sm text-gray-600\">\n            <span>Reading progress</span>\n            <span>{Object.keys(docSectionsRead).length} of 4 sections completed</span>\n          </div>\n          <Progress value={(Object.keys(docSectionsRead).length / 4) * 100} className=\"h-2\" />\n          \n          <Button \n            className=\"w-full\"\n            onClick={handleFinishDocs}\n            disabled={!allSectionsRead}\n            data-testid=\"button-finish-reading\"\n          >\n            {allSectionsRead ? (\n              <>\n                <Users className=\"h-4 w-4 mr-2\" />\n                Done Reading - Continue to Meet the Team\n              </>\n            ) : (\n              <>\n                <BookOpen className=\"h-4 w-4 mr-2\" />\n                Read all 4 sections to continue\n              </>\n            )}\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  function renderComprehensionCheck() {\n    const sarah = teamMembers.find(m => m.name === 'Sarah') || teamMembers[0];\n    const isUserMessage = (sender: string) => sender === 'You' || sender === 'User';\n    \n    return (\n      <div className=\"h-full flex flex-col\">\n        <Card className=\"mb-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center gap-3\">\n              <Avatar className=\"h-12 w-12 ring-2 ring-white shadow-md\">\n                <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                <AvatarFallback className=\"bg-blue-500 text-white font-semibold\">S</AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"font-semibold text-blue-900\">Check in with Sarah</p>\n                <p className=\"text-sm text-blue-700\">\n                  Share what you've learned from the documentation. This is a casual chat, not a test!\n                </p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <ScrollArea className=\"flex-1 pr-4 mb-4\">\n          <div className=\"space-y-4 px-1\">\n            {/* Always show Sarah's initial greeting as the first message */}\n            <div className=\"flex items-start gap-3\">\n              <Avatar className=\"h-8 w-8 mt-1 ring-1 ring-gray-200 shadow-sm flex-shrink-0\">\n                <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                <AvatarFallback className=\"bg-blue-500 text-white text-xs\">S</AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 max-w-[85%]\">\n                <p className=\"text-xs font-medium text-blue-600 mb-1\">Sarah</p>\n                <div className=\"bg-white border border-gray-200 rounded-2xl rounded-tl-sm px-4 py-3 shadow-sm\">\n                  <p className=\"text-gray-800 leading-relaxed\">\n                    Hey! I see you've been reading through the docs. Before we get you started on anything, I just want to make sure we're on the same page. What's your understanding of what our Merchant Dashboard does?\n                  </p>\n                </div>\n              </div>\n            </div>\n            {filteredInteractions.map((interaction: any, idx: number) => (\n              <div\n                key={idx}\n                className={`flex ${isUserMessage(interaction.sender) ? 'justify-end' : 'items-start gap-3'}`}\n                data-testid={`comprehension-message-${idx}`}\n              >\n                {!isUserMessage(interaction.sender) && (\n                  <Avatar className=\"h-8 w-8 mt-1 ring-1 ring-gray-200 shadow-sm flex-shrink-0\">\n                    <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                    <AvatarFallback className=\"bg-blue-500 text-white text-xs\">S</AvatarFallback>\n                  </Avatar>\n                )}\n                <div className={`flex flex-col ${isUserMessage(interaction.sender) ? 'items-end' : 'flex-1 max-w-[85%]'}`}>\n                  {!isUserMessage(interaction.sender) && (\n                    <p className=\"text-xs font-medium text-blue-600 mb-1\">Sarah</p>\n                  )}\n                  <div\n                    className={`px-4 py-3 ${\n                      isUserMessage(interaction.sender)\n                        ? 'bg-blue-600 text-white rounded-2xl rounded-br-sm max-w-[85%] shadow-sm'\n                        : 'bg-white border border-gray-200 rounded-2xl rounded-tl-sm shadow-sm'\n                    }`}\n                  >\n                    <p className={`leading-relaxed ${isUserMessage(interaction.sender) ? 'text-white' : 'text-gray-800'}`}>\n                      {interaction.content}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            ))}\n            {typingIndicator && (\n              <div className=\"flex items-start gap-3\">\n                <Avatar className=\"h-8 w-8 mt-1 ring-1 ring-gray-200 shadow-sm flex-shrink-0\">\n                  <AvatarImage src={getTeamAvatarUrl('Sarah')} alt=\"Sarah\" />\n                  <AvatarFallback className=\"bg-blue-500 text-white text-xs\">S</AvatarFallback>\n                </Avatar>\n                <div className=\"flex flex-col\">\n                  <p className=\"text-xs font-medium text-blue-600 mb-1\">Sarah</p>\n                  <div className=\"bg-gray-100 rounded-2xl rounded-tl-sm px-4 py-3\">\n                    <div className=\"flex items-center gap-1\">\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                      <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            <div ref={messagesEndRef} />\n          </div>\n        </ScrollArea>\n\n        {/* Show completion card when Sarah closes the conversation */}\n        {closedConversations['Sarah'] ? (\n          <div className=\"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200 rounded-lg p-4 -mx-4 -mb-4\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"w-10 h-10 bg-green-500 rounded-full flex items-center justify-center\">\n                <CheckCircle2 className=\"h-5 w-5 text-white\" />\n              </div>\n              <div>\n                <p className=\"font-semibold text-green-800\">Comprehension Check Complete!</p>\n                <p className=\"text-sm text-green-600\">You've discussed the project with Sarah</p>\n              </div>\n            </div>\n            <Button \n              className=\"w-full bg-green-600 hover:bg-green-700\"\n              onClick={() => {\n                setComprehensionComplete(true);\n                setShowDay2Preview(true);\n              }}\n              data-testid=\"button-complete-day1\"\n            >\n              <Star className=\"h-4 w-4 mr-2\" />\n              View Day 1 Summary\n            </Button>\n          </div>\n        ) : (\n          <div className=\"space-y-3 bg-gray-50 -mx-4 -mb-4 px-4 py-4 border-t\">\n            <div className=\"flex gap-2\">\n              <Textarea\n                value={message}\n                onChange={(e) => setMessage(e.target.value)}\n                placeholder=\"Type your response to Sarah...\"\n                className=\"min-h-[60px] resize-none bg-white border-gray-300 focus:border-blue-400 focus:ring-blue-400\"\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage(sarah);\n                  }\n                }}\n                data-testid=\"input-comprehension-message\"\n              />\n              <Button \n                onClick={() => handleSendMessage(sarah)}\n                disabled={!message.trim() || sendMessageMutation.isPending}\n                className=\"px-4\"\n                data-testid=\"button-send-comprehension-message\"\n              >\n                <Send className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-screen flex flex-col bg-gray-50\">\n      <div className=\"bg-white border-b px-6 py-4\">\n        <div className=\"max-w-screen-xl mx-auto\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\" data-testid=\"text-session-title\">\n                {project.name}\n              </h1>\n              <p className=\"text-gray-600 text-sm mt-1\">\n                Your first week as a software engineering intern\n              </p>\n            </div>\n            <Button\n              onClick={onComplete}\n              variant=\"outline\"\n              size=\"sm\"\n              data-testid=\"button-exit-session\"\n            >\n              Exit Simulation\n            </Button>\n          </div>\n\n          <div className=\"flex items-center gap-6\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"h-5 w-5 text-blue-600\" />\n              <span className=\"font-medium\">Day {currentDay} of 5</span>\n            </div>\n            <div className=\"flex-1 max-w-md\">\n              <div className=\"flex items-center justify-between text-sm mb-1\">\n                <span className=\"text-gray-600\">Today's Progress</span>\n                <span className=\"font-medium\">{dayProgress}%</span>\n              </div>\n              <Progress value={dayProgress} className=\"h-2\" />\n            </div>\n            {/* Only show \"Continue to next day\" in journey mode, and only for implemented days (1-2) */}\n            {dayProgress >= 80 && currentDay < 5 && mode === 'journey' && currentDay < 2 && (\n              <Button \n                size=\"sm\"\n                onClick={() => setCurrentDay(currentDay + 1)}\n                data-testid=\"button-next-day\"\n              >\n                Continue to Day {currentDay + 1}\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            )}\n            {/* Show completion message when day is complete in practice mode */}\n            {dayProgress >= 80 && mode === 'practice' && (\n              <Badge className=\"bg-green-100 text-green-800\">\n                <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                Day Complete!\n              </Badge>\n            )}\n          </div>\n        </div>\n      </div>\n\n      <div className=\"flex-1 overflow-hidden\">\n        <div className=\"h-full max-w-screen-xl mx-auto px-6 py-6\">\n          <div className=\"h-full grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <div className=\"lg:col-span-1 space-y-4 overflow-y-auto\">\n              <Card data-testid=\"card-day-info\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    <Target className=\"h-5 w-5\" />\n                    Day {currentDay}: {currentDayData?.theme}\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"space-y-3\">\n                    {currentDayData?.activities?.map((activity: string, idx: number) => (\n                      <div key={idx} className=\"flex items-start gap-2 text-sm\">\n                        <CheckCircle2 className={`h-4 w-4 mt-0.5 ${\n                          (idx === 0 && docsRead) ||\n                          (idx === 1 && allTeamMet) ||\n                          (idx === 2 && comprehensionComplete)\n                            ? 'text-green-600'\n                            : 'text-gray-300'\n                        }`} />\n                        <span className=\"text-gray-700\">{activity}</span>\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n\n              <Card data-testid=\"card-learning-objectives\">\n                <CardHeader>\n                  <CardTitle className=\"text-lg flex items-center gap-2\">\n                    <BookOpen className=\"h-5 w-5\" />\n                    Learning Objectives\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <ul className=\"space-y-2\">\n                    {requirements.learningObjectives?.slice(0, 3).map((obj: string, idx: number) => (\n                      <li key={idx} className=\"flex items-start gap-2 text-sm text-gray-700\">\n                        <span className=\"text-blue-600 font-bold mt-0.5\"></span>\n                        <span>{obj}</span>\n                      </li>\n                    ))}\n                  </ul>\n                </CardContent>\n              </Card>\n\n              {viewMode !== 'overview' && (\n                <Button \n                  variant=\"outline\" \n                  className=\"w-full\"\n                  onClick={() => {\n                    setViewMode('overview');\n                    setSelectedMember(null);\n                  }}\n                  data-testid=\"button-back-to-overview\"\n                >\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Back to Overview\n                </Button>\n              )}\n            </div>\n\n            <div className=\"lg:col-span-2 flex flex-col h-full overflow-hidden\">\n              <Card className=\"flex-1 flex flex-col overflow-hidden\">\n                <CardContent className=\"flex-1 overflow-y-auto p-6\">\n                  {viewMode === 'overview' && currentDay === 1 && renderOverview()}\n                  {viewMode === 'overview' && currentDay === 2 && renderDay2Overview()}\n                  {viewMode === 'team-intro' && renderTeamIntroView()}\n                  {viewMode === 'documentation' && renderDocumentation()}\n                  {viewMode === 'comprehension-check' && renderComprehensionCheck()}\n                  {viewMode === 'day2-standup' && renderDay2Standup()}\n                  {viewMode === 'day2-dev-setup' && renderDay2DevSetup()}\n                  {viewMode === 'day2-ticket' && renderDay2Ticket()}\n                  {viewMode === 'day2-branch' && renderDay2CreateBranch()}\n                  {viewMode === 'day2-codebase' && renderDay2Codebase()}\n                  {viewMode === 'day2-code-fix' && renderDay2CodeFix()}\n                  {viewMode === 'day2-test-fix' && renderDay2TestFix()}\n                  {viewMode === 'day2-git' && renderDay2Git()}\n                  {viewMode === 'day2-pr' && renderDay2PR()}\n                  {viewMode === 'day2-reflection' && renderDay2Reflection()}\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Day 1 Complete Dialog - triggered after comprehension check */}\n      <Dialog open={showDay2Preview} onOpenChange={setShowDay2Preview}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Sparkles className=\"h-5 w-5 text-green-500\" />\n              Day 1 Complete!\n            </DialogTitle>\n            <DialogDescription>\n              Great job! You've completed your first day at NovaPay.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 py-4\">\n            <Card className=\"bg-green-50 border-green-200\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <CheckCircle2 className=\"h-6 w-6 text-green-600\" />\n                  <div>\n                    <p className=\"font-semibold text-green-900\">What you accomplished today:</p>\n                    <ul className=\"text-sm text-green-800 mt-2 space-y-1\">\n                      <li> Read through onboarding documentation</li>\n                      <li> Met all your teammates</li>\n                      <li> Checked in with Sarah</li>\n                    </ul>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <Card className=\"bg-orange-50 border-orange-200\">\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <Bug className=\"h-6 w-6 text-orange-600\" />\n                  <div>\n                    <p className=\"font-semibold text-orange-900\">Coming up on Day 2:</p>\n                    <p className=\"text-sm text-orange-800 mt-1\">\n                      Your first ticket! Fix the timezone display bug so merchants see times in their local timezone.\n                    </p>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            <div className=\"p-3 bg-blue-50 rounded-lg\">\n              <p className=\"text-sm text-blue-800\">\n                <strong>Pro tip:</strong> If you get stuck tomorrow, message Sarah or check the codebase for similar date handling patterns.\n              </p>\n            </div>\n          </div>\n\n          <DialogFooter className=\"flex gap-2 sm:gap-2\">\n            <Button variant=\"outline\" onClick={() => {\n              setShowDay2Preview(false);\n              setViewMode('overview');\n            }} data-testid=\"button-wrap-up\">\n              <Clock className=\"h-4 w-4 mr-2\" />\n              Wrap Up for Today\n            </Button>\n            <Button onClick={() => {\n              setShowDay2Preview(false);\n              setCurrentDay(2);\n              setViewMode('overview');\n            }} data-testid=\"button-start-day2\">\n              <Rocket className=\"h-4 w-4 mr-2\" />\n              Start Day 2\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* All Team Intros Complete Dialog */}\n      <Dialog open={showAllIntrosComplete} onOpenChange={(open) => {\n        setShowAllIntrosComplete(open);\n        if (!open) setIntrosDialogDismissed(true);\n      }}>\n        <DialogContent className=\"max-w-md\">\n          <DialogHeader>\n            <div className=\"flex flex-col items-center text-center\">\n              <div className=\"w-16 h-16 bg-gradient-to-br from-green-400 to-emerald-500 rounded-full flex items-center justify-center mb-4 shadow-lg\">\n                <Users className=\"h-8 w-8 text-white\" />\n              </div>\n              <DialogTitle className=\"text-xl\">You've Met the Team!</DialogTitle>\n              <DialogDescription className=\"mt-2\">\n                Great job! You've introduced yourself to all your teammates. They're excited to work with you!\n              </DialogDescription>\n            </div>\n          </DialogHeader>\n          \n          <div className=\"space-y-3 my-4\">\n            <div className=\"flex flex-wrap justify-center gap-2\">\n              {teamMembers.filter((m: TeamMember) => m.name !== 'Sarah').map((member: TeamMember, idx: number) => (\n                <div key={idx} className=\"flex items-center gap-2 bg-gray-50 rounded-full pl-1 pr-3 py-1\">\n                  <Avatar className=\"h-6 w-6\">\n                    <AvatarImage src={getTeamAvatarUrl(member.name)} alt={member.name} />\n                    <AvatarFallback className={`text-white text-xs ${getTeamMemberColor(member.name)}`}>\n                      {getTeamMemberInitials(member.name)}\n                    </AvatarFallback>\n                  </Avatar>\n                  <span className=\"text-sm font-medium\">{member.name}</span>\n                  <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                </div>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"p-3 bg-blue-50 rounded-lg\">\n            <p className=\"text-sm text-blue-800\">\n              <strong>Next up:</strong> Sarah wants to do a quick comprehension check to make sure you're ready for tomorrow.\n            </p>\n          </div>\n\n          <DialogFooter className=\"flex gap-2 sm:gap-2 mt-4\">\n            <Button \n              variant=\"outline\" \n              onClick={() => {\n                setShowAllIntrosComplete(false);\n                setIntrosDialogDismissed(true);\n                setSelectedMember(null);\n                setViewMode('overview');\n              }}\n              data-testid=\"button-back-to-overview\"\n            >\n              Back to Overview\n            </Button>\n            <Button \n              className=\"bg-green-600 hover:bg-green-700\"\n              onClick={() => {\n                setShowAllIntrosComplete(false);\n                setIntrosDialogDismissed(true);\n                setSelectedMember(null);\n                setViewMode('comprehension-check');\n              }}\n              data-testid=\"button-go-to-comprehension\"\n            >\n              <MessageSquare className=\"h-4 w-4 mr-2\" />\n              Chat with Sarah\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      {/* Floating Team Chat - hidden during structured conversations */}\n      {/* Hide during: team-intro (has its own chat), comprehension-check (Sarah chat), day2-standup (Sarah chat) */}\n      {!['team-intro', 'comprehension-check', 'day2-standup'].includes(viewMode) && (\n        <FloatingTeamChat\n          isOpen={floatingChatOpen}\n          onToggle={handleFloatingChatToggle}\n          teamMembers={teamMembers}\n          activeChatMember={floatingChatMember}\n          onSelectMember={setFloatingChatMember}\n          message={floatingChatMessage}\n          onMessageChange={setFloatingChatMessage}\n          onSendMessage={handleFloatingChatSend}\n          isSending={floatingChatMutation.isPending}\n          interactions={Array.isArray(interactions) ? interactions : []}\n          typingIndicator={floatingTypingIndicator}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":179426,"size_tokens":null},"client/src/pages/workspace-journey.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Rocket, \n  Users, \n  Clock, \n  Play, \n  RotateCcw, \n  ChevronRight,\n  Calendar,\n  CheckCircle2,\n  Circle,\n  Lock,\n  Briefcase,\n  ArrowRight\n} from \"lucide-react\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport InternOnboardingSession from \"@/components/simulation/intern-onboarding-session\";\n\nexport default function WorkspaceJourney() {\n  const [, navigate] = useLocation();\n  const [activeSession, setActiveSession] = useState<any>(null);\n  const [selectedProject, setSelectedProject] = useState<any>(null);\n  const [showRestartDialog, setShowRestartDialog] = useState(false);\n  const [sessionToRestart, setSessionToRestart] = useState<any>(null);\n\n  const { data: user } = useQuery({\n    queryKey: ['/api/user'],\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery({\n    queryKey: ['/api/workspace/projects'],\n  });\n\n  const { data: progressData, isLoading: progressLoading } = useQuery({\n    queryKey: [`/api/workspace/progress/${(user as any)?.id}/journey`],\n    enabled: !!(user as any)?.id,\n  });\n\n  // Fetch user's accepted job applications to gate workspace access\n  const { data: applications = [], isLoading: applicationsLoading } = useQuery<any[]>({\n    queryKey: [`/api/users/${(user as any)?.id}/applications`],\n    enabled: !!(user as any)?.id,\n  });\n\n  // Filter to only accepted applications\n  const acceptedApplications = applications.filter((app: any) => app.status === 'accepted');\n\n  const createSessionMutation = useMutation({\n    mutationFn: async (config: any) => {\n      const response = await apiRequest(\"POST\", \"/api/sessions\", config);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Don't set activeSession here - let handleStartJourney do it after progress is created\n      queryClient.invalidateQueries({ \n        predicate: (query) => (query.queryKey[0] as string)?.startsWith('/api/workspace/progress')\n      });\n    },\n  });\n\n  const restartSessionMutation = useMutation({\n    mutationFn: async (sessionId: number) => {\n      const response = await apiRequest(\"POST\", `/api/workspace/progress/${sessionId}/restart`);\n      return response.json();\n    },\n    onSuccess: (session) => {\n      setActiveSession(session);\n      setShowRestartDialog(false);\n      setSessionToRestart(null);\n      queryClient.invalidateQueries({ \n        predicate: (query) => (query.queryKey[0] as string)?.startsWith('/api/workspace/progress')\n      });\n    },\n  });\n\n  const handleStartJourney = async (project: any) => {\n    if (!user) return;\n\n    // Check if there's already an existing journey for this project\n    const existingProgress = Array.isArray(progressData) \n      ? progressData.find((p: any) => \n          p.projectId === project.id && \n          p.mode === 'journey' &&\n          p.status === 'in_progress'\n        )\n      : null;\n\n    if (existingProgress) {\n      // Resume existing journey instead of creating a new one\n      handleResumeSession(existingProgress, project);\n      return;\n    }\n\n    const session = await createSessionMutation.mutateAsync({\n      userId: (user as any).id,\n      type: 'workspace',\n      status: 'active',\n      configuration: {\n        projectId: project.id,\n        projectName: project.name,\n        projectCategory: project.category,\n        projectDescription: project.description,\n        activeRole: 'Developer',\n        sprintPhase: 'onboarding',\n        teamMembers: project.teamStructure,\n        duration: project.estimatedDuration,\n        requirements: project.requirements,\n        scenarioScript: project.scenarioScript,\n        mode: 'journey'\n      },\n      messages: []\n    });\n    \n    // Save initial progress record BEFORE setting activeSession\n    // This ensures the component receives savedProgressId at mount time\n    try {\n      const progressResponse = await apiRequest(\"POST\", \"/api/workspace/progress\", {\n        sessionId: session.id,\n        userId: (user as any).id,\n        projectId: project.id,\n        role: 'Developer',\n        mode: 'journey',\n        currentDay: 1,\n        dayProgress: {},\n        overallProgress: 0,\n        status: 'in_progress'\n      });\n      const savedProgress = await progressResponse.json();\n      \n      // Set project first, then activeSession with savedProgressId included\n      setSelectedProject(project);\n      setActiveSession({\n        ...session,\n        configuration: {\n          ...session.configuration,\n          savedProgressId: savedProgress.id\n        }\n      });\n    } catch (error) {\n      console.error('Failed to save initial progress:', error);\n      // Still set the session even if progress save fails\n      setSelectedProject(project);\n      setActiveSession(session);\n    }\n  };\n\n  const handleResumeSession = (progress: any, project: any) => {\n    setSelectedProject(project);\n    setActiveSession({\n      id: progress.sessionId,\n      configuration: {\n        projectId: project.id,\n        projectName: project.name,\n        projectCategory: project.category,\n        projectDescription: project.description,\n        activeRole: progress.role,\n        sprintPhase: 'onboarding',\n        teamMembers: project.teamStructure,\n        duration: project.estimatedDuration,\n        requirements: project.requirements,\n        scenarioScript: project.scenarioScript,\n        mode: 'journey',\n        savedProgress: progress.dayProgress,\n        savedProgressId: progress.id,\n        currentDay: progress.currentDay\n      }\n    });\n  };\n\n  const handleRestartClick = (progress: any) => {\n    setSessionToRestart(progress);\n    setShowRestartDialog(true);\n  };\n\n  const handleConfirmRestart = () => {\n    if (sessionToRestart) {\n      restartSessionMutation.mutate(sessionToRestart.sessionId);\n    }\n  };\n\n  const handleSessionComplete = () => {\n    setActiveSession(null);\n    setSelectedProject(null);\n    queryClient.invalidateQueries({ \n      predicate: (query) => (query.queryKey[0] as string)?.startsWith('/api/workspace/progress')\n    });\n  };\n\n  const getDayStatus = (currentDay: number, dayNumber: number) => {\n    if (dayNumber < currentDay) return 'completed';\n    if (dayNumber === currentDay) return 'current';\n    return 'locked';\n  };\n\n  if (activeSession) {\n    const config = activeSession.configuration;\n    const isInternOnboarding = config?.projectCategory === 'intern-onboarding' || \n                               selectedProject?.category === 'intern-onboarding';\n    \n    const projectData = selectedProject || {\n      id: config?.projectId,\n      name: config?.projectName,\n      description: config?.projectDescription,\n      category: config?.projectCategory,\n      teamStructure: config?.teamMembers,\n      estimatedDuration: config?.duration,\n      requirements: config?.requirements || {},\n      scenarioScript: config?.scenarioScript || {}\n    };\n    \n    if (isInternOnboarding) {\n      return (\n        <InternOnboardingSession\n          session={activeSession}\n          project={projectData}\n          onComplete={handleSessionComplete}\n          mode=\"journey\"\n          savedProgress={config?.savedProgress}\n          savedProgressId={config?.savedProgressId}\n          initialDay={config?.currentDay}\n          user={user}\n        />\n      );\n    }\n    \n    return null;\n  }\n\n  const inProgressJourneys = Array.isArray(progressData) \n    ? progressData.filter((p: any) => p.mode === 'journey' && p.status === 'in_progress')\n    : [];\n\n  const journeyProjects = Array.isArray(projects) \n    ? projects.filter((p: any) => p.category === 'intern-onboarding')\n    : [];\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-5xl mx-auto\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"p-2 bg-blue-100 rounded-lg\">\n              <Rocket className=\"h-6 w-6 text-blue-600\" />\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900\" data-testid=\"text-workspace-journey-title\">\n              Workspace Journey\n            </h1>\n          </div>\n          <p className=\"text-gray-600 mt-2\">\n            Experience the complete 5-day onboarding journey. One company, start to finish.\n          </p>\n        </div>\n\n        {inProgressJourneys.length > 0 && (\n          <div className=\"mb-8\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Continue Your Journey</h2>\n            <div className=\"space-y-4\">\n              {inProgressJourneys.map((progress: any) => {\n                const project = journeyProjects.find((p: any) => p.id === progress.projectId);\n                if (!project) return null;\n                \n                return (\n                  <Card key={progress.id} className=\"border-blue-200 bg-gradient-to-r from-blue-50 to-indigo-50\">\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-3 mb-2\">\n                            <h3 className=\"text-lg font-semibold text-gray-900\">{project.name}</h3>\n                            <Badge className=\"bg-amber-100 text-amber-800\">In Progress</Badge>\n                          </div>\n                          <p className=\"text-sm text-gray-600 mb-3\">\n                            Day {progress.currentDay} of 5  {progress.role}\n                          </p>\n                          <div className=\"flex items-center gap-4\">\n                            <div className=\"flex-1 max-w-xs\">\n                              <Progress value={progress.overallProgress} className=\"h-2\" />\n                            </div>\n                            <span className=\"text-sm font-medium text-gray-700\">\n                              {progress.overallProgress}% complete\n                            </span>\n                          </div>\n                          <div className=\"flex gap-5 mt-4\">\n                            {[1, 2, 3, 4, 5].map((day) => {\n                              const status = getDayStatus(progress.currentDay, day);\n                              return (\n                                <div key={day} className=\"flex items-center gap-1.5\">\n                                  {status === 'completed' ? (\n                                    <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                                  ) : status === 'current' ? (\n                                    <div className=\"h-4 w-4 rounded-full border-2 border-blue-600 bg-blue-100\" />\n                                  ) : (\n                                    <Circle className=\"h-4 w-4 text-gray-300\" />\n                                  )}\n                                  <span className={`text-xs ${status === 'current' ? 'text-blue-600 font-medium' : status === 'completed' ? 'text-green-600' : 'text-gray-400'}`}>\n                                    Day {day}\n                                  </span>\n                                </div>\n                              );\n                            })}\n                          </div>\n                        </div>\n                        <div className=\"flex gap-3\">\n                          <Button\n                            variant=\"outline\"\n                            size=\"sm\"\n                            onClick={() => handleRestartClick(progress)}\n                            data-testid={`button-restart-${progress.id}`}\n                          >\n                            <RotateCcw className=\"h-4 w-4 mr-2\" />\n                            Start Over\n                          </Button>\n                          <Button\n                            onClick={() => handleResumeSession(progress, project)}\n                            data-testid={`button-resume-${progress.id}`}\n                          >\n                            <Play className=\"h-4 w-4 mr-2\" />\n                            Continue Day {progress.currentDay}\n                          </Button>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {/* Only show \"Start a New Journey\" section if no active journeys - Journey mode is one company at a time */}\n        {inProgressJourneys.length === 0 && (\n          <div>\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">\n              Choose Your Journey\n            </h2>\n          \n            {projectsLoading || applicationsLoading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 mx-auto\"></div>\n              <p className=\"mt-4 text-gray-600\">Loading journeys...</p>\n            </div>\n          ) : acceptedApplications.length === 0 ? (\n            // No accepted offers - show locked state with guidance\n            <Card className=\"border-gray-200 bg-gray-50\">\n              <CardContent className=\"p-8\">\n                <div className=\"text-center\">\n                  <div className=\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                    <Lock className=\"h-8 w-8 text-gray-400\" />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">\n                    Complete Your Job Journey First\n                  </h3>\n                  <p className=\"text-gray-600 mb-6 max-w-md mx-auto\">\n                    The Workspace Journey unlocks after you've successfully completed the interview process and accepted a job offer.\n                  </p>\n                  \n                  <div className=\"flex flex-col sm:flex-row items-center justify-center gap-3 mb-8\">\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                      <div className=\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center\">\n                        <span className=\"text-xs font-medium text-blue-600\">1</span>\n                      </div>\n                      <span>Apply for jobs</span>\n                    </div>\n                    <ArrowRight className=\"h-4 w-4 text-gray-300 hidden sm:block\" />\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                      <div className=\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center\">\n                        <span className=\"text-xs font-medium text-blue-600\">2</span>\n                      </div>\n                      <span>Pass interviews</span>\n                    </div>\n                    <ArrowRight className=\"h-4 w-4 text-gray-300 hidden sm:block\" />\n                    <div className=\"flex items-center gap-2 text-sm text-gray-500\">\n                      <div className=\"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center\">\n                        <span className=\"text-xs font-medium text-blue-600\">3</span>\n                      </div>\n                      <span>Accept offer</span>\n                    </div>\n                    <ArrowRight className=\"h-4 w-4 text-gray-300 hidden sm:block\" />\n                    <div className=\"flex items-center gap-2 text-sm text-green-600 font-medium\">\n                      <div className=\"w-6 h-6 rounded-full bg-green-100 flex items-center justify-center\">\n                        <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                      </div>\n                      <span>Start onboarding</span>\n                    </div>\n                  </div>\n                  \n                  <Button onClick={() => navigate('/jobs')} data-testid=\"button-go-to-jobs\">\n                    <Briefcase className=\"h-4 w-4 mr-2\" />\n                    Browse Job Openings\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-6\">\n              {journeyProjects.map((project: any) => {\n                const hasActiveJourney = inProgressJourneys.some((p: any) => p.projectId === project.id);\n                // Check if user has an accepted offer that matches this project's company\n                // For NovaPay projects, check if any accepted application is for NovaPay\n                const projectCompanyName = project.name.toLowerCase();\n                const hasMatchingOffer = acceptedApplications.some((app: any) => \n                  app.job?.company?.name?.toLowerCase().includes('novapay') && projectCompanyName.includes('novapay')\n                );\n                \n                if (!hasMatchingOffer) return null;\n                \n                return (\n                  <Card \n                    key={project.id} \n                    className={`transition-all ${hasActiveJourney ? 'opacity-60' : 'hover:shadow-lg cursor-pointer'}`}\n                    data-testid={`card-journey-${project.id}`}\n                  >\n                    <CardContent className=\"p-6\">\n                      <div className=\"flex items-start gap-6\">\n                        <div className=\"p-4 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl\">\n                          <Users className=\"h-8 w-8 text-blue-600\" />\n                        </div>\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-start justify-between\">\n                            <div>\n                              <h3 className=\"text-xl font-semibold text-gray-900 mb-1\">{project.name}</h3>\n                              <p className=\"text-gray-600 mb-4\">{project.description}</p>\n                            </div>\n                            <Badge className=\"bg-blue-100 text-blue-800\">\n                              {project.difficulty}\n                            </Badge>\n                          </div>\n                          \n                          <div className=\"flex items-center gap-6 text-sm text-gray-600 mb-4\">\n                            <div className=\"flex items-center gap-2\">\n                              <Calendar className=\"h-4 w-4\" />\n                              <span>5 Days</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Clock className=\"h-4 w-4\" />\n                              <span>~{project.estimatedDuration} min total</span>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                              <Users className=\"h-4 w-4\" />\n                              <span>{project.teamStructure?.length || 0} team members</span>\n                            </div>\n                          </div>\n\n                          <div className=\"flex items-center gap-2 mb-4\">\n                            <span className=\"text-sm font-medium text-gray-700\">Role:</span>\n                            <Badge variant=\"outline\">Developer</Badge>\n                          </div>\n\n                          {!hasActiveJourney && (\n                            <Button \n                              onClick={() => handleStartJourney(project)}\n                              disabled={createSessionMutation.isPending}\n                              data-testid={`button-start-journey-${project.id}`}\n                            >\n                              {createSessionMutation.isPending ? (\n                                'Starting...'\n                              ) : (\n                                <>\n                                  Start Journey\n                                  <ChevronRight className=\"h-4 w-4 ml-2\" />\n                                </>\n                              )}\n                            </Button>\n                          )}\n                          \n                          {hasActiveJourney && (\n                            <p className=\"text-sm text-amber-600 font-medium\">\n                              You have an active journey for this project. Continue or restart above.\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n\n              {journeyProjects.length === 0 && !projectsLoading && (\n                <Card className=\"p-12 text-center\">\n                  <div className=\"mx-auto w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4\">\n                    <Rocket className=\"h-8 w-8 text-gray-400\" />\n                  </div>\n                  <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No Journeys Available</h3>\n                  <p className=\"text-gray-600\">Check back soon for new workspace journeys.</p>\n                </Card>\n              )}\n            </div>\n          )}\n          </div>\n        )}\n      </div>\n\n      <AlertDialog open={showRestartDialog} onOpenChange={setShowRestartDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Start Over?</AlertDialogTitle>\n            <AlertDialogDescription>\n              This will reset all your progress for this journey. You'll start from Day 1 again. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmRestart}\n              className=\"bg-red-600 hover:bg-red-700\"\n            >\n              Yes, Start Over\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":22409,"size_tokens":null},"client/src/pages/workspace-practice.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  Target, \n  Users, \n  Clock, \n  Play, \n  RotateCcw,\n  ChevronRight,\n  ChevronLeft,\n  Calendar,\n  Code,\n  FileText,\n  GitBranch,\n  MessageSquare,\n  Lock,\n  CheckCircle2,\n  Building2,\n  MoreVertical,\n  Briefcase,\n  TestTube,\n  Server,\n  Database,\n  Loader2\n} from \"lucide-react\";\nimport { useAvailableRoles, type AvailableRole } from \"@/hooks/use-adapters\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport InternOnboardingSession from \"@/components/simulation/intern-onboarding-session\";\n\ntype WizardStep = 'project' | 'role' | 'scenario';\n\ninterface Scenario {\n  id: string;\n  day: number;\n  title: string;\n  description: string;\n  skills: string[];\n  duration: string;\n  icon: any;\n  available: boolean;\n  prerequisite?: string;\n}\n\nconst SCENARIOS: Scenario[] = [\n  {\n    id: 'day-1',\n    day: 1,\n    title: 'Day 1: Onboarding',\n    description: 'Meet your team, read project docs, and have your first check-in',\n    skills: ['Team Communication', 'Documentation', 'Active Listening'],\n    duration: '~45 min',\n    icon: Users,\n    available: true\n  },\n  {\n    id: 'day-2',\n    day: 2,\n    title: 'Day 2: First Ticket',\n    description: 'Fix your first bug, learn Git workflow, and submit a PR',\n    skills: ['Git', 'Code Review', 'Problem Solving'],\n    duration: '~30 min',\n    icon: GitBranch,\n    available: true\n  },\n  {\n    id: 'day-3',\n    day: 3,\n    title: 'Day 3: Code Review',\n    description: 'Respond to PR feedback and revise your code',\n    skills: ['Code Quality', 'Feedback', 'Iteration'],\n    duration: '~25 min',\n    icon: Code,\n    available: false,\n    prerequisite: 'Complete Day 2 first'\n  },\n  {\n    id: 'day-4',\n    day: 4,\n    title: 'Day 4: Documentation',\n    description: 'Write a README section and receive feedback',\n    skills: ['Technical Writing', 'Documentation', 'Clarity'],\n    duration: '~20 min',\n    icon: FileText,\n    available: false,\n    prerequisite: 'Complete Day 3 first'\n  },\n  {\n    id: 'day-5',\n    day: 5,\n    title: 'Day 5: Bug Fix & Wrap-up',\n    description: 'Fix an edge case bug and complete your final evaluation',\n    skills: ['Debugging', 'Testing', 'Self-Reflection'],\n    duration: '~30 min',\n    icon: MessageSquare,\n    available: false,\n    prerequisite: 'Complete Day 4 first'\n  }\n];\n\nexport default function WorkspacePractice() {\n  const [activeSession, setActiveSession] = useState<any>(null);\n  const [selectedProject, setSelectedProject] = useState<any>(null);\n  const [wizardStep, setWizardStep] = useState<WizardStep>('project');\n  const [selectedRole, setSelectedRole] = useState<string>('');\n  const [selectedScenario, setSelectedScenario] = useState<Scenario | null>(null);\n\n  const { data: user } = useQuery({\n    queryKey: ['/api/user'],\n  });\n\n  const { data: projects, isLoading: projectsLoading } = useQuery({\n    queryKey: ['/api/workspace/projects'],\n  });\n\n  const { data: progressData, isLoading: progressLoading } = useQuery({\n    queryKey: [`/api/workspace/progress/${(user as any)?.id}/practice`],\n    enabled: !!(user as any)?.id,\n  });\n\n  const { data: adapterRoles = [], isLoading: rolesLoading } = useAvailableRoles();\n\n  const roleIconMap: Record<string, any> = {\n    developer: Code,\n    pm: Briefcase,\n    qa: TestTube,\n    devops: Server,\n    data_science: Database,\n  };\n\n  const availableRoles = useMemo(() => {\n    if (adapterRoles.length === 0) {\n      return [\n        { name: 'Developer', role: 'developer', available: true, description: 'Write code, fix bugs, and collaborate with your team', icon: Code },\n        { name: 'Product Manager', role: 'pm', available: false, description: 'Coming soon', icon: Briefcase },\n        { name: 'Designer', role: 'designer', available: false, description: 'Coming soon', icon: Briefcase }\n      ];\n    }\n    return adapterRoles.map((role: AvailableRole) => ({\n      name: role.displayName,\n      role: role.role,\n      available: role.role === 'developer',\n      description: role.role === 'developer' ? role.description : 'Coming soon in Phase 5',\n      icon: roleIconMap[role.role] || Code\n    }));\n  }, [adapterRoles]);\n\n  const createSessionMutation = useMutation({\n    mutationFn: async (config: any) => {\n      const response = await apiRequest(\"POST\", \"/api/sessions\", config);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Don't set activeSession here - let handleStartPractice do it after progress is created\n      queryClient.invalidateQueries({ \n        predicate: (query) => (query.queryKey[0] as string)?.startsWith('/api/workspace/progress')\n      });\n    },\n  });\n\n  const handleSelectProject = (project: any) => {\n    setSelectedProject(project);\n    setWizardStep('role');\n  };\n\n  const handleSelectRole = (role: string) => {\n    setSelectedRole(role);\n    setWizardStep('scenario');\n  };\n\n  const handleSelectScenario = (scenario: Scenario) => {\n    if (!scenario.available) return;\n    setSelectedScenario(scenario);\n  };\n\n  const handleStartPractice = async () => {\n    if (!selectedProject || !selectedRole || !selectedScenario || !user) return;\n\n    // Check if there's already an existing session with the same project, role, and day\n    const existingProgress = Array.isArray(progressData) \n      ? progressData.find((p: any) => \n          p.projectId === selectedProject.id && \n          p.role === selectedRole && \n          p.currentDay === selectedScenario.day &&\n          p.mode === 'practice' &&\n          p.status === 'in_progress'\n        )\n      : null;\n\n    if (existingProgress) {\n      // Resume existing session instead of creating a new one\n      handleResumePractice(existingProgress, selectedProject);\n      return;\n    }\n\n    const session = await createSessionMutation.mutateAsync({\n      userId: (user as any).id,\n      type: 'workspace',\n      status: 'active',\n      configuration: {\n        projectId: selectedProject.id,\n        projectName: selectedProject.name,\n        projectCategory: selectedProject.category,\n        projectDescription: selectedProject.description,\n        activeRole: selectedRole,\n        sprintPhase: 'onboarding',\n        teamMembers: selectedProject.teamStructure,\n        duration: selectedProject.estimatedDuration,\n        requirements: selectedProject.requirements,\n        scenarioScript: selectedProject.scenarioScript,\n        mode: 'practice',\n        scenarioId: selectedScenario.id,\n        startDay: selectedScenario.day\n      },\n      messages: []\n    });\n\n    // Save initial progress record BEFORE setting activeSession\n    // This ensures the component receives savedProgressId at mount time\n    try {\n      const progressResponse = await apiRequest(\"POST\", \"/api/workspace/progress\", {\n        sessionId: session.id,\n        userId: (user as any).id,\n        projectId: selectedProject.id,\n        role: selectedRole,\n        mode: 'practice',\n        currentDay: selectedScenario.day,\n        scenarioId: selectedScenario.id,\n        dayProgress: {},\n        overallProgress: 0,\n        status: 'in_progress'\n      });\n      const savedProgress = await progressResponse.json();\n      \n      // Set activeSession with savedProgressId included\n      setActiveSession({\n        ...session,\n        configuration: {\n          ...session.configuration,\n          savedProgressId: savedProgress.id\n        }\n      });\n    } catch (error) {\n      console.error('Failed to save initial progress:', error);\n      // Still set the session even if progress save fails\n      setActiveSession(session);\n    }\n  };\n\n  const handleResumePractice = (progress: any, project: any) => {\n    setSelectedProject(project);\n    setActiveSession({\n      id: progress.sessionId,\n      configuration: {\n        projectId: project.id,\n        projectName: project.name,\n        projectCategory: project.category,\n        projectDescription: project.description,\n        activeRole: progress.role,\n        sprintPhase: 'onboarding',\n        teamMembers: project.teamStructure,\n        duration: project.estimatedDuration,\n        requirements: project.requirements,\n        scenarioScript: project.scenarioScript,\n        mode: 'practice',\n        scenarioId: progress.scenarioId,\n        savedProgress: progress.dayProgress,\n        savedProgressId: progress.id,\n        currentDay: progress.currentDay\n      }\n    });\n  };\n\n  const handleSessionComplete = () => {\n    setActiveSession(null);\n    setSelectedProject(null);\n    setSelectedRole('');\n    setSelectedScenario(null);\n    setWizardStep('project');\n    queryClient.invalidateQueries({ \n      predicate: (query) => (query.queryKey[0] as string)?.startsWith('/api/workspace/progress')\n    });\n  };\n\n  const handleBack = () => {\n    if (wizardStep === 'role') {\n      setWizardStep('project');\n      setSelectedProject(null);\n    } else if (wizardStep === 'scenario') {\n      setWizardStep('role');\n      setSelectedRole('');\n    }\n  };\n\n  if (activeSession) {\n    const config = activeSession.configuration;\n    const isInternOnboarding = config?.projectCategory === 'intern-onboarding';\n    \n    const projectData = selectedProject || {\n      id: config?.projectId,\n      name: config?.projectName,\n      description: config?.projectDescription,\n      category: config?.projectCategory,\n      teamStructure: config?.teamMembers,\n      estimatedDuration: config?.duration,\n      requirements: config?.requirements || {},\n      scenarioScript: config?.scenarioScript || {}\n    };\n    \n    if (isInternOnboarding) {\n      return (\n        <InternOnboardingSession\n          session={activeSession}\n          project={projectData}\n          onComplete={handleSessionComplete}\n          mode=\"practice\"\n          savedProgress={config?.savedProgress}\n          savedProgressId={config?.savedProgressId}\n          initialDay={config?.currentDay || config?.startDay}\n        />\n      );\n    }\n    \n    return null;\n  }\n\n  const practiceProjects = Array.isArray(projects) \n    ? projects.filter((p: any) => p.category === 'intern-onboarding')\n    : [];\n\n  const practiceSessions = Array.isArray(progressData) \n    ? progressData.filter((p: any) => p.mode === 'practice')\n    : [];\n\n  const inProgressSessions = practiceSessions.filter((p: any) => p.status === 'in_progress');\n  const completedSessions = practiceSessions.filter((p: any) => p.status === 'completed');\n\n  const renderWizardSteps = () => (\n    <div className=\"flex items-center justify-center mb-8\">\n      <div className=\"flex items-center gap-4\">\n        <div className={`flex items-center gap-2 ${wizardStep === 'project' ? 'text-teal-600' : 'text-gray-400'}`}>\n          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n            wizardStep === 'project' ? 'bg-teal-600 text-white' : \n            selectedProject ? 'bg-teal-100 text-teal-600 border border-teal-600' : 'bg-gray-200 text-gray-500'\n          }`}>\n            {selectedProject ? '' : '1'}\n          </div>\n          <span className=\"font-medium\">Project</span>\n        </div>\n        \n        <div className=\"w-12 h-0.5 bg-gray-200\" />\n        \n        <div className={`flex items-center gap-2 ${wizardStep === 'role' ? 'text-teal-600' : 'text-gray-400'}`}>\n          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n            wizardStep === 'role' ? 'bg-teal-600 text-white' : \n            selectedRole ? 'bg-teal-100 text-teal-600 border border-teal-600' : 'bg-gray-200 text-gray-500'\n          }`}>\n            {selectedRole ? '' : '2'}\n          </div>\n          <span className=\"font-medium\">Role</span>\n        </div>\n        \n        <div className=\"w-12 h-0.5 bg-gray-200\" />\n        \n        <div className={`flex items-center gap-2 ${wizardStep === 'scenario' ? 'text-teal-600' : 'text-gray-400'}`}>\n          <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n            wizardStep === 'scenario' ? 'bg-teal-600 text-white' : 'bg-gray-200 text-gray-500'\n          }`}>\n            3\n          </div>\n          <span className=\"font-medium\">Scenario</span>\n        </div>\n      </div>\n    </div>\n  );\n\n  const renderProjectStep = () => (\n    <div>\n      <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Select a Project</h2>\n      {projectsLoading ? (\n        <div className=\"text-center py-12\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-teal-600 mx-auto\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading projects...</p>\n        </div>\n      ) : (\n        <div className=\"grid md:grid-cols-2 gap-4\">\n          {practiceProjects.map((project: any) => (\n            <Card \n              key={project.id}\n              className={`cursor-pointer transition-all hover:shadow-lg ${\n                selectedProject?.id === project.id ? 'ring-2 ring-teal-500 shadow-lg bg-teal-50/30' : ''\n              }`}\n              onClick={() => handleSelectProject(project)}\n              data-testid={`card-practice-project-${project.id}`}\n            >\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"p-3 bg-teal-100 rounded-xl\">\n                    <Building2 className=\"h-6 w-6 text-teal-600\" />\n                  </div>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center justify-between mb-1\">\n                      <h3 className=\"font-semibold text-gray-900\">{project.name}</h3>\n                      <Badge className=\"bg-blue-100 text-blue-800\">{project.difficulty}</Badge>\n                    </div>\n                    <p className=\"text-sm text-gray-600 mb-3\">{project.description}</p>\n                    <div className=\"flex items-center gap-4 text-xs text-gray-500\">\n                      <span className=\"flex items-center gap-1\">\n                        <Users className=\"h-3 w-3\" />\n                        {project.teamStructure?.length || 0} team\n                      </span>\n                      <span className=\"flex items-center gap-1\">\n                        <Calendar className=\"h-3 w-3\" />\n                        5 days\n                      </span>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n\n          {practiceProjects.length === 0 && (\n            <Card className=\"col-span-2 p-8 text-center\">\n              <Target className=\"h-12 w-12 text-gray-300 mx-auto mb-4\" />\n              <h3 className=\"font-medium text-gray-900 mb-2\">No Projects Available</h3>\n              <p className=\"text-gray-600\">Check back soon for practice projects.</p>\n            </Card>\n          )}\n        </div>\n      )}\n    </div>\n  );\n\n  const renderRoleStep = () => (\n    <div>\n      <Button variant=\"ghost\" size=\"sm\" onClick={handleBack} className=\"mb-4\">\n        <ChevronLeft className=\"h-4 w-4 mr-1\" />\n        Back\n      </Button>\n      \n      <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Select Your Role</h2>\n      <p className=\"text-gray-600 mb-4\">For: {selectedProject?.name}</p>\n      \n      {rolesLoading ? (\n        <div className=\"flex items-center justify-center py-8\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-teal-600\" />\n          <span className=\"ml-2 text-gray-500\">Loading roles...</span>\n        </div>\n      ) : (\n        <div className=\"grid md:grid-cols-3 lg:grid-cols-5 gap-4\">\n          {availableRoles.map((role: any) => {\n            const Icon = role.icon || Code;\n            return (\n              <Card \n                key={role.name}\n                className={`transition-all ${\n                  role.available \n                    ? `cursor-pointer hover:shadow-lg ${selectedRole === role.name ? 'ring-2 ring-teal-500 shadow-lg bg-teal-50/30' : ''}`\n                    : 'opacity-50 cursor-not-allowed'\n                }`}\n                onClick={() => role.available && handleSelectRole(role.name)}\n                data-testid={`card-practice-role-${role.role || role.name.toLowerCase().replace(' ', '-')}`}\n              >\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <div className={`p-2 rounded-lg ${role.available ? 'bg-teal-100' : 'bg-gray-100'}`}>\n                      <Icon className={`h-5 w-5 ${role.available ? 'text-teal-600' : 'text-gray-400'}`} />\n                    </div>\n                    {!role.available && (\n                      <Badge variant=\"secondary\" className=\"text-xs\">Coming Soon</Badge>\n                    )}\n                  </div>\n                  <h3 className=\"font-semibold text-gray-900 mb-1\">{role.name}</h3>\n                  <p className=\"text-sm text-gray-600\">{role.description}</p>\n                </CardContent>\n              </Card>\n            );\n          })}\n        </div>\n      )}\n    </div>\n  );\n\n  const renderScenarioStep = () => (\n    <div>\n      <Button variant=\"ghost\" size=\"sm\" onClick={handleBack} className=\"mb-4\">\n        <ChevronLeft className=\"h-4 w-4 mr-1\" />\n        Back\n      </Button>\n      \n      <h2 className=\"text-lg font-semibold text-gray-900 mb-2\">Select a Scenario</h2>\n      <p className=\"text-gray-600 mb-4\">{selectedProject?.name}  {selectedRole}</p>\n      \n      <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6\">\n        {SCENARIOS.map((scenario) => {\n          const Icon = scenario.icon;\n          return (\n            <Card \n              key={scenario.id}\n              className={`transition-all ${\n                scenario.available \n                  ? `cursor-pointer hover:shadow-lg ${selectedScenario?.id === scenario.id ? 'ring-2 ring-teal-500 shadow-lg bg-teal-50/30' : ''}`\n                  : 'opacity-60 cursor-not-allowed relative'\n              }`}\n              onClick={() => handleSelectScenario(scenario)}\n              data-testid={`card-practice-scenario-${scenario.id}`}\n            >\n              {!scenario.available && (\n                <div className=\"absolute inset-0 bg-gray-100/50 rounded-lg flex items-center justify-center z-10\">\n                  <div className=\"text-center p-4\">\n                    <Lock className=\"h-5 w-5 text-gray-400 mx-auto mb-2\" />\n                    <p className=\"text-xs text-gray-500\">{scenario.prerequisite}</p>\n                  </div>\n                </div>\n              )}\n              <CardContent className=\"p-5\">\n                <div className=\"flex items-center gap-3 mb-3\">\n                  <div className={`p-2 rounded-lg ${scenario.available ? 'bg-teal-100' : 'bg-gray-100'}`}>\n                    <Icon className={`h-5 w-5 ${scenario.available ? 'text-teal-600' : 'text-gray-400'}`} />\n                  </div>\n                  <Badge variant=\"outline\" className=\"text-xs\">{scenario.duration}</Badge>\n                </div>\n                <h3 className=\"font-semibold text-gray-900 mb-1\">{scenario.title}</h3>\n                <p className=\"text-sm text-gray-600 mb-3\">{scenario.description}</p>\n                <div className=\"flex flex-wrap gap-1\">\n                  {scenario.skills.map((skill) => (\n                    <Badge key={skill} variant=\"secondary\" className=\"text-xs bg-gray-100\">\n                      {skill}\n                    </Badge>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          );\n        })}\n      </div>\n\n      {selectedScenario && (\n        <div className=\"flex justify-end\">\n          <Button \n            onClick={handleStartPractice}\n            disabled={createSessionMutation.isPending}\n            className=\"bg-teal-600 hover:bg-teal-700\"\n            data-testid=\"button-start-practice\"\n          >\n            {createSessionMutation.isPending ? 'Starting...' : (\n              <>\n                Start Practice\n                <ChevronRight className=\"h-4 w-4 ml-2\" />\n              </>\n            )}\n          </Button>\n        </div>\n      )}\n    </div>\n  );\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"max-w-6xl mx-auto\">\n        <div className=\"mb-8\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"p-2 bg-teal-100 rounded-lg\">\n              <Target className=\"h-6 w-6 text-teal-600\" />\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900\" data-testid=\"text-workspace-practice-title\">\n              Workspace Practice\n            </h1>\n          </div>\n          <p className=\"text-gray-600 mt-2\">\n            Pick any day, any company. Build specific skills without completing the full journey.\n          </p>\n        </div>\n\n        {inProgressSessions.length > 0 && wizardStep === 'project' && (\n          <div className=\"mb-8\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">My Practice Workspaces</h2>\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              {inProgressSessions.map((progress: any) => {\n                const project = practiceProjects.find((p: any) => p.id === progress.projectId);\n                if (!project) return null;\n                const scenario = SCENARIOS.find(s => s.id === progress.scenarioId);\n                \n                return (\n                  <Card key={progress.id} className=\"border-teal-200 bg-gradient-to-r from-teal-50 to-cyan-50\">\n                    <CardContent className=\"p-5\">\n                      <div className=\"flex items-start justify-between mb-3\">\n                        <div>\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <span className=\"font-medium text-gray-900\">{project.name}</span>\n                            <span className=\"text-gray-400\"></span>\n                            <span className=\"text-gray-600\">{progress.role}</span>\n                          </div>\n                          <h3 className=\"font-semibold text-gray-900\">{scenario?.title || `Day ${progress.currentDay}`}</h3>\n                        </div>\n                        <Badge className=\"bg-amber-100 text-amber-800\">In Progress</Badge>\n                      </div>\n                      \n                      <div className=\"flex items-center gap-3 mb-4\">\n                        <Progress value={progress.overallProgress} className=\"flex-1 h-2\" />\n                        <span className=\"text-sm text-gray-600\">{progress.overallProgress}%</span>\n                      </div>\n                      \n                      <div className=\"flex items-center justify-between\">\n                        <span className=\"text-xs text-gray-500\">\n                          Started {new Date(progress.startedAt).toLocaleDateString()}\n                        </span>\n                        <div className=\"flex gap-2\">\n                          <Button\n                            size=\"sm\"\n                            onClick={() => handleResumePractice(progress, project)}\n                            className=\"bg-teal-600 hover:bg-teal-700\"\n                            data-testid={`button-resume-practice-${progress.id}`}\n                          >\n                            <Play className=\"h-3 w-3 mr-1\" />\n                            Resume\n                          </Button>\n                          <DropdownMenu>\n                            <DropdownMenuTrigger asChild>\n                              <Button variant=\"ghost\" size=\"sm\">\n                                <MoreVertical className=\"h-4 w-4\" />\n                              </Button>\n                            </DropdownMenuTrigger>\n                            <DropdownMenuContent align=\"end\">\n                              <DropdownMenuItem>\n                                <RotateCcw className=\"h-4 w-4 mr-2\" />\n                                Restart\n                              </DropdownMenuItem>\n                            </DropdownMenuContent>\n                          </DropdownMenu>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        {completedSessions.length > 0 && wizardStep === 'project' && (\n          <div className=\"mb-8\">\n            <h2 className=\"text-lg font-semibold text-gray-900 mb-4\">Completed Practice Sessions</h2>\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n              {completedSessions.slice(0, 6).map((progress: any) => {\n                const project = practiceProjects.find((p: any) => p.id === progress.projectId);\n                if (!project) return null;\n                const scenario = SCENARIOS.find(s => s.id === progress.scenarioId);\n                \n                return (\n                  <Card key={progress.id} className=\"bg-gray-50\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"flex items-start justify-between mb-2\">\n                        <div>\n                          <p className=\"text-xs text-gray-500\">{project.name}  {progress.role}</p>\n                          <h3 className=\"font-medium text-gray-900\">{scenario?.title || `Day ${progress.currentDay}`}</h3>\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                          {progress.score && (\n                            <span className=\"text-sm font-medium text-green-600\">{progress.score}%</span>\n                          )}\n                        </div>\n                      </div>\n                      <p className=\"text-xs text-gray-500\">\n                        Completed {progress.completedAt ? new Date(progress.completedAt).toLocaleDateString() : 'recently'}\n                      </p>\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n          </div>\n        )}\n\n        <Card className=\"p-6\">\n          {renderWizardSteps()}\n          \n          {wizardStep === 'project' && renderProjectStep()}\n          {wizardStep === 'role' && renderRoleStep()}\n          {wizardStep === 'scenario' && renderScenarioStep()}\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":26731,"size_tokens":null},"docs/team-interview-spec.md":{"content":"# Team Interview Product Specification\n\n## Overview\n\nThe Team Interview is a distinct interview type that simulates meeting potential teammates. Unlike HR Screening (which focuses on background verification, culture fit, and logistics), Team Interviews assess how candidates would collaborate, problem-solve, and communicate with the people they'd work alongside.\n\n**Key Differentiator:** Multi-persona interviewers + scenario-based questions + level-calibrated difficulty\n\n---\n\n## Level Calibration System\n\nAll team interviews automatically adapt based on the job posting's experience level.\n\n### Level Definitions\n\n| Level | Target Candidate | Core Assessment Focus |\n|-------|------------------|----------------------|\n| **Intern** | Students, bootcamp grads, career changers | Learning ability, curiosity, collaboration basics |\n| **Junior** | 0-2 years experience | Practical skills, problem-solving fundamentals, growth mindset |\n| **Mid** | 2-5 years experience | Independent execution, debugging depth, code quality |\n| **Senior** | 5-8 years experience | System thinking, mentorship, technical leadership |\n| **Lead** | 8+ years experience | Architecture, team scaling, cross-org influence |\n\n---\n\n## Intern-Level Team Interview (Priority)\n\n### Interviewer Personas\n\n**Primary:** Peer teammate (fellow junior/mid developer)\n- Friendly, approachable tone\n- Shares relatable experiences\n- Asks about learning and collaboration\n\n**Secondary:** Tech lead (brief appearance)\n- Supportive, mentorship-oriented\n- Focuses on potential over polish\n- Asks about how they handle challenges\n\n### Question Categories\n\n#### 1. Learning & Growth (40% of interview)\n- \"How do you approach learning something completely new?\"\n- \"Tell me about a time you were stuck on a problem. What did you do?\"\n- \"What's something technical you taught yourself recently?\"\n- \"How do you decide when to keep trying vs. ask for help?\"\n\n#### 2. Collaboration Basics (30% of interview)\n- \"How would you work with a teammate on a shared task?\"\n- \"If you disagreed with a teammate's approach, how would you handle it?\"\n- \"What does good communication look like when working on code together?\"\n- \"How do you prefer to receive feedback on your work?\"\n\n#### 3. Technical Fundamentals (20% of interview)\n- \"Walk me through how you'd debug a simple issue\"\n- \"What questions would you ask before starting a new task?\"\n- \"How do you organize your work when you have multiple things to do?\"\n\n#### 4. Curiosity & Questions (10% of interview)\n- \"What questions do you have about working on our team?\"\n- \"What would you want to learn in your first month?\"\n\n### What We Explicitly Avoid (Intern Level)\n- System design or architecture questions\n- Questions about leading teams or mentoring others\n- Production incident management scenarios\n- Complex trade-off discussions\n- Questions assuming years of industry experience\n\n### Evaluation Rubric (Intern)\n\n| Criterion | Weight | What \"Good\" Looks Like |\n|-----------|--------|------------------------|\n| Learning Mindset | 35% | Shows curiosity, asks clarifying questions, admits knowledge gaps honestly |\n| Collaboration | 30% | Communicates clearly, open to feedback, thinks about teammates |\n| Problem-Solving Approach | 25% | Has a logical process, knows when to ask for help |\n| Technical Foundations | 10% | Basic understanding, doesn't need to be polished |\n\n### Sample Artifacts (Intern Level)\n\n**Simple Code Snippet:**\n```javascript\nfunction calculateTotal(items) {\n  let total = 0;\n  for (let i = 0; i <= items.length; i++) {\n    total += items[i].price;\n  }\n  return total;\n}\n// \"Can you spot any issues with this code?\"\n```\n\n**Basic Task Scenario:**\n\"You're assigned a ticket to add a 'forgot password' button to the login page. What questions would you ask before starting?\"\n\n---\n\n## Junior-Level Team Interview\n\n### Interviewer Personas\n- **Peer engineer** (mid-level): Collegial, asks about practical skills\n- **Tech lead**: Evaluates problem-solving depth\n\n### Question Focus\n- More hands-on debugging scenarios\n- Code review discussions\n- Basic architectural awareness\n- Independent task execution\n\n### Evaluation Adjustments\n- Higher expectations for technical foundations\n- Still values growth mindset\n- Looks for ability to work independently with guidance\n\n---\n\n## Mid-Level Team Interview\n\n### Interviewer Personas\n- **Senior engineer**: Peer-to-peer discussion\n- **Tech lead**: Probes technical decisions\n- **Product partner** (optional): Tests cross-functional collaboration\n\n### Question Focus\n- Debugging complex issues\n- Code quality and maintainability\n- Estimation and prioritization\n- Mentoring junior teammates\n\n### Evaluation Adjustments\n- Expects solid technical depth\n- Values ownership and delivery\n- Looks for emerging leadership\n\n---\n\n## Senior-Level Team Interview\n\n### Interviewer Personas\n- **Tech lead**: Deep technical probing\n- **Engineering manager**: Leadership and influence\n- **Product partner**: Strategic collaboration\n\n### Question Focus\n- System design and trade-offs\n- Technical decision-making\n- Mentorship and team growth\n- Cross-team collaboration\n- Handling ambiguity\n\n### Evaluation Adjustments\n- Expects strategic thinking\n- Values influence and mentorship\n- Looks for architectural judgment\n\n---\n\n## Lead-Level Team Interview\n\n### Interviewer Personas\n- **Engineering director**: Organizational thinking\n- **Staff engineer**: Technical vision\n- **Product leader**: Business alignment\n\n### Question Focus\n- Scaling teams and systems\n- Cross-organizational influence\n- Technical strategy and vision\n- Building engineering culture\n\n### Evaluation Adjustments\n- Expects executive-level thinking\n- Values organizational impact\n- Looks for vision and influence\n\n---\n\n## Multi-Persona Interaction Flow\n\n### How Persona Switching Works\n\n1. **Opening:** Primary persona introduces themselves and the format\n2. **Core questions:** Personas take turns based on question category\n3. **Transitions:** Natural handoffs (\"Marcus, did you want to ask about...\")\n4. **Closing:** Primary persona wraps up, invites candidate questions\n\n### Example Flow (Intern Level)\n\n```\n[Sarah - Tech Lead]\n\"Hi! I'm Sarah, the tech lead. You'll also be chatting with Marcus, \none of our developers. We want to get to know how you work and learn. \nMarcus, want to kick us off?\"\n\n[Marcus - Peer Engineer]  \n\"Hey! So I'm curious - when you're learning something new, like a \nframework you've never used, how do you typically approach it?\"\n\n... conversation continues ...\n\n[Marcus]\n\"That makes sense. Sarah, did you want to ask about the debugging side?\"\n\n[Sarah]\n\"Yeah! So imagine you're working on a bug and you've been stuck for \nabout an hour. Walk me through what you'd do.\"\n```\n\n---\n\n## Technical Implementation Notes\n\n### Schema Changes\n- Add `experienceLevel` to interview config (read from job posting)\n- Add `teamInterviewSettings` with persona roster and scenario type\n- Add level-specific question banks\n- Add level-calibrated evaluation rubrics\n\n### Chain Modifications\n- Unified chain receives experience level in context\n- Prompt adapts question complexity based on level\n- Evaluation expectations adjust per level\n- Persona labels prepended to responses\n\n### Backward Compatibility\n- Existing HR screening interviews unchanged\n- Team interview type gets new behavior\n- Feature flag for gradual rollout\n\n---\n\n## Success Metrics\n\n1. **Differentiation:** Users can clearly distinguish team vs. HR interviews\n2. **Level appropriateness:** Interns don't get senior-level questions\n3. **Engagement:** Multi-persona format feels realistic\n4. **Learning value:** Users report practicing relevant skills\n\n---\n\n## Implementation Phases\n\n### Phase 1: Intern Team Interview\n- Implement level-calibrated questions for intern level\n- Add peer engineer + tech lead personas\n- Basic artifact support (code snippets)\n- Adjusted evaluation rubric\n\n### Phase 2: Junior/Mid Levels\n- Expand question banks\n- Add more complex artifacts\n- Refine persona behaviors\n\n### Phase 3: Senior/Lead Levels\n- System design scenarios\n- Strategic discussion flows\n- Panel interview dynamics\n","path":null,"size_bytes":8101,"size_tokens":null},"server/services/team-interview-questions.ts":{"content":"import { ExperienceLevel, TeamInterviewPersona } from '@shared/schema';\n\nexport interface TeamInterviewQuestion {\n  id: string;\n  category: 'warmup' | 'learning' | 'collaboration' | 'technical' | 'curiosity';\n  personaRole: string; // Which persona typically asks this\n  question: string;\n  followUps: string[]; // Possible follow-up questions\n  lookingFor: string[]; // What a good answer includes\n  redFlags: string[]; // Warning signs in answers\n  sampleArtifact?: string; // Optional code/scenario to discuss\n}\n\nexport const INTERN_QUESTIONS: TeamInterviewQuestion[] = [\n  // WARM-UP / MOTIVATION (First question - sets the tone)\n  {\n    id: 'intern_warmup_1',\n    category: 'warmup',\n    personaRole: 'peer_engineer',\n    question: \"What got you interested in software engineering in the first place?\",\n    followUps: [\n      \"Was there a specific moment or project that sparked that interest?\",\n      \"What do you enjoy most about coding so far?\",\n    ],\n    lookingFor: [\n      'Genuine enthusiasm for building things',\n      'Can articulate what draws them to the field',\n      'Shows curiosity about technology',\n      'Personal connection to the work',\n    ],\n    redFlags: [\n      'Only mentions salary or job security',\n      'Cannot explain any interest in the work itself',\n      'Seems disengaged when talking about coding',\n    ],\n  },\n  {\n    id: 'intern_warmup_2',\n    category: 'warmup',\n    personaRole: 'peer_engineer',\n    question: \"What excites you most about this opportunity?\",\n    followUps: [\n      \"What are you hoping to learn or work on?\",\n      \"What kind of projects interest you?\",\n    ],\n    lookingFor: [\n      'Has researched the company/role',\n      'Shows enthusiasm for learning',\n      'Connects their interests to the opportunity',\n      'Has realistic expectations',\n    ],\n    redFlags: [\n      'Generic answer that could apply anywhere',\n      'No awareness of what the role involves',\n      'Only focused on what they can get, not contribute',\n    ],\n  },\n  {\n    id: 'intern_warmup_3',\n    category: 'warmup',\n    personaRole: 'tech_lead',\n    question: \"Tell me a bit about your journey into tech so far - how did you get here?\",\n    followUps: [\n      \"What made you choose this path?\",\n      \"What's been the most rewarding part so far?\",\n    ],\n    lookingFor: [\n      'Clear narrative of their path',\n      'Shows self-awareness about their journey',\n      'Demonstrates initiative in learning',\n      'Authentic and thoughtful response',\n    ],\n    redFlags: [\n      'Cannot explain their own choices',\n      'Seems to have fallen into it accidentally with no interest',\n      'Dismissive of their own learning journey',\n    ],\n  },\n\n  // LEARNING & GROWTH (40% of interview)\n  {\n    id: 'intern_learn_1',\n    category: 'learning',\n    personaRole: 'peer_engineer',\n    question: \"When you're learning something completely new - like a framework or language you've never used - how do you typically approach it?\",\n    followUps: [\n      \"Can you give me a specific example of when you did this?\",\n      \"What resources do you find most helpful?\",\n      \"How do you know when you've learned enough to start building?\",\n    ],\n    lookingFor: [\n      'Has a structured approach (docs, tutorials, small projects)',\n      'Mentions hands-on practice',\n      'Shows awareness of different learning resources',\n      'Balances learning and doing',\n    ],\n    redFlags: [\n      'Only mentions watching videos passively',\n      'No concrete examples',\n      'Claims to never struggle with learning',\n    ],\n  },\n  {\n    id: 'intern_learn_2',\n    category: 'learning',\n    personaRole: 'tech_lead',\n    question: \"Tell me about a time you were stuck on a problem for a while. What did you do?\",\n    followUps: [\n      \"At what point did you decide to ask for help?\",\n      \"Looking back, would you do anything differently?\",\n      \"What did you learn from that experience?\",\n    ],\n    lookingFor: [\n      'Tried multiple approaches before giving up',\n      'Knows when to ask for help (not too early, not too late)',\n      'Can articulate what they tried',\n      'Learned something from the experience',\n    ],\n    redFlags: [\n      'Immediately asks for help without trying',\n      'Spends days stuck without seeking help',\n      'Gets frustrated and gives up',\n      'Blames tools or others',\n    ],\n  },\n  {\n    id: 'intern_learn_3',\n    category: 'learning',\n    personaRole: 'peer_engineer',\n    question: \"What's something technical you've taught yourself recently? Walk me through how you learned it.\",\n    followUps: [\n      \"What made you interested in learning that?\",\n      \"What was the hardest part?\",\n      \"Have you used it in a project yet?\",\n    ],\n    lookingFor: [\n      'Shows genuine curiosity',\n      'Can explain their learning process',\n      'Applied what they learned',\n      'Specific about what they learned',\n    ],\n    redFlags: [\n      'Can not name anything specific',\n      'Only learns what is required for class',\n      'Vague about details',\n    ],\n  },\n  {\n    id: 'intern_learn_4',\n    category: 'learning',\n    personaRole: 'tech_lead',\n    question: \"How do you decide when to keep trying on your own versus asking for help?\",\n    followUps: [\n      \"Is there a time limit you set for yourself?\",\n      \"How do you prepare before asking someone for help?\",\n      \"What makes a good question when asking for help?\",\n    ],\n    lookingFor: [\n      'Has a reasonable threshold (15-30 min for simple, longer for complex)',\n      'Documents what they tried before asking',\n      'Asks specific questions, not \"it doesn not work\"',\n      'Respects others time',\n    ],\n    redFlags: [\n      'No sense of when to escalate',\n      'Expects others to solve problems for them',\n      'Asks vague questions without context',\n    ],\n  },\n\n  // COLLABORATION BASICS (30% of interview)\n  {\n    id: 'intern_collab_1',\n    category: 'collaboration',\n    personaRole: 'peer_engineer',\n    question: \"Imagine you're working on a shared codebase with a teammate. How would you coordinate your work to avoid stepping on each other's toes?\",\n    followUps: [\n      \"What if you accidentally made conflicting changes?\",\n      \"How would you communicate what you're working on?\",\n      \"Have you used version control for group projects before?\",\n    ],\n    lookingFor: [\n      'Mentions communication (standups, chat, etc.)',\n      'Understands version control basics',\n      'Proactive about updates',\n      'Thinks about impact on others',\n    ],\n    redFlags: [\n      'Works in isolation without updates',\n      'Does not understand why coordination matters',\n      'Assumes conflicts will not happen',\n    ],\n  },\n  {\n    id: 'intern_collab_2',\n    category: 'collaboration',\n    personaRole: 'tech_lead',\n    question: \"If you disagreed with how a teammate wanted to solve a problem, how would you handle it?\",\n    followUps: [\n      \"What if they were more senior than you?\",\n      \"How would you make your case?\",\n      \"What if they still disagreed after you explained?\",\n    ],\n    lookingFor: [\n      'Seeks to understand their perspective first',\n      'Explains their reasoning respectfully',\n      'Open to being wrong',\n      'Focuses on the best solution, not winning',\n    ],\n    redFlags: [\n      'Avoids conflict entirely',\n      'Insists they are right without listening',\n      'Would just do it their way anyway',\n    ],\n  },\n  {\n    id: 'intern_collab_3',\n    category: 'collaboration',\n    personaRole: 'peer_engineer',\n    question: \"How do you prefer to receive feedback on your code or work?\",\n    followUps: [\n      \"Can you tell me about a time you got tough feedback?\",\n      \"What kind of feedback is most helpful to you?\",\n      \"How do you give feedback to others?\",\n    ],\n    lookingFor: [\n      'Open to constructive criticism',\n      'Sees feedback as learning opportunity',\n      'Can separate ego from work',\n      'Appreciates specific feedback over vague',\n    ],\n    redFlags: [\n      'Gets defensive about feedback',\n      'Only wants positive feedback',\n      'Takes criticism personally',\n    ],\n  },\n  {\n    id: 'intern_collab_4',\n    category: 'collaboration',\n    personaRole: 'tech_lead',\n    question: \"What does good communication look like when you're working on code with someone else?\",\n    followUps: [\n      \"How often should you sync with teammates?\",\n      \"What information is important to share?\",\n      \"How do you handle async communication?\",\n    ],\n    lookingFor: [\n      'Mentions regular check-ins',\n      'Shares blockers proactively',\n      'Clear about what they are working on',\n      'Responsive to messages',\n    ],\n    redFlags: [\n      'Goes silent for long periods',\n      'Only communicates when asked',\n      'Does not see value in updates',\n    ],\n  },\n\n  // TECHNICAL FUNDAMENTALS (20% of interview)\n  {\n    id: 'intern_tech_1',\n    category: 'technical',\n    personaRole: 'peer_engineer',\n    question: \"Walk me through how you'd approach debugging a simple issue - say, a button on a webpage that doesn't work when clicked.\",\n    followUps: [\n      \"What tools would you use?\",\n      \"How would you narrow down where the problem is?\",\n      \"What if the console showed no errors?\",\n    ],\n    lookingFor: [\n      'Checks browser console for errors',\n      'Inspects the element',\n      'Looks at event handlers',\n      'Systematic approach (not random changes)',\n    ],\n    redFlags: [\n      'Random trial and error only',\n      'Does not know about browser dev tools',\n      'Gives up quickly without investigating',\n    ],\n    sampleArtifact: `// This button should show an alert when clicked, but it doesn't work\n<button onclick=\"showMessage()\">Click me</button>\n\n<script>\nfunction showMessge() {\n  alert(\"Hello!\");\n}\n</script>`,\n  },\n  {\n    id: 'intern_tech_2',\n    category: 'technical',\n    personaRole: 'tech_lead',\n    question: \"Before starting a new coding task, what questions would you want answered first?\",\n    followUps: [\n      \"What if some requirements were unclear?\",\n      \"How do you handle ambiguity?\",\n      \"When would you start coding vs. ask more questions?\",\n    ],\n    lookingFor: [\n      'Asks about expected behavior',\n      'Clarifies edge cases',\n      'Understands the \"why\" not just the \"what\"',\n      'Checks for existing similar code',\n    ],\n    redFlags: [\n      'Just starts coding immediately',\n      'Assumes they understand everything',\n      'Does not think about edge cases',\n    ],\n  },\n  {\n    id: 'intern_tech_3',\n    category: 'technical',\n    personaRole: 'peer_engineer',\n    question: \"How do you keep your code organized when working on a larger project?\",\n    followUps: [\n      \"How do you name things?\",\n      \"What makes code easy to read?\",\n      \"How do you decide when to break something into smaller pieces?\",\n    ],\n    lookingFor: [\n      'Meaningful variable/function names',\n      'Breaks code into functions',\n      'Comments when necessary',\n      'Some awareness of structure',\n    ],\n    redFlags: [\n      'Everything in one giant file',\n      'Single-letter variable names everywhere',\n      'No concept of organization',\n    ],\n  },\n\n  // CURIOSITY & QUESTIONS (10% of interview)\n  {\n    id: 'intern_curiosity_1',\n    category: 'curiosity',\n    personaRole: 'tech_lead',\n    question: \"What questions do you have about our team or how we work?\",\n    followUps: [],\n    lookingFor: [\n      'Asks about learning opportunities',\n      'Interested in team dynamics',\n      'Curious about the work itself',\n      'Thoughtful, prepared questions',\n    ],\n    redFlags: [\n      'No questions at all',\n      'Only asks about time off/perks',\n      'Questions show no research',\n    ],\n  },\n  {\n    id: 'intern_curiosity_2',\n    category: 'curiosity',\n    personaRole: 'peer_engineer',\n    question: \"What would you want to learn in your first month here?\",\n    followUps: [\n      \"How would you go about learning that?\",\n      \"What's your biggest growth area right now?\",\n    ],\n    lookingFor: [\n      'Specific learning goals',\n      'Realistic expectations',\n      'Eager but humble',\n      'Relevant to the role',\n    ],\n    redFlags: [\n      'No thoughts on development',\n      'Unrealistic expectations (lead the team quickly)',\n      'Only interested in one narrow thing',\n    ],\n  },\n];\n\nexport const JUNIOR_QUESTIONS: TeamInterviewQuestion[] = [\n  {\n    id: 'junior_tech_1',\n    category: 'technical',\n    personaRole: 'peer_engineer',\n    question: \"Tell me about a bug you've debugged that took a while to find. What was your process?\",\n    followUps: [\n      \"What made it tricky?\",\n      \"What tools did you use?\",\n      \"How did you prevent it from happening again?\",\n    ],\n    lookingFor: [\n      'Systematic debugging process',\n      'Uses appropriate tools',\n      'Documents findings',\n      'Thinks about prevention',\n    ],\n    redFlags: [\n      'No real debugging experience',\n      'Random trial and error only',\n      'Cannot explain their process',\n    ],\n  },\n  {\n    id: 'junior_collab_1',\n    category: 'collaboration',\n    personaRole: 'tech_lead',\n    question: \"How do you handle code reviews - both giving and receiving them?\",\n    followUps: [\n      \"What makes a helpful code review comment?\",\n      \"How do you respond to feedback you disagree with?\",\n    ],\n    lookingFor: [\n      'Sees code review as learning',\n      'Gives constructive feedback',\n      'Separates ego from code',\n    ],\n    redFlags: [\n      'Gets defensive',\n      'Harsh or unconstructive feedback',\n      'Rubber-stamps everything',\n    ],\n  },\n];\n\nexport function getQuestionsForLevel(level: ExperienceLevel): TeamInterviewQuestion[] {\n  switch (level) {\n    case 'intern':\n      return INTERN_QUESTIONS;\n    case 'junior':\n      return [...JUNIOR_QUESTIONS, ...INTERN_QUESTIONS.filter(q => \n        q.category === 'collaboration' || q.category === 'learning'\n      )];\n    default:\n      return INTERN_QUESTIONS;\n  }\n}\n\nexport function getQuestionsForPersona(\n  questions: TeamInterviewQuestion[],\n  persona: TeamInterviewPersona\n): TeamInterviewQuestion[] {\n  return questions.filter(q => \n    q.personaRole === persona.role || persona.focusAreas.includes(q.category)\n  );\n}\n\nexport function selectQuestionsForInterview(\n  level: ExperienceLevel,\n  weights: { learning: number; collaboration: number; technical: number; curiosity: number },\n  maxQuestions: number\n): TeamInterviewQuestion[] {\n  const allQuestions = getQuestionsForLevel(level);\n  const selected: TeamInterviewQuestion[] = [];\n  \n  // ALWAYS start with a warmup question (motivation/interest)\n  const warmupQuestions = allQuestions.filter(q => q.category === 'warmup');\n  if (warmupQuestions.length > 0) {\n    const shuffledWarmup = warmupQuestions.sort(() => Math.random() - 0.5);\n    selected.push(shuffledWarmup[0]);\n  }\n  \n  // Then add questions from other categories in progression order:\n  // learning  collaboration  technical  curiosity\n  const categories: Array<'learning' | 'collaboration' | 'technical' | 'curiosity'> = \n    ['learning', 'collaboration', 'technical', 'curiosity'];\n  \n  // Reduce maxQuestions by 1 to account for warmup\n  const remainingSlots = maxQuestions - selected.length;\n  \n  for (const category of categories) {\n    const categoryQuestions = allQuestions.filter(q => q.category === category);\n    const targetCount = Math.round((weights[category] / 100) * remainingSlots);\n    \n    const shuffled = categoryQuestions.sort(() => Math.random() - 0.5);\n    selected.push(...shuffled.slice(0, targetCount));\n  }\n  \n  return selected.slice(0, maxQuestions);\n}\n","path":null,"size_bytes":15586,"size_tokens":null},"server/services/team-interview-chain.ts":{"content":"import { PromptTemplate } from \"@langchain/core/prompts\";\nimport { ChatGroq } from \"@langchain/groq\";\nimport { StringOutputParser } from \"@langchain/core/output_parsers\";\nimport { RunnableSequence } from \"@langchain/core/runnables\";\nimport { \n  ExperienceLevel, \n  TeamInterviewPersona, \n  TeamInterviewSettings,\n  TEAM_INTERVIEW_PRESETS \n} from '@shared/schema';\nimport { TeamInterviewQuestion, getQuestionsForLevel, selectQuestionsForInterview } from './team-interview-questions';\n\nconst MODEL_NAME = \"qwen/qwen3-32b\";\n\nfunction stripMarkdownCodeBlocks(str: string): string {\n  // Remove Qwen's <think>...</think> reasoning tags\n  let cleaned = str.replace(/<think>[\\s\\S]*?<\\/think>/g, '');\n  // Remove markdown code blocks\n  cleaned = cleaned.replace(/```json\\n?/g, '').replace(/```\\n?/g, '');\n  return cleaned.trim();\n}\n\nexport interface TeamTurnInput {\n  activePersona: TeamInterviewPersona;\n  allPersonas: TeamInterviewPersona[];\n  experienceLevel: ExperienceLevel;\n  companyName: string;\n  companyDescription: string;\n  jobTitle: string;\n  candidateName: string;\n  conversationHistory: Array<{ role: 'interviewer' | 'candidate'; content: string; personaId?: string }>;\n  questionBacklog: TeamInterviewQuestion[];\n  coverageStatus: Record<string, number>;\n  questionsAskedCount: number;\n  maxQuestions: number;\n  currentQuestionId?: string;\n  levelExpectations: string;\n}\n\nexport interface TeamTurnOutput {\n  response: string;\n  actionType: 'continue' | 'follow_up' | 'hand_off' | 'wrap_up' | 'answer_question';\n  questionId?: string;\n  nextPersonaId?: string;\n  handOffIntro?: string;\n  evaluation: {\n    score: number;\n    strengths: string[];\n    areasToImprove: string[];\n    criterionCovered: string;\n    coverageContribution: number;\n  };\n  coveredQuestionIds: string[];\n  candidateAskedQuestion: boolean;\n  wrapUpReason?: string;\n}\n\nconst teamTurnPrompt = PromptTemplate.fromTemplate(`\nYou are {personaName}, a {personaRole} at {companyName}, participating in a team interview.\n\nYOUR PERSONA:\n- Role: {personaRole}\n- Tone: {personaTone} (be {toneGuidance})\n- Focus areas: {focusAreas}\n- Your intro style: \"{introStyle}\"\n\nINTERVIEW CONTEXT:\n- This is a TEAM INTERVIEW with multiple interviewers\n- Experience level being hired: {experienceLevel}\n- Company: {companyName} - {companyDescription}\n- Job Title: {jobTitle}\n- Candidate: {candidateName}\n- Questions Asked: {questionsAskedCount}/{maxQuestions}\n\nOTHER TEAM MEMBERS:\n{otherPersonas}\n\nLEVEL-APPROPRIATE EXPECTATIONS ({experienceLevel}):\n{levelExpectations}\n\nIMPORTANT: This is an {experienceLevel}-level position. Your questions and expectations should be calibrated accordingly:\n{levelGuidance}\n\nQUESTION BACKLOG (your focus areas highlighted):\n{questionBacklog}\n\nCOVERAGE STATUS (prioritize low-coverage areas):\n{coverageStatus}\n\nCATEGORY PRIORITY RULE:\n- Look at COVERAGE STATUS above - categories with low scores MUST be asked next\n- If collaboration or technical_foundations are below 0.3, prioritize those over learning/problem_solving\n- Don't wrap up until each major category has at least 0.2 coverage\n- Select your next question from the lowest-coverage category in your backlog\n\nCONVERSATION SO FAR:\n{conversationHistory}\n\n---\n\nThe candidate just responded. As {personaName}, you need to:\n1. Evaluate their response (calibrated to {experienceLevel} level expectations)\n2. Respond naturally in your persona's style and tone\n3. Decide: continue questioning, follow up, hand off to a teammate, or wrap up\n\nTEAM INTERVIEW DYNAMICS:\n- Hand off to a teammate ONLY when switching to a completely different topic area\n- You should ask at least 2-3 questions yourself before considering a hand-off\n- AVOID PING-PONG: If you just received a hand-off, DO NOT immediately hand back - ask at least 2 questions first\n- Natural hand-offs sound like: \"That's great context. I'll let [teammate name] take it from here with some [topic] questions.\"\n- IMPORTANT: Your response must END WITH A DIRECT QUESTION TO THE CANDIDATE, not instructions to your teammate\n- Bad example: \"Sarah, do you want to jump in on collaboration?\" (this is NOT a question for the candidate)\n- Good example: \"That's helpful. Sarah might have some thoughts on collaboration. How do you typically work with teammates on shared projects?\"\n\nPERSONA-SPECIFIC BEHAVIOR:\n{personaBehavior}\n\nEVALUATION CALIBRATION for {experienceLevel}:\n- Score 8-10: Exceeds expectations for this level\n- Score 6-7: Meets expectations for this level\n- Score 4-5: Slightly below expectations\n- Score 1-3: Significantly below expectations\nRemember: An intern giving a solid learning-focused answer is an 8, not a 5.\n\nWRAP-UP CRITERIA:\n- Questions asked approaching max ({maxQuestions})\n- All personas have had a chance to ask questions\n- Key areas are sufficiently covered\n\nOUTPUT FORMAT:\nReturn a JSON object with:\n{{\n  \"response\": \"Your natural response as {personaName}\",\n  \"actionType\": \"continue|follow_up|hand_off|wrap_up|answer_question\",\n  \"questionId\": \"ID of question you're asking (if from backlog)\",\n  \"nextPersonaId\": \"ID of teammate to hand off to (only if hand_off)\",\n  \"handOffIntro\": \"Natural transition phrase (only if hand_off)\",\n  \"evaluation\": {{\n    \"score\": 1-10,\n    \"strengths\": [\"strength1\", \"strength2\"],\n    \"areasToImprove\": [\"area1\"],\n    \"criterionCovered\": \"learning_mindset|collaboration|problem_solving|technical_foundations\",\n    \"coverageContribution\": 0.0-0.3\n  }},\n  \"coveredQuestionIds\": [\"id1\", \"id2\"],\n  \"candidateAskedQuestion\": true/false,\n  \"wrapUpReason\": \"only if actionType is wrap_up\"\n}}\n\nOutput ONLY valid JSON.\n`);\n\nfunction getToneGuidance(tone: TeamInterviewPersona['tone']): string {\n  switch (tone) {\n    case 'supportive':\n      return 'warm, encouraging, patient - remember they are early in their career';\n    case 'collegial':\n      return 'friendly, peer-to-peer, conversational';\n    case 'challenging':\n      return 'probing, direct, but fair - push for depth';\n    case 'strategic':\n      return 'big-picture focused, executive-level conversation';\n    default:\n      return 'professional and approachable';\n  }\n}\n\nfunction getLevelGuidance(level: ExperienceLevel): string {\n  switch (level) {\n    case 'intern':\n      return `- DO ask about: learning approach, asking for help, basic collaboration, curiosity\n- DO NOT ask about: system design, leading teams, production incidents, years of experience\n- Focus on POTENTIAL over current polish\n- Simple, foundational questions only\n- Celebrate honest answers about not knowing things`;\n    case 'junior':\n      return `- Ask about: practical skills, debugging basics, working in a team, receiving feedback\n- Expect some gaps in experience - that's normal\n- Look for growth mindset and willingness to learn`;\n    case 'mid':\n      return `- Ask about: independent work, code quality, mentoring juniors, technical decisions\n- Expect solid fundamentals and some ownership experience\n- Look for evidence of growing beyond individual contributor`;\n    case 'senior':\n      return `- Ask about: system design, technical leadership, mentoring, cross-team influence\n- Expect deep technical expertise and leadership evidence\n- Look for strategic thinking and organizational impact`;\n    case 'lead':\n      return `- Ask about: team building, technical vision, scaling systems and teams, executive alignment\n- Expect organizational-level thinking and impact\n- Look for evidence of building and scaling engineering culture`;\n  }\n}\n\nfunction getPersonaBehavior(persona: TeamInterviewPersona, level: ExperienceLevel): string {\n  if (level === 'intern') {\n    switch (persona.role) {\n      case 'peer_engineer':\n        return `As a fellow engineer, be relatable and friendly:\n- Share brief personal anecdotes about when you were new\n- Ask about their learning journey, not their achievements\n- Make them feel comfortable admitting what they don't know\n- Example: \"When I started, I spent hours stuck on a bug before asking for help. How do you handle that kind of situation?\"`;\n      case 'tech_lead':\n        return `As the tech lead, be supportive and growth-oriented:\n- Focus on their potential, not their current skill level\n- Ask about curiosity and enthusiasm for learning\n- Look for teachability and self-awareness\n- Example: \"What would you want to learn in your first month with us?\"`;\n      default:\n        return 'Be encouraging and focus on potential over polish.';\n    }\n  }\n  \n  return `Engage at the ${level} level with appropriate depth and expectations.`;\n}\n\nexport class TeamInterviewTurnChain {\n  private chain: RunnableSequence;\n\n  constructor() {\n    this.chain = RunnableSequence.from([\n      teamTurnPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        topP: 0.95,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n  }\n\n  async processTurn(input: TeamTurnInput): Promise<TeamTurnOutput> {\n    const formattedHistory = input.conversationHistory\n      .slice(-10)\n      .map(msg => {\n        const speaker = msg.role === 'interviewer' \n          ? (msg.personaId ? input.allPersonas.find(p => p.id === msg.personaId)?.name || 'Interviewer' : input.activePersona.name)\n          : input.candidateName;\n        return `${speaker}: ${msg.content}`;\n      })\n      .join('\\n');\n\n    // Backlog is pre-filtered by the orchestrator to exclude asked questions\n    // Just take the first 8 questions and format them\n    const formattedBacklog = input.questionBacklog\n      .slice(0, 8)\n      .map(q => {\n        const isMyFocus = input.activePersona.focusAreas.includes(q.category) ? '' : '';\n        return `${isMyFocus}[${q.id}] (${q.category}) ${q.question}`;\n      })\n      .join('\\n');\n\n    const formattedCoverage = Object.entries(input.coverageStatus)\n      .map(([key, value]) => `- ${key}: ${(value * 100).toFixed(0)}%`)\n      .join('\\n');\n\n    const otherPersonas = input.allPersonas\n      .filter(p => p.id !== input.activePersona.id)\n      .map(p => `- ${p.name} (${p.displayRole}): focuses on ${p.focusAreas.join(', ')}`)\n      .join('\\n');\n\n    const result = await this.chain.invoke({\n      personaName: input.activePersona.name,\n      personaRole: input.activePersona.displayRole,\n      personaTone: input.activePersona.tone,\n      toneGuidance: getToneGuidance(input.activePersona.tone),\n      focusAreas: input.activePersona.focusAreas.join(', '),\n      introStyle: input.activePersona.introStyle,\n      experienceLevel: input.experienceLevel,\n      companyName: input.companyName,\n      companyDescription: input.companyDescription,\n      jobTitle: input.jobTitle,\n      candidateName: input.candidateName,\n      questionsAskedCount: input.questionsAskedCount,\n      maxQuestions: input.maxQuestions,\n      otherPersonas: otherPersonas || 'No other interviewers',\n      levelExpectations: input.levelExpectations,\n      levelGuidance: getLevelGuidance(input.experienceLevel),\n      questionBacklog: formattedBacklog || 'No remaining questions',\n      coverageStatus: formattedCoverage,\n      conversationHistory: formattedHistory,\n      personaBehavior: getPersonaBehavior(input.activePersona, input.experienceLevel),\n    });\n\n    try {\n      const cleanedResult = stripMarkdownCodeBlocks(result);\n      const parsed = JSON.parse(cleanedResult);\n\n      return {\n        response: parsed.response || \"That's interesting. Tell me more.\",\n        actionType: parsed.actionType || 'continue',\n        questionId: parsed.questionId,\n        nextPersonaId: parsed.nextPersonaId,\n        handOffIntro: parsed.handOffIntro,\n        evaluation: {\n          score: parsed.evaluation?.score || 5,\n          strengths: parsed.evaluation?.strengths || [],\n          areasToImprove: parsed.evaluation?.areasToImprove || [],\n          criterionCovered: parsed.evaluation?.criterionCovered || 'learning_mindset',\n          coverageContribution: parsed.evaluation?.coverageContribution || 0.1,\n        },\n        coveredQuestionIds: parsed.coveredQuestionIds || [],\n        candidateAskedQuestion: parsed.candidateAskedQuestion || false,\n        wrapUpReason: parsed.wrapUpReason,\n      };\n    } catch (error) {\n      console.error(\"Failed to parse team turn response:\", result);\n      return {\n        response: \"Thanks for sharing that. Let me ask you something else.\",\n        actionType: 'continue',\n        evaluation: {\n          score: 5,\n          strengths: [],\n          areasToImprove: [],\n          criterionCovered: 'learning_mindset',\n          coverageContribution: 0.1,\n        },\n        coveredQuestionIds: [],\n        candidateAskedQuestion: false,\n      };\n    }\n  }\n}\n\nexport class TeamInterviewGreetingChain {\n  private greetingChain: RunnableSequence;\n  private sarahIntroChain: RunnableSequence;\n  private transitionChain: RunnableSequence;\n\n  constructor() {\n    const greetingPrompt = PromptTemplate.fromTemplate(`\nYou are starting a team interview at {companyName}.\n\nPRIMARY INTERVIEWER: {primaryName} - {primaryRole}\nSECONDARY INTERVIEWER: {secondaryName} - {secondaryRole}\n\nCANDIDATE: {candidateName}\nPOSITION: {jobTitle} ({experienceLevel} level)\n\nGenerate ONLY the primary interviewer ({primaryName})'s welcome message. The tone should be {primaryTone}.\n\nIMPORTANT: \n- Introduce yourself and mention your colleague is joining\n- Do NOT ask any questions yet\n- Keep it brief (2-3 sentences max)\n- End by inviting your colleague to introduce themselves\n\nExample:\n\"Hi {candidateName}! I'm {primaryName}, {primaryRole} here at {companyName}. I'm joined today by my colleague {secondaryName}, our {secondaryRole}. {secondaryName}, would you like to say hello?\"\n\nOutput only the greeting text, no JSON.\n`);\n\n    const sarahIntroPrompt = PromptTemplate.fromTemplate(`\nYou are {secondaryName}, a {secondaryRole} at {companyName}, joining a team interview.\n\nThe primary interviewer ({primaryName}) just introduced themselves and invited you to say hello to the candidate ({candidateName}).\n\nGenerate your brief, friendly introduction. The tone should be {secondaryTone}.\n\nFor an {experienceLevel}-level interview:\n{levelContext}\n\nIMPORTANT:\n- Keep it brief (2-3 sentences)\n- Be warm and welcoming\n- Mention you're looking forward to chatting\n- End by inviting the candidate to share a bit about themselves\n\nExample:\n\"Hi {candidateName}! Great to meet you. I'm {secondaryName}, and I work as {secondaryRole} on the engineering team. I'm excited to learn more about you - could you start by telling us a bit about yourself and what drew you to this opportunity?\"\n\nOutput only the greeting text, no JSON.\n`);\n\n    this.greetingChain = RunnableSequence.from([\n      greetingPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n\n    this.sarahIntroChain = RunnableSequence.from([\n      sarahIntroPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n\n    const transitionPrompt = PromptTemplate.fromTemplate(`\nYou are {personaName}, a {personaRole} at {companyName}, in a team interview for an {experienceLevel}-level position.\n\nThe candidate just introduced themselves:\n\"{candidateIntro}\"\n\nGenerate a brief, warm acknowledgment of what they shared, then naturally transition into your first question.\n\nIMPORTANT:\n- Acknowledge something SPECIFIC they mentioned (career change, background, interests, etc.)\n- Show genuine curiosity about their journey\n- Keep the acknowledgment brief (1-2 sentences)\n- Then smoothly transition into the first question: \"{firstQuestion}\"\n\nExample (if candidate mentioned career change):\n\"That's really interesting that you're making this shift into software engineering! I'm curious about that journey. {firstQuestion}\"\n\nExample (if candidate mentioned bootcamp):\n\"It's great to hear about your bootcamp experience - that takes real dedication. {firstQuestion}\"\n\nOutput only the combined acknowledgment + question, no JSON.\n`);\n\n    this.transitionChain = RunnableSequence.from([\n      transitionPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generateGreeting(\n    settings: TeamInterviewSettings,\n    companyName: string,\n    companyDescription: string,\n    jobTitle: string,\n    candidateName: string\n  ): Promise<{ greeting: string; activePersonaId: string }> {\n    const primaryPersona = settings.personas[0];\n    const secondaryPersona = settings.personas[1];\n\n    const greeting = await this.greetingChain.invoke({\n      companyName,\n      candidateName,\n      jobTitle,\n      experienceLevel: settings.experienceLevel,\n      primaryName: primaryPersona.name,\n      primaryRole: primaryPersona.displayRole,\n      primaryTone: getToneGuidance(primaryPersona.tone),\n      secondaryName: secondaryPersona?.name || 'colleague',\n      secondaryRole: secondaryPersona?.displayRole || 'team member',\n    });\n\n    return {\n      greeting: stripMarkdownCodeBlocks(greeting),\n      activePersonaId: primaryPersona.id,\n    };\n  }\n\n  async generateSecondaryIntro(\n    settings: TeamInterviewSettings,\n    companyName: string,\n    candidateName: string\n  ): Promise<{ intro: string; activePersonaId: string }> {\n    const primaryPersona = settings.personas[0];\n    const secondaryPersona = settings.personas[1];\n\n    if (!secondaryPersona) {\n      return { intro: '', activePersonaId: primaryPersona.id };\n    }\n\n    const levelContext = settings.experienceLevel === 'intern'\n      ? 'This is an intern interview - keep it friendly, low-pressure, and focus on making them comfortable.'\n      : settings.experienceLevel === 'junior'\n      ? 'This is a junior position - be approachable and welcoming.'\n      : 'Engage at the appropriate seniority level.';\n\n    const intro = await this.sarahIntroChain.invoke({\n      companyName,\n      candidateName,\n      experienceLevel: settings.experienceLevel,\n      primaryName: primaryPersona.name,\n      secondaryName: secondaryPersona.name,\n      secondaryRole: secondaryPersona.displayRole,\n      secondaryTone: getToneGuidance(secondaryPersona.tone),\n      levelContext,\n    });\n\n    return {\n      intro: stripMarkdownCodeBlocks(intro),\n      activePersonaId: secondaryPersona.id,\n    };\n  }\n\n  async generateTransitionToFirstQuestion(\n    settings: TeamInterviewSettings,\n    companyName: string,\n    candidateIntro: string,\n    firstQuestion: string\n  ): Promise<string> {\n    const primaryPersona = settings.personas[0];\n\n    const transition = await this.transitionChain.invoke({\n      personaName: primaryPersona.name,\n      personaRole: primaryPersona.displayRole,\n      companyName,\n      experienceLevel: settings.experienceLevel,\n      candidateIntro,\n      firstQuestion,\n    });\n\n    return stripMarkdownCodeBlocks(transition);\n  }\n}\n\nexport function getTeamInterviewSettings(seniority: string): TeamInterviewSettings {\n  const level = (['intern', 'junior', 'mid', 'senior', 'lead'].includes(seniority) \n    ? seniority \n    : 'junior') as ExperienceLevel;\n  \n  return TEAM_INTERVIEW_PRESETS[level];\n}\n\nexport function getLevelExpectationsText(settings: TeamInterviewSettings): string {\n  if (settings.evaluationRubric.length === 0) return '';\n  \n  return settings.evaluationRubric\n    .map(r => `${r.criterion}: ${r.levelExpectations[settings.experienceLevel]}`)\n    .join('\\n');\n}\n\nexport class TeamInterviewWrapUpChain {\n  private primaryClosingChain: RunnableSequence;\n  private secondaryClosingChain: RunnableSequence;\n\n  constructor() {\n    const primaryClosingPrompt = PromptTemplate.fromTemplate(`\nYou are {primaryName}, a {primaryRole} at {companyName}, wrapping up a team interview.\n\nINTERVIEW SUMMARY:\n- Candidate: {candidateName}\n- Position: {jobTitle} ({experienceLevel} level)\n- Questions Asked: {questionsAsked}\n- Topics Covered: {topicsCovered}\n\nGenerate a warm closing remark as the primary interviewer. The tone should be {primaryTone}.\n\nIMPORTANT:\n- Thank the candidate for their time\n- Mention you enjoyed the conversation\n- ASK if the candidate has any questions for you or the team\n- Keep it brief (2-3 sentences)\n\nExample:\n\"Thank you so much for chatting with us today, {candidateName}! I really enjoyed learning about your background. Before we wrap up, do you have any questions for us about the role or NovaPay?\"\n\nOutput only the closing text, no JSON.\n`);\n\n    const secondaryClosingPrompt = PromptTemplate.fromTemplate(`\nYou are {secondaryName}, a {secondaryRole} at {companyName}, giving final remarks in a team interview.\n\nCONTEXT:\n- Candidate: {candidateName}\n- Position: {jobTitle} ({experienceLevel} level)\n- Primary interviewer ({primaryName}) just asked the candidate if they have any questions\n\nGenerate brief, warm closing remarks. The tone should be {secondaryTone}.\n\nIMPORTANT:\n- Add a brief positive comment about the conversation\n- Explain next steps (team will review and get back within a week or so)\n- Thank the candidate for their time\n- Keep it brief (2-3 sentences)\n\nExample:\n\"It was great meeting you, {candidateName}! I really enjoyed our conversation. We'll review everything as a team and get back to you within the next week or so. Thanks again for your time!\"\n\nOutput only the closing text, no JSON.\n`);\n\n    this.primaryClosingChain = RunnableSequence.from([\n      primaryClosingPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n\n    this.secondaryClosingChain = RunnableSequence.from([\n      secondaryClosingPrompt,\n      new ChatGroq({\n        model: MODEL_NAME,\n        temperature: 0.7,\n        apiKey: process.env.GROQ_API_KEY,\n      }),\n      new StringOutputParser(),\n    ]);\n  }\n\n  async generateClosing(\n    settings: TeamInterviewSettings,\n    companyName: string,\n    jobTitle: string,\n    candidateName: string,\n    questionsAsked: number,\n    topicsCovered: string[]\n  ): Promise<{\n    primaryClosing: string;\n    secondaryClosing: string;\n    combinedClosing: string;\n  }> {\n    const primaryPersona = settings.personas[0];\n    const secondaryPersona = settings.personas[1];\n\n    const primaryClosingRaw = await this.primaryClosingChain.invoke({\n      companyName,\n      candidateName,\n      jobTitle,\n      experienceLevel: settings.experienceLevel,\n      questionsAsked: questionsAsked.toString(),\n      topicsCovered: topicsCovered.join(', ') || 'various topics',\n      primaryName: primaryPersona.name,\n      primaryRole: primaryPersona.displayRole,\n      primaryTone: getToneGuidance(primaryPersona.tone),\n      secondaryName: secondaryPersona?.name || 'my colleague',\n    });\n    const primaryClosing = stripMarkdownCodeBlocks(primaryClosingRaw);\n\n    let secondaryClosing = '';\n    if (secondaryPersona) {\n      const secondaryClosingRaw = await this.secondaryClosingChain.invoke({\n        companyName,\n        candidateName,\n        jobTitle,\n        experienceLevel: settings.experienceLevel,\n        primaryName: primaryPersona.name,\n        secondaryName: secondaryPersona.name,\n        secondaryRole: secondaryPersona.displayRole,\n        secondaryTone: getToneGuidance(secondaryPersona.tone),\n      });\n      secondaryClosing = stripMarkdownCodeBlocks(secondaryClosingRaw);\n    }\n\n    const combinedClosing = secondaryClosing \n      ? `${primaryClosing}\\n\\n${secondaryClosing}`\n      : primaryClosing;\n\n    return {\n      primaryClosing,\n      secondaryClosing,\n      combinedClosing,\n    };\n  }\n}\n","path":null,"size_bytes":23586,"size_tokens":null},"client/src/lib/persona-styles.ts":{"content":"export interface TeamPersona {\n  id: string;\n  name: string;\n  role: string;\n  displayRole: string;\n}\n\nexport interface PersonaStyle {\n  bgColor: string;\n  iconColor: string;\n  messageBg: string;\n  name: string;\n  displayRole: string;\n  borderColor: string;\n  accentColor: string;\n  ringColor: string;\n  textColor: string;\n  initials: string;\n}\n\nconst DEFAULT_STYLE: PersonaStyle = {\n  bgColor: 'bg-blue-100',\n  iconColor: 'text-blue-600',\n  messageBg: 'bg-blue-50',\n  name: 'Interviewer',\n  displayRole: '',\n  borderColor: 'border-blue-300',\n  accentColor: 'bg-blue-500',\n  ringColor: 'ring-blue-400',\n  textColor: 'text-blue-700',\n  initials: 'AI',\n};\n\ninterface RoleStyleConfig {\n  bgColor: string;\n  iconColor: string;\n  messageBg: string;\n  borderColor: string;\n  accentColor: string;\n  ringColor: string;\n  textColor: string;\n}\n\nconst ROLE_STYLES: Record<string, RoleStyleConfig> = {\n  tech_lead: {\n    bgColor: 'bg-purple-100',\n    iconColor: 'text-purple-600',\n    messageBg: 'bg-purple-50',\n    borderColor: 'border-purple-300',\n    accentColor: 'bg-purple-500',\n    ringColor: 'ring-purple-400',\n    textColor: 'text-purple-700',\n  },\n  peer_engineer: {\n    bgColor: 'bg-teal-100',\n    iconColor: 'text-teal-600',\n    messageBg: 'bg-teal-50',\n    borderColor: 'border-teal-300',\n    accentColor: 'bg-teal-500',\n    ringColor: 'ring-teal-400',\n    textColor: 'text-teal-700',\n  },\n  product_partner: {\n    bgColor: 'bg-orange-100',\n    iconColor: 'text-orange-600',\n    messageBg: 'bg-orange-50',\n    borderColor: 'border-orange-300',\n    accentColor: 'bg-orange-500',\n    ringColor: 'ring-orange-400',\n    textColor: 'text-orange-700',\n  },\n  engineering_manager: {\n    bgColor: 'bg-indigo-100',\n    iconColor: 'text-indigo-600',\n    messageBg: 'bg-indigo-50',\n    borderColor: 'border-indigo-300',\n    accentColor: 'bg-indigo-500',\n    ringColor: 'ring-indigo-400',\n    textColor: 'text-indigo-700',\n  },\n};\n\nfunction getInitials(name: string): string {\n  return name\n    .split(' ')\n    .map(n => n[0])\n    .join('')\n    .toUpperCase()\n    .slice(0, 2);\n}\n\nexport function getPersonaStyle(\n  personaId: string | undefined | null,\n  isTeamInterview: boolean,\n  teamPersonas: TeamPersona[]\n): PersonaStyle {\n  if (!personaId || !isTeamInterview || teamPersonas.length === 0) {\n    return DEFAULT_STYLE;\n  }\n\n  const persona = teamPersonas.find(p => p.id === personaId);\n  if (!persona) {\n    return DEFAULT_STYLE;\n  }\n\n  const roleStyle = ROLE_STYLES[persona.role] || {\n    bgColor: 'bg-blue-100',\n    iconColor: 'text-blue-600',\n    messageBg: 'bg-blue-50',\n    borderColor: 'border-blue-300',\n    accentColor: 'bg-blue-500',\n    ringColor: 'ring-blue-400',\n    textColor: 'text-blue-700',\n  };\n\n  return {\n    ...roleStyle,\n    name: persona.name,\n    displayRole: persona.displayRole,\n    initials: getInitials(persona.name),\n  };\n}\n\nexport function getPersonaById(personaId: string, teamPersonas: TeamPersona[]): TeamPersona | undefined {\n  return teamPersonas.find(p => p.id === personaId);\n}\n\nexport function getAllPersonaStyles(teamPersonas: TeamPersona[]): Array<PersonaStyle & { id: string }> {\n  return teamPersonas.map(persona => ({\n    id: persona.id,\n    ...getPersonaStyle(persona.id, true, teamPersonas),\n  }));\n}\n","path":null,"size_bytes":3239,"size_tokens":null},"client/src/components/simulation/team-interview-panel.tsx":{"content":"import { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\nimport { \n  getPersonaStyle, \n  getAllPersonaStyles, \n  type TeamPersona, \n  type PersonaStyle \n} from \"@/lib/persona-styles\";\nimport { Clock, Users, MessageCircle, Briefcase } from \"lucide-react\";\n\ninterface InterviewPanelHeaderProps {\n  jobTitle?: string;\n  companyName?: string;\n  difficulty: string;\n  currentQuestionIndex: number;\n  totalQuestions: number;\n  elapsedMinutes: number;\n  isTeamInterview: boolean;\n  teamPersonas: TeamPersona[];\n  activePersonaId: string | null;\n}\n\nexport function InterviewPanelHeader({\n  jobTitle,\n  companyName,\n  difficulty,\n  currentQuestionIndex,\n  totalQuestions,\n  elapsedMinutes,\n  isTeamInterview,\n  teamPersonas,\n  activePersonaId,\n}: InterviewPanelHeaderProps) {\n  const personaStyles = getAllPersonaStyles(teamPersonas);\n  \n  const getLevelBadgeColor = (level: string) => {\n    switch (level.toLowerCase()) {\n      case 'intern': return 'bg-green-100 text-green-700 border-green-200';\n      case 'junior': return 'bg-blue-100 text-blue-700 border-blue-200';\n      case 'mid': return 'bg-purple-100 text-purple-700 border-purple-200';\n      case 'senior': return 'bg-orange-100 text-orange-700 border-orange-200';\n      case 'lead': return 'bg-red-100 text-red-700 border-red-200';\n      default: return 'bg-gray-100 text-gray-700 border-gray-200';\n    }\n  };\n\n  return (\n    <div className=\"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 px-4 py-3\">\n      <div className=\"flex items-center justify-between gap-4\">\n        <div className=\"flex items-center gap-3 min-w-0\">\n          {companyName && (\n            <div className=\"flex items-center gap-2\">\n              <Briefcase className=\"h-4 w-4 text-gray-500\" />\n              <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300 truncate\">\n                {companyName}\n              </span>\n            </div>\n          )}\n          {jobTitle && (\n            <>\n              <span className=\"text-gray-300 dark:text-gray-600\"></span>\n              <span className=\"text-sm text-gray-600 dark:text-gray-400 truncate\">\n                {jobTitle}\n              </span>\n            </>\n          )}\n          <Badge \n            variant=\"outline\" \n            className={cn(\"text-xs capitalize shrink-0\", getLevelBadgeColor(difficulty))}\n          >\n            {difficulty} level\n          </Badge>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-400\">\n            <MessageCircle className=\"h-4 w-4\" />\n            <span className=\"font-medium\">{currentQuestionIndex + 1}</span>\n            <span className=\"text-gray-400\">/</span>\n            <span>{totalQuestions}</span>\n          </div>\n\n          <div className=\"flex items-center gap-1.5 text-sm text-gray-600 dark:text-gray-400\">\n            <Clock className=\"h-4 w-4\" />\n            <span>{elapsedMinutes}m</span>\n          </div>\n        </div>\n      </div>\n\n      {isTeamInterview && teamPersonas.length > 0 && (\n        <div className=\"mt-3 pt-3 border-t border-gray-100 dark:border-gray-800\">\n          <div className=\"flex items-center gap-2\">\n            <Users className=\"h-4 w-4 text-gray-500\" />\n            <span className=\"text-xs font-medium text-gray-500 uppercase tracking-wide\">\n              Interview Panel\n            </span>\n          </div>\n          <div className=\"mt-2 flex items-center gap-1\">\n            {personaStyles.map((style) => {\n              const isActive = style.id === activePersonaId;\n              return (\n                <div\n                  key={style.id}\n                  className={cn(\n                    \"relative flex items-center gap-2 px-3 py-1.5 rounded-full transition-all duration-200\",\n                    isActive \n                      ? `${style.bgColor} ${style.borderColor} border-2 shadow-sm` \n                      : \"bg-gray-50 dark:bg-gray-800 border border-transparent hover:bg-gray-100\"\n                  )}\n                  data-testid={`persona-chip-${style.id}`}\n                >\n                  {isActive && (\n                    <span className={cn(\n                      \"absolute -top-1 -right-1 h-3 w-3 rounded-full animate-pulse\",\n                      style.accentColor\n                    )} />\n                  )}\n                  <Avatar className={cn(\"h-6 w-6\", style.bgColor)}>\n                    <AvatarFallback className={cn(\"text-xs font-semibold\", style.textColor)}>\n                      {style.initials}\n                    </AvatarFallback>\n                  </Avatar>\n                  <span className={cn(\n                    \"text-sm font-medium\",\n                    isActive ? style.textColor : \"text-gray-600 dark:text-gray-400\"\n                  )}>\n                    {style.name}\n                  </span>\n                  {isActive && (\n                    <span className=\"text-xs text-gray-500\">\n                      (speaking)\n                    </span>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface PersonaRosterProps {\n  teamPersonas: TeamPersona[];\n  activePersonaId: string | null;\n  isTyping?: boolean;\n  className?: string;\n}\n\nexport function PersonaRoster({\n  teamPersonas,\n  activePersonaId,\n  isTyping = false,\n  className,\n}: PersonaRosterProps) {\n  const personaStyles = getAllPersonaStyles(teamPersonas);\n\n  if (teamPersonas.length === 0) {\n    return null;\n  }\n\n  return (\n    <div className={cn(\n      \"bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-700 p-4 w-56 shrink-0\",\n      className\n    )}>\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Users className=\"h-4 w-4 text-gray-500\" />\n        <h3 className=\"text-sm font-semibold text-gray-700 dark:text-gray-300\">\n          Interview Panel\n        </h3>\n      </div>\n      \n      <div className=\"space-y-2\">\n        {personaStyles.map((style) => {\n          const isActive = style.id === activePersonaId;\n          const isSpeaking = isActive && isTyping;\n          \n          return (\n            <div\n              key={style.id}\n              className={cn(\n                \"relative p-3 rounded-lg transition-all duration-200\",\n                isActive \n                  ? `${style.messageBg} ${style.borderColor} border-2` \n                  : \"bg-gray-50 dark:bg-gray-800 border border-transparent\"\n              )}\n              data-testid={`roster-persona-${style.id}`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <div className=\"relative\">\n                  <Avatar className={cn(\"h-10 w-10\", style.bgColor)}>\n                    <AvatarFallback className={cn(\"font-semibold\", style.textColor)}>\n                      {style.initials}\n                    </AvatarFallback>\n                  </Avatar>\n                  {isActive && (\n                    <span className={cn(\n                      \"absolute -bottom-0.5 -right-0.5 h-3.5 w-3.5 rounded-full border-2 border-white\",\n                      isSpeaking ? \"animate-pulse\" : \"\",\n                      style.accentColor\n                    )} />\n                  )}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <p className={cn(\n                    \"text-sm font-medium truncate\",\n                    isActive ? style.textColor : \"text-gray-700 dark:text-gray-300\"\n                  )}>\n                    {style.name}\n                  </p>\n                  <p className=\"text-xs text-gray-500 dark:text-gray-400 truncate\">\n                    {style.displayRole}\n                  </p>\n                </div>\n              </div>\n              \n              {isSpeaking && (\n                <div className=\"mt-2 flex items-center gap-1.5 text-xs text-gray-500\">\n                  <div className=\"flex gap-0.5\">\n                    <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                    <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                    <span className=\"w-1.5 h-1.5 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                  </div>\n                  <span>typing...</span>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\ninterface HandoffBannerProps {\n  fromPersona: PersonaStyle;\n  toPersona: PersonaStyle;\n}\n\nexport function HandoffBanner({ fromPersona, toPersona }: HandoffBannerProps) {\n  return (\n    <div className=\"flex items-center justify-center gap-2 py-2 px-4 bg-gray-50 dark:bg-gray-800 rounded-lg my-3\">\n      <div className=\"flex items-center gap-1.5\">\n        <Avatar className={cn(\"h-5 w-5\", fromPersona.bgColor)}>\n          <AvatarFallback className={cn(\"text-[10px] font-semibold\", fromPersona.textColor)}>\n            {fromPersona.initials}\n          </AvatarFallback>\n        </Avatar>\n        <span className=\"text-xs text-gray-500\">{fromPersona.name}</span>\n      </div>\n      <span className=\"text-gray-400\"></span>\n      <div className=\"flex items-center gap-1.5\">\n        <Avatar className={cn(\"h-5 w-5\", toPersona.bgColor)}>\n          <AvatarFallback className={cn(\"text-[10px] font-semibold\", toPersona.textColor)}>\n            {toPersona.initials}\n          </AvatarFallback>\n        </Avatar>\n        <span className={cn(\"text-xs font-medium\", toPersona.textColor)}>{toPersona.name}</span>\n      </div>\n      <span className=\"text-xs text-gray-500 ml-1\">is taking over</span>\n    </div>\n  );\n}\n\ninterface PersonaTypingIndicatorProps {\n  persona: PersonaStyle;\n  message?: string;\n}\n\nexport function PersonaTypingIndicator({ persona, message = \"is typing\" }: PersonaTypingIndicatorProps) {\n  return (\n    <div className=\"flex items-start space-x-3\">\n      <Avatar className={cn(\"h-10 w-10\", persona.bgColor)}>\n        <AvatarFallback className={cn(\"font-semibold\", persona.textColor)}>\n          {persona.initials}\n        </AvatarFallback>\n      </Avatar>\n      <div className={cn(\n        \"rounded-lg p-4 border-l-4\",\n        persona.messageBg,\n        persona.borderColor.replace('border-', 'border-l-')\n      )}>\n        <div className=\"flex items-center gap-2 mb-2\">\n          <span className={cn(\"text-sm font-semibold\", persona.textColor)}>\n            {persona.name}\n          </span>\n          {persona.displayRole && (\n            <span className=\"text-xs text-gray-500\">\n              ({persona.displayRole})\n            </span>\n          )}\n        </div>\n        <div className=\"flex items-center gap-2\">\n          <div className=\"flex gap-1\">\n            <span className={cn(\"w-2 h-2 rounded-full animate-bounce\", persona.accentColor)} style={{ animationDelay: '0ms' }} />\n            <span className={cn(\"w-2 h-2 rounded-full animate-bounce\", persona.accentColor)} style={{ animationDelay: '150ms' }} />\n            <span className={cn(\"w-2 h-2 rounded-full animate-bounce\", persona.accentColor)} style={{ animationDelay: '300ms' }} />\n          </div>\n          <span className=\"text-xs text-gray-500\">{message}...</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface EnhancedMessageBubbleProps {\n  role: 'interviewer' | 'candidate';\n  content: string;\n  personaStyle?: PersonaStyle | null;\n  isTeamInterview: boolean;\n  evaluation?: any;\n  showPersonaHeader?: boolean;\n}\n\nexport function EnhancedMessageBubble({\n  role,\n  content,\n  personaStyle,\n  isTeamInterview,\n  evaluation,\n  showPersonaHeader = true,\n}: EnhancedMessageBubbleProps) {\n  const isInterviewer = role === 'interviewer';\n  \n  if (!isInterviewer) {\n    return (\n      <div className=\"flex items-start space-x-3 flex-row-reverse space-x-reverse\">\n        <Avatar className=\"h-10 w-10 bg-green-100\">\n          <AvatarFallback className=\"text-green-600 font-semibold\">You</AvatarFallback>\n        </Avatar>\n        <div className=\"max-w-[70%]\">\n          <div className=\"bg-green-50 dark:bg-green-900/20 text-gray-900 dark:text-gray-100 rounded-lg p-4\">\n            <p className=\"whitespace-pre-wrap\">{content}</p>\n          </div>\n          {evaluation && (\n            <div className=\"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800\">\n              <div className=\"flex items-center gap-2 mb-1\">\n                <Badge variant={evaluation.score >= 7 ? \"default\" : evaluation.score >= 5 ? \"secondary\" : \"destructive\"}>\n                  Score: {evaluation.score}/10\n                </Badge>\n              </div>\n              {evaluation.feedback && (\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">{evaluation.feedback}</p>\n              )}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n\n  const style = personaStyle || {\n    bgColor: 'bg-blue-100',\n    iconColor: 'text-blue-600',\n    messageBg: 'bg-blue-50',\n    borderColor: 'border-blue-300',\n    accentColor: 'bg-blue-500',\n    textColor: 'text-blue-700',\n    name: 'Interviewer',\n    displayRole: '',\n    initials: 'AI',\n    ringColor: 'ring-blue-400',\n  };\n\n  return (\n    <div className=\"flex items-start space-x-3\">\n      <Avatar className={cn(\"h-10 w-10\", style.bgColor)}>\n        <AvatarFallback className={cn(\"font-semibold\", style.textColor)}>\n          {isTeamInterview && personaStyle ? style.initials : 'AI'}\n        </AvatarFallback>\n      </Avatar>\n      <div className=\"max-w-[70%]\">\n        <div className={cn(\n          \"rounded-lg p-4 text-gray-900 dark:text-gray-100\",\n          isTeamInterview ? `border-l-4 ${style.borderColor.replace('border-', 'border-l-')}` : \"\",\n          style.messageBg\n        )}>\n          {isTeamInterview && showPersonaHeader && personaStyle && personaStyle.name !== 'Interviewer' && (\n            <div className=\"flex items-center gap-2 mb-2 pb-2 border-b border-gray-200/50\">\n              <span className={cn(\"text-sm font-semibold\", style.textColor)}>\n                {style.name}\n              </span>\n              {style.displayRole && (\n                <Badge variant=\"outline\" className={cn(\"text-[10px] px-1.5 py-0\", style.borderColor)}>\n                  {style.displayRole}\n                </Badge>\n              )}\n            </div>\n          )}\n          <p className=\"whitespace-pre-wrap\">{content}</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":14582,"size_tokens":null},"server/scripts/test-team-interview.ts":{"content":"/**\n * Team Interview Quality Test Script\n * \n * Simulates a candidate going through a team interview with multiple personas\n * (Marcus - Engineering Manager, Sarah - Tech Lead) and evaluates:\n * - Persona handoffs and attribution\n * - Sequential message flow\n * - Interview closing/wrap-up\n * - Overall conversation quality\n */\n\nimport { InterviewOrchestrator } from '../services/interview-orchestrator';\nimport { ChatGroq } from '@langchain/groq';\nimport { storage } from '../storage';\n\ninterface ConversationTurn {\n  speaker: 'interviewer' | 'candidate';\n  message: string;\n  questionNumber?: number;\n  responseType?: 'complete' | 'vague' | 'partial' | 'asks_question' | 'offers_elaboration';\n  personaId?: string;\n  personaName?: string;\n}\n\ninterface TeamInterviewEvaluation {\n  personaConsistency: { score: number; reasoning: string };\n  handoffs: { score: number; reasoning: string };\n  closingFlow: { score: number; reasoning: string };\n  naturalness: { score: number; reasoning: string };\n  overallScore: number;\n  summary: string;\n  improvements: string[];\n  closingAnalysis: {\n    hadClosing: boolean;\n    closingPersona?: string;\n    closingQuality: string;\n  };\n}\n\ninterface IterationResult {\n  iteration: number;\n  questionCount: number;\n  conversation: ConversationTurn[];\n  evaluation: TeamInterviewEvaluation;\n  personaBreakdown: Record<string, number>;\n}\n\ntype ResponseType = 'complete' | 'vague' | 'partial' | 'asks_question' | 'offers_elaboration';\n\nfunction getRandomResponseType(): ResponseType {\n  const rand = Math.random();\n  if (rand < 0.5) return 'complete';           // 50% complete answers (interns should be more eager)\n  if (rand < 0.65) return 'partial';           // 15% partial answers\n  if (rand < 0.8) return 'vague';              // 15% vague answers\n  if (rand < 0.9) return 'offers_elaboration'; // 10% offers to elaborate\n  return 'asks_question';                       // 10% asks a question back\n}\n\n// Intern-level CV for 42 London student\nconst ARSEN_CV = `\nARSEN TADEVOSYAN\n42 London Student | Aspiring Software Engineer\n\nHIGHLIGHTS:\n Currently completing 42 London's intensive programming curriculum\n Strong foundation in C, algorithms, and Unix systems\n Self-taught web development (JavaScript, React basics)\n Collaborative project experience through 42's peer-learning model\n Quick learner with growth mindset\n\nEDUCATION:\n42 London (2024-Present)\n- Completed Common Core projects including Libft, ft_printf, get_next_line\n- Working on minishell and philosophers projects\n- Active participant in peer-to-peer code reviews\n\nPROJECTS:\nminishell (In Progress)\n- Building a bash-like shell in C\n- Implementing command parsing, pipes, redirections\n- Learning process management and signal handling\n\nft_printf (Completed)\n- Recreated printf function from scratch\n- Learned variadic functions and format specifiers\n\nPersonal Website (Self-taught)\n- Built portfolio site using React and Tailwind CSS\n- Deployed on Vercel\n\nSKILLS:\n- Languages: C, JavaScript, HTML/CSS, Python (basics)\n- Tools: Git, Make, VS Code, Terminal\n- Concepts: Algorithms, Data Structures, Memory Management\n\nINTERESTS:\n- Open source contribution (exploring first contributions)\n- Game development (Unity tutorials)\n- Tech podcasts and documentation reading\n`;\n\nclass SimulatedInternCandidate {\n  private model: ChatGroq;\n  private profile: { name: string; cv: string };\n\n  constructor(name: string, cv: string) {\n    this.profile = { name, cv };\n    this.model = new ChatGroq({\n      model: \"llama-3.1-8b-instant\",\n      temperature: 0.8,\n    });\n  }\n\n  async respond(\n    interviewerMessage: string, \n    conversationHistory: ConversationTurn[],\n    responseType: ResponseType,\n    personaName?: string\n  ): Promise<string> {\n    const historyText = conversationHistory.slice(-6)\n      .map(turn => {\n        const speaker = turn.speaker === 'interviewer' \n          ? (turn.personaName || 'Interviewer') \n          : 'You';\n        return `${speaker}: ${turn.message}`;\n      })\n      .join('\\n');\n\n    const responseInstructions = {\n      'complete': `Give a COMPLETE answer showing enthusiasm and willingness to learn.\n        Keep it SHORT: 2-3 sentences. Be genuine about being early in your career.\n        Example: \"At 42, I learned to debug by adding print statements first, then using gdb. I ask peers for help after about 30 minutes of being stuck.\"`,\n      \n      'vague': `Give a VAGUE, short answer. Show uncertainty typical of a junior.\n        ONE sentence only. Be honest about limited experience.\n        Example: \"I've worked on a few projects with other students.\" or \"I'm still learning that.\"`,\n      \n      'partial': `Give a PARTIAL answer - address part but miss something.\n        1-2 sentences. Show you're learning but haven't mastered everything.\n        Example: \"I use git for version control.\" (missing workflow details)`,\n      \n      'asks_question': `Ask a CLARIFYING QUESTION showing genuine curiosity.\n        1-2 sentences. Show you want to understand the question better.\n        Example: \"Could you give me an example of what you mean by that?\"`,\n      \n      'offers_elaboration': `Give a brief answer then OFFER TO ELABORATE more.\n        2 sentences. Show eagerness to share more about your learning.\n        Example: \"I worked on that in my minishell project. Would you like me to explain how I approached it?\"`,\n    };\n\n    const prompt = `You are ${this.profile.name}, an intern candidate interviewing for a software engineering internship.\nYou are a 42 London student, which means you're self-taught through peer learning (no teachers, no lectures).\n\nYOUR CV/BACKGROUND:\n${this.profile.cv}\n\nCONVERSATION SO FAR:\n${historyText}\n\n${personaName ? `NOTE: ${personaName} just asked this question.` : ''}\n\nINTERVIEWER'S LATEST MESSAGE:\n${interviewerMessage}\n\nRESPONSE INSTRUCTION (${responseType.toUpperCase()}):\n${responseInstructions[responseType]}\n\nKey traits to show:\n- Enthusiasm for learning\n- Honesty about what you don't know yet\n- Collaborative mindset from 42's peer learning\n- Problem-solving approach\n\nRespond naturally as this candidate would.\nYOUR RESPONSE (just the response, no prefix):`;\n\n    const response = await this.model.invoke(prompt);\n    return response.content.toString().trim();\n  }\n}\n\nclass TeamInterviewEvaluator {\n  private model: ChatGroq;\n\n  constructor() {\n    this.model = new ChatGroq({\n      model: \"llama-3.1-8b-instant\",\n      temperature: 0.2,\n    });\n  }\n\n  async evaluate(\n    conversation: ConversationTurn[],\n    personaBreakdown: Record<string, number>\n  ): Promise<TeamInterviewEvaluation> {\n    const conversationText = conversation\n      .map(turn => {\n        const typeLabel = turn.responseType ? ` [${turn.responseType}]` : '';\n        const personaLabel = turn.personaName ? ` (${turn.personaName})` : '';\n        return `[${turn.speaker.toUpperCase()}${personaLabel}${turn.questionNumber ? ` Q${turn.questionNumber}` : ''}${typeLabel}]: ${turn.message}`;\n      })\n      .join('\\n\\n');\n\n    const lastInterviewerMessages = conversation\n      .filter(t => t.speaker === 'interviewer')\n      .slice(-3);\n    \n    const hadClosing = lastInterviewerMessages.some(m => \n      m.message.toLowerCase().includes('thank you') ||\n      m.message.toLowerCase().includes('appreciate') ||\n      m.message.toLowerCase().includes('next steps') ||\n      m.message.toLowerCase().includes('questions for us')\n    );\n\n    const prompt = `You are an expert at evaluating team interview quality. This is a team interview for an Intern Software Engineer position with TWO interviewers:\n- Marcus: Engineering Manager (friendly, focuses on collaboration and growth)\n- Sarah: Tech Lead (technical, asks about problem-solving approach)\n\nPersona breakdown: ${JSON.stringify(personaBreakdown)}\n\nCONVERSATION:\n${conversationText}\n\nEvaluate the INTERVIEWERS' performance:\n\n1. PERSONA_CONSISTENCY (1-10): \n   - Did Marcus and Sarah maintain distinct personalities?\n   - Did their questions match their roles (Sarah = technical, Marcus = behavioral)?\n   - Were messages attributed to the correct persona?\n\n2. HANDOFFS (1-10):\n   - Were transitions between Marcus and Sarah natural?\n   - Did they build on each other's questions?\n   - Any awkward persona switches?\n\n3. CLOSING_FLOW (1-10):\n   - Did the interview have a proper closing?\n   - Was there opportunity for candidate questions?\n   - Did both personas participate in closing (or was it natural for one to lead)?\n\n4. NATURALNESS (1-10):\n   - Did it feel like a real team interview?\n   - Was the pace appropriate for an intern?\n   - Were questions calibrated for intern level (not too advanced)?\n\nAlso analyze the closing specifically and provide 3-5 improvements.\n\nRespond in JSON:\n{\n  \"personaConsistency\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"handoffs\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"closingFlow\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"naturalness\": {\"score\": <1-10>, \"reasoning\": \"<explanation>\"},\n  \"overallScore\": <weighted average>,\n  \"summary\": \"<overall assessment>\",\n  \"improvements\": [\"<improvement 1>\", \"<improvement 2>\", ...],\n  \"closingAnalysis\": {\n    \"hadClosing\": ${hadClosing},\n    \"closingPersona\": \"<which persona led the closing, if any>\",\n    \"closingQuality\": \"<brief assessment of how the interview ended>\"\n  }\n}`;\n\n    const response = await this.model.invoke(prompt);\n    let content = response.content.toString().trim();\n    \n    if (content.startsWith('```json')) content = content.slice(7);\n    else if (content.startsWith('```')) content = content.slice(3);\n    if (content.endsWith('```')) content = content.slice(0, -3);\n    \n    try {\n      return JSON.parse(content.trim());\n    } catch (e) {\n      console.error('Parse error:', content);\n      return {\n        personaConsistency: { score: 0, reasoning: 'Parse error' },\n        handoffs: { score: 0, reasoning: 'Parse error' },\n        closingFlow: { score: 0, reasoning: 'Parse error' },\n        naturalness: { score: 0, reasoning: 'Parse error' },\n        overallScore: 0,\n        summary: 'Failed to parse',\n        improvements: [],\n        closingAnalysis: { hadClosing: false, closingQuality: 'Unknown' }\n      };\n    }\n  }\n}\n\nasync function runTeamInterview(iteration: number): Promise<IterationResult> {\n  console.log(`\\n${'='.repeat(80)}`);\n  console.log(`TEAM INTERVIEW - ITERATION ${iteration}`);\n  console.log('='.repeat(80));\n  \n  const orchestrator = new InterviewOrchestrator();\n  \n  const jobContext = {\n    companyName: \"NovaPay\",\n    companyDescription: \"A fintech startup building modern payment solutions for small businesses.\",\n    jobTitle: \"Software Engineering Intern\",\n    jobRequirements: `\n      - Currently enrolled in or recently completed a coding bootcamp or CS program\n      - Basic proficiency in at least one programming language\n      - Familiarity with version control (Git)\n      - Eagerness to learn and collaborate\n      - Strong communication skills\n    `,\n    candidateCv: ARSEN_CV,\n    experienceLevel: 'intern' as const\n  };\n  \n  const candidate = new SimulatedInternCandidate(\"Arsen\", ARSEN_CV);\n  const conversation: ConversationTurn[] = [];\n  const personaBreakdown: Record<string, number> = {};\n  let questionCount = 0;\n  \n  // Start team interview\n  console.log('\\n[Starting team interview with Marcus and Sarah...]\\n');\n  \n  const { session, greeting, isPreludeMode, teamPersonas, activePersonaId } = await orchestrator.startInterview(\n    1, \"team\", \"Software Engineer\", \"intern\", 8, jobContext, \"Arsen\"\n  );\n  \n  // Parse the combined greeting JSON (contains both personas' messages)\n  let greetingMessages: Array<{personaId: string; content: string}> = [];\n  try {\n    const parsed = JSON.parse(greeting || '{}');\n    greetingMessages = parsed.messages || [];\n  } catch {\n    // Fallback if not JSON\n    greetingMessages = [{ personaId: activePersonaId || '', content: greeting || '' }];\n  }\n  \n  // Display each persona's greeting with proper attribution\n  for (const msg of greetingMessages) {\n    const persona = teamPersonas?.find((p: any) => p.id === msg.personaId);\n    const personaName = persona?.name || 'INTERVIEWER';\n    \n    // Track persona\n    if (personaName) {\n      personaBreakdown[personaName] = (personaBreakdown[personaName] || 0) + 1;\n    }\n    \n    console.log(`[${personaName} - Greeting]: ${msg.content}`);\n    conversation.push({ \n      speaker: 'interviewer', \n      message: msg.content,\n      personaId: msg.personaId,\n      personaName\n    });\n  }\n  \n  // Use the last greeting message for candidate's response context\n  const lastGreetingContent = greetingMessages.length > 0 \n    ? greetingMessages[greetingMessages.length - 1].content \n    : greeting || '';\n  const lastPersona = teamPersonas?.find((p: any) => p.id === activePersonaId);\n  \n  // Handle prelude (greetings) with complete responses\n  let candidateResponse = await candidate.respond(lastGreetingContent, conversation, 'complete', lastPersona?.name);\n  console.log(`[CANDIDATE]: ${candidateResponse}\\n`);\n  conversation.push({ speaker: 'candidate', message: candidateResponse, responseType: 'complete' });\n  \n  if (isPreludeMode) {\n    // Handle prelude exchanges\n    let preludeResult: any = await orchestrator.handlePreludeResponse(session.id, candidateResponse);\n    let currentPersonaName = lastPersona?.name;\n    \n    while (preludeResult.preludeMessage && !preludeResult.firstQuestion) {\n      // Track persona changes in prelude\n      if (preludeResult.activePersona) {\n        currentPersonaName = preludeResult.activePersona.name;\n        if (currentPersonaName) {\n          personaBreakdown[currentPersonaName] = (personaBreakdown[currentPersonaName] || 0) + 1;\n        }\n      }\n      \n      console.log(`[${currentPersonaName} - Prelude]: ${preludeResult.preludeMessage}`);\n      conversation.push({ \n        speaker: 'interviewer', \n        message: preludeResult.preludeMessage,\n        personaId: preludeResult.activePersona?.id,\n        personaName: currentPersonaName\n      });\n      \n      candidateResponse = await candidate.respond(preludeResult.preludeMessage, conversation, 'complete', currentPersonaName);\n      console.log(`[CANDIDATE]: ${candidateResponse}\\n`);\n      conversation.push({ speaker: 'candidate', message: candidateResponse, responseType: 'complete' });\n      \n      preludeResult = await orchestrator.handlePreludeResponse(session.id, candidateResponse);\n    }\n    \n    // First question\n    if (preludeResult.firstQuestion) {\n      questionCount++;\n      const questionPersonaName = preludeResult.activePersona?.name || currentPersonaName;\n      if (questionPersonaName) {\n        personaBreakdown[questionPersonaName] = (personaBreakdown[questionPersonaName] || 0) + 1;\n      }\n      \n      console.log(`[${questionPersonaName} - Q${questionCount}]: ${preludeResult.firstQuestion.questionText}`);\n      conversation.push({ \n        speaker: 'interviewer', \n        message: preludeResult.firstQuestion.questionText,\n        questionNumber: questionCount,\n        personaId: preludeResult.activePersona?.id,\n        personaName: questionPersonaName\n      });\n    }\n  }\n  \n  // Main interview loop\n  const maxQuestions = 15; // Safety limit\n  \n  while (questionCount < maxQuestions) {\n    const currentSession = await storage.getInterviewSession(session.id);\n    if (!currentSession || currentSession.status === 'completed') break;\n    \n    const questions = await storage.getInterviewQuestions(session.id);\n    const currentQuestion = questions[questions.length - 1];\n    if (!currentQuestion) break;\n    \n    // Get persona name for context\n    const lastInterviewerTurn = conversation.filter(t => t.speaker === 'interviewer').slice(-1)[0];\n    const currentPersonaName = lastInterviewerTurn?.personaName;\n    \n    // Varied response type\n    const responseType = getRandomResponseType();\n    candidateResponse = await candidate.respond(currentQuestion.questionText, conversation, responseType, currentPersonaName);\n    console.log(`[CANDIDATE] (${responseType}): ${candidateResponse}\\n`);\n    conversation.push({ speaker: 'candidate', message: candidateResponse, responseType });\n    \n    // Rate limit protection: wait 3 seconds before next API call\n    await new Promise(resolve => setTimeout(resolve, 3000));\n    \n    const result: any = await orchestrator.submitAnswer(session.id, currentQuestion.id, candidateResponse);\n    \n    // Check for closing\n    if (result.finalReport) {\n      if (result.closure) {\n        console.log(`\\n[CLOSING]: ${result.closure}`);\n        conversation.push({ \n          speaker: 'interviewer', \n          message: result.closure,\n          personaName: result.activePersona?.name || 'Team'\n        });\n      }\n      console.log('\\n[Interview completed - Final report generated]');\n      break;\n    }\n    \n    // Handle next question with persona tracking\n    if (result.nextQuestion) {\n      questionCount++;\n      const personaName = result.activePersona?.name;\n      if (personaName) {\n        personaBreakdown[personaName] = (personaBreakdown[personaName] || 0) + 1;\n      }\n      \n      let response = '';\n      if (result.reflection) response += result.reflection + ' ';\n      response += result.nextQuestion.questionText;\n      \n      console.log(`[${personaName || 'INTERVIEWER'} - Q${questionCount}]: ${response}`);\n      conversation.push({ \n        speaker: 'interviewer', \n        message: response,\n        questionNumber: questionCount,\n        personaId: result.activePersona?.id,\n        personaName\n      });\n      \n      // Handle addressed persona response (when one persona mentions another)\n      if (result.addressedPersonaResponse) {\n        const addressedName = result.addressedPersonaResponse.personaName;\n        personaBreakdown[addressedName] = (personaBreakdown[addressedName] || 0) + 1;\n        \n        console.log(`[${addressedName} - Follow-up]: ${result.addressedPersonaResponse.content}`);\n        conversation.push({\n          speaker: 'interviewer',\n          message: result.addressedPersonaResponse.content,\n          personaId: result.addressedPersonaResponse.personaId,\n          personaName: addressedName\n        });\n      }\n    }\n  }\n  \n  // Evaluate\n  console.log('\\n[Evaluating interview quality...]\\n');\n  const evaluator = new TeamInterviewEvaluator();\n  const evaluation = await evaluator.evaluate(conversation, personaBreakdown);\n  \n  console.log(`\\n--- Iteration ${iteration} Scores ---`);\n  console.log(`Persona Consistency: ${evaluation.personaConsistency.score}/10`);\n  console.log(`Handoffs: ${evaluation.handoffs.score}/10`);\n  console.log(`Closing Flow: ${evaluation.closingFlow.score}/10`);\n  console.log(`Naturalness: ${evaluation.naturalness.score}/10`);\n  console.log(`Overall: ${evaluation.overallScore}/10`);\n  console.log(`\\nPersona Breakdown:`, personaBreakdown);\n  console.log(`\\nClosing Analysis:`, JSON.stringify(evaluation.closingAnalysis, null, 2));\n  \n  return { iteration, questionCount, conversation, evaluation, personaBreakdown };\n}\n\nasync function runAllIterations(iterations: number = 1) {\n  console.log('\\n' + ''.repeat(80));\n  console.log('TEAM INTERVIEW QUALITY TEST');\n  console.log('Candidate: Arsen Tadevosyan (42 London Student)');\n  console.log('Position: Software Engineering Intern at NovaPay');\n  console.log('Interviewers: Marcus (Engineering Manager) & Sarah (Tech Lead)');\n  console.log(''.repeat(80));\n  \n  const results: IterationResult[] = [];\n  \n  for (let i = 1; i <= iterations; i++) {\n    try {\n      const result = await runTeamInterview(i);\n      results.push(result);\n      \n      if (i < iterations) {\n        await new Promise(resolve => setTimeout(resolve, 1000));\n      }\n    } catch (error: any) {\n      console.error(`\\nIteration ${i} failed:`, error.message);\n      console.error(error.stack);\n      if (error.message?.includes('Rate limit')) {\n        console.log('Rate limit hit - stopping test');\n        break;\n      }\n    }\n  }\n  \n  // Aggregate results\n  console.log('\\n' + ''.repeat(80));\n  console.log('AGGREGATE RESULTS');\n  console.log(''.repeat(80));\n  \n  if (results.length === 0) {\n    console.log('No successful iterations');\n    return;\n  }\n  \n  const avgPersona = results.reduce((sum, r) => sum + r.evaluation.personaConsistency.score, 0) / results.length;\n  const avgHandoffs = results.reduce((sum, r) => sum + r.evaluation.handoffs.score, 0) / results.length;\n  const avgClosing = results.reduce((sum, r) => sum + r.evaluation.closingFlow.score, 0) / results.length;\n  const avgNatural = results.reduce((sum, r) => sum + r.evaluation.naturalness.score, 0) / results.length;\n  const avgOverall = results.reduce((sum, r) => sum + r.evaluation.overallScore, 0) / results.length;\n  \n  console.log(`\\nAVERAGE SCORES (${results.length} iterations):`);\n  console.log(`  Persona Consistency: ${avgPersona.toFixed(1)}/10`);\n  console.log(`  Handoffs:           ${avgHandoffs.toFixed(1)}/10`);\n  console.log(`  Closing Flow:       ${avgClosing.toFixed(1)}/10`);\n  console.log(`  Naturalness:        ${avgNatural.toFixed(1)}/10`);\n  console.log(`  Overall:            ${avgOverall.toFixed(1)}/10`);\n  \n  // Closing analysis summary\n  console.log('\\nCLOSING ANALYSIS:');\n  results.forEach((r, i) => {\n    const ca = r.evaluation.closingAnalysis;\n    console.log(`  [${i + 1}] Had closing: ${ca.hadClosing ? 'Yes' : 'No'} | Lead: ${ca.closingPersona || 'N/A'} | Quality: ${ca.closingQuality}`);\n  });\n  \n  // Persona distribution\n  console.log('\\nPERSONA DISTRIBUTION:');\n  results.forEach((r, i) => {\n    console.log(`  [${i + 1}]`, r.personaBreakdown);\n  });\n  \n  console.log('\\nIMPROVEMENTS SUGGESTED:');\n  results.forEach((r, i) => {\n    console.log(`\\n  Iteration ${i + 1}:`);\n    r.evaluation.improvements.forEach((imp, j) => {\n      console.log(`    ${j + 1}. ${imp}`);\n    });\n  });\n  \n  console.log('\\nSUMMARIES:');\n  results.forEach((r, i) => {\n    console.log(`  [${i + 1}] ${r.evaluation.summary}`);\n  });\n  \n  console.log('\\n' + ''.repeat(80));\n  console.log('TEST COMPLETE');\n  console.log(''.repeat(80));\n}\n\n// Run with 1 iteration by default\nconst iterations = parseInt(process.argv[2] || '1', 10);\nrunAllIterations(iterations)\n  .then(() => process.exit(0))\n  .catch(error => {\n    console.error('Test failed:', error);\n    process.exit(1);\n  });\n","path":null,"size_bytes":22303,"size_tokens":null},"docs/PRODUCT_ROADMAP.md":{"content":"# edmap Product Roadmap\n\n## Vision\nHelp students go from **Intern  Junior Ready** by exposing them to real-world professional challenges through simulations, so they stand out when they graduate from any training program.\n\n---\n\n## Core Value Proposition\n\n| Without edmap | With edmap |\n|---------------|------------|\n| Graduate with theoretical knowledge | Graduate with simulated work experience |\n| First job = first exposure to real problems | Practiced handling real problems |\n| Struggle with soft skills | Already experienced soft skill challenges |\n| Portfolio = class projects | Portfolio = professional-grade artifacts + feedback |\n| \"Hire me, I can learn\" | \"Hire me, I've demonstrated readiness\" |\n\n---\n\n## Product Structure\n\n### Two Paths\n\n| Journey Path | Practice Path |\n|--------------|---------------|\n| Guided, Story-Driven | Targeted, Drill-Focused |\n| Problems arise in narrative context | User picks from catalogue |\n| Progression gates | Self-directed |\n| Blended tech + soft | Tech OR soft (isolated) |\n\n---\n\n## Problem Exposure Framework\n\n### Technical Problems (Role-Specific)\n\n| Developer | PM | QA | DevOps | Data Science |\n|-----------|----|----|--------|--------------|\n| Code bugs | Requirements conflicts | Test gaps | Infra failures | Data quality |\n| Git issues | Prioritization | Bug triage | Deployment issues | Model drift |\n| CI/CD failures | Stakeholder alignment | Regression | Monitoring alerts | Pipeline failures |\n| Performance | Roadmap changes | Automation | Scaling | Experiment design |\n\n### Soft Problems (Universal, Context Adapts)\n\n- Time pressure / deadlines\n- Peer conflicts / disagreements\n- Manager evaluations / performance feedback\n- Giving and receiving feedback\n- Ambiguous requirements / changing priorities\n- Explaining technical concepts to non-technical stakeholders\n\n---\n\n## Competency Framework\n\n### Three Layers\n\n| Layer | What It Measures |\n|-------|------------------|\n| **Foundational Habits** | Time management, asking for help, persistence, task hygiene |\n| **Core Delivery Skills** | Debugging, testing, git workflow, documentation, tool proficiency |\n| **Professional Impact** | Communication, feedback, collaboration, ownership, mentoring |\n\n### Mastery Bands\n\n```\nExplorer (just starting)\n     demonstrates basic habits, learns with guidance\nContributor (can deliver with guidance)\n     handles problems with less scaffolding, incorporates feedback\nJunior Ready (can deliver independently)\n     graduates with verified readiness\n```\n\n---\n\n## Complete User Journey (Updated)\n\n```\n\n                           PRE-HIRE PHASE                                     \n\n                                                                             \n    Job Board  Application  INTERVIEW SIMULATOR  Offer  Accept           \n                                                                             \n\n                                      \n                                      \n\n                           POST-HIRE PHASE                                    \n                        (Workspace Simulator)                                 \n\n                                                                             \n      \n                       WORKSPACE CREATED                                    \n                 (e.g., \"NovaPay\" workspace)                                \n                 Button: \"Open Workspace\"                                   \n      \n                                                                             \n                                                                             \n      \n                       ONBOARDING (one-time)                                \n      Meet the team (Sarah, Marcus, Priya, Alex, Jordan)                   \n      Read company & product documentation                                 \n      Comprehension check                                                  \n      Completes once, unlocks Sprint cycles                                \n      \n                                                                             \n                                                                             \n      \n                       SPRINT CYCLE (repeats)                               \n      \n                                                                            \n             \n                    SPRINT PLANNING                                        \n         Review product backlog                                           \n         Select priority items (features, bugs, tasks)                    \n         Break into smaller tasks                                         \n         Commit to sprint scope                                           \n         Outputs: Sprint Goal + Sprint Backlog                            \n             \n                                                                            \n                                                                            \n             \n                    SPRINT EXECUTION                                       \n         Daily Standups (recurring ceremony)                              \n         Kanban board work (pick up tickets, move columns)                \n         Git workflow (branches, commits, PRs)                            \n         Code review & collaboration                                      \n         Mid-sprint adjustments if needed                                 \n         When tickets done, unlocks Review                                \n             \n                                                                            \n                                                                            \n             \n                    SPRINT REVIEW                                          \n         Demo completed work to stakeholders                              \n         Get feedback on deliverables                                     \n         Unlocks Retrospective                                            \n             \n                                                                            \n                                                                            \n             \n                    SPRINT RETROSPECTIVE                                   \n         What went well?                                                  \n         What could improve?                                              \n         Action items for next sprint                                     \n             \n                                                                            \n                                                                            \n                   [Next Sprint] or [Graduate]                         \n      \n                                                                             \n                                                                             \n      \n                       JUNIOR READY!                                        \n                 (Portfolio + Badge)                                        \n      \n                                                                             \n\n```\n\n---\n\n## Workspace Phase Architecture\n\n### Phase Flow (replaces \"Days\" approach)\n\n| Phase | Type | Description | Gates |\n|-------|------|-------------|-------|\n| **Onboarding** | One-time | Team intros, docs, comprehension | Must complete before Sprint 1 |\n| **Sprint Planning** | Per-sprint | Backlog review, goal setting, commitment | Outputs Sprint Goal + Backlog |\n| **Sprint Execution** | Per-sprint | Daily work, standups, Kanban, Git | Tickets must be done for Review |\n| **Sprint Review** | Per-sprint | Demo to stakeholders, feedback | Completes before Retro |\n| **Sprint Retrospective** | Per-sprint | Reflection, action items | Triggers next sprint or graduation |\n\n### Phase State Machine\n\n```\n                    \n                                                                  \n                                                                  \n         \n  Onboarding   Planning     Execution     Review        Retro    \n   (once)      (per sprint)   (per sprint)   (per sprint)    (per sprint) \n         \n                                                                            \n                                                                            \n                                                                            \n   Complete  Next Sprint\n                                                                             or\n                                                                        Graduate\n                                                                    \n                                                                    \n```\n\n### Phase UI Components\n\n| Phase | Primary UI | Key Actions |\n|-------|-----------|-------------|\n| Onboarding | Team intro cards, doc reader, quiz | Meet team, read docs, pass comprehension |\n| Planning | Backlog table, goal editor | Select items, set goal, commit |\n| Execution | Kanban board, Git panel, standup modal | Move tickets, create branches, attend standups |\n| Review | Demo presenter, feedback collector | Present work, receive feedback |\n| Retro | Reflection cards, action items | Add went-well/improve items, commit to actions |\n\n---\n\n## Unified Architecture\n\n### Adapter + Catalogue Pattern (Both Simulators)\n\n```\n\n                    SIMULATION ENGINE (Shared)                    \n\n                                                                 \n          \n     INTERVIEW SIMULATOR          WORKSPACE SIMULATOR       \n          \n                                                            \n    ROLE ADAPTERS                ROLE ADAPTERS              \n     Developer                 Developer              \n     PM                        PM                     \n     QA                        QA                     \n     DevOps                    DevOps                 \n     Data Science              Data Science           \n                                                            \n    LEVEL ADAPTERS               LANGUAGE ADAPTERS          \n     Intern                    C/C++                  \n     Junior                    JavaScript             \n     Mid                       Python                 \n     Senior                                              \n                                 PHASE MODULES              \n    CATALOGUE                     OnboardingModule       \n     Behavioral Qs             PlanningModule         \n     Technical Qs              ExecutionModule        \n     System Design             ReviewModule           \n     Case Studies              RetroModule            \n          \n                                                                 \n     \n                    SHARED COMPONENTS                            \n   Competency Framework     Readiness Engine                   \n   Portfolio System         AI Orchestrator                    \n   Phase State Machine      Workspace Instance Manager         \n\n```\n\n---\n\n## Implementation Phases\n\n### Phase 0: Stabilize & Extract (1-2 weeks)\n**Goal**: De-risk refactoring by extracting hardcoded content\n\n| Simulator | Tasks |\n|-----------|-------|\n| Interview | Extract questions to JSON, extract rubrics, extract personas |\n| Workspace | Extract Day 1-2 content to JSON, extract team definitions |\n\n**Outcome**: Same UX, but content is data-driven\n\n**Status**:  Complete\n\n---\n\n### Phase 1: Shared Foundation (2-3 weeks)\n**Goal**: Build unified data layer\n\n**New Schema:**\n- `competencies` - Skills with rubrics per mastery band\n- `simulation_catalogue` - Questions/scenarios with adapter tags\n- `role_adapters` - Config per role\n- `competency_ledger` - User mastery scores\n- `portfolio_artifacts` - Collected work samples\n\n**Outcome**: Unified catalogue API for both simulators\n\n**Status**:  Complete\n\n---\n\n### Phase 2: Adapter Implementation (2-3 weeks)\n**Goal**: Role and level adapters for both simulators\n\n**Outcome**: Dynamic configuration based on user's role/level/language\n\n**Status**:  Complete\n\n---\n\n### Phase 3: Progression Engine & Narrative Schema (3 weeks)\n**Goal**: Unified competency tracking + narrative data structures\n\n**3A: Schema & Data Models (1 week)**\n- Add `journey_arcs` table (type, order, projectTemplateId, isFinalArc)\n- Add `sprints` table (arcId, sprintNumber, goal, backlog, state)\n- Add `sprint_tickets` table (sprintId, ticketKey, type, status)\n- Add `ceremony_instances` table (sprintId, ceremonyType, status)\n- Add `project_templates` table (team, codebase, themes, softSkillPacks)\n- Add `progression_paths` table (entryLevel, exitLevel, requirements, badge)\n\n**3B: Progression Engine (1 week)**\n- Delta Calculator: Compute competency changes after activities\n- Readiness Engine: Aggregate scores  mastery band\n- Exit Trigger Logic: Check readiness threshold, min/max sprints\n- Graduation Suggestion: Notify user when ready\n\n**3C: Progress Dashboard (1 week)**\n- Competency heatmap visualization\n- Journey timeline (arcs completed, current sprint)\n- Gap analysis and recommendations\n- Readiness score display\n\n**Status**:  Complete\n\n---\n\n### Phase 4: Dynamic Sprint Generation (3-4 weeks)\n**Goal**: AI-powered sprint assembly from catalogue templates\n\n**4A: Sprint Generator Service (1.5 weeks)**\n- Theme selection (avoiding recent themes)\n- Backlog generation from problem templates\n- User ticket assignment based on difficulty band\n- Soft skill event scheduling\n\n**4B: Problem Template Authoring (1 week)**\n- Create 20+ bug templates (timezone, null check, race condition, etc.)\n- Create 15+ feature templates (validation, error handling, etc.)\n- Create 10+ soft skill event templates\n- Cooldown and variety tracking\n\n**4C: Workspace Orchestrator Updates (1 week)**\n- Consume generated sprint payloads\n- Dynamic ceremony scripts (standup, planning, review, retro)\n- AI team member responses based on sprint context\n- Mid-sprint event injection\n\n**4D: Quality Guardrails (0.5 weeks)**\n- Validation: solvable, appropriate difficulty, narrative consistent\n- Fallback to scripted templates on generation failure\n- Telemetry for generated content quality\n\n**Status**:  Complete\n\n---\n\n### Phase 5: Workspace Phase Architecture (3-4 weeks) - IN PROGRESS\n**Goal**: Replace day-based flow with Scrum phase-based architecture\n\n> **Major Revision**: This phase now focuses on the complete workspace restructuring\n\n**5A: Workspace Instance System (1 week)**\n- Add `workspace_instances` table (userId, journeyId, jobApplicationId, status, currentPhase)\n- Add `workspace_phase_events` table (workspaceId, phase, status, completedAt, payload)\n- Create workspace on offer acceptance\n- Phase state machine with guards and transitions\n- API: `GET /api/workspaces/:id/state`\n\n**5B: Phase Modules (1.5 weeks)**\n- Extract onboarding content into `OnboardingModule` (team intros, docs, comprehension)\n- Create `PlanningModule` (backlog review, goal setting, commitment)\n- Create `ExecutionModule` (standups, Kanban, Git workflow)\n- Create `ReviewModule` (demo, stakeholder feedback)\n- Create `RetroModule` (reflection, action items)\n\n**5C: Dashboard & Navigation UX (1 week)**\n- Phase stepper component (Onboarding  Planning  Execution  Review  Retro)\n- Workspace hero card with \"Open Workspace\" CTA on Journey page\n- Phase-gated CTAs (can't enter Execution until Planning complete)\n- Breadcrumb navigation (Journey  Workspace  Phase)\n- \"Next Up\" panel showing required actions\n\n**5D: Ceremony Integration (0.5 weeks)**\n- Sprint Planning ceremony outputs Sprint Goal + Backlog\n- Daily Standup during Execution phase\n- Sprint Review ceremony at end of Execution\n- Sprint Retrospective before next sprint\n\n**Key Changes from Previous Design:**\n| Old (Day-based) | New (Phase-based) |\n|-----------------|-------------------|\n| Day 1, Day 2, Day 3, Day 4 | Onboarding  Planning  Execution  Review  Retro |\n| Linear day progression | Cyclical sprint phases |\n| All activities in monolithic component | Modular phase components |\n| Implicit sprint planning | Explicit Planning phase with outputs |\n| Standup on specific day | Standups throughout Execution phase |\n\n**Status**:  In Progress (restructuring from day-based to phase-based)\n\n---\n\n### Phase 6: Multi-Role Content Packs (2-3 weeks)\n**Goal**: Extend to PM, QA, DevOps, Data Science\n\n**Per Role:**\n- Problem templates appropriate to role\n- Soft skill events appropriate to role\n- Role-specific competencies\n- Interview adapters (question focus, cases)\n- Workspace adapters (problems, artifacts)\n\n**Per Level (InternJunior, JuniorMid, MidSenior):**\n- Level-specific problem templates\n- Level-specific soft skill events\n- Level-specific team dynamics\n- Difficulty band configurations\n\n**Content Required:**\n| Role | Bug Templates | Feature Templates | Soft Skill Events |\n|------|---------------|-------------------|-------------------|\n| Developer | 20 | 15 | 10 |\n| PM | N/A | 15 (requirements, roadmaps) | 15 |\n| QA | 15 (test scenarios) | 10 | 10 |\n| DevOps | 15 (infra issues) | 10 | 10 |\n| Data Science | 15 (data issues) | 10 | 10 |\n\n**Outcome**: Platform works for 5 roles  3 levels = 15 progression paths\n\n**Status**:  Planned\n\n---\n\n### Phase 7: Portfolio, Credentialing & Exit (2 weeks)\n**Goal**: Employer-facing differentiation + graduation flow\n\n**7A: Final 1:1 & Graduation (1 week)**\n- Journey review (all sprints, key moments)\n- Competency assessment visualization\n- Portfolio compilation (best PRs, docs, reviews)\n- Badge award (if thresholds met)\n- Exit experience  Portfolio view\n\n**7B: Portfolio System (1 week)**\n- Timeline view of artifacts\n- Competency breakdown\n- Feedback history from all 1:1s\n- Shareable profile / PDF export\n- Badge display\n\n**Outcome**: Graduates prove readiness with verifiable portfolio\n\n**Status**:  Planned\n\n---\n\n### Phase 8: Language Adapters (1-2 weeks)\n**Goal**: C/C++ and Python for Developer role\n\n| Language | Problem Adaptations |\n|----------|---------------------|\n| C/C++ | Memory bugs, segfaults, pointers, Makefiles, gtest |\n| Python | Type errors, async/await, pytest, venvs, imports |\n| JavaScript | (exists) Async bugs, npm, Jest, TypeScript |\n\n**Per Language:**\n- Code exercise templates\n- Bug patterns\n- Toolchain simulation (build, test, lint)\n- Error messages\n\n**Outcome**: Developer track for 3 tech stacks\n\n**Status**:  Planned\n\n---\n\n## Updated Timeline Summary\n\n| Phase | Duration | Focus | Status |\n|-------|----------|-------|--------|\n| Phase 0 | 1-2 weeks | Extract content to JSON |  Complete |\n| Phase 1 | 2-3 weeks | Shared schema, catalogue API |  Complete |\n| Phase 2 | 2-3 weeks | Role + Level adapters |  Complete |\n| Phase 3 | 3 weeks | Progression engine + narrative schema |  Complete |\n| Phase 4 | 3-4 weeks | Dynamic sprint generation |  Complete |\n| **Phase 5** | **3-4 weeks** | **Workspace phase architecture** |  In Progress |\n| Phase 6 | 2-3 weeks | Multi-role content packs |  Planned |\n| Phase 7 | 2 weeks | Portfolio + graduation |  Planned |\n| Phase 8 | 1-2 weeks | Language adapters |  Planned |\n\n**Total**: ~17-22 weeks for full implementation\n\n---\n\n## Phase 5 Implementation Details\n\n### Schema Changes Required\n\n```typescript\n// workspace_instances - created when offer is accepted\n{\n  id: serial,\n  userId: integer,\n  journeyId: integer,\n  jobApplicationId: integer,\n  projectTemplateId: integer,\n  companyName: text,\n  role: text,\n  status: 'active' | 'completed' | 'paused',\n  currentPhase: 'onboarding' | 'planning' | 'execution' | 'review' | 'retro',\n  currentSprintId: integer,\n  onboardingCompletedAt: timestamp,\n  createdAt: timestamp\n}\n\n// workspace_phase_events - tracks phase transitions\n{\n  id: serial,\n  workspaceId: integer,\n  phase: text,\n  sprintId: integer (nullable),\n  status: 'started' | 'completed',\n  payload: jsonb, // phase-specific outputs (e.g., sprint goal, retro actions)\n  completedAt: timestamp,\n  createdAt: timestamp\n}\n```\n\n### API Endpoints Required\n\n| Endpoint | Method | Purpose |\n|----------|--------|---------|\n| `/api/workspaces` | POST | Create workspace on offer accept |\n| `/api/workspaces/:id` | GET | Get workspace details |\n| `/api/workspaces/:id/state` | GET | Get current phase, checklist, next actions |\n| `/api/workspaces/:id/phase` | PATCH | Advance to next phase |\n| `/api/workspaces/:id/onboarding/complete` | POST | Complete onboarding |\n| `/api/workspaces/:id/planning/complete` | POST | Complete planning with goal/backlog |\n\n### UI Components Required\n\n| Component | Purpose |\n|-----------|---------|\n| `PhaseStepperComponent` | Visual phase progress indicator |\n| `WorkspaceHeroCard` | \"Open Workspace\" CTA on journey page |\n| `PhaseChecklist` | Required actions for current phase |\n| `NextUpPanel` | Upcoming ceremonies/actions |\n| `OnboardingModule` | Team intros, docs, comprehension |\n| `PlanningModule` | Backlog review, goal setting |\n| `ExecutionHub` | Kanban + standups + Git |\n| `ReviewModule` | Demo presenter |\n| `RetroModule` | Reflection cards |\n\n---\n\n## Phase Dependencies\n\n```\nPhase 0-4 (Complete)\n     \n     \nPhase 5: Workspace Phase Architecture \n                                                    \n                                                    \nPhase 6: Multi-Role Content \n                                                    \n     \n                                                    \n                                                    \nPhase 7: Portfolio + Graduation  Phase 8: Language Adapters\n```\n\n**Critical Path**: Phase 5  Phase 6  Phase 7\n\n---\n\n## Risk Assessment\n\n| Risk | Impact | Mitigation |\n|------|--------|------------|\n| AI generation quality inconsistent | High | Guardrails, fallback to scripted, human review flag |\n| AI generation costs too high | Medium | Caching, batched generation, cost monitoring |\n| Schema changes break existing features | High | Migrations, feature flags, backward compatibility |\n| Content authoring bottleneck | Medium | Prioritize Developer role, template-based approach |\n| Sprint generation too slow | Medium | Pre-generate next sprint, background processing |\n| Phase transition UX confusing | Medium | Clear stepper, contextual help, phase checklists |\n\n---\n\n## What's Already Built (Phases 0-4)\n\n| Component | Status | Location |\n|-----------|--------|----------|\n| Catalogue JSON files |  | `shared/catalogue/workspace/`, `shared/catalogue/interview/` |\n| Catalogue service |  | `shared/catalogue/service.ts` |\n| Database tables (competencies, catalogue, role_adapters) |  | `shared/schema.ts` |\n| Adapter service |  | `server/services/adapter-service.ts` |\n| Sprint schema (sprints, tickets, ceremonies) |  | `shared/schema.ts` |\n| Sprint Hub (Kanban board) |  | `client/src/pages/sprint-hub.tsx` |\n| Journey Dashboard |  | `client/src/pages/journey-dashboard.tsx` |\n| Ceremony Session component |  | `client/src/components/simulation/ceremony-session.tsx` |\n| Git workflow simulation |  | `client/src/lib/git-simulator.ts` |\n| Sprint generator service |  | `server/services/sprint-generator-service.ts` |\n\n## What Needs to Be Built (Phase 5)\n\n| Component | Priority | Description |\n|-----------|----------|-------------|\n| `workspace_instances` schema | P0 | Track workspace per accepted offer |\n| `workspace_phase_events` schema | P0 | Track phase transitions |\n| Workspace state machine | P0 | Phase guards and transitions |\n| Workspace creation on offer accept | P0 | Trigger workspace instance creation |\n| PhaseStepperComponent | P0 | Visual phase indicator |\n| WorkspaceHeroCard | P0 | \"Open Workspace\" CTA |\n| OnboardingModule | P0 | Extract from intern-onboarding-session |\n| PlanningModule | P0 | New: Backlog review, goal setting |\n| Phase-gated navigation | P1 | Can't skip phases |\n| NextUpPanel | P1 | Show required actions |\n| Breadcrumb navigation | P1 | Journey  Workspace  Phase |\n\n---\n\n## Key Files Reference\n\n| File | Purpose |\n|------|---------|\n| `client/src/components/simulation/intern-onboarding-session.tsx` | Current onboarding (to be refactored into OnboardingModule) |\n| `client/src/pages/journey-dashboard.tsx` | Journey dashboard (needs phase stepper) |\n| `client/src/pages/sprint-hub.tsx` | Sprint execution UI (Kanban) |\n| `client/src/components/simulation/ceremony-session.tsx` | Ceremony chat UI |\n| `server/services/workspace-orchestrator.ts` | AI team member responses |\n| `shared/schema.ts` | Database schema (needs workspace_instances) |\n\n---\n\n## Design Decisions\n\n1. **Phase-Based, Not Day-Based**: Workspace progression follows Scrum phases, not arbitrary days\n2. **Onboarding is One-Time**: Happens once per workspace, before first sprint\n3. **Sprint Cycle is Repeatable**: Planning  Execution  Review  Retro cycles\n4. **Explicit Planning Outputs**: Sprint Goal and Backlog are captured artifacts\n5. **Phase Gates**: Can't skip phases; must complete current before advancing\n6. **Ceremony Integration**: Standups during Execution, Review/Retro are phase transitions\n\n---\n\n## Success Metrics\n\n- Users reach \"Junior Ready\" status\n- Portfolio artifacts demonstrate growth\n- Employers value the credential\n- Works across different training programs\n- Supports multiple career tracks\n- Users understand their current phase and next actions\n- Phase completion rates are high (low drop-off)\n\n---\n\n## Future: Enterprise Self-Serve Layer (Phase 9+)\n\n### Vision\nEnable B2B clients (bootcamps, coding schools, universities) to configure custom curricula through a self-serve portal, with simulations automatically assembled from the catalogue.\n\n(Enterprise layer details remain as previously documented)\n","path":null,"size_bytes":34696,"size_tokens":null},"shared/catalogue/README.md":{"content":"# edmap Simulation Catalogue\n\nThis directory contains the extracted content for both Interview and Workspace simulators, organized as JSON files that can be queried, filtered, and adapted based on role, level, and language.\n\n## Directory Structure\n\n```\nshared/catalogue/\n index.json                   # Catalogue index and structure definition\n README.md                    # This file\n interview/                   # Interview Simulator content\n    question-banks.json          # Questions by role/type/level\n    interview-config.json        # Types, roles, difficulties, settings\n    evaluation-rubrics.json      # Scoring and evaluation criteria\n    team-personas.json           # Panel interview personas\n workspace/                   # Workspace Simulator content\n     team-members.json            # Team member definitions\n     documentation-day1.json      # Day 1 onboarding docs\n     activities-day1.json         # Day 1 activities\n     activities-day2.json         # Day 2 activities\n     ticket-timezone-bug.json     # Day 2 ticket definition\n     standup-script.json          # Day 2 standup meeting script\n     dev-setup-steps.json         # Dev environment setup commands\n     git-workflow-steps.json      # Git commands (add, commit, push)\n     codebase-structure.json      # Simulated file tree for exploration\n     code-exercise-timezone.json  # Timezone bug fix exercise\n     branch-creation.json         # Branch creation exercise\n```\n\n## Content Types\n\n### Interview Catalogue\n\n| File | Purpose |\n|------|---------|\n| `question-banks.json` | Interview questions organized by role (developer, PM, etc.), type (behavioral, technical), and level (junior, mid, senior) |\n| `interview-config.json` | Configuration for interview types, stage settings, assessment criteria |\n| `evaluation-rubrics.json` | Scoring scales, evaluation dimensions, final report structure |\n| `team-personas.json` | Panel interview personas with roles, styles, and team configurations |\n\n### Workspace Catalogue\n\n| File | Purpose |\n|------|---------|\n| `team-members.json` | Team member definitions with personalities, expertise, and avatar configs |\n| `documentation-day1.json` | Product documentation, team norms, development workflow |\n| `activities-day1.json` | Day 1 activities: read docs, meet team, comprehension check |\n| `activities-day2.json` | Day 2 activities: standup, dev setup, coding, git, PR |\n| `ticket-timezone-bug.json` | Ticket definition with title, description, acceptance criteria |\n| `standup-script.json` | Daily standup meeting script with timed team messages |\n| `dev-setup-steps.json` | Dev environment setup: clone, cd, npm install, npm run dev |\n| `git-workflow-steps.json` | Git workflow: stage, commit, push with validation |\n| `codebase-structure.json` | Simulated project file tree for codebase exploration |\n| `code-exercise-timezone.json` | Code fix exercise with blanks, validation, test scenarios |\n| `branch-creation.json` | Branch creation with naming conventions and validation |\n\n## Adapter Pattern\n\nContent is designed to be adapted based on:\n\n### Role Adapters\n- **Developer**: Technical problems, code-focused scenarios\n- **PM**: Requirements, prioritization scenarios\n- **QA**: Testing, edge case scenarios\n- **DevOps**: Infrastructure, deployment scenarios\n- **Data Science**: Data pipeline, ML scenarios\n\n### Level Adapters\n- **Intern**: Basic concepts, more guidance\n- **Junior**: Foundational skills, standard complexity\n- **Mid**: Increased complexity, less guidance\n- **Senior**: Advanced challenges, leadership aspects\n\n### Language Adapters (Developer only)\n- **JavaScript**: React, Node.js, npm, Jest\n- **Python**: Django/Flask, pip, pytest\n- **C/C++**: Memory management, compilation, gtest\n\n## Usage\n\n### Catalogue Service (Recommended)\n\nThe catalogue service provides a query-based interface that mirrors the Phase 1 API signature. Components should use this service instead of direct JSON imports to enable seamless transition to the database-backed API.\n\n```typescript\nimport { catalogue, getCatalogueItems } from '@shared/catalogue/service';\n\n// Query-based access (matches future API signature)\nconst items = await getCatalogueItems({\n  simulator: 'workspace',\n  type: 'standup_script',\n  role: 'developer',\n  day: 2\n});\n\n// Typed convenience methods\nconst standupContent = await catalogue.getStandupScript({ day: 2 });\nconst devSetupContent = await catalogue.getDevSetupSteps({ role: 'developer' });\nconst gitWorkflowContent = await catalogue.getGitWorkflowSteps();\nconst codebaseContent = await catalogue.getCodebaseStructure();\nconst codeExerciseContent = await catalogue.getCodeExercise();\nconst branchContent = await catalogue.getBranchCreation();\nconst interviewConfig = await catalogue.getInterviewConfig();\n\n// Access specific item by ID\nconst item = await catalogue.getItem('workspace-standup-day2');\n```\n\n### CatalogueItem Structure\n\nEach item returned by the service has a normalized structure:\n\n```typescript\ninterface CatalogueItem<T> {\n  meta: {\n    id: string;           // Unique identifier\n    type: string;         // Content type (e.g., 'standup_script')\n    simulator: string;    // 'workspace' or 'interview'\n    version: string;      // Content version\n    role?: string;        // 'developer', 'pm', 'qa', etc.\n    level?: string;       // 'intern', 'junior', 'mid', 'senior'\n    language?: string;    // 'javascript', 'python', 'c_cpp'\n    day?: number;         // Day number for daily content\n  };\n  content: T;             // Type-specific content\n}\n```\n\n### Direct JSON Import (Legacy)\n\nFor simple cases, direct imports are still supported:\n\n```typescript\nimport teamMembers from '@shared/catalogue/workspace/team-members.json';\nimport questionBanks from '@shared/catalogue/interview/question-banks.json';\n\nconst members = teamMembers.content.members;\nconst questions = questionBanks.content.roles.software_engineer.types.behavioral.junior;\n```\n\n### Validation Helpers\n\nThe loaders module provides validation functions for user input:\n\n```typescript\nimport { \n  validateSetupCommand, \n  validateGitCommand, \n  validateBranchName,\n  validateCodeBlank \n} from '@shared/catalogue/loaders';\n\n// Validate dev setup command\nconst isValid = validateSetupCommand(userInput, setupStep);\n\n// Validate git command\nconst gitValid = validateGitCommand(userInput, gitStep);\n\n// Validate branch name\nconst branchValid = validateBranchName(userInput, branchConfig);\n\n// Validate code exercise blank\nconst codeValid = validateCodeBlank(userInput, blankConfig);\n```\n\n## Phase 1 Transition\n\nThe service layer is designed for seamless Phase 1 transition:\n\n| Phase 0 (Current) | Phase 1 (Future) |\n|-------------------|------------------|\n| Service loads JSON files | Service calls `/api/catalogue` API |\n| In-memory filtering | Database queries with adapter tags |\n| Static content | Dynamic, database-backed content |\n\n**No component changes required** - components that use the service layer will work unchanged in Phase 1.\n\n## Version History\n\n| Version | Date | Changes |\n|---------|------|---------|\n| 1.0.0 | Jan 2025 | Initial extraction from hardcoded content (Phase 0) |\n\n## Next Steps (Phase 1+)\n\n1. Create TypeScript types for catalogue content\n2. Build catalogue API endpoints (`GET /api/catalogue`)\n3. Create adapter functions for role/level/language\n4. Migrate components to consume catalogue data\n5. Add enterprise customization layer\n","path":null,"size_bytes":7593,"size_tokens":null},"shared/catalogue/loaders.ts":{"content":"import { z } from \"zod\";\n\n// ============================================================================\n// WORKSPACE CATALOGUE SCHEMAS\n// ============================================================================\n\nexport const TeamMemberSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  role: z.string(),\n  personality: z.string(),\n  expertise: z.array(z.string()),\n  availability: z.string(),\n  bio: z.string().optional(),\n  avatar: z.object({\n    seed: z.string(),\n    style: z.string(),\n    backgroundColor: z.string()\n  })\n});\n\nexport const StandupMessageSchema = z.object({\n  id: z.string(),\n  sender: z.string(),\n  role: z.string(),\n  content: z.string(),\n  delay: z.number(),\n  order: z.number(),\n  isUserCue: z.boolean().optional(),\n  placeholder: z.string().optional()\n});\n\nexport const StandupScriptSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"standup_script\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string()\n  }),\n  content: z.object({\n    meeting: z.object({\n      name: z.string(),\n      team: z.string(),\n      time: z.string(),\n      format: z.string()\n    }),\n    script: z.array(StandupMessageSchema),\n    userGuidance: z.object({\n      promptAfterScript: z.string(),\n      exampleUpdates: z.array(z.string()),\n      tips: z.array(z.string())\n    })\n  })\n});\n\nexport const SetupStepSchema = z.object({\n  id: z.string(),\n  order: z.number(),\n  instruction: z.string(),\n  hint: z.string(),\n  validPatterns: z.array(z.string()),\n  validationRules: z.object({\n    mustInclude: z.array(z.string()).optional(),\n    mustIncludeAny: z.array(z.string()).optional(),\n    exactMatch: z.array(z.string()).optional()\n  }),\n  successOutput: z.string(),\n  acceptedCommands: z.array(z.string())\n});\n\nexport const DevSetupStepsSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"dev_setup_steps\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string()\n  }),\n  content: z.object({\n    introduction: z.object({\n      title: z.string(),\n      description: z.string()\n    }),\n    project: z.object({\n      name: z.string(),\n      org: z.string(),\n      repoUrl: z.string()\n    }),\n    steps: z.array(SetupStepSchema)\n  })\n});\n\nexport const GitStepSchema = z.object({\n  id: z.string(),\n  order: z.number(),\n  instruction: z.string(),\n  hint: z.string(),\n  validPatterns: z.array(z.string()),\n  validationRules: z.object({\n    mustStartWith: z.array(z.string()).optional(),\n    mustContainAnyQuote: z.array(z.string()).optional(),\n    mustContainAnyKeyword: z.array(z.string()).optional()\n  }),\n  successOutput: z.string(),\n  acceptedCommands: z.array(z.string())\n});\n\nexport const GitWorkflowStepsSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"git_workflow_steps\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string()\n  }),\n  content: z.object({\n    introduction: z.object({\n      title: z.string(),\n      description: z.string()\n    }),\n    steps: z.array(GitStepSchema)\n  })\n});\n\nexport const FileNodeSchema: z.ZodType<any> = z.lazy(() =>\n  z.object({\n    name: z.string(),\n    type: z.enum([\"folder\", \"file\"]),\n    highlight: z.boolean().optional(),\n    target: z.boolean().optional(),\n    children: z.array(FileNodeSchema).optional()\n  })\n);\n\nexport const CodebaseStructureSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"codebase_structure\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string()\n  }),\n  content: z.object({\n    introduction: z.object({\n      title: z.string(),\n      description: z.string()\n    }),\n    targetFile: z.object({\n      name: z.string(),\n      path: z.string(),\n      description: z.string()\n    }),\n    fileStructure: z.array(FileNodeSchema)\n  })\n});\n\nexport const CodeBlankSchema = z.object({\n  id: z.string(),\n  placeholder: z.string(),\n  correctAnswer: z.string(),\n  hint: z.string(),\n  caseSensitive: z.boolean()\n});\n\nexport const CodeExerciseSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"code_exercise\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string(),\n    ticketId: z.string()\n  }),\n  content: z.object({\n    introduction: z.object({\n      title: z.string(),\n      description: z.string()\n    }),\n    file: z.object({\n      path: z.string(),\n      name: z.string()\n    }),\n    codeTemplate: z.object({\n      language: z.string(),\n      code: z.string()\n    }),\n    blanks: z.array(CodeBlankSchema),\n    testScenario: z.object({\n      title: z.string(),\n      description: z.string(),\n      beforeFix: z.object({\n        input: z.string(),\n        output: z.string(),\n        explanation: z.string()\n      }),\n      afterFix: z.object({\n        input: z.string(),\n        output: z.string(),\n        explanation: z.string()\n      })\n    })\n  })\n});\n\nexport const BranchCreationSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"branch_creation\"),\n  metadata: z.object({\n    day: z.number(),\n    role: z.string(),\n    language: z.string()\n  }),\n  content: z.object({\n    introduction: z.object({\n      title: z.string(),\n      description: z.string()\n    }),\n    whyBranch: z.array(z.object({\n      icon: z.string(),\n      title: z.string(),\n      description: z.string()\n    })),\n    namingConvention: z.object({\n      pattern: z.string(),\n      examples: z.array(z.object({\n        name: z.string(),\n        description: z.string()\n      })),\n      badExamples: z.array(z.object({\n        name: z.string(),\n        reason: z.string()\n      }))\n    }),\n    validation: z.object({\n      validPrefixes: z.array(z.string()),\n      mustContainKeywords: z.array(z.string()),\n      minLength: z.number(),\n      maxLength: z.number(),\n      regex: z.string()\n    }),\n    successMessage: z.object({\n      title: z.string(),\n      description: z.string()\n    })\n  })\n});\n\n// ============================================================================\n// INTERVIEW CATALOGUE SCHEMAS\n// ============================================================================\n\nexport const InterviewQuestionSchema = z.object({\n  id: z.string(),\n  text: z.string(),\n  followUps: z.array(z.string()).optional(),\n  evaluationCriteria: z.array(z.string()).optional(),\n  timeEstimate: z.string().optional()\n});\n\nexport const QuestionBanksSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"question_bank\"),\n  metadata: z.object({\n    lastUpdated: z.string(),\n    totalQuestions: z.number()\n  }),\n  content: z.object({\n    roles: z.record(z.object({\n      types: z.record(z.record(z.array(InterviewQuestionSchema)))\n    }))\n  })\n});\n\nexport const InterviewPersonaSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  role: z.string(),\n  title: z.string(),\n  personality: z.string(),\n  focusAreas: z.array(z.string()),\n  style: z.object({\n    primaryColor: z.string(),\n    backgroundColor: z.string(),\n    borderColor: z.string(),\n    iconColor: z.string()\n  }),\n  promptGuidance: z.object({\n    tone: z.string(),\n    priorities: z.array(z.string()),\n    avoidTopics: z.array(z.string()).optional()\n  })\n});\n\nexport const TeamPersonasSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"team_personas\"),\n  metadata: z.object({\n    lastUpdated: z.string()\n  }),\n  content: z.object({\n    personas: z.record(InterviewPersonaSchema),\n    teamConfigurations: z.record(z.object({\n      name: z.string(),\n      description: z.string(),\n      personas: z.array(z.string()),\n      interviewFlow: z.object({\n        introduction: z.string(),\n        questionDistribution: z.record(z.number()),\n        transitions: z.record(z.string())\n      })\n    }))\n  })\n});\n\nexport const EvaluationRubricsSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"evaluation_rubrics\"),\n  metadata: z.object({\n    lastUpdated: z.string()\n  }),\n  content: z.object({\n    scoringScale: z.object({\n      min: z.number(),\n      max: z.number(),\n      labels: z.record(z.string())\n    }),\n    evaluationDimensions: z.record(z.object({\n      name: z.string(),\n      weight: z.number(),\n      criteria: z.array(z.object({\n        level: z.number(),\n        description: z.string()\n      }))\n    })),\n    finalReportStructure: z.object({\n      sections: z.array(z.object({\n        id: z.string(),\n        title: z.string(),\n        type: z.string()\n      }))\n    })\n  })\n});\n\nexport const InterviewConfigSchema = z.object({\n  version: z.string(),\n  type: z.literal(\"interview_configuration\"),\n  metadata: z.object({\n    lastUpdated: z.string()\n  }),\n  content: z.object({\n    targetRoles: z.array(z.object({\n      id: z.string(),\n      label: z.string(),\n      description: z.string()\n    })),\n    interviewTypes: z.array(z.object({\n      id: z.string(),\n      label: z.string(),\n      description: z.string(),\n      questionTypes: z.array(z.string())\n    })),\n    difficulties: z.array(z.object({\n      id: z.string(),\n      label: z.string(),\n      description: z.string()\n    })),\n    stageSettings: z.record(z.object({\n      name: z.string(),\n      durationMinutes: z.number().optional(),\n      instructions: z.string().optional()\n    }))\n  })\n});\n\n// ============================================================================\n// TYPE EXPORTS\n// ============================================================================\n\nexport type TeamMember = z.infer<typeof TeamMemberSchema>;\nexport type StandupMessage = z.infer<typeof StandupMessageSchema>;\nexport type StandupScript = z.infer<typeof StandupScriptSchema>;\nexport type SetupStep = z.infer<typeof SetupStepSchema>;\nexport type DevSetupSteps = z.infer<typeof DevSetupStepsSchema>;\nexport type GitStep = z.infer<typeof GitStepSchema>;\nexport type GitWorkflowSteps = z.infer<typeof GitWorkflowStepsSchema>;\nexport type FileNode = z.infer<typeof FileNodeSchema>;\nexport type CodebaseStructure = z.infer<typeof CodebaseStructureSchema>;\nexport type CodeBlank = z.infer<typeof CodeBlankSchema>;\nexport type CodeExercise = z.infer<typeof CodeExerciseSchema>;\nexport type BranchCreation = z.infer<typeof BranchCreationSchema>;\nexport type InterviewQuestion = z.infer<typeof InterviewQuestionSchema>;\nexport type QuestionBanks = z.infer<typeof QuestionBanksSchema>;\nexport type InterviewPersona = z.infer<typeof InterviewPersonaSchema>;\nexport type TeamPersonas = z.infer<typeof TeamPersonasSchema>;\nexport type EvaluationRubrics = z.infer<typeof EvaluationRubricsSchema>;\nexport type InterviewConfig = z.infer<typeof InterviewConfigSchema>;\n\n// ============================================================================\n// VALIDATION HELPERS\n// ============================================================================\n\nexport function validateSetupCommand(input: string, step: SetupStep): boolean {\n  const normalized = input.trim().toLowerCase();\n  \n  if (step.validationRules.exactMatch) {\n    return step.validationRules.exactMatch.some(cmd => \n      normalized === cmd.toLowerCase()\n    );\n  }\n  \n  if (step.validationRules.mustInclude) {\n    const allContained = step.validationRules.mustInclude.every(term =>\n      normalized.includes(term.toLowerCase())\n    );\n    if (!allContained) return false;\n  }\n  \n  if (step.validationRules.mustIncludeAny) {\n    const anyContained = step.validationRules.mustIncludeAny.some(term =>\n      normalized.includes(term.toLowerCase())\n    );\n    if (!anyContained) return false;\n  }\n  \n  if (step.validPatterns && step.validPatterns.length > 0) {\n    return step.validPatterns.some(pattern => {\n      try {\n        const regex = new RegExp(pattern, 'i');\n        return regex.test(input.trim());\n      } catch {\n        return false;\n      }\n    });\n  }\n  \n  return true;\n}\n\nexport function validateGitCommand(input: string, step: GitStep): boolean {\n  const normalized = input.trim().toLowerCase();\n  const original = input.trim();\n  \n  if (step.validationRules.mustStartWith) {\n    const startsCorrectly = step.validationRules.mustStartWith.some(prefix =>\n      normalized.startsWith(prefix.toLowerCase())\n    );\n    if (!startsCorrectly) return false;\n  }\n  \n  if (step.validationRules.mustContainAnyQuote) {\n    const hasQuote = step.validationRules.mustContainAnyQuote.some(q =>\n      original.includes(q)\n    );\n    if (!hasQuote) return false;\n  }\n  \n  if (step.validationRules.mustContainAnyKeyword) {\n    const hasKeyword = step.validationRules.mustContainAnyKeyword.some(kw =>\n      normalized.includes(kw.toLowerCase())\n    );\n    if (!hasKeyword) return false;\n  }\n  \n  if (step.validPatterns && step.validPatterns.length > 0) {\n    return step.validPatterns.some(pattern => {\n      try {\n        const regex = new RegExp(pattern, 'i');\n        return regex.test(original);\n      } catch {\n        return false;\n      }\n    });\n  }\n  \n  return true;\n}\n\nexport function validateBranchName(name: string, validation: BranchCreation['content']['validation']): { valid: boolean; error?: string } {\n  const trimmed = name.trim().toLowerCase();\n  \n  if (trimmed.length < validation.minLength) {\n    return { valid: false, error: `Branch name must be at least ${validation.minLength} characters` };\n  }\n  \n  if (trimmed.length > validation.maxLength) {\n    return { valid: false, error: `Branch name must be at most ${validation.maxLength} characters` };\n  }\n  \n  const hasValidPrefix = validation.validPrefixes.some(prefix =>\n    trimmed.startsWith(prefix.toLowerCase())\n  );\n  if (!hasValidPrefix) {\n    return { valid: false, error: `Branch name must start with one of: ${validation.validPrefixes.join(', ')}` };\n  }\n  \n  const hasKeyword = validation.mustContainKeywords.some(kw =>\n    trimmed.includes(kw.toLowerCase())\n  );\n  if (!hasKeyword) {\n    return { valid: false, error: `Branch name should relate to the ticket (timezone, date, etc.)` };\n  }\n  \n  try {\n    const regex = new RegExp(validation.regex);\n    if (!regex.test(trimmed)) {\n      return { valid: false, error: 'Branch name contains invalid characters' };\n    }\n  } catch {\n    // If regex is invalid, skip this check\n  }\n  \n  return { valid: true };\n}\n\nexport function validateCodeBlank(input: string, blank: CodeBlank): boolean {\n  const trimmed = input.trim();\n  const answer = blank.correctAnswer;\n  \n  if (blank.caseSensitive) {\n    return trimmed === answer;\n  }\n  return trimmed.toLowerCase() === answer.toLowerCase();\n}\n\n// ============================================================================\n// ADAPTER HELPERS\n// ============================================================================\n\nexport function getQuestionsForRoleAndLevel(\n  questionBanks: QuestionBanks,\n  role: string,\n  questionType: string,\n  level: string\n): InterviewQuestion[] {\n  const roleData = questionBanks.content.roles[role];\n  if (!roleData) return [];\n  \n  const typeData = roleData.types[questionType];\n  if (!typeData) return [];\n  \n  return typeData[level] || [];\n}\n\nexport function getPersonaById(\n  teamPersonas: TeamPersonas,\n  personaId: string\n): InterviewPersona | undefined {\n  return teamPersonas.content.personas[personaId];\n}\n\nexport function getTeamConfiguration(\n  teamPersonas: TeamPersonas,\n  configId: string\n) {\n  return teamPersonas.content.teamConfigurations[configId];\n}\n\nexport function getAvatarUrl(member: TeamMember): string {\n  const { seed, style, backgroundColor } = member.avatar;\n  return `https://api.dicebear.com/7.x/${style}/svg?seed=${seed}&backgroundColor=${backgroundColor}`;\n}\n\nexport function getTeamMemberColor(name: string): string {\n  const colors: Record<string, string> = {\n    'Sarah': 'bg-blue-500',\n    'Marcus': 'bg-green-500',\n    'Priya': 'bg-purple-500',\n    'Alex': 'bg-orange-500',\n    'Jordan': 'bg-teal-500'\n  };\n  return colors[name] || 'bg-gray-500';\n}\n\nexport function getTeamMemberInitials(name: string): string {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase();\n}\n\nexport function interpolateUserName(content: string, userName: string): string {\n  return content.replace(/\\{userName\\}/g, userName);\n}\n","path":null,"size_bytes":15955,"size_tokens":null},"server/seed-phase1.ts":{"content":"import { db } from \"./db\";\nimport { \n  competencies, \n  roleAdapters, \n  simulationCatalogue,\n  type InsertCompetency,\n  type InsertRoleAdapter,\n  type InsertSimulationCatalogue\n} from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\nimport competenciesData from \"../shared/catalogue/competencies.json\";\nimport roleAdaptersData from \"../shared/catalogue/role-adapters.json\";\n\nimport standupScript from \"../shared/catalogue/workspace/standup-script.json\";\nimport devSetupSteps from \"../shared/catalogue/workspace/dev-setup-steps.json\";\nimport gitWorkflowSteps from \"../shared/catalogue/workspace/git-workflow-steps.json\";\nimport codebaseStructure from \"../shared/catalogue/workspace/codebase-structure.json\";\nimport codeExercise from \"../shared/catalogue/workspace/code-exercise-timezone.json\";\nimport branchCreation from \"../shared/catalogue/workspace/branch-creation.json\";\nimport teamMembers from \"../shared/catalogue/workspace/team-members.json\";\nimport documentationDay1 from \"../shared/catalogue/workspace/documentation-day1.json\";\nimport activitiesDay1 from \"../shared/catalogue/workspace/activities-day1.json\";\nimport activitiesDay2 from \"../shared/catalogue/workspace/activities-day2.json\";\nimport ticketTimezoneBug from \"../shared/catalogue/workspace/ticket-timezone-bug.json\";\nimport interviewConfig from \"../shared/catalogue/interview/interview-config.json\";\nimport questionBanks from \"../shared/catalogue/interview/question-banks.json\";\nimport evaluationRubrics from \"../shared/catalogue/interview/evaluation-rubrics.json\";\nimport teamPersonas from \"../shared/catalogue/interview/team-personas.json\";\n\nasync function seedCompetencies() {\n  console.log(\"Seeding competencies...\");\n  \n  for (const comp of competenciesData.competencies) {\n    const existing = await db.select().from(competencies).where(eq(competencies.slug, comp.slug));\n    \n    const competencyData: InsertCompetency = {\n      slug: comp.slug,\n      name: comp.name,\n      summary: comp.summary,\n      category: comp.category,\n      role: comp.role,\n      rubric: comp.rubric,\n      skills: comp.skills,\n    };\n    \n    if (existing.length > 0) {\n      await db.update(competencies)\n        .set(competencyData)\n        .where(eq(competencies.slug, comp.slug));\n      console.log(`  Updated competency: ${comp.slug}`);\n    } else {\n      await db.insert(competencies).values(competencyData);\n      console.log(`  Inserted competency: ${comp.slug}`);\n    }\n  }\n  \n  console.log(`Seeded ${competenciesData.competencies.length} competencies`);\n}\n\nasync function seedRoleAdapters() {\n  console.log(\"Seeding role adapters...\");\n  \n  for (const adapter of roleAdaptersData.adapters) {\n    const existing = await db.select().from(roleAdapters).where(eq(roleAdapters.role, adapter.role));\n    \n    const adapterData: InsertRoleAdapter = {\n      role: adapter.role,\n      displayName: adapter.displayName,\n      description: adapter.description,\n      levels: adapter.levels,\n      languageOverrides: (adapter as any).languageOverrides || null,\n      simulatorSettings: adapter.simulatorSettings,\n      metadata: null,\n    };\n    \n    if (existing.length > 0) {\n      await db.update(roleAdapters)\n        .set(adapterData)\n        .where(eq(roleAdapters.role, adapter.role));\n      console.log(`  Updated role adapter: ${adapter.role}`);\n    } else {\n      await db.insert(roleAdapters).values(adapterData);\n      console.log(`  Inserted role adapter: ${adapter.role}`);\n    }\n  }\n  \n  console.log(`Seeded ${roleAdaptersData.adapters.length} role adapters`);\n}\n\ninterface CatalogueFile {\n  version: string;\n  type: string;\n  description?: string;\n  metadata?: {\n    role?: string;\n    language?: string;\n    day?: number;\n    level?: string;\n  };\n  content: Record<string, unknown>;\n}\n\nfunction getCatalogueItems(): { id: string; file: CatalogueFile; simulator: string; title: string; competencies?: string[] }[] {\n  return [\n    { \n      id: \"workspace-standup-day2\", \n      file: standupScript as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Day 2 Daily Standup\",\n      competencies: [\"communication\", \"time-management\"]\n    },\n    { \n      id: \"workspace-dev-setup-day2\", \n      file: devSetupSteps as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Development Environment Setup\",\n      competencies: [\"codebase-navigation\"]\n    },\n    { \n      id: \"workspace-git-workflow-day2\", \n      file: gitWorkflowSteps as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Git Workflow Commands\",\n      competencies: [\"git-workflow\"]\n    },\n    { \n      id: \"workspace-codebase-structure\", \n      file: codebaseStructure as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Codebase Structure Exploration\",\n      competencies: [\"codebase-navigation\"]\n    },\n    { \n      id: \"workspace-code-exercise-timezone\", \n      file: codeExercise as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Timezone Bug Fix Exercise\",\n      competencies: [\"debugging\", \"problem-solving\"]\n    },\n    { \n      id: \"workspace-branch-creation\", \n      file: branchCreation as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Git Branch Creation\",\n      competencies: [\"git-workflow\"]\n    },\n    { \n      id: \"workspace-team-members\", \n      file: teamMembers as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Team Members Configuration\"\n    },\n    { \n      id: \"workspace-documentation-day1\", \n      file: documentationDay1 as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Day 1 Onboarding Documentation\",\n      competencies: [\"codebase-navigation\", \"communication\"]\n    },\n    { \n      id: \"workspace-activities-day1\", \n      file: activitiesDay1 as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Day 1 Activities\"\n    },\n    { \n      id: \"workspace-activities-day2\", \n      file: activitiesDay2 as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Day 2 Activities\"\n    },\n    { \n      id: \"workspace-ticket-timezone-bug\", \n      file: ticketTimezoneBug as CatalogueFile, \n      simulator: \"workspace\",\n      title: \"Timezone Bug Ticket\",\n      competencies: [\"debugging\", \"problem-solving\"]\n    },\n    { \n      id: \"interview-configuration\", \n      file: interviewConfig as CatalogueFile, \n      simulator: \"interview\",\n      title: \"Interview Configuration\"\n    },\n    { \n      id: \"interview-question-banks\", \n      file: questionBanks as CatalogueFile, \n      simulator: \"interview\",\n      title: \"Interview Question Banks\",\n      competencies: [\"communication\", \"problem-solving\"]\n    },\n    { \n      id: \"interview-evaluation-rubrics\", \n      file: evaluationRubrics as CatalogueFile, \n      simulator: \"interview\",\n      title: \"Interview Evaluation Rubrics\"\n    },\n    { \n      id: \"interview-team-personas\", \n      file: teamPersonas as CatalogueFile, \n      simulator: \"interview\",\n      title: \"Interview Team Personas\"\n    },\n  ];\n}\n\nasync function seedSimulationCatalogue() {\n  console.log(\"Seeding simulation catalogue...\");\n  \n  const items = getCatalogueItems();\n  \n  for (const item of items) {\n    const existing = await db.select().from(simulationCatalogue).where(eq(simulationCatalogue.externalId, item.id));\n    \n    const catalogueData: InsertSimulationCatalogue = {\n      externalId: item.id,\n      type: item.file.type,\n      simulator: item.simulator,\n      role: item.file.metadata?.role || null,\n      level: item.file.metadata?.level || null,\n      language: item.file.metadata?.language || null,\n      day: item.file.metadata?.day || null,\n      version: item.file.version,\n      title: item.title,\n      summary: item.file.description || null,\n      content: item.file.content,\n      competencySlugs: item.competencies || null,\n    };\n    \n    if (existing.length > 0) {\n      await db.update(simulationCatalogue)\n        .set(catalogueData)\n        .where(eq(simulationCatalogue.externalId, item.id));\n      console.log(`  Updated catalogue item: ${item.id}`);\n    } else {\n      await db.insert(simulationCatalogue).values(catalogueData);\n      console.log(`  Inserted catalogue item: ${item.id}`);\n    }\n  }\n  \n  console.log(`Seeded ${items.length} catalogue items`);\n}\n\nexport async function seedPhase1Data() {\n  console.log(\"\\n=== Phase 1 Data Seeding ===\\n\");\n  \n  try {\n    await seedCompetencies();\n    console.log(\"\");\n    await seedRoleAdapters();\n    console.log(\"\");\n    await seedSimulationCatalogue();\n    console.log(\"\\n=== Phase 1 Seeding Complete ===\\n\");\n  } catch (error) {\n    console.error(\"Error seeding Phase 1 data:\", error);\n    throw error;\n  }\n}\n\nimport { fileURLToPath } from 'url';\n\nconst isMainModule = process.argv[1] === fileURLToPath(import.meta.url);\n\nif (isMainModule) {\n  seedPhase1Data()\n    .then(() => process.exit(0))\n    .catch(() => process.exit(1));\n}\n","path":null,"size_bytes":8793,"size_tokens":null},"shared/catalogue/service.ts":{"content":"import type { z } from \"zod\";\nimport type {\n  StandupScriptSchema,\n  DevSetupStepsSchema,\n  GitWorkflowStepsSchema,\n  CodebaseStructureSchema,\n  CodeExerciseSchema,\n  BranchCreationSchema,\n  InterviewConfigSchema,\n  QuestionBanksSchema,\n  TeamPersonasSchema,\n  EvaluationRubricsSchema\n} from \"./loaders\";\n\nexport type CatalogueItemType = \n  | \"standup_script\"\n  | \"dev_setup_steps\" \n  | \"git_workflow_steps\"\n  | \"codebase_structure\"\n  | \"code_exercise\"\n  | \"branch_creation\"\n  | \"interview_configuration\"\n  | \"question_bank\"\n  | \"team_personas\"\n  | \"evaluation_rubrics\"\n  | \"daily_activities\"\n  | \"team_members\"\n  | \"onboarding_documentation\"\n  | \"ticket\";\n\nexport type SimulatorType = \"workspace\" | \"interview\";\nexport type RoleType = \"developer\" | \"pm\" | \"qa\" | \"devops\" | \"data_science\";\nexport type LevelType = \"intern\" | \"junior\" | \"mid\" | \"senior\";\nexport type LanguageType = \"javascript\" | \"python\" | \"c_cpp\";\n\nexport interface CatalogueQuery {\n  simulator?: SimulatorType;\n  type?: CatalogueItemType;\n  role?: RoleType;\n  level?: LevelType;\n  language?: LanguageType;\n  day?: number;\n}\n\nexport interface CatalogueItemMeta {\n  id: string;\n  type: CatalogueItemType;\n  simulator: SimulatorType;\n  version: string;\n  role?: RoleType;\n  level?: LevelType;\n  language?: LanguageType;\n  day?: number;\n}\n\nexport interface CatalogueItem<T = unknown> {\n  meta: CatalogueItemMeta;\n  content: T;\n}\n\ntype StandupScript = z.infer<typeof StandupScriptSchema>;\ntype DevSetupSteps = z.infer<typeof DevSetupStepsSchema>;\ntype GitWorkflowSteps = z.infer<typeof GitWorkflowStepsSchema>;\ntype CodebaseStructure = z.infer<typeof CodebaseStructureSchema>;\ntype CodeExercise = z.infer<typeof CodeExerciseSchema>;\ntype BranchCreation = z.infer<typeof BranchCreationSchema>;\ntype InterviewConfig = z.infer<typeof InterviewConfigSchema>;\ntype QuestionBank = z.infer<typeof QuestionBanksSchema>;\ntype TeamPersonas = z.infer<typeof TeamPersonasSchema>;\ntype EvaluationRubrics = z.infer<typeof EvaluationRubricsSchema>;\n\nfunction matchesQuery(meta: CatalogueItemMeta, query: CatalogueQuery): boolean {\n  if (query.simulator && meta.simulator !== query.simulator) return false;\n  if (query.type && meta.type !== query.type) return false;\n  if (query.role && meta.role !== query.role) return false;\n  if (query.level && meta.level !== query.level) return false;\n  if (query.language && meta.language !== query.language) return false;\n  if (query.day !== undefined && meta.day !== query.day) return false;\n  return true;\n}\n\nclass CatalogueService {\n  private items: Map<string, CatalogueItem> = new Map();\n  private initialized = false;\n\n  private async loadAllItems(): Promise<void> {\n    if (this.initialized) return;\n\n    const standupData = await import(\"./workspace/standup-script.json\");\n    const devSetupData = await import(\"./workspace/dev-setup-steps.json\");\n    const gitWorkflowData = await import(\"./workspace/git-workflow-steps.json\");\n    const codebaseData = await import(\"./workspace/codebase-structure.json\");\n    const codeExerciseData = await import(\"./workspace/code-exercise-timezone.json\");\n    const branchData = await import(\"./workspace/branch-creation.json\");\n    const teamMembersData = await import(\"./workspace/team-members.json\");\n    const documentationDay1Data = await import(\"./workspace/documentation-day1.json\");\n    const activitiesDay1Data = await import(\"./workspace/activities-day1.json\");\n    const activitiesDay2Data = await import(\"./workspace/activities-day2.json\");\n    const ticketData = await import(\"./workspace/ticket-timezone-bug.json\");\n    const interviewConfigData = await import(\"./interview/interview-config.json\");\n    const questionBanksData = await import(\"./interview/question-banks.json\");\n    const evaluationRubricsData = await import(\"./interview/evaluation-rubrics.json\");\n    const teamPersonasData = await import(\"./interview/team-personas.json\");\n\n    this.registerItem(\"workspace-standup-day2\", {\n      meta: {\n        id: \"workspace-standup-day2\",\n        type: \"standup_script\",\n        simulator: \"workspace\",\n        version: standupData.version,\n        role: standupData.metadata?.role as RoleType,\n        language: standupData.metadata?.language as LanguageType,\n        day: standupData.metadata?.day\n      },\n      content: standupData.content\n    });\n\n    this.registerItem(\"workspace-dev-setup-day2\", {\n      meta: {\n        id: \"workspace-dev-setup-day2\",\n        type: \"dev_setup_steps\",\n        simulator: \"workspace\",\n        version: devSetupData.version,\n        role: devSetupData.metadata?.role as RoleType,\n        language: devSetupData.metadata?.language as LanguageType,\n        day: devSetupData.metadata?.day\n      },\n      content: devSetupData.content\n    });\n\n    this.registerItem(\"workspace-git-workflow-day2\", {\n      meta: {\n        id: \"workspace-git-workflow-day2\",\n        type: \"git_workflow_steps\",\n        simulator: \"workspace\",\n        version: gitWorkflowData.version,\n        role: gitWorkflowData.metadata?.role as RoleType,\n        language: gitWorkflowData.metadata?.language as LanguageType,\n        day: gitWorkflowData.metadata?.day\n      },\n      content: gitWorkflowData.content\n    });\n\n    this.registerItem(\"workspace-codebase-structure\", {\n      meta: {\n        id: \"workspace-codebase-structure\",\n        type: \"codebase_structure\",\n        simulator: \"workspace\",\n        version: codebaseData.version,\n        role: codebaseData.metadata?.role as RoleType,\n        language: codebaseData.metadata?.language as LanguageType,\n        day: codebaseData.metadata?.day\n      },\n      content: codebaseData.content\n    });\n\n    this.registerItem(\"workspace-code-exercise-timezone\", {\n      meta: {\n        id: \"workspace-code-exercise-timezone\",\n        type: \"code_exercise\",\n        simulator: \"workspace\",\n        version: codeExerciseData.version,\n        role: codeExerciseData.metadata?.role as RoleType,\n        language: codeExerciseData.metadata?.language as LanguageType,\n        day: codeExerciseData.metadata?.day\n      },\n      content: codeExerciseData.content\n    });\n\n    this.registerItem(\"workspace-branch-creation\", {\n      meta: {\n        id: \"workspace-branch-creation\",\n        type: \"branch_creation\",\n        simulator: \"workspace\",\n        version: branchData.version,\n        role: branchData.metadata?.role as RoleType,\n        language: branchData.metadata?.language as LanguageType,\n        day: branchData.metadata?.day\n      },\n      content: branchData.content\n    });\n\n    this.registerItem(\"workspace-team-members\", {\n      meta: {\n        id: \"workspace-team-members\",\n        type: \"team_members\",\n        simulator: \"workspace\",\n        version: teamMembersData.version\n      },\n      content: teamMembersData.content\n    });\n\n    this.registerItem(\"workspace-documentation-day1\", {\n      meta: {\n        id: \"workspace-documentation-day1\",\n        type: \"onboarding_documentation\",\n        simulator: \"workspace\",\n        version: documentationDay1Data.version,\n        role: documentationDay1Data.metadata?.role as RoleType,\n        language: documentationDay1Data.metadata?.language as LanguageType,\n        day: documentationDay1Data.metadata?.day\n      },\n      content: documentationDay1Data.content\n    });\n\n    this.registerItem(\"workspace-activities-day1\", {\n      meta: {\n        id: \"workspace-activities-day1\",\n        type: \"daily_activities\",\n        simulator: \"workspace\",\n        version: activitiesDay1Data.version,\n        role: activitiesDay1Data.metadata?.role as RoleType,\n        language: activitiesDay1Data.metadata?.language as LanguageType,\n        day: activitiesDay1Data.metadata?.day\n      },\n      content: activitiesDay1Data.content\n    });\n\n    this.registerItem(\"workspace-activities-day2\", {\n      meta: {\n        id: \"workspace-activities-day2\",\n        type: \"daily_activities\",\n        simulator: \"workspace\",\n        version: activitiesDay2Data.version,\n        role: activitiesDay2Data.metadata?.role as RoleType,\n        language: activitiesDay2Data.metadata?.language as LanguageType,\n        day: activitiesDay2Data.metadata?.day\n      },\n      content: activitiesDay2Data.content\n    });\n\n    this.registerItem(\"workspace-ticket-timezone-bug\", {\n      meta: {\n        id: \"workspace-ticket-timezone-bug\",\n        type: \"ticket\",\n        simulator: \"workspace\",\n        version: ticketData.version,\n        role: ticketData.metadata?.role as RoleType,\n        language: ticketData.metadata?.language as LanguageType\n      },\n      content: ticketData.content\n    });\n\n    this.registerItem(\"interview-configuration\", {\n      meta: {\n        id: \"interview-configuration\",\n        type: \"interview_configuration\",\n        simulator: \"interview\",\n        version: interviewConfigData.version\n      },\n      content: interviewConfigData.content\n    });\n\n    this.registerItem(\"interview-question-banks\", {\n      meta: {\n        id: \"interview-question-banks\",\n        type: \"question_bank\",\n        simulator: \"interview\",\n        version: questionBanksData.version\n      },\n      content: questionBanksData.content\n    });\n\n    this.registerItem(\"interview-evaluation-rubrics\", {\n      meta: {\n        id: \"interview-evaluation-rubrics\",\n        type: \"evaluation_rubrics\",\n        simulator: \"interview\",\n        version: evaluationRubricsData.version\n      },\n      content: evaluationRubricsData.content\n    });\n\n    this.registerItem(\"interview-team-personas\", {\n      meta: {\n        id: \"interview-team-personas\",\n        type: \"team_personas\",\n        simulator: \"interview\",\n        version: teamPersonasData.version\n      },\n      content: teamPersonasData.content\n    });\n\n    this.initialized = true;\n  }\n\n  private registerItem(id: string, item: CatalogueItem): void {\n    this.items.set(id, item);\n  }\n\n  async getItems(query: CatalogueQuery = {}): Promise<CatalogueItem[]> {\n    await this.loadAllItems();\n    const results: CatalogueItem[] = [];\n    \n    const allItems = Array.from(this.items.values());\n    for (const item of allItems) {\n      if (matchesQuery(item.meta, query)) {\n        results.push(item);\n      }\n    }\n    \n    return results;\n  }\n\n  async getItem<T>(id: string): Promise<CatalogueItem<T> | null> {\n    await this.loadAllItems();\n    return (this.items.get(id) as CatalogueItem<T>) || null;\n  }\n\n  async getStandupScript(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<StandupScript[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"standup_script\",\n      ...query\n    });\n    return items[0]?.content as StandupScript[\"content\"] || null;\n  }\n\n  async getDevSetupSteps(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<DevSetupSteps[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"dev_setup_steps\",\n      ...query\n    });\n    return items[0]?.content as DevSetupSteps[\"content\"] || null;\n  }\n\n  async getGitWorkflowSteps(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<GitWorkflowSteps[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"git_workflow_steps\",\n      ...query\n    });\n    return items[0]?.content as GitWorkflowSteps[\"content\"] || null;\n  }\n\n  async getCodebaseStructure(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<CodebaseStructure[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"codebase_structure\",\n      ...query\n    });\n    return items[0]?.content as CodebaseStructure[\"content\"] || null;\n  }\n\n  async getCodeExercise(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<CodeExercise[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"code_exercise\",\n      ...query\n    });\n    return items[0]?.content as CodeExercise[\"content\"] || null;\n  }\n\n  async getBranchCreation(query: { day?: number; role?: RoleType; language?: LanguageType } = {}): Promise<BranchCreation[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"workspace\",\n      type: \"branch_creation\",\n      ...query\n    });\n    return items[0]?.content as BranchCreation[\"content\"] || null;\n  }\n\n  async getInterviewConfig(): Promise<InterviewConfig[\"content\"] | null> {\n    const items = await this.getItems({\n      simulator: \"interview\",\n      type: \"interview_configuration\"\n    });\n    return items[0]?.content as InterviewConfig[\"content\"] || null;\n  }\n}\n\nexport const catalogue = new CatalogueService();\n\nexport async function getCatalogueItems(query: CatalogueQuery = {}): Promise<CatalogueItem[]> {\n  return catalogue.getItems(query);\n}\n\nexport async function getCatalogueItem<T>(id: string): Promise<CatalogueItem<T> | null> {\n  return catalogue.getItem<T>(id);\n}\n","path":null,"size_bytes":12927,"size_tokens":null},"client/src/hooks/use-adapters.ts":{"content":"/**\n * Client-side hooks for Phase 2 Adapters\n * \n * Provides React Query hooks for fetching adapter configurations\n * for both Interview and Workspace simulators.\n */\n\nimport { useQuery } from \"@tanstack/react-query\";\n\nexport type Role = 'developer' | 'pm' | 'qa' | 'devops' | 'data_science';\nexport type Level = 'intern' | 'junior' | 'mid' | 'senior';\nexport type Language = 'javascript' | 'python' | 'c_cpp';\n\nexport interface InterviewConfig {\n  role: Role;\n  level: Level;\n  focusAreas: string[];\n  panelRoles: string[];\n  questionTypes: string[];\n  difficultyCalibration: {\n    complexity: string;\n    scaffolding: string;\n    expectations: string[];\n  };\n  evaluationCriteria: {\n    strictness: number;\n    passingThreshold: number;\n    criticalSkills: string[];\n  };\n}\n\nexport interface WorkspaceConfig {\n  role: Role;\n  level: Level;\n  language: Language;\n  focusAreas: string[];\n  teamInteractions: string[];\n  problemTypes: string[];\n  toolchain: string[];\n  frameworks: string[];\n  difficultyCalibration: {\n    complexity: string;\n    scaffolding: string;\n    expectations: string[];\n  };\n}\n\nexport interface InterviewQuestionConfig {\n  questionTypes: string[];\n  difficulty: string;\n  focusAreas: string[];\n  panelRoles: string[];\n  levelAdjustments: {\n    difficultyLabel: string;\n    questionDepth: 'surface' | 'moderate' | 'deep' | 'expert';\n    timeAllocation: number;\n    followUpLikelihood: number;\n    hintAvailability: boolean;\n  };\n  evaluationCriteria: {\n    strictness: number;\n    passingThreshold: number;\n    criticalSkills: string[];\n  };\n}\n\nexport interface WorkspaceProblemConfig {\n  problemTypes: string[];\n  teamInteractions: string[];\n  focusAreas: string[];\n  toolchain: string[];\n  frameworks: string[];\n  languageExamples: {\n    sampleCode: string;\n    commonErrors: string[];\n    testCommand: string;\n    buildCommand: string;\n    packageManager: string;\n  };\n  difficultyCalibration: {\n    complexity: string;\n    scaffolding: string;\n    expectations: string[];\n  };\n}\n\nexport interface AvailableRole {\n  role: Role;\n  displayName: string;\n  description: string;\n}\n\nexport interface AvailableLevel {\n  level: Level;\n  title: string;\n  expectations: string[];\n}\n\nexport interface AvailableLanguage {\n  language: Language;\n  toolchain: string[];\n  frameworks: string[];\n}\n\n/**\n * Hook to fetch interview configuration for a role/level\n */\nexport function useInterviewConfig(role: string | null, level: string | null) {\n  return useQuery<InterviewConfig>({\n    queryKey: ['/api/adapters/interview-config', role, level],\n    enabled: !!role && !!level,\n  });\n}\n\n/**\n * Hook to fetch workspace configuration for a role/level/language\n */\nexport function useWorkspaceConfig(\n  role: string | null,\n  level: string | null,\n  language: string = 'javascript'\n) {\n  return useQuery<WorkspaceConfig>({\n    queryKey: ['/api/adapters/workspace-config', role, level, language],\n    enabled: !!role && !!level,\n  });\n}\n\n/**\n * Hook to fetch interview question configuration\n */\nexport function useInterviewQuestionConfig(role: string | null, level: string | null) {\n  return useQuery<InterviewQuestionConfig>({\n    queryKey: ['/api/adapters/interview-questions', role, level],\n    enabled: !!role && !!level,\n  });\n}\n\n/**\n * Hook to fetch workspace problem configuration\n */\nexport function useWorkspaceProblemConfig(\n  role: string | null,\n  level: string | null,\n  language: string = 'javascript'\n) {\n  return useQuery<WorkspaceProblemConfig>({\n    queryKey: ['/api/adapters/workspace-problems', role, level, language],\n    enabled: !!role && !!level,\n  });\n}\n\n/**\n * Hook to fetch all available roles\n */\nexport function useAvailableRoles() {\n  return useQuery<AvailableRole[]>({\n    queryKey: ['/api/adapters/available-roles'],\n  });\n}\n\n/**\n * Hook to fetch available levels for a role\n */\nexport function useAvailableLevels(role: string | null) {\n  return useQuery<AvailableLevel[]>({\n    queryKey: ['/api/adapters/available-levels', role],\n    enabled: !!role,\n  });\n}\n\n/**\n * Hook to fetch available languages for a role\n */\nexport function useAvailableLanguages(role: string | null) {\n  return useQuery<AvailableLanguage[]>({\n    queryKey: ['/api/adapters/available-languages', role],\n    enabled: !!role,\n  });\n}\n\n/**\n * Map display names to normalized role values\n */\nexport function normalizeRole(roleName: string): Role {\n  const roleMap: Record<string, Role> = {\n    'developer': 'developer',\n    'software developer': 'developer',\n    'software engineer': 'developer',\n    'engineer': 'developer',\n    'pm': 'pm',\n    'product manager': 'pm',\n    'product': 'pm',\n    'qa': 'qa',\n    'qa engineer': 'qa',\n    'quality assurance': 'qa',\n    'tester': 'qa',\n    'devops': 'devops',\n    'devops engineer': 'devops',\n    'sre': 'devops',\n    'site reliability': 'devops',\n    'data science': 'data_science',\n    'data scientist': 'data_science',\n    'data_science': 'data_science',\n    'ml engineer': 'data_science',\n  };\n  \n  const normalized = roleName.toLowerCase().trim();\n  return roleMap[normalized] || 'developer';\n}\n\n/**\n * Map display names to normalized level values\n */\nexport function normalizeLevel(levelName: string): Level {\n  const levelMap: Record<string, Level> = {\n    'intern': 'intern',\n    'internship': 'intern',\n    'entry': 'intern',\n    'junior': 'junior',\n    'associate': 'junior',\n    'mid': 'mid',\n    'mid-level': 'mid',\n    'intermediate': 'mid',\n    'senior': 'senior',\n    'lead': 'senior',\n    'staff': 'senior',\n    'principal': 'senior',\n  };\n  \n  const normalized = levelName.toLowerCase().trim();\n  return levelMap[normalized] || 'intern';\n}\n\n/**\n * Get display name for a role\n */\nexport function getRoleDisplayName(role: Role): string {\n  const displayNames: Record<Role, string> = {\n    developer: 'Software Developer',\n    pm: 'Product Manager',\n    qa: 'QA Engineer',\n    devops: 'DevOps Engineer',\n    data_science: 'Data Scientist',\n  };\n  return displayNames[role] || 'Developer';\n}\n\n/**\n * Get display name for a level\n */\nexport function getLevelDisplayName(level: Level): string {\n  const displayNames: Record<Level, string> = {\n    intern: 'Intern',\n    junior: 'Junior',\n    mid: 'Mid-level',\n    senior: 'Senior',\n  };\n  return displayNames[level] || 'Intern';\n}\n\n/**\n * Get display name for a language\n */\nexport function getLanguageDisplayName(language: Language): string {\n  const displayNames: Record<Language, string> = {\n    javascript: 'JavaScript/TypeScript',\n    python: 'Python',\n    c_cpp: 'C/C++',\n  };\n  return displayNames[language] || 'JavaScript';\n}\n","path":null,"size_bytes":6553,"size_tokens":null},"shared/adapters/index.ts":{"content":"/**\n * Unified Adapter Service for Phase 2\n * \n * Provides dynamic configuration for both Interview and Workspace simulators\n * based on user's role, level, and language preferences.\n */\n\nexport type Role = 'developer' | 'pm' | 'qa' | 'devops' | 'data_science';\nexport type Level = 'intern' | 'junior' | 'mid' | 'senior';\nexport type Language = 'javascript' | 'python' | 'c_cpp';\nexport type Simulator = 'interview' | 'workspace';\n\n// Interview-specific types\nexport interface InterviewConfig {\n  role: Role;\n  level: Level;\n  focusAreas: string[];\n  panelRoles: string[];\n  questionTypes: string[];\n  difficultyCalibration: {\n    complexity: string;\n    scaffolding: string;\n    expectations: string[];\n  };\n  evaluationCriteria: {\n    strictness: number; // 0-1, higher = stricter\n    passingThreshold: number;\n    criticalSkills: string[];\n  };\n}\n\n// Workspace-specific types\nexport interface WorkspaceConfig {\n  role: Role;\n  level: Level;\n  language: Language;\n  focusAreas: string[];\n  teamInteractions: string[];\n  problemTypes: string[];\n  toolchain: string[];\n  frameworks: string[];\n  difficultyCalibration: {\n    complexity: string;\n    scaffolding: string;\n    expectations: string[];\n  };\n}\n\n// Combined adapter config from API\nexport interface RoleAdapterData {\n  role: string;\n  displayName: string;\n  description: string;\n  levels: Record<string, {\n    title: string;\n    expectations: string[];\n    scaffolding: string;\n    complexity: string;\n  }>;\n  languageOverrides?: Record<string, {\n    toolchain: string[];\n    frameworks: string[];\n  }>;\n  simulatorSettings: {\n    interview: {\n      focusAreas: string[];\n      panelRoles: string[];\n    };\n    workspace: {\n      focusAreas: string[];\n      teamInteractions: string[];\n    };\n  };\n}\n\n/**\n * Get interview configuration based on role and level\n */\nexport function getInterviewConfig(\n  adapterData: RoleAdapterData,\n  level: Level\n): InterviewConfig {\n  const levelConfig = adapterData.levels[level] || adapterData.levels.intern;\n  const interviewSettings = adapterData.simulatorSettings.interview;\n  \n  // Map complexity to strictness\n  const strictnessMap: Record<string, number> = {\n    'simple': 0.3,\n    'moderate': 0.5,\n    'complex': 0.7,\n    'advanced': 0.9,\n  };\n  \n  // Map scaffolding to passing threshold\n  const thresholdMap: Record<string, number> = {\n    'high': 50,\n    'medium': 60,\n    'low': 70,\n    'none': 80,\n  };\n  \n  // Determine question types based on focus areas\n  const questionTypes = interviewSettings.focusAreas.map(area => {\n    const typeMap: Record<string, string> = {\n      'technical': 'Technical Interview',\n      'system-design': 'System Design',\n      'coding-challenges': 'Coding Challenge',\n      'product-sense': 'Product Sense',\n      'analytical': 'Analytical',\n      'execution': 'Execution',\n      'leadership': 'Leadership',\n      'testing-methodology': 'Testing Methodology',\n      'automation': 'Automation',\n      'quality-processes': 'Quality Processes',\n      'infrastructure': 'Infrastructure',\n      'reliability': 'Reliability',\n      'troubleshooting': 'Troubleshooting',\n      'statistics': 'Statistics',\n      'machine-learning': 'Machine Learning',\n      'product-analytics': 'Product Analytics',\n      'experimentation': 'Experimentation',\n    };\n    return typeMap[area] || 'Behavioral Interview';\n  });\n\n  return {\n    role: adapterData.role as Role,\n    level,\n    focusAreas: interviewSettings.focusAreas,\n    panelRoles: interviewSettings.panelRoles,\n    questionTypes,\n    difficultyCalibration: {\n      complexity: levelConfig.complexity,\n      scaffolding: levelConfig.scaffolding,\n      expectations: levelConfig.expectations,\n    },\n    evaluationCriteria: {\n      strictness: strictnessMap[levelConfig.complexity] || 0.5,\n      passingThreshold: thresholdMap[levelConfig.scaffolding] || 60,\n      criticalSkills: interviewSettings.focusAreas.slice(0, 2),\n    },\n  };\n}\n\n/**\n * Get workspace configuration based on role, level, and language\n */\nexport function getWorkspaceConfig(\n  adapterData: RoleAdapterData,\n  level: Level,\n  language: Language = 'javascript'\n): WorkspaceConfig {\n  const levelConfig = adapterData.levels[level] || adapterData.levels.intern;\n  const workspaceSettings = adapterData.simulatorSettings.workspace;\n  const languageConfig = adapterData.languageOverrides?.[language];\n  \n  // Determine problem types based on focus areas\n  const problemTypes = workspaceSettings.focusAreas.map(area => {\n    const typeMap: Record<string, string> = {\n      'coding': 'code_fix',\n      'debugging': 'debug_exercise',\n      'git': 'git_workflow',\n      'code-review': 'code_review',\n      'testing': 'test_writing',\n      'requirements': 'requirements_analysis',\n      'prioritization': 'backlog_prioritization',\n      'stakeholder-management': 'stakeholder_meeting',\n      'metrics': 'metrics_analysis',\n      'test-planning': 'test_plan',\n      'bug-reporting': 'bug_report',\n      'automation': 'automation_setup',\n      'regression': 'regression_testing',\n      'infrastructure': 'infra_setup',\n      'ci-cd': 'pipeline_config',\n      'monitoring': 'monitoring_setup',\n      'security': 'security_audit',\n      'data-analysis': 'data_analysis',\n      'modeling': 'model_building',\n      'experimentation': 'experiment_design',\n      'visualization': 'visualization_task',\n    };\n    return typeMap[area] || 'general_task';\n  });\n\n  return {\n    role: adapterData.role as Role,\n    level,\n    language,\n    focusAreas: workspaceSettings.focusAreas,\n    teamInteractions: workspaceSettings.teamInteractions,\n    problemTypes,\n    toolchain: languageConfig?.toolchain || ['npm', 'node', 'vite', 'jest'],\n    frameworks: languageConfig?.frameworks || ['React', 'Express', 'Next.js'],\n    difficultyCalibration: {\n      complexity: levelConfig.complexity,\n      scaffolding: levelConfig.scaffolding,\n      expectations: levelConfig.expectations,\n    },\n  };\n}\n\n/**\n * Get level-specific adjustments for interview questions\n */\nexport function getLevelAdjustments(level: Level): {\n  difficultyLabel: string;\n  questionDepth: 'surface' | 'moderate' | 'deep' | 'expert';\n  timeAllocation: number; // minutes per question\n  followUpLikelihood: number; // 0-1\n  hintAvailability: boolean;\n} {\n  const adjustments: Record<Level, ReturnType<typeof getLevelAdjustments>> = {\n    intern: {\n      difficultyLabel: 'junior',\n      questionDepth: 'surface',\n      timeAllocation: 3,\n      followUpLikelihood: 0.3,\n      hintAvailability: true,\n    },\n    junior: {\n      difficultyLabel: 'junior',\n      questionDepth: 'moderate',\n      timeAllocation: 4,\n      followUpLikelihood: 0.5,\n      hintAvailability: true,\n    },\n    mid: {\n      difficultyLabel: 'mid',\n      questionDepth: 'deep',\n      timeAllocation: 5,\n      followUpLikelihood: 0.7,\n      hintAvailability: false,\n    },\n    senior: {\n      difficultyLabel: 'senior',\n      questionDepth: 'expert',\n      timeAllocation: 6,\n      followUpLikelihood: 0.9,\n      hintAvailability: false,\n    },\n  };\n  \n  return adjustments[level];\n}\n\n/**\n * Get language-specific code examples and error patterns\n */\nexport function getLanguageExamples(language: Language): {\n  sampleCode: string;\n  commonErrors: string[];\n  testCommand: string;\n  buildCommand: string;\n  packageManager: string;\n} {\n  const examples: Record<Language, ReturnType<typeof getLanguageExamples>> = {\n    javascript: {\n      sampleCode: `function formatDate(date) {\n  return new Date(date).toLocaleDateString();\n}`,\n      commonErrors: [\n        'TypeError: Cannot read property of undefined',\n        'ReferenceError: variable is not defined',\n        'SyntaxError: Unexpected token',\n      ],\n      testCommand: 'npm test',\n      buildCommand: 'npm run build',\n      packageManager: 'npm',\n    },\n    python: {\n      sampleCode: `def format_date(date):\n    from datetime import datetime\n    return datetime.strptime(date, '%Y-%m-%d').strftime('%B %d, %Y')`,\n      commonErrors: [\n        'TypeError: unsupported operand type',\n        'NameError: name is not defined',\n        'IndentationError: unexpected indent',\n      ],\n      testCommand: 'pytest',\n      buildCommand: 'python setup.py build',\n      packageManager: 'pip',\n    },\n    c_cpp: {\n      sampleCode: `#include <stdio.h>\nvoid format_date(const char* date) {\n    printf(\"Date: %s\\\\n\", date);\n}`,\n      commonErrors: [\n        'Segmentation fault (core dumped)',\n        'undefined reference to function',\n        'implicit declaration of function',\n      ],\n      testCommand: './run_tests',\n      buildCommand: 'make build',\n      packageManager: 'cmake',\n    },\n  };\n  \n  return examples[language];\n}\n\n/**\n * Map display role name to internal role key\n */\nexport function normalizeRole(roleName: string): Role {\n  const roleMap: Record<string, Role> = {\n    'developer': 'developer',\n    'software developer': 'developer',\n    'software engineer': 'developer',\n    'engineer': 'developer',\n    'pm': 'pm',\n    'product manager': 'pm',\n    'product': 'pm',\n    'qa': 'qa',\n    'qa engineer': 'qa',\n    'quality assurance': 'qa',\n    'tester': 'qa',\n    'devops': 'devops',\n    'devops engineer': 'devops',\n    'sre': 'devops',\n    'site reliability': 'devops',\n    'data science': 'data_science',\n    'data scientist': 'data_science',\n    'data_science': 'data_science',\n    'ml engineer': 'data_science',\n  };\n  \n  const normalized = roleName.toLowerCase().trim();\n  return roleMap[normalized] || 'developer';\n}\n\n/**\n * Map display level name to internal level key\n */\nexport function normalizeLevel(levelName: string): Level {\n  const levelMap: Record<string, Level> = {\n    'intern': 'intern',\n    'internship': 'intern',\n    'entry': 'intern',\n    'junior': 'junior',\n    'associate': 'junior',\n    'mid': 'mid',\n    'mid-level': 'mid',\n    'intermediate': 'mid',\n    'senior': 'senior',\n    'lead': 'senior',\n    'staff': 'senior',\n    'principal': 'senior',\n  };\n  \n  const normalized = levelName.toLowerCase().trim();\n  return levelMap[normalized] || 'intern';\n}\n","path":null,"size_bytes":10010,"size_tokens":null},"server/services/adapter-service.ts":{"content":"/**\n * Server-side Adapter Service for Phase 2\n * \n * Fetches role adapter data from storage and provides\n * configured settings for both Interview and Workspace simulators.\n */\n\nimport { storage } from \"../storage\";\nimport type { RoleAdapter, SimulationCatalogue } from \"@shared/schema\";\nimport {\n  type Role,\n  type Level,\n  type Language,\n  type InterviewConfig,\n  type WorkspaceConfig,\n  type RoleAdapterData,\n  getInterviewConfig,\n  getWorkspaceConfig,\n  getLevelAdjustments,\n  getLanguageExamples,\n  normalizeRole,\n  normalizeLevel,\n} from \"@shared/adapters\";\n\nexport interface AdapterServiceConfig {\n  role: Role;\n  level: Level;\n  language?: Language;\n}\n\nclass AdapterService {\n  private adapterCache: Map<string, RoleAdapter> = new Map();\n  private cacheTimeout = 5 * 60 * 1000; // 5 minutes\n  private lastCacheClear = Date.now();\n\n  /**\n   * Get role adapter data, with caching\n   */\n  async getRoleAdapter(role: Role): Promise<RoleAdapterData | null> {\n    // Clear cache if expired\n    if (Date.now() - this.lastCacheClear > this.cacheTimeout) {\n      this.adapterCache.clear();\n      this.lastCacheClear = Date.now();\n    }\n\n    // Check cache first\n    if (this.adapterCache.has(role)) {\n      const cached = this.adapterCache.get(role)!;\n      return this.transformAdapter(cached);\n    }\n\n    // Fetch from storage\n    const adapter = await storage.getRoleAdapter(role);\n    if (!adapter) {\n      console.warn(`Role adapter not found for role: ${role}`);\n      return null;\n    }\n\n    // Cache and return\n    this.adapterCache.set(role, adapter);\n    return this.transformAdapter(adapter);\n  }\n\n  /**\n   * Transform database adapter to service format\n   */\n  private transformAdapter(adapter: RoleAdapter): RoleAdapterData {\n    return {\n      role: adapter.role,\n      displayName: adapter.displayName,\n      description: adapter.description,\n      levels: adapter.levels as RoleAdapterData['levels'],\n      languageOverrides: adapter.languageOverrides as RoleAdapterData['languageOverrides'],\n      simulatorSettings: adapter.simulatorSettings as RoleAdapterData['simulatorSettings'],\n    };\n  }\n\n  /**\n   * Get full interview configuration for a user\n   */\n  async getInterviewConfiguration(config: AdapterServiceConfig): Promise<InterviewConfig | null> {\n    const adapterData = await this.getRoleAdapter(config.role);\n    if (!adapterData) {\n      return null;\n    }\n    return getInterviewConfig(adapterData, config.level);\n  }\n\n  /**\n   * Get full workspace configuration for a user\n   */\n  async getWorkspaceConfiguration(config: AdapterServiceConfig): Promise<WorkspaceConfig | null> {\n    const adapterData = await this.getRoleAdapter(config.role);\n    if (!adapterData) {\n      return null;\n    }\n    return getWorkspaceConfig(adapterData, config.level, config.language || 'javascript');\n  }\n\n  /**\n   * Get catalogue items filtered for a specific configuration\n   */\n  async getCatalogueForConfig(\n    simulator: 'interview' | 'workspace',\n    config: AdapterServiceConfig\n  ): Promise<SimulationCatalogue[]> {\n    return storage.getCatalogueItems({\n      simulator,\n      role: config.role,\n      level: config.level,\n      language: config.language,\n    });\n  }\n\n  /**\n   * Get interview question configuration\n   * Adjusts question parameters based on role and level\n   */\n  async getInterviewQuestionConfig(config: AdapterServiceConfig): Promise<{\n    questionTypes: string[];\n    difficulty: string;\n    focusAreas: string[];\n    panelRoles: string[];\n    levelAdjustments: ReturnType<typeof getLevelAdjustments>;\n    evaluationCriteria: InterviewConfig['evaluationCriteria'];\n  } | null> {\n    const interviewConfig = await this.getInterviewConfiguration(config);\n    if (!interviewConfig) {\n      return null;\n    }\n\n    const levelAdjustments = getLevelAdjustments(config.level);\n\n    return {\n      questionTypes: interviewConfig.questionTypes,\n      difficulty: levelAdjustments.difficultyLabel,\n      focusAreas: interviewConfig.focusAreas,\n      panelRoles: interviewConfig.panelRoles,\n      levelAdjustments,\n      evaluationCriteria: interviewConfig.evaluationCriteria,\n    };\n  }\n\n  /**\n   * Get workspace problem configuration\n   * Adjusts problem parameters based on role, level, and language\n   */\n  async getWorkspaceProblemConfig(config: AdapterServiceConfig): Promise<{\n    problemTypes: string[];\n    teamInteractions: string[];\n    focusAreas: string[];\n    toolchain: string[];\n    frameworks: string[];\n    languageExamples: ReturnType<typeof getLanguageExamples>;\n    difficultyCalibration: WorkspaceConfig['difficultyCalibration'];\n  } | null> {\n    const workspaceConfig = await this.getWorkspaceConfiguration(config);\n    if (!workspaceConfig) {\n      return null;\n    }\n\n    const languageExamples = getLanguageExamples(config.language || 'javascript');\n\n    return {\n      problemTypes: workspaceConfig.problemTypes,\n      teamInteractions: workspaceConfig.teamInteractions,\n      focusAreas: workspaceConfig.focusAreas,\n      toolchain: workspaceConfig.toolchain,\n      frameworks: workspaceConfig.frameworks,\n      languageExamples,\n      difficultyCalibration: workspaceConfig.difficultyCalibration,\n    };\n  }\n\n  /**\n   * Get all available roles with their display names\n   */\n  async getAvailableRoles(): Promise<{ role: Role; displayName: string; description: string }[]> {\n    const adapters = await storage.getRoleAdapters();\n    return adapters.map(a => ({\n      role: a.role as Role,\n      displayName: a.displayName,\n      description: a.description,\n    }));\n  }\n\n  /**\n   * Get all available levels for a role\n   */\n  async getAvailableLevels(role: Role): Promise<{ level: Level; title: string; expectations: string[] }[]> {\n    const adapter = await this.getRoleAdapter(role);\n    if (!adapter) {\n      return [];\n    }\n\n    return Object.entries(adapter.levels).map(([level, config]) => ({\n      level: level as Level,\n      title: config.title,\n      expectations: config.expectations,\n    }));\n  }\n\n  /**\n   * Get available languages for developer role\n   */\n  async getAvailableLanguages(role: Role): Promise<{ language: Language; toolchain: string[]; frameworks: string[] }[]> {\n    const adapter = await this.getRoleAdapter(role);\n    if (!adapter || !adapter.languageOverrides) {\n      return [{ language: 'javascript', toolchain: ['npm', 'node'], frameworks: ['React', 'Express'] }];\n    }\n\n    return Object.entries(adapter.languageOverrides).map(([lang, config]) => ({\n      language: lang as Language,\n      toolchain: config.toolchain,\n      frameworks: config.frameworks,\n    }));\n  }\n\n  /**\n   * Check if a role-level-language combination is valid\n   */\n  async isValidConfiguration(config: AdapterServiceConfig): Promise<boolean> {\n    const adapter = await this.getRoleAdapter(config.role);\n    if (!adapter) {\n      return false;\n    }\n\n    // Check level exists\n    if (!adapter.levels[config.level]) {\n      return false;\n    }\n\n    // Check language exists (if provided and role supports it)\n    if (config.language && adapter.languageOverrides) {\n      if (!adapter.languageOverrides[config.language]) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n}\n\n// Export singleton instance\nexport const adapterService = new AdapterService();\n\n// Re-export helper functions\nexport { normalizeRole, normalizeLevel, getLevelAdjustments, getLanguageExamples };\n","path":null,"size_bytes":7354,"size_tokens":null},"client/src/components/progression-dashboard.tsx":{"content":"import { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  useProgressionSummary, \n  useExitEligibility, \n  useCurrentSprint,\n  useGraduateJourney,\n  type ExitEligibility\n} from \"@/hooks/use-progression\";\nimport { \n  TrendingUp, \n  CheckCircle2, \n  Clock, \n  Target, \n  Award,\n  ChevronRight,\n  Zap,\n  AlertCircle,\n  Loader2,\n  GraduationCap\n} from \"lucide-react\";\nimport type { ReadinessScore, MasteryBand } from \"@shared/schema\";\n\ntype CompetencyBreakdown = ReadinessScore['competencyBreakdown'][number];\n\ninterface ProgressionDashboardProps {\n  journeyId: number;\n  userId: number;\n  onStartActivity?: () => void;\n  onViewSnapshots?: () => void;\n  compact?: boolean;\n}\n\nfunction getBandColor(band: MasteryBand | string): string {\n  switch (band) {\n    case 'explorer':\n      return 'bg-amber-100 text-amber-800 border-amber-200';\n    case 'contributor':\n      return 'bg-blue-100 text-blue-800 border-blue-200';\n    case 'junior_ready':\n      return 'bg-green-100 text-green-800 border-green-200';\n    default:\n      return 'bg-gray-100 text-gray-800 border-gray-200';\n  }\n}\n\nfunction getBandLabel(band: MasteryBand | string): string {\n  switch (band) {\n    case 'explorer':\n      return 'Explorer';\n    case 'contributor':\n      return 'Contributor';\n    case 'junior_ready':\n      return 'Junior Ready';\n    default:\n      return band;\n  }\n}\n\nfunction getReadinessColor(score: number): string {\n  if (score >= 85) return 'text-green-600';\n  if (score >= 60) return 'text-blue-600';\n  if (score >= 40) return 'text-amber-600';\n  return 'text-gray-600';\n}\n\nfunction ReadinessScoreCard({ readiness }: { readiness: ReadinessScore }) {\n  return (\n    <Card data-testid=\"card-readiness-score\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium text-gray-600 flex items-center gap-2\">\n          <Target className=\"h-4 w-4\" />\n          Overall Readiness\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex items-end gap-2 mb-3\">\n          <span className={`text-4xl font-bold ${getReadinessColor(readiness.overallScore)}`}>\n            {readiness.overallScore}%\n          </span>\n          <span className=\"text-gray-500 text-sm mb-1\">of Junior Ready</span>\n        </div>\n        <Progress \n          value={readiness.overallScore} \n          className=\"h-2 mb-3\"\n          data-testid=\"progress-readiness\"\n        />\n        <div className=\"flex flex-wrap gap-2\">\n          {readiness.strengths?.slice(0, 3).map((strength, i) => (\n            <Badge key={i} variant=\"secondary\" className=\"bg-green-50 text-green-700 text-xs\">\n              {strength}\n            </Badge>\n          ))}\n        </div>\n        {readiness.gaps && readiness.gaps.length > 0 && (\n          <div className=\"mt-2 flex flex-wrap gap-2\">\n            {readiness.gaps.slice(0, 2).map((gap, i) => (\n              <Badge key={i} variant=\"outline\" className=\"text-amber-700 border-amber-200 text-xs\">\n                Focus: {gap}\n              </Badge>\n            ))}\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction SprintProgressCard({ \n  journeyId,\n  completedSprints,\n  currentSprintNumber \n}: { \n  journeyId: number;\n  completedSprints: number;\n  currentSprintNumber: number;\n}) {\n  const { data: sprintData, isLoading } = useCurrentSprint(journeyId);\n  \n  if (isLoading) {\n    return (\n      <Card data-testid=\"card-sprint-progress\">\n        <CardContent className=\"p-6 flex items-center justify-center\">\n          <Loader2 className=\"h-6 w-6 animate-spin text-gray-400\" />\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const activitiesCompleted = sprintData?.activities?.filter(a => a.status === 'completed').length || 0;\n  const totalActivities = sprintData?.activities?.length || 0;\n  const progressPercent = totalActivities > 0 ? Math.round((activitiesCompleted / totalActivities) * 100) : 0;\n\n  return (\n    <Card data-testid=\"card-sprint-progress\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium text-gray-600 flex items-center gap-2\">\n          <Zap className=\"h-4 w-4\" />\n          Sprint {currentSprintNumber} Progress\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex items-end gap-2 mb-3\">\n          <span className=\"text-4xl font-bold text-gray-900\">{activitiesCompleted}</span>\n          <span className=\"text-gray-500 text-sm mb-1\">of {totalActivities} activities</span>\n        </div>\n        <Progress \n          value={progressPercent} \n          className=\"h-2 mb-3\"\n          data-testid=\"progress-sprint-activities\"\n        />\n        <div className=\"flex items-center gap-4 text-sm text-gray-600\">\n          <div className=\"flex items-center gap-1\">\n            <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n            <span>{completedSprints} sprints completed</span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction ExitEligibilityCard({ \n  eligibility,\n  onGraduate,\n  isGraduating\n}: { \n  eligibility: ExitEligibility;\n  onGraduate: () => void;\n  isGraduating: boolean;\n}) {\n  const getStatusIcon = () => {\n    if (eligibility.recommendation === 'ready') {\n      return <Award className=\"h-5 w-5 text-green-500\" />;\n    }\n    if (eligibility.recommendation === 'suggest_exit') {\n      return <GraduationCap className=\"h-5 w-5 text-blue-500\" />;\n    }\n    return <Clock className=\"h-5 w-5 text-amber-500\" />;\n  };\n\n  const getStatusBadge = () => {\n    if (eligibility.recommendation === 'ready') {\n      return <Badge className=\"bg-green-100 text-green-800\">Ready to Graduate</Badge>;\n    }\n    if (eligibility.recommendation === 'suggest_exit') {\n      return <Badge className=\"bg-blue-100 text-blue-800\">Graduation Recommended</Badge>;\n    }\n    return <Badge variant=\"secondary\">In Progress</Badge>;\n  };\n\n  return (\n    <Card data-testid=\"card-exit-eligibility\">\n      <CardHeader className=\"pb-2\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-sm font-medium text-gray-600 flex items-center gap-2\">\n            {getStatusIcon()}\n            Graduation Status\n          </CardTitle>\n          {getStatusBadge()}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <p className=\"text-sm text-gray-700 mb-4\">{eligibility.message}</p>\n        \n        <div className=\"grid grid-cols-2 gap-2 mb-4\">\n          <div className={`flex items-center gap-2 text-xs ${\n            eligibility.reasons.minSprintsMet ? 'text-green-600' : 'text-gray-400'\n          }`}>\n            {eligibility.reasons.minSprintsMet ? (\n              <CheckCircle2 className=\"h-3 w-3\" />\n            ) : (\n              <AlertCircle className=\"h-3 w-3\" />\n            )}\n            Minimum sprints\n          </div>\n          <div className={`flex items-center gap-2 text-xs ${\n            eligibility.reasons.readinessThresholdMet ? 'text-green-600' : 'text-gray-400'\n          }`}>\n            {eligibility.reasons.readinessThresholdMet ? (\n              <CheckCircle2 className=\"h-3 w-3\" />\n            ) : (\n              <AlertCircle className=\"h-3 w-3\" />\n            )}\n            Readiness threshold\n          </div>\n        </div>\n\n        {eligibility.canExit && (\n          <Button \n            className=\"w-full\"\n            onClick={onGraduate}\n            disabled={isGraduating}\n            data-testid=\"button-graduate\"\n          >\n            {isGraduating ? (\n              <>\n                <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                Processing...\n              </>\n            ) : (\n              <>\n                <GraduationCap className=\"h-4 w-4 mr-2\" />\n                Graduate Now\n              </>\n            )}\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction CompetencyBreakdownCard({ breakdown }: { breakdown: CompetencyBreakdown[] }) {\n  return (\n    <Card data-testid=\"card-competency-breakdown\">\n      <CardHeader className=\"pb-2\">\n        <CardTitle className=\"text-sm font-medium text-gray-600 flex items-center gap-2\">\n          <TrendingUp className=\"h-4 w-4\" />\n          Competency Progress\n        </CardTitle>\n      </CardHeader>\n      <CardContent>\n        <div className=\"space-y-3\">\n          {breakdown.slice(0, 5).map((comp) => (\n            <div key={comp.slug} className=\"space-y-1\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium text-gray-700 capitalize\">\n                  {comp.slug.replace(/-/g, ' ')}\n                </span>\n                <Badge className={`text-xs ${getBandColor(comp.band)}`}>\n                  {getBandLabel(comp.band)}\n                </Badge>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Progress \n                  value={comp.confidence} \n                  className=\"h-1.5 flex-1\"\n                  data-testid={`progress-competency-${comp.slug}`}\n                />\n                <span className=\"text-xs text-gray-500 w-8\">{comp.confidence}%</span>\n              </div>\n            </div>\n          ))}\n        </div>\n        {breakdown.length > 5 && (\n          <p className=\"text-xs text-gray-500 mt-3\">\n            +{breakdown.length - 5} more competencies\n          </p>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function ProgressionDashboard({ \n  journeyId, \n  userId,\n  onStartActivity,\n  onViewSnapshots,\n  compact = false \n}: ProgressionDashboardProps) {\n  const { data: summary, isLoading: summaryLoading } = useProgressionSummary(journeyId);\n  const { data: eligibility, isLoading: eligibilityLoading } = useExitEligibility(journeyId);\n  \n  const graduateMutation = useGraduateJourney();\n\n  const handleGraduate = () => {\n    const trigger = eligibility?.reasons.readinessThresholdMet \n      ? 'readiness_threshold' \n      : eligibility?.reasons.maxSprintsReached \n        ? 'max_sprints' \n        : 'user_choice';\n    \n    graduateMutation.mutate({ journeyId, exitTrigger: trigger });\n  };\n\n  if (summaryLoading || eligibilityLoading) {\n    return (\n      <div className=\"flex items-center justify-center p-8\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-gray-400\" />\n      </div>\n    );\n  }\n\n  if (!summary || !eligibility) {\n    return (\n      <Card>\n        <CardContent className=\"p-6 text-center text-gray-500\">\n          No journey data available\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const { journey, readiness } = summary;\n\n  if (compact) {\n    return (\n      <Card data-testid=\"card-progression-compact\">\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"flex items-center gap-2\">\n                <Target className=\"h-4 w-4 text-gray-400\" />\n                <span className={`font-bold ${getReadinessColor(readiness.overallScore)}`}>\n                  {readiness.overallScore}%\n                </span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Zap className=\"h-4 w-4 text-gray-400\" />\n                <span className=\"text-sm text-gray-600\">\n                  Sprint {journey.currentSprintNumber}\n                </span>\n              </div>\n            </div>\n            {onStartActivity && (\n              <Button size=\"sm\" onClick={onStartActivity} data-testid=\"button-continue-activity\">\n                Continue\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"container-progression-dashboard\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        <ReadinessScoreCard readiness={readiness} />\n        <SprintProgressCard \n          journeyId={journeyId}\n          completedSprints={journey.completedSprints}\n          currentSprintNumber={journey.currentSprintNumber}\n        />\n        <ExitEligibilityCard \n          eligibility={eligibility}\n          onGraduate={handleGraduate}\n          isGraduating={graduateMutation.isPending}\n        />\n      </div>\n      \n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <CompetencyBreakdownCard breakdown={readiness.competencyBreakdown} />\n        \n        <Card data-testid=\"card-journey-stats\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-gray-600 flex items-center gap-2\">\n              <Clock className=\"h-4 w-4\" />\n              Journey Stats\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n                <p className=\"text-2xl font-bold text-gray-900\">{journey.completedSprints}</p>\n                <p className=\"text-xs text-gray-500\">Sprints Completed</p>\n              </div>\n              <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n                <p className=\"text-2xl font-bold text-gray-900\">{journey.currentSprintNumber}</p>\n                <p className=\"text-xs text-gray-500\">Current Sprint</p>\n              </div>\n              <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n                <p className=\"text-2xl font-bold text-gray-900\">{summary.arcs.length}</p>\n                <p className=\"text-xs text-gray-500\">Total Arcs</p>\n              </div>\n              <div className=\"text-center p-3 bg-gray-50 rounded-lg\">\n                <p className=\"text-2xl font-bold text-gray-900\">{summary.snapshots.length}</p>\n                <p className=\"text-xs text-gray-500\">Checkpoints</p>\n              </div>\n            </div>\n            \n            {onViewSnapshots && (\n              <Button \n                variant=\"outline\" \n                className=\"w-full mt-4\"\n                onClick={onViewSnapshots}\n                data-testid=\"button-view-snapshots\"\n              >\n                View Progress History\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n\nexport function ProgressionDashboardSkeleton() {\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n        {[1, 2, 3].map((i) => (\n          <Card key={i}>\n            <CardContent className=\"p-6\">\n              <div className=\"animate-pulse\">\n                <div className=\"h-4 bg-gray-200 rounded w-1/2 mb-4\"></div>\n                <div className=\"h-8 bg-gray-200 rounded w-3/4 mb-3\"></div>\n                <div className=\"h-2 bg-gray-200 rounded w-full\"></div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":15111,"size_tokens":null},"server/services/sprint-generator.ts":{"content":"import {\n  BugTemplate,\n  FeatureTemplate,\n  SoftSkillTemplate,\n  ProblemTemplate,\n  SprintTheme,\n  GeneratedSprintBacklog,\n  TemplateDifficulty,\n  MasteryBand,\n  SprintGenerationRequest,\n} from \"@shared/schema\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nconst TEMPLATES_BASE_PATH = path.join(process.cwd(), \"shared/catalogue/templates\");\n\ninterface TemplateIndex {\n  version: string;\n  templates: {\n    bugs: Array<{ id: string; file: string; name: string; difficulty: string[] }>;\n    features: Array<{ id: string; file: string; name: string; difficulty: string[] }>;\n    soft_skills: Array<{ id: string; file: string; name: string; skillType: string }>;\n  };\n  themes: Array<{\n    id: string;\n    name: string;\n    description: string;\n    suggestedTemplates: {\n      bugs: string[];\n      features: string[];\n      softSkills: string[];\n    };\n  }>;\n}\n\nexport class SprintGenerator {\n  private templateIndex: TemplateIndex | null = null;\n  private templateCache: Map<string, ProblemTemplate> = new Map();\n  private themeCache: Map<string, SprintTheme> = new Map();\n\n  constructor() {\n    this.loadIndex();\n  }\n\n  private loadIndex(): void {\n    try {\n      const indexPath = path.join(TEMPLATES_BASE_PATH, \"index.json\");\n      const indexContent = fs.readFileSync(indexPath, \"utf-8\");\n      this.templateIndex = JSON.parse(indexContent);\n      \n      if (this.templateIndex?.themes) {\n        for (const theme of this.templateIndex.themes) {\n          this.themeCache.set(theme.id, {\n            id: theme.id,\n            name: theme.name,\n            description: theme.description,\n            industries: [],\n            suggestedTemplates: theme.suggestedTemplates,\n          });\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to load template index:\", error);\n      this.templateIndex = null;\n    }\n  }\n\n  private loadTemplate(category: 'bugs' | 'features' | 'soft_skills', id: string): ProblemTemplate | null {\n    const cacheKey = `${category}:${id}`;\n    \n    if (this.templateCache.has(cacheKey)) {\n      return this.templateCache.get(cacheKey)!;\n    }\n\n    if (!this.templateIndex) return null;\n\n    const categoryTemplates = this.templateIndex.templates[category];\n    const templateMeta = categoryTemplates.find(t => t.id === id);\n    \n    if (!templateMeta) return null;\n\n    try {\n      const templatePath = path.join(TEMPLATES_BASE_PATH, templateMeta.file);\n      const templateContent = fs.readFileSync(templatePath, \"utf-8\");\n      const template = JSON.parse(templateContent) as ProblemTemplate;\n      this.templateCache.set(cacheKey, template);\n      return template;\n    } catch (error) {\n      console.error(`Failed to load template ${id}:`, error);\n      return null;\n    }\n  }\n\n  getAvailableThemes(): SprintTheme[] {\n    return Array.from(this.themeCache.values());\n  }\n\n  getTheme(themeId: string): SprintTheme | null {\n    return this.themeCache.get(themeId) || null;\n  }\n\n  getTemplatesByDifficulty(masteryBand: MasteryBand): {\n    bugs: string[];\n    features: string[];\n    softSkills: string[];\n  } {\n    if (!this.templateIndex) {\n      return { bugs: [], features: [], softSkills: [] };\n    }\n\n    const difficultyMap: Record<MasteryBand, TemplateDifficulty[]> = {\n      explorer: [\"guided\"],\n      contributor: [\"guided\", \"supported\"],\n      junior_ready: [\"supported\", \"independent\"],\n    };\n\n    const targetDifficulties = difficultyMap[masteryBand];\n\n    const bugs = this.templateIndex.templates.bugs\n      .filter(t => t.difficulty.some(d => targetDifficulties.includes(d as TemplateDifficulty)))\n      .map(t => t.id);\n\n    const features = this.templateIndex.templates.features\n      .filter(t => t.difficulty.some(d => targetDifficulties.includes(d as TemplateDifficulty)))\n      .map(t => t.id);\n\n    const softSkills = this.templateIndex.templates.soft_skills.map(t => t.id);\n\n    return { bugs, features, softSkills };\n  }\n\n  private mapMasteryBandToTemplateDifficulty(band: MasteryBand): TemplateDifficulty {\n    const mapping: Record<MasteryBand, TemplateDifficulty> = {\n      explorer: \"guided\",\n      contributor: \"supported\",\n      junior_ready: \"independent\",\n    };\n    return mapping[band];\n  }\n\n  private difficultyBandToMasteryBand(difficultyBand: TemplateDifficulty): MasteryBand {\n    const mapping: Record<TemplateDifficulty, MasteryBand> = {\n      guided: \"explorer\",\n      supported: \"contributor\",\n      independent: \"junior_ready\",\n      expert: \"junior_ready\",\n    };\n    return mapping[difficultyBand];\n  }\n\n  private validateContextVariables(\n    template: string,\n    context: Record<string, string>\n  ): { isValid: boolean; missingVars: string[] } {\n    const placeholderRegex = /\\{([^}]+)\\}/g;\n    const missingVars: string[] = [];\n    let match;\n    \n    while ((match = placeholderRegex.exec(template)) !== null) {\n      const varName = match[1];\n      if (!context[varName] && varName !== 'Feature') {\n        missingVars.push(varName);\n      }\n    }\n    \n    return { isValid: missingVars.length === 0, missingVars };\n  }\n\n  private applyContextVariables(\n    template: string,\n    context: Record<string, string>\n  ): string {\n    let result = template;\n    for (const [key, value] of Object.entries(context)) {\n      const placeholder = new RegExp(`\\\\{${key}\\\\}`, \"g\");\n      result = result.replace(placeholder, value);\n    }\n    \n    result = result.replace(/\\{([^}]+)\\}/g, (match, varName) => {\n      console.warn(`Missing context variable: ${varName}, using placeholder`);\n      return `[${varName}]`;\n    });\n    \n    return result;\n  }\n\n  private selectContextValues(\n    template: ProblemTemplate,\n    industry: string = \"saas\"\n  ): Record<string, string> {\n    const context: Record<string, string> = {};\n    \n    for (const variable of template.contextVariables) {\n      const example = variable.examples[industry] || Object.values(variable.examples)[0];\n      context[variable.key] = example;\n    }\n    \n    return context;\n  }\n\n  private selectRandomItems<T>(items: T[], count: number): T[] {\n    const shuffled = [...items].sort(() => Math.random() - 0.5);\n    return shuffled.slice(0, count);\n  }\n\n  async generateSprint(request: SprintGenerationRequest): Promise<GeneratedSprintBacklog> {\n    const theme = this.selectTheme(request);\n    const masteryBand = this.difficultyBandToMasteryBand(request.difficultyBand);\n    const availableTemplates = this.getTemplatesByDifficulty(masteryBand);\n    \n    const themeConfig = this.themeCache.get(theme.id);\n    let bugPool = themeConfig?.suggestedTemplates.bugs || availableTemplates.bugs;\n    let featurePool = themeConfig?.suggestedTemplates.features || availableTemplates.features;\n    let softSkillPool = themeConfig?.suggestedTemplates.softSkills || availableTemplates.softSkills;\n\n    const usedTemplatesFromPreviousSprints = this.extractUsedTemplates(request.previousSprints);\n    \n    bugPool = bugPool.filter(id => \n      !request.avoidTemplates.includes(id) && \n      !usedTemplatesFromPreviousSprints.includes(id)\n    );\n    featurePool = featurePool.filter(id => \n      !request.avoidTemplates.includes(id) && \n      !usedTemplatesFromPreviousSprints.includes(id)\n    );\n    softSkillPool = softSkillPool.filter(id => \n      !request.avoidTemplates.includes(id) &&\n      !usedTemplatesFromPreviousSprints.includes(id)\n    );\n\n    if (request.userCompetencyGaps.length > 0) {\n      bugPool = this.prioritizeByCompetencyGaps(bugPool, 'bugs', request.userCompetencyGaps);\n      featurePool = this.prioritizeByCompetencyGaps(featurePool, 'features', request.userCompetencyGaps);\n    }\n\n    if (bugPool.length === 0) {\n      console.warn(\"No bugs available after filtering, using all bugs for mastery band\");\n      bugPool = availableTemplates.bugs;\n    }\n    if (featurePool.length === 0) {\n      console.warn(\"No features available after filtering, using all features for mastery band\");\n      featurePool = availableTemplates.features;\n    }\n    if (softSkillPool.length === 0) {\n      console.warn(\"No soft skills available after filtering, using all soft skills\");\n      softSkillPool = this.getAllTemplateIds().softSkills;\n    }\n\n    const targetBugCount = Math.min(2, bugPool.length);\n    const targetFeatureCount = Math.min(1, featurePool.length);\n    const targetSoftSkillCount = Math.min(2, softSkillPool.length);\n\n    const selectedBugs = this.selectRandomItems(bugPool, targetBugCount);\n    const selectedFeatures = this.selectRandomItems(featurePool, targetFeatureCount);\n    const selectedSoftSkills = this.selectRandomItems(softSkillPool, targetSoftSkillCount);\n\n    const tickets = this.generateTickets(\n      selectedBugs,\n      selectedFeatures,\n      request.difficultyBand\n    );\n    \n    const softSkillEvents = this.generateSoftSkillEvents(selectedSoftSkills);\n    const ceremonies = this.generateCeremonies(theme, tickets);\n\n    const validatedBacklog = this.validateAndRepairBacklog({\n      theme,\n      tickets,\n      softSkillEvents,\n      ceremonies,\n    }, request.difficultyBand);\n\n    console.log(`Generated sprint for journey ${request.journeyId}: ${validatedBacklog.tickets.length} tickets, ${validatedBacklog.softSkillEvents.length} soft skill events`);\n\n    return validatedBacklog;\n  }\n\n  private validateAndRepairBacklog(\n    backlog: GeneratedSprintBacklog,\n    difficultyBand: TemplateDifficulty\n  ): GeneratedSprintBacklog {\n    const validated = { ...backlog };\n    const warnings: string[] = [];\n\n    if (validated.tickets.length === 0) {\n      warnings.push(\"No tickets generated - adding fallback ticket\");\n      validated.tickets = [{\n        templateId: \"fallback-bug\",\n        type: \"bug\",\n        day: 1,\n        appliedContext: {},\n        generatedTicket: {\n          title: \"Review and fix console warnings\",\n          description: \"Check the browser console and server logs for any warnings or non-critical errors. Document and address the most common issues.\",\n          acceptanceCriteria: [\n            \"Identify at least 3 console warnings\",\n            \"Fix or document each warning with a resolution plan\",\n            \"Verify no new warnings are introduced\"\n          ],\n          difficulty: this.mapMasteryBandToTemplateDifficulty(\n            this.difficultyBandToMasteryBand(difficultyBand)\n          ),\n        },\n      }];\n    }\n\n    for (const ticket of validated.tickets) {\n      if (!ticket.generatedTicket) {\n        warnings.push(`Ticket ${ticket.templateId} missing generatedTicket, creating default`);\n        ticket.generatedTicket = {\n          title: `Task: ${ticket.templateId}`,\n          description: \"Complete the assigned task as specified.\",\n          acceptanceCriteria: [\"Task completed as described\", \"Code follows conventions\"],\n          difficulty: this.mapMasteryBandToTemplateDifficulty(\n            this.difficultyBandToMasteryBand(difficultyBand)\n          ),\n        };\n      }\n      \n      if (!ticket.generatedTicket.title) {\n        warnings.push(`Ticket ${ticket.templateId} has missing title`);\n        ticket.generatedTicket.title = `Task: ${ticket.templateId}`;\n      } else if (ticket.generatedTicket.title.includes('[')) {\n        warnings.push(`Ticket ${ticket.templateId} has incomplete title`);\n        ticket.generatedTicket.title = ticket.generatedTicket.title.replace(/\\[([^\\]]+)\\]/g, 'the $1');\n      }\n      \n      if (!ticket.generatedTicket.description || ticket.generatedTicket.description.length < 10) {\n        warnings.push(`Ticket ${ticket.templateId} has missing/short description`);\n        ticket.generatedTicket.description = ticket.generatedTicket.description || \n          `Complete the task as described in the title: ${ticket.generatedTicket.title}`;\n      }\n      \n      if (!ticket.generatedTicket.acceptanceCriteria?.length) {\n        warnings.push(`Ticket ${ticket.templateId} missing acceptance criteria`);\n        ticket.generatedTicket.acceptanceCriteria = [\n          \"Task is completed as described\",\n          \"Code is clean and follows project conventions\",\n          \"Changes are tested\"\n        ];\n      }\n    }\n\n    for (const event of validated.softSkillEvents) {\n      if (!event.generatedScenario) {\n        warnings.push(`Soft skill event ${event.templateId} missing generatedScenario, creating default`);\n        event.generatedScenario = {\n          setup: \"A team member needs your input.\",\n          message: \"Hey, got a moment to help with something?\",\n          sender: \"Team Member\",\n          senderRole: \"Developer\",\n        };\n      }\n      \n      if (!event.generatedScenario.message) {\n        warnings.push(`Soft skill event ${event.templateId} has missing message`);\n        event.generatedScenario.message = \"Hey, got a moment to help with something?\";\n      } else if (event.generatedScenario.message.includes('[')) {\n        warnings.push(`Soft skill event ${event.templateId} has incomplete message`);\n        event.generatedScenario.message = event.generatedScenario.message.replace(/\\[([^\\]]+)\\]/g, 'the $1');\n      }\n    }\n\n    if (!validated.ceremonies?.planning?.script?.length) {\n      warnings.push(\"Missing planning ceremony, using fallback\");\n      validated.ceremonies = validated.ceremonies || {} as any;\n      validated.ceremonies.planning = {\n        day: 1,\n        script: [\n          \"Welcome to Sprint Planning!\",\n          \"Let's review what we'll be working on this sprint.\",\n          `We have ${validated.tickets.length} tickets to discuss.`,\n          \"Let's estimate and commit to our goals.\"\n        ]\n      };\n    }\n\n    if (warnings.length > 0) {\n      console.warn(`Sprint generation warnings:\\n${warnings.join('\\n')}`);\n    }\n\n    return validated;\n  }\n\n  private extractUsedTemplates(previousSprints: SprintGenerationRequest['previousSprints']): string[] {\n    const usedTemplates: string[] = [];\n    \n    for (const sprint of previousSprints) {\n      try {\n        const metadata = sprint.generationMetadata as any;\n        if (metadata?.usedTemplateIds && Array.isArray(metadata.usedTemplateIds)) {\n          usedTemplates.push(...metadata.usedTemplateIds);\n        }\n      } catch (e) {\n        continue;\n      }\n    }\n    \n    return usedTemplates;\n  }\n\n  private prioritizeByCompetencyGaps(\n    templateIds: string[],\n    category: 'bugs' | 'features',\n    gaps: string[]\n  ): string[] {\n    const prioritized: { id: string; priority: number }[] = [];\n    \n    for (const id of templateIds) {\n      const template = this.loadTemplate(category, id);\n      if (!template) continue;\n      \n      const matchingCompetencies = template.competencies.filter(c => \n        gaps.some(gap => c.toLowerCase().includes(gap.toLowerCase()))\n      );\n      \n      prioritized.push({\n        id,\n        priority: matchingCompetencies.length,\n      });\n    }\n    \n    prioritized.sort((a, b) => b.priority - a.priority);\n    return prioritized.map(p => p.id);\n  }\n\n  private selectTheme(request: SprintGenerationRequest): SprintTheme {\n    const previousThemes = request.previousSprints\n      .map(s => (s.generationMetadata as any)?.themeId || s.theme)\n      .filter(Boolean);\n\n    const availableThemes = Array.from(this.themeCache.values())\n      .filter(t => !request.avoidThemes.includes(t.id))\n      .filter(t => !previousThemes.includes(t.id));\n\n    if (availableThemes.length === 0) {\n      return Array.from(this.themeCache.values())[0] || {\n        id: \"default\",\n        name: \"General Development\",\n        description: \"A mix of development tasks\",\n        industries: [],\n        suggestedTemplates: { bugs: [], features: [], softSkills: [] },\n      };\n    }\n\n    const randomIndex = Math.floor(Math.random() * availableThemes.length);\n    return availableThemes[randomIndex];\n  }\n\n  private generateTickets(\n    bugIds: string[],\n    featureIds: string[],\n    difficultyBand: TemplateDifficulty\n  ): GeneratedSprintBacklog[\"tickets\"] {\n    const tickets: GeneratedSprintBacklog[\"tickets\"] = [];\n    const masteryBand = this.difficultyBandToMasteryBand(difficultyBand);\n    const difficulty = this.mapMasteryBandToTemplateDifficulty(masteryBand);\n    \n    let day = 1;\n\n    for (const bugId of bugIds) {\n      const template = this.loadTemplate(\"bugs\", bugId) as BugTemplate | null;\n      if (!template) continue;\n\n      const context = this.selectContextValues(template);\n      \n      tickets.push({\n        templateId: bugId,\n        type: \"bug\",\n        day: day++,\n        appliedContext: context,\n        generatedTicket: {\n          title: this.applyContextVariables(template.scenarioTemplate.ticketTitle, context),\n          description: this.applyContextVariables(template.scenarioTemplate.ticketDescription, context),\n          acceptanceCriteria: template.scenarioTemplate.acceptanceCriteria.map(\n            ac => this.applyContextVariables(ac, context)\n          ),\n          difficulty,\n        },\n      });\n    }\n\n    for (const featureId of featureIds) {\n      const template = this.loadTemplate(\"features\", featureId) as FeatureTemplate | null;\n      if (!template) continue;\n\n      const context = this.selectContextValues(template);\n      \n      tickets.push({\n        templateId: featureId,\n        type: \"feature\",\n        day: day++,\n        appliedContext: context,\n        generatedTicket: {\n          title: this.applyContextVariables(template.scenarioTemplate.ticketTitle, context),\n          description: this.applyContextVariables(template.scenarioTemplate.ticketDescription, context),\n          acceptanceCriteria: template.scenarioTemplate.acceptanceCriteria.map(\n            ac => this.applyContextVariables(ac, context)\n          ),\n          difficulty,\n        },\n      });\n    }\n\n    return tickets;\n  }\n\n  private generateSoftSkillEvents(\n    softSkillIds: string[]\n  ): GeneratedSprintBacklog[\"softSkillEvents\"] {\n    const events: GeneratedSprintBacklog[\"softSkillEvents\"] = [];\n\n    for (let i = 0; i < softSkillIds.length; i++) {\n      const template = this.loadTemplate(\"soft_skills\", softSkillIds[i]) as SoftSkillTemplate | null;\n      if (!template) continue;\n\n      const context = this.selectContextValues(template);\n      \n      events.push({\n        templateId: softSkillIds[i],\n        day: i + 2,\n        trigger: template.trigger,\n        appliedContext: context,\n        generatedScenario: {\n          setup: this.applyContextVariables(template.scenarioTemplate.setup, context),\n          message: this.applyContextVariables(template.scenarioTemplate.message, context),\n          sender: this.applyContextVariables(template.scenarioTemplate.sender, context),\n          senderRole: template.scenarioTemplate.senderRole,\n        },\n      });\n    }\n\n    return events;\n  }\n\n  private generateCeremonies(\n    theme: SprintTheme,\n    tickets: GeneratedSprintBacklog[\"tickets\"]\n  ): GeneratedSprintBacklog[\"ceremonies\"] {\n    const ticketSummary = tickets.map(t => t.generatedTicket.title).join(\", \");\n    \n    return {\n      planning: {\n        day: 1,\n        script: [\n          `Welcome to Sprint Planning! This sprint we're focusing on ${theme.name}.`,\n          `Our main focus: ${theme.description}`,\n          `We have ${tickets.length} tickets in the backlog: ${ticketSummary}`,\n          \"Let's estimate and commit to what we can deliver this sprint.\",\n          \"Any questions before we dive in?\",\n        ],\n      },\n      standups: [\n        {\n          day: 2,\n          script: [\n            \"Good morning! Let's do our daily standup.\",\n            \"Yesterday: Sprint kicked off, planning completed.\",\n            `Today: Working on ${tickets[0]?.generatedTicket.title || \"first ticket\"}.`,\n            \"Blockers: None so far.\",\n          ],\n        },\n        {\n          day: 3,\n          script: [\n            \"Standup time! How's everyone doing?\",\n            \"Progress check on current tickets.\",\n            \"Any blockers or concerns?\",\n          ],\n        },\n        {\n          day: 4,\n          script: [\n            \"Almost end of sprint! Final standup.\",\n            \"Let's make sure we're on track for the demo.\",\n            \"Any last-minute issues?\",\n          ],\n        },\n      ],\n      review: {\n        day: 5,\n        script: [\n          \"Welcome to Sprint Review!\",\n          `This sprint we focused on ${theme.name}.`,\n          \"Let's demo what we've accomplished.\",\n          \"Stakeholders, feel free to ask questions.\",\n          \"Great work team!\",\n        ],\n      },\n      retro: {\n        day: 5,\n        script: [\n          \"Time for our Retrospective!\",\n          \"What went well this sprint?\",\n          \"What could we improve?\",\n          \"Any action items for next sprint?\",\n          \"Thanks for the honest feedback!\",\n        ],\n      },\n    };\n  }\n\n  getTemplateDetails(category: 'bugs' | 'features' | 'soft_skills', id: string): ProblemTemplate | null {\n    return this.loadTemplate(category, id);\n  }\n\n  getAllTemplateIds(): {\n    bugs: string[];\n    features: string[];\n    softSkills: string[];\n  } {\n    if (!this.templateIndex) {\n      return { bugs: [], features: [], softSkills: [] };\n    }\n\n    return {\n      bugs: this.templateIndex.templates.bugs.map(t => t.id),\n      features: this.templateIndex.templates.features.map(t => t.id),\n      softSkills: this.templateIndex.templates.soft_skills.map(t => t.id),\n    };\n  }\n\n  getTemplateStats(): {\n    totalBugs: number;\n    totalFeatures: number;\n    totalSoftSkills: number;\n    totalThemes: number;\n  } {\n    if (!this.templateIndex) {\n      return { totalBugs: 0, totalFeatures: 0, totalSoftSkills: 0, totalThemes: 0 };\n    }\n\n    return {\n      totalBugs: this.templateIndex.templates.bugs.length,\n      totalFeatures: this.templateIndex.templates.features.length,\n      totalSoftSkills: this.templateIndex.templates.soft_skills.length,\n      totalThemes: this.templateIndex.themes.length,\n    };\n  }\n}\n\nexport const sprintGenerator = new SprintGenerator();\n","path":null,"size_bytes":21777,"size_tokens":null},"server/services/progression-engine.ts":{"content":"import { storage } from \"../storage\";\nimport type {\n  UserJourney,\n  JourneyArc,\n  Sprint,\n  SprintActivity,\n  CompetencyLedger,\n  CompetencySnapshot,\n  ReadinessScore,\n  MasteryBand,\n  DifficultyBand,\n  ProgressionRequirements,\n} from \"@shared/schema\";\n\ninterface CompetencyDeltaInput {\n  userId: number;\n  journeyId: number;\n  competencySlug: string;\n  source: 'workspace' | 'interview';\n  evidenceType: string;\n  evidenceData?: Record<string, unknown>;\n  score?: number;\n  activityId?: number;\n}\n\ninterface DeltaResult {\n  competencySlug: string;\n  previousBand: MasteryBand;\n  newBand: MasteryBand;\n  bandChanged: boolean;\n  previousConfidence: number;\n  newConfidence: number;\n  evidenceCount: number;\n}\n\ninterface ExitEligibility {\n  canExit: boolean;\n  reasons: {\n    minSprintsMet: boolean;\n    readinessThresholdMet: boolean;\n    maxSprintsReached: boolean;\n    userCanChoose: boolean;\n  };\n  recommendation: 'continue' | 'ready' | 'suggest_exit';\n  message: string;\n}\n\ninterface SprintCompletionResult {\n  arc: JourneyArc;\n  sprint: Sprint;\n  snapshot: CompetencySnapshot;\n  exitEligibility: ExitEligibility;\n  nextAction: 'start_new_sprint' | 'proceed_to_graduation' | 'continue_sprint';\n}\n\nclass ProgressionEngine {\n  private readonly BAND_WEIGHTS: Record<MasteryBand, number> = {\n    'explorer': 1,\n    'contributor': 2,\n    'junior_ready': 3\n  };\n\n  private readonly DIFFICULTY_MULTIPLIERS: Record<DifficultyBand, number> = {\n    'guided': 0.8,\n    'supported': 1.0,\n    'independent': 1.2,\n    'expert': 1.4\n  };\n\n  async calculateDelta(input: CompetencyDeltaInput): Promise<DeltaResult> {\n    const competency = await storage.getCompetency(input.competencySlug);\n    if (!competency) {\n      throw new Error(`Competency not found: ${input.competencySlug}`);\n    }\n\n    let ledgerEntry = await storage.getUserCompetencyEntry(input.userId, competency.id);\n\n    if (!ledgerEntry) {\n      ledgerEntry = await storage.createCompetencyEntry({\n        userId: input.userId,\n        competencyId: competency.id,\n        currentBand: 'explorer',\n        evidenceCount: 0,\n        confidence: 0,\n        history: []\n      });\n    }\n\n    const previousBand = ledgerEntry.currentBand as MasteryBand;\n    const previousConfidence = ledgerEntry.confidence;\n    const previousEvidenceCount = ledgerEntry.evidenceCount;\n\n    const journey = await storage.getJourney(input.journeyId);\n    const currentArc = journey?.currentArcId \n      ? await storage.getJourneyArc(journey.currentArcId)\n      : null;\n    \n    const difficultyBand = (currentArc?.difficultyBand as DifficultyBand) || 'guided';\n    const difficultyMultiplier = this.DIFFICULTY_MULTIPLIERS[difficultyBand];\n\n    const baseConfidenceGain = input.score \n      ? Math.round((input.score / 100) * 10 * difficultyMultiplier)\n      : Math.round(5 * difficultyMultiplier);\n    \n    let newConfidence = Math.min(100, previousConfidence + baseConfidenceGain);\n    let newBand: MasteryBand = previousBand;\n\n    if (previousBand === 'explorer' && newConfidence >= 40) {\n      newBand = 'contributor';\n      newConfidence = Math.max(0, newConfidence - 40);\n    } else if (previousBand === 'contributor' && newConfidence >= 70) {\n      newBand = 'junior_ready';\n      newConfidence = Math.max(0, newConfidence - 70);\n    }\n\n    const historyEntry = {\n      timestamp: new Date().toISOString(),\n      journeyId: input.journeyId,\n      activityId: input.activityId,\n      source: input.source,\n      evidenceType: input.evidenceType,\n      score: input.score,\n      confidenceGain: baseConfidenceGain,\n      bandBefore: previousBand,\n      bandAfter: newBand\n    };\n\n    const currentHistory = ledgerEntry.history as unknown[];\n    await storage.updateCompetencyEntry(ledgerEntry.id, {\n      currentBand: newBand,\n      confidence: newConfidence,\n      evidenceCount: previousEvidenceCount + 1,\n      lastEvidenceAt: new Date(),\n      history: [...currentHistory, historyEntry]\n    });\n\n    return {\n      competencySlug: input.competencySlug,\n      previousBand,\n      newBand,\n      bandChanged: previousBand !== newBand,\n      previousConfidence,\n      newConfidence,\n      evidenceCount: previousEvidenceCount + 1\n    };\n  }\n\n  async calculateMultipleDeltas(\n    userId: number,\n    journeyId: number,\n    competencySlugs: string[],\n    source: 'workspace' | 'interview',\n    evidenceType: string,\n    score?: number,\n    activityId?: number\n  ): Promise<DeltaResult[]> {\n    const results: DeltaResult[] = [];\n\n    for (const slug of competencySlugs) {\n      try {\n        const result = await this.calculateDelta({\n          userId,\n          journeyId,\n          competencySlug: slug,\n          source,\n          evidenceType,\n          score,\n          activityId\n        });\n        results.push(result);\n      } catch (error) {\n        console.error(`Failed to calculate delta for ${slug}:`, error);\n      }\n    }\n\n    return results;\n  }\n\n  async calculateReadinessScore(userId: number): Promise<ReadinessScore> {\n    return await storage.getUserReadiness(userId);\n  }\n\n  async checkExitEligibility(journeyId: number): Promise<ExitEligibility> {\n    const journey = await storage.getJourney(journeyId);\n    if (!journey) {\n      throw new Error(`Journey not found: ${journeyId}`);\n    }\n\n    const progressionPath = await storage.getProgressionPathById(journey.progressionPathId);\n    if (!progressionPath) {\n      throw new Error(`Progression path not found: ${journey.progressionPathId}`);\n    }\n\n    const requirements = progressionPath.requirements as ProgressionRequirements;\n    const minSprints = requirements.minSprints || 2;\n    const maxSprints = requirements.maxSprints || 8;\n    const readinessThreshold = requirements.readinessThreshold || 85;\n\n    const readiness = await storage.getUserReadiness(journey.userId);\n    const currentReadiness = readiness.overallScore;\n\n    const minSprintsMet = journey.completedSprints >= minSprints;\n    const readinessThresholdMet = currentReadiness >= readinessThreshold;\n    const maxSprintsReached = journey.completedSprints >= maxSprints;\n    const userCanChoose = minSprintsMet;\n\n    const canExit = minSprintsMet && (readinessThresholdMet || maxSprintsReached);\n\n    let recommendation: 'continue' | 'ready' | 'suggest_exit';\n    let message: string;\n\n    if (maxSprintsReached) {\n      recommendation = 'suggest_exit';\n      message = `You've completed ${journey.completedSprints} sprints - time to graduate and showcase your skills!`;\n    } else if (readinessThresholdMet && minSprintsMet) {\n      recommendation = 'ready';\n      message = `Congratulations! You've reached ${currentReadiness}% readiness. You're ready to graduate!`;\n    } else if (minSprintsMet) {\n      recommendation = 'continue';\n      message = `You're at ${currentReadiness}% readiness. Continue to reach ${readinessThreshold}%, or graduate now if you feel ready.`;\n    } else {\n      recommendation = 'continue';\n      message = `Complete ${minSprints - journey.completedSprints} more sprint(s) before graduation becomes available.`;\n    }\n\n    return {\n      canExit,\n      reasons: {\n        minSprintsMet,\n        readinessThresholdMet,\n        maxSprintsReached,\n        userCanChoose\n      },\n      recommendation,\n      message\n    };\n  }\n\n  async completeActivity(\n    journeyId: number,\n    activityId: number,\n    userResponse: unknown,\n    evaluation: { score?: number; feedback?: string; competencies?: string[] }\n  ): Promise<{ activity: SprintActivity; deltas: DeltaResult[] }> {\n    const activity = await storage.getSprintActivity(activityId);\n    if (!activity) {\n      throw new Error(`Activity not found: ${activityId}`);\n    }\n\n    const journey = await storage.getJourney(journeyId);\n    if (!journey) {\n      throw new Error(`Journey not found: ${journeyId}`);\n    }\n\n    const updatedActivity = await storage.updateSprintActivity(activityId, {\n      status: 'completed',\n      userResponse,\n      evaluation,\n      completedAt: new Date()\n    });\n\n    let deltas: DeltaResult[] = [];\n    const competencies = evaluation.competencies || activity.competencyTags || [];\n    \n    if (competencies.length > 0) {\n      deltas = await this.calculateMultipleDeltas(\n        journey.userId,\n        journeyId,\n        competencies,\n        'workspace',\n        activity.activityType,\n        evaluation.score,\n        activityId\n      );\n    }\n\n    await storage.updateJourney(journeyId, { lastActivityAt: new Date() });\n\n    const readiness = await this.calculateReadinessScore(journey.userId);\n    await storage.updateJourney(journeyId, { readinessScore: readiness.overallScore });\n\n    return { activity: updatedActivity!, deltas };\n  }\n\n  async completeSprint(journeyId: number): Promise<SprintCompletionResult> {\n    const journey = await storage.getJourney(journeyId);\n    if (!journey) {\n      throw new Error(`Journey not found: ${journeyId}`);\n    }\n\n    const currentArc = await storage.getCurrentArc(journeyId);\n    if (!currentArc) {\n      throw new Error('No active arc found');\n    }\n\n    const sprint = await storage.getSprintByArc(currentArc.id);\n    if (!sprint) {\n      throw new Error('No sprint found for current arc');\n    }\n\n    await storage.updateJourneyArc(currentArc.id, {\n      status: 'completed',\n      completedAt: new Date()\n    });\n\n    const newCompletedSprints = journey.completedSprints + 1;\n    await storage.updateJourney(journeyId, {\n      completedSprints: newCompletedSprints,\n      currentSprintNumber: journey.currentSprintNumber + 1\n    });\n\n    const readiness = await this.calculateReadinessScore(journey.userId);\n    const snapshot = await storage.createCompetencySnapshot({\n      userId: journey.userId,\n      journeyId,\n      arcId: currentArc.id,\n      sprintId: sprint.id,\n      snapshotType: 'sprint_end',\n      readinessScore: readiness.overallScore,\n      competencyScores: readiness.competencyBreakdown.reduce((acc, c) => {\n        acc[c.slug] = { band: c.band, confidence: c.confidence, score: c.evidenceCount };\n        return acc;\n      }, {} as Record<string, { band: string; confidence: number; score: number }>),\n      strengths: readiness.strengths,\n      gaps: readiness.gaps\n    });\n\n    await storage.updateJourney(journeyId, { readinessScore: readiness.overallScore });\n\n    const exitEligibility = await this.checkExitEligibility(journeyId);\n\n    let nextAction: 'start_new_sprint' | 'proceed_to_graduation' | 'continue_sprint';\n    if (exitEligibility.reasons.maxSprintsReached) {\n      nextAction = 'proceed_to_graduation';\n    } else if (exitEligibility.recommendation === 'ready') {\n      nextAction = 'proceed_to_graduation';\n    } else {\n      nextAction = 'start_new_sprint';\n    }\n\n    return {\n      arc: currentArc,\n      sprint,\n      snapshot,\n      exitEligibility,\n      nextAction\n    };\n  }\n\n  async getDifficultyForSprint(\n    progressionPathId: number,\n    sprintNumber: number\n  ): Promise<DifficultyBand> {\n    const progressionPath = await storage.getProgressionPathById(progressionPathId);\n    if (!progressionPath) {\n      return 'guided';\n    }\n\n    const progression = progressionPath.difficultyProgression as {\n      sprints?: { number: number; band: DifficultyBand }[];\n      default?: DifficultyBand;\n    };\n\n    if (progression.sprints) {\n      const match = progression.sprints.find(s => s.number === sprintNumber);\n      if (match) return match.band;\n\n      const sorted = progression.sprints.sort((a, b) => a.number - b.number);\n      for (let i = sorted.length - 1; i >= 0; i--) {\n        if (sorted[i].number <= sprintNumber) {\n          return sorted[i].band;\n        }\n      }\n    }\n\n    return progression.default || 'guided';\n  }\n\n  async getProgressionSummary(journeyId: number): Promise<{\n    journey: UserJourney;\n    readiness: ReadinessScore;\n    exitEligibility: ExitEligibility;\n    snapshots: CompetencySnapshot[];\n    arcs: JourneyArc[];\n  }> {\n    const journey = await storage.getJourney(journeyId);\n    if (!journey) {\n      throw new Error(`Journey not found: ${journeyId}`);\n    }\n\n    const readiness = await this.calculateReadinessScore(journey.userId);\n    const exitEligibility = await this.checkExitEligibility(journeyId);\n    const snapshots = await storage.getCompetencySnapshots(journeyId);\n    const arcs = await storage.getJourneyArcs(journeyId);\n\n    return {\n      journey,\n      readiness,\n      exitEligibility,\n      snapshots,\n      arcs\n    };\n  }\n\n  async startNewSprint(journeyId: number): Promise<{\n    sprint: Sprint;\n    arc: JourneyArc;\n    generatedBacklog: {\n      tickets: Array<{\n        templateId: string;\n        type: string;\n        day: number;\n        generatedTicket: {\n          title: string;\n          description: string;\n          acceptanceCriteria: string[];\n          difficulty: string;\n        };\n      }>;\n      softSkillEvents: Array<{\n        templateId: string;\n        day: number;\n        trigger: string;\n        generatedScenario: {\n          setup: string;\n          message: string;\n          sender: string;\n          senderRole: string;\n        };\n      }>;\n      theme: { id: string; name: string; description: string };\n    };\n  }> {\n    const { sprintGenerator } = await import(\"./sprint-generator\");\n    \n    const journey = await storage.getJourney(journeyId);\n    if (!journey) {\n      throw new Error(`Journey not found: ${journeyId}`);\n    }\n\n    if (!journey.progressionPathId) {\n      throw new Error(`Journey ${journeyId} has no progression path configured`);\n    }\n\n    const previousSprints = await storage.getSprintsByJourney(journeyId);\n    \n    let readiness;\n    try {\n      readiness = await this.calculateReadinessScore(journey.userId);\n    } catch (error) {\n      console.warn(`Failed to calculate readiness for journey ${journeyId}, using empty gaps:`, error);\n      readiness = { gaps: [] as string[], strengths: [], overallScore: 0, competencyBreakdown: [] };\n    }\n    \n    const newSprintNumber = (journey.currentSprintNumber || 0) + 1;\n    const difficultyBand = await this.getDifficultyForSprint(\n      journey.progressionPathId,\n      newSprintNumber\n    );\n\n    const generatedBacklog = await sprintGenerator.generateSprint({\n      journeyId,\n      sprintNumber: newSprintNumber,\n      difficultyBand,\n      previousSprints: previousSprints as any[],\n      userCompetencyGaps: readiness.gaps,\n      avoidThemes: [],\n      avoidTemplates: []\n    });\n\n    const arcs = await storage.getJourneyArcs(journeyId);\n    const newArcOrder = arcs.length + 1;\n\n    const arc = await storage.createJourneyArc({\n      journeyId,\n      name: `Sprint ${newSprintNumber}`,\n      arcType: 'sprint',\n      arcOrder: newArcOrder,\n      status: 'active',\n      difficultyBand,\n      durationDays: 5,\n      arcData: {\n        theme: generatedBacklog.theme,\n        ceremonies: generatedBacklog.ceremonies\n      }\n    });\n\n    const sprint = await storage.createSprint({\n      arcId: arc.id,\n      sprintNumber: newSprintNumber,\n      goal: `Complete ${generatedBacklog.theme.name} sprint objectives`,\n      theme: generatedBacklog.theme.name,\n      backlog: generatedBacklog.tickets,\n      userTickets: generatedBacklog.tickets.filter((t: any) => t.type === 'bug' || t.type === 'feature'),\n      teamTickets: [],\n      ceremonies: generatedBacklog.ceremonies,\n      generationMetadata: {\n        themeId: generatedBacklog.theme.id,\n        usedTemplateIds: [\n          ...generatedBacklog.tickets.map((t: any) => t.templateId),\n          ...generatedBacklog.softSkillEvents.map((e: any) => e.templateId)\n        ],\n        difficultyBand,\n        generatedAt: new Date().toISOString()\n      }\n    });\n\n    await storage.updateJourney(journeyId, {\n      currentArcId: arc.id,\n      currentSprintNumber: newSprintNumber\n    });\n\n    return {\n      sprint,\n      arc,\n      generatedBacklog\n    };\n  }\n}\n\nexport const progressionEngine = new ProgressionEngine();\n","path":null,"size_bytes":15847,"size_tokens":null},"client/src/hooks/use-progression.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type {\n  ProgressionPath,\n  ProjectTemplate,\n  UserJourney,\n  JourneyArc,\n  Sprint,\n  SprintActivity,\n  CompetencySnapshot,\n  JourneyState,\n  ReadinessScore,\n} from \"@shared/schema\";\n\nexport interface ExitEligibility {\n  canExit: boolean;\n  reasons: {\n    minSprintsMet: boolean;\n    readinessThresholdMet: boolean;\n    maxSprintsReached: boolean;\n    userCanChoose: boolean;\n  };\n  recommendation: 'continue' | 'ready' | 'suggest_exit';\n  message: string;\n}\n\nexport interface JourneyWithState {\n  journey: UserJourney | null;\n  state: JourneyState | null;\n}\n\nexport interface SprintWithActivities {\n  sprint: Sprint | null;\n  activities: SprintActivity[];\n}\n\nexport interface DeltaResult {\n  competencySlug: string;\n  previousBand: string;\n  newBand: string;\n  bandChanged: boolean;\n  previousConfidence: number;\n  newConfidence: number;\n  evidenceCount: number;\n}\n\nexport interface ActivityCompletionResult {\n  activity: SprintActivity;\n  deltas: DeltaResult[];\n}\n\nexport interface SprintCompletionResult {\n  arc: JourneyArc;\n  sprint: Sprint;\n  snapshot: CompetencySnapshot;\n  exitEligibility: ExitEligibility;\n  nextAction: 'start_new_sprint' | 'proceed_to_graduation' | 'continue_sprint';\n}\n\nexport interface ProgressionSummary {\n  journey: UserJourney;\n  readiness: ReadinessScore;\n  exitEligibility: ExitEligibility;\n  snapshots: CompetencySnapshot[];\n  arcs: JourneyArc[];\n}\n\nexport function useProgressionPaths(filters?: { role?: string; entryLevel?: string }) {\n  const queryParams = new URLSearchParams();\n  if (filters?.role) queryParams.set('role', filters.role);\n  if (filters?.entryLevel) queryParams.set('entryLevel', filters.entryLevel);\n  const queryString = queryParams.toString();\n  \n  return useQuery<ProgressionPath[]>({\n    queryKey: ['/api/progression-paths', filters?.role, filters?.entryLevel],\n    queryFn: async () => {\n      const url = queryString ? `/api/progression-paths?${queryString}` : '/api/progression-paths';\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch progression paths');\n      return response.json();\n    }\n  });\n}\n\nexport function useProgressionPath(slug: string | null) {\n  return useQuery<ProgressionPath>({\n    queryKey: ['/api/progression-paths', slug],\n    enabled: !!slug,\n    queryFn: async () => {\n      const response = await fetch(`/api/progression-paths/${slug}`);\n      if (!response.ok) throw new Error('Failed to fetch progression path');\n      return response.json();\n    }\n  });\n}\n\nexport function useProjectTemplates(filters?: { language?: string; industry?: string }) {\n  const queryParams = new URLSearchParams();\n  if (filters?.language) queryParams.set('language', filters.language);\n  if (filters?.industry) queryParams.set('industry', filters.industry);\n  const queryString = queryParams.toString();\n  \n  return useQuery<ProjectTemplate[]>({\n    queryKey: ['/api/project-templates', filters?.language, filters?.industry],\n    queryFn: async () => {\n      const url = queryString ? `/api/project-templates?${queryString}` : '/api/project-templates';\n      const response = await fetch(url);\n      if (!response.ok) throw new Error('Failed to fetch project templates');\n      return response.json();\n    }\n  });\n}\n\nexport function useProjectTemplate(slug: string | null) {\n  return useQuery<ProjectTemplate>({\n    queryKey: ['/api/project-templates', slug],\n    enabled: !!slug,\n    queryFn: async () => {\n      const response = await fetch(`/api/project-templates/${slug}`);\n      if (!response.ok) throw new Error('Failed to fetch project template');\n      return response.json();\n    }\n  });\n}\n\nexport function useUserJourney(userId: number | null) {\n  return useQuery<JourneyWithState>({\n    queryKey: ['/api/user', userId, 'journey'],\n    enabled: !!userId,\n    queryFn: async () => {\n      const response = await fetch(`/api/user/${userId}/journey`);\n      if (!response.ok) throw new Error('Failed to fetch user journey');\n      return response.json();\n    }\n  });\n}\n\nexport function useUserJourneys(userId: number | null) {\n  return useQuery<UserJourney[]>({\n    queryKey: ['/api/user', userId, 'journeys'],\n    enabled: !!userId,\n    queryFn: async () => {\n      const response = await fetch(`/api/user/${userId}/journeys`);\n      if (!response.ok) throw new Error('Failed to fetch user journeys');\n      return response.json();\n    }\n  });\n}\n\nexport function useJourney(journeyId: number | null) {\n  return useQuery<JourneyWithState>({\n    queryKey: ['/api/journey', journeyId],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}`);\n      if (!response.ok) throw new Error('Failed to fetch journey');\n      return response.json();\n    }\n  });\n}\n\nexport function useJourneyArcs(journeyId: number | null) {\n  return useQuery<JourneyArc[]>({\n    queryKey: ['/api/journey', journeyId, 'arcs'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}/arcs`);\n      if (!response.ok) throw new Error('Failed to fetch journey arcs');\n      return response.json();\n    }\n  });\n}\n\nexport function useCurrentSprint(journeyId: number | null) {\n  return useQuery<SprintWithActivities>({\n    queryKey: ['/api/journey', journeyId, 'current-sprint'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}/current-sprint`);\n      if (!response.ok) throw new Error('Failed to fetch current sprint');\n      return response.json();\n    }\n  });\n}\n\nexport function useSprint(sprintId: number | null) {\n  return useQuery<SprintWithActivities>({\n    queryKey: ['/api/sprint', sprintId],\n    enabled: !!sprintId,\n    queryFn: async () => {\n      const response = await fetch(`/api/sprint/${sprintId}`);\n      if (!response.ok) throw new Error('Failed to fetch sprint');\n      return response.json();\n    }\n  });\n}\n\nexport function useSprintActivities(sprintId: number | null, day?: number) {\n  const queryParams = day !== undefined ? `?day=${day}` : '';\n  \n  return useQuery<SprintActivity[]>({\n    queryKey: ['/api/sprint', sprintId, 'activities', day],\n    enabled: !!sprintId,\n    queryFn: async () => {\n      const response = await fetch(`/api/sprint/${sprintId}/activities${queryParams}`);\n      if (!response.ok) throw new Error('Failed to fetch sprint activities');\n      return response.json();\n    }\n  });\n}\n\nexport function useExitEligibility(journeyId: number | null) {\n  return useQuery<ExitEligibility>({\n    queryKey: ['/api/journey', journeyId, 'exit-eligibility'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}/exit-eligibility`);\n      if (!response.ok) throw new Error('Failed to fetch exit eligibility');\n      return response.json();\n    }\n  });\n}\n\nexport function useProgressionSummary(journeyId: number | null) {\n  return useQuery<ProgressionSummary>({\n    queryKey: ['/api/journey', journeyId, 'summary'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}/summary`);\n      if (!response.ok) throw new Error('Failed to fetch progression summary');\n      return response.json();\n    }\n  });\n}\n\nexport function useCompetencySnapshots(journeyId: number | null) {\n  return useQuery<CompetencySnapshot[]>({\n    queryKey: ['/api/journey', journeyId, 'snapshots'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journey/${journeyId}/snapshots`);\n      if (!response.ok) throw new Error('Failed to fetch competency snapshots');\n      return response.json();\n    }\n  });\n}\n\nexport function useUserReadiness(userId: number | null) {\n  return useQuery<ReadinessScore>({\n    queryKey: ['/api/user', userId, 'readiness'],\n    enabled: !!userId,\n    queryFn: async () => {\n      const response = await fetch(`/api/user/${userId}/readiness`);\n      if (!response.ok) throw new Error('Failed to fetch user readiness');\n      return response.json();\n    }\n  });\n}\n\nexport function useStartJourney() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      userId: number;\n      progressionPathSlug: string;\n      projectTemplateSlug: string;\n      jobApplicationId?: number;\n    }) => {\n      const response = await apiRequest(\n        'POST',\n        `/api/user/${data.userId}/journey/start`,\n        {\n          progressionPathSlug: data.progressionPathSlug,\n          projectTemplateSlug: data.projectTemplateSlug,\n          jobApplicationId: data.jobApplicationId\n        }\n      );\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/user', variables.userId, 'journey'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/user', variables.userId, 'journeys'] });\n    }\n  });\n}\n\nexport function useCompleteActivity() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      journeyId: number;\n      activityId: number;\n      userResponse: unknown;\n      evaluation: { score?: number; feedback?: string; competencies?: string[] };\n    }) => {\n      const response = await apiRequest(\n        'POST',\n        `/api/journey/${data.journeyId}/complete-activity`,\n        {\n          activityId: data.activityId,\n          userResponse: data.userResponse,\n          evaluation: data.evaluation\n        }\n      );\n      return response.json() as Promise<ActivityCompletionResult>;\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', variables.journeyId] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', variables.journeyId, 'current-sprint'] });\n    }\n  });\n}\n\nexport function useCompleteSprint() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (journeyId: number) => {\n      const response = await apiRequest(\n        'POST',\n        `/api/journey/${journeyId}/complete-sprint`,\n        {}\n      );\n      return response.json() as Promise<SprintCompletionResult>;\n    },\n    onSuccess: (_, journeyId) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', journeyId] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', journeyId, 'arcs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', journeyId, 'current-sprint'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', journeyId, 'exit-eligibility'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', journeyId, 'snapshots'] });\n    }\n  });\n}\n\nexport function useGraduateJourney() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      journeyId: number;\n      exitTrigger: 'user_choice' | 'readiness_threshold' | 'max_sprints';\n    }) => {\n      const response = await apiRequest(\n        'POST',\n        `/api/journey/${data.journeyId}/graduate`,\n        { exitTrigger: data.exitTrigger }\n      );\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', variables.journeyId] });\n    }\n  });\n}\n\nexport function useUpdateActivity() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      activityId: number;\n      updates: Partial<SprintActivity>;\n      sprintId?: number;\n    }) => {\n      const response = await apiRequest(\n        'PATCH',\n        `/api/activity/${data.activityId}`,\n        data.updates\n      );\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprint', variables.sprintId] });\n        queryClient.invalidateQueries({ queryKey: ['/api/sprint', variables.sprintId, 'activities'] });\n      }\n    }\n  });\n}\n\nexport function useRecordCompetencyDelta() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      userId: number;\n      journeyId: number;\n      competencySlug: string;\n      source: 'workspace' | 'interview';\n      evidenceType: string;\n      score?: number;\n      activityId?: number;\n    }) => {\n      const response = await apiRequest(\n        'POST',\n        `/api/user/${data.userId}/competency-delta`,\n        {\n          journeyId: data.journeyId,\n          competencySlug: data.competencySlug,\n          source: data.source,\n          evidenceType: data.evidenceType,\n          score: data.score,\n          activityId: data.activityId\n        }\n      );\n      return response.json() as Promise<DeltaResult>;\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/user', variables.userId, 'readiness'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/journey', variables.journeyId] });\n    }\n  });\n}\n","path":null,"size_bytes":13066,"size_tokens":null},"docs/NARRATIVE_ARCHITECTURE.md":{"content":"# Narrative Architecture Specification\n\n## Overview\n\nThis document defines how the edmap Workspace Simulator assembles narrative experiences from the catalogue, connecting job postings to project templates and orchestrating the user's journey from hire to junior-ready.\n\n---\n\n## High-Level Journey Structure\n\n```\n\n                        COMPLETE USER JOURNEY                              \n\n                                                                          \n  JOB BOARD                                                               \n                                                                         \n  APPLICATION & INTERVIEW (Interview Simulator)                           \n                                                                         \n  OFFER ACCEPTANCE                                                        \n                                                                         \n   \n                      WORKSPACE SIMULATOR                               \n                                                                         \n     ONBOARDING ARC (Week 1)                                            \n      Day 1: Team intros, documentation                              \n      Day 2-3: Dev environment setup, first ticket                   \n      Day 4-5: Code review feedback, iteration                       \n      1:1 with Manager                                               \n                                                                         \n     SPRINT ARC 1 (Week 2-3)                                            \n      Sprint Planning                                                \n      Daily Standups (5-10)                                          \n      Working the Board (tickets, PRs, reviews)                      \n      Mid-sprint adjustment (optional event)                         \n      Sprint Review                                                  \n      Sprint Retrospective                                           \n      1:1 with Manager                                               \n                                                                         \n     SPRINT ARC 2 (Week 4-5) - Higher complexity                        \n      [Same ceremony structure]                                      \n      + Production incident, cross-team collab                       \n                                                                         \n     SPRINT ARC N... (as needed for progression)                        \n                                                                         \n     OFFBOARDING (End of Final Sprint)                                  \n      Final 1:1 with Manager (evaluates entire journey)              \n                                                                         \n   \n                                                                         \n  JUNIOR READY (Badge + Portfolio)                                        \n                                                                          \n\n```\n\n---\n\n## Data Models\n\n### Arc\n\nThe top-level narrative container. Each journey consists of multiple arcs.\n\n```typescript\ninterface Arc {\n  id: string;\n  type: 'onboarding' | 'sprint';    // Only two arc types\n  order: number;                    // Sequence in journey (1, 2, 3...)\n  name: string;                     // \"Onboarding\", \"Sprint 1\", etc.\n  duration: {\n    days: number;                   // e.g., 5 days for onboarding\n    estimatedHours: number;         // Real user time: ~2-4 hours\n  };\n  difficultyBand: 'guided' | 'supported' | 'independent';\n  projectTemplateId: string;        // Links to project template\n  softSkillHooks: SoftSkillHook[];  // Injected challenges\n  competencyFocus: string[];        // Primary competencies developed\n  days: Day[];\n  isFinalArc: boolean;              // If true, ends with Final 1:1 (offboarding)\n}\n```\n\n> **Note**: There is no separate \"offboarding arc\". Instead, the final sprint ends with a **Final 1:1** that evaluates the entire journey and exits the user from the experience.\n\n### SprintArc (extends Arc)\n\nSprint-specific structure following Scrum ceremonies.\n\n```typescript\ninterface SprintArc extends Arc {\n  type: 'sprint';\n  sprintNumber: number;\n  sprintGoal: string;               // One-sentence objective\n  backlogItems: BacklogItem[];      // Selected work for this sprint\n  ceremonies: {\n    planning: SprintPlanningCeremony;\n    standups: StandupCeremony[];\n    review: SprintReviewCeremony;\n    retrospective: RetrospectiveCeremony;\n    managerOneOnOne: OneOnOneCeremony;\n  };\n  midSprintEvents: MidSprintEvent[]; // Optional disruptions/adjustments\n  storyPointsTarget: number;         // Increases with progression\n}\n```\n\n### Day\n\nA single simulation day within an arc.\n\n```typescript\ninterface Day {\n  dayNumber: number;                // Day within the arc\n  theme: string;                    // \"First Ticket\", \"Code Review Day\"\n  activities: Activity[];\n  softSkillTriggers: SoftSkillTrigger[];  // Events that might fire\n  requiredForProgression: string[]; // Must complete to advance\n}\n```\n\n### Activity\n\nA single interactive unit within a day.\n\n```typescript\ninterface Activity {\n  id: string;\n  type: ActivityType;\n  name: string;\n  description: string;\n  ceremonyType?: CeremonyType;      // If part of a Scrum ceremony\n  \n  // Content sources\n  scriptedAssets: CatalogueReference[];  // Pre-authored content\n  aiOrchestration: AIOrchestrationConfig;\n  \n  // Progression\n  competencyTags: string[];         // Skills practiced\n  estimatedMinutes: number;\n  isRequired: boolean;\n  \n  // Branching\n  branchingRules?: BranchingRule[]; // Conditional paths\n  \n  // Outputs\n  producesArtifact?: ArtifactType;  // PR, document, etc.\n}\n\ntype ActivityType = \n  | 'team_chat'\n  | 'documentation_reading'\n  | 'standup_meeting'\n  | 'sprint_planning'\n  | 'ticket_work'\n  | 'code_exercise'\n  | 'code_review'\n  | 'pr_creation'\n  | 'demo_presentation'\n  | 'retrospective'\n  | 'one_on_one'\n  | 'incident_response'\n  | 'reflection';\n\ntype CeremonyType =\n  | 'sprint_planning'\n  | 'daily_standup'\n  | 'sprint_review'\n  | 'sprint_retrospective'\n  | 'manager_1_1';\n```\n\n---\n\n## Job Posting  Project Template Connection\n\n### Extended Job Posting Model\n\n```typescript\ninterface JobPostingNarrativeProfile {\n  // Existing fields from jobPostings table...\n  \n  // New narrative fields\n  projectTemplateId: string;        // Which project template to use\n  narrativeContext: {\n    industry: string;               // 'fintech', 'social', 'ecommerce', 'healthcare'\n    domain: string;                 // 'payments', 'messaging', 'inventory'\n    teamTopology: string;           // 'startup', 'enterprise', 'agency'\n    sprintCadence: number;          // 1 or 2 week sprints\n    techStack: string[];            // ['react', 'node', 'postgres']\n  };\n  journeyLength: {\n    minSprints: number;             // Minimum sprints to complete\n    maxSprints: number;             // Maximum before forced graduation\n  };\n}\n```\n\n### Project Template\n\nDefines the simulated company/project environment.\n\n```typescript\ninterface ProjectTemplate {\n  id: string;\n  name: string;                     // \"NovaPay\", \"ChatFlow\", \"ShopStack\"\n  description: string;\n  \n  // Team Configuration\n  team: {\n    members: TeamMemberTemplate[];\n    dynamicRoles: string[];         // AI can generate additional team members\n  };\n  \n  // Codebase Configuration\n  codebase: {\n    structure: CodebaseStructure;\n    keyFiles: FileTemplate[];\n    bugPatterns: BugPattern[];      // Types of bugs that can occur\n    testingFramework: string;\n  };\n  \n  // Backlog Configuration\n  backlog: {\n    themes: BacklogTheme[];         // Feature areas\n    bugTemplates: BugTemplate[];\n    featureTemplates: FeatureTemplate[];\n    incidentTemplates: IncidentTemplate[];\n  };\n  \n  // Soft Skill Scenarios\n  softSkillPacks: {\n    conflicts: ConflictScenario[];\n    feedbackSituations: FeedbackScenario[];\n    deadlinePressure: PressureScenario[];\n    ambiguousRequirements: AmbiguityScenario[];\n  };\n  \n  // Documentation\n  documentation: {\n    productDocs: DocumentTemplate[];\n    teamDocs: DocumentTemplate[];\n    technicalDocs: DocumentTemplate[];\n  };\n  \n  // Catalogue References\n  catalogueAssets: {\n    onboarding: string[];           // Catalogue IDs for onboarding content\n    sprints: string[];              // Catalogue IDs for sprint content\n    ceremonies: string[];           // Catalogue IDs for ceremony scripts\n  };\n}\n```\n\n### Example Project Templates\n\n| Template | Industry | Domain | Suitable For |\n|----------|----------|--------|--------------|\n| NovaPay | Fintech | Payments | Developer, QA |\n| ChatFlow | Social | Messaging | Developer, DevOps |\n| ShopStack | E-commerce | Inventory | Developer, PM |\n| HealthTrack | Healthcare | Patient Records | Developer, QA |\n| DataPulse | Analytics | Dashboards | Data Science, Developer |\n\n---\n\n## Sprint Ceremony Details\n\n### 1. Sprint Planning\n\n```typescript\ninterface SprintPlanningCeremony {\n  duration: '30-60 minutes';        // Simulated as ~10-15 min real time\n  \n  phases: {\n    backlogReview: {\n      // PM presents prioritized backlog\n      scriptedContent: 'backlog_presentation_script';\n      userInteraction: 'ask_questions' | 'raise_concerns';\n    };\n    \n    taskSelection: {\n      // Team discusses and selects items\n      availableItems: BacklogItem[];\n      userRole: 'participant' | 'selector';\n      aiDiscussion: true;           // AI team members debate priorities\n    };\n    \n    taskBreakdown: {\n      // Break selected items into subtasks\n      selectedItem: BacklogItem;\n      userCreatesSubtasks: boolean;\n      aiSuggestions: boolean;\n    };\n    \n    commitment: {\n      // Team commits to sprint goal\n      sprintGoalOptions: string[];\n      userVotes: boolean;\n    };\n  };\n  \n  outputs: {\n    sprintGoal: string;\n    sprintBacklog: BacklogItem[];\n    userAssignedTickets: Ticket[];\n  };\n  \n  competencies: ['planning', 'estimation', 'communication'];\n}\n```\n\n### 2. Daily Standup\n\n```typescript\ninterface StandupCeremony {\n  duration: '5-10 minutes';\n  dayInSprint: number;\n  \n  format: {\n    // Each team member shares (AI-generated based on sprint progress)\n    teamUpdates: StandupUpdate[];\n    \n    // User shares their update\n    userUpdate: {\n      promptFor: ['yesterday', 'today', 'blockers'];\n      evaluateQuality: boolean;     // AI assesses update quality\n    };\n    \n    // Optional follow-up discussion\n    discussion?: {\n      topic: string;\n      aiInitiated: boolean;\n    };\n  };\n  \n  // Soft skill injection points\n  softSkillTriggers: {\n    blockerEscalation?: BlockerScenario;\n    scopeCreep?: ScopeCreepScenario;\n    conflictSurface?: ConflictScenario;\n  };\n  \n  competencies: ['communication', 'status_reporting', 'blocker_identification'];\n}\n```\n\n### 3. Working the Sprint Board\n\n```typescript\ninterface SprintBoardWork {\n  // This is the main \"work\" phase between ceremonies\n  \n  ticketFlow: {\n    columns: ['to_do', 'in_progress', 'review', 'qa', 'done'];\n    userTickets: Ticket[];\n    \n    // Each ticket has activities\n    ticketActivities: {\n      understand: 'read_requirements' | 'ask_questions';\n      implement: 'code_exercise' | 'configuration';\n      test: 'write_tests' | 'manual_testing';\n      submit: 'create_pr' | 'request_review';\n      iterate: 'address_feedback' | 'fix_bugs';\n    };\n  };\n  \n  collaboration: {\n    codeReviews: {\n      receive: CodeReviewFeedback[];  // AI reviews user's code\n      give: CodeReviewTask[];         // User reviews AI's code\n    };\n    \n    pairProgramming?: {\n      partner: TeamMember;\n      scenario: PairingScenario;\n    };\n    \n    qaHandoff: {\n      writeTestCases: boolean;\n      respondToBugs: BugReport[];\n    };\n  };\n  \n  // Mid-sprint events (randomly triggered)\n  possibleEvents: {\n    productionIncident: IncidentScenario;\n    requirementChange: ChangeScenario;\n    teamMemberOutage: CoverageScenario;\n    urgentBugfix: HotfixScenario;\n  };\n}\n```\n\n### 4. Sprint Review\n\n```typescript\ninterface SprintReviewCeremony {\n  duration: '15-20 minutes';\n  \n  phases: {\n    demo: {\n      // User presents completed work\n      userDemos: CompletedTicket[];\n      audienceQuestions: ReviewQuestion[];  // AI stakeholders ask questions\n      feedbackReceived: ReviewFeedback[];\n    };\n    \n    teamDemos: {\n      // AI team members present their work\n      presentations: TeamPresentation[];\n      userCanAsk: boolean;\n    };\n    \n    backlogAdjustment: {\n      // PM adjusts priorities based on feedback\n      priorityChanges: PriorityChange[];\n      userInput: 'suggest' | 'observe';\n    };\n  };\n  \n  competencies: ['presentation', 'demo_skills', 'stakeholder_communication'];\n}\n```\n\n### 5. Sprint Retrospective\n\n```typescript\ninterface RetrospectiveCeremony {\n  duration: '15-20 minutes';\n  \n  format: {\n    whatWentWell: {\n      teamInputs: RetroItem[];      // AI team shares\n      userContributes: boolean;\n    };\n    \n    whatDidntGoWell: {\n      teamInputs: RetroItem[];\n      userContributes: boolean;\n      // Soft skill: handling criticism, giving constructive feedback\n    };\n    \n    improvements: {\n      suggestions: ImprovementSuggestion[];\n      voting: boolean;\n      actionItems: ActionItem[];    // 1-2 items for next sprint\n    };\n  };\n  \n  // The retro can surface competency gaps\n  competencyReflection: {\n    aiObservations: CompetencyObservation[];\n    userSelfAssessment: boolean;\n  };\n  \n  competencies: ['self_reflection', 'feedback', 'continuous_improvement'];\n}\n```\n\n### 6. Manager 1:1\n\n```typescript\ninterface OneOnOneCeremony {\n  duration: '10-15 minutes';\n  frequency: 'after_each_sprint';\n  isFinal: boolean;                 // True for the last sprint's 1:1\n  \n  topics: {\n    sprintPerformance: {\n      // Manager discusses user's sprint contributions\n      positives: string[];\n      areasToImprove: string[];\n      specificExamples: Example[];\n    };\n    \n    careerDevelopment: {\n      // Tied to competency framework\n      competencyProgress: CompetencyUpdate[];\n      nextFocusAreas: string[];\n    };\n    \n    userAgenda: {\n      // User can bring topics\n      promptForTopics: boolean;\n      aiRespondsTo: UserTopic[];\n    };\n    \n    goalSetting: {\n      // Set goals for next sprint (not included in final 1:1)\n      previousGoals: Goal[];\n      newGoals: Goal[];\n    };\n  };\n  \n  competencies: ['receiving_feedback', 'goal_setting', 'self_advocacy'];\n}\n```\n\n### 7. Final 1:1 (Offboarding)\n\nThe final 1:1 replaces the regular sprint 1:1 at the end of the last sprint. It evaluates the **entire journey**, not just the last sprint.\n\n```typescript\ninterface FinalOneOnOneCeremony extends OneOnOneCeremony {\n  isFinal: true;\n  duration: '20-30 minutes';        // Longer than regular 1:1s\n  \n  journeyReview: {\n    // Comprehensive review of entire experience\n    overallPerformance: {\n      strengths: string[];          // Key strengths demonstrated\n      growthAreas: string[];        // Areas of improvement shown\n      keyMoments: JourneyMoment[];  // Memorable achievements/challenges\n    };\n    \n    competencyAssessment: {\n      // Final competency scores\n      competencies: CompetencyScore[];\n      overallBand: 'explorer' | 'contributor' | 'junior_ready';\n      readinessScore: number;       // 0-100\n    };\n    \n    portfolioHighlights: {\n      // Artifacts collected during journey\n      bestPRs: PortfolioArtifact[];\n      codeReviewsGiven: PortfolioArtifact[];\n      documentationWritten: PortfolioArtifact[];\n      challengesOvercome: string[];\n    };\n    \n    managerFinalWords: {\n      // Personalized closing message\n      congratulations: string;\n      adviceForFuture: string[];\n      recommendationLetter?: string; // If junior_ready achieved\n    };\n  };\n  \n  exitExperience: {\n    // User exits the workspace after this\n    showBadge: boolean;             // Junior Ready badge if earned\n    showPortfolio: boolean;         // Link to compiled portfolio\n    returnToJobBoard: boolean;      // Option to start new journey\n  };\n  \n  competencies: ['receiving_feedback', 'self_reflection', 'professional_growth'];\n}\n```\n\n**Final 1:1 Flow:**\n\n```\n\n                     FINAL 1:1 WITH MANAGER                   \n\n                                                              \n  1. JOURNEY REVIEW                                           \n     \"Let's look back at your time here...\"                   \n     - Highlights from each sprint                            \n     - Key accomplishments                                    \n     - Challenges overcome                                    \n                                                              \n  2. COMPETENCY ASSESSMENT                                    \n     \"Here's where you stand on each skill...\"                \n     - Visual breakdown of competencies                       \n     - Comparison to Junior Ready threshold                   \n     - Specific examples of growth                            \n                                                              \n  3. PORTFOLIO COMPILATION                                    \n     \"You've built an impressive body of work...\"             \n     - Best PRs and code samples                              \n     - Documentation contributions                            \n     - Code reviews given                                     \n                                                              \n  4. CLOSING & BADGE                                          \n     \"Congratulations! You've earned...\"                      \n     - Junior Ready badge (if earned)                         \n     - Manager's advice for the future                        \n     - Exit to portfolio view                                 \n                                                              \n\n```\n\n---\n\n## Exit Triggers & Progression Paths\n\n### When Does the Journey End?\n\nThe Final 1:1 is triggered by **either**:\n\n| Trigger | Description |\n|---------|-------------|\n| **User Choice** | User decides they're ready to exit (clicks \"Complete Journey\") |\n| **System Determination** | System detects user has reached target readiness level |\n\n```typescript\ninterface ExitTrigger {\n  type: 'user_initiated' | 'system_determined';\n  \n  userInitiated?: {\n    // User clicks \"I'm ready to graduate\"\n    minimumSprints: number;         // Must complete at least N sprints\n    confirmationRequired: boolean;  // \"Are you sure?\" dialog\n  };\n  \n  systemDetermined?: {\n    // System detects readiness threshold reached\n    readinessThreshold: number;     // e.g., 85 for Junior Ready\n    competencyMinimums: {           // Must meet minimums in key areas\n      [competencySlug: string]: number;\n    };\n    sustainedPerformance: number;   // Must maintain level for N sprints\n  };\n}\n```\n\n### Progression Paths (Extensible)\n\nThe Intern  Junior path is just the first use case. The same architecture supports:\n\n```\n\n                      PROGRESSION PATHS                                   \n\n                                                                          \n  PATH 1: Intern  Junior Ready (Current Focus)                          \n   Entry: New graduate, bootcamp student, career changer              \n   Focus: Foundational habits, core delivery skills                   \n   Duration: 2-4 sprints                                              \n   Exit Badge: \"Junior Ready\"                                         \n                                                                          \n  PATH 2: Junior  Mid-Level (Future)                                    \n   Entry: 1-2 years experience, Junior Ready badge holders            \n   Focus: Technical leadership, mentoring, system design              \n   Duration: 4-6 sprints                                              \n   Exit Badge: \"Mid-Level Professional\"                               \n                                                                          \n  PATH 3: Mid  Senior (Future)                                          \n   Entry: 3-5 years experience, Mid-Level badge holders               \n   Focus: Architecture, cross-team influence, strategic thinking      \n   Duration: 6-8 sprints                                              \n   Exit Badge: \"Senior Professional\"                                  \n                                                                          \n\n```\n\n### Progression Path Configuration\n\n```typescript\ninterface ProgressionPath {\n  id: string;\n  name: string;                     // \"Intern to Junior Ready\"\n  \n  entryLevel: Level;                // 'intern' | 'junior' | 'mid' | 'senior'\n  exitLevel: Level;                 // Target level to achieve\n  \n  requirements: {\n    entry: {\n      previousBadge?: string;       // Required badge to start (null for intern)\n      minimumExperience?: string;   // \"1-2 years\" (for display only)\n    };\n    exit: {\n      readinessScore: number;       // Threshold to complete path\n      requiredCompetencies: string[]; // Must demonstrate these\n      minimumSprints: number;       // Can't exit before this\n      maximumSprints: number;       // Forced graduation after this\n    };\n  };\n  \n  competencyFocus: {\n    // Different paths emphasize different competencies\n    primary: string[];              // Main focus areas\n    secondary: string[];            // Also tracked but less weight\n  };\n  \n  difficultyProgression: {\n    // How difficulty scales through the path\n    startingBand: 'guided' | 'supported' | 'independent';\n    endingBand: 'guided' | 'supported' | 'independent';\n    escalationRate: 'gradual' | 'steep';\n  };\n  \n  exitBadge: {\n    name: string;                   // \"Junior Ready\"\n    description: string;\n    icon: string;\n  };\n}\n```\n\n### Example: Two Progression Paths\n\n**Path 1: Intern  Junior Ready**\n```json\n{\n  \"id\": \"intern-to-junior\",\n  \"name\": \"Intern to Junior Ready\",\n  \"entryLevel\": \"intern\",\n  \"exitLevel\": \"junior\",\n  \"requirements\": {\n    \"entry\": {\n      \"previousBadge\": null\n    },\n    \"exit\": {\n      \"readinessScore\": 85,\n      \"requiredCompetencies\": [\"debugging\", \"git_workflow\", \"code_review\", \"communication\"],\n      \"minimumSprints\": 2,\n      \"maximumSprints\": 6\n    }\n  },\n  \"competencyFocus\": {\n    \"primary\": [\"debugging\", \"git_workflow\", \"testing\", \"code_review\"],\n    \"secondary\": [\"documentation\", \"estimation\", \"collaboration\"]\n  },\n  \"difficultyProgression\": {\n    \"startingBand\": \"guided\",\n    \"endingBand\": \"supported\",\n    \"escalationRate\": \"gradual\"\n  },\n  \"exitBadge\": {\n    \"name\": \"Junior Ready\",\n    \"description\": \"Demonstrated readiness for a junior developer role\",\n    \"icon\": \"badge-junior-ready\"\n  }\n}\n```\n\n**Path 2: Junior  Mid-Level (Future)**\n```json\n{\n  \"id\": \"junior-to-mid\",\n  \"name\": \"Junior to Mid-Level Professional\",\n  \"entryLevel\": \"junior\",\n  \"exitLevel\": \"mid\",\n  \"requirements\": {\n    \"entry\": {\n      \"previousBadge\": \"Junior Ready\"\n    },\n    \"exit\": {\n      \"readinessScore\": 90,\n      \"requiredCompetencies\": [\"system_design\", \"mentoring\", \"technical_leadership\", \"cross_team_collab\"],\n      \"minimumSprints\": 4,\n      \"maximumSprints\": 10\n    }\n  },\n  \"competencyFocus\": {\n    \"primary\": [\"system_design\", \"technical_leadership\", \"mentoring\", \"architecture\"],\n    \"secondary\": [\"stakeholder_management\", \"estimation\", \"risk_assessment\"]\n  },\n  \"difficultyProgression\": {\n    \"startingBand\": \"supported\",\n    \"endingBand\": \"independent\",\n    \"escalationRate\": \"steep\"\n  },\n  \"exitBadge\": {\n    \"name\": \"Mid-Level Professional\",\n    \"description\": \"Demonstrated readiness for mid-level technical roles\",\n    \"icon\": \"badge-mid-level\"\n  }\n}\n```\n\n### Exit Flow Decision Tree\n\n```\n\n              END OF SPRINT CHECK                             \n\n                                                              \n  After Sprint Retrospective...                               \n                                                              \n     \n   Has user completed minimum sprints?                      \n     \n                                                             \n      NO  YES                                      \n                                                            \n                                                            \n  Continue to        \n  next sprint     Check exit conditions:                   \n                                                            \n                  A) User clicked \"Complete Journey\"?       \n                      Trigger Final 1:1                    \n                                                            \n                  B) Readiness score >= threshold?          \n                      System suggests Final 1:1            \n                      User can accept or continue          \n                                                            \n                  C) Reached maximum sprints?               \n                      Force Final 1:1 (graduation)         \n                                                            \n                  D) None of above?                         \n                      Continue to next sprint              \n                     \n                                                              \n\n```\n\n### System-Suggested Graduation\n\nWhen the system determines the user is ready:\n\n```typescript\ninterface GraduationSuggestion {\n  trigger: 'readiness_threshold_met';\n  \n  notification: {\n    title: \"You're Ready!\";\n    message: \"Based on your performance, you've reached Junior Ready status.\";\n    readinessScore: number;\n    competencyHighlights: string[];\n  };\n  \n  options: {\n    accept: {\n      label: \"Graduate Now\";\n      action: 'trigger_final_1_1';\n    };\n    defer: {\n      label: \"Continue Practicing\";\n      action: 'continue_to_next_sprint';\n      note: \"You can graduate after any future sprint\";\n    };\n  };\n}\n```\n\n---\n\n## Soft Skill Integration\n\nSoft skill challenges are woven throughout the narrative, not isolated.\n\n### Soft Skill Hook Points\n\n| Ceremony | Possible Soft Skill Scenarios |\n|----------|-------------------------------|\n| Standup | Peer disagrees with your approach, unclear requirements surface |\n| Sprint Planning | Overcommitment pressure, scope negotiation |\n| Code Review | Receiving harsh feedback, defending technical decisions |\n| Mid-Sprint | Deadline pressure, priority conflict, team member conflict |\n| Sprint Review | Stakeholder pushback, demo failure |\n| Retrospective | Giving constructive criticism, accepting blame |\n| 1:1 | Receiving negative feedback, salary discussion, career concerns |\n\n### Soft Skill Scenario Structure\n\n```typescript\ninterface SoftSkillScenario {\n  id: string;\n  type: 'conflict' | 'pressure' | 'feedback' | 'ambiguity' | 'failure';\n  \n  trigger: {\n    probability: number;            // 0-1, chance of occurring\n    conditions: TriggerCondition[]; // When can this fire\n  };\n  \n  scenario: {\n    setup: string;                  // Narrative context\n    characters: TeamMember[];\n    initialMessage: string;         // AI delivers this\n  };\n  \n  userResponseOptions: {\n    freeform: boolean;              // User types response\n    guidedChoices?: string[];       // Optional prompts\n  };\n  \n  evaluation: {\n    competencies: string[];\n    rubric: EvaluationRubric;\n  };\n  \n  outcomes: {\n    positive: OutcomeScript;        // If handled well\n    neutral: OutcomeScript;         // If handled okay\n    negative: OutcomeScript;        // If handled poorly\n  };\n}\n```\n\n---\n\n## Difficulty Progression\n\nAs users progress through sprints, difficulty increases:\n\n| Aspect | Sprint 1 | Sprint 2 | Sprint 3+ |\n|--------|----------|----------|-----------|\n| **Ticket Complexity** | Simple bugs, single file | Multi-file features | System-wide changes |\n| **Scaffolding** | Step-by-step guidance | Hints on request | Minimal guidance |\n| **Story Points** | 3-5 points | 8-13 points | 13-21 points |\n| **Soft Skills** | Friendly feedback | Constructive criticism | Conflict situations |\n| **Ambiguity** | Clear requirements | Some ambiguity | Significant ambiguity |\n| **Time Pressure** | Relaxed | Moderate | Realistic deadlines |\n| **Team Dynamics** | Supportive | Mixed | Challenging personalities |\n\n---\n\n## Content Assembly Flow\n\n```\nUser accepts job at \"AtlasPay (Fintech)\"\n           \nLookup: jobPosting.projectTemplateId = \"novapay-template\"\n           \nLoad ProjectTemplate \"novapay-template\"\n           \n\n  ASSEMBLE ONBOARDING ARC (Mostly Scripted)                   \n                                                              \n  1. Team Members: Load from template.team                    \n  2. Documentation: Load from template.documentation          \n  3. First Ticket: Select from template.backlog.bugTemplates  \n  4. Day Scripts: Load from catalogue (onboarding assets)     \n  5. Soft Skills: Select 1-2 from template.softSkillPacks     \n                                                              \n\n           \nUser completes Onboarding\n           \n\n  DYNAMICALLY GENERATE SPRINT N                               \n                                                              \n   See \"Dynamic Sprint Generation\" section below             \n                                                              \n\n           \nRepeat until Exit Trigger fires\n```\n\n---\n\n## Dynamic Sprint Generation\n\nAfter onboarding, **each sprint is dynamically generated** to ensure variety and prevent repetition. The system combines:\n- **Seed content** from the catalogue (problem templates, scenario structures)\n- **AI generation** for variations, dialogue, and contextual details\n- **Progression rules** to ensure appropriate difficulty\n\n### Why Dynamic Generation?\n\n| Approach | Pros | Cons |\n|----------|------|------|\n| **Fully Scripted** | Consistent, predictable | Repetitive on replay, limited replayability |\n| **Fully AI-Generated** | Infinite variety | Inconsistent quality, may break narrative |\n| **Hybrid (Our Approach)** | Variety + consistency | More complex to build |\n\n### Sprint Generation Pipeline\n\n```\n\n                    SPRINT GENERATION PIPELINE                            \n\n                                                                          \n  INPUTS:                                                                 \n   Project Template (team, codebase, themes)                          \n   User Progress (completed sprints, competency scores, gaps)         \n   Sprint Number (determines difficulty band)                         \n   Previous Sprint State (what happened, what to avoid repeating)     \n                                                                          \n                                                                         \n                                                                          \n  STEP 1: SELECT SPRINT THEME                                            \n     \n    Choose theme not used in recent sprints:                            \n     \"Payment Processing Reliability\"                                  \n     \"Fraud Detection Features\"                                        \n     \"Performance Optimization\"                                        \n     \"Customer Dashboard Improvements\"                                 \n     \n                                                                         \n                                                                          \n  STEP 2: GENERATE BACKLOG                                               \n     \n    AI generates 5-8 tickets based on:                                  \n     Theme selected                                                    \n     Difficulty band for this sprint                                   \n     Problem templates from catalogue                                  \n     User's competency gaps (prioritize weak areas)                    \n     \n                                                                         \n                                                                          \n  STEP 3: SELECT USER TICKETS                                            \n     \n    Assign 1-3 tickets to user:                                         \n     At least one technical (bug, feature)                             \n     Optionally one soft-skill heavy (ambiguous requirements)          \n     Complexity matches difficulty band                                \n     \n                                                                         \n                                                                          \n  STEP 4: GENERATE SOFT SKILL EVENTS                                     \n     \n    Roll for 2-4 events, avoiding recent repeats:                       \n     Code review conflict                                              \n     Requirement change mid-sprint                                     \n     Peer disagreement in standup                                      \n     Production incident (urgent interrupt)                            \n     Scope creep pressure from PM                                      \n     \n                                                                         \n                                                                          \n  STEP 5: SCHEDULE EVENTS ACROSS DAYS                                    \n     \n    Place events throughout the sprint:                                 \n     Day 1: Sprint Planning                                            \n     Day 2-3: Work begins, optional early conflict                     \n     Day 4-5: Mid-sprint event (incident, requirement change)          \n     Day 6-7: Push to complete, possible deadline pressure             \n     Day 8: Sprint Review                                              \n     Day 9: Retrospective + 1:1                                        \n     \n                                                                         \n                                                                          \n  OUTPUT: Complete Sprint Definition                                      \n   Sprint Goal                                                        \n   Backlog (with generated tickets)                                   \n   User's assigned tickets (with generated code/bugs)                 \n   Scheduled soft skill events                                        \n   Ceremony prompts (for AI team members)                             \n                                                                          \n\n```\n\n### Dynamic Ticket Generation\n\n```typescript\ninterface TicketGenerator {\n  // Inputs\n  inputs: {\n    projectTemplate: ProjectTemplate;\n    sprintTheme: string;\n    difficultyBand: 'guided' | 'supported' | 'independent';\n    userCompetencyGaps: string[];\n    previousTickets: Ticket[];       // Avoid repetition\n  };\n  \n  // Generation process\n  generate(): GeneratedTicket {\n    // 1. Select problem template from catalogue\n    const template = selectProblemTemplate({\n      type: this.inputs.difficultyBand === 'guided' ? 'bug' : 'feature',\n      competencies: this.inputs.userCompetencyGaps,\n      notIn: this.inputs.previousTickets.map(t => t.templateId)\n    });\n    \n    // 2. AI generates variations\n    const ticket = aiGenerate({\n      prompt: `Generate a ${template.type} ticket for a ${this.inputs.sprintTheme} sprint.\n               Base it on this template: ${template.description}\n               Make it appropriate for ${this.inputs.difficultyBand} difficulty.\n               The codebase is: ${this.inputs.projectTemplate.codebase.description}`,\n      schema: TicketSchema\n    });\n    \n    // 3. Generate the actual code/bug\n    const codeArtifact = generateCodeArtifact({\n      ticket,\n      codebaseStructure: this.inputs.projectTemplate.codebase,\n      bugPattern: template.bugPattern\n    });\n    \n    return { ticket, codeArtifact };\n  };\n}\n\ninterface GeneratedTicket {\n  id: string;\n  title: string;                    // AI-generated, contextual\n  description: string;              // AI-generated, detailed\n  acceptanceCriteria: string[];     // AI-generated\n  storyPoints: number;              // Based on difficulty band\n  type: 'bug' | 'feature' | 'chore';\n  \n  // The actual technical content\n  codeArtifact: {\n    affectedFiles: string[];\n    buggyCode?: string;             // For bugs: the broken code\n    expectedFix?: string;           // For evaluation\n    testCases?: TestCase[];\n  };\n  \n  // Metadata\n  competencies: string[];           // What this ticket practices\n  templateId: string;               // Which catalogue template it's based on\n}\n```\n\n### Problem Template Examples (Catalogue)\n\nThe catalogue contains **problem templates** that the AI uses as seeds:\n\n```json\n{\n  \"templates\": [\n    {\n      \"id\": \"bug-timezone-formatting\",\n      \"type\": \"bug\",\n      \"category\": \"date-handling\",\n      \"difficulty\": [\"guided\", \"supported\"],\n      \"description\": \"Date displays incorrectly across timezones\",\n      \"bugPattern\": \"Uses local timezone instead of UTC for display\",\n      \"affectedArea\": \"date formatting utilities\",\n      \"competencies\": [\"debugging\", \"testing\"],\n      \"variations\": [\n        \"Payment timestamps show wrong time\",\n        \"Transaction dates off by hours\",\n        \"Scheduled payments trigger at wrong time\"\n      ]\n    },\n    {\n      \"id\": \"bug-race-condition\",\n      \"type\": \"bug\",\n      \"category\": \"concurrency\",\n      \"difficulty\": [\"supported\", \"independent\"],\n      \"description\": \"Data inconsistency under concurrent updates\",\n      \"bugPattern\": \"Missing locks or transactions on shared resource\",\n      \"affectedArea\": \"database operations\",\n      \"competencies\": [\"debugging\", \"system-design\"],\n      \"variations\": [\n        \"Double-charge on rapid button clicks\",\n        \"Balance mismatch after concurrent transfers\",\n        \"Inventory count goes negative\"\n      ]\n    },\n    {\n      \"id\": \"feature-validation\",\n      \"type\": \"feature\",\n      \"category\": \"input-handling\",\n      \"difficulty\": [\"guided\", \"supported\"],\n      \"description\": \"Add input validation to a form\",\n      \"featurePattern\": \"Validate user input with appropriate error messages\",\n      \"affectedArea\": \"form components\",\n      \"competencies\": [\"code-quality\", \"testing\"],\n      \"variations\": [\n        \"Credit card number validation\",\n        \"Email format validation\",\n        \"Password strength requirements\"\n      ]\n    },\n    {\n      \"id\": \"feature-error-handling\",\n      \"type\": \"feature\",\n      \"category\": \"resilience\",\n      \"difficulty\": [\"supported\", \"independent\"],\n      \"description\": \"Improve error handling for API failures\",\n      \"featurePattern\": \"Add retry logic, fallbacks, and user feedback\",\n      \"affectedArea\": \"API client layer\",\n      \"competencies\": [\"debugging\", \"system-design\", \"code-quality\"],\n      \"variations\": [\n        \"Payment gateway timeout handling\",\n        \"Third-party API rate limiting\",\n        \"Graceful degradation when service unavailable\"\n      ]\n    }\n  ]\n}\n```\n\n### Soft Skill Event Generation\n\n```typescript\ninterface SoftSkillEventGenerator {\n  inputs: {\n    sprintNumber: number;\n    userCompetencyGaps: string[];    // Include soft skills\n    previousEvents: SoftSkillEvent[];\n    teamDynamics: TeamMember[];\n  };\n  \n  generate(): SoftSkillEvent[] {\n    const events: SoftSkillEvent[] = [];\n    \n    // Determine how many events based on sprint number\n    const eventCount = Math.min(2 + Math.floor(sprintNumber / 2), 4);\n    \n    // Select event types, avoiding recent repeats\n    const availableTypes = [\n      'code_review_conflict',\n      'requirement_change',\n      'peer_disagreement',\n      'production_incident',\n      'scope_creep',\n      'deadline_pressure',\n      'unclear_feedback',\n      'team_member_absence'\n    ].filter(type => !recentlyUsed(type, this.inputs.previousEvents));\n    \n    // Prioritize events that practice user's weak competencies\n    const prioritized = prioritizeByCompetencyGaps(\n      availableTypes, \n      this.inputs.userCompetencyGaps\n    );\n    \n    // Generate each event with AI\n    for (let i = 0; i < eventCount; i++) {\n      const eventType = prioritized[i];\n      const event = aiGenerate({\n        prompt: `Generate a \"${eventType}\" scenario for sprint ${sprintNumber}.\n                 Team members: ${this.inputs.teamDynamics.map(m => m.name).join(', ')}\n                 Make it realistic and challenging but fair.`,\n        schema: SoftSkillEventSchema\n      });\n      events.push(event);\n    }\n    \n    return events;\n  };\n}\n\ninterface SoftSkillEvent {\n  id: string;\n  type: string;\n  scheduledDay: number;             // Which day of sprint\n  scheduledMoment: string;          // 'standup' | 'mid_work' | 'review' | etc.\n  \n  scenario: {\n    setup: string;                  // Context for the AI\n    triggerMessage: string;         // What the team member says\n    involvedMembers: string[];      // Who's involved\n  };\n  \n  evaluation: {\n    competencies: string[];\n    successCriteria: string[];\n  };\n}\n```\n\n### Ensuring Variety Across Sprints\n\n```typescript\ninterface SprintHistory {\n  // Track what's been used to avoid repetition\n  usedThemes: string[];\n  usedTicketTemplates: string[];\n  usedSoftSkillTypes: string[];\n  usedConflictPairings: string[];   // e.g., \"user-Marcus\", \"user-Priya\"\n  \n  // Cooldown periods\n  cooldowns: {\n    themes: 2;                       // Can't reuse theme for 2 sprints\n    ticketTemplates: 3;              // Can't reuse template for 3 sprints\n    softSkillTypes: 2;               // Can't repeat same scenario type\n    conflictPairings: 3;             // Different people for conflicts\n  };\n}\n\nfunction canUse(item: string, history: string[], cooldown: number): boolean {\n  const recentHistory = history.slice(-cooldown);\n  return !recentHistory.includes(item);\n}\n```\n\n### Generation vs Selection Breakdown\n\n| Element | Generation Method |\n|---------|-------------------|\n| **Sprint Theme** | Selected from template pool, avoiding recent |\n| **Backlog Tickets (full list)** | AI-generated based on theme + templates |\n| **User's Tickets (code/bugs)** | AI-generated code from problem templates |\n| **Standup Dialogue** | AI-generated based on sprint state |\n| **Code Review Comments** | AI-generated based on user's actual code |\n| **Soft Skill Scenarios** | AI-generated from event templates |\n| **Retro Discussion** | AI-generated based on what happened |\n| **1:1 Feedback** | AI-generated based on user's performance |\n\n### Quality Guardrails\n\nTo ensure generated content is coherent and fair:\n\n```typescript\ninterface GenerationGuardrails {\n  // Content must be...\n  validation: {\n    solvable: boolean;               // Bug has a fix, feature is achievable\n    appropriateDifficulty: boolean;  // Matches difficulty band\n    narrativeConsistent: boolean;    // Fits project/team context\n    notRepetitive: boolean;          // Hasn't been used recently\n  };\n  \n  // Human review for edge cases\n  flagForReview: {\n    ifDifficultyMismatch: boolean;\n    ifNarrativeBreak: boolean;\n    ifUserComplaint: boolean;\n  };\n  \n  // Fallback to scripted content\n  fallback: {\n    onGenerationFailure: 'use_scripted_template';\n    onQualityFailure: 'regenerate_with_feedback';\n    maxRetries: 3;\n  };\n}\n```\n\n### Scalability to Other Levels\n\nThe Sprint Generation Pipeline is **level-agnostic**. The same engine powers all progression paths:\n\n```\n\n              SAME PIPELINE, DIFFERENT PARAMETERS                             \n\n                                                                              \n  SPRINT GENERATOR                                                            \n                                                                             \n        Intern  Junior                                                    \n           Params: guided difficulty, basic bugs, supportive team         \n                                                                             \n        Junior  Mid                                                       \n           Params: supported difficulty, system design, mentoring others  \n                                                                             \n        Mid  Senior                                                       \n            Params: independent difficulty, architecture, leadership       \n                                                                              \n\n```\n\n#### What Changes Per Level\n\n| Dimension | Intern  Junior | Junior  Mid | Mid  Senior |\n|-----------|-----------------|--------------|--------------|\n| **Difficulty Band** | guided  supported | supported  independent | independent  expert |\n| **Ticket Complexity** | Single-file bugs | Multi-service features | Architecture changes |\n| **Problem Templates** | Basic patterns | System design patterns | Cross-team problems |\n| **User's Role** | Individual contributor | Mentor + contributor | Tech lead + architect |\n| **Soft Skills** | Receiving feedback | Giving feedback, mentoring | Managing conflict, influencing |\n| **Team Dynamics** | Supportive seniors | Mixed, some juniors to mentor | Challenging stakeholders |\n| **Ambiguity** | Clear requirements | Some gaps to fill | Strategic decisions |\n| **Scope** | Single ticket | Multi-ticket coordination | Cross-team initiatives |\n\n#### Level-Specific Problem Templates\n\n```json\n{\n  \"problemTemplates\": {\n    \"intern_junior\": [\n      { \"id\": \"bug-null-check\", \"description\": \"Missing null check causing crash\" },\n      { \"id\": \"bug-timezone\", \"description\": \"Timezone handling issue\" },\n      { \"id\": \"feature-validation\", \"description\": \"Add form validation\" },\n      { \"id\": \"feature-error-message\", \"description\": \"Improve error messages\" }\n    ],\n    \"junior_mid\": [\n      { \"id\": \"design-api\", \"description\": \"Design REST API for new feature\" },\n      { \"id\": \"refactor-module\", \"description\": \"Refactor module for testability\" },\n      { \"id\": \"performance-query\", \"description\": \"Optimize slow database query\" },\n      { \"id\": \"incident-debug\", \"description\": \"Debug production incident\" },\n      { \"id\": \"mentor-review\", \"description\": \"Review and mentor junior's PR\" }\n    ],\n    \"mid_senior\": [\n      { \"id\": \"architecture-decision\", \"description\": \"Make architecture decision with tradeoffs\" },\n      { \"id\": \"cross-team-coordination\", \"description\": \"Coordinate feature across 3 teams\" },\n      { \"id\": \"technical-strategy\", \"description\": \"Define technical strategy for quarter\" },\n      { \"id\": \"stakeholder-negotiation\", \"description\": \"Negotiate scope with product/business\" },\n      { \"id\": \"team-scaling\", \"description\": \"Plan team scaling and hiring\" }\n    ]\n  }\n}\n```\n\n#### Level-Specific Soft Skill Events\n\n```json\n{\n  \"softSkillEvents\": {\n    \"intern_junior\": [\n      { \"type\": \"receiving_feedback\", \"description\": \"Senior gives constructive criticism on your PR\" },\n      { \"type\": \"asking_for_help\", \"description\": \"You're stuck, need to ask for help effectively\" },\n      { \"type\": \"unclear_requirements\", \"description\": \"PM's requirements are vague, need to clarify\" },\n      { \"type\": \"deadline_pressure\", \"description\": \"Sprint ending, your ticket isn't done\" }\n    ],\n    \"junior_mid\": [\n      { \"type\": \"giving_feedback\", \"description\": \"Review junior's code, give constructive feedback\" },\n      { \"type\": \"mentoring\", \"description\": \"Junior is stuck, help them without doing it for them\" },\n      { \"type\": \"technical_disagreement\", \"description\": \"Peer disagrees with your approach, defend or adapt\" },\n      { \"type\": \"scope_negotiation\", \"description\": \"PM wants more, negotiate realistic scope\" },\n      { \"type\": \"incident_leadership\", \"description\": \"Lead the response to a production incident\" }\n    ],\n    \"mid_senior\": [\n      { \"type\": \"conflict_resolution\", \"description\": \"Two team members in conflict, mediate\" },\n      { \"type\": \"stakeholder_pushback\", \"description\": \"VP questions your technical decision\" },\n      { \"type\": \"resource_constraints\", \"description\": \"Not enough engineers, prioritize ruthlessly\" },\n      { \"type\": \"strategic_tradeoff\", \"description\": \"Speed vs quality decision with business impact\" },\n      { \"type\": \"cross_team_alignment\", \"description\": \"Other team's priorities conflict with yours\" }\n    ]\n  }\n}\n```\n\n#### Level-Specific Team Dynamics\n\n| Level | User's Position | Team Composition |\n|-------|-----------------|------------------|\n| **Intern  Junior** | Newest member | Supportive seniors, helpful PM, patient tech lead |\n| **Junior  Mid** | Experienced IC | Mix of seniors and juniors (you mentor the juniors) |\n| **Mid  Senior** | Tech lead | Juniors, mids, challenging stakeholders, peer leads |\n\n```typescript\ninterface LevelSpecificTeamConfig {\n  level: 'intern' | 'junior' | 'mid' | 'senior';\n  \n  userRole: {\n    title: string;                  // \"Software Engineer I\", \"Senior Engineer\", etc.\n    responsibilities: string[];\n    autonomyLevel: 'low' | 'medium' | 'high';\n  };\n  \n  teamComposition: {\n    reportsToUser: number;          // 0 for intern, 0-1 for junior, 2-4 for mid+\n    peersAboveUser: number;         // Many for intern, few for senior\n    peersBelowUser: number;         // 0 for intern, some for mid, many for senior\n  };\n  \n  interactionPatterns: {\n    primaryMentor: boolean;         // Intern has a dedicated mentor\n    mentoringOthers: boolean;       // Mid+ mentors juniors\n    stakeholderAccess: 'limited' | 'regular' | 'frequent';\n    crossTeamWork: 'rare' | 'occasional' | 'frequent';\n  };\n}\n```\n\n#### The Generator Adapts Automatically\n\n```typescript\nfunction generateSprint(\n  progressionPath: ProgressionPath,\n  sprintNumber: number,\n  userProgress: UserProgress\n): GeneratedSprint {\n  \n  // 1. Determine difficulty band based on progression path + sprint number\n  const difficultyBand = calculateDifficultyBand(\n    progressionPath.difficultyProgression,\n    sprintNumber\n  );\n  \n  // 2. Select problem templates for this level\n  const templates = getProblemTemplates(progressionPath.entryLevel);\n  \n  // 3. Select soft skill events for this level\n  const softSkillPool = getSoftSkillEvents(progressionPath.entryLevel);\n  \n  // 4. Configure team dynamics for this level\n  const teamConfig = getTeamConfig(progressionPath.entryLevel);\n  \n  // 5. Generate sprint using standard pipeline\n  return sprintGenerationPipeline({\n    difficultyBand,\n    problemTemplates: templates,\n    softSkillPool,\n    teamConfig,\n    userCompetencyGaps: userProgress.gaps,\n    previousSprints: userProgress.completedSprints\n  });\n}\n```\n\nThis means:\n- **One codebase** powers all progression paths\n- **Content packs** (problem templates, soft skills) are swapped based on level\n- **Team dynamics** adjust automatically\n- **New progression paths** can be added by creating new content packs\n\n---\n\n## Scripted vs AI-Generated Content\n\n| Content Type | Scripted | AI-Generated |\n|--------------|----------|--------------|\n| Team member bios |  | |\n| Documentation |  | |\n| Ticket descriptions |  (templates) |  (variations) |\n| Code bugs |  | |\n| Standup dialogue | |  (based on context) |\n| Code review feedback | |  (based on user's code) |\n| Soft skill scenarios |  (setup) |  (conversation) |\n| Sprint planning discussion | |  |\n| Retro insights | |  (based on sprint data) |\n| 1:1 feedback |  (structure) |  (specifics) |\n\n### AI Orchestration Rules\n\n```typescript\ninterface AIOrchestrationConfig {\n  // What the AI knows\n  context: {\n    projectTemplate: ProjectTemplate;\n    currentArc: Arc;\n    currentDay: Day;\n    userProgress: UserProgress;\n    sprintState: SprintState;\n  };\n  \n  // Behavioral constraints\n  persona: {\n    teamMember: TeamMember;\n    tone: 'supportive' | 'professional' | 'challenging';\n    verbosity: 'concise' | 'detailed';\n  };\n  \n  // Evaluation integration\n  evaluation: {\n    trackCompetencies: string[];\n    recordToLedger: boolean;\n  };\n  \n  // Guardrails\n  constraints: {\n    stayInCharacter: boolean;\n    noBreakingFourthWall: boolean;\n    maintainNarrativeConsistency: boolean;\n  };\n}\n```\n\n---\n\n## Example Complete Journey\n\n### User: Alex, applying for \"AtlasPay Junior Developer\"\n\n**Week 1: Onboarding Arc**\n- Day 1: Meet Sarah (Tech Lead), Marcus (Senior Dev), Priya (PM), Alex (QA), Jordan (Fellow Intern)\n- Day 2: Set up dev environment, clone repo, run tests\n- Day 3: First ticket - fix timezone bug in payment display\n- Day 4: Receive code review from Marcus, iterate\n- Day 5: 1:1 with Sarah - discuss first week, set goals\n\n**Week 2-3: Sprint 1 - \"Payment Reliability\"**\n- Sprint Planning: Team selects 5 tickets, Alex assigned 2 (retry logic, error messages)\n- Days 6-10: Daily standups, work tickets, submit PRs\n- Day 8: Soft skill trigger - Priya changes requirements mid-ticket\n- Day 10: Sprint Review - demo to stakeholders\n- Day 11: Retrospective - discuss what went well\n- 1:1 with Sarah: Feedback on first sprint\n\n**Week 4-5: Sprint 2 (Final Sprint) - \"Fraud Prevention\"**\n- Higher complexity tickets\n- Day 15: Production incident - payment failures spike\n- Collaborate with DevOps to investigate\n- More challenging code reviews\n- Sprint Review & Retrospective\n- **Final 1:1 with Sarah** (replaces regular 1:1):\n  - Reviews entire journey from Day 1 to now\n  - Competency assessment across all sprints\n  - Portfolio compilation: PRs, code samples, reflections\n  - Badge earned: \"Junior Ready - Developer\"\n  - Exit experience  Portfolio view\n\n---\n\n## Implementation Phases\n\n### Phase 3A: Schema & Data Models (1 week)\n- Add Arc, Day, Activity models to schema\n- Extend JobPosting with narrativeProfile\n- Create ProjectTemplate structure\n\n### Phase 3B: Ceremony Scripts (1 week)\n- Author Sprint Planning scripts\n- Author Standup templates\n- Author Review/Retro scripts\n- Author 1:1 templates\n\n### Phase 3C: Sprint Assembly Logic (1 week)\n- Build sprint generator from templates\n- Implement difficulty progression\n- Integrate soft skill hooks\n\n### Phase 3D: UI Updates (1 week)\n- Sprint board view\n- Ceremony UI components\n- Progress tracking across sprints\n\n---\n\n## Open Questions for Discussion\n\n1. **Sprint Length**: Should we simulate 1-week or 2-week sprints? Or configurable?\n2. **Real Time vs Simulated Time**: How do we map real user time to simulated days?\n3. **Branching Narratives**: How much should user choices affect the story?\n4. **Failure States**: What happens if user consistently underperforms?\n5. **Practice Mode**: Can users replay specific ceremonies in Practice Path?\n","path":null,"size_bytes":64048,"size_tokens":null},"client/src/components/simulation/sprint-planning.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Target,\n  Users,\n  Clock,\n  CheckCircle2,\n  AlertTriangle,\n  Lightbulb,\n  Calendar,\n  Bug,\n  Sparkles,\n  Zap,\n  ArrowRight,\n  Loader2,\n  MessageSquare,\n} from \"lucide-react\";\nimport type { SprintTicket, Sprint, CeremonyInstance } from \"@shared/schema\";\n\ninterface SprintPlanningProps {\n  sprint: Sprint;\n  ceremony: CeremonyInstance;\n  tickets: SprintTicket[];\n  onComplete: () => void;\n  mode: 'journey' | 'practice';\n}\n\ninterface PlanningAdvice {\n  recommendation: string;\n  capacityAnalysis: string;\n  risks: string[];\n  tips: string[];\n}\n\nconst TEAM_VELOCITY = 20;\nconst SPRINT_CAPACITY = 21;\n\nexport default function SprintPlanning({\n  sprint,\n  ceremony,\n  tickets,\n  onComplete,\n  mode\n}: SprintPlanningProps) {\n  const { toast } = useToast();\n  const [selectedTickets, setSelectedTickets] = useState<number[]>(\n    tickets.filter(t => t.status !== 'done').map(t => t.id)\n  );\n  const [sprintGoal, setSprintGoal] = useState(\"\");\n  const [showAIAdvice, setShowAIAdvice] = useState(false);\n  const [currentStep, setCurrentStep] = useState<'backlog' | 'goal' | 'confirm'>('backlog');\n\n  const totalPoints = tickets\n    .filter(t => selectedTickets.includes(t.id))\n    .reduce((sum, t) => sum + (t.storyPoints || 0), 0);\n\n  const capacityPercentage = Math.min(100, (totalPoints / SPRINT_CAPACITY) * 100);\n  const isOverCapacity = totalPoints > SPRINT_CAPACITY;\n\n  const ticketsByType = {\n    bug: tickets.filter(t => t.type === 'bug'),\n    feature: tickets.filter(t => t.type === 'feature'),\n  };\n\n  const selectedByType = {\n    bug: ticketsByType.bug.filter(t => selectedTickets.includes(t.id)).length,\n    feature: ticketsByType.feature.filter(t => selectedTickets.includes(t.id)).length,\n  };\n\n  const toggleTicket = (ticketId: number) => {\n    setSelectedTickets(prev =>\n      prev.includes(ticketId)\n        ? prev.filter(id => id !== ticketId)\n        : [...prev, ticketId]\n    );\n  };\n\n  const updateCeremonyMutation = useMutation({\n    mutationFn: async (data: { status: string; outcome?: any }) => {\n      const response = await apiRequest(\"PATCH\", `/api/ceremonies/${ceremony.id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', sprint.id] });\n      queryClient.invalidateQueries({ queryKey: ['/api/ceremonies'] });\n    },\n  });\n\n  const handleStartPlanning = async () => {\n    if (ceremony.status === 'pending') {\n      await updateCeremonyMutation.mutateAsync({ status: 'in_progress' });\n    }\n  };\n\n  const handleCompletePlanning = async () => {\n    if (!sprintGoal.trim()) {\n      toast({\n        title: \"Sprint goal required\",\n        description: \"Please enter a sprint goal before completing planning.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    try {\n      await updateCeremonyMutation.mutateAsync({\n        status: 'completed',\n        outcome: {\n          selectedTickets,\n          sprintGoal,\n          totalPoints,\n          completedAt: new Date().toISOString(),\n        }\n      });\n      toast({\n        title: \"Sprint planning complete\",\n        description: \"Your sprint has been planned successfully.\",\n      });\n      onComplete();\n    } catch (error) {\n      console.error('Failed to complete sprint planning:', error);\n      toast({\n        title: \"Failed to complete planning\",\n        description: \"Something went wrong. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  const advice: PlanningAdvice = {\n    recommendation: totalPoints <= TEAM_VELOCITY \n      ? \"Your sprint scope looks balanced. The selected work aligns well with the team's typical velocity.\"\n      : \"Consider reducing scope. You've selected more points than the team's historical velocity suggests is sustainable.\",\n    capacityAnalysis: isOverCapacity\n      ? `Warning: You've selected ${totalPoints} points, which exceeds the sprint capacity of ${SPRINT_CAPACITY} points.`\n      : `You've selected ${totalPoints} of ${SPRINT_CAPACITY} available points (${Math.round(capacityPercentage)}% capacity).`,\n    risks: [\n      ...(isOverCapacity ? [\"Risk of not completing all committed work\"] : []),\n      ...(selectedByType.bug > selectedByType.feature * 2 ? [\"Heavy bug focus may delay feature development\"] : []),\n      ...(totalPoints < 10 ? [\"Very light sprint - consider adding more scope\"] : []),\n    ],\n    tips: [\n      \"Break down any ticket over 5 points into smaller tasks\",\n      \"Ensure at least one team member is familiar with each selected ticket\",\n      \"Reserve ~15% capacity for unexpected work\",\n      \"Prioritize tickets that unblock other work\",\n    ],\n  };\n\n  const renderBacklogStep = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">Select Sprint Backlog</h3>\n          <p className=\"text-sm text-muted-foreground\">\n            Choose which tickets to commit to this sprint\n          </p>\n        </div>\n        <Button\n          variant=\"outline\"\n          size=\"sm\"\n          onClick={() => setShowAIAdvice(!showAIAdvice)}\n          data-testid=\"button-toggle-advice\"\n        >\n          <Lightbulb className=\"h-4 w-4 mr-2\" />\n          {showAIAdvice ? 'Hide' : 'Show'} Tips\n        </Button>\n      </div>\n\n      {showAIAdvice && (\n        <Card className=\"bg-blue-50 border-blue-200\">\n          <CardContent className=\"pt-4\">\n            <div className=\"flex items-start gap-3\">\n              <Sparkles className=\"h-5 w-5 text-blue-600 mt-0.5\" />\n              <div className=\"space-y-2\">\n                <p className=\"text-sm font-medium text-blue-900\">{advice.recommendation}</p>\n                <p className=\"text-sm text-blue-700\">{advice.capacityAnalysis}</p>\n                {advice.risks.length > 0 && (\n                  <div className=\"space-y-1 mt-2\">\n                    <p className=\"text-xs font-medium text-blue-800\">Potential Risks:</p>\n                    <ul className=\"text-xs text-blue-700 list-disc ml-4\">\n                      {advice.risks.map((risk, i) => (\n                        <li key={i}>{risk}</li>\n                      ))}\n                    </ul>\n                  </div>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-12 gap-6\">\n        <div className=\"col-span-8\">\n          <ScrollArea className=\"h-[400px] pr-4\">\n            <div className=\"space-y-4\">\n              <div>\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <Bug className=\"h-4 w-4 text-red-500\" />\n                  <span className=\"font-medium\">Bugs ({ticketsByType.bug.length})</span>\n                  <Badge variant=\"secondary\" className=\"ml-auto\">\n                    {selectedByType.bug} selected\n                  </Badge>\n                </div>\n                {ticketsByType.bug.map(ticket => (\n                  <TicketItem\n                    key={ticket.id}\n                    ticket={ticket}\n                    selected={selectedTickets.includes(ticket.id)}\n                    onToggle={() => toggleTicket(ticket.id)}\n                  />\n                ))}\n                {ticketsByType.bug.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground italic\">No bugs in backlog</p>\n                )}\n              </div>\n\n              <Separator />\n\n              <div>\n                <div className=\"flex items-center gap-2 mb-3\">\n                  <Sparkles className=\"h-4 w-4 text-purple-500\" />\n                  <span className=\"font-medium\">Features ({ticketsByType.feature.length})</span>\n                  <Badge variant=\"secondary\" className=\"ml-auto\">\n                    {selectedByType.feature} selected\n                  </Badge>\n                </div>\n                {ticketsByType.feature.map(ticket => (\n                  <TicketItem\n                    key={ticket.id}\n                    ticket={ticket}\n                    selected={selectedTickets.includes(ticket.id)}\n                    onToggle={() => toggleTicket(ticket.id)}\n                  />\n                ))}\n                {ticketsByType.feature.length === 0 && (\n                  <p className=\"text-sm text-muted-foreground italic\">No features in backlog</p>\n                )}\n              </div>\n            </div>\n          </ScrollArea>\n        </div>\n\n        <div className=\"col-span-4\">\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base\">Sprint Capacity</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div>\n                <div className=\"flex justify-between text-sm mb-2\">\n                  <span>Committed Points</span>\n                  <span className={isOverCapacity ? 'text-red-600 font-medium' : ''}>\n                    {totalPoints} / {SPRINT_CAPACITY}\n                  </span>\n                </div>\n                <Progress \n                  value={capacityPercentage} \n                  className={isOverCapacity ? '[&>div]:bg-red-500' : ''}\n                />\n              </div>\n\n              <Separator />\n\n              <div className=\"space-y-2\">\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Team Velocity</span>\n                  <span>{TEAM_VELOCITY} pts/sprint</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Selected Tickets</span>\n                  <span>{selectedTickets.length}</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Bugs</span>\n                  <span>{selectedByType.bug}</span>\n                </div>\n                <div className=\"flex justify-between text-sm\">\n                  <span className=\"text-muted-foreground\">Features</span>\n                  <span>{selectedByType.feature}</span>\n                </div>\n              </div>\n\n              {isOverCapacity && (\n                <div className=\"flex items-center gap-2 p-3 bg-red-50 rounded-lg text-sm text-red-700\">\n                  <AlertTriangle className=\"h-4 w-4\" />\n                  <span>Over capacity! Consider removing some items.</span>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n\n      <div className=\"flex justify-end\">\n        <Button \n          onClick={() => setCurrentStep('goal')} \n          disabled={selectedTickets.length === 0}\n          data-testid=\"button-continue-to-goal\"\n        >\n          Continue to Sprint Goal\n          <ArrowRight className=\"h-4 w-4 ml-2\" />\n        </Button>\n      </div>\n    </div>\n  );\n\n  const renderGoalStep = () => (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-semibold\">Set Sprint Goal</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Define a clear objective that the team will work towards this sprint\n        </p>\n      </div>\n\n      <Card>\n        <CardContent className=\"pt-6\">\n          <div className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium mb-2 block\">Sprint Goal</label>\n              <Textarea\n                placeholder=\"e.g., 'Complete user authentication flow and fix critical payment bugs'\"\n                value={sprintGoal}\n                onChange={(e) => setSprintGoal(e.target.value)}\n                className=\"min-h-[100px]\"\n                data-testid=\"input-sprint-goal\"\n              />\n            </div>\n\n            <div className=\"p-4 bg-muted/50 rounded-lg\">\n              <div className=\"flex items-start gap-3\">\n                <Lightbulb className=\"h-5 w-5 text-yellow-500 mt-0.5\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-medium mb-1\">Tips for a Good Sprint Goal</p>\n                  <ul className=\"text-muted-foreground space-y-1\">\n                    <li> Focus on the business value to be delivered</li>\n                    <li> Make it specific and measurable</li>\n                    <li> Ensure it's achievable within the sprint</li>\n                    <li> Align with the selected backlog items</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-between\">\n        <Button variant=\"outline\" onClick={() => setCurrentStep('backlog')} data-testid=\"button-back-to-backlog\">\n          Back to Backlog\n        </Button>\n        <Button \n          onClick={() => setCurrentStep('confirm')} \n          disabled={!sprintGoal.trim()}\n          data-testid=\"button-continue-to-confirm\"\n        >\n          Review & Confirm\n          <ArrowRight className=\"h-4 w-4 ml-2\" />\n        </Button>\n      </div>\n    </div>\n  );\n\n  const renderConfirmStep = () => (\n    <div className=\"space-y-6\">\n      <div>\n        <h3 className=\"text-lg font-semibold\">Confirm Sprint Plan</h3>\n        <p className=\"text-sm text-muted-foreground\">\n          Review your sprint commitments before finalizing\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Target className=\"h-4 w-4\" />\n              Sprint Goal\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm\">{sprintGoal}</p>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Zap className=\"h-4 w-4\" />\n              Capacity Summary\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span>Total Tickets</span>\n                <span className=\"font-medium\">{selectedTickets.length}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Story Points</span>\n                <span className={`font-medium ${isOverCapacity ? 'text-red-600' : ''}`}>\n                  {totalPoints} / {SPRINT_CAPACITY}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Utilization</span>\n                <span className=\"font-medium\">{Math.round(capacityPercentage)}%</span>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Selected Tickets</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <ScrollArea className=\"h-[200px]\">\n            <div className=\"space-y-2\">\n              {tickets\n                .filter(t => selectedTickets.includes(t.id))\n                .map(ticket => (\n                  <div\n                    key={ticket.id}\n                    className=\"flex items-center justify-between p-2 bg-muted/50 rounded\"\n                  >\n                    <div className=\"flex items-center gap-2\">\n                      {ticket.type === 'bug' ? (\n                        <Bug className=\"h-3 w-3 text-red-500\" />\n                      ) : (\n                        <Sparkles className=\"h-3 w-3 text-purple-500\" />\n                      )}\n                      <span className=\"text-sm font-mono text-muted-foreground\">\n                        {ticket.ticketKey}\n                      </span>\n                      <span className=\"text-sm\">{ticket.title}</span>\n                    </div>\n                    <Badge variant=\"outline\" className=\"text-xs\">\n                      {ticket.storyPoints} pts\n                    </Badge>\n                  </div>\n                ))}\n            </div>\n          </ScrollArea>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-between\">\n        <Button variant=\"outline\" onClick={() => setCurrentStep('goal')} data-testid=\"button-back-to-goal\">\n          Back to Goal\n        </Button>\n        <Button \n          onClick={handleCompletePlanning}\n          disabled={updateCeremonyMutation.isPending}\n          data-testid=\"button-start-sprint\"\n        >\n          {updateCeremonyMutation.isPending ? (\n            <>\n              <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n              Starting Sprint...\n            </>\n          ) : (\n            <>\n              <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n              Start Sprint\n            </>\n          )}\n        </Button>\n      </div>\n    </div>\n  );\n\n  const steps = [\n    { id: 'backlog', label: 'Select Backlog' },\n    { id: 'goal', label: 'Sprint Goal' },\n    { id: 'confirm', label: 'Confirm' },\n  ];\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold\">Sprint Planning</h2>\n          <p className=\"text-muted-foreground\">\n            {sprint.sprintNumber ? `Sprint ${sprint.sprintNumber}` : 'Sprint'}  \n            {mode === 'journey' ? ' Journey Mode' : ' Practice Mode'}\n          </p>\n        </div>\n        <Badge variant=\"outline\" className=\"text-sm\">\n          <Calendar className=\"h-3 w-3 mr-1\" />\n          10 days\n        </Badge>\n      </div>\n\n      <div className=\"flex items-center justify-center py-4\">\n        {steps.map((step, index) => (\n          <div key={step.id} className=\"flex items-center\">\n            <div\n              className={`flex items-center gap-2 px-4 py-2 rounded-full transition-colors ${\n                currentStep === step.id\n                  ? 'bg-blue-100 text-blue-700'\n                  : steps.findIndex(s => s.id === currentStep) > index\n                  ? 'text-green-600'\n                  : 'text-muted-foreground'\n              }`}\n            >\n              <div\n                className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-medium ${\n                  currentStep === step.id\n                    ? 'bg-blue-600 text-white'\n                    : steps.findIndex(s => s.id === currentStep) > index\n                    ? 'bg-green-100 text-green-600'\n                    : 'bg-muted text-muted-foreground'\n                }`}\n              >\n                {steps.findIndex(s => s.id === currentStep) > index ? '' : index + 1}\n              </div>\n              <span className=\"text-sm font-medium\">{step.label}</span>\n            </div>\n            {index < steps.length - 1 && (\n              <div className=\"w-12 h-0.5 bg-muted mx-2\" />\n            )}\n          </div>\n        ))}\n      </div>\n\n      <Card>\n        <CardContent className=\"pt-6\">\n          {currentStep === 'backlog' && renderBacklogStep()}\n          {currentStep === 'goal' && renderGoalStep()}\n          {currentStep === 'confirm' && renderConfirmStep()}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\ninterface TicketItemProps {\n  ticket: SprintTicket;\n  selected: boolean;\n  onToggle: () => void;\n}\n\nfunction TicketItem({ ticket, selected, onToggle }: TicketItemProps) {\n  const priorityColors: Record<string, string> = {\n    critical: 'bg-red-100 text-red-700',\n    high: 'bg-orange-100 text-orange-700',\n    medium: 'bg-yellow-100 text-yellow-700',\n    low: 'bg-gray-100 text-gray-700',\n  };\n\n  return (\n    <div\n      className={`flex items-center gap-3 p-3 rounded-lg border transition-colors cursor-pointer mb-2 ${\n        selected ? 'bg-blue-50 border-blue-200' : 'bg-white border-gray-200 hover:bg-gray-50'\n      }`}\n      onClick={onToggle}\n      data-testid={`ticket-item-${ticket.id}`}\n    >\n      <Checkbox \n        checked={selected} \n        onCheckedChange={onToggle}\n        data-testid={`checkbox-ticket-${ticket.id}`}\n      />\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"font-mono text-sm text-muted-foreground\">\n            {ticket.ticketKey}\n          </span>\n          <span className=\"font-medium truncate\">{ticket.title}</span>\n        </div>\n        <p className=\"text-sm text-muted-foreground truncate\">{ticket.description}</p>\n      </div>\n      <div className=\"flex items-center gap-2 flex-shrink-0\">\n        <Badge className={priorityColors[ticket.priority] || priorityColors.medium}>\n          {ticket.priority}\n        </Badge>\n        <Badge variant=\"outline\">{ticket.storyPoints || 0} pts</Badge>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":21391,"size_tokens":null},"client/src/hooks/use-sprint-workflow.ts":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type {\n  Sprint,\n  SprintTicket,\n  CeremonyInstance,\n  GitSession,\n  GitEvent,\n  SprintActivity,\n  UserJourney,\n  JourneyArc,\n} from \"@shared/schema\";\n\nexport type TicketStatus = 'todo' | 'in_progress' | 'in_review' | 'done';\nexport type CeremonyType = 'standup' | 'planning' | 'review' | 'retro' | 'one_on_one';\nexport type MasteryBand = 'explorer' | 'contributor' | 'junior_ready';\n\nexport interface TicketStats {\n  todo: number;\n  inProgress: number;\n  inReview: number;\n  done: number;\n}\n\nexport interface SprintOverview {\n  sprint: Sprint;\n  tickets: SprintTicket[];\n  ceremonies: CeremonyInstance[];\n  currentDay: number;\n  ticketStats: TicketStats;\n  upcomingCeremonies: CeremonyInstance[];\n  todayActivities: SprintActivity[];\n}\n\nexport interface JourneyDashboard {\n  journey: UserJourney;\n  currentArc: JourneyArc | null;\n  currentSprint: SprintOverview | null;\n  readinessScore: number;\n  competencyScores: Record<string, { score: number; band: MasteryBand }>;\n  timeline: {\n    arcs: (JourneyArc & { sprints: Sprint[] })[];\n    currentPosition: { arcIndex: number; sprintIndex: number };\n  };\n  canGraduate: boolean;\n  estimatedSprintsRemaining: number;\n}\n\nexport interface GitSessionWithEvents {\n  session: GitSession;\n  events: GitEvent[];\n}\n\nexport interface TicketGitState {\n  branchCreated?: boolean;\n  branchName?: string;\n  hasPR?: boolean;\n  prTitle?: string;\n  prDescription?: string;\n  prCreatedAt?: string;\n  merged?: boolean;\n  mergedAt?: string;\n}\n\nexport function useJourneyDashboard(journeyId: number | null) {\n  return useQuery<JourneyDashboard>({\n    queryKey: ['/api/journeys', journeyId, 'dashboard'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journeys/${journeyId}/dashboard`);\n      if (!response.ok) throw new Error('Failed to fetch journey dashboard');\n      return response.json();\n    },\n    refetchInterval: 30000,\n  });\n}\n\nexport function useJourneySprints(journeyId: number | null) {\n  return useQuery<Sprint[]>({\n    queryKey: ['/api/journeys', journeyId, 'sprints'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/journeys/${journeyId}/sprints`);\n      if (!response.ok) throw new Error('Failed to fetch sprints');\n      return response.json();\n    }\n  });\n}\n\nexport function useSprintOverview(sprintId: number | null) {\n  return useQuery<SprintOverview>({\n    queryKey: ['/api/sprints', sprintId],\n    enabled: !!sprintId,\n    queryFn: async () => {\n      const response = await fetch(`/api/sprints/${sprintId}`);\n      if (!response.ok) throw new Error('Failed to fetch sprint overview');\n      return response.json();\n    },\n    refetchInterval: 10000,\n  });\n}\n\nexport function useUpdateSprint() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ sprintId, updates }: { sprintId: number; updates: Partial<Sprint> }) => {\n      const response = await apiRequest('PATCH', `/api/sprints/${sprintId}`, updates);\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n    }\n  });\n}\n\nexport function useSprintTickets(sprintId: number | null) {\n  return useQuery<SprintTicket[]>({\n    queryKey: ['/api/sprints', sprintId, 'tickets'],\n    enabled: !!sprintId,\n    queryFn: async () => {\n      const response = await fetch(`/api/sprints/${sprintId}/tickets`);\n      if (!response.ok) throw new Error('Failed to fetch tickets');\n      return response.json();\n    }\n  });\n}\n\nexport function useTicket(ticketId: number | null) {\n  return useQuery<SprintTicket>({\n    queryKey: ['/api/tickets', ticketId],\n    enabled: !!ticketId,\n    queryFn: async () => {\n      const response = await fetch(`/api/tickets/${ticketId}`);\n      if (!response.ok) throw new Error('Failed to fetch ticket');\n      return response.json();\n    }\n  });\n}\n\nexport function useCreateTicket() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ sprintId, ticket }: { sprintId: number; ticket: Partial<SprintTicket> }) => {\n      const response = await apiRequest('POST', `/api/sprints/${sprintId}/tickets`, ticket);\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'tickets'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n    }\n  });\n}\n\nexport function useUpdateTicket() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ticketId, updates, sprintId }: { ticketId: number; updates: Partial<SprintTicket>; sprintId?: number }) => {\n      const response = await apiRequest('PATCH', `/api/tickets/${ticketId}`, updates);\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId] });\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'tickets'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n      }\n    }\n  });\n}\n\nexport interface MoveTicketError {\n  message: string;\n  gate: 'branch_required' | 'pr_required' | 'merge_required';\n}\n\nexport function useMoveTicket() {\n  const queryClient = useQueryClient();\n  \n  return useMutation<SprintTicket, MoveTicketError, { ticketId: number; newStatus: TicketStatus; sprintId?: number }>({\n    mutationFn: async ({ ticketId, newStatus }) => {\n      const response = await apiRequest('PATCH', `/api/tickets/${ticketId}/move`, { newStatus });\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw errorData;\n      }\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId] });\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'tickets'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n      }\n    }\n  });\n}\n\nexport function useCeremonies(sprintId: number | null) {\n  return useQuery<CeremonyInstance[]>({\n    queryKey: ['/api/sprints', sprintId, 'ceremonies'],\n    enabled: !!sprintId,\n    queryFn: async () => {\n      const response = await fetch(`/api/sprints/${sprintId}/ceremonies`);\n      if (!response.ok) throw new Error('Failed to fetch ceremonies');\n      return response.json();\n    }\n  });\n}\n\nexport function useCeremony(ceremonyId: number | null) {\n  return useQuery<CeremonyInstance>({\n    queryKey: ['/api/ceremonies', ceremonyId],\n    enabled: !!ceremonyId,\n    queryFn: async () => {\n      const response = await fetch(`/api/ceremonies/${ceremonyId}`);\n      if (!response.ok) throw new Error('Failed to fetch ceremony');\n      return response.json();\n    },\n    refetchInterval: 5000,\n  });\n}\n\nexport function useCreateCeremony() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ sprintId, ceremony }: { sprintId: number; ceremony: Partial<CeremonyInstance> }) => {\n      const response = await apiRequest('POST', `/api/sprints/${sprintId}/ceremonies`, ceremony);\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'ceremonies'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n    }\n  });\n}\n\nexport function useUpdateCeremony() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ceremonyId, updates, sprintId }: { ceremonyId: number; updates: Partial<CeremonyInstance>; sprintId?: number }) => {\n      const response = await apiRequest('PATCH', `/api/ceremonies/${ceremonyId}`, updates);\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ceremonies', variables.ceremonyId] });\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'ceremonies'] });\n      }\n    }\n  });\n}\n\nexport interface CeremonyMessage {\n  id: string;\n  role: 'user' | 'team';\n  sender?: string;\n  senderRole?: string;\n  content: string;\n  timestamp: string;\n}\n\nexport function useAddCeremonyMessage() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ceremonyId, message, type }: { ceremonyId: number; message: CeremonyMessage; type: 'team' | 'user' }) => {\n      const response = await apiRequest('POST', `/api/ceremonies/${ceremonyId}/messages`, { message, type });\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ceremonies', variables.ceremonyId] });\n    }\n  });\n}\n\nexport function useGitSession(ticketId: number | null) {\n  return useQuery<GitSessionWithEvents>({\n    queryKey: ['/api/tickets', ticketId, 'git'],\n    enabled: !!ticketId,\n    queryFn: async () => {\n      const response = await fetch(`/api/tickets/${ticketId}/git`);\n      if (!response.ok) {\n        if (response.status === 404) {\n          return null;\n        }\n        throw new Error('Failed to fetch git session');\n      }\n      return response.json();\n    }\n  });\n}\n\nexport function useCreateGitSession() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ticketId, repoUrl }: { ticketId: number; repoUrl?: string }) => {\n      const response = await apiRequest('POST', `/api/tickets/${ticketId}/git`, { repoUrl });\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId, 'git'] });\n    }\n  });\n}\n\nexport interface GitCommandResult {\n  event: GitEvent;\n  session: GitSession;\n}\n\nexport function useExecuteGitCommand() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ sessionId, command, args, ticketId }: { sessionId: number; command: string; args?: string[]; ticketId: number }) => {\n      const response = await apiRequest('POST', `/api/git/${sessionId}/command`, { command, args });\n      return response.json() as Promise<GitCommandResult>;\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId, 'git'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId] });\n    }\n  });\n}\n\nexport function useCreatePR() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ticketId, title, description, sprintId }: { ticketId: number; title: string; description: string; sprintId?: number }) => {\n      const response = await apiRequest('POST', `/api/tickets/${ticketId}/pr`, { title, description });\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId, 'git'] });\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'tickets'] });\n      }\n    }\n  });\n}\n\nexport function useMergePR() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ ticketId, sprintId }: { ticketId: number; sprintId?: number }) => {\n      const response = await apiRequest('POST', `/api/tickets/${ticketId}/merge`, {});\n      return response.json();\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId] });\n      queryClient.invalidateQueries({ queryKey: ['/api/tickets', variables.ticketId, 'git'] });\n      if (variables.sprintId) {\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId, 'tickets'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/sprints', variables.sprintId] });\n      }\n    }\n  });\n}\n\nexport function useKanbanState(sprintId: number | null) {\n  const ticketsQuery = useSprintTickets(sprintId);\n  \n  const ticketsByStatus = {\n    todo: [] as SprintTicket[],\n    in_progress: [] as SprintTicket[],\n    in_review: [] as SprintTicket[],\n    done: [] as SprintTicket[],\n  };\n  \n  if (ticketsQuery.data) {\n    for (const ticket of ticketsQuery.data) {\n      const status = ticket.status as TicketStatus;\n      if (ticketsByStatus[status]) {\n        ticketsByStatus[status].push(ticket);\n      }\n    }\n  }\n  \n  return {\n    ...ticketsQuery,\n    ticketsByStatus,\n  };\n}\n\nexport function useSprintProgress(sprintId: number | null) {\n  const sprintQuery = useSprintOverview(sprintId);\n  \n  const progress = {\n    totalTickets: 0,\n    completedTickets: 0,\n    totalStoryPoints: 0,\n    completedStoryPoints: 0,\n    percentComplete: 0,\n  };\n  \n  if (sprintQuery.data) {\n    const { tickets, sprint } = sprintQuery.data;\n    progress.totalTickets = tickets.length;\n    progress.completedTickets = tickets.filter(t => t.status === 'done').length;\n    progress.totalStoryPoints = sprint.storyPointsTarget;\n    progress.completedStoryPoints = tickets\n      .filter(t => t.status === 'done')\n      .reduce((sum, t) => sum + (t.storyPoints || 0), 0);\n    progress.percentComplete = progress.totalStoryPoints > 0\n      ? Math.round((progress.completedStoryPoints / progress.totalStoryPoints) * 100)\n      : 0;\n  }\n  \n  return {\n    ...sprintQuery,\n    progress,\n  };\n}\n\nexport function useTodayCeremonies(sprintId: number | null, currentDay: number) {\n  const ceremoniesQuery = useCeremonies(sprintId);\n  \n  const todayCeremonies = ceremoniesQuery.data?.filter(\n    c => c.dayNumber === currentDay\n  ) || [];\n  \n  const pendingCeremonies = todayCeremonies.filter(c => c.status === 'pending');\n  const completedCeremonies = todayCeremonies.filter(c => c.status === 'completed');\n  \n  return {\n    ...ceremoniesQuery,\n    todayCeremonies,\n    pendingCeremonies,\n    completedCeremonies,\n  };\n}\n\nexport type WorkspacePhase = 'onboarding' | 'planning' | 'execution' | 'review' | 'retro';\n\nexport interface WorkspaceInstance {\n  id: number;\n  userId: number;\n  journeyId: number;\n  jobApplicationId: number | null;\n  projectTemplateId: number | null;\n  companyName: string;\n  role: string;\n  status: string;\n  currentPhase: WorkspacePhase;\n  currentSprintId: number | null;\n  onboardingCompletedAt: string | null;\n  workspaceMetadata: Record<string, unknown>;\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface WorkspacePhaseEvent {\n  id: number;\n  workspaceId: number;\n  phase: WorkspacePhase;\n  sprintId: number | null;\n  status: 'started' | 'completed';\n  payload: Record<string, unknown>;\n  completedAt: string | null;\n  createdAt: string;\n}\n\nexport interface PhaseChecklist {\n  item: string;\n  completed: boolean;\n  required: boolean;\n}\n\nexport interface NextAction {\n  action: string;\n  route: string;\n  priority: 'primary' | 'secondary';\n}\n\nexport interface WorkspaceState {\n  workspace: WorkspaceInstance;\n  currentPhase: WorkspacePhase;\n  currentSprint: Sprint | null;\n  phaseChecklist: PhaseChecklist[];\n  nextActions: NextAction[];\n  phaseHistory: WorkspacePhaseEvent[];\n}\n\nexport function useJourneyWorkspace(journeyId: number | null) {\n  return useQuery<WorkspaceInstance | null>({\n    queryKey: ['/api/journeys', journeyId, 'workspace'],\n    enabled: !!journeyId,\n    queryFn: async () => {\n      try {\n        const response = await fetch(`/api/journeys/${journeyId}/workspace`);\n        if (response.status === 404) return null;\n        if (!response.ok) throw new Error('Failed to fetch workspace');\n        return response.json();\n      } catch {\n        return null;\n      }\n    },\n  });\n}\n\nexport function useWorkspaceState(workspaceId: number | null) {\n  return useQuery<WorkspaceState>({\n    queryKey: ['/api/workspaces', workspaceId, 'state'],\n    enabled: !!workspaceId,\n    queryFn: async () => {\n      const response = await fetch(`/api/workspaces/${workspaceId}/state`);\n      if (!response.ok) throw new Error('Failed to fetch workspace state');\n      return response.json();\n    },\n    refetchInterval: 30000,\n  });\n}\n\nexport function useCreateWorkspace() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async (data: {\n      journeyId: number;\n      jobApplicationId?: number;\n      companyName?: string;\n      role?: string;\n      projectTemplateId?: number;\n    }) => {\n      return apiRequest('POST', '/api/workspaces', data);\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({\n        queryKey: ['/api/journeys', variables.journeyId, 'workspace'],\n      });\n      queryClient.invalidateQueries({\n        queryKey: ['/api/workspaces'],\n      });\n    },\n  });\n}\n\nexport function useAdvanceWorkspacePhase() {\n  const queryClient = useQueryClient();\n  \n  return useMutation({\n    mutationFn: async ({ workspaceId, payload }: { workspaceId: number; payload?: Record<string, unknown> }) => {\n      return apiRequest('POST', `/api/workspaces/${workspaceId}/advance`, { payload });\n    },\n    onSuccess: (_, variables) => {\n      queryClient.invalidateQueries({\n        queryKey: ['/api/workspaces', variables.workspaceId],\n      });\n      queryClient.invalidateQueries({\n        queryKey: ['/api/workspaces', variables.workspaceId, 'state'],\n      });\n    },\n  });\n}\n","path":null,"size_bytes":17673,"size_tokens":null},"client/src/pages/sprint-hub.tsx":{"content":"import { useState } from \"react\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  ArrowLeft,\n  GitBranch, \n  GitPullRequest,\n  CheckCircle2, \n  Clock, \n  Target,\n  Users,\n  Play,\n  AlertCircle,\n  ExternalLink,\n  ChevronRight,\n} from \"lucide-react\";\nimport { \n  useSprintOverview, \n  useKanbanState,\n  useMoveTicket,\n  type TicketStatus,\n} from \"@/hooks/use-sprint-workflow\";\nimport type { SprintTicket } from \"@shared/schema\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype TicketGitState = {\n  branchCreated?: boolean;\n  branchName?: string;\n  hasPR?: boolean;\n  prTitle?: string;\n  merged?: boolean;\n};\n\nfunction TicketCard({ \n  ticket, \n  sprintId,\n  onSelect \n}: { \n  ticket: SprintTicket;\n  sprintId: number;\n  onSelect: (ticket: SprintTicket) => void;\n}) {\n  const gitState = ticket.gitState as TicketGitState | null;\n  \n  const priorityColors = {\n    critical: 'bg-red-500',\n    high: 'bg-orange-500',\n    medium: 'bg-blue-500',\n    low: 'bg-gray-400',\n  };\n\n  return (\n    <Card \n      className=\"cursor-pointer hover:shadow-md transition-shadow\"\n      onClick={() => onSelect(ticket)}\n      data-testid={`card-ticket-${ticket.id}`}\n    >\n      <CardContent className=\"p-3 space-y-2\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs font-mono\">\n            {ticket.ticketKey}\n          </Badge>\n          <div \n            className={`h-2 w-2 rounded-full ${priorityColors[ticket.priority as keyof typeof priorityColors] || priorityColors.medium}`}\n            title={`Priority: ${ticket.priority}`}\n          />\n        </div>\n        \n        <p className=\"text-sm font-medium line-clamp-2\">{ticket.title}</p>\n        \n        <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {ticket.storyPoints || 0} pts\n            </Badge>\n            <Badge variant=\"outline\" className=\"capitalize text-xs\">\n              {ticket.type}\n            </Badge>\n          </div>\n          \n          <div className=\"flex items-center gap-1\">\n            {gitState?.branchCreated && (\n              <GitBranch className=\"h-3 w-3 text-blue-500\" />\n            )}\n            {gitState?.hasPR && (\n              <GitPullRequest className=\"h-3 w-3 text-purple-500\" />\n            )}\n            {gitState?.merged && (\n              <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction KanbanColumn({ \n  title, \n  status, \n  tickets,\n  sprintId,\n  count,\n  onSelectTicket,\n  onDropTicket,\n}: {\n  title: string;\n  status: TicketStatus;\n  tickets: SprintTicket[];\n  sprintId: number;\n  count: number;\n  onSelectTicket: (ticket: SprintTicket) => void;\n  onDropTicket: (ticketId: number, newStatus: TicketStatus) => void;\n}) {\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(true);\n  };\n\n  const handleDragLeave = () => {\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    const ticketId = parseInt(e.dataTransfer.getData('ticketId'));\n    if (!isNaN(ticketId)) {\n      onDropTicket(ticketId, status);\n    }\n  };\n\n  const statusColors = {\n    todo: 'border-t-gray-400',\n    in_progress: 'border-t-blue-500',\n    in_review: 'border-t-amber-500',\n    done: 'border-t-green-500',\n  };\n\n  return (\n    <div \n      className={`flex flex-col bg-muted/30 rounded-lg overflow-hidden border-t-4 ${statusColors[status]} ${\n        isDragOver ? 'ring-2 ring-blue-400' : ''\n      }`}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      data-testid={`column-${status}`}\n    >\n      <div className=\"p-3 bg-background border-b\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"font-semibold text-sm\">{title}</h3>\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {count}\n          </Badge>\n        </div>\n      </div>\n      \n      <div className=\"flex-1 p-2 space-y-2 min-h-[200px] overflow-y-auto\">\n        {tickets.map(ticket => (\n          <div\n            key={ticket.id}\n            draggable\n            onDragStart={(e) => {\n              e.dataTransfer.setData('ticketId', ticket.id.toString());\n            }}\n          >\n            <TicketCard\n              ticket={ticket}\n              sprintId={sprintId}\n              onSelect={onSelectTicket}\n            />\n          </div>\n        ))}\n        \n        {tickets.length === 0 && (\n          <div className=\"h-full flex items-center justify-center text-sm text-muted-foreground\">\n            No tickets\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TicketDetailPanel({ \n  ticket, \n  sprintId,\n  onClose \n}: { \n  ticket: SprintTicket;\n  sprintId: number;\n  onClose: () => void;\n}) {\n  const params = useParams<{ journeyId: string }>();\n  const journeyId = params.journeyId;\n  const gitState = ticket.gitState as TicketGitState | null;\n  \n  return (\n    <Card className=\"sticky top-4\" data-testid=\"panel-ticket-detail\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <Badge variant=\"outline\" className=\"mb-2 font-mono\">\n              {ticket.ticketKey}\n            </Badge>\n            <CardTitle className=\"text-lg\">{ticket.title}</CardTitle>\n          </div>\n          <Button variant=\"ghost\" size=\"sm\" onClick={onClose}>\n            \n          </Button>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <p className=\"text-sm text-muted-foreground\">\n          {ticket.description}\n        </p>\n        \n        <div className=\"grid grid-cols-2 gap-3 text-sm\">\n          <div>\n            <p className=\"text-muted-foreground\">Status</p>\n            <Badge className=\"mt-1 capitalize\">{ticket.status.replace('_', ' ')}</Badge>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground\">Type</p>\n            <Badge variant=\"outline\" className=\"mt-1 capitalize\">{ticket.type}</Badge>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground\">Priority</p>\n            <Badge variant=\"secondary\" className=\"mt-1 capitalize\">{ticket.priority}</Badge>\n          </div>\n          <div>\n            <p className=\"text-muted-foreground\">Story Points</p>\n            <Badge variant=\"secondary\" className=\"mt-1\">{ticket.storyPoints || 0}</Badge>\n          </div>\n        </div>\n        \n        <Separator />\n        \n        <div>\n          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n            <GitBranch className=\"h-4 w-4\" />\n            Git Workflow\n          </h4>\n          <div className=\"space-y-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              {gitState?.branchCreated ? (\n                <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n              ) : (\n                <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />\n              )}\n              <span className={gitState?.branchCreated ? '' : 'text-muted-foreground'}>\n                Branch created\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {gitState?.hasPR ? (\n                <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n              ) : (\n                <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />\n              )}\n              <span className={gitState?.hasPR ? '' : 'text-muted-foreground'}>\n                Pull request submitted\n              </span>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              {gitState?.merged ? (\n                <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n              ) : (\n                <AlertCircle className=\"h-4 w-4 text-muted-foreground\" />\n              )}\n              <span className={gitState?.merged ? '' : 'text-muted-foreground'}>\n                Merged to main\n              </span>\n            </div>\n          </div>\n        </div>\n        \n        <Separator />\n        \n        <Link href={`/journey/${journeyId}/sprint/${sprintId}/ticket/${ticket.id}`}>\n          <Button className=\"w-full gap-2\" data-testid=\"button-work-on-ticket\">\n            <Play className=\"h-4 w-4\" />\n            Work on Ticket\n            <ChevronRight className=\"h-4 w-4 ml-auto\" />\n          </Button>\n        </Link>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function SprintHub() {\n  const params = useParams<{ journeyId: string; sprintId: string }>();\n  const journeyId = params.journeyId ? parseInt(params.journeyId) : null;\n  const sprintId = params.sprintId ? parseInt(params.sprintId) : null;\n  \n  const [selectedTicket, setSelectedTicket] = useState<SprintTicket | null>(null);\n  \n  const { data: overview, isLoading } = useSprintOverview(sprintId);\n  const { ticketsByStatus } = useKanbanState(sprintId);\n  const moveTicket = useMoveTicket();\n  const { toast } = useToast();\n\n  const handleMoveTicket = (ticketId: number, newStatus: TicketStatus) => {\n    moveTicket.mutate(\n      { ticketId, newStatus, sprintId: sprintId || undefined },\n      {\n        onError: (error) => {\n          toast({\n            title: \"Cannot move ticket\",\n            description: error.message,\n            variant: \"destructive\",\n          });\n        },\n        onSuccess: () => {\n          if (selectedTicket?.id === ticketId) {\n            setSelectedTicket(prev => prev ? { ...prev, status: newStatus } : null);\n          }\n        }\n      }\n    );\n  };\n\n  if (isLoading || !overview) {\n    return (\n      <div className=\"container max-w-7xl mx-auto p-6 space-y-6\" data-testid=\"sprint-hub-loading\">\n        <Skeleton className=\"h-8 w-64\" />\n        <div className=\"grid grid-cols-4 gap-4\">\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n        </div>\n      </div>\n    );\n  }\n\n  const { sprint, currentDay, ticketStats, upcomingCeremonies } = overview;\n  const totalPoints = sprint.storyPointsTarget;\n  const completedPoints = overview.tickets\n    .filter(t => t.status === 'done')\n    .reduce((sum, t) => sum + (t.storyPoints || 0), 0);\n  const progressPercent = totalPoints > 0 ? Math.round((completedPoints / totalPoints) * 100) : 0;\n\n  return (\n    <div className=\"container max-w-7xl mx-auto p-6 space-y-6\" data-testid=\"sprint-hub\">\n      <div className=\"flex items-center gap-4\">\n        <Link href={`/journey/${journeyId}`}>\n          <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid=\"button-back\">\n            <ArrowLeft className=\"h-4 w-4\" />\n            Back to Dashboard\n          </Button>\n        </Link>\n      </div>\n\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-2xl font-bold tracking-tight\" data-testid=\"text-sprint-title\">\n            {sprint.theme}\n          </h1>\n          <p className=\"text-muted-foreground\">{sprint.goal}</p>\n        </div>\n        \n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <p className=\"text-sm text-muted-foreground\">Sprint Day</p>\n            <p className=\"text-2xl font-bold\" data-testid=\"text-sprint-day\">{currentDay}/10</p>\n          </div>\n          <Separator orientation=\"vertical\" className=\"h-10\" />\n          <div className=\"text-right\">\n            <p className=\"text-sm text-muted-foreground\">Story Points</p>\n            <p className=\"text-2xl font-bold\" data-testid=\"text-story-points\">\n              {completedPoints}/{totalPoints}\n            </p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\n              <Target className=\"h-5 w-5 text-gray-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Progress</p>\n              <p className=\"text-xl font-semibold\">{progressPercent}%</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center\">\n              <Clock className=\"h-5 w-5 text-blue-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">In Progress</p>\n              <p className=\"text-xl font-semibold\">{ticketStats.inProgress}</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-900 flex items-center justify-center\">\n              <GitPullRequest className=\"h-5 w-5 text-amber-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">In Review</p>\n              <p className=\"text-xl font-semibold\">{ticketStats.inReview}</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center\">\n              <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Done</p>\n              <p className=\"text-xl font-semibold\">{ticketStats.done}</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {upcomingCeremonies.length > 0 && (\n        <Card className=\"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-950/50\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <Users className=\"h-5 w-5 text-blue-600\" />\n                <div>\n                  <p className=\"font-medium\">Upcoming: {upcomingCeremonies[0].ceremonyType}</p>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Ready for today's ceremony\n                  </p>\n                </div>\n              </div>\n              <Link href={`/journey/${journeyId}/sprint/${sprintId}/ceremony/${upcomingCeremonies[0].id}`}>\n                <Button className=\"gap-2\" data-testid=\"button-start-ceremony\">\n                  <Play className=\"h-4 w-4\" />\n                  Start\n                </Button>\n              </Link>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"flex gap-6\">\n        <div className={`flex-1 grid grid-cols-4 gap-4 ${selectedTicket ? 'lg:w-2/3' : 'w-full'}`}>\n          <KanbanColumn\n            title=\"To Do\"\n            status=\"todo\"\n            tickets={ticketsByStatus.todo}\n            sprintId={sprintId || 0}\n            count={ticketStats.todo}\n            onSelectTicket={setSelectedTicket}\n            onDropTicket={handleMoveTicket}\n          />\n          <KanbanColumn\n            title=\"In Progress\"\n            status=\"in_progress\"\n            tickets={ticketsByStatus.in_progress}\n            sprintId={sprintId || 0}\n            count={ticketStats.inProgress}\n            onSelectTicket={setSelectedTicket}\n            onDropTicket={handleMoveTicket}\n          />\n          <KanbanColumn\n            title=\"In Review\"\n            status=\"in_review\"\n            tickets={ticketsByStatus.in_review}\n            sprintId={sprintId || 0}\n            count={ticketStats.inReview}\n            onSelectTicket={setSelectedTicket}\n            onDropTicket={handleMoveTicket}\n          />\n          <KanbanColumn\n            title=\"Done\"\n            status=\"done\"\n            tickets={ticketsByStatus.done}\n            sprintId={sprintId || 0}\n            count={ticketStats.done}\n            onSelectTicket={setSelectedTicket}\n            onDropTicket={handleMoveTicket}\n          />\n        </div>\n        \n        {selectedTicket && (\n          <div className=\"w-80 shrink-0\">\n            <TicketDetailPanel\n              ticket={selectedTicket}\n              sprintId={sprintId || 0}\n              onClose={() => setSelectedTicket(null)}\n            />\n          </div>\n        )}\n      </div>\n\n      <Progress value={currentDay * 10} className=\"h-2\" />\n      <p className=\"text-xs text-muted-foreground text-center\">\n        Day {currentDay} of 10 - {10 - currentDay} days remaining in sprint\n      </p>\n    </div>\n  );\n}\n","path":null,"size_bytes":17396,"size_tokens":null},"client/src/pages/journey-dashboard.tsx":{"content":"import { useParams, Link } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { \n  Calendar, \n  GitBranch, \n  CheckCircle2, \n  Clock, \n  Target, \n  TrendingUp,\n  Users,\n  Play,\n  ArrowRight,\n  Trophy,\n  BarChart3,\n  Rocket,\n  Zap,\n  Building2,\n  Briefcase,\n} from \"lucide-react\";\nimport { \n  useJourneyDashboard, \n  useJourneyWorkspace,\n  type MasteryBand,\n  type WorkspacePhase,\n} from \"@/hooks/use-sprint-workflow\";\n\nfunction getBandColor(band: MasteryBand): string {\n  switch (band) {\n    case 'explorer': return 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200';\n    case 'contributor': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n    case 'junior_ready': return 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200';\n    default: return 'bg-gray-100 text-gray-800';\n  }\n}\n\nfunction getBandLabel(band: MasteryBand): string {\n  switch (band) {\n    case 'explorer': return 'Explorer';\n    case 'contributor': return 'Contributor';\n    case 'junior_ready': return 'Junior Ready';\n    default: return band;\n  }\n}\n\nfunction formatDate(date: Date | string): string {\n  return new Date(date).toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n  });\n}\n\nfunction getPhaseLabel(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': return 'Onboarding';\n    case 'planning': return 'Sprint Planning';\n    case 'execution': return 'Sprint Execution';\n    case 'review': return 'Sprint Review';\n    case 'retro': return 'Sprint Retrospective';\n    default: return phase;\n  }\n}\n\nfunction getPhaseColor(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': return 'bg-teal-500';\n    case 'planning': return 'bg-indigo-500';\n    case 'execution': return 'bg-blue-500';\n    case 'review': return 'bg-amber-500';\n    case 'retro': return 'bg-violet-500';\n    default: return 'bg-gray-500';\n  }\n}\n\nfunction getPhaseBadgeVariant(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': return 'bg-teal-100 text-teal-800 dark:bg-teal-900 dark:text-teal-200';\n    case 'planning': return 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200';\n    case 'execution': return 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200';\n    case 'review': return 'bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200';\n    case 'retro': return 'bg-violet-100 text-violet-800 dark:bg-violet-900 dark:text-violet-200';\n    default: return 'bg-gray-100 text-gray-800';\n  }\n}\n\nexport default function JourneyDashboard() {\n  const params = useParams<{ journeyId: string }>();\n  const journeyId = params.journeyId ? parseInt(params.journeyId) : null;\n  \n  const { data: dashboard, isLoading, error } = useJourneyDashboard(journeyId);\n  const { data: workspace, isLoading: workspaceLoading } = useJourneyWorkspace(journeyId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-7xl mx-auto p-6 space-y-6\" data-testid=\"journey-dashboard-loading\">\n        <div className=\"flex justify-between items-start\">\n          <div className=\"space-y-2\">\n            <Skeleton className=\"h-8 w-64\" />\n            <Skeleton className=\"h-4 w-96\" />\n          </div>\n          <Skeleton className=\"h-10 w-32\" />\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n          <Skeleton className=\"h-32\" />\n        </div>\n        <Skeleton className=\"h-96\" />\n      </div>\n    );\n  }\n\n  if (error || !dashboard) {\n    return (\n      <div className=\"container max-w-7xl mx-auto p-6\" data-testid=\"journey-dashboard-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Journey</CardTitle>\n            <CardDescription>\n              {error?.message || 'Journey not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n        </Card>\n      </div>\n    );\n  }\n\n  const { journey, currentArc, currentSprint, readinessScore, competencyScores, timeline, canGraduate, estimatedSprintsRemaining } = dashboard;\n\n  return (\n    <div className=\"container max-w-7xl mx-auto p-6 space-y-6\" data-testid=\"journey-dashboard\">\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\" data-testid=\"text-journey-title\">\n            Your Journey Dashboard\n          </h1>\n          <p className=\"text-muted-foreground mt-1\">\n            Track your progress toward becoming Junior Ready\n          </p>\n        </div>\n        \n        {canGraduate && (\n          <Link href={`/journey/${journeyId}/graduate`}>\n            <Button size=\"lg\" className=\"gap-2\" data-testid=\"button-graduate\">\n              <Trophy className=\"h-5 w-5\" />\n              Graduate Now\n            </Button>\n          </Link>\n        )}\n      </div>\n\n      {workspace && (\n        <Card \n          className={`border-l-4 ${getPhaseColor(workspace.currentPhase).replace('bg-', 'border-')}`}\n          data-testid=\"card-workspace-hero\"\n        >\n          <CardHeader>\n            <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n              <div className=\"flex items-center gap-4\">\n                <div className={`p-3 rounded-lg ${getPhaseColor(workspace.currentPhase)}`}>\n                  <Building2 className=\"h-6 w-6 text-white\" />\n                </div>\n                <div>\n                  <CardTitle className=\"flex items-center gap-2\" data-testid=\"text-workspace-company\">\n                    {workspace.companyName} Workspace\n                  </CardTitle>\n                  <CardDescription className=\"flex items-center gap-2 mt-1\">\n                    <Briefcase className=\"h-4 w-4\" />\n                    <span data-testid=\"text-workspace-role\">{workspace.role}</span>\n                    <span className=\"text-muted-foreground\"></span>\n                    <Badge \n                      className={getPhaseBadgeVariant(workspace.currentPhase)}\n                      data-testid=\"badge-workspace-phase\"\n                    >\n                      {getPhaseLabel(workspace.currentPhase)}\n                    </Badge>\n                  </CardDescription>\n                </div>\n              </div>\n              <Link href={`/workspace/${workspace.id}`}>\n                <Button className=\"gap-2\" size=\"lg\" data-testid=\"button-open-workspace\">\n                  <Play className=\"h-4 w-4\" />\n                  Open Workspace\n                  <ArrowRight className=\"h-4 w-4\" />\n                </Button>\n              </Link>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n              <span>Current Phase:</span>\n              <div className=\"flex items-center gap-1\">\n                {['onboarding', 'planning', 'execution', 'review', 'retro'].map((phase, index) => (\n                  <div key={phase} className=\"flex items-center\">\n                    {index > 0 && <div className=\"w-4 h-0.5 bg-muted\" />}\n                    <div \n                      className={`w-2 h-2 rounded-full ${\n                        phase === workspace.currentPhase \n                          ? getPhaseColor(phase as WorkspacePhase)\n                          : 'bg-muted'\n                      }`}\n                    />\n                  </div>\n                ))}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <Card data-testid=\"card-readiness\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Target className=\"h-4 w-4\" />\n              Readiness Score\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-end gap-2\">\n              <span className=\"text-4xl font-bold\" data-testid=\"text-readiness-score\">{readinessScore}%</span>\n              <span className=\"text-sm text-muted-foreground mb-1\">of 85% target</span>\n            </div>\n            <Progress value={readinessScore} max={100} className=\"mt-3 h-2\" />\n            {readinessScore >= 85 ? (\n              <p className=\"text-sm text-green-600 dark:text-green-400 mt-2 flex items-center gap-1\">\n                <CheckCircle2 className=\"h-3 w-3\" />\n                You've reached the graduation threshold!\n              </p>\n            ) : (\n              <p className=\"text-sm text-muted-foreground mt-2\">\n                ~{estimatedSprintsRemaining} sprint(s) to reach 85%\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-sprint-progress\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Rocket className=\"h-4 w-4\" />\n              Sprint Progress\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-end gap-2\">\n              <span className=\"text-4xl font-bold\" data-testid=\"text-sprints-completed\">\n                {journey.completedSprints}\n              </span>\n              <span className=\"text-sm text-muted-foreground mb-1\">sprints completed</span>\n            </div>\n            {currentSprint ? (\n              <div className=\"mt-3 space-y-1\">\n                <div className=\"flex justify-between text-sm\">\n                  <span>Current: Day {currentSprint.currentDay}/10</span>\n                  <span className=\"text-muted-foreground\">\n                    {currentSprint.ticketStats.done}/{currentSprint.tickets.length} tickets\n                  </span>\n                </div>\n                <Progress \n                  value={(currentSprint.currentDay / 10) * 100} \n                  className=\"h-2\" \n                />\n              </div>\n            ) : (\n              <p className=\"text-sm text-muted-foreground mt-3\">\n                No active sprint\n              </p>\n            )}\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-current-arc\">\n          <CardHeader className=\"pb-2\">\n            <CardTitle className=\"text-sm font-medium text-muted-foreground flex items-center gap-2\">\n              <Calendar className=\"h-4 w-4\" />\n              Current Phase\n            </CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex items-end gap-2\">\n              <span className=\"text-2xl font-bold capitalize\" data-testid=\"text-arc-type\">\n                {currentArc?.arcType || 'Not started'}\n              </span>\n            </div>\n            {currentArc && (\n              <>\n                <p className=\"text-sm text-muted-foreground mt-1\">\n                  {currentArc.arcType === 'onboarding' ? 'Getting set up' : `Sprint ${currentArc.arcOrder - 1}`}\n                </p>\n                <Badge \n                  variant=\"outline\" \n                  className=\"mt-3\"\n                  data-testid=\"badge-arc-status\"\n                >\n                  {currentArc.status}\n                </Badge>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n\n      {currentSprint && (\n        <Card data-testid=\"card-active-sprint\">\n          <CardHeader>\n            <div className=\"flex justify-between items-start\">\n              <div>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <Zap className=\"h-5 w-5 text-blue-500\" />\n                  Active Sprint\n                </CardTitle>\n                <CardDescription className=\"mt-1\">\n                  {currentSprint.sprint.theme} - {currentSprint.sprint.goal}\n                </CardDescription>\n              </div>\n              <Link href={`/journey/${journeyId}/sprint/${currentSprint.sprint.id}`}>\n                <Button className=\"gap-2\" data-testid=\"button-enter-sprint\">\n                  <Play className=\"h-4 w-4\" />\n                  Enter Sprint\n                </Button>\n              </Link>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">Todo</p>\n                <p className=\"text-2xl font-semibold\" data-testid=\"text-tickets-todo\">\n                  {currentSprint.ticketStats.todo}\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">In Progress</p>\n                <p className=\"text-2xl font-semibold text-blue-600\" data-testid=\"text-tickets-in-progress\">\n                  {currentSprint.ticketStats.inProgress}\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">In Review</p>\n                <p className=\"text-2xl font-semibold text-amber-600\" data-testid=\"text-tickets-in-review\">\n                  {currentSprint.ticketStats.inReview}\n                </p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-sm text-muted-foreground\">Done</p>\n                <p className=\"text-2xl font-semibold text-green-600\" data-testid=\"text-tickets-done\">\n                  {currentSprint.ticketStats.done}\n                </p>\n              </div>\n            </div>\n            \n            {currentSprint.upcomingCeremonies.length > 0 && (\n              <>\n                <Separator className=\"my-4\" />\n                <div>\n                  <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n                    <Users className=\"h-4 w-4\" />\n                    Upcoming Ceremonies\n                  </h4>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {currentSprint.upcomingCeremonies.slice(0, 3).map(ceremony => (\n                      <Link \n                        key={ceremony.id} \n                        href={`/journey/${journeyId}/sprint/${currentSprint.sprint.id}/ceremony/${ceremony.id}`}\n                      >\n                        <Badge \n                          variant=\"secondary\" \n                          className=\"cursor-pointer hover:bg-secondary/80\"\n                          data-testid={`badge-ceremony-${ceremony.id}`}\n                        >\n                          <Clock className=\"h-3 w-3 mr-1\" />\n                          {ceremony.ceremonyType}\n                        </Badge>\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        <Card data-testid=\"card-competencies\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <BarChart3 className=\"h-5 w-5\" />\n              Competency Progress\n            </CardTitle>\n            <CardDescription>\n              Your skill levels across key competencies\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              {Object.entries(competencyScores).map(([slug, { score, band }]) => (\n                <div key={slug} className=\"space-y-2\">\n                  <div className=\"flex justify-between items-center\">\n                    <span className=\"text-sm font-medium capitalize\">\n                      {slug.replace(/_/g, ' ')}\n                    </span>\n                    <Badge \n                      className={getBandColor(band)}\n                      data-testid={`badge-competency-${slug}`}\n                    >\n                      {getBandLabel(band)}\n                    </Badge>\n                  </div>\n                  <Progress value={score} className=\"h-2\" />\n                </div>\n              ))}\n              {Object.keys(competencyScores).length === 0 && (\n                <p className=\"text-sm text-muted-foreground text-center py-4\">\n                  Complete activities to track competency progress\n                </p>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card data-testid=\"card-timeline\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <TrendingUp className=\"h-5 w-5\" />\n              Journey Timeline\n            </CardTitle>\n            <CardDescription>\n              Your path from start to graduation\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-3\">\n              {timeline.arcs.map((arc, arcIndex) => (\n                <div \n                  key={arc.id} \n                  className={`flex items-center gap-3 p-3 rounded-lg ${\n                    arcIndex === timeline.currentPosition.arcIndex\n                      ? 'bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800'\n                      : arc.status === 'completed'\n                      ? 'bg-green-50 dark:bg-green-950'\n                      : 'bg-muted/50'\n                  }`}\n                  data-testid={`timeline-arc-${arc.id}`}\n                >\n                  <div className={`h-8 w-8 rounded-full flex items-center justify-center ${\n                    arc.status === 'completed'\n                      ? 'bg-green-500 text-white'\n                      : arc.status === 'in_progress'\n                      ? 'bg-blue-500 text-white'\n                      : 'bg-muted text-muted-foreground'\n                  }`}>\n                    {arc.status === 'completed' ? (\n                      <CheckCircle2 className=\"h-4 w-4\" />\n                    ) : arc.arcType === 'onboarding' ? (\n                      <Rocket className=\"h-4 w-4\" />\n                    ) : (\n                      <span className=\"text-xs font-bold\">{arc.arcOrder - 1}</span>\n                    )}\n                  </div>\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium capitalize\">\n                      {arc.arcType === 'onboarding' ? 'Onboarding' : `Sprint ${arc.arcOrder - 1}`}\n                    </p>\n                    <p className=\"text-xs text-muted-foreground\">\n                      {arc.sprints.length > 0 && arc.sprints[0].theme}\n                    </p>\n                  </div>\n                  {arcIndex === timeline.currentPosition.arcIndex && (\n                    <Badge variant=\"outline\" className=\"text-blue-600\">\n                      Current\n                    </Badge>\n                  )}\n                </div>\n              ))}\n              \n              <div className=\"flex items-center gap-3 p-3 rounded-lg bg-muted/30 border-2 border-dashed\">\n                <div className=\"h-8 w-8 rounded-full flex items-center justify-center bg-gradient-to-br from-amber-400 to-amber-600 text-white\">\n                  <Trophy className=\"h-4 w-4\" />\n                </div>\n                <div className=\"flex-1\">\n                  <p className=\"font-medium\">Graduation</p>\n                  <p className=\"text-xs text-muted-foreground\">\n                    {canGraduate ? 'Ready to graduate!' : `${estimatedSprintsRemaining} sprint(s) away`}\n                  </p>\n                </div>\n                {canGraduate && (\n                  <Badge className=\"bg-green-500\">Ready!</Badge>\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card className=\"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-950/50\" data-testid=\"card-quick-actions\">\n        <CardHeader>\n          <CardTitle className=\"text-lg\">Quick Actions</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex flex-wrap gap-3\">\n            {currentSprint && (\n              <>\n                <Link href={`/journey/${journeyId}/sprint/${currentSprint.sprint.id}`}>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-view-kanban\">\n                    <GitBranch className=\"h-4 w-4\" />\n                    View Kanban Board\n                  </Button>\n                </Link>\n                <Link href={`/journey/${journeyId}/sprint/${currentSprint.sprint.id}/standup`}>\n                  <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-daily-standup\">\n                    <Users className=\"h-4 w-4\" />\n                    Daily Standup\n                  </Button>\n                </Link>\n              </>\n            )}\n            <Link href={`/journey/${journeyId}/portfolio`}>\n              <Button variant=\"outline\" className=\"gap-2\" data-testid=\"button-view-portfolio\">\n                <BarChart3 className=\"h-4 w-4\" />\n                View Portfolio\n              </Button>\n            </Link>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":21572,"size_tokens":null},"client/src/lib/git-simulator.ts":{"content":"export type GitCommandType = \n  | 'clone' | 'init' | 'status' | 'add' | 'commit' | 'push' | 'pull' \n  | 'branch' | 'checkout' | 'merge' | 'log' | 'diff' | 'fetch' | 'stash';\n\nexport interface GitFile {\n  path: string;\n  status: 'untracked' | 'modified' | 'staged' | 'committed';\n  content?: string;\n}\n\nexport interface GitCommit {\n  hash: string;\n  message: string;\n  author: string;\n  timestamp: string;\n  files: string[];\n}\n\nexport interface GitBranch {\n  name: string;\n  isActive: boolean;\n  commits: GitCommit[];\n  upstreamBranch?: string;\n}\n\nexport interface GitState {\n  isInitialized: boolean;\n  isCloned: boolean;\n  repoUrl?: string;\n  currentBranch: string;\n  branches: GitBranch[];\n  stagedFiles: GitFile[];\n  modifiedFiles: GitFile[];\n  untrackedFiles: GitFile[];\n  remoteSyncStatus: 'synced' | 'ahead' | 'behind' | 'diverged';\n  stash: GitFile[][];\n}\n\nexport interface GitCommandResult {\n  success: boolean;\n  output: string;\n  error?: string;\n  stateChange?: Partial<GitState>;\n  tip?: string;\n}\n\nexport interface GitTip {\n  command: string;\n  title: string;\n  description: string;\n  example: string;\n}\n\nconst GIT_TIPS: Record<GitCommandType, GitTip> = {\n  clone: {\n    command: 'git clone',\n    title: 'Clone a repository',\n    description: 'Creates a copy of a remote repository on your local machine.',\n    example: 'git clone https://github.com/company/project.git',\n  },\n  init: {\n    command: 'git init',\n    title: 'Initialize a repository',\n    description: 'Creates a new Git repository in the current directory.',\n    example: 'git init',\n  },\n  status: {\n    command: 'git status',\n    title: 'Check repository status',\n    description: 'Shows which files have been modified, staged, or are untracked.',\n    example: 'git status',\n  },\n  add: {\n    command: 'git add',\n    title: 'Stage changes',\n    description: 'Adds files to the staging area for the next commit.',\n    example: 'git add src/feature.ts  # Stage specific file\\ngit add .  # Stage all changes',\n  },\n  commit: {\n    command: 'git commit',\n    title: 'Commit changes',\n    description: 'Records staged changes with a descriptive message.',\n    example: 'git commit -m \"Add user authentication feature\"',\n  },\n  push: {\n    command: 'git push',\n    title: 'Push to remote',\n    description: 'Uploads local commits to the remote repository.',\n    example: 'git push origin feature/login',\n  },\n  pull: {\n    command: 'git pull',\n    title: 'Pull from remote',\n    description: 'Downloads and merges changes from the remote repository.',\n    example: 'git pull origin main',\n  },\n  branch: {\n    command: 'git branch',\n    title: 'Manage branches',\n    description: 'Creates, lists, or deletes branches.',\n    example: 'git branch feature/new-feature  # Create branch\\ngit branch -d old-branch  # Delete branch',\n  },\n  checkout: {\n    command: 'git checkout',\n    title: 'Switch branches',\n    description: 'Switches to a different branch or restores files.',\n    example: 'git checkout -b feature/login  # Create and switch to new branch\\ngit checkout main  # Switch to existing branch',\n  },\n  merge: {\n    command: 'git merge',\n    title: 'Merge branches',\n    description: 'Combines changes from another branch into the current branch.',\n    example: 'git merge feature/login  # Merge feature branch into current branch',\n  },\n  log: {\n    command: 'git log',\n    title: 'View commit history',\n    description: 'Shows the commit history of the repository.',\n    example: 'git log --oneline  # Compact view\\ngit log -n 5  # Last 5 commits',\n  },\n  diff: {\n    command: 'git diff',\n    title: 'View changes',\n    description: 'Shows differences between commits, branches, or working tree.',\n    example: 'git diff  # Unstaged changes\\ngit diff --staged  # Staged changes',\n  },\n  fetch: {\n    command: 'git fetch',\n    title: 'Fetch from remote',\n    description: 'Downloads changes from remote without merging.',\n    example: 'git fetch origin',\n  },\n  stash: {\n    command: 'git stash',\n    title: 'Stash changes',\n    description: 'Temporarily stores uncommitted changes.',\n    example: 'git stash  # Save changes\\ngit stash pop  # Restore changes',\n  },\n};\n\nconst BRANCH_NAMING_TIPS = {\n  patterns: [\n    { prefix: 'feature/', description: 'For new features', example: 'feature/PROJ-123-user-login' },\n    { prefix: 'bugfix/', description: 'For bug fixes', example: 'bugfix/PROJ-456-fix-null-error' },\n    { prefix: 'hotfix/', description: 'For urgent production fixes', example: 'hotfix/PROJ-789-security-patch' },\n    { prefix: 'refactor/', description: 'For code refactoring', example: 'refactor/PROJ-101-cleanup-utils' },\n    { prefix: 'chore/', description: 'For maintenance tasks', example: 'chore/PROJ-202-update-deps' },\n  ],\n  bestPractices: [\n    'Use lowercase letters and hyphens',\n    'Include ticket ID when available',\n    'Keep names short but descriptive',\n    'Avoid special characters',\n  ],\n};\n\nconst COMMIT_MESSAGE_TIPS = {\n  patterns: [\n    { type: 'feat:', description: 'New feature', example: 'feat: add user authentication' },\n    { type: 'fix:', description: 'Bug fix', example: 'fix: resolve null pointer in login' },\n    { type: 'docs:', description: 'Documentation', example: 'docs: update README setup guide' },\n    { type: 'style:', description: 'Formatting', example: 'style: format code with prettier' },\n    { type: 'refactor:', description: 'Code refactoring', example: 'refactor: simplify auth middleware' },\n    { type: 'test:', description: 'Adding tests', example: 'test: add unit tests for user service' },\n    { type: 'chore:', description: 'Maintenance', example: 'chore: update dependencies' },\n  ],\n  bestPractices: [\n    'Use imperative mood (add, not added)',\n    'Keep subject line under 50 characters',\n    'Separate subject from body with blank line',\n    'Explain what and why, not how',\n  ],\n};\n\nfunction generateShortHash(): string {\n  return Math.random().toString(36).substring(2, 9);\n}\n\nfunction formatTimestamp(): string {\n  return new Date().toISOString();\n}\n\nexport function createInitialState(): GitState {\n  return {\n    isInitialized: false,\n    isCloned: false,\n    currentBranch: 'main',\n    branches: [\n      {\n        name: 'main',\n        isActive: true,\n        commits: [],\n      },\n    ],\n    stagedFiles: [],\n    modifiedFiles: [],\n    untrackedFiles: [],\n    remoteSyncStatus: 'synced',\n    stash: [],\n  };\n}\n\nexport function parseGitCommand(input: string): { command: GitCommandType | null; args: string[] } {\n  const parts = input.trim().split(/\\s+/);\n  \n  if (parts[0] !== 'git') {\n    return { command: null, args: [] };\n  }\n  \n  const command = parts[1] as GitCommandType;\n  const args = parts.slice(2);\n  \n  return { command, args };\n}\n\nexport function validateBranchName(name: string): { valid: boolean; message: string; suggestion?: string } {\n  if (!name) {\n    return { valid: false, message: 'Branch name cannot be empty' };\n  }\n  \n  if (name.startsWith('-')) {\n    return { valid: false, message: 'Branch name cannot start with a hyphen' };\n  }\n  \n  if (name.includes('..')) {\n    return { valid: false, message: 'Branch name cannot contain \"..\"' };\n  }\n  \n  if (/[~^:?*\\[\\]\\\\@{}]/.test(name)) {\n    return { valid: false, message: 'Branch name contains invalid characters' };\n  }\n  \n  if (name.endsWith('.lock')) {\n    return { valid: false, message: 'Branch name cannot end with .lock' };\n  }\n  \n  const lowerName = name.toLowerCase();\n  const hasValidPrefix = BRANCH_NAMING_TIPS.patterns.some(p => lowerName.startsWith(p.prefix));\n  \n  if (!hasValidPrefix && !['main', 'master', 'develop', 'staging'].includes(lowerName)) {\n    const suggestion = `Consider using a prefix like \"feature/${name}\" or \"bugfix/${name}\"`;\n    return { valid: true, message: 'Valid but could follow conventions better', suggestion };\n  }\n  \n  return { valid: true, message: 'Valid branch name' };\n}\n\nexport function validateCommitMessage(message: string): { valid: boolean; message: string; suggestion?: string } {\n  if (!message || message.trim().length === 0) {\n    return { valid: false, message: 'Commit message cannot be empty' };\n  }\n  \n  if (message.length < 3) {\n    return { valid: false, message: 'Commit message is too short' };\n  }\n  \n  const hasConventionalPrefix = COMMIT_MESSAGE_TIPS.patterns.some(\n    p => message.toLowerCase().startsWith(p.type)\n  );\n  \n  if (!hasConventionalPrefix) {\n    return { \n      valid: true, \n      message: 'Valid but could follow conventional commits',\n      suggestion: 'Try: \"feat: ' + message + '\" for a new feature'\n    };\n  }\n  \n  if (message.length > 72) {\n    return {\n      valid: true,\n      message: 'Consider keeping the first line under 72 characters',\n      suggestion: 'Use a blank line and add details in the body'\n    };\n  }\n  \n  return { valid: true, message: 'Good commit message!' };\n}\n\nexport function simulateGitCommand(\n  state: GitState,\n  command: GitCommandType,\n  args: string[]\n): GitCommandResult {\n  switch (command) {\n    case 'clone':\n      return simulateClone(state, args);\n    case 'init':\n      return simulateInit(state);\n    case 'status':\n      return simulateStatus(state);\n    case 'add':\n      return simulateAdd(state, args);\n    case 'commit':\n      return simulateCommit(state, args);\n    case 'push':\n      return simulatePush(state, args);\n    case 'pull':\n      return simulatePull(state);\n    case 'branch':\n      return simulateBranch(state, args);\n    case 'checkout':\n      return simulateCheckout(state, args);\n    case 'log':\n      return simulateLog(state, args);\n    case 'diff':\n      return simulateDiff(state);\n    case 'fetch':\n      return simulateFetch(state);\n    case 'stash':\n      return simulateStash(state, args);\n    default:\n      return {\n        success: false,\n        output: '',\n        error: `Unknown command: ${command}`,\n      };\n  }\n}\n\nfunction simulateClone(state: GitState, args: string[]): GitCommandResult {\n  if (state.isCloned) {\n    return {\n      success: false,\n      output: '',\n      error: 'Repository already cloned',\n    };\n  }\n  \n  const repoUrl = args[0];\n  if (!repoUrl) {\n    return {\n      success: false,\n      output: '',\n      error: 'Repository URL required',\n      tip: GIT_TIPS.clone.example,\n    };\n  }\n  \n  return {\n    success: true,\n    output: `Cloning into '${repoUrl.split('/').pop()}'...\\nremote: Enumerating objects: 156, done.\\nremote: Counting objects: 100% (156/156), done.\\nremote: Compressing objects: 100% (89/89), done.\\nReceiving objects: 100% (156/156), 45.2 KiB | 1.2 MiB/s, done.\\nResolving deltas: 100% (67/67), done.`,\n    stateChange: {\n      isCloned: true,\n      isInitialized: true,\n      repoUrl,\n    },\n    tip: 'Repository cloned! Use \"git status\" to see the current state.',\n  };\n}\n\nfunction simulateInit(state: GitState): GitCommandResult {\n  if (state.isInitialized) {\n    return {\n      success: false,\n      output: '',\n      error: 'Repository already initialized',\n    };\n  }\n  \n  return {\n    success: true,\n    output: 'Initialized empty Git repository in .git/',\n    stateChange: {\n      isInitialized: true,\n    },\n  };\n}\n\nfunction simulateStatus(state: GitState): GitCommandResult {\n  const lines: string[] = [];\n  lines.push(`On branch ${state.currentBranch}`);\n  \n  if (state.stagedFiles.length > 0) {\n    lines.push('\\nChanges to be committed:');\n    lines.push('  (use \"git restore --staged <file>...\" to unstage)');\n    state.stagedFiles.forEach(f => lines.push(`\\t${f.status === 'staged' ? 'new file' : 'modified'}:   ${f.path}`));\n  }\n  \n  if (state.modifiedFiles.length > 0) {\n    lines.push('\\nChanges not staged for commit:');\n    lines.push('  (use \"git add <file>...\" to update what will be committed)');\n    state.modifiedFiles.forEach(f => lines.push(`\\tmodified:   ${f.path}`));\n  }\n  \n  if (state.untrackedFiles.length > 0) {\n    lines.push('\\nUntracked files:');\n    lines.push('  (use \"git add <file>...\" to include in what will be committed)');\n    state.untrackedFiles.forEach(f => lines.push(`\\t${f.path}`));\n  }\n  \n  if (state.stagedFiles.length === 0 && state.modifiedFiles.length === 0 && state.untrackedFiles.length === 0) {\n    lines.push('\\nnothing to commit, working tree clean');\n  }\n  \n  return {\n    success: true,\n    output: lines.join('\\n'),\n  };\n}\n\nfunction simulateAdd(state: GitState, args: string[]): GitCommandResult {\n  if (args.length === 0) {\n    return {\n      success: false,\n      output: '',\n      error: 'Nothing specified, nothing added.',\n      tip: GIT_TIPS.add.example,\n    };\n  }\n  \n  const addAll = args.includes('.') || args.includes('-A') || args.includes('--all');\n  \n  let stagedCount = 0;\n  const newStaged: GitFile[] = [...state.stagedFiles];\n  \n  if (addAll) {\n    state.modifiedFiles.forEach(f => {\n      newStaged.push({ ...f, status: 'staged' });\n      stagedCount++;\n    });\n    state.untrackedFiles.forEach(f => {\n      newStaged.push({ ...f, status: 'staged' });\n      stagedCount++;\n    });\n    \n    return {\n      success: true,\n      output: stagedCount > 0 ? `Added ${stagedCount} file(s) to staging area` : 'Nothing to add',\n      stateChange: {\n        stagedFiles: newStaged,\n        modifiedFiles: [],\n        untrackedFiles: [],\n      },\n    };\n  }\n  \n  return {\n    success: true,\n    output: 'Changes staged for commit',\n    stateChange: {\n      stagedFiles: newStaged,\n    },\n  };\n}\n\nfunction simulateCommit(state: GitState, args: string[]): GitCommandResult {\n  if (state.stagedFiles.length === 0) {\n    return {\n      success: false,\n      output: '',\n      error: 'nothing to commit, working tree clean',\n      tip: 'Use \"git add <file>\" to stage changes first',\n    };\n  }\n  \n  const messageIndex = args.indexOf('-m');\n  let message = '';\n  \n  if (messageIndex !== -1 && args[messageIndex + 1]) {\n    message = args[messageIndex + 1].replace(/^[\"']|[\"']$/g, '');\n  } else {\n    return {\n      success: false,\n      output: '',\n      error: 'Aborting commit due to empty commit message.',\n      tip: GIT_TIPS.commit.example,\n    };\n  }\n  \n  const validation = validateCommitMessage(message);\n  const hash = generateShortHash();\n  \n  const commit: GitCommit = {\n    hash,\n    message,\n    author: 'You <you@example.com>',\n    timestamp: formatTimestamp(),\n    files: state.stagedFiles.map(f => f.path),\n  };\n  \n  const branch = state.branches.find(b => b.name === state.currentBranch);\n  if (branch) {\n    branch.commits.push(commit);\n  }\n  \n  let output = `[${state.currentBranch} ${hash}] ${message}\\n ${state.stagedFiles.length} file(s) changed`;\n  \n  return {\n    success: true,\n    output,\n    stateChange: {\n      stagedFiles: [],\n      remoteSyncStatus: 'ahead',\n    },\n    tip: validation.suggestion,\n  };\n}\n\nfunction simulatePush(state: GitState, args: string[]): GitCommandResult {\n  if (state.remoteSyncStatus === 'synced') {\n    return {\n      success: true,\n      output: 'Everything up-to-date',\n    };\n  }\n  \n  const remote = args[0] || 'origin';\n  const branch = args[1] || state.currentBranch;\n  \n  return {\n    success: true,\n    output: `Enumerating objects: 5, done.\\nCounting objects: 100% (5/5), done.\\nDelta compression using up to 8 threads\\nCompressing objects: 100% (3/3), done.\\nWriting objects: 100% (3/3), 350 bytes | 350.00 KiB/s, done.\\nTotal 3 (delta 2), reused 0 (delta 0)\\nTo ${remote}/${branch}\\n   abc1234..def5678  ${branch} -> ${branch}`,\n    stateChange: {\n      remoteSyncStatus: 'synced',\n    },\n  };\n}\n\nfunction simulatePull(state: GitState): GitCommandResult {\n  return {\n    success: true,\n    output: 'Already up to date.',\n    stateChange: {\n      remoteSyncStatus: 'synced',\n    },\n  };\n}\n\nfunction simulateBranch(state: GitState, args: string[]): GitCommandResult {\n  if (args.length === 0) {\n    const output = state.branches\n      .map(b => `${b.isActive ? '* ' : '  '}${b.name}`)\n      .join('\\n');\n    return { success: true, output };\n  }\n  \n  const branchName = args[0];\n  \n  if (args.includes('-d') || args.includes('-D')) {\n    const toDelete = args.find(a => !a.startsWith('-'));\n    if (!toDelete) {\n      return { success: false, output: '', error: 'Branch name required' };\n    }\n    if (toDelete === state.currentBranch) {\n      return { success: false, output: '', error: 'Cannot delete the currently checked out branch' };\n    }\n    return {\n      success: true,\n      output: `Deleted branch ${toDelete}`,\n      stateChange: {\n        branches: state.branches.filter(b => b.name !== toDelete),\n      },\n    };\n  }\n  \n  const validation = validateBranchName(branchName);\n  if (!validation.valid) {\n    return { success: false, output: '', error: validation.message };\n  }\n  \n  if (state.branches.some(b => b.name === branchName)) {\n    return { success: false, output: '', error: `A branch named '${branchName}' already exists` };\n  }\n  \n  const newBranch: GitBranch = {\n    name: branchName,\n    isActive: false,\n    commits: [...(state.branches.find(b => b.isActive)?.commits || [])],\n  };\n  \n  return {\n    success: true,\n    output: `Created branch '${branchName}'`,\n    stateChange: {\n      branches: [...state.branches, newBranch],\n    },\n    tip: validation.suggestion,\n  };\n}\n\nfunction simulateCheckout(state: GitState, args: string[]): GitCommandResult {\n  const createNew = args.includes('-b');\n  let branchName = args.find(a => !a.startsWith('-'));\n  \n  if (!branchName) {\n    return { success: false, output: '', error: 'Branch name required' };\n  }\n  \n  if (createNew) {\n    const validation = validateBranchName(branchName);\n    if (!validation.valid) {\n      return { success: false, output: '', error: validation.message };\n    }\n    \n    if (state.branches.some(b => b.name === branchName)) {\n      return { success: false, output: '', error: `A branch named '${branchName}' already exists` };\n    }\n    \n    const newBranch: GitBranch = {\n      name: branchName,\n      isActive: true,\n      commits: [...(state.branches.find(b => b.isActive)?.commits || [])],\n    };\n    \n    return {\n      success: true,\n      output: `Switched to a new branch '${branchName}'`,\n      stateChange: {\n        currentBranch: branchName,\n        branches: [\n          ...state.branches.map(b => ({ ...b, isActive: false })),\n          newBranch,\n        ],\n      },\n      tip: validation.suggestion,\n    };\n  }\n  \n  const existingBranch = state.branches.find(b => b.name === branchName);\n  if (!existingBranch) {\n    return { success: false, output: '', error: `pathspec '${branchName}' did not match any file(s) known to git` };\n  }\n  \n  return {\n    success: true,\n    output: `Switched to branch '${branchName}'`,\n    stateChange: {\n      currentBranch: branchName,\n      branches: state.branches.map(b => ({ ...b, isActive: b.name === branchName })),\n    },\n  };\n}\n\nfunction simulateLog(state: GitState, args: string[]): GitCommandResult {\n  const currentBranch = state.branches.find(b => b.isActive);\n  if (!currentBranch || currentBranch.commits.length === 0) {\n    return { success: true, output: 'No commits yet' };\n  }\n  \n  const oneline = args.includes('--oneline');\n  let limit = 10;\n  const nIndex = args.indexOf('-n');\n  if (nIndex !== -1 && args[nIndex + 1]) {\n    limit = parseInt(args[nIndex + 1], 10);\n  }\n  \n  const commits = currentBranch.commits.slice(-limit).reverse();\n  \n  if (oneline) {\n    return {\n      success: true,\n      output: commits.map(c => `${c.hash} ${c.message}`).join('\\n'),\n    };\n  }\n  \n  const lines = commits.map(c => [\n    `commit ${c.hash}`,\n    `Author: ${c.author}`,\n    `Date:   ${c.timestamp}`,\n    '',\n    `    ${c.message}`,\n    '',\n  ].join('\\n'));\n  \n  return { success: true, output: lines.join('\\n') };\n}\n\nfunction simulateDiff(state: GitState): GitCommandResult {\n  if (state.modifiedFiles.length === 0 && state.stagedFiles.length === 0) {\n    return { success: true, output: '' };\n  }\n  \n  return {\n    success: true,\n    output: 'diff --git a/file.ts b/file.ts\\nindex abc1234..def5678 100644\\n--- a/file.ts\\n+++ b/file.ts\\n@@ -1,5 +1,6 @@\\n // Example diff output\\n+// New line added',\n  };\n}\n\nfunction simulateFetch(state: GitState): GitCommandResult {\n  return {\n    success: true,\n    output: 'From origin\\n   abc1234..def5678  main       -> origin/main',\n  };\n}\n\nfunction simulateStash(state: GitState, args: string[]): GitCommandResult {\n  if (args.includes('pop')) {\n    if (state.stash.length === 0) {\n      return { success: false, output: '', error: 'No stash entries found.' };\n    }\n    const restored = state.stash[state.stash.length - 1];\n    return {\n      success: true,\n      output: `Dropped refs/stash@{0} (abc1234)`,\n      stateChange: {\n        modifiedFiles: restored,\n        stash: state.stash.slice(0, -1),\n      },\n    };\n  }\n  \n  if (args.includes('list')) {\n    if (state.stash.length === 0) {\n      return { success: true, output: '' };\n    }\n    return {\n      success: true,\n      output: state.stash.map((_, i) => `stash@{${i}}: WIP on ${state.currentBranch}`).join('\\n'),\n    };\n  }\n  \n  if (state.modifiedFiles.length === 0 && state.stagedFiles.length === 0) {\n    return { success: false, output: '', error: 'No local changes to save' };\n  }\n  \n  return {\n    success: true,\n    output: `Saved working directory and index state WIP on ${state.currentBranch}`,\n    stateChange: {\n      stash: [...state.stash, [...state.modifiedFiles, ...state.stagedFiles]],\n      modifiedFiles: [],\n      stagedFiles: [],\n    },\n  };\n}\n\nexport function getGitTip(command: GitCommandType): GitTip | null {\n  return GIT_TIPS[command] || null;\n}\n\nexport function getBranchNamingTips() {\n  return BRANCH_NAMING_TIPS;\n}\n\nexport function getCommitMessageTips() {\n  return COMMIT_MESSAGE_TIPS;\n}\n\nexport function suggestBranchName(ticketKey: string, ticketTitle: string, ticketType: string): string {\n  const prefix = ticketType === 'bug' ? 'bugfix' : 'feature';\n  const slug = ticketTitle\n    .toLowerCase()\n    .replace(/[^a-z0-9\\s]/g, '')\n    .trim()\n    .split(/\\s+/)\n    .slice(0, 4)\n    .join('-');\n  \n  return `${prefix}/${ticketKey.toLowerCase()}-${slug}`;\n}\n\nexport function suggestCommitMessage(ticketKey: string, changeDescription: string, ticketType: string): string {\n  const prefix = ticketType === 'bug' ? 'fix' : 'feat';\n  return `${prefix}(${ticketKey}): ${changeDescription}`;\n}\n","path":null,"size_bytes":22159,"size_tokens":null},"client/src/components/simulation/ceremony-session.tsx":{"content":"import { useState, useRef, useEffect, useCallback } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  Users,\n  Clock,\n  CheckCircle2,\n  Send,\n  AlertTriangle,\n  ThumbsUp,\n  ThumbsDown,\n  Lightbulb,\n  MessageSquare,\n  Coffee,\n  Target,\n  RotateCcw,\n  Loader2,\n  ChevronRight,\n} from \"lucide-react\";\nimport type { CeremonyInstance, SprintTicket, Sprint } from \"@shared/schema\";\n\ntype CeremonyType = 'standup' | 'review' | 'retrospective';\n\ninterface TeamMember {\n  id: string;\n  name: string;\n  role: string;\n  avatar?: string;\n}\n\ninterface CeremonyMessage {\n  id: string;\n  speaker: TeamMember | 'user';\n  content: string;\n  timestamp: Date;\n  type: 'message' | 'question' | 'action' | 'feedback';\n}\n\ninterface CeremonySessionProps {\n  ceremony: CeremonyInstance;\n  sprint: Sprint;\n  tickets: SprintTicket[];\n  teamMembers: TeamMember[];\n  onComplete: (outcome: any) => void;\n  mode: 'journey' | 'practice';\n}\n\nconst CEREMONY_CONFIG: Record<CeremonyType, {\n  title: string;\n  icon: any;\n  description: string;\n  prompts: string[];\n  color: string;\n}> = {\n  standup: {\n    title: 'Daily Standup',\n    icon: Coffee,\n    description: 'Share your progress, plans, and blockers with the team',\n    prompts: [\n      \"What did you work on yesterday?\",\n      \"What are you planning to work on today?\",\n      \"Do you have any blockers or need help with anything?\",\n    ],\n    color: 'blue',\n  },\n  review: {\n    title: 'Sprint Review',\n    icon: Target,\n    description: 'Demo completed work and gather feedback from stakeholders',\n    prompts: [\n      \"Walk us through what you accomplished this sprint.\",\n      \"Can you demo the main feature you worked on?\",\n      \"What feedback do you have on the sprint goal?\",\n    ],\n    color: 'green',\n  },\n  retrospective: {\n    title: 'Sprint Retrospective',\n    icon: RotateCcw,\n    description: 'Reflect on the sprint and identify improvements',\n    prompts: [\n      \"What went well this sprint?\",\n      \"What could we improve?\",\n      \"What actions should we take going forward?\",\n    ],\n    color: 'purple',\n  },\n};\n\nexport default function CeremonySession({\n  ceremony,\n  sprint,\n  tickets,\n  teamMembers,\n  onComplete,\n  mode\n}: CeremonySessionProps) {\n  const [messages, setMessages] = useState<CeremonyMessage[]>([]);\n  const [currentInput, setCurrentInput] = useState(\"\");\n  const [currentPromptIndex, setCurrentPromptIndex] = useState(0);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [userResponses, setUserResponses] = useState<string[]>([]);\n  const [isCompleting, setIsCompleting] = useState(false);\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const hasInitialized = useRef(false);\n\n  const ceremonyType = ceremony.ceremonyType as CeremonyType;\n  const config = CEREMONY_CONFIG[ceremonyType];\n\n  const completeCeremonyMutation = useMutation({\n    mutationFn: async (outcome: any) => {\n      const response = await apiRequest('PATCH', `/api/ceremonies/${ceremony.id}`, {\n        status: 'completed',\n        outcome,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/ceremonies', ceremony.id] });\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', sprint.id, 'ceremonies'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/sprints', sprint.id] });\n    },\n  });\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (!hasInitialized.current) {\n      hasInitialized.current = true;\n      startCeremony();\n    }\n  }, []);\n\n  const startCeremony = () => {\n    const facilitator = teamMembers.find(m => m.role.toLowerCase().includes('lead') || m.role.toLowerCase().includes('manager')) || teamMembers[0];\n    \n    const welcomeMessage: CeremonyMessage = {\n      id: `msg-${Date.now()}`,\n      speaker: facilitator,\n      content: getWelcomeMessage(ceremonyType, facilitator.name),\n      timestamp: new Date(),\n      type: 'message',\n    };\n\n    setMessages([welcomeMessage]);\n\n    setTimeout(() => {\n      const firstPrompt: CeremonyMessage = {\n        id: `msg-${Date.now()}-1`,\n        speaker: facilitator,\n        content: config.prompts[0],\n        timestamp: new Date(),\n        type: 'question',\n      };\n      setMessages(prev => [...prev, firstPrompt]);\n    }, 1000);\n  };\n\n  const getWelcomeMessage = (type: CeremonyType, facilitatorName: string): string => {\n    switch (type) {\n      case 'standup':\n        return `Good morning team! I'm ${facilitatorName}, and I'll be facilitating today's standup. Let's keep it focused - remember, it's about what you're working on, not a detailed status report. We'll go around the room.`;\n      case 'review':\n        return `Welcome everyone to our Sprint Review! I'm ${facilitatorName}. Today we'll be showcasing the work completed this sprint and gathering feedback. Let's start with our intern developer.`;\n      case 'retrospective':\n        return `Hi team, ${facilitatorName} here. Time for our retrospective! This is a safe space to discuss what went well, what didn't, and how we can improve. Let's be constructive and focus on the process, not individuals.`;\n      default:\n        return `Let's get started with today's ${type}.`;\n    }\n  };\n\n  const handleSendMessage = async () => {\n    if (!currentInput.trim() || isProcessing) return;\n\n    const userMessage: CeremonyMessage = {\n      id: `msg-${Date.now()}`,\n      speaker: 'user',\n      content: currentInput,\n      timestamp: new Date(),\n      type: 'message',\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    setUserResponses(prev => [...prev, currentInput]);\n    setCurrentInput(\"\");\n    setIsProcessing(true);\n\n    setTimeout(() => {\n      processResponse(currentInput);\n    }, 1000);\n  };\n\n  const processResponse = (userResponse: string) => {\n    const newPromptIndex = currentPromptIndex + 1;\n    \n    const respondingMember = teamMembers[newPromptIndex % teamMembers.length] || teamMembers[0];\n    \n    const acknowledgment: CeremonyMessage = {\n      id: `msg-${Date.now()}-ack`,\n      speaker: respondingMember,\n      content: getAcknowledgment(ceremonyType, userResponse, respondingMember.name),\n      timestamp: new Date(),\n      type: 'feedback',\n    };\n    \n    setMessages(prev => [...prev, acknowledgment]);\n\n    if (newPromptIndex < config.prompts.length) {\n      setTimeout(() => {\n        const nextPrompt: CeremonyMessage = {\n          id: `msg-${Date.now()}-q`,\n          speaker: teamMembers[0],\n          content: config.prompts[newPromptIndex],\n          timestamp: new Date(),\n          type: 'question',\n        };\n        setMessages(prev => [...prev, nextPrompt]);\n        setCurrentPromptIndex(newPromptIndex);\n        setIsProcessing(false);\n      }, 1500);\n    } else {\n      setCurrentPromptIndex(newPromptIndex);\n      setTimeout(() => {\n        const closingMessage: CeremonyMessage = {\n          id: `msg-${Date.now()}-close`,\n          speaker: teamMembers[0],\n          content: getClosingMessage(ceremonyType, teamMembers[0].name),\n          timestamp: new Date(),\n          type: 'message',\n        };\n        setMessages(prev => [...prev, closingMessage]);\n        setIsProcessing(false);\n      }, 1500);\n    }\n  };\n\n  const getAcknowledgment = (type: CeremonyType, response: string, memberName: string): string => {\n    const acknowledgments = {\n      standup: [\n        \"Thanks for the update! Sounds like you're making good progress.\",\n        \"Got it. Let us know if you need any help with that.\",\n        \"Nice work! Keep the momentum going.\",\n      ],\n      review: [\n        \"Great demo! I like how you approached that problem.\",\n        \"Solid work. The stakeholders will appreciate this.\",\n        \"Interesting solution. Can you tell us more about the technical decisions?\",\n      ],\n      retrospective: [\n        \"That's a great observation. I've noticed that too.\",\n        \"Thanks for bringing that up. It's important we address this.\",\n        \"I agree. Let's add that to our action items.\",\n      ],\n    };\n\n    const options = acknowledgments[type];\n    return options[Math.floor(Math.random() * options.length)];\n  };\n\n  const getClosingMessage = (type: CeremonyType, facilitatorName: string): string => {\n    switch (type) {\n      case 'standup':\n        return `Great standup everyone! Remember, if anyone gets blocked, don't wait until tomorrow - reach out on Slack. Have a productive day!`;\n      case 'review':\n        return `Excellent work this sprint, team! The stakeholders were impressed with the progress. Let's take these feedback items into our next planning session.`;\n      case 'retrospective':\n        return `Thanks for the thoughtful discussion, team. I've captured our action items and we'll follow up on them next sprint. Great retrospective!`;\n      default:\n        return `Thanks everyone, great session!`;\n    }\n  };\n\n  const handleComplete = async () => {\n    setIsCompleting(true);\n    const outcome = {\n      responses: userResponses,\n      messageCount: messages.length,\n      completedAt: new Date().toISOString(),\n    };\n    \n    try {\n      await completeCeremonyMutation.mutateAsync(outcome);\n      onComplete(outcome);\n    } catch (error) {\n      console.error('Failed to complete ceremony:', error);\n      setIsCompleting(false);\n    }\n  };\n\n  const isComplete = currentPromptIndex >= config.prompts.length && !isProcessing;\n  const progress = ((currentPromptIndex + (isComplete ? 1 : 0)) / config.prompts.length) * 100;\n\n  const Icon = config.icon;\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n      <Card>\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              <div className={`p-2 rounded-lg bg-${config.color}-100`}>\n                <Icon className={`h-5 w-5 text-${config.color}-600`} />\n              </div>\n              <div>\n                <CardTitle className=\"text-xl\">{config.title}</CardTitle>\n                <p className=\"text-sm text-muted-foreground\">{config.description}</p>\n              </div>\n            </div>\n            <Badge variant=\"outline\" className=\"text-sm\">\n              {mode === 'journey' ? 'Journey Mode' : 'Practice Mode'}\n            </Badge>\n          </div>\n        </CardHeader>\n        <CardContent>\n          <div className=\"mb-4\">\n            <div className=\"flex justify-between text-sm mb-1\">\n              <span>Progress</span>\n              <span>{Math.round(progress)}%</span>\n            </div>\n            <Progress value={progress} />\n          </div>\n\n          <div className=\"flex gap-2 mb-4 flex-wrap\">\n            <span className=\"text-sm text-muted-foreground\">Team:</span>\n            {teamMembers.map((member) => (\n              <Badge key={member.id} variant=\"secondary\" className=\"text-xs\">\n                {member.name} ({member.role})\n              </Badge>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"p-0\">\n          <ScrollArea className=\"h-[400px] p-4\" ref={scrollRef}>\n            <div className=\"space-y-4\">\n              {messages.map((message) => (\n                <MessageBubble key={message.id} message={message} />\n              ))}\n              \n              {isProcessing && (\n                <div className=\"flex items-center gap-2 text-muted-foreground\">\n                  <Loader2 className=\"h-4 w-4 animate-spin\" />\n                  <span className=\"text-sm\">Team is responding...</span>\n                </div>\n              )}\n            </div>\n          </ScrollArea>\n\n          <Separator />\n\n          <div className=\"p-4\">\n            {!isComplete ? (\n              <div className=\"flex gap-2\">\n                <Textarea\n                  value={currentInput}\n                  onChange={(e) => setCurrentInput(e.target.value)}\n                  placeholder=\"Type your response...\"\n                  className=\"min-h-[80px] resize-none\"\n                  disabled={isProcessing}\n                  onKeyDown={(e) => {\n                    if (e.key === 'Enter' && !e.shiftKey) {\n                      e.preventDefault();\n                      handleSendMessage();\n                    }\n                  }}\n                  data-testid=\"input-ceremony-response\"\n                />\n                <Button\n                  onClick={handleSendMessage}\n                  disabled={!currentInput.trim() || isProcessing}\n                  className=\"self-end\"\n                  data-testid=\"button-send-response\"\n                >\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            ) : (\n              <div className=\"flex items-center justify-between p-4 bg-green-50 rounded-lg\">\n                <div className=\"flex items-center gap-2\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                  <span className=\"font-medium text-green-800\">\n                    {config.title} Complete!\n                  </span>\n                </div>\n                <Button \n                  onClick={handleComplete} \n                  disabled={isCompleting}\n                  data-testid=\"button-complete-ceremony\"\n                  aria-label=\"Complete ceremony and continue\"\n                >\n                  {isCompleting ? (\n                    <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                  ) : null}\n                  Continue\n                  {!isCompleting && <ChevronRight className=\"h-4 w-4 ml-2\" />}\n                </Button>\n              </div>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n\n      {ceremonyType === 'standup' && (\n        <StandupSidebar tickets={tickets} />\n      )}\n\n      {ceremonyType === 'review' && (\n        <ReviewSidebar tickets={tickets} sprint={sprint} />\n      )}\n\n      {ceremonyType === 'retrospective' && (\n        <RetroSidebar responses={userResponses} />\n      )}\n    </div>\n  );\n}\n\ninterface MessageBubbleProps {\n  message: CeremonyMessage;\n}\n\nfunction MessageBubble({ message }: MessageBubbleProps) {\n  const isUser = message.speaker === 'user';\n  const speaker = isUser ? null : message.speaker as TeamMember;\n\n  return (\n    <div className={`flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`}>\n      {!isUser && speaker && (\n        <Avatar className=\"h-8 w-8\">\n          <AvatarImage src={speaker.avatar} />\n          <AvatarFallback className=\"text-xs bg-blue-100 text-blue-700\">\n            {speaker.name.split(' ').map(n => n[0]).join('')}\n          </AvatarFallback>\n        </Avatar>\n      )}\n      \n      <div className={`flex-1 max-w-[80%] ${isUser ? 'text-right' : ''}`}>\n        {!isUser && speaker && (\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"text-sm font-medium\">{speaker.name}</span>\n            <span className=\"text-xs text-muted-foreground\">{speaker.role}</span>\n          </div>\n        )}\n        <div\n          className={`inline-block p-3 rounded-lg ${\n            isUser\n              ? 'bg-blue-600 text-white'\n              : message.type === 'question'\n              ? 'bg-yellow-50 border border-yellow-200'\n              : 'bg-gray-100'\n          }`}\n        >\n          <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n        </div>\n        <p className=\"text-xs text-muted-foreground mt-1\">\n          {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n        </p>\n      </div>\n    </div>\n  );\n}\n\ninterface StandupSidebarProps {\n  tickets: SprintTicket[];\n}\n\nfunction StandupSidebar({ tickets }: StandupSidebarProps) {\n  const inProgress = tickets.filter(t => t.status === 'in_progress');\n  const blocked = tickets.filter(t => t.priority === 'critical');\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-base\">Your Current Work</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div>\n          <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2\">\n            <Clock className=\"h-4 w-4\" />\n            In Progress ({inProgress.length})\n          </h4>\n          <div className=\"space-y-2\">\n            {inProgress.map(ticket => (\n              <div key={ticket.id} className=\"text-sm p-2 bg-muted rounded\">\n                <span className=\"font-mono text-muted-foreground\">{ticket.ticketKey}</span>\n                <span className=\"ml-2\">{ticket.title}</span>\n              </div>\n            ))}\n            {inProgress.length === 0 && (\n              <p className=\"text-sm text-muted-foreground italic\">No tickets in progress</p>\n            )}\n          </div>\n        </div>\n\n        {blocked.length > 0 && (\n          <div>\n            <h4 className=\"text-sm font-medium mb-2 flex items-center gap-2 text-red-600\">\n              <AlertTriangle className=\"h-4 w-4\" />\n              Critical Items\n            </h4>\n            <div className=\"space-y-2\">\n              {blocked.map(ticket => (\n                <div key={ticket.id} className=\"text-sm p-2 bg-red-50 rounded border border-red-200\">\n                  <span className=\"font-mono text-red-600\">{ticket.ticketKey}</span>\n                  <span className=\"ml-2\">{ticket.title}</span>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface ReviewSidebarProps {\n  tickets: SprintTicket[];\n  sprint: Sprint;\n}\n\nfunction ReviewSidebar({ tickets, sprint }: ReviewSidebarProps) {\n  const completed = tickets.filter(t => t.status === 'done');\n  const totalPoints = completed.reduce((sum, t) => sum + (t.storyPoints || 0), 0);\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-base\">Sprint Summary</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div className=\"text-center p-3 bg-green-50 rounded\">\n            <div className=\"text-2xl font-bold text-green-600\">{completed.length}</div>\n            <div className=\"text-xs text-green-700\">Tickets Completed</div>\n          </div>\n          <div className=\"text-center p-3 bg-blue-50 rounded\">\n            <div className=\"text-2xl font-bold text-blue-600\">{totalPoints}</div>\n            <div className=\"text-xs text-blue-700\">Story Points</div>\n          </div>\n        </div>\n\n        <div>\n          <h4 className=\"text-sm font-medium mb-2\">Completed Work</h4>\n          <div className=\"space-y-1\">\n            {completed.map(ticket => (\n              <div key={ticket.id} className=\"flex items-center gap-2 text-sm\">\n                <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n                <span className=\"font-mono text-xs text-muted-foreground\">{ticket.ticketKey}</span>\n                <span className=\"truncate\">{ticket.title}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\ninterface RetroSidebarProps {\n  responses: string[];\n}\n\nfunction RetroSidebar({ responses }: RetroSidebarProps) {\n  const categories = [\n    { icon: ThumbsUp, label: 'What went well', color: 'green' },\n    { icon: ThumbsDown, label: 'What to improve', color: 'orange' },\n    { icon: Lightbulb, label: 'Action items', color: 'blue' },\n  ];\n\n  return (\n    <Card>\n      <CardHeader className=\"pb-3\">\n        <CardTitle className=\"text-base\">Retrospective Notes</CardTitle>\n      </CardHeader>\n      <CardContent className=\"space-y-4\">\n        {categories.map((category, index) => {\n          const Icon = category.icon;\n          const response = responses[index];\n          return (\n            <div key={category.label}>\n              <h4 className={`text-sm font-medium mb-2 flex items-center gap-2 text-${category.color}-600`}>\n                <Icon className=\"h-4 w-4\" />\n                {category.label}\n              </h4>\n              {response ? (\n                <p className=\"text-sm p-2 bg-muted rounded\">{response}</p>\n              ) : (\n                <p className=\"text-sm text-muted-foreground italic\">Pending...</p>\n              )}\n            </div>\n          );\n        })}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":20845,"size_tokens":null},"client/src/components/simulation/git-workflow.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  GitBranch,\n  GitCommit,\n  GitPullRequest,\n  GitMerge,\n  Terminal,\n  Lightbulb,\n  CheckCircle2,\n  XCircle,\n  AlertTriangle,\n  Copy,\n  ChevronRight,\n  Info,\n  Loader2,\n} from \"lucide-react\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\nimport {\n  createInitialState,\n  simulateGitCommand,\n  parseGitCommand,\n  getBranchNamingTips,\n  getCommitMessageTips,\n  suggestBranchName,\n  suggestCommitMessage,\n  type GitState,\n  type GitCommandResult,\n} from \"@/lib/git-simulator\";\nimport type { SprintTicket } from \"@shared/schema\";\n\ninterface GitWorkflowProps {\n  ticket: SprintTicket;\n  gitState: GitState;\n  onStateChange: (newState: GitState) => void;\n  onBranchCreate?: (branchName: string) => void;\n  onCommit?: (message: string) => void;\n  onPRCreate?: () => void;\n  onMerge?: () => void;\n  mode: 'journey' | 'practice';\n}\n\ninterface CommandHistoryEntry {\n  command: string;\n  output: string;\n  isError: boolean;\n  timestamp: Date;\n}\n\nexport default function GitWorkflow({\n  ticket,\n  gitState,\n  onStateChange,\n  onBranchCreate,\n  onCommit,\n  onPRCreate,\n  onMerge,\n  mode\n}: GitWorkflowProps) {\n  const [currentState, setCurrentState] = useState<GitState>(gitState);\n  const [currentInput, setCurrentInput] = useState(\"\");\n  const [commandHistory, setCommandHistory] = useState<CommandHistoryEntry[]>([]);\n  const [historyIndex, setHistoryIndex] = useState(-1);\n  const [showTips, setShowTips] = useState(true);\n  const [isPRLoading, setIsPRLoading] = useState(false);\n  const [isMergeLoading, setIsMergeLoading] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const scrollRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [commandHistory]);\n\n  const executeCommand = (commandInput: string) => {\n    if (!commandInput.trim()) return;\n\n    const parsed = parseGitCommand(commandInput);\n    \n    if (!parsed.command) {\n      setCommandHistory(prev => [...prev, {\n        command: commandInput,\n        output: 'Error: Not a valid git command. Commands must start with \"git\".',\n        isError: true,\n        timestamp: new Date(),\n      }]);\n      setCurrentInput(\"\");\n      inputRef.current?.focus();\n      return;\n    }\n\n    try {\n      const result = simulateGitCommand(currentState, parsed.command, parsed.args);\n      \n      setCommandHistory(prev => [...prev, {\n        command: commandInput,\n        output: result.output,\n        isError: !result.success,\n        timestamp: new Date(),\n      }]);\n\n      if (result.success && result.stateChange) {\n        const newState = { ...currentState, ...result.stateChange };\n        setCurrentState(newState);\n        onStateChange(newState);\n\n        if (commandInput.startsWith('git checkout -b') || commandInput.startsWith('git switch -c')) {\n          const branchMatch = commandInput.match(/(?:checkout -b|switch -c)\\s+(\\S+)/);\n          if (branchMatch && onBranchCreate) {\n            onBranchCreate(branchMatch[1]);\n          }\n        } else if (commandInput.startsWith('git commit')) {\n          if (onCommit) {\n            const messageMatch = commandInput.match(/-m\\s+[\"'](.+?)[\"']/);\n            onCommit(messageMatch ? messageMatch[1] : 'Commit');\n          }\n        }\n      }\n    } catch (error) {\n      setCommandHistory(prev => [...prev, {\n        command: commandInput,\n        output: `Error: An unexpected error occurred while processing the command.`,\n        isError: true,\n        timestamp: new Date(),\n      }]);\n    }\n\n    setCurrentInput(\"\");\n    setHistoryIndex(-1);\n    inputRef.current?.focus();\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === 'Enter') {\n      executeCommand(currentInput);\n    } else if (e.key === 'ArrowUp') {\n      e.preventDefault();\n      const commands = commandHistory.map(h => h.command);\n      if (historyIndex < commands.length - 1) {\n        const newIndex = historyIndex + 1;\n        setHistoryIndex(newIndex);\n        setCurrentInput(commands[commands.length - 1 - newIndex] || \"\");\n      }\n    } else if (e.key === 'ArrowDown') {\n      e.preventDefault();\n      if (historyIndex > 0) {\n        const newIndex = historyIndex - 1;\n        setHistoryIndex(newIndex);\n        const commands = commandHistory.map(h => h.command);\n        setCurrentInput(commands[commands.length - 1 - newIndex] || \"\");\n      } else if (historyIndex === 0) {\n        setHistoryIndex(-1);\n        setCurrentInput(\"\");\n      }\n    } else if (e.key === 'Tab') {\n      e.preventDefault();\n      const suggestions = getAutocompleteSuggestions(currentInput);\n      if (suggestions.length === 1) {\n        setCurrentInput(suggestions[0]);\n      }\n    }\n  };\n\n  const getAutocompleteSuggestions = (input: string): string[] => {\n    const commands = [\n      'git status',\n      'git add .',\n      'git add',\n      'git commit -m \"\"',\n      'git checkout -b',\n      'git checkout main',\n      'git switch -c',\n      'git switch main',\n      'git push origin',\n      'git pull origin main',\n      'git branch',\n      'git log --oneline',\n      'git diff',\n      'git stash',\n      'git stash pop',\n    ];\n\n    if (!input) return [];\n    return commands.filter(cmd => cmd.startsWith(input));\n  };\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text);\n  };\n\n  const handleCreatePR = async () => {\n    setIsPRLoading(true);\n    try {\n      const prTitle = `${ticket.type === 'bug' ? 'Fix' : 'Feature'}: ${ticket.title}`;\n      const newState: GitState = {\n        ...currentState,\n        remoteSyncStatus: 'synced',\n      };\n      setCurrentState(newState);\n      onStateChange(newState);\n      if (onPRCreate) onPRCreate();\n      \n      setCommandHistory(prev => [...prev, {\n        command: `[PR Created: \"${prTitle}\"]`,\n        output: `Pull request created successfully!\\nTitle: ${prTitle}\\nBranch: ${currentState.currentBranch}  main`,\n        isError: false,\n        timestamp: new Date(),\n      }]);\n    } finally {\n      setIsPRLoading(false);\n      inputRef.current?.focus();\n    }\n  };\n\n  const handleMergePR = async () => {\n    setIsMergeLoading(true);\n    try {\n      const newState: GitState = {\n        ...currentState,\n        currentBranch: 'main',\n        remoteSyncStatus: 'synced',\n      };\n      setCurrentState(newState);\n      onStateChange(newState);\n      if (onMerge) onMerge();\n      \n      setCommandHistory(prev => [...prev, {\n        command: '[PR Merged]',\n        output: `Pull request merged successfully!\\nBranch ${currentState.currentBranch} merged into main.`,\n        isError: false,\n        timestamp: new Date(),\n      }]);\n    } finally {\n      setIsMergeLoading(false);\n      inputRef.current?.focus();\n    }\n  };\n\n  const branchTips = getBranchNamingTips();\n  const commitTips = getCommitMessageTips();\n\n  const currentBranchCommits = currentState.branches.find(b => b.name === currentState.currentBranch)?.commits?.length ?? 0;\n  const hasCommits = currentBranchCommits > 0;\n  const isPushed = currentState.remoteSyncStatus === 'synced' && currentState.currentBranch !== 'main';\n  \n  const workflowStatus = {\n    branch: currentState.currentBranch !== 'main',\n    hasChanges: currentState.stagedFiles.length > 0 || currentState.modifiedFiles.length > 0,\n    committed: hasCommits,\n    pushed: isPushed,\n    prReady: isPushed && commandHistory.some(h => h.command.includes('[PR Created')),\n    merged: commandHistory.some(h => h.command.includes('[PR Merged]')),\n  };\n\n  const suggestedBranch = suggestBranchName(ticket.ticketKey, ticket.title, ticket.type);\n\n  return (\n    <div className=\"space-y-4\">\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-center justify-between\">\n            <CardTitle className=\"text-base flex items-center gap-2\">\n              <Terminal className=\"h-4 w-4\" />\n              Git Terminal\n            </CardTitle>\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={() => setShowTips(!showTips)}\n              data-testid=\"button-toggle-tips\"\n            >\n              <Lightbulb className={`h-4 w-4 ${showTips ? 'text-yellow-500' : 'text-gray-400'}`} />\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center gap-4 text-sm\">\n            <div className=\"flex items-center gap-1\">\n              <GitBranch className=\"h-4 w-4 text-purple-500\" />\n              <span className=\"font-mono\">{currentState.currentBranch}</span>\n            </div>\n            <Separator orientation=\"vertical\" className=\"h-4\" />\n            <WorkflowStatus status={workflowStatus} />\n          </div>\n\n          <div\n            ref={scrollRef}\n            className=\"bg-gray-900 text-gray-100 rounded-lg p-4 font-mono text-sm h-[300px] overflow-y-auto\"\n          >\n            <div className=\"space-y-2\">\n              <div className=\"text-green-400\">\n                Welcome to the Git simulator. Type commands to practice your workflow.\n              </div>\n              <div className=\"text-gray-500\">\n                Working on: {ticket.ticketKey} - {ticket.title}\n              </div>\n              <Separator className=\"my-2 bg-gray-700\" />\n              \n              {commandHistory.map((entry, index) => (\n                <div key={index} className=\"space-y-1\">\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-blue-400\">$</span>\n                    <span>{entry.command}</span>\n                  </div>\n                  <div className={entry.isError ? 'text-red-400' : 'text-gray-300 whitespace-pre-wrap'}>\n                    {entry.output}\n                  </div>\n                </div>\n              ))}\n              \n              <div className=\"flex items-center gap-2\">\n                <span className=\"text-blue-400\">$</span>\n                <Input\n                  ref={inputRef}\n                  value={currentInput}\n                  onChange={(e) => setCurrentInput(e.target.value)}\n                  onKeyDown={handleKeyDown}\n                  className=\"bg-transparent border-none text-white focus-visible:ring-0 p-0 h-auto font-mono\"\n                  placeholder=\"Enter git command...\"\n                  autoFocus\n                  data-testid=\"input-git-command\"\n                />\n              </div>\n            </div>\n          </div>\n\n          {showTips && (\n            <Card className=\"bg-yellow-50 border-yellow-200\">\n              <CardContent className=\"py-3\">\n                <div className=\"space-y-3\">\n                  {!workflowStatus.branch && (\n                    <TipCard\n                      title=\"Create a Branch\"\n                      suggestion={`git checkout -b ${suggestedBranch}`}\n                      explanation={branchTips.bestPractices[0] || \"Use descriptive branch names that indicate the work being done.\"}\n                      onCopy={() => copyToClipboard(`git checkout -b ${suggestedBranch}`)}\n                    />\n                  )}\n                  \n                  {workflowStatus.branch && !workflowStatus.committed && (\n                    <TipCard\n                      title=\"Stage and Commit\"\n                      suggestion={`git add . && git commit -m \"fix(${ticket.ticketKey}): ${ticket.title.slice(0, 40)}\"`}\n                      explanation={commitTips.bestPractices[0] || \"Use clear, descriptive commit messages that explain what changed.\"}\n                      onCopy={() => copyToClipboard(`git add . && git commit -m \"fix(${ticket.ticketKey}): ${ticket.title.slice(0, 40)}\"`)}\n                    />\n                  )}\n\n                  {workflowStatus.committed && !workflowStatus.pushed && (\n                    <TipCard\n                      title=\"Push Your Changes\"\n                      suggestion={`git push origin ${currentState.currentBranch}`}\n                      explanation=\"Push your commits to the remote repository before creating a PR.\"\n                      onCopy={() => copyToClipboard(`git push origin ${currentState.currentBranch}`)}\n                    />\n                  )}\n\n                  {workflowStatus.pushed && !workflowStatus.prReady && (\n                    <div className=\"flex items-start gap-2 p-2 bg-blue-100 rounded\">\n                      <Info className=\"h-4 w-4 text-blue-600 mt-0.5\" />\n                      <div className=\"text-sm\">\n                        <p className=\"font-medium text-blue-800\">Ready for PR!</p>\n                        <p className=\"text-blue-600\">\n                          Click the \"Create Pull Request\" button to open a PR for review.\n                        </p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </CardContent>\n      </Card>\n\n      <div className=\"flex gap-3\" role=\"group\" aria-label=\"Git actions\">\n        <Button\n          variant=\"outline\"\n          onClick={handleCreatePR}\n          disabled={!workflowStatus.pushed || workflowStatus.prReady || isPRLoading}\n          data-testid=\"button-create-pr\"\n          aria-label=\"Create pull request\"\n        >\n          {isPRLoading ? (\n            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n          ) : (\n            <GitPullRequest className=\"h-4 w-4 mr-2\" />\n          )}\n          Create Pull Request\n        </Button>\n\n        <Button\n          variant=\"outline\"\n          onClick={handleMergePR}\n          disabled={!workflowStatus.prReady || workflowStatus.merged || isMergeLoading}\n          data-testid=\"button-merge-pr\"\n          aria-label=\"Merge pull request\"\n        >\n          {isMergeLoading ? (\n            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n          ) : (\n            <GitMerge className=\"h-4 w-4 mr-2\" />\n          )}\n          Merge PR\n        </Button>\n      </div>\n\n      <Card>\n        <CardHeader className=\"pb-3\">\n          <CardTitle className=\"text-base\">Git Workflow Progress</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center gap-4\">\n            {Object.entries({\n              'Branch': workflowStatus.branch,\n              'Commit': workflowStatus.committed,\n              'Push': workflowStatus.pushed,\n              'PR': workflowStatus.prReady,\n              'Merge': workflowStatus.merged,\n            }).map(([label, completed], index, arr) => (\n              <div key={label} className=\"flex items-center\">\n                <div className=\"flex flex-col items-center\">\n                  <div className={`w-8 h-8 rounded-full flex items-center justify-center ${\n                    completed ? 'bg-green-100 text-green-600' : 'bg-gray-100 text-gray-400'\n                  }`}>\n                    {completed ? (\n                      <CheckCircle2 className=\"h-4 w-4\" />\n                    ) : (\n                      <span className=\"text-xs font-medium\">{index + 1}</span>\n                    )}\n                  </div>\n                  <span className={`text-xs mt-1 ${completed ? 'text-green-600' : 'text-gray-500'}`}>\n                    {label}\n                  </span>\n                </div>\n                {index < arr.length - 1 && (\n                  <div className={`w-8 h-0.5 mx-2 ${completed ? 'bg-green-300' : 'bg-gray-200'}`} />\n                )}\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n\ninterface WorkflowStatusProps {\n  status: {\n    branch: boolean;\n    hasChanges: boolean;\n    committed: boolean;\n    pushed: boolean;\n    prReady: boolean;\n    merged: boolean;\n  };\n}\n\nfunction WorkflowStatus({ status }: WorkflowStatusProps) {\n  const getStatusBadge = () => {\n    if (status.merged) return { label: 'Merged', variant: 'default' as const, color: 'bg-purple-100 text-purple-700' };\n    if (status.prReady) return { label: 'In Review', variant: 'default' as const, color: 'bg-blue-100 text-blue-700' };\n    if (status.pushed) return { label: 'Ready for PR', variant: 'default' as const, color: 'bg-yellow-100 text-yellow-700' };\n    if (status.committed) return { label: 'Changes Committed', variant: 'default' as const, color: 'bg-green-100 text-green-700' };\n    if (status.hasChanges) return { label: 'Uncommitted Changes', variant: 'default' as const, color: 'bg-orange-100 text-orange-700' };\n    if (status.branch) return { label: 'On Feature Branch', variant: 'default' as const, color: 'bg-gray-100 text-gray-700' };\n    return { label: 'On Main', variant: 'outline' as const, color: '' };\n  };\n\n  const badge = getStatusBadge();\n  return (\n    <Badge className={badge.color || undefined} variant={badge.color ? 'default' : badge.variant}>\n      {badge.label}\n    </Badge>\n  );\n}\n\ninterface TipCardProps {\n  title: string;\n  suggestion: string;\n  explanation: string;\n  onCopy: () => void;\n}\n\nfunction TipCard({ title, suggestion, explanation, onCopy }: TipCardProps) {\n  return (\n    <div className=\"space-y-1\">\n      <div className=\"flex items-center justify-between\">\n        <span className=\"text-sm font-medium text-yellow-800\">{title}</span>\n        <TooltipProvider>\n          <Tooltip>\n            <TooltipTrigger asChild>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={onCopy}\n                className=\"h-6 px-2\"\n                data-testid={`button-copy-${title.toLowerCase().replace(/\\s+/g, '-')}`}\n              >\n                <Copy className=\"h-3 w-3\" />\n              </Button>\n            </TooltipTrigger>\n            <TooltipContent>Copy command</TooltipContent>\n          </Tooltip>\n        </TooltipProvider>\n      </div>\n      <code className=\"block text-xs bg-yellow-100 p-2 rounded font-mono text-yellow-900\">\n        {suggestion}\n      </code>\n      <p className=\"text-xs text-yellow-700\">{explanation}</p>\n    </div>\n  );\n}\n","path":null,"size_bytes":18410,"size_tokens":null},"client/src/components/simulation/manager-one-on-one.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Users,\n  Clock,\n  CheckCircle2,\n  Send,\n  Target,\n  TrendingUp,\n  Lightbulb,\n  MessageSquare,\n  Award,\n  Brain,\n  ChevronRight,\n  Loader2,\n  Star,\n} from \"lucide-react\";\nimport type { UserJourney, Sprint } from \"@shared/schema\";\n\ninterface Manager {\n  name: string;\n  title: string;\n  avatar?: string;\n}\n\ninterface Message {\n  id: string;\n  speaker: 'manager' | 'user';\n  content: string;\n  timestamp: Date;\n  type: 'message' | 'question' | 'feedback' | 'action';\n}\n\ninterface ManagerOneOnOneProps {\n  journey: UserJourney;\n  sprint: Sprint;\n  manager: Manager;\n  readinessScore: number;\n  competencyScores: Record<string, { score: number; band: string }>;\n  onComplete: (outcome: any) => void;\n  mode: 'journey' | 'practice';\n}\n\nconst ONE_ON_ONE_TOPICS = [\n  {\n    id: 'progress',\n    title: 'Sprint Progress',\n    question: \"Let's start with your work this sprint. What are you most proud of accomplishing?\",\n    followUp: \"That's great to hear. Were there any challenges you faced along the way?\",\n  },\n  {\n    id: 'learning',\n    title: 'Learning & Growth',\n    question: \"What new skills have you picked up this sprint? Any areas where you felt you grew?\",\n    followUp: \"Those are valuable insights. How do you plan to build on these learnings?\",\n  },\n  {\n    id: 'blockers',\n    title: 'Challenges & Support',\n    question: \"Are there any blockers or challenges I can help you with? Anything preventing you from doing your best work?\",\n    followUp: \"I appreciate you sharing that. Let me think about how we can address this together.\",\n  },\n  {\n    id: 'goals',\n    title: 'Goals & Next Steps',\n    question: \"Looking ahead, what would you like to focus on in the next sprint? Any goals you're setting for yourself?\",\n    followUp: \"Those sound like solid goals. Let's make sure we track your progress on these.\",\n  },\n];\n\nexport default function ManagerOneOnOne({\n  journey,\n  sprint,\n  manager,\n  readinessScore,\n  competencyScores,\n  onComplete,\n  mode\n}: ManagerOneOnOneProps) {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [currentInput, setCurrentInput] = useState(\"\");\n  const [currentTopicIndex, setCurrentTopicIndex] = useState(0);\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [userResponses, setUserResponses] = useState<Record<string, string>>({});\n  const [showFollowUp, setShowFollowUp] = useState(false);\n  const scrollRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  useEffect(() => {\n    if (messages.length === 0) {\n      startSession();\n    }\n  }, []);\n\n  const startSession = () => {\n    const welcomeMessage: Message = {\n      id: `msg-${Date.now()}`,\n      speaker: 'manager',\n      content: `Hi there! Thanks for making time for our 1:1. I've been reviewing your progress this sprint, and I'm impressed with how you've been growing. Your readiness score has improved to ${readinessScore}%. Let's talk about how things are going.`,\n      timestamp: new Date(),\n      type: 'message',\n    };\n\n    setMessages([welcomeMessage]);\n\n    setTimeout(() => {\n      const firstQuestion: Message = {\n        id: `msg-${Date.now()}-q`,\n        speaker: 'manager',\n        content: ONE_ON_ONE_TOPICS[0].question,\n        timestamp: new Date(),\n        type: 'question',\n      };\n      setMessages(prev => [...prev, firstQuestion]);\n    }, 1500);\n  };\n\n  const handleSendMessage = async () => {\n    if (!currentInput.trim() || isProcessing) return;\n\n    const userMessage: Message = {\n      id: `msg-${Date.now()}`,\n      speaker: 'user',\n      content: currentInput,\n      timestamp: new Date(),\n      type: 'message',\n    };\n\n    setMessages(prev => [...prev, userMessage]);\n    \n    const currentTopic = ONE_ON_ONE_TOPICS[currentTopicIndex];\n    setUserResponses(prev => ({\n      ...prev,\n      [currentTopic.id]: currentInput,\n    }));\n    \n    setCurrentInput(\"\");\n    setIsProcessing(true);\n\n    setTimeout(() => {\n      processResponse(currentInput);\n    }, 1000);\n  };\n\n  const processResponse = (userResponse: string) => {\n    const currentTopic = ONE_ON_ONE_TOPICS[currentTopicIndex];\n\n    if (!showFollowUp) {\n      const followUpMessage: Message = {\n        id: `msg-${Date.now()}-fu`,\n        speaker: 'manager',\n        content: currentTopic.followUp,\n        timestamp: new Date(),\n        type: 'feedback',\n      };\n      setMessages(prev => [...prev, followUpMessage]);\n      setShowFollowUp(true);\n      setIsProcessing(false);\n      return;\n    }\n\n    const nextTopicIndex = currentTopicIndex + 1;\n    setShowFollowUp(false);\n\n    if (nextTopicIndex < ONE_ON_ONE_TOPICS.length) {\n      setTimeout(() => {\n        const transitionMessage: Message = {\n          id: `msg-${Date.now()}-tr`,\n          speaker: 'manager',\n          content: getTransitionMessage(nextTopicIndex),\n          timestamp: new Date(),\n          type: 'message',\n        };\n        setMessages(prev => [...prev, transitionMessage]);\n\n        setTimeout(() => {\n          const nextQuestion: Message = {\n            id: `msg-${Date.now()}-q`,\n            speaker: 'manager',\n            content: ONE_ON_ONE_TOPICS[nextTopicIndex].question,\n            timestamp: new Date(),\n            type: 'question',\n          };\n          setMessages(prev => [...prev, nextQuestion]);\n          setCurrentTopicIndex(nextTopicIndex);\n          setIsProcessing(false);\n        }, 1000);\n      }, 500);\n    } else {\n      setTimeout(() => {\n        const closingMessage: Message = {\n          id: `msg-${Date.now()}-close`,\n          speaker: 'manager',\n          content: getClosingMessage(),\n          timestamp: new Date(),\n          type: 'message',\n        };\n        setMessages(prev => [...prev, closingMessage]);\n        setCurrentTopicIndex(nextTopicIndex);\n        setIsProcessing(false);\n      }, 500);\n    }\n  };\n\n  const getTransitionMessage = (topicIndex: number): string => {\n    const transitions = [\n      \"That's really helpful context. Now let's talk about something else...\",\n      \"Great, I'm glad we discussed that. Moving on...\",\n      \"Understood. I have another topic I'd like to cover...\",\n      \"Thanks for sharing. One more thing I wanted to discuss...\",\n    ];\n    return transitions[topicIndex - 1] || transitions[0];\n  };\n\n  const getClosingMessage = (): string => {\n    const readinessMessage = readinessScore >= 85 \n      ? \"Based on your performance, I think you're very close to being ready for promotion to Junior Developer!\"\n      : readinessScore >= 70\n      ? \"You're making great progress. Keep up the momentum and you'll be ready for the next level soon.\"\n      : \"I can see you're developing well. Let's keep working on these areas and revisit in our next 1:1.\";\n\n    return `Thank you for this great conversation. I really appreciate your openness and self-reflection. ${readinessMessage} Keep up the excellent work, and don't hesitate to reach out if you need anything before our next 1:1.`;\n  };\n\n  const handleComplete = () => {\n    onComplete({\n      responses: userResponses,\n      topicsCovered: ONE_ON_ONE_TOPICS.slice(0, currentTopicIndex + 1).map(t => t.id),\n      completedAt: new Date().toISOString(),\n    });\n  };\n\n  const isComplete = currentTopicIndex >= ONE_ON_ONE_TOPICS.length && !isProcessing;\n  const progress = (currentTopicIndex / ONE_ON_ONE_TOPICS.length) * 100;\n\n  return (\n    <div className=\"max-w-5xl mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-4\">\n          <Avatar className=\"h-12 w-12\">\n            <AvatarImage src={manager.avatar} />\n            <AvatarFallback className=\"text-lg bg-purple-100 text-purple-700\">\n              {manager.name.split(' ').map(n => n[0]).join('')}\n            </AvatarFallback>\n          </Avatar>\n          <div>\n            <h2 className=\"text-xl font-semibold\">1:1 with {manager.name}</h2>\n            <p className=\"text-sm text-muted-foreground\">{manager.title}</p>\n          </div>\n        </div>\n        <Badge variant=\"outline\" className=\"text-sm\">\n          {mode === 'journey' ? 'Journey Mode' : 'Practice Mode'}\n        </Badge>\n      </div>\n\n      <div className=\"grid grid-cols-12 gap-6\">\n        <div className=\"col-span-8\">\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <div className=\"flex items-center justify-between\">\n                <CardTitle className=\"text-base\">Conversation</CardTitle>\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                  <Clock className=\"h-4 w-4\" />\n                  <span>~30 min</span>\n                </div>\n              </div>\n              <div className=\"mt-2\">\n                <div className=\"flex justify-between text-sm mb-1\">\n                  <span className=\"text-muted-foreground\">Topics Covered</span>\n                  <span>{Math.min(currentTopicIndex + 1, ONE_ON_ONE_TOPICS.length)} / {ONE_ON_ONE_TOPICS.length}</span>\n                </div>\n                <Progress value={progress} />\n              </div>\n            </CardHeader>\n            <CardContent className=\"p-0\">\n              <ScrollArea className=\"h-[400px] p-4\" ref={scrollRef}>\n                <div className=\"space-y-4\">\n                  {messages.map((message) => (\n                    <MessageBubble \n                      key={message.id} \n                      message={message} \n                      manager={manager}\n                    />\n                  ))}\n                  \n                  {isProcessing && (\n                    <div className=\"flex items-center gap-2 text-muted-foreground\">\n                      <Loader2 className=\"h-4 w-4 animate-spin\" />\n                      <span className=\"text-sm\">{manager.name.split(' ')[0]} is typing...</span>\n                    </div>\n                  )}\n                </div>\n              </ScrollArea>\n\n              <Separator />\n\n              <div className=\"p-4\">\n                {!isComplete ? (\n                  <div className=\"flex gap-2\">\n                    <Textarea\n                      value={currentInput}\n                      onChange={(e) => setCurrentInput(e.target.value)}\n                      placeholder=\"Share your thoughts...\"\n                      className=\"min-h-[80px] resize-none\"\n                      disabled={isProcessing}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter' && !e.shiftKey) {\n                          e.preventDefault();\n                          handleSendMessage();\n                        }\n                      }}\n                      data-testid=\"input-one-on-one-response\"\n                    />\n                    <Button\n                      onClick={handleSendMessage}\n                      disabled={!currentInput.trim() || isProcessing}\n                      className=\"self-end\"\n                      data-testid=\"button-send-one-on-one\"\n                    >\n                      <Send className=\"h-4 w-4\" />\n                    </Button>\n                  </div>\n                ) : (\n                  <div className=\"flex items-center justify-between p-4 bg-purple-50 rounded-lg\">\n                    <div className=\"flex items-center gap-2\">\n                      <CheckCircle2 className=\"h-5 w-5 text-purple-600\" />\n                      <span className=\"font-medium text-purple-800\">\n                        Great 1:1 session!\n                      </span>\n                    </div>\n                    <Button onClick={handleComplete} data-testid=\"button-complete-one-on-one\">\n                      Complete Session\n                      <ChevronRight className=\"h-4 w-4 ml-2\" />\n                    </Button>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n\n        <div className=\"col-span-4 space-y-4\">\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <TrendingUp className=\"h-4 w-4\" />\n                Your Progress\n              </CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <div className=\"text-center p-4 bg-gradient-to-br from-purple-50 to-blue-50 rounded-lg\">\n                <div className=\"text-3xl font-bold text-purple-600\">{readinessScore}%</div>\n                <div className=\"text-sm text-muted-foreground\">Readiness Score</div>\n              </div>\n\n              <Separator />\n\n              <div>\n                <h4 className=\"text-sm font-medium mb-2\">Competency Highlights</h4>\n                <div className=\"space-y-2\">\n                  {Object.entries(competencyScores).slice(0, 4).map(([key, value]) => (\n                    <div key={key} className=\"flex items-center justify-between text-sm\">\n                      <span className=\"capitalize\">{key.replace(/_/g, ' ')}</span>\n                      <Badge variant={value.band === 'junior_ready' ? 'default' : 'secondary'}>\n                        {value.band.replace(/_/g, ' ')}\n                      </Badge>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader className=\"pb-3\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4\" />\n                Discussion Topics\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {ONE_ON_ONE_TOPICS.map((topic, index) => (\n                  <div\n                    key={topic.id}\n                    className={`flex items-center gap-2 p-2 rounded text-sm ${\n                      index < currentTopicIndex\n                        ? 'bg-green-50 text-green-700'\n                        : index === currentTopicIndex\n                        ? 'bg-purple-50 text-purple-700'\n                        : 'bg-gray-50 text-gray-500'\n                    }`}\n                  >\n                    {index < currentTopicIndex ? (\n                      <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                    ) : index === currentTopicIndex ? (\n                      <div className=\"h-4 w-4 rounded-full bg-purple-500 animate-pulse\" />\n                    ) : (\n                      <div className=\"h-4 w-4 rounded-full bg-gray-300\" />\n                    )}\n                    <span>{topic.title}</span>\n                  </div>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card className=\"bg-gradient-to-br from-yellow-50 to-orange-50 border-yellow-200\">\n            <CardContent className=\"pt-4\">\n              <div className=\"flex items-start gap-2\">\n                <Lightbulb className=\"h-5 w-5 text-yellow-600 mt-0.5\" />\n                <div>\n                  <h4 className=\"text-sm font-medium text-yellow-800\">Tips for 1:1s</h4>\n                  <ul className=\"text-xs text-yellow-700 mt-1 space-y-1\">\n                    <li> Be honest and open about challenges</li>\n                    <li> Come prepared with specific examples</li>\n                    <li> Ask for specific feedback</li>\n                    <li> Take notes on action items</li>\n                  </ul>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n\ninterface MessageBubbleProps {\n  message: Message;\n  manager: Manager;\n}\n\nfunction MessageBubble({ message, manager }: MessageBubbleProps) {\n  const isUser = message.speaker === 'user';\n\n  return (\n    <div className={`flex gap-3 ${isUser ? 'flex-row-reverse' : ''}`}>\n      {!isUser && (\n        <Avatar className=\"h-8 w-8\">\n          <AvatarImage src={manager.avatar} />\n          <AvatarFallback className=\"text-xs bg-purple-100 text-purple-700\">\n            {manager.name.split(' ').map(n => n[0]).join('')}\n          </AvatarFallback>\n        </Avatar>\n      )}\n      \n      <div className={`flex-1 max-w-[80%] ${isUser ? 'text-right' : ''}`}>\n        {!isUser && (\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"text-sm font-medium\">{manager.name}</span>\n          </div>\n        )}\n        <div\n          className={`inline-block p-3 rounded-lg ${\n            isUser\n              ? 'bg-purple-600 text-white'\n              : message.type === 'question'\n              ? 'bg-yellow-50 border border-yellow-200'\n              : message.type === 'feedback'\n              ? 'bg-green-50 border border-green-200'\n              : 'bg-gray-100'\n          }`}\n        >\n          <p className=\"text-sm whitespace-pre-wrap\">{message.content}</p>\n        </div>\n        <p className=\"text-xs text-muted-foreground mt-1\">\n          {message.timestamp.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n        </p>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":17610,"size_tokens":null},"client/src/pages/workspace-dashboard.tsx":{"content":"import { useParams, Link, useLocation } from \"wouter\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { \n  ArrowRight, \n  Building2, \n  Briefcase, \n  CheckCircle2, \n  Clock, \n  Play,\n  ChevronLeft,\n  Lightbulb,\n} from \"lucide-react\";\nimport { PhaseStepper, MiniPhaseStepper, type WorkspacePhase } from \"@/components/workspace/phase-stepper\";\nimport { useWorkspaceState, useAdvanceWorkspacePhase } from \"@/hooks/use-sprint-workflow\";\nimport { useToast } from \"@/hooks/use-toast\";\n\nfunction getPhaseColor(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': return 'border-teal-500 bg-teal-50 dark:bg-teal-950';\n    case 'planning': return 'border-indigo-500 bg-indigo-50 dark:bg-indigo-950';\n    case 'execution': return 'border-blue-500 bg-blue-50 dark:bg-blue-950';\n    case 'review': return 'border-amber-500 bg-amber-50 dark:bg-amber-950';\n    case 'retro': return 'border-violet-500 bg-violet-50 dark:bg-violet-950';\n    default: return 'border-gray-500 bg-gray-50';\n  }\n}\n\nfunction getPhaseLabel(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': return 'Onboarding';\n    case 'planning': return 'Sprint Planning';\n    case 'execution': return 'Sprint Execution';\n    case 'review': return 'Sprint Review';\n    case 'retro': return 'Sprint Retrospective';\n    default: return phase;\n  }\n}\n\nfunction getPhaseTip(phase: WorkspacePhase): string {\n  switch (phase) {\n    case 'onboarding': \n      return \"Welcome! Start by meeting your team and reviewing the company documentation. Take your time to understand how things work.\";\n    case 'planning': \n      return \"Review the product backlog with your team. Select priority items and agree on a sprint goal. Commit to a realistic scope.\";\n    case 'execution': \n      return \"Focus on completing your assigned tickets. Attend daily standups and don't hesitate to ask for help when stuck.\";\n    case 'review': \n      return \"Prepare to demo your completed work. Gather feedback from stakeholders and celebrate what you've accomplished!\";\n    case 'retro': \n      return \"Reflect on the sprint honestly. Share what went well, identify improvements, and commit to actionable changes for next time.\";\n    default: \n      return \"\";\n  }\n}\n\nexport default function WorkspaceDashboard() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n  const advancePhase = useAdvanceWorkspacePhase();\n\n  const handleAdvancePhase = async () => {\n    if (!workspaceId) return;\n    \n    try {\n      await advancePhase.mutateAsync({ workspaceId });\n      toast({\n        title: \"Phase Advanced\",\n        description: \"Moving to the next phase of your workspace journey.\",\n      });\n    } catch {\n      toast({\n        title: \"Error\",\n        description: \"Failed to advance phase. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-6xl mx-auto p-6 space-y-6\" data-testid=\"workspace-dashboard-loading\">\n        <Skeleton className=\"h-8 w-64\" />\n        <Skeleton className=\"h-32 w-full\" />\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n          <Skeleton className=\"h-64 lg:col-span-2\" />\n          <Skeleton className=\"h-64\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !state) {\n    return (\n      <div className=\"container max-w-6xl mx-auto p-6\" data-testid=\"workspace-dashboard-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Workspace</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/journey\">\n              <Button variant=\"outline\" className=\"gap-2\">\n                <ChevronLeft className=\"h-4 w-4\" />\n                Back to Journey\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace, currentPhase, currentSprint, phaseChecklist, nextActions, phaseHistory } = state;\n  const primaryAction = nextActions.find(a => a.priority === 'primary');\n  const secondaryActions = nextActions.filter(a => a.priority === 'secondary');\n  const completedItems = phaseChecklist.filter(item => item.completed).length;\n  const requiredItems = phaseChecklist.filter(item => item.required);\n  const allRequiredCompleted = requiredItems.every(item => item.completed);\n\n  return (\n    <div className=\"container max-w-6xl mx-auto p-6 space-y-6\" data-testid=\"workspace-dashboard\">\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div className=\"flex items-center gap-4\">\n          <Link href={`/journey/${workspace.journeyId}`}>\n            <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid=\"button-back-journey\">\n              <ChevronLeft className=\"h-4 w-4\" />\n              Journey\n            </Button>\n          </Link>\n          <div>\n            <h1 className=\"text-2xl font-bold tracking-tight flex items-center gap-2\" data-testid=\"text-workspace-title\">\n              <Building2 className=\"h-6 w-6\" />\n              {workspace.companyName}\n            </h1>\n            <p className=\"text-muted-foreground flex items-center gap-2 mt-1\">\n              <Briefcase className=\"h-4 w-4\" />\n              <span data-testid=\"text-workspace-role\">{workspace.role}</span>\n            </p>\n          </div>\n        </div>\n        \n        {primaryAction && (\n          <Link href={primaryAction.route}>\n            <Button size=\"lg\" className=\"gap-2\" data-testid=\"button-primary-action\">\n              <Play className=\"h-4 w-4\" />\n              {primaryAction.action}\n              <ArrowRight className=\"h-4 w-4\" />\n            </Button>\n          </Link>\n        )}\n      </div>\n\n      <Card className=\"border-t-4 border-t-primary\" data-testid=\"card-phase-stepper\">\n        <CardHeader className=\"pb-2\">\n          <CardTitle className=\"text-lg\">Your Progress</CardTitle>\n          <CardDescription>\n            Follow the Scrum workflow phases to complete your journey\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <PhaseStepper \n            currentPhase={currentPhase}\n            workspaceId={workspace.id}\n            sprintId={workspace.currentSprintId}\n            size=\"md\"\n            showLabels={true}\n            interactive={true}\n          />\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        <Card \n          className={`lg:col-span-2 border-l-4 ${getPhaseColor(currentPhase)}`}\n          data-testid=\"card-current-phase\"\n        >\n          <CardHeader>\n            <div className=\"flex justify-between items-start\">\n              <div>\n                <Badge \n                  variant=\"outline\" \n                  className=\"mb-2\"\n                  data-testid=\"badge-phase\"\n                >\n                  Current Phase\n                </Badge>\n                <CardTitle className=\"text-xl\" data-testid=\"text-phase-title\">\n                  {getPhaseLabel(currentPhase)}\n                </CardTitle>\n              </div>\n              <MiniPhaseStepper currentPhase={currentPhase} />\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"p-4 rounded-lg bg-muted/50 flex gap-3\" data-testid=\"phase-tip\">\n              <Lightbulb className=\"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5\" />\n              <p className=\"text-sm text-muted-foreground\">\n                {getPhaseTip(currentPhase)}\n              </p>\n            </div>\n\n            <div>\n              <h4 className=\"font-medium mb-3 flex items-center gap-2\">\n                <CheckCircle2 className=\"h-4 w-4\" />\n                Phase Checklist\n                <span className=\"text-sm text-muted-foreground font-normal\">\n                  ({completedItems}/{phaseChecklist.length} completed)\n                </span>\n              </h4>\n              <div className=\"space-y-2\">\n                {phaseChecklist.map((item, index) => (\n                  <div \n                    key={index}\n                    className=\"flex items-center gap-3 p-3 rounded-lg bg-background border\"\n                    data-testid={`checklist-item-${index}`}\n                  >\n                    <Checkbox \n                      checked={item.completed}\n                      disabled\n                      className=\"data-[state=checked]:bg-green-500 data-[state=checked]:border-green-500\"\n                    />\n                    <span className={item.completed ? \"line-through text-muted-foreground\" : \"\"}>\n                      {item.item}\n                    </span>\n                    {item.required && !item.completed && (\n                      <Badge variant=\"outline\" className=\"ml-auto text-xs\">\n                        Required\n                      </Badge>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {secondaryActions.length > 0 && (\n              <>\n                <Separator />\n                <div>\n                  <h4 className=\"font-medium mb-3\">Quick Actions</h4>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {secondaryActions.map((action, index) => (\n                      <Link key={index} href={action.route}>\n                        <Button variant=\"outline\" size=\"sm\" data-testid={`button-action-${index}`}>\n                          {action.action}\n                        </Button>\n                      </Link>\n                    ))}\n                  </div>\n                </div>\n              </>\n            )}\n          </CardContent>\n        </Card>\n\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-sprint-info\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Sprint Status\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {currentSprint ? (\n                <div className=\"space-y-2\">\n                  <p className=\"font-medium\" data-testid=\"text-sprint-theme\">\n                    {currentSprint.theme}\n                  </p>\n                  <p className=\"text-sm text-muted-foreground\" data-testid=\"text-sprint-goal\">\n                    {currentSprint.goal}\n                  </p>\n                  <div className=\"flex items-center gap-2 text-sm text-muted-foreground mt-3\">\n                    <Clock className=\"h-4 w-4\" />\n                    <span>Sprint {currentSprint.sprintNumber}</span>\n                  </div>\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground\">\n                  No active sprint. Complete {currentPhase === 'onboarding' ? 'onboarding' : 'planning'} to start a sprint.\n                </p>\n              )}\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-phase-history\">\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-sm font-medium text-muted-foreground\">\n                Recent Activity\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              {phaseHistory.length > 0 ? (\n                <div className=\"space-y-3\">\n                  {phaseHistory.slice(0, 5).map((event, index) => (\n                    <div \n                      key={event.id}\n                      className=\"flex items-start gap-2 text-sm\"\n                      data-testid={`history-item-${index}`}\n                    >\n                      <div className={`w-2 h-2 rounded-full mt-1.5 ${\n                        event.status === 'completed' ? 'bg-green-500' : 'bg-blue-500'\n                      }`} />\n                      <div>\n                        <p className=\"font-medium capitalize\">\n                          {event.phase.replace('_', ' ')} {event.status}\n                        </p>\n                        <p className=\"text-xs text-muted-foreground\">\n                          {new Date(event.createdAt).toLocaleDateString()}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <p className=\"text-sm text-muted-foreground\">\n                  No activity yet. Get started with your workspace!\n                </p>\n              )}\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":13223,"size_tokens":null},"client/src/components/workspace/phase-stepper.tsx":{"content":"import { Link } from \"wouter\";\nimport { Check, ChevronRight, Circle, Play, Users, Repeat, MessageSquare, Target } from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\nexport type WorkspacePhase = 'onboarding' | 'planning' | 'execution' | 'review' | 'retro';\n\ninterface PhaseStep {\n  id: WorkspacePhase;\n  label: string;\n  description: string;\n  icon: typeof Check;\n}\n\nconst PHASE_STEPS: PhaseStep[] = [\n  { id: 'onboarding', label: 'Onboarding', description: 'Meet the team & get set up', icon: Users },\n  { id: 'planning', label: 'Planning', description: 'Define sprint scope', icon: Target },\n  { id: 'execution', label: 'Execution', description: 'Complete sprint work', icon: Play },\n  { id: 'review', label: 'Review', description: 'Demo completed work', icon: MessageSquare },\n  { id: 'retro', label: 'Retrospective', description: 'Reflect & improve', icon: Repeat },\n];\n\nfunction getPhaseIndex(phase: WorkspacePhase): number {\n  return PHASE_STEPS.findIndex(s => s.id === phase);\n}\n\nfunction getPhaseColor(phase: WorkspacePhase, isActive: boolean, isCompleted: boolean): string {\n  if (isCompleted) return 'bg-green-500 text-white';\n  if (!isActive) return 'bg-muted text-muted-foreground';\n  \n  switch (phase) {\n    case 'onboarding': return 'bg-teal-500 text-white';\n    case 'planning': return 'bg-indigo-500 text-white';\n    case 'execution': return 'bg-blue-500 text-white';\n    case 'review': return 'bg-amber-500 text-white';\n    case 'retro': return 'bg-violet-500 text-white';\n    default: return 'bg-primary text-primary-foreground';\n  }\n}\n\nfunction getConnectorColor(currentPhaseIndex: number, stepIndex: number): string {\n  if (stepIndex < currentPhaseIndex) return 'bg-green-500';\n  return 'bg-muted';\n}\n\ninterface PhaseStepperProps {\n  currentPhase: WorkspacePhase;\n  completedPhases?: WorkspacePhase[];\n  workspaceId: number;\n  sprintId?: number | null;\n  orientation?: 'horizontal' | 'vertical';\n  size?: 'sm' | 'md' | 'lg';\n  showLabels?: boolean;\n  interactive?: boolean;\n}\n\nexport function PhaseStepper({\n  currentPhase,\n  completedPhases = [],\n  workspaceId,\n  sprintId,\n  orientation = 'horizontal',\n  size = 'md',\n  showLabels = true,\n  interactive = false,\n}: PhaseStepperProps) {\n  const currentIndex = getPhaseIndex(currentPhase);\n  \n  const isVertical = orientation === 'vertical';\n  \n  const iconSizes = {\n    sm: 'h-4 w-4',\n    md: 'h-5 w-5',\n    lg: 'h-6 w-6',\n  };\n  \n  const circleSizes = {\n    sm: 'h-8 w-8',\n    md: 'h-10 w-10',\n    lg: 'h-12 w-12',\n  };\n  \n  const getPhaseRoute = (phase: WorkspacePhase): string | null => {\n    if (!interactive) return null;\n    \n    switch (phase) {\n      case 'onboarding':\n        return `/workspace/${workspaceId}/onboarding`;\n      case 'planning':\n        return `/workspace/${workspaceId}/planning`;\n      case 'execution':\n        return sprintId ? `/sprint/${sprintId}` : null;\n      case 'review':\n        return `/workspace/${workspaceId}/review`;\n      case 'retro':\n        return `/workspace/${workspaceId}/retro`;\n      default:\n        return null;\n    }\n  };\n  \n  return (\n    <div \n      className={cn(\n        \"flex\",\n        isVertical ? \"flex-col space-y-0\" : \"flex-row items-start justify-between\",\n        \"w-full\"\n      )}\n      data-testid=\"phase-stepper\"\n    >\n      {PHASE_STEPS.map((step, index) => {\n        const isActive = step.id === currentPhase;\n        const isCompleted = completedPhases.includes(step.id) || index < currentIndex;\n        const Icon = isCompleted ? Check : step.icon;\n        const route = getPhaseRoute(step.id);\n        \n        const stepContent = (\n          <div \n            className={cn(\n              \"flex\",\n              isVertical ? \"flex-row items-start gap-4\" : \"flex-col items-center\",\n              interactive && route && \"cursor-pointer\"\n            )}\n          >\n            <div \n              className={cn(\n                \"flex items-center justify-center rounded-full transition-colors\",\n                circleSizes[size],\n                getPhaseColor(step.id, isActive, isCompleted),\n                isActive && \"ring-2 ring-offset-2 ring-offset-background\",\n                isActive && step.id === 'onboarding' && \"ring-teal-500\",\n                isActive && step.id === 'planning' && \"ring-indigo-500\",\n                isActive && step.id === 'execution' && \"ring-blue-500\",\n                isActive && step.id === 'review' && \"ring-amber-500\",\n                isActive && step.id === 'retro' && \"ring-violet-500\"\n              )}\n              data-testid={`phase-step-icon-${step.id}`}\n            >\n              <Icon className={iconSizes[size]} />\n            </div>\n            \n            {showLabels && (\n              <div className={cn(\n                isVertical ? \"pt-0\" : \"mt-2 text-center\",\n                \"space-y-0.5\"\n              )}>\n                <p \n                  className={cn(\n                    \"font-medium leading-none\",\n                    size === 'sm' && \"text-xs\",\n                    size === 'md' && \"text-sm\",\n                    size === 'lg' && \"text-base\",\n                    isActive ? \"text-foreground\" : \"text-muted-foreground\"\n                  )}\n                  data-testid={`phase-step-label-${step.id}`}\n                >\n                  {step.label}\n                </p>\n                {size !== 'sm' && (\n                  <p \n                    className={cn(\n                      \"text-muted-foreground\",\n                      size === 'md' && \"text-xs\",\n                      size === 'lg' && \"text-sm\"\n                    )}\n                  >\n                    {step.description}\n                  </p>\n                )}\n              </div>\n            )}\n          </div>\n        );\n        \n        return (\n          <div \n            key={step.id}\n            className={cn(\n              \"flex\",\n              isVertical ? \"flex-row\" : \"flex-col items-center flex-1\",\n              index === PHASE_STEPS.length - 1 && !isVertical && \"flex-initial\"\n            )}\n          >\n            {interactive && route ? (\n              <Link href={route} className=\"hover:opacity-80 transition-opacity\">\n                {stepContent}\n              </Link>\n            ) : (\n              stepContent\n            )}\n            \n            {index < PHASE_STEPS.length - 1 && (\n              isVertical ? (\n                <div className=\"flex flex-col items-center ml-4\">\n                  <div \n                    className={cn(\n                      \"w-0.5 h-8\",\n                      getConnectorColor(currentIndex, index)\n                    )} \n                  />\n                </div>\n              ) : (\n                <div className={cn(\n                  \"hidden md:flex items-center flex-1 mx-2\",\n                  \"mt-5\"\n                )}>\n                  <div \n                    className={cn(\n                      \"flex-1 h-0.5\",\n                      getConnectorColor(currentIndex, index)\n                    )} \n                  />\n                  <ChevronRight \n                    className={cn(\n                      \"h-4 w-4 mx-1\",\n                      index < currentIndex ? \"text-green-500\" : \"text-muted-foreground\"\n                    )} \n                  />\n                  <div \n                    className={cn(\n                      \"flex-1 h-0.5\",\n                      getConnectorColor(currentIndex, index)\n                    )} \n                  />\n                </div>\n              )\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\ninterface MiniPhaseStepperProps {\n  currentPhase: WorkspacePhase;\n}\n\nexport function MiniPhaseStepper({ currentPhase }: MiniPhaseStepperProps) {\n  const currentIndex = getPhaseIndex(currentPhase);\n  \n  return (\n    <div className=\"flex items-center gap-1\" data-testid=\"mini-phase-stepper\">\n      {PHASE_STEPS.map((step, index) => (\n        <div key={step.id} className=\"flex items-center\">\n          {index > 0 && (\n            <div \n              className={cn(\n                \"w-3 h-0.5 mx-0.5\",\n                index <= currentIndex ? getConnectorColor(currentIndex, index - 1) : \"bg-muted\"\n              )} \n            />\n          )}\n          <div \n            className={cn(\n              \"w-2 h-2 rounded-full transition-colors\",\n              index === currentIndex \n                ? getPhaseColor(step.id, true, false)\n                : index < currentIndex\n                ? \"bg-green-500\"\n                : \"bg-muted\"\n            )}\n            title={step.label}\n          />\n        </div>\n      ))}\n    </div>\n  );\n}\n","path":null,"size_bytes":8575,"size_tokens":null},"client/src/pages/workspace-execution.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { ExecutionModule } from \"@/components/workspace/execution-module\";\nimport { PhaseGuard } from \"@/components/workspace/phase-guard\";\nimport { useWorkspaceState } from \"@/hooks/use-sprint-workflow\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function WorkspaceExecution() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-7xl mx-auto p-6 space-y-6\" data-testid=\"workspace-execution-loading\">\n        <Skeleton className=\"h-8 w-48\" />\n        <div className=\"grid grid-cols-4 gap-4\">\n          <Skeleton className=\"h-24\" />\n          <Skeleton className=\"h-24\" />\n          <Skeleton className=\"h-24\" />\n          <Skeleton className=\"h-24\" />\n        </div>\n        <div className=\"grid grid-cols-4 gap-4\">\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n          <Skeleton className=\"h-96\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !state || !workspaceId) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-execution-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Execution</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\"\n              onClick={() => navigate('/journey')}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              Back to Journey\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace } = state;\n\n  const handleComplete = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  const handleBack = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  return (\n    <PhaseGuard\n      currentPhase={workspace.currentPhase}\n      requiredPhase=\"execution\"\n      workspaceId={workspaceId}\n      onNavigate={navigate}\n    >\n      <div className=\"container max-w-7xl mx-auto p-6\" data-testid=\"workspace-execution\">\n        <ExecutionModule\n          workspaceId={workspaceId}\n          userId={workspace.userId}\n          journeyId={workspace.journeyId}\n          companyName={workspace.companyName}\n          role={workspace.role}\n          onComplete={handleComplete}\n          onBack={handleBack}\n        />\n      </div>\n    </PhaseGuard>\n  );\n}\n","path":null,"size_bytes":3067,"size_tokens":null},"client/src/components/workspace/phase-guard.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Lock, ChevronLeft, CheckCircle2 } from \"lucide-react\";\nimport type { WorkspacePhase } from \"@/hooks/use-sprint-workflow\";\n\nconst PHASE_ORDER: WorkspacePhase[] = ['onboarding', 'planning', 'execution', 'review', 'retro'];\n\nconst PHASE_NAMES: Record<WorkspacePhase, string> = {\n  onboarding: 'Onboarding',\n  planning: 'Sprint Planning',\n  execution: 'Sprint Execution',\n  review: 'Sprint Review',\n  retro: 'Sprint Retrospective'\n};\n\ninterface PhaseGuardProps {\n  currentPhase: WorkspacePhase;\n  requiredPhase: WorkspacePhase;\n  workspaceId: number;\n  onNavigate: (path: string) => void;\n  children: React.ReactNode;\n}\n\nexport function PhaseGuard({ \n  currentPhase, \n  requiredPhase, \n  workspaceId,\n  onNavigate,\n  children \n}: PhaseGuardProps) {\n  const currentIndex = PHASE_ORDER.indexOf(currentPhase);\n  const requiredIndex = PHASE_ORDER.indexOf(requiredPhase);\n\n  if (currentPhase === requiredPhase) {\n    return <>{children}</>;\n  }\n\n  if (currentIndex < requiredIndex) {\n    return (\n      <div className=\"container max-w-2xl mx-auto p-6\" data-testid=\"phase-locked\">\n        <Card className=\"border-amber-200 dark:border-amber-800 bg-amber-50/50 dark:bg-amber-950/50\">\n          <CardHeader className=\"text-center\">\n            <div className=\"h-16 w-16 rounded-full bg-amber-100 dark:bg-amber-800 flex items-center justify-center mx-auto mb-4\">\n              <Lock className=\"h-8 w-8 text-amber-600 dark:text-amber-300\" />\n            </div>\n            <CardTitle className=\"text-xl\">Phase Locked</CardTitle>\n            <CardDescription className=\"text-base\">\n              You need to complete earlier phases to unlock {PHASE_NAMES[requiredPhase]}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"p-4 bg-background rounded-lg border\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-muted-foreground\">Current Phase</p>\n                  <p className=\"font-medium\">{PHASE_NAMES[currentPhase]}</p>\n                </div>\n                <Badge variant=\"outline\" className=\"text-amber-600 border-amber-300\">\n                  In Progress\n                </Badge>\n              </div>\n            </div>\n            \n            <div className=\"flex justify-center gap-3\">\n              <Button \n                variant=\"outline\" \n                onClick={() => onNavigate(`/workspace/${workspaceId}`)}\n                data-testid=\"button-back-to-dashboard\"\n              >\n                <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                Back to Dashboard\n              </Button>\n              <Button \n                onClick={() => onNavigate(`/workspace/${workspaceId}/${currentPhase}`)}\n                data-testid=\"button-continue-current-phase\"\n              >\n                Continue {PHASE_NAMES[currentPhase]}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container max-w-2xl mx-auto p-6\" data-testid=\"phase-completed\">\n      <Card className=\"border-green-200 dark:border-green-800 bg-green-50/50 dark:bg-green-950/50\">\n        <CardHeader className=\"text-center\">\n          <div className=\"h-16 w-16 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center mx-auto mb-4\">\n            <CheckCircle2 className=\"h-8 w-8 text-green-600 dark:text-green-300\" />\n          </div>\n          <CardTitle className=\"text-xl\">Phase Completed</CardTitle>\n          <CardDescription className=\"text-base\">\n            You've already completed {PHASE_NAMES[requiredPhase]}\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"p-4 bg-background rounded-lg border\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm text-muted-foreground\">Current Phase</p>\n                <p className=\"font-medium\">{PHASE_NAMES[currentPhase]}</p>\n              </div>\n              <Badge variant=\"outline\" className=\"text-green-600 border-green-300\">\n                Available\n              </Badge>\n            </div>\n          </div>\n          \n          <div className=\"flex justify-center gap-3\">\n            <Button \n              variant=\"outline\" \n              onClick={() => onNavigate(`/workspace/${workspaceId}`)}\n              data-testid=\"button-back-to-dashboard\"\n            >\n              <ChevronLeft className=\"h-4 w-4 mr-2\" />\n              Back to Dashboard\n            </Button>\n            <Button \n              onClick={() => onNavigate(`/workspace/${workspaceId}/${currentPhase}`)}\n              data-testid=\"button-continue-current-phase\"\n            >\n              Continue {PHASE_NAMES[currentPhase]}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":5140,"size_tokens":null},"client/src/components/workspace/execution-module.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  ArrowLeft,\n  GitBranch, \n  GitPullRequest,\n  CheckCircle2, \n  Clock, \n  Target,\n  Users,\n  Play,\n  AlertCircle,\n  ChevronRight,\n  Code,\n  Bug,\n  Star,\n  Wrench,\n  Send,\n  MessageSquare,\n  Trophy\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { WorkspacePhase } from \"@/hooks/use-sprint-workflow\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface SprintItem {\n  id: string;\n  title: string;\n  type: 'bug' | 'feature' | 'improvement';\n  priority: 'high' | 'medium' | 'low';\n  points: number;\n  description: string;\n  status: 'todo' | 'in_progress' | 'in_review' | 'done';\n  branchCreated?: boolean;\n  prCreated?: boolean;\n  merged?: boolean;\n}\n\ninterface ExecutionModuleProps {\n  workspaceId: number;\n  userId: number;\n  journeyId?: number;\n  companyName: string;\n  role: string;\n  sprintGoal?: string;\n  selectedItems?: string[];\n  onComplete: () => void;\n  onBack?: () => void;\n}\n\nconst SPRINT_ITEMS: SprintItem[] = [\n  {\n    id: \"TICKET-101\",\n    title: \"Fix timezone display in transaction history\",\n    type: \"bug\",\n    priority: \"high\",\n    points: 3,\n    description: \"Transactions are showing in UTC instead of merchant's local timezone\",\n    status: \"todo\"\n  },\n  {\n    id: \"TICKET-102\",\n    title: \"Add export to CSV functionality\",\n    type: \"feature\",\n    priority: \"medium\",\n    points: 5,\n    description: \"Allow merchants to export their transaction data to CSV format\",\n    status: \"todo\"\n  },\n  {\n    id: \"TICKET-103\",\n    title: \"Improve dashboard load time\",\n    type: \"improvement\",\n    priority: \"medium\",\n    points: 8,\n    description: \"Optimize queries and add caching to reduce dashboard load time\",\n    status: \"todo\"\n  },\n  {\n    id: \"TICKET-104\",\n    title: \"Fix refund calculation rounding error\",\n    type: \"bug\",\n    priority: \"high\",\n    points: 2,\n    description: \"Partial refunds sometimes show incorrect amounts due to floating point errors\",\n    status: \"todo\"\n  }\n];\n\nfunction getTypeIcon(type: SprintItem['type']) {\n  switch (type) {\n    case 'bug': return Bug;\n    case 'feature': return Star;\n    case 'improvement': return Wrench;\n    default: return Code;\n  }\n}\n\nfunction getTypeColor(type: SprintItem['type']) {\n  switch (type) {\n    case 'bug': return 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300';\n    case 'feature': return 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300';\n    case 'improvement': return 'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300';\n    default: return 'bg-gray-100 text-gray-700';\n  }\n}\n\ntype TicketStatus = 'todo' | 'in_progress' | 'in_review' | 'done';\n\nfunction TicketCard({ \n  item, \n  onSelect,\n  onMove\n}: { \n  item: SprintItem;\n  onSelect: (item: SprintItem) => void;\n  onMove: (itemId: string, newStatus: TicketStatus) => void;\n}) {\n  const Icon = getTypeIcon(item.type);\n  \n  const priorityColors = {\n    high: 'bg-red-500',\n    medium: 'bg-amber-500',\n    low: 'bg-gray-400',\n  };\n\n  const handleDragStart = (e: React.DragEvent) => {\n    e.dataTransfer.setData('itemId', item.id);\n  };\n\n  return (\n    <Card \n      className=\"cursor-pointer hover:shadow-md transition-shadow\"\n      onClick={() => onSelect(item)}\n      draggable\n      onDragStart={handleDragStart}\n      data-testid={`card-ticket-${item.id}`}\n    >\n      <CardContent className=\"p-3 space-y-2\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <Badge variant=\"outline\" className=\"text-xs font-mono\">\n            {item.id}\n          </Badge>\n          <div \n            className={`h-2 w-2 rounded-full ${priorityColors[item.priority]}`}\n            title={`Priority: ${item.priority}`}\n          />\n        </div>\n        \n        <p className=\"text-sm font-medium line-clamp-2\">{item.title}</p>\n        \n        <div className=\"flex items-center justify-between text-xs text-muted-foreground\">\n          <div className=\"flex items-center gap-2\">\n            <Badge variant=\"secondary\" className=\"text-xs\">\n              {item.points} pts\n            </Badge>\n            <Badge className={cn(\"text-xs\", getTypeColor(item.type))} variant=\"secondary\">\n              <Icon className=\"h-3 w-3 mr-1\" />\n              {item.type}\n            </Badge>\n          </div>\n          \n          <div className=\"flex items-center gap-1\">\n            {item.branchCreated && (\n              <GitBranch className=\"h-3 w-3 text-blue-500\" />\n            )}\n            {item.prCreated && (\n              <GitPullRequest className=\"h-3 w-3 text-purple-500\" />\n            )}\n            {item.merged && (\n              <CheckCircle2 className=\"h-3 w-3 text-green-500\" />\n            )}\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction KanbanColumn({ \n  title, \n  status, \n  items,\n  onSelectItem,\n  onDropItem,\n}: {\n  title: string;\n  status: TicketStatus;\n  items: SprintItem[];\n  onSelectItem: (item: SprintItem) => void;\n  onDropItem: (itemId: string, newStatus: TicketStatus) => void;\n}) {\n  const [isDragOver, setIsDragOver] = useState(false);\n\n  const handleDragOver = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(true);\n  };\n\n  const handleDragLeave = () => {\n    setIsDragOver(false);\n  };\n\n  const handleDrop = (e: React.DragEvent) => {\n    e.preventDefault();\n    setIsDragOver(false);\n    const itemId = e.dataTransfer.getData('itemId');\n    if (itemId) {\n      onDropItem(itemId, status);\n    }\n  };\n\n  const statusColors = {\n    todo: 'border-t-gray-400',\n    in_progress: 'border-t-blue-500',\n    in_review: 'border-t-amber-500',\n    done: 'border-t-green-500',\n  };\n\n  return (\n    <div \n      className={cn(\n        \"flex flex-col bg-muted/30 rounded-lg overflow-hidden border-t-4\",\n        statusColors[status],\n        isDragOver && \"ring-2 ring-blue-400\"\n      )}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      data-testid={`column-${status}`}\n    >\n      <div className=\"p-3 bg-background border-b\">\n        <div className=\"flex items-center justify-between\">\n          <h3 className=\"font-semibold text-sm\">{title}</h3>\n          <Badge variant=\"secondary\" className=\"text-xs\">\n            {items.length}\n          </Badge>\n        </div>\n      </div>\n      \n      <div className=\"flex-1 p-2 space-y-2 min-h-[200px] overflow-y-auto\">\n        {items.map(item => (\n          <TicketCard\n            key={item.id}\n            item={item}\n            onSelect={onSelectItem}\n            onMove={onDropItem}\n          />\n        ))}\n        \n        {items.length === 0 && (\n          <div className=\"h-full flex items-center justify-center text-sm text-muted-foreground p-4\">\n            No tickets\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TicketDetailDialog({ \n  item, \n  open,\n  onClose,\n  onUpdateStatus,\n  onSimulateWork\n}: { \n  item: SprintItem;\n  open: boolean;\n  onClose: () => void;\n  onUpdateStatus: (itemId: string, newStatus: TicketStatus) => void;\n  onSimulateWork: (itemId: string, action: 'branch' | 'pr' | 'merge') => void;\n}) {\n  const Icon = getTypeIcon(item.type);\n  const [teamMessage, setTeamMessage] = useState('');\n  const [messages, setMessages] = useState<{from: string; text: string; isUser?: boolean}[]>([\n    { from: 'Sarah', text: \"Let me know if you need any help with this ticket!\" }\n  ]);\n\n  const handleSendMessage = () => {\n    if (!teamMessage.trim()) return;\n    setMessages([...messages, { from: 'You', text: teamMessage, isUser: true }]);\n    setTeamMessage('');\n    \n    setTimeout(() => {\n      setMessages(prev => [...prev, { \n        from: 'Marcus', \n        text: \"Good question! Check the existing codebase patterns in src/utils for reference. I can pair with you if needed.\" \n      }]);\n    }, 1000);\n  };\n\n  const nextAction = !item.branchCreated ? 'branch' : !item.prCreated ? 'pr' : !item.merged ? 'merge' : null;\n  const nextActionLabel = !item.branchCreated ? 'Create Branch' : !item.prCreated ? 'Open PR' : !item.merged ? 'Merge PR' : null;\n  \n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-2 mb-2\">\n            <Badge variant=\"outline\" className=\"font-mono\">{item.id}</Badge>\n            <Badge className={getTypeColor(item.type)} variant=\"secondary\">\n              <Icon className=\"h-3 w-3 mr-1\" />\n              {item.type}\n            </Badge>\n          </div>\n          <DialogTitle>{item.title}</DialogTitle>\n          <DialogDescription>{item.description}</DialogDescription>\n        </DialogHeader>\n        \n        <div className=\"space-y-4\">\n          <div className=\"grid grid-cols-3 gap-3 text-sm\">\n            <div className=\"p-3 bg-muted/50 rounded-lg text-center\">\n              <div className=\"text-lg font-bold\">{item.points}</div>\n              <div className=\"text-xs text-muted-foreground\">Points</div>\n            </div>\n            <div className=\"p-3 bg-muted/50 rounded-lg text-center\">\n              <div className=\"text-lg font-bold capitalize\">{item.priority}</div>\n              <div className=\"text-xs text-muted-foreground\">Priority</div>\n            </div>\n            <div className=\"p-3 bg-muted/50 rounded-lg text-center\">\n              <div className=\"text-lg font-bold capitalize\">{item.status.replace('_', ' ')}</div>\n              <div className=\"text-xs text-muted-foreground\">Status</div>\n            </div>\n          </div>\n          \n          <Separator />\n          \n          <div>\n            <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n              <GitBranch className=\"h-4 w-4\" />\n              Git Workflow\n            </h4>\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center justify-between p-2 bg-muted/30 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  {item.branchCreated ? (\n                    <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <div className=\"h-4 w-4 rounded-full border-2 border-muted-foreground\" />\n                  )}\n                  <span className={item.branchCreated ? '' : 'text-muted-foreground'}>\n                    Create feature branch\n                  </span>\n                </div>\n                {!item.branchCreated && (\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => onSimulateWork(item.id, 'branch')}>\n                    <GitBranch className=\"h-3 w-3 mr-1\" />\n                    Create\n                  </Button>\n                )}\n              </div>\n              \n              <div className=\"flex items-center justify-between p-2 bg-muted/30 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  {item.prCreated ? (\n                    <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <div className=\"h-4 w-4 rounded-full border-2 border-muted-foreground\" />\n                  )}\n                  <span className={item.prCreated ? '' : 'text-muted-foreground'}>\n                    Open pull request\n                  </span>\n                </div>\n                {item.branchCreated && !item.prCreated && (\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => onSimulateWork(item.id, 'pr')}>\n                    <GitPullRequest className=\"h-3 w-3 mr-1\" />\n                    Open PR\n                  </Button>\n                )}\n              </div>\n              \n              <div className=\"flex items-center justify-between p-2 bg-muted/30 rounded\">\n                <div className=\"flex items-center gap-2\">\n                  {item.merged ? (\n                    <CheckCircle2 className=\"h-4 w-4 text-green-500\" />\n                  ) : (\n                    <div className=\"h-4 w-4 rounded-full border-2 border-muted-foreground\" />\n                  )}\n                  <span className={item.merged ? '' : 'text-muted-foreground'}>\n                    Merge to main\n                  </span>\n                </div>\n                {item.prCreated && !item.merged && (\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => onSimulateWork(item.id, 'merge')}>\n                    <CheckCircle2 className=\"h-3 w-3 mr-1\" />\n                    Merge\n                  </Button>\n                )}\n              </div>\n            </div>\n          </div>\n          \n          <Separator />\n          \n          <div>\n            <h4 className=\"text-sm font-medium mb-3 flex items-center gap-2\">\n              <MessageSquare className=\"h-4 w-4\" />\n              Team Chat\n            </h4>\n            <div className=\"border rounded-lg\">\n              <div className=\"max-h-40 overflow-y-auto p-3 space-y-2\">\n                {messages.map((msg, i) => (\n                  <div key={i} className={cn(\n                    \"text-sm p-2 rounded\",\n                    msg.isUser ? \"bg-blue-100 dark:bg-blue-900 ml-8\" : \"bg-muted/50 mr-8\"\n                  )}>\n                    <span className=\"font-medium\">{msg.from}: </span>\n                    {msg.text}\n                  </div>\n                ))}\n              </div>\n              <div className=\"flex gap-2 p-2 border-t\">\n                <Textarea \n                  value={teamMessage}\n                  onChange={(e) => setTeamMessage(e.target.value)}\n                  placeholder=\"Ask your team for help...\"\n                  className=\"min-h-[40px] resize-none\"\n                  rows={1}\n                />\n                <Button size=\"sm\" onClick={handleSendMessage}>\n                  <Send className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"flex justify-between pt-4\">\n            <div className=\"flex gap-2\">\n              {item.status !== 'todo' && (\n                <Button \n                  variant=\"outline\" \n                  size=\"sm\"\n                  onClick={() => onUpdateStatus(item.id, \n                    item.status === 'in_progress' ? 'todo' : \n                    item.status === 'in_review' ? 'in_progress' : 'in_review'\n                  )}\n                >\n                  Move Back\n                </Button>\n              )}\n            </div>\n            {item.status !== 'done' && (\n              <Button \n                onClick={() => onUpdateStatus(item.id,\n                  item.status === 'todo' ? 'in_progress' :\n                  item.status === 'in_progress' ? 'in_review' : 'done'\n                )}\n              >\n                {item.status === 'todo' ? 'Start Working' :\n                 item.status === 'in_progress' ? 'Submit for Review' : 'Mark Done'}\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </Button>\n            )}\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\nexport function ExecutionModule({ \n  workspaceId, \n  userId, \n  journeyId,\n  companyName, \n  role,\n  sprintGoal = \"Fix critical timezone issues and add CSV export functionality\",\n  selectedItems = [\"TICKET-101\", \"TICKET-102\", \"TICKET-104\"],\n  onComplete,\n  onBack \n}: ExecutionModuleProps) {\n  const { toast } = useToast();\n  const [items, setItems] = useState<SprintItem[]>(() => \n    SPRINT_ITEMS.filter(i => selectedItems.includes(i.id))\n  );\n  const [selectedItem, setSelectedItem] = useState<SprintItem | null>(null);\n  const [sprintDay, setSprintDay] = useState(1);\n\n  const itemsByStatus = useMemo(() => ({\n    todo: items.filter(i => i.status === 'todo'),\n    in_progress: items.filter(i => i.status === 'in_progress'),\n    in_review: items.filter(i => i.status === 'in_review'),\n    done: items.filter(i => i.status === 'done'),\n  }), [items]);\n\n  const totalPoints = items.reduce((sum, i) => sum + i.points, 0);\n  const completedPoints = itemsByStatus.done.reduce((sum, i) => sum + i.points, 0);\n  const progressPercent = totalPoints > 0 ? Math.round((completedPoints / totalPoints) * 100) : 0;\n\n  const allDone = items.every(i => i.status === 'done');\n\n  const completePhase = useMutation({\n    mutationFn: async () => {\n      return apiRequest('PATCH', `/api/workspaces/${workspaceId}/phase`, {\n        newPhase: 'review' as WorkspacePhase,\n        status: 'completed',\n        payload: {\n          completedItems: items.map(i => i.id),\n          totalPoints,\n          completedPoints\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/workspaces', workspaceId] });\n      onComplete();\n    },\n    onError: (error) => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete execution phase. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleMoveItem = (itemId: string, newStatus: TicketStatus) => {\n    setItems(prev => prev.map(item => \n      item.id === itemId ? { ...item, status: newStatus } : item\n    ));\n    if (selectedItem?.id === itemId) {\n      setSelectedItem(prev => prev ? { ...prev, status: newStatus } : null);\n    }\n    \n    if (newStatus === 'done') {\n      toast({\n        title: \"Ticket completed!\",\n        description: `${itemId} has been moved to Done.`,\n      });\n    }\n  };\n\n  const handleSimulateWork = (itemId: string, action: 'branch' | 'pr' | 'merge') => {\n    setItems(prev => prev.map(item => {\n      if (item.id !== itemId) return item;\n      const updates: Partial<SprintItem> = {};\n      if (action === 'branch') updates.branchCreated = true;\n      if (action === 'pr') updates.prCreated = true;\n      if (action === 'merge') updates.merged = true;\n      return { ...item, ...updates };\n    }));\n    \n    if (selectedItem?.id === itemId) {\n      setSelectedItem(prev => {\n        if (!prev) return null;\n        const updates: Partial<SprintItem> = {};\n        if (action === 'branch') updates.branchCreated = true;\n        if (action === 'pr') updates.prCreated = true;\n        if (action === 'merge') updates.merged = true;\n        return { ...prev, ...updates };\n      });\n    }\n    \n    toast({\n      title: action === 'branch' ? 'Branch Created' : action === 'pr' ? 'PR Opened' : 'PR Merged',\n      description: action === 'branch' \n        ? `Created feature/${itemId.toLowerCase()}-fix`\n        : action === 'pr'\n        ? 'Pull request is ready for review'\n        : 'Changes have been merged to main',\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\" data-testid=\"execution-module\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Sprint Execution</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">{sprintGoal}</p>\n        </div>\n        {onBack && (\n          <Button variant=\"outline\" onClick={onBack} data-testid=\"button-back-to-dashboard\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Button>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center\">\n              <Clock className=\"h-5 w-5 text-blue-600 dark:text-blue-300\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Sprint Day</p>\n              <p className=\"text-xl font-semibold\">{sprintDay}/10</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-indigo-100 dark:bg-indigo-800 flex items-center justify-center\">\n              <Target className=\"h-5 w-5 text-indigo-600 dark:text-indigo-300\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Progress</p>\n              <p className=\"text-xl font-semibold\">{progressPercent}%</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-amber-100 dark:bg-amber-800 flex items-center justify-center\">\n              <Users className=\"h-5 w-5 text-amber-600 dark:text-amber-300\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">In Review</p>\n              <p className=\"text-xl font-semibold\">{itemsByStatus.in_review.length}</p>\n            </div>\n          </CardContent>\n        </Card>\n        \n        <Card>\n          <CardContent className=\"p-4 flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center\">\n              <CheckCircle2 className=\"h-5 w-5 text-green-600 dark:text-green-300\" />\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground\">Completed</p>\n              <p className=\"text-xl font-semibold\">{completedPoints}/{totalPoints} pts</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"grid grid-cols-4 gap-4\">\n        <KanbanColumn\n          title=\"To Do\"\n          status=\"todo\"\n          items={itemsByStatus.todo}\n          onSelectItem={setSelectedItem}\n          onDropItem={handleMoveItem}\n        />\n        <KanbanColumn\n          title=\"In Progress\"\n          status=\"in_progress\"\n          items={itemsByStatus.in_progress}\n          onSelectItem={setSelectedItem}\n          onDropItem={handleMoveItem}\n        />\n        <KanbanColumn\n          title=\"In Review\"\n          status=\"in_review\"\n          items={itemsByStatus.in_review}\n          onSelectItem={setSelectedItem}\n          onDropItem={handleMoveItem}\n        />\n        <KanbanColumn\n          title=\"Done\"\n          status=\"done\"\n          items={itemsByStatus.done}\n          onSelectItem={setSelectedItem}\n          onDropItem={handleMoveItem}\n        />\n      </div>\n\n      {selectedItem && (\n        <TicketDetailDialog\n          item={selectedItem}\n          open={!!selectedItem}\n          onClose={() => setSelectedItem(null)}\n          onUpdateStatus={handleMoveItem}\n          onSimulateWork={handleSimulateWork}\n        />\n      )}\n\n      <Progress value={progressPercent} className=\"h-2\" />\n      <div className=\"flex items-center justify-between text-sm text-muted-foreground\">\n        <span>Day {sprintDay} of 10</span>\n        <span>{completedPoints}/{totalPoints} story points completed</span>\n      </div>\n\n      {allDone && (\n        <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\n                  <Trophy className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-green-900 dark:text-green-100\">Sprint Complete!</h3>\n                  <p className=\"text-sm text-green-700 dark:text-green-300\">\n                    All tickets completed. Ready for Sprint Review.\n                  </p>\n                </div>\n              </div>\n              <Button \n                onClick={() => completePhase.mutate()}\n                disabled={completePhase.isPending}\n                className=\"bg-green-600 hover:bg-green-700\"\n                data-testid=\"button-complete-sprint\"\n              >\n                <Play className=\"h-4 w-4 mr-2\" />\n                Start Sprint Review\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":24578,"size_tokens":null},"client/src/components/workspace/review-module.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  ArrowLeft,\n  ArrowRight,\n  CheckCircle2, \n  Users,\n  Play,\n  Presentation,\n  Star,\n  MessageSquare,\n  ThumbsUp,\n  ThumbsDown,\n  Lightbulb,\n  Bug,\n  Wrench,\n  Trophy\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { WorkspacePhase } from \"@/hooks/use-sprint-workflow\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface CompletedItem {\n  id: string;\n  title: string;\n  type: 'bug' | 'feature' | 'improvement';\n  points: number;\n}\n\ninterface StakeholderFeedback {\n  name: string;\n  role: string;\n  avatar: string;\n  feedback: string;\n  sentiment: 'positive' | 'neutral' | 'suggestion';\n}\n\ninterface ReviewModuleProps {\n  workspaceId: number;\n  userId: number;\n  journeyId?: number;\n  companyName: string;\n  role: string;\n  completedItems?: string[];\n  sprintGoal?: string;\n  onComplete: () => void;\n  onBack?: () => void;\n}\n\nconst COMPLETED_ITEMS: CompletedItem[] = [\n  { id: \"TICKET-101\", title: \"Fix timezone display in transaction history\", type: \"bug\", points: 3 },\n  { id: \"TICKET-102\", title: \"Add export to CSV functionality\", type: \"feature\", points: 5 },\n  { id: \"TICKET-104\", title: \"Fix refund calculation rounding error\", type: \"bug\", points: 2 },\n];\n\nconst STAKEHOLDER_FEEDBACK: StakeholderFeedback[] = [\n  {\n    name: \"Jennifer Martinez\",\n    role: \"Product Owner\",\n    avatar: \"JM\",\n    feedback: \"Great work on the timezone fix! I've already heard positive feedback from the support team. The CSV export will be a huge time-saver for our enterprise clients.\",\n    sentiment: \"positive\"\n  },\n  {\n    name: \"David Chen\",\n    role: \"Engineering Manager\",\n    avatar: \"DC\",\n    feedback: \"The code quality on these tickets was excellent. I noticed you followed our established patterns well. For next sprint, consider adding more unit tests for the export functionality.\",\n    sentiment: \"suggestion\"\n  },\n  {\n    name: \"Sarah Thompson\",\n    role: \"QA Lead\",\n    avatar: \"ST\",\n    feedback: \"All acceptance criteria passed. The refund fix was particularly well-tested. I'd recommend we add this to our regression suite.\",\n    sentiment: \"positive\"\n  }\n];\n\nfunction getTypeIcon(type: CompletedItem['type']) {\n  switch (type) {\n    case 'bug': return Bug;\n    case 'feature': return Star;\n    case 'improvement': return Wrench;\n    default: return CheckCircle2;\n  }\n}\n\nfunction getTypeColor(type: CompletedItem['type']) {\n  switch (type) {\n    case 'bug': return 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300';\n    case 'feature': return 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300';\n    case 'improvement': return 'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300';\n    default: return 'bg-gray-100 text-gray-700';\n  }\n}\n\ntype ReviewStep = 'demo' | 'feedback' | 'summary';\n\nexport function ReviewModule({ \n  workspaceId, \n  userId, \n  journeyId,\n  companyName, \n  role,\n  completedItems = [\"TICKET-101\", \"TICKET-102\", \"TICKET-104\"],\n  sprintGoal = \"Fix critical timezone issues and add CSV export functionality\",\n  onComplete,\n  onBack \n}: ReviewModuleProps) {\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState<ReviewStep>('demo');\n  const [currentDemoItem, setCurrentDemoItem] = useState(0);\n  const [demoNotes, setDemoNotes] = useState<Record<string, string>>({});\n  const [currentFeedback, setCurrentFeedback] = useState(0);\n  const [feedbackAcknowledged, setFeedbackAcknowledged] = useState<Set<number>>(new Set());\n\n  const items = COMPLETED_ITEMS.filter(item => completedItems.includes(item.id));\n  const totalPoints = items.reduce((sum, item) => sum + item.points, 0);\n\n  const completePhase = useMutation({\n    mutationFn: async () => {\n      return apiRequest('PATCH', `/api/workspaces/${workspaceId}/phase`, {\n        newPhase: 'retro' as WorkspacePhase,\n        status: 'completed',\n        payload: {\n          demoNotes,\n          feedbackReceived: STAKEHOLDER_FEEDBACK.length,\n          completedItems: items.map(i => i.id)\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/workspaces', workspaceId] });\n      onComplete();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete review phase. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const handleNextDemo = () => {\n    if (currentDemoItem < items.length - 1) {\n      setCurrentDemoItem(currentDemoItem + 1);\n    } else {\n      setCurrentStep('feedback');\n    }\n  };\n\n  const handleAcknowledgeFeedback = () => {\n    setFeedbackAcknowledged(prev => new Set(Array.from(prev).concat(currentFeedback)));\n    if (currentFeedback < STAKEHOLDER_FEEDBACK.length - 1) {\n      setCurrentFeedback(currentFeedback + 1);\n    } else {\n      setCurrentStep('summary');\n    }\n  };\n\n  const renderDemo = () => {\n    const currentItem = items[currentDemoItem];\n    const Icon = getTypeIcon(currentItem.type);\n    \n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Sprint Review Demo</h2>\n            <p className=\"text-gray-500 dark:text-gray-400\">Present completed work to stakeholders</p>\n          </div>\n          {onBack && (\n            <Button variant=\"outline\" onClick={onBack} data-testid=\"button-back-to-dashboard\">\n              <ArrowLeft className=\"h-4 w-4 mr-2\" />\n              Back\n            </Button>\n          )}\n        </div>\n\n        <Card className=\"bg-gradient-to-r from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20 border-amber-200 dark:border-amber-800\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"h-12 w-12 rounded-full bg-amber-100 dark:bg-amber-800 flex items-center justify-center\">\n                <Presentation className=\"h-6 w-6 text-amber-600 dark:text-amber-300\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-amber-900 dark:text-amber-100\">Demo Session</h3>\n                <p className=\"text-sm text-amber-700 dark:text-amber-300\">\n                  Present each completed item to the team\n                </p>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-sm text-amber-600\">Item</div>\n                <div className=\"text-2xl font-bold text-amber-900\">{currentDemoItem + 1}/{items.length}</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <Badge variant=\"outline\" className=\"font-mono\">{currentItem.id}</Badge>\n                  <Badge className={getTypeColor(currentItem.type)} variant=\"secondary\">\n                    <Icon className=\"h-3 w-3 mr-1\" />\n                    {currentItem.type}\n                  </Badge>\n                  <Badge variant=\"secondary\">{currentItem.points} pts</Badge>\n                </div>\n                <CardTitle>{currentItem.title}</CardTitle>\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"p-4 bg-muted/50 rounded-lg\">\n              <div className=\"flex items-start gap-3\">\n                <Play className=\"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5\" />\n                <div className=\"text-sm\">\n                  <p className=\"font-medium text-foreground mb-2\">Demo Script:</p>\n                  <ol className=\"list-decimal list-inside space-y-1 text-muted-foreground\">\n                    <li>Show the original issue or feature request</li>\n                    <li>Walk through the implementation</li>\n                    <li>Demonstrate the working solution</li>\n                    <li>Highlight any edge cases handled</li>\n                  </ol>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label className=\"text-sm font-medium\">Demo Notes (Optional)</label>\n              <Textarea\n                value={demoNotes[currentItem.id] || ''}\n                onChange={(e) => setDemoNotes({ ...demoNotes, [currentItem.id]: e.target.value })}\n                placeholder=\"Any notes about the demo, questions asked, or feedback received...\"\n                rows={3}\n                data-testid={`input-demo-notes-${currentItem.id}`}\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200\">\n              <div className=\"flex items-center gap-3\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                <span className=\"text-green-800 dark:text-green-200\">Demo complete!</span>\n              </div>\n              <Button onClick={handleNextDemo} data-testid=\"button-next-demo\">\n                {currentDemoItem < items.length - 1 ? 'Next Item' : 'Continue to Feedback'}\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"flex gap-2\">\n          {items.map((item, index) => (\n            <div \n              key={item.id}\n              className={cn(\n                \"flex-1 h-2 rounded-full\",\n                index < currentDemoItem ? \"bg-green-500\" :\n                index === currentDemoItem ? \"bg-amber-500\" : \"bg-gray-200\"\n              )}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  const renderFeedback = () => {\n    const feedback = STAKEHOLDER_FEEDBACK[currentFeedback];\n    \n    return (\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Stakeholder Feedback</h2>\n            <p className=\"text-gray-500 dark:text-gray-400\">Receive feedback from the product team</p>\n          </div>\n          <Button variant=\"outline\" onClick={() => setCurrentStep('demo')} data-testid=\"button-back-to-demo\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back to Demo\n          </Button>\n        </div>\n\n        <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center\">\n                <MessageSquare className=\"h-6 w-6 text-blue-600 dark:text-blue-300\" />\n              </div>\n              <div className=\"flex-1\">\n                <h3 className=\"font-semibold text-blue-900 dark:text-blue-100\">Feedback Session</h3>\n                <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                  Review and acknowledge stakeholder feedback\n                </p>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-sm text-blue-600\">Feedback</div>\n                <div className=\"text-2xl font-bold text-blue-900\">{currentFeedback + 1}/{STAKEHOLDER_FEEDBACK.length}</div>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-4\">\n              <Avatar className=\"h-12 w-12\">\n                <AvatarFallback className={cn(\n                  feedback.sentiment === 'positive' ? 'bg-green-100 text-green-700' :\n                  feedback.sentiment === 'suggestion' ? 'bg-amber-100 text-amber-700' :\n                  'bg-gray-100 text-gray-700'\n                )}>\n                  {feedback.avatar}\n                </AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <h4 className=\"font-semibold\">{feedback.name}</h4>\n                  <Badge variant=\"outline\">{feedback.role}</Badge>\n                  {feedback.sentiment === 'positive' && (\n                    <ThumbsUp className=\"h-4 w-4 text-green-500\" />\n                  )}\n                  {feedback.sentiment === 'suggestion' && (\n                    <Lightbulb className=\"h-4 w-4 text-amber-500\" />\n                  )}\n                </div>\n                <p className=\"text-muted-foreground\">{feedback.feedback}</p>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card className=\"border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-950/50\">\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                <CheckCircle2 className=\"h-5 w-5 text-blue-600\" />\n                <span className=\"text-blue-800 dark:text-blue-200\">\n                  {feedbackAcknowledged.has(currentFeedback) \n                    ? 'Feedback acknowledged' \n                    : 'Acknowledge this feedback to continue'}\n                </span>\n              </div>\n              <Button onClick={handleAcknowledgeFeedback} data-testid=\"button-acknowledge-feedback\">\n                {currentFeedback < STAKEHOLDER_FEEDBACK.length - 1 ? 'Acknowledge & Next' : 'Complete Feedback'}\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"flex gap-2\">\n          {STAKEHOLDER_FEEDBACK.map((_, index) => (\n            <div \n              key={index}\n              className={cn(\n                \"flex-1 h-2 rounded-full\",\n                feedbackAcknowledged.has(index) ? \"bg-green-500\" :\n                index === currentFeedback ? \"bg-blue-500\" : \"bg-gray-200\"\n              )}\n            />\n          ))}\n        </div>\n      </div>\n    );\n  };\n\n  const renderSummary = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Review Summary</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">Sprint review completed successfully</p>\n        </div>\n        <Button variant=\"outline\" onClick={() => setCurrentStep('feedback')} data-testid=\"button-back-to-feedback\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n      </div>\n\n      <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"h-12 w-12 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center\">\n              <Trophy className=\"h-6 w-6 text-green-600 dark:text-green-300\" />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-green-900 dark:text-green-100\">Sprint Review Complete!</h3>\n              <p className=\"text-sm text-green-700 dark:text-green-300\">\n                Successfully demonstrated all completed work\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-3 gap-4\">\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-green-600\">{items.length}</div>\n            <div className=\"text-sm text-muted-foreground\">Items Demoed</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-blue-600\">{totalPoints}</div>\n            <div className=\"text-sm text-muted-foreground\">Points Delivered</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-amber-600\">{STAKEHOLDER_FEEDBACK.length}</div>\n            <div className=\"text-sm text-muted-foreground\">Feedback Received</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Sprint Goal Achievement</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"p-4 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200\">\n            <div className=\"flex items-start gap-3\">\n              <CheckCircle2 className=\"h-5 w-5 text-green-600 mt-0.5\" />\n              <div>\n                <p className=\"font-medium text-green-800 dark:text-green-200\">Goal Met</p>\n                <p className=\"text-sm text-green-700 dark:text-green-300\">{sprintGoal}</p>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Key Feedback Highlights</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-3\">\n          {STAKEHOLDER_FEEDBACK.map((fb, i) => (\n            <div key={i} className=\"flex items-start gap-3 p-3 bg-muted/30 rounded-lg\">\n              <Avatar className=\"h-8 w-8\">\n                <AvatarFallback className=\"text-xs\">{fb.avatar}</AvatarFallback>\n              </Avatar>\n              <div>\n                <p className=\"text-sm font-medium\">{fb.name}</p>\n                <p className=\"text-xs text-muted-foreground line-clamp-2\">{fb.feedback}</p>\n              </div>\n            </div>\n          ))}\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-gradient-to-r from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 border-violet-200 dark:border-violet-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"h-12 w-12 rounded-full bg-violet-100 flex items-center justify-center\">\n                <Users className=\"h-6 w-6 text-violet-600\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-violet-900 dark:text-violet-100\">Ready for Retrospective</h3>\n                <p className=\"text-sm text-violet-700 dark:text-violet-300\">\n                  Reflect on the sprint and identify improvements\n                </p>\n              </div>\n            </div>\n            <Button \n              onClick={() => completePhase.mutate()}\n              disabled={completePhase.isPending}\n              className=\"bg-violet-600 hover:bg-violet-700\"\n              data-testid=\"button-start-retro\"\n            >\n              <Play className=\"h-4 w-4 mr-2\" />\n              Start Retrospective\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  return (\n    <div className=\"h-full\" data-testid=\"review-module\">\n      {currentStep === 'demo' && renderDemo()}\n      {currentStep === 'feedback' && renderFeedback()}\n      {currentStep === 'summary' && renderSummary()}\n    </div>\n  );\n}\n","path":null,"size_bytes":19905,"size_tokens":null},"client/src/pages/workspace-retro.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { RetroModule } from \"@/components/workspace/retro-module\";\nimport { PhaseGuard } from \"@/components/workspace/phase-guard\";\nimport { useWorkspaceState } from \"@/hooks/use-sprint-workflow\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function WorkspaceRetro() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6 space-y-6\" data-testid=\"workspace-retro-loading\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-24 w-full\" />\n        <div className=\"grid grid-cols-2 gap-4\">\n          <Skeleton className=\"h-64\" />\n          <Skeleton className=\"h-64\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !state || !workspaceId) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-retro-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Retrospective</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\"\n              onClick={() => navigate('/journey')}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              Back to Journey\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace } = state;\n\n  const handleComplete = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  const handleBack = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  return (\n    <PhaseGuard\n      currentPhase={workspace.currentPhase}\n      requiredPhase=\"retro\"\n      workspaceId={workspaceId}\n      onNavigate={navigate}\n    >\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-retro\">\n        <RetroModule\n          workspaceId={workspaceId}\n          userId={workspace.userId}\n          journeyId={workspace.journeyId}\n          companyName={workspace.companyName}\n          role={workspace.role}\n          onComplete={handleComplete}\n          onBack={handleBack}\n        />\n      </div>\n    </PhaseGuard>\n  );\n}\n","path":null,"size_bytes":2780,"size_tokens":null},"client/src/components/workspace/retro-module.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  ArrowLeft,\n  ArrowRight,\n  CheckCircle2, \n  ThumbsUp,\n  ThumbsDown,\n  Lightbulb,\n  Plus,\n  Trash2,\n  Trophy,\n  Sparkles,\n  Heart,\n  Zap,\n  Target,\n  RotateCcw\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport type { WorkspacePhase } from \"@/hooks/use-sprint-workflow\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface RetroCard {\n  id: string;\n  type: 'went_well' | 'to_improve' | 'action_item';\n  text: string;\n  votes?: number;\n}\n\ninterface RetroModuleProps {\n  workspaceId: number;\n  userId: number;\n  journeyId?: number;\n  companyName: string;\n  role: string;\n  onComplete: () => void;\n  onBack?: () => void;\n}\n\nconst INITIAL_CARDS: RetroCard[] = [\n  { id: \"1\", type: \"went_well\", text: \"Team collaboration was excellent - everyone helped when blocked\", votes: 3 },\n  { id: \"2\", type: \"went_well\", text: \"Good estimation on tickets, delivered close to planned points\", votes: 2 },\n  { id: \"3\", type: \"to_improve\", text: \"Daily standups ran too long, should be more focused\", votes: 2 },\n  { id: \"4\", type: \"to_improve\", text: \"PR reviews took longer than expected\", votes: 1 },\n];\n\ntype RetroStep = 'reflection' | 'action_items' | 'summary';\n\nexport function RetroModule({ \n  workspaceId, \n  userId, \n  journeyId,\n  companyName, \n  role,\n  onComplete,\n  onBack \n}: RetroModuleProps) {\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState<RetroStep>('reflection');\n  const [cards, setCards] = useState<RetroCard[]>(INITIAL_CARDS);\n  const [actionItems, setActionItems] = useState<{id: string; text: string; owner: string}[]>([\n    { id: \"ai1\", text: \"Timebox standups to 15 minutes with parking lot for longer discussions\", owner: \"Team\" },\n  ]);\n  const [newWentWell, setNewWentWell] = useState('');\n  const [newToImprove, setNewToImprove] = useState('');\n  const [newActionItem, setNewActionItem] = useState('');\n  const [newActionOwner, setNewActionOwner] = useState('');\n\n  const wentWellCards = cards.filter(c => c.type === 'went_well');\n  const toImproveCards = cards.filter(c => c.type === 'to_improve');\n\n  const completePhase = useMutation({\n    mutationFn: async () => {\n      return apiRequest('PATCH', `/api/workspaces/${workspaceId}/phase`, {\n        newPhase: 'retro' as WorkspacePhase,\n        status: 'completed',\n        payload: {\n          wentWell: wentWellCards.length,\n          toImprove: toImproveCards.length,\n          actionItems: actionItems.length,\n          retroCards: cards,\n          actions: actionItems,\n          sprintCycleComplete: true\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/workspaces', workspaceId] });\n      onComplete();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to complete retrospective. Please try again.\",\n        variant: \"destructive\"\n      });\n    }\n  });\n\n  const addCard = (type: 'went_well' | 'to_improve', text: string) => {\n    if (!text.trim()) return;\n    const newCard: RetroCard = {\n      id: `card-${Date.now()}`,\n      type,\n      text: text.trim(),\n      votes: 0\n    };\n    setCards([...cards, newCard]);\n    if (type === 'went_well') setNewWentWell('');\n    else setNewToImprove('');\n    \n    toast({\n      title: \"Card added\",\n      description: `Added to ${type === 'went_well' ? '\"Went Well\"' : '\"To Improve\"'}`,\n    });\n  };\n\n  const voteCard = (cardId: string) => {\n    setCards(cards.map(c => \n      c.id === cardId ? { ...c, votes: (c.votes || 0) + 1 } : c\n    ));\n  };\n\n  const addActionItem = () => {\n    if (!newActionItem.trim()) return;\n    setActionItems([...actionItems, {\n      id: `ai-${Date.now()}`,\n      text: newActionItem.trim(),\n      owner: newActionOwner.trim() || 'Team'\n    }]);\n    setNewActionItem('');\n    setNewActionOwner('');\n    \n    toast({\n      title: \"Action item added\",\n      description: \"Remember to follow up on this next sprint!\",\n    });\n  };\n\n  const removeActionItem = (id: string) => {\n    setActionItems(actionItems.filter(ai => ai.id !== id));\n  };\n\n  const renderReflection = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Sprint Retrospective</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">Reflect on the sprint and identify improvements</p>\n        </div>\n        {onBack && (\n          <Button variant=\"outline\" onClick={onBack} data-testid=\"button-back-to-dashboard\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Button>\n        )}\n      </div>\n\n      <Card className=\"bg-gradient-to-r from-violet-50 to-purple-50 dark:from-violet-900/20 dark:to-purple-900/20 border-violet-200 dark:border-violet-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"h-12 w-12 rounded-full bg-violet-100 dark:bg-violet-800 flex items-center justify-center\">\n              <RotateCcw className=\"h-6 w-6 text-violet-600 dark:text-violet-300\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-violet-900 dark:text-violet-100\">Reflection Time</h3>\n              <p className=\"text-sm text-violet-700 dark:text-violet-300\">\n                Add cards and vote on what went well and what to improve\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-2 gap-6\">\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center gap-2 text-green-700\">\n              <ThumbsUp className=\"h-5 w-5\" />\n              What Went Well\n            </CardTitle>\n            <CardDescription>Celebrate wins and successes</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {wentWellCards.map(card => (\n              <div \n                key={card.id}\n                className=\"p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 rounded-lg\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <p className=\"text-sm\">{card.text}</p>\n                  <Button \n                    variant=\"ghost\" \n                    size=\"sm\"\n                    onClick={() => voteCard(card.id)}\n                    className=\"h-8 px-2\"\n                  >\n                    <Heart className=\"h-4 w-4 mr-1 text-green-600\" />\n                    {card.votes || 0}\n                  </Button>\n                </div>\n              </div>\n            ))}\n            \n            <div className=\"flex gap-2\">\n              <Input\n                value={newWentWell}\n                onChange={(e) => setNewWentWell(e.target.value)}\n                placeholder=\"Add something that went well...\"\n                className=\"flex-1\"\n                onKeyPress={(e) => e.key === 'Enter' && addCard('went_well', newWentWell)}\n                data-testid=\"input-went-well\"\n              />\n              <Button \n                size=\"sm\"\n                onClick={() => addCard('went_well', newWentWell)}\n                className=\"bg-green-600 hover:bg-green-700\"\n              >\n                <Plus className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"flex items-center gap-2 text-amber-700\">\n              <Lightbulb className=\"h-5 w-5\" />\n              To Improve\n            </CardTitle>\n            <CardDescription>Identify areas for growth</CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {toImproveCards.map(card => (\n              <div \n                key={card.id}\n                className=\"p-3 bg-amber-50 dark:bg-amber-900/20 border border-amber-200 rounded-lg\"\n              >\n                <div className=\"flex items-start justify-between gap-2\">\n                  <p className=\"text-sm\">{card.text}</p>\n                  <Button \n                    variant=\"ghost\" \n                    size=\"sm\"\n                    onClick={() => voteCard(card.id)}\n                    className=\"h-8 px-2\"\n                  >\n                    <Zap className=\"h-4 w-4 mr-1 text-amber-600\" />\n                    {card.votes || 0}\n                  </Button>\n                </div>\n              </div>\n            ))}\n            \n            <div className=\"flex gap-2\">\n              <Input\n                value={newToImprove}\n                onChange={(e) => setNewToImprove(e.target.value)}\n                placeholder=\"Add something to improve...\"\n                className=\"flex-1\"\n                onKeyPress={(e) => e.key === 'Enter' && addCard('to_improve', newToImprove)}\n                data-testid=\"input-to-improve\"\n              />\n              <Button \n                size=\"sm\"\n                onClick={() => addCard('to_improve', newToImprove)}\n                className=\"bg-amber-600 hover:bg-amber-700\"\n              >\n                <Plus className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <div className=\"flex justify-end\">\n        <Button onClick={() => setCurrentStep('action_items')} data-testid=\"button-next-actions\">\n          Define Action Items\n          <ArrowRight className=\"h-4 w-4 ml-2\" />\n        </Button>\n      </div>\n    </div>\n  );\n\n  const renderActionItems = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Action Items</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">Define concrete improvements for next sprint</p>\n        </div>\n        <Button variant=\"outline\" onClick={() => setCurrentStep('reflection')} data-testid=\"button-back-to-reflection\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n      </div>\n\n      <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200 dark:border-blue-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"h-12 w-12 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center\">\n              <Target className=\"h-6 w-6 text-blue-600 dark:text-blue-300\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-blue-900 dark:text-blue-100\">Commit to Actions</h3>\n              <p className=\"text-sm text-blue-700 dark:text-blue-300\">\n                Turn insights into actionable improvements\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Top Issues from Reflection</CardTitle>\n          <CardDescription>Consider these when creating action items</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            {toImproveCards\n              .sort((a, b) => (b.votes || 0) - (a.votes || 0))\n              .slice(0, 3)\n              .map(card => (\n                <div key={card.id} className=\"flex items-center gap-2 p-2 bg-amber-50 dark:bg-amber-900/20 rounded\">\n                  <Badge variant=\"outline\">{card.votes || 0} votes</Badge>\n                  <span className=\"text-sm\">{card.text}</span>\n                </div>\n              ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base flex items-center gap-2\">\n            <CheckCircle2 className=\"h-5 w-5 text-blue-600\" />\n            Action Items\n          </CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {actionItems.map(item => (\n            <div \n              key={item.id}\n              className=\"flex items-center gap-3 p-3 bg-muted/50 rounded-lg\"\n            >\n              <CheckCircle2 className=\"h-5 w-5 text-blue-600 flex-shrink-0\" />\n              <div className=\"flex-1\">\n                <p className=\"text-sm\">{item.text}</p>\n                <Badge variant=\"outline\" className=\"mt-1\">Owner: {item.owner}</Badge>\n              </div>\n              <Button \n                variant=\"ghost\" \n                size=\"sm\"\n                onClick={() => removeActionItem(item.id)}\n              >\n                <Trash2 className=\"h-4 w-4 text-red-500\" />\n              </Button>\n            </div>\n          ))}\n          \n          <Separator />\n          \n          <div className=\"space-y-3\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"action-text\">New Action Item</Label>\n              <Textarea\n                id=\"action-text\"\n                value={newActionItem}\n                onChange={(e) => setNewActionItem(e.target.value)}\n                placeholder=\"Describe the improvement action...\"\n                rows={2}\n                data-testid=\"input-action-item\"\n              />\n            </div>\n            <div className=\"flex gap-3\">\n              <div className=\"flex-1 space-y-2\">\n                <Label htmlFor=\"action-owner\">Owner</Label>\n                <Input\n                  id=\"action-owner\"\n                  value={newActionOwner}\n                  onChange={(e) => setNewActionOwner(e.target.value)}\n                  placeholder=\"Who will own this?\"\n                  data-testid=\"input-action-owner\"\n                />\n              </div>\n              <Button \n                className=\"self-end\"\n                onClick={addActionItem}\n                disabled={!newActionItem.trim()}\n                data-testid=\"button-add-action\"\n              >\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Add\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-end\">\n        <Button onClick={() => setCurrentStep('summary')} data-testid=\"button-complete-retro\">\n          Complete Retrospective\n          <ArrowRight className=\"h-4 w-4 ml-2\" />\n        </Button>\n      </div>\n    </div>\n  );\n\n  const renderSummary = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Sprint Complete!</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">You've completed your first sprint cycle</p>\n        </div>\n        <Button variant=\"outline\" onClick={() => setCurrentStep('action_items')} data-testid=\"button-back-to-actions\">\n          <ArrowLeft className=\"h-4 w-4 mr-2\" />\n          Back\n        </Button>\n      </div>\n\n      <Card className=\"bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 dark:from-green-900/20 dark:via-emerald-900/20 dark:to-teal-900/20 border-green-200 dark:border-green-800\">\n        <CardContent className=\"p-8 text-center\">\n          <div className=\"h-20 w-20 rounded-full bg-green-100 dark:bg-green-800 flex items-center justify-center mx-auto mb-4\">\n            <Trophy className=\"h-10 w-10 text-green-600 dark:text-green-300\" />\n          </div>\n          <h3 className=\"text-2xl font-bold text-green-900 dark:text-green-100 mb-2\">\n            Congratulations!\n          </h3>\n          <p className=\"text-green-700 dark:text-green-300 max-w-md mx-auto\">\n            You've successfully completed your first full sprint cycle from onboarding through retrospective.\n          </p>\n        </CardContent>\n      </Card>\n\n      <div className=\"grid grid-cols-4 gap-4\">\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-green-600\">{wentWellCards.length}</div>\n            <div className=\"text-sm text-muted-foreground\">Things Went Well</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-amber-600\">{toImproveCards.length}</div>\n            <div className=\"text-sm text-muted-foreground\">To Improve</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-blue-600\">{actionItems.length}</div>\n            <div className=\"text-sm text-muted-foreground\">Action Items</div>\n          </CardContent>\n        </Card>\n        <Card>\n          <CardContent className=\"p-4 text-center\">\n            <div className=\"text-3xl font-bold text-purple-600\">100%</div>\n            <div className=\"text-sm text-muted-foreground\">Sprint Complete</div>\n          </CardContent>\n        </Card>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-base\">Action Items for Next Sprint</CardTitle>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-2\">\n            {actionItems.map((item, i) => (\n              <div key={item.id} className=\"flex items-center gap-3 p-2 bg-muted/30 rounded\">\n                <Badge>{i + 1}</Badge>\n                <span className=\"text-sm\">{item.text}</span>\n                <Badge variant=\"outline\" className=\"ml-auto\">{item.owner}</Badge>\n              </div>\n            ))}\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card className=\"bg-gradient-to-r from-indigo-50 to-blue-50 dark:from-indigo-900/20 dark:to-blue-900/20 border-indigo-200 dark:border-indigo-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <div className=\"h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center\">\n                <Sparkles className=\"h-6 w-6 text-indigo-600\" />\n              </div>\n              <div>\n                <h3 className=\"font-semibold text-indigo-900 dark:text-indigo-100\">Finish Sprint Cycle</h3>\n                <p className=\"text-sm text-indigo-700 dark:text-indigo-300\">\n                  Complete this sprint and return to the workspace\n                </p>\n              </div>\n            </div>\n            <Button \n              onClick={() => completePhase.mutate()}\n              disabled={completePhase.isPending}\n              className=\"bg-indigo-600 hover:bg-indigo-700\"\n              data-testid=\"button-finish-sprint\"\n            >\n              <Trophy className=\"h-4 w-4 mr-2\" />\n              Finish Sprint\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  return (\n    <div className=\"h-full\" data-testid=\"retro-module\">\n      {currentStep === 'reflection' && renderReflection()}\n      {currentStep === 'action_items' && renderActionItems()}\n      {currentStep === 'summary' && renderSummary()}\n    </div>\n  );\n}\n","path":null,"size_bytes":19574,"size_tokens":null},"client/src/components/workspace/planning-module.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Input } from \"@/components/ui/input\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { \n  ListTodo, \n  Target, \n  CheckCircle2, \n  ArrowLeft,\n  ArrowRight,\n  Lightbulb,\n  AlertCircle,\n  Play,\n  Bug,\n  Wrench,\n  Star,\n  Send,\n  MessageCircle,\n  GraduationCap,\n  ChevronRight\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\n\ninterface BacklogItem {\n  id: string;\n  title: string;\n  type: 'bug' | 'feature' | 'improvement';\n  priority: 'high' | 'medium' | 'low';\n  points: number;\n  description: string;\n  selected?: boolean;\n}\n\ninterface PlanningMessage {\n  id: number;\n  sender: string;\n  senderRole: string;\n  message: string;\n  phase: string;\n  isUser: boolean;\n  createdAt: string;\n}\n\ninterface PlanningSession {\n  id: number;\n  workspaceId: number;\n  role: string;\n  level: string;\n  currentPhase: string;\n  phaseCompletions: Record<string, boolean>;\n  selectedItems: string[];\n  capacityUsed: number;\n  goalStatement: string | null;\n  status: string;\n  knowledgeCheckPassed: boolean;\n}\n\ntype EngagementMode = 'shadow' | 'guided' | 'active' | 'facilitator';\ntype PhaseEngagement = 'observe' | 'respond' | 'lead';\n\ninterface MessageStaggerConfig {\n  enabled: boolean;\n  baseDelayMs: number;\n  perCharacterDelayMs: number;\n  maxDelayMs: number;\n}\n\ninterface LevelEngagement {\n  mode: EngagementMode;\n  autoStartConversation: boolean;\n  teamTalkRatio: number;\n  phaseEngagement: {\n    context: PhaseEngagement;\n    discussion: PhaseEngagement;\n    commitment: PhaseEngagement;\n  };\n  promptSuggestions?: {\n    context: string[];\n    discussion: string[];\n    commitment: string[];\n  };\n  autoStartMessage: string;\n  messageStagger?: MessageStaggerConfig;\n}\n\ninterface PlanningSessionState {\n  session: PlanningSession;\n  messages: PlanningMessage[];\n  backlogItems: BacklogItem[];\n  capacity: number;\n  adapterConfig: {\n    role: string;\n    level: string;\n    facilitator: 'user' | 'ai';\n    showLearningObjectives: boolean;\n    showKnowledgeCheck: boolean;\n    canSkipPhases: boolean;\n    engagement: LevelEngagement;\n  };\n}\n\ninterface PlanningModuleProps {\n  workspaceId: number;\n  userId: number;\n  journeyId?: number;\n  companyName: string;\n  role: string;\n  onComplete: (sprintGoal: string, selectedItems: string[]) => void;\n  onBack?: () => void;\n}\n\nconst PLANNING_PHASES = [\n  { id: 'context', label: 'Context', icon: Lightbulb, description: 'Understand priorities' },\n  { id: 'discussion', label: 'Discussion', icon: MessageCircle, description: 'Discuss & estimate' },\n  { id: 'commitment', label: 'Commitment', icon: CheckCircle2, description: 'Finalize sprint' }\n];\n\nconst PERSONA_COLORS: Record<string, string> = {\n  'Priya': 'bg-purple-100 text-purple-700 border-purple-200',\n  'Marcus': 'bg-blue-100 text-blue-700 border-blue-200',\n  'Alex': 'bg-green-100 text-green-700 border-green-200',\n  'default': 'bg-gray-100 text-gray-700 border-gray-200'\n};\n\nconst PERSONA_AVATARS: Record<string, string> = {\n  'Priya': 'PM',\n  'Marcus': 'MD',\n  'Alex': 'AQ',\n  'You': 'ME'\n};\n\nfunction getTypeIcon(type: BacklogItem['type']) {\n  switch (type) {\n    case 'bug': return Bug;\n    case 'feature': return Star;\n    case 'improvement': return Wrench;\n    default: return ListTodo;\n  }\n}\n\nfunction getTypeColor(type: BacklogItem['type']) {\n  switch (type) {\n    case 'bug': return 'bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300';\n    case 'feature': return 'bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300';\n    case 'improvement': return 'bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300';\n    default: return 'bg-gray-100 text-gray-700';\n  }\n}\n\nfunction getPriorityBadge(priority: BacklogItem['priority']) {\n  switch (priority) {\n    case 'high': return 'bg-red-500 text-white';\n    case 'medium': return 'bg-amber-500 text-white';\n    case 'low': return 'bg-gray-500 text-white';\n    default: return 'bg-gray-500 text-white';\n  }\n}\n\nfunction PhaseProgress({ currentPhase, phaseCompletions }: { currentPhase: string; phaseCompletions: Record<string, boolean> }) {\n  return (\n    <div className=\"flex items-center gap-2 p-4 bg-muted/30 rounded-lg mb-6\">\n      {PLANNING_PHASES.map((phase, index) => {\n        const Icon = phase.icon;\n        const isActive = currentPhase === phase.id;\n        const isCompleted = phaseCompletions[phase.id];\n        \n        return (\n          <div key={phase.id} className=\"flex items-center\">\n            <div className={cn(\n              \"flex items-center gap-2 px-3 py-2 rounded-lg transition-all\",\n              isActive && \"bg-indigo-100 dark:bg-indigo-900/50 ring-2 ring-indigo-500\",\n              isCompleted && !isActive && \"bg-green-100 dark:bg-green-900/30\",\n              !isActive && !isCompleted && \"opacity-50\"\n            )}>\n              <div className={cn(\n                \"h-8 w-8 rounded-full flex items-center justify-center\",\n                isActive && \"bg-indigo-500 text-white\",\n                isCompleted && !isActive && \"bg-green-500 text-white\",\n                !isActive && !isCompleted && \"bg-muted text-muted-foreground\"\n              )}>\n                {isCompleted ? <CheckCircle2 className=\"h-4 w-4\" /> : <Icon className=\"h-4 w-4\" />}\n              </div>\n              <div className=\"hidden sm:block\">\n                <div className={cn(\n                  \"text-sm font-medium\",\n                  isActive && \"text-indigo-700 dark:text-indigo-300\"\n                )}>{phase.label}</div>\n                <div className=\"text-xs text-muted-foreground\">{phase.description}</div>\n              </div>\n            </div>\n            {index < PLANNING_PHASES.length - 1 && (\n              <ChevronRight className=\"h-4 w-4 text-muted-foreground mx-1\" />\n            )}\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nfunction ChatMessage({ message }: { message: PlanningMessage }) {\n  const colorClass = PERSONA_COLORS[message.sender] || PERSONA_COLORS.default;\n  const avatar = PERSONA_AVATARS[message.sender] || message.sender.substring(0, 2).toUpperCase();\n  \n  return (\n    <div className={cn(\n      \"flex gap-3 mb-4\",\n      message.isUser && \"flex-row-reverse\"\n    )}>\n      <Avatar className={cn(\"h-8 w-8\", message.isUser ? \"bg-indigo-100\" : colorClass.split(' ')[0])}>\n        <AvatarFallback className={cn(\"text-xs\", message.isUser ? \"text-indigo-700\" : \"\")}>{avatar}</AvatarFallback>\n      </Avatar>\n      <div className={cn(\n        \"max-w-[80%] rounded-lg p-3\",\n        message.isUser \n          ? \"bg-indigo-500 text-white\" \n          : \"bg-white dark:bg-gray-800 border\"\n      )}>\n        {!message.isUser && (\n          <div className=\"flex items-center gap-2 mb-1\">\n            <span className=\"font-medium text-sm\">{message.sender}</span>\n            <Badge variant=\"outline\" className=\"text-xs py-0\">{message.senderRole}</Badge>\n          </div>\n        )}\n        <p className={cn(\"text-sm\", message.isUser ? \"text-white\" : \"text-foreground\")}>{message.message}</p>\n      </div>\n    </div>\n  );\n}\n\nfunction BacklogPanel({ \n  items, \n  selectedItems, \n  capacity, \n  onToggleItem,\n  disabled \n}: { \n  items: BacklogItem[]; \n  selectedItems: string[]; \n  capacity: number;\n  onToggleItem: (id: string) => void;\n  disabled?: boolean;\n}) {\n  const selectedPoints = items\n    .filter(item => selectedItems.includes(item.id))\n    .reduce((sum, item) => sum + item.points, 0);\n  \n  const capacityUsed = (selectedPoints / capacity) * 100;\n  const isOverCapacity = selectedPoints > capacity;\n  \n  return (\n    <Card className=\"h-full flex flex-col\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <CardTitle className=\"text-base\">Sprint Backlog</CardTitle>\n            <CardDescription>Select items for this sprint</CardDescription>\n          </div>\n          <div className=\"text-right\">\n            <div className={cn(\n              \"text-lg font-bold\",\n              isOverCapacity ? \"text-red-600\" : \"text-green-600\"\n            )}>\n              {selectedPoints}/{capacity}\n            </div>\n            <div className=\"text-xs text-muted-foreground\">points</div>\n          </div>\n        </div>\n        <Progress \n          value={Math.min(capacityUsed, 100)} \n          className={cn(\"h-2 mt-2\", isOverCapacity && \"bg-red-100\")}\n        />\n        {isOverCapacity && (\n          <div className=\"flex items-center gap-2 mt-2 text-red-600 text-xs\">\n            <AlertCircle className=\"h-3 w-3\" />\n            Over capacity\n          </div>\n        )}\n      </CardHeader>\n      <CardContent className=\"flex-1 overflow-hidden\">\n        <ScrollArea className=\"h-full pr-3\">\n          <div className=\"space-y-2\">\n            {items.map(item => {\n              const Icon = getTypeIcon(item.type);\n              const isSelected = selectedItems.includes(item.id);\n              \n              return (\n                <div \n                  key={item.id}\n                  className={cn(\n                    \"p-3 rounded-lg border transition-all\",\n                    disabled ? \"cursor-not-allowed opacity-50\" : \"cursor-pointer\",\n                    isSelected \n                      ? \"border-indigo-300 bg-indigo-50/50 dark:bg-indigo-900/20\" \n                      : \"border-gray-200 hover:border-gray-300\"\n                  )}\n                  onClick={() => !disabled && onToggleItem(item.id)}\n                  data-testid={`backlog-item-${item.id}`}\n                >\n                  <div className=\"flex items-start gap-2\">\n                    <Checkbox \n                      checked={isSelected}\n                      onCheckedChange={() => !disabled && onToggleItem(item.id)}\n                      className=\"mt-1\"\n                      disabled={disabled}\n                    />\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-1.5 mb-1 flex-wrap\">\n                        <span className=\"text-xs font-mono text-muted-foreground\">{item.id}</span>\n                        <Badge className={cn(\"text-xs py-0\", getTypeColor(item.type))} variant=\"secondary\">\n                          <Icon className=\"h-2.5 w-2.5 mr-0.5\" />\n                          {item.type}\n                        </Badge>\n                        <Badge className={cn(\"text-xs py-0\", getPriorityBadge(item.priority))}>\n                          {item.priority}\n                        </Badge>\n                        <span className=\"text-xs font-medium text-indigo-600\">{item.points}pts</span>\n                      </div>\n                      <h4 className=\"font-medium text-sm text-gray-900 dark:text-white\">{item.title}</h4>\n                    </div>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </ScrollArea>\n      </CardContent>\n    </Card>\n  );\n}\n\nfunction LearningObjectives({ phase, role, level }: { phase: string; role: string; level: string }) {\n  const objectives: Record<string, string[]> = {\n    context: [\n      \"Understand sprint goals come from business priorities\",\n      \"Listen to how the PM presents context to the team\",\n      \"Ask clarifying questions about priorities\"\n    ],\n    discussion: [\n      \"Learn how teams estimate work together\",\n      \"Understand the importance of breaking down work\",\n      \"Practice raising concerns constructively\"\n    ],\n    commitment: [\n      \"See how teams make realistic commitments\",\n      \"Understand capacity planning basics\",\n      \"Learn to balance ambition with sustainability\"\n    ]\n  };\n  \n  return (\n    <Card className=\"bg-gradient-to-r from-amber-50 to-yellow-50 dark:from-amber-900/20 dark:to-yellow-900/20 border-amber-200 mb-4\">\n      <CardContent className=\"p-4\">\n        <div className=\"flex items-start gap-3\">\n          <GraduationCap className=\"h-5 w-5 text-amber-600 flex-shrink-0 mt-0.5\" />\n          <div>\n            <h4 className=\"font-medium text-amber-900 dark:text-amber-100 text-sm mb-2\">Learning Objectives</h4>\n            <ul className=\"space-y-1\">\n              {objectives[phase]?.map((obj, i) => (\n                <li key={i} className=\"text-xs text-amber-700 dark:text-amber-300 flex items-start gap-2\">\n                  <span className=\"text-amber-500\"></span>\n                  {obj}\n                </li>\n              ))}\n            </ul>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n\nexport function PlanningModule({ \n  workspaceId, \n  userId, \n  journeyId,\n  companyName, \n  role,\n  onComplete,\n  onBack \n}: PlanningModuleProps) {\n  const [inputMessage, setInputMessage] = useState('');\n  const [sprintGoal, setSprintGoal] = useState('');\n  const [visibleMessageCount, setVisibleMessageCount] = useState(0);\n  const [isStaggering, setIsStaggering] = useState(false);\n  const staggerTimeoutsRef = useRef<NodeJS.Timeout[]>([]);\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n  \n  const { data: sessionState, isLoading, refetch } = useQuery<PlanningSessionState>({\n    queryKey: [`/api/workspaces/${workspaceId}/planning`],\n    queryFn: async () => {\n      const response = await fetch(`/api/workspaces/${workspaceId}/planning?_t=${Date.now()}`);\n      if (!response.ok) throw new Error('Failed to fetch planning session');\n      return response.json();\n    },\n    staleTime: 0,\n    refetchOnMount: 'always',\n  });\n  \n  const initSession = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/workspaces/${workspaceId}/planning`, {});\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}/planning`] });\n    }\n  });\n  \n  const sendMessage = useMutation({\n    mutationFn: async (message: string) => {\n      const response = await apiRequest('POST', `/api/workspaces/${workspaceId}/planning/message`, { message });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}/planning`] });\n      setInputMessage('');\n    }\n  });\n  \n  const selectItems = useMutation({\n    mutationFn: async ({ selectedItems, capacityUsed }: { selectedItems: string[]; capacityUsed: number }) => {\n      const response = await apiRequest('POST', `/api/workspaces/${workspaceId}/planning/select-items`, { \n        selectedItems, \n        capacityUsed \n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}/planning`] });\n    }\n  });\n  \n  const setGoal = useMutation({\n    mutationFn: async (goalStatement: string) => {\n      const response = await apiRequest('POST', `/api/workspaces/${workspaceId}/planning/goal`, { goalStatement });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}/planning`] });\n    }\n  });\n  \n  const advancePhase = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('POST', `/api/workspaces/${workspaceId}/planning/advance`, {});\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}/planning`] });\n      if (data.completed) {\n        onComplete(sessionState?.session.goalStatement || '', (sessionState?.session.selectedItems as string[]) || []);\n      }\n    }\n  });\n  \n  useEffect(() => {\n    if (!sessionState && !isLoading) {\n      initSession.mutate();\n    }\n  }, [sessionState, isLoading]);\n  \n  // Message staggering effect - reveals messages one at a time with typing simulation\n  useEffect(() => {\n    if (!sessionState?.messages || !sessionState?.adapterConfig?.engagement?.messageStagger?.enabled) {\n      // No staggering - show all messages immediately\n      setVisibleMessageCount(sessionState?.messages?.length || 0);\n      return;\n    }\n    \n    const messages = sessionState.messages;\n    const staggerConfig = sessionState.adapterConfig.engagement.messageStagger;\n    \n    // If we already have all messages visible, nothing to do\n    if (visibleMessageCount >= messages.length) {\n      return;\n    }\n    \n    // Clear any existing timeouts\n    staggerTimeoutsRef.current.forEach(clearTimeout);\n    staggerTimeoutsRef.current = [];\n    \n    // If this is a fresh load (visibleMessageCount is 0), stagger from the beginning\n    // Otherwise, new messages were added - reveal them with stagger\n    const startIndex = visibleMessageCount === 0 ? 0 : visibleMessageCount;\n    \n    if (startIndex < messages.length) {\n      setIsStaggering(true);\n      \n      let cumulativeDelay = 0;\n      \n      for (let i = startIndex; i < messages.length; i++) {\n        const msg = messages[i];\n        // Calculate delay based on message length\n        const charDelay = Math.min(\n          msg.message.length * staggerConfig.perCharacterDelayMs,\n          staggerConfig.maxDelayMs\n        );\n        const delay = staggerConfig.baseDelayMs + charDelay;\n        cumulativeDelay += delay;\n        \n        const timeout = setTimeout(() => {\n          setVisibleMessageCount(i + 1);\n          if (i === messages.length - 1) {\n            setIsStaggering(false);\n          }\n        }, cumulativeDelay);\n        \n        staggerTimeoutsRef.current.push(timeout);\n      }\n    }\n    \n    return () => {\n      staggerTimeoutsRef.current.forEach(clearTimeout);\n      staggerTimeoutsRef.current = [];\n    };\n  }, [sessionState?.messages?.length, sessionState?.adapterConfig?.engagement?.messageStagger?.enabled]);\n  \n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [visibleMessageCount]);\n  \n  const handleSendMessage = () => {\n    if (inputMessage.trim()) {\n      sendMessage.mutate(inputMessage.trim());\n    }\n  };\n  \n  const handleToggleItem = (itemId: string) => {\n    if (!sessionState) return;\n    \n    const currentSelected = sessionState.session.selectedItems || [];\n    const newSelected = currentSelected.includes(itemId)\n      ? currentSelected.filter(id => id !== itemId)\n      : [...currentSelected, itemId];\n    \n    const capacityUsed = sessionState.backlogItems\n      .filter(item => newSelected.includes(item.id))\n      .reduce((sum, item) => sum + item.points, 0);\n    \n    selectItems.mutate({ selectedItems: newSelected, capacityUsed });\n  };\n  \n  const handleSetGoal = () => {\n    if (sprintGoal.trim()) {\n      setGoal.mutate(sprintGoal.trim());\n    }\n  };\n  \n  const canAdvance = () => {\n    if (!sessionState) return false;\n    const { session, backlogItems } = sessionState;\n    \n    switch (session.currentPhase) {\n      case 'context':\n        return sessionState.messages.length >= 2;\n      case 'discussion':\n        return (session.selectedItems || []).length > 0;\n      case 'commitment':\n        return !!session.goalStatement;\n      default:\n        return false;\n    }\n  };\n  \n  if (isLoading || !sessionState || !sessionState.session) {\n    return (\n      <div className=\"h-full p-6\" data-testid=\"planning-module-loading\">\n        <div className=\"space-y-4\">\n          <Skeleton className=\"h-8 w-48\" />\n          <Skeleton className=\"h-16 w-full\" />\n          <div className=\"grid grid-cols-2 gap-4 h-[500px]\">\n            <Skeleton className=\"h-full\" />\n            <Skeleton className=\"h-full\" />\n          </div>\n        </div>\n      </div>\n    );\n  }\n  \n  const defaultEngagement: LevelEngagement = {\n    mode: 'guided',\n    autoStartConversation: true,\n    teamTalkRatio: 0.5,\n    phaseEngagement: { context: 'respond', discussion: 'respond', commitment: 'respond' },\n    autoStartMessage: 'Good morning team! Let\\'s get started with our sprint planning.'\n  };\n  \n  const { \n    session, \n    messages = [], \n    backlogItems = [], \n    capacity = 20, \n    adapterConfig = { \n      role: role, \n      level: 'intern', \n      facilitator: 'ai', \n      showLearningObjectives: true, \n      showKnowledgeCheck: false, \n      canSkipPhases: false,\n      engagement: defaultEngagement\n    }\n  } = sessionState;\n  const selectedItems = (session.selectedItems as string[] | null) || [];\n  const engagement = adapterConfig.engagement || defaultEngagement;\n  const currentPhaseEngagement = engagement.phaseEngagement[session.currentPhase as keyof typeof engagement.phaseEngagement] || 'respond';\n  const promptSuggestions = engagement.promptSuggestions?.[session.currentPhase as keyof typeof engagement.promptSuggestions] || [];\n  \n  return (\n    <div className=\"h-full flex flex-col\" data-testid=\"planning-module\">\n      <div className=\"p-4 border-b\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-xl font-bold text-gray-900 dark:text-white\">Sprint Planning Meeting</h2>\n            <p className=\"text-sm text-gray-500 dark:text-gray-400\">{companyName}  {role}</p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            {onBack && (\n              <Button variant=\"outline\" size=\"sm\" onClick={onBack} data-testid=\"button-back-to-dashboard\">\n                <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                Back\n              </Button>\n            )}\n          </div>\n        </div>\n        \n        <PhaseProgress \n          currentPhase={session.currentPhase} \n          phaseCompletions={session.phaseCompletions as Record<string, boolean>} \n        />\n      </div>\n      \n      <div className=\"flex-1 flex overflow-hidden\">\n        <div className=\"flex-1 flex flex-col border-r\">\n          {adapterConfig.showLearningObjectives && (\n            <div className=\"p-4 pb-0\">\n              <LearningObjectives \n                phase={session.currentPhase} \n                role={adapterConfig.role} \n                level={adapterConfig.level} \n              />\n            </div>\n          )}\n          \n          <div className=\"flex-1 overflow-hidden p-4\">\n            <Card className=\"h-full flex flex-col\">\n              <CardHeader className=\"pb-2 border-b\">\n                <CardTitle className=\"text-base flex items-center justify-between\">\n                  <div className=\"flex items-center gap-2\">\n                    <MessageCircle className=\"h-4 w-4\" />\n                    Team Discussion\n                  </div>\n                  {engagement.mode === 'shadow' && (\n                    <Badge variant=\"secondary\" className=\"text-xs bg-amber-100 text-amber-700 dark:bg-amber-900 dark:text-amber-300\">\n                      Observing\n                    </Badge>\n                  )}\n                  {engagement.mode === 'guided' && (\n                    <Badge variant=\"secondary\" className=\"text-xs bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300\">\n                      Guided\n                    </Badge>\n                  )}\n                  {engagement.mode === 'active' && (\n                    <Badge variant=\"secondary\" className=\"text-xs bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300\">\n                      Active\n                    </Badge>\n                  )}\n                  {engagement.mode === 'facilitator' && (\n                    <Badge variant=\"secondary\" className=\"text-xs bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300\">\n                      Facilitating\n                    </Badge>\n                  )}\n                </CardTitle>\n                <CardDescription>\n                  {session.currentPhase === 'context' && currentPhaseEngagement === 'observe' && \"Watch how Priya presents priorities - you'll be asked for questions later\"}\n                  {session.currentPhase === 'context' && currentPhaseEngagement !== 'observe' && \"Priya is presenting sprint priorities\"}\n                  {session.currentPhase === 'discussion' && currentPhaseEngagement === 'observe' && \"Observe how the team discusses and estimates together\"}\n                  {session.currentPhase === 'discussion' && currentPhaseEngagement !== 'observe' && \"Discuss items and estimate as a team\"}\n                  {session.currentPhase === 'commitment' && \"Finalize the sprint commitment\"}\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"flex-1 overflow-hidden p-0 min-h-[200px]\">\n                <ScrollArea className=\"h-full min-h-[180px] p-4\">\n                  {messages.length === 0 && session.currentPhase === 'context' && (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      <MessageCircle className=\"h-12 w-12 mx-auto mb-3 opacity-50\" />\n                      {engagement.mode === 'shadow' ? (\n                        <>\n                          <p>The meeting is about to start...</p>\n                          <p className=\"text-sm mt-1\">Priya will kick things off. Feel free to observe!</p>\n                        </>\n                      ) : (\n                        <>\n                          <p>The meeting is about to start...</p>\n                          <p className=\"text-sm mt-1\">Say hello to join the discussion!</p>\n                        </>\n                      )}\n                    </div>\n                  )}\n                  {messages.slice(0, visibleMessageCount).map((msg) => (\n                    <ChatMessage key={msg.id} message={msg} />\n                  ))}\n                  {isStaggering && visibleMessageCount < messages.length && (\n                    <div className=\"flex gap-3 mb-4\">\n                      <Avatar className=\"h-8 w-8 bg-gray-100\">\n                        <AvatarFallback className=\"text-xs\">...</AvatarFallback>\n                      </Avatar>\n                      <div className=\"max-w-[80%] rounded-lg p-3 bg-white dark:bg-gray-800 border\">\n                        <div className=\"flex items-center gap-1\">\n                          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }} />\n                          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }} />\n                          <div className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }} />\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                  <div ref={messagesEndRef} />\n                </ScrollArea>\n              </CardContent>\n              <div className=\"p-4 border-t space-y-2\">\n                {promptSuggestions.length > 0 && (\n                  <div className=\"flex flex-wrap gap-2\">\n                    {promptSuggestions.map((suggestion, index) => (\n                      <Button\n                        key={index}\n                        variant=\"outline\"\n                        size=\"sm\"\n                        className=\"text-xs h-7\"\n                        onClick={() => setInputMessage(suggestion)}\n                        disabled={sendMessage.isPending}\n                        data-testid={`button-suggestion-${index}`}\n                      >\n                        {suggestion}\n                      </Button>\n                    ))}\n                  </div>\n                )}\n                <div className=\"flex gap-2\">\n                  <Input\n                    value={inputMessage}\n                    onChange={(e) => setInputMessage(e.target.value)}\n                    placeholder={engagement.mode === 'shadow' ? \"Type a question or observation...\" : \"Type your message...\"}\n                    onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}\n                    disabled={sendMessage.isPending}\n                    data-testid=\"input-chat-message\"\n                  />\n                  <Button \n                    onClick={handleSendMessage} \n                    disabled={!inputMessage.trim() || sendMessage.isPending}\n                    data-testid=\"button-send-message\"\n                  >\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </Card>\n          </div>\n          \n          {session.currentPhase === 'commitment' && (\n            <div className=\"p-4 pt-0\">\n              <Card>\n                <CardHeader className=\"pb-2\">\n                  <CardTitle className=\"text-base flex items-center gap-2\">\n                    <Target className=\"h-4 w-4\" />\n                    Sprint Goal\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex gap-2\">\n                    <Input\n                      value={sprintGoal}\n                      onChange={(e) => setSprintGoal(e.target.value)}\n                      placeholder=\"e.g., Fix critical bugs to improve user trust\"\n                      data-testid=\"input-sprint-goal\"\n                    />\n                    <Button \n                      onClick={handleSetGoal} \n                      disabled={!sprintGoal.trim() || setGoal.isPending}\n                      variant=\"secondary\"\n                    >\n                      Set Goal\n                    </Button>\n                  </div>\n                  {session.goalStatement && (\n                    <div className=\"mt-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200\">\n                      <div className=\"flex items-center gap-2 text-green-700 dark:text-green-300\">\n                        <CheckCircle2 className=\"h-4 w-4\" />\n                        <span className=\"font-medium text-sm\">{session.goalStatement}</span>\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            </div>\n          )}\n          \n          <div className=\"p-4 pt-0\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"text-sm text-muted-foreground\">\n                {session.currentPhase === 'context' && messages.length < 2 && \"Have a brief discussion first\"}\n                {session.currentPhase === 'discussion' && selectedItems.length === 0 && \"Select at least one backlog item\"}\n                {session.currentPhase === 'commitment' && !session.goalStatement && \"Set a sprint goal to continue\"}\n              </div>\n              <Button \n                onClick={() => advancePhase.mutate()}\n                disabled={!canAdvance() || advancePhase.isPending}\n                className={session.currentPhase === 'commitment' ? \"bg-green-600 hover:bg-green-700\" : \"\"}\n                data-testid=\"button-advance-phase\"\n              >\n                {advancePhase.isPending ? (\n                  \"Processing...\"\n                ) : session.currentPhase === 'commitment' ? (\n                  <>\n                    <Play className=\"h-4 w-4 mr-2\" />\n                    Start Sprint\n                  </>\n                ) : (\n                  <>\n                    Continue\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"w-80 p-4\">\n          <BacklogPanel\n            items={backlogItems}\n            selectedItems={selectedItems}\n            capacity={capacity}\n            onToggleItem={handleToggleItem}\n            disabled={session.currentPhase === 'context'}\n          />\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":31989,"size_tokens":null},"client/src/pages/workspace-planning.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { PlanningModule } from \"@/components/workspace/planning-module\";\nimport { PhaseGuard } from \"@/components/workspace/phase-guard\";\nimport { useWorkspaceState } from \"@/hooks/use-sprint-workflow\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function WorkspacePlanning() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6 space-y-6\" data-testid=\"workspace-planning-loading\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-24 w-full\" />\n        <Skeleton className=\"h-96 w-full\" />\n      </div>\n    );\n  }\n\n  if (error || !state || !workspaceId) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-planning-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Planning</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\"\n              onClick={() => navigate('/journey')}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              Back to Journey\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace } = state;\n\n  const handleComplete = (sprintGoal: string, selectedItems: string[]) => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  const handleBack = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  return (\n    <PhaseGuard\n      currentPhase={workspace.currentPhase}\n      requiredPhase=\"planning\"\n      workspaceId={workspaceId}\n      onNavigate={navigate}\n    >\n      <div className=\"h-[calc(100vh-80px)]\" data-testid=\"workspace-planning\">\n        <PlanningModule\n          workspaceId={workspaceId}\n          userId={workspace.userId}\n          journeyId={workspace.journeyId}\n          companyName={workspace.companyName}\n          role={workspace.role}\n          onComplete={handleComplete}\n          onBack={handleBack}\n        />\n      </div>\n    </PhaseGuard>\n  );\n}\n","path":null,"size_bytes":2732,"size_tokens":null},"client/src/pages/workspace-review.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { ReviewModule } from \"@/components/workspace/review-module\";\nimport { PhaseGuard } from \"@/components/workspace/phase-guard\";\nimport { useWorkspaceState } from \"@/hooks/use-sprint-workflow\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function WorkspaceReview() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6 space-y-6\" data-testid=\"workspace-review-loading\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-24 w-full\" />\n        <Skeleton className=\"h-64 w-full\" />\n      </div>\n    );\n  }\n\n  if (error || !state || !workspaceId) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-review-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Review</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\"\n              onClick={() => navigate('/journey')}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              Back to Journey\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace } = state;\n\n  const handleComplete = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  const handleBack = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  return (\n    <PhaseGuard\n      currentPhase={workspace.currentPhase}\n      requiredPhase=\"review\"\n      workspaceId={workspaceId}\n      onNavigate={navigate}\n    >\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-review\">\n        <ReviewModule\n          workspaceId={workspaceId}\n          userId={workspace.userId}\n          journeyId={workspace.journeyId}\n          companyName={workspace.companyName}\n          role={workspace.role}\n          onComplete={handleComplete}\n          onBack={handleBack}\n        />\n      </div>\n    </PhaseGuard>\n  );\n}\n","path":null,"size_bytes":2682,"size_tokens":null},"client/src/pages/workspace-onboarding.tsx":{"content":"import { useParams, useLocation } from \"wouter\";\nimport { OnboardingModule } from \"@/components/workspace/onboarding-module\";\nimport { PhaseGuard } from \"@/components/workspace/phase-guard\";\nimport { useWorkspaceState } from \"@/hooks/use-sprint-workflow\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { ChevronLeft } from \"lucide-react\";\n\nexport default function WorkspaceOnboarding() {\n  const params = useParams<{ workspaceId: string }>();\n  const workspaceId = params.workspaceId ? parseInt(params.workspaceId) : null;\n  const [, navigate] = useLocation();\n  \n  const { data: state, isLoading, error } = useWorkspaceState(workspaceId);\n\n  if (isLoading) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6 space-y-6\" data-testid=\"workspace-onboarding-loading\">\n        <Skeleton className=\"h-8 w-48\" />\n        <Skeleton className=\"h-24 w-full\" />\n        <Skeleton className=\"h-96 w-full\" />\n      </div>\n    );\n  }\n\n  if (error || !state || !workspaceId) {\n    return (\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-onboarding-error\">\n        <Card className=\"border-destructive\">\n          <CardHeader>\n            <CardTitle className=\"text-destructive\">Error Loading Onboarding</CardTitle>\n            <CardDescription>\n              {error?.message || 'Workspace not found. Please check the URL and try again.'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Button \n              variant=\"outline\" \n              className=\"gap-2\"\n              onClick={() => navigate('/journey')}\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n              Back to Journey\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { workspace } = state;\n\n  const handleComplete = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  const handleBack = () => {\n    navigate(`/workspace/${workspaceId}`);\n  };\n\n  return (\n    <PhaseGuard\n      currentPhase={workspace.currentPhase}\n      requiredPhase=\"onboarding\"\n      workspaceId={workspaceId}\n      onNavigate={navigate}\n    >\n      <div className=\"container max-w-4xl mx-auto p-6\" data-testid=\"workspace-onboarding\">\n        <OnboardingModule\n          workspaceId={workspaceId}\n          userId={workspace.userId}\n          companyName={workspace.companyName}\n          role={workspace.role}\n          onComplete={handleComplete}\n          onBack={handleBack}\n        />\n      </div>\n    </PhaseGuard>\n  );\n}\n","path":null,"size_bytes":2676,"size_tokens":null},"client/src/components/workspace/onboarding-module.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Input } from \"@/components/ui/input\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useLocation } from \"wouter\";\nimport { \n  Users, \n  FileText, \n  MessageSquare, \n  MessageCircle,\n  CheckCircle2, \n  Clock,\n  BookOpen,\n  ChevronRight,\n  ChevronDown,\n  ArrowLeft,\n  ArrowRight,\n  Sparkles,\n  Store,\n  Send,\n  Play,\n  Target,\n  Coffee\n} from \"lucide-react\";\nimport { cn } from \"@/lib/utils\";\nimport { useAdvanceWorkspacePhase, type WorkspacePhase } from \"@/hooks/use-sprint-workflow\";\n\ninterface TeamMember {\n  name: string;\n  role: string;\n  personality: string;\n  expertise: string[];\n  availability: string;\n  bio?: string;\n}\n\ninterface OnboardingProgress {\n  teamIntrosComplete: Record<string, boolean>;\n  docsRead: Record<string, boolean>;\n  comprehensionComplete: boolean;\n}\n\ninterface OnboardingModuleProps {\n  workspaceId: number;\n  userId: number;\n  companyName: string;\n  role: string;\n  onComplete: () => void;\n  onBack?: () => void;\n}\n\nconst DEFAULT_TEAM: TeamMember[] = [\n  {\n    name: \"Marcus\",\n    role: \"Senior Developer\",\n    personality: \"Detail-oriented and patient\",\n    expertise: [\"Backend\", \"Databases\", \"Performance\"],\n    availability: \"Prefers async communication\",\n    bio: \"Marcus is the go-to person for complex backend issues and database optimization.\"\n  },\n  {\n    name: \"Priya\",\n    role: \"Product Manager\",\n    personality: \"Energetic and clear communicator\",\n    expertise: [\"Requirements\", \"User Research\", \"Prioritization\"],\n    availability: \"Available for quick syncs\",\n    bio: \"Priya bridges the gap between business needs and technical implementation.\"\n  },\n  {\n    name: \"Alex\",\n    role: \"QA Engineer\",\n    personality: \"Thorough and helpful\",\n    expertise: [\"Testing\", \"Bug Reports\", \"Automation\"],\n    availability: \"Best reached via Slack\",\n    bio: \"Alex ensures our code quality stays high and catches issues before they reach users.\"\n  }\n];\n\nconst DOCUMENTATION_SECTIONS = [\n  { id: \"product\", title: \"Product Overview\", icon: Store, description: \"Learn what we build and why\" },\n  { id: \"users\", title: \"Our Users\", icon: Users, description: \"Understand who uses our product\" },\n  { id: \"norms\", title: \"Team Norms\", icon: MessageSquare, description: \"How we work together\" },\n  { id: \"workflow\", title: \"Development Workflow\", icon: Target, description: \"Our development process\" }\n];\n\nfunction getAvatarUrl(name: string) {\n  const avatarSeeds: Record<string, { seed: string; style: string }> = {\n    'Sarah': { seed: 'sarah-tech-lead', style: 'avataaars' },\n    'Marcus': { seed: 'marcus-senior-dev', style: 'avataaars' },\n    'Priya': { seed: 'priya-product-mgr', style: 'avataaars' },\n    'Alex': { seed: 'alex-qa-engineer', style: 'avataaars' }\n  };\n  const config = avatarSeeds[name] || { seed: name, style: 'avataaars' };\n  return `https://api.dicebear.com/7.x/${config.style}/svg?seed=${config.seed}&backgroundColor=b6e3f4,c0aede,d1d4f9,ffd5dc,ffdfbf`;\n}\n\nfunction getMemberColor(name: string) {\n  const colors: Record<string, string> = {\n    'Sarah': 'bg-blue-500',\n    'Marcus': 'bg-green-500',\n    'Priya': 'bg-purple-500',\n    'Alex': 'bg-orange-500'\n  };\n  return colors[name] || 'bg-gray-500';\n}\n\nfunction getInitials(name: string) {\n  return name.split(' ').map(n => n[0]).join('').toUpperCase();\n}\n\ntype OnboardingStep = 'overview' | 'team-intro' | 'documentation' | 'comprehension';\n\nexport function OnboardingModule({ \n  workspaceId, \n  userId, \n  companyName, \n  role,\n  onComplete,\n  onBack \n}: OnboardingModuleProps) {\n  const [currentStep, setCurrentStep] = useState<OnboardingStep>('overview');\n  const [selectedMember, setSelectedMember] = useState<TeamMember | null>(null);\n  const [expandedDocs, setExpandedDocs] = useState<Record<string, boolean>>({});\n  const [activeDocTab, setActiveDocTab] = useState<string>('product');\n  const [chatMessage, setChatMessage] = useState('');\n  const [chatHistory, setChatHistory] = useState<Array<{ sender: string; message: string }>>([]);\n  const [teamChatMessages, setTeamChatMessages] = useState<Record<string, Array<{ sender: string; message: string }>>>({});\n  const [teamChatInput, setTeamChatInput] = useState('');\n  const [isAIResponding, setIsAIResponding] = useState(false);\n  const [conversationsClosed, setConversationsClosed] = useState<Record<string, boolean>>({});\n  const [topicsCovered, setTopicsCovered] = useState<Record<string, {\n    userProfessional: boolean;\n    userPersonal: boolean;\n    teammateProfessional: boolean;\n    teammatePersonal: boolean;\n  }>>({});\n  const [isSarahResponding, setIsSarahResponding] = useState(false);\n  const [sarahConversationClosed, setSarahConversationClosed] = useState(false);\n  const [sarahTopicsCovered, setSarahTopicsCovered] = useState({\n    userShowedUnderstanding: false,\n    userAskedQuestions: false,\n    sarahAnsweredQuestions: false,\n    sarahOfferedNextSteps: false\n  });\n  \n  const [progress, setProgress] = useState<OnboardingProgress>({\n    teamIntrosComplete: {},\n    docsRead: {},\n    comprehensionComplete: false\n  });\n\n  const { data: workspace } = useQuery<{ workspaceMetadata?: { onboardingProgress?: OnboardingProgress } }>({\n    queryKey: [`/api/workspaces/${workspaceId}`],\n  });\n\n  useEffect(() => {\n    if (workspace?.workspaceMetadata?.onboardingProgress) {\n      const savedProgress = workspace.workspaceMetadata.onboardingProgress;\n      setProgress(savedProgress);\n      if (savedProgress.docsRead) {\n        setExpandedDocs(savedProgress.docsRead);\n      }\n    }\n  }, [workspace]);\n\n  const [, navigate] = useLocation();\n  const advanceWorkspacePhase = useAdvanceWorkspacePhase();\n\n  const saveProgressMutation = useMutation({\n    mutationFn: async (newProgress: OnboardingProgress) => {\n      return apiRequest('PATCH', `/api/workspaces/${workspaceId}`, {\n        workspaceMetadata: {\n          ...(workspace?.workspaceMetadata || {}),\n          onboardingProgress: newProgress\n        }\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [`/api/workspaces/${workspaceId}`] });\n      queryClient.invalidateQueries({ queryKey: ['/api/workspaces', workspaceId, 'state'] });\n    }\n  });\n\n  const updateProgress = (newProgress: OnboardingProgress) => {\n    setProgress(newProgress);\n    saveProgressMutation.mutate(newProgress);\n  };\n\n  const teamIntroCount = Object.values(progress.teamIntrosComplete).filter(Boolean).length;\n  const docsReadCount = Object.values(progress.docsRead).filter(Boolean).length;\n  const allTeamIntrosComplete = teamIntroCount >= DEFAULT_TEAM.length;\n  const allDocsRead = docsReadCount >= DOCUMENTATION_SECTIONS.length;\n  \n  const overallProgress = (\n    (teamIntroCount / DEFAULT_TEAM.length) * 33 +\n    (docsReadCount / DOCUMENTATION_SECTIONS.length) * 33 +\n    (progress.comprehensionComplete ? 34 : 0)\n  );\n\n  const handleStartPlanning = async () => {\n    try {\n      await advanceWorkspacePhase.mutateAsync({ workspaceId });\n      navigate(`/workspace/${workspaceId}/planning`);\n    } catch (error) {\n      console.error('Failed to advance to planning phase:', error);\n    }\n  };\n\n  const handleTeamIntroComplete = (memberName: string) => {\n    const newProgress = {\n      ...progress,\n      teamIntrosComplete: { ...progress.teamIntrosComplete, [memberName]: true }\n    };\n    updateProgress(newProgress);\n    setSelectedMember(null);\n  };\n\n  const handleDocRead = (docId: string) => {\n    const newProgress = {\n      ...progress,\n      docsRead: { ...progress.docsRead, [docId]: true }\n    };\n    updateProgress(newProgress);\n    setExpandedDocs(prev => ({ ...prev, [docId]: true }));\n  };\n\n  const handleComprehensionComplete = () => {\n    const newProgress = { ...progress, comprehensionComplete: true };\n    updateProgress(newProgress);\n  };\n\n  const handleSendMessage = async () => {\n    if (!chatMessage.trim() || isSarahResponding) return;\n    \n    const userMessageText = chatMessage;\n    const currentHistory = chatHistory;\n    \n    const newUserMessage = { sender: 'You', message: userMessageText };\n    setChatHistory(prev => [...prev, newUserMessage]);\n    setChatMessage('');\n    setIsSarahResponding(true);\n    \n    try {\n      const res = await apiRequest('POST', `/api/workspaces/${workspaceId}/comprehension-chat`, {\n        userMessage: userMessageText,\n        conversationHistory: [...currentHistory, newUserMessage]\n      });\n      const data = await res.json();\n      \n      await new Promise(resolve => setTimeout(resolve, 800 + Math.random() * 800));\n      \n      const sarahResponse = { sender: 'Sarah', message: data.response };\n      setChatHistory(prev => [...prev, sarahResponse]);\n      \n      if (data.topicsCovered) {\n        setSarahTopicsCovered(data.topicsCovered);\n      }\n      \n      if (data.isClosing || data.completionState === 'closed') {\n        setSarahConversationClosed(true);\n        handleComprehensionComplete();\n      }\n    } catch (error) {\n      console.error('Failed to get Sarah response:', error);\n      const fallbackResponse = { \n        sender: 'Sarah', \n        message: \"That's great! You've got a good understanding. Let me know if you have any questions!\" \n      };\n      setChatHistory(prev => [...prev, fallbackResponse]);\n    } finally {\n      setIsSarahResponding(false);\n    }\n  };\n\n  const chatScrollRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    if (chatScrollRef.current) {\n      chatScrollRef.current.scrollTop = chatScrollRef.current.scrollHeight;\n    }\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [teamChatMessages, isAIResponding, chatHistory, isSarahResponding]);\n\n  const handleTeamChatSend = async () => {\n    if (!teamChatInput.trim() || !selectedMember || isAIResponding) return;\n    \n    const memberName = selectedMember.name;\n    const currentMessages = teamChatMessages[memberName] || [];\n    const userMessageText = teamChatInput;\n    \n    const newUserMessage = { sender: 'You', message: userMessageText };\n    setTeamChatMessages(prev => ({\n      ...prev,\n      [memberName]: [...(prev[memberName] || []), newUserMessage]\n    }));\n    setTeamChatInput('');\n    setIsAIResponding(true);\n\n    try {\n      const res = await apiRequest('POST', `/api/workspaces/${workspaceId}/onboarding-chat`, {\n        teamMemberName: memberName,\n        userMessage: userMessageText,\n        conversationHistory: [...currentMessages, newUserMessage]\n      });\n      const data = await res.json();\n      \n      // Add a realistic typing delay (1-2 seconds) before showing response\n      await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 1000));\n      \n      const aiResponse = { sender: memberName, message: data.response };\n      setTeamChatMessages(prev => ({\n        ...prev,\n        [memberName]: [...(prev[memberName] || []), aiResponse]\n      }));\n      \n      // Track topics covered and closing state\n      if (data.topicsCovered) {\n        setTopicsCovered(prev => ({ ...prev, [memberName]: data.topicsCovered }));\n      }\n      if (data.isClosing) {\n        setConversationsClosed(prev => ({ ...prev, [memberName]: true }));\n      }\n    } catch (error) {\n      console.error('Failed to get chat response:', error);\n      const fallbackResponse = { sender: memberName, message: \"Sorry, I got distracted for a moment. What were you saying?\" };\n      setTeamChatMessages(prev => ({\n        ...prev,\n        [memberName]: [...(prev[memberName] || []), fallbackResponse]\n      }));\n    }\n    \n    setIsAIResponding(false);\n  };\n\n  const renderOverview = () => (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">Onboarding</h2>\n          <p className=\"text-gray-500 dark:text-gray-400\">Welcome to {companyName}! Let's get you started.</p>\n        </div>\n        {onBack && (\n          <Button variant=\"outline\" onClick={onBack} data-testid=\"button-back-to-dashboard\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Back\n          </Button>\n        )}\n      </div>\n\n      <Card className=\"bg-gradient-to-r from-teal-50 to-cyan-50 dark:from-teal-900/20 dark:to-cyan-900/20 border-teal-200 dark:border-teal-800\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-center gap-4\">\n            <div className=\"h-12 w-12 rounded-full bg-teal-100 dark:bg-teal-800 flex items-center justify-center\">\n              <Coffee className=\"h-6 w-6 text-teal-600 dark:text-teal-300\" />\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-teal-900 dark:text-teal-100\">Day 1: Getting Oriented</h3>\n              <p className=\"text-sm text-teal-700 dark:text-teal-300\">\n                Read the docs, meet your team, and check in with Sarah\n              </p>\n            </div>\n            <div className=\"text-right\">\n              <div className=\"text-2xl font-bold text-teal-600\">{Math.round(overallProgress)}%</div>\n              <div className=\"text-xs text-teal-500\">Complete</div>\n            </div>\n          </div>\n          <Progress value={overallProgress} className=\"mt-4 h-2\" />\n        </CardContent>\n      </Card>\n\n      <div className=\"grid gap-4\">\n        {/* Step 1: Read Documentation */}\n        <Card \n          className={cn(\n            \"cursor-pointer transition-all hover:shadow-md\",\n            allDocsRead ? \"border-green-200 bg-green-50/50 dark:bg-green-900/10\" : \"\"\n          )}\n          onClick={() => setCurrentStep('documentation')}\n          data-testid=\"card-documentation\"\n        >\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className={cn(\n                  \"h-10 w-10 rounded-full flex items-center justify-center\",\n                  allDocsRead ? \"bg-green-100\" : \"bg-purple-100\"\n                )}>\n                  <BookOpen className={cn(\n                    \"h-5 w-5\",\n                    allDocsRead ? \"text-green-600\" : \"text-purple-600\"\n                  )} />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold\">Read Documentation</h4>\n                  <p className=\"text-sm text-gray-500\">Learn about the product and how we work</p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Badge variant={allDocsRead ? \"default\" : \"secondary\"}>\n                  {docsReadCount}/{DOCUMENTATION_SECTIONS.length}\n                </Badge>\n                {allDocsRead ? (\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                ) : (\n                  <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                )}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Step 2: Meet Your Team (unlocks after documentation) */}\n        <Card \n          className={cn(\n            \"cursor-pointer transition-all\",\n            !allDocsRead ? \"opacity-60 cursor-not-allowed\" : \"hover:shadow-md\",\n            allTeamIntrosComplete ? \"border-green-200 bg-green-50/50 dark:bg-green-900/10\" : \"\"\n          )}\n          onClick={() => allDocsRead && setCurrentStep('team-intro')}\n          data-testid=\"card-team-intro\"\n        >\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className={cn(\n                  \"h-10 w-10 rounded-full flex items-center justify-center\",\n                  allTeamIntrosComplete ? \"bg-green-100\" : \"bg-blue-100\"\n                )}>\n                  <Users className={cn(\n                    \"h-5 w-5\",\n                    allTeamIntrosComplete ? \"text-green-600\" : \"text-blue-600\"\n                  )} />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold\">Meet Your Team</h4>\n                  <p className=\"text-sm text-gray-500\">\n                    {allDocsRead \n                      ? \"Get to know the people you'll be working with\" \n                      : \"Complete documentation first\"\n                    }\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {!allDocsRead && <Clock className=\"h-5 w-5 text-gray-400\" />}\n                {allDocsRead && (\n                  <Badge variant={allTeamIntrosComplete ? \"default\" : \"secondary\"}>\n                    {teamIntroCount}/{DEFAULT_TEAM.length}\n                  </Badge>\n                )}\n                {allTeamIntrosComplete ? (\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                ) : allDocsRead ? (\n                  <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                ) : null}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Step 3: Check in with Sarah (unlocks after team intro) */}\n        <Card \n          className={cn(\n            \"cursor-pointer transition-all\",\n            !allTeamIntrosComplete ? \"opacity-60 cursor-not-allowed\" : \"hover:shadow-md\",\n            progress.comprehensionComplete ? \"border-green-200 bg-green-50/50 dark:bg-green-900/10\" : \"\"\n          )}\n          onClick={() => allTeamIntrosComplete && setCurrentStep('comprehension')}\n          data-testid=\"card-comprehension\"\n        >\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className={cn(\n                  \"h-10 w-10 rounded-full flex items-center justify-center\",\n                  progress.comprehensionComplete ? \"bg-green-100\" : \"bg-indigo-100\"\n                )}>\n                  <MessageSquare className={cn(\n                    \"h-5 w-5\",\n                    progress.comprehensionComplete ? \"text-green-600\" : \"text-indigo-600\"\n                  )} />\n                </div>\n                <div>\n                  <h4 className=\"font-semibold\">Check in with Sarah</h4>\n                  <p className=\"text-sm text-gray-500\">\n                    {allTeamIntrosComplete \n                      ? \"Discuss what you've learned\" \n                      : \"Complete team introductions first\"\n                    }\n                  </p>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                {!allTeamIntrosComplete && <Clock className=\"h-5 w-5 text-gray-400\" />}\n                {progress.comprehensionComplete ? (\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                ) : allTeamIntrosComplete ? (\n                  <ChevronRight className=\"h-5 w-5 text-gray-400\" />\n                ) : null}\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {allTeamIntrosComplete && allDocsRead && progress.comprehensionComplete && (\n        <Card className=\"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 border-green-200 dark:border-green-800\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-4\">\n                <div className=\"h-12 w-12 rounded-full bg-green-100 flex items-center justify-center\">\n                  <Sparkles className=\"h-6 w-6 text-green-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-green-900 dark:text-green-100\">Onboarding Complete!</h3>\n                  <p className=\"text-sm text-green-700 dark:text-green-300\">\n                    You're ready to move on to Sprint Planning\n                  </p>\n                </div>\n              </div>\n              <Button \n                onClick={handleStartPlanning}\n                disabled={advanceWorkspacePhase.isPending}\n                className=\"bg-green-600 hover:bg-green-700\"\n                data-testid=\"button-complete-onboarding\"\n              >\n                <ArrowRight className=\"h-4 w-4 mr-2\" />\n                Start Planning\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  );\n\n  const renderTeamIntro = () => {\n    if (selectedMember) {\n      const memberMessages = teamChatMessages[selectedMember.name] || [];\n      \n      return (\n        <div className=\"space-y-4\">\n          <div className=\"flex items-center gap-4 mb-6\">\n            <Button variant=\"ghost\" size=\"sm\" onClick={() => setSelectedMember(null)} data-testid=\"button-back-to-team\">\n              <ArrowLeft className=\"h-4 w-4 mr-1\" />\n              Back to Team\n            </Button>\n          </div>\n          \n          <Card className=\"bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 border-blue-200\">\n            <CardContent className=\"p-4\">\n              <div className=\"flex items-center gap-4\">\n                <Avatar className=\"h-12 w-12 ring-2 ring-white shadow-md\">\n                  <AvatarImage src={getAvatarUrl(selectedMember.name)} alt={selectedMember.name} />\n                  <AvatarFallback className={cn(\"text-white\", getMemberColor(selectedMember.name))}>\n                    {getInitials(selectedMember.name)}\n                  </AvatarFallback>\n                </Avatar>\n                <div>\n                  <h3 className=\"font-semibold\">{selectedMember.name}</h3>\n                  <p className=\"text-sm text-gray-500\">{selectedMember.role}</p>\n                </div>\n              </div>\n              <div className=\"mt-3 flex flex-wrap gap-2\">\n                {selectedMember.expertise.map((skill, i) => (\n                  <Badge key={i} variant=\"secondary\" className=\"text-xs\">{skill}</Badge>\n                ))}\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Topic progress indicator */}\n          {memberMessages.length > 0 && topicsCovered[selectedMember.name] && (\n            <div className=\"flex items-center gap-3 text-xs text-gray-500 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3\">\n              <span className=\"font-medium\">Getting to know each other:</span>\n              <div className=\"flex gap-2 flex-wrap\">\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  topicsCovered[selectedMember.name].userProfessional \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Your background {topicsCovered[selectedMember.name].userProfessional && \"\"}\n                </span>\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  topicsCovered[selectedMember.name].userPersonal \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Your hobbies {topicsCovered[selectedMember.name].userPersonal && \"\"}\n                </span>\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  topicsCovered[selectedMember.name].teammateProfessional \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Their work {topicsCovered[selectedMember.name].teammateProfessional && \"\"}\n                </span>\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  topicsCovered[selectedMember.name].teammatePersonal \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Their hobbies {topicsCovered[selectedMember.name].teammatePersonal && \"\"}\n                </span>\n              </div>\n            </div>\n          )}\n\n          <Card>\n            <CardHeader className=\"pb-2\">\n              <CardTitle className=\"text-base flex items-center gap-2\">\n                <MessageSquare className=\"h-4 w-4\" />\n                Chat with {selectedMember.name}\n              </CardTitle>\n              <CardDescription>\n                Get to know {selectedMember.name} - ask about their background, experience, or hobbies\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"p-4 pt-0\">\n              <div ref={chatScrollRef} className=\"min-h-[320px] max-h-[480px] overflow-y-auto pr-4 mb-4\">\n                <div className=\"space-y-3\">\n                  {memberMessages.length === 0 && (\n                    <div className=\"text-center py-6 text-gray-400 text-sm\">\n                      <p>Start a conversation! Try asking about:</p>\n                      <div className=\"flex flex-wrap justify-center gap-2 mt-2\">\n                        <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\" onClick={() => setTeamChatInput(\"How long have you been at the company?\")}>\n                          Their background\n                        </Badge>\n                        <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\" onClick={() => setTeamChatInput(\"What do you like most about working here?\")}>\n                          Work experience\n                        </Badge>\n                        <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\" onClick={() => setTeamChatInput(\"What do you do outside of work?\")}>\n                          Hobbies\n                        </Badge>\n                      </div>\n                    </div>\n                  )}\n                  {memberMessages.map((msg, idx) => (\n                    <div\n                      key={idx}\n                      className={cn(\n                        \"flex gap-2\",\n                        msg.sender === 'You' ? \"justify-end\" : \"justify-start\"\n                      )}\n                    >\n                      {msg.sender !== 'You' && (\n                        <Avatar className=\"h-8 w-8 shrink-0\">\n                          <AvatarImage src={getAvatarUrl(selectedMember.name)} alt={selectedMember.name} />\n                          <AvatarFallback className={cn(\"text-white text-xs\", getMemberColor(selectedMember.name))}>\n                            {getInitials(selectedMember.name)}\n                          </AvatarFallback>\n                        </Avatar>\n                      )}\n                      <div\n                        className={cn(\n                          \"rounded-lg px-3 py-2 max-w-[80%] text-sm\",\n                          msg.sender === 'You'\n                            ? \"bg-primary text-primary-foreground\"\n                            : \"bg-gray-100 dark:bg-gray-800\"\n                        )}\n                      >\n                        {msg.message}\n                      </div>\n                    </div>\n                  ))}\n                  {isAIResponding && (\n                    <div className=\"flex gap-2\">\n                      <Avatar className=\"h-8 w-8 shrink-0\">\n                        <AvatarImage src={getAvatarUrl(selectedMember.name)} alt={selectedMember.name} />\n                        <AvatarFallback className={cn(\"text-white text-xs\", getMemberColor(selectedMember.name))}>\n                          {getInitials(selectedMember.name)}\n                        </AvatarFallback>\n                      </Avatar>\n                      <div className=\"bg-gray-100 dark:bg-gray-800 rounded-lg px-3 py-2 text-sm flex items-center gap-1\">\n                        <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></span>\n                        <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></span>\n                        <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></span>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n              \n              {conversationsClosed[selectedMember.name] ? (\n                <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 rounded-lg p-3 text-center\">\n                  <p className=\"text-sm text-green-700 dark:text-green-300\">\n                    Great chat! You've gotten to know {selectedMember.name}.\n                  </p>\n                </div>\n              ) : (\n                <div className=\"flex gap-2\">\n                  <Textarea\n                    value={teamChatInput}\n                    onChange={(e) => setTeamChatInput(e.target.value)}\n                    placeholder={`Say hi to ${selectedMember.name}...`}\n                    className=\"min-h-[60px] resize-none\"\n                    onKeyDown={(e) => {\n                      if (e.key === 'Enter' && !e.shiftKey) {\n                        e.preventDefault();\n                        handleTeamChatSend();\n                      }\n                    }}\n                    data-testid=\"input-team-chat\"\n                  />\n                  <Button \n                    onClick={handleTeamChatSend} \n                    disabled={!teamChatInput.trim() || isAIResponding}\n                    size=\"icon\"\n                    className=\"shrink-0 h-[60px] w-[60px]\"\n                    data-testid=\"button-send-team-chat\"\n                  >\n                    <Send className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n\n          {conversationsClosed[selectedMember.name] ? (\n            <Button \n              className=\"w-full bg-green-600 hover:bg-green-700\"\n              onClick={() => handleTeamIntroComplete(selectedMember.name)}\n              data-testid=\"button-complete-intro\"\n            >\n              <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n              Complete Introduction\n            </Button>\n          ) : memberMessages.length > 0 ? (\n            <div className=\"text-center text-sm text-gray-500 py-2\">\n              Keep chatting to learn about each other's background and interests\n            </div>\n          ) : (\n            <div className=\"text-center text-sm text-gray-500 py-2\">\n              Start a conversation to get to know {selectedMember.name}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    return (\n      <div className=\"space-y-4\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h3 className=\"text-lg font-semibold\">Your Team</h3>\n            <p className=\"text-sm text-gray-500\">Click on each person to learn more about them</p>\n          </div>\n          <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentStep('overview')} data-testid=\"button-back-to-overview\">\n            <ArrowLeft className=\"h-4 w-4 mr-1\" />\n            Back\n          </Button>\n        </div>\n\n        <div className=\"grid gap-3\">\n          {DEFAULT_TEAM.map((member, idx) => (\n            <Card \n              key={idx}\n              className={cn(\n                \"cursor-pointer transition-all hover:shadow-md\",\n                progress.teamIntrosComplete[member.name] ? \"border-green-200 bg-green-50/30\" : \"\"\n              )}\n              onClick={() => setSelectedMember(member)}\n              data-testid={`team-member-${member.name.toLowerCase()}`}\n            >\n              <CardContent className=\"p-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <Avatar className=\"h-10 w-10 ring-2 ring-white shadow-sm\">\n                      <AvatarImage src={getAvatarUrl(member.name)} alt={member.name} />\n                      <AvatarFallback className={cn(\"text-white\", getMemberColor(member.name))}>\n                        {getInitials(member.name)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <div className=\"flex items-center gap-2\">\n                        <p className=\"font-medium\">{member.name}</p>\n                        {progress.teamIntrosComplete[member.name] && (\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                        )}\n                      </div>\n                      <p className=\"text-sm text-gray-500\">{member.role}</p>\n                    </div>\n                  </div>\n                  <div className=\"flex flex-wrap gap-1 max-w-[150px]\">\n                    {member.expertise.slice(0, 2).map((skill, i) => (\n                      <Badge key={i} variant=\"outline\" className=\"text-xs\">{skill}</Badge>\n                    ))}\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n\n        {/* Progress indicator and Continue button */}\n        <Card className={cn(\n          \"mt-4 transition-all\",\n          allTeamIntrosComplete \n            ? \"bg-gradient-to-r from-green-50 to-indigo-50 dark:from-green-900/20 dark:to-indigo-900/20 border-green-200\" \n            : \"bg-gray-50 dark:bg-gray-800/50\"\n        )}>\n          <CardContent className=\"p-4\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-3\">\n                {allTeamIntrosComplete ? (\n                  <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\n                    <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                  </div>\n                ) : (\n                  <div className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                    <Users className=\"h-5 w-5 text-gray-500\" />\n                  </div>\n                )}\n                <div>\n                  <p className={cn(\"font-medium\", allTeamIntrosComplete ? \"text-green-800 dark:text-green-200\" : \"text-gray-600\")}>\n                    {allTeamIntrosComplete ? \"You've met everyone!\" : \"Keep chatting...\"}\n                  </p>\n                  <p className=\"text-sm text-gray-500\">\n                    {Object.values(progress.teamIntrosComplete).filter(Boolean).length} of {DEFAULT_TEAM.length} team members\n                  </p>\n                </div>\n              </div>\n              {allTeamIntrosComplete && (\n                <Button \n                  onClick={() => setCurrentStep('comprehension')}\n                  className=\"bg-indigo-600 hover:bg-indigo-700\"\n                  data-testid=\"button-continue-to-sarah\"\n                >\n                  Check in with Sarah\n                  <ArrowRight className=\"h-4 w-4 ml-2\" />\n                </Button>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  };\n\n  const renderDocumentation = () => (\n    <div className=\"space-y-4\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">Onboarding Documentation</h3>\n          <p className=\"text-sm text-gray-500\">Read through all sections to continue</p>\n        </div>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentStep('overview')} data-testid=\"button-back-to-overview\">\n          <ArrowLeft className=\"h-4 w-4 mr-1\" />\n          Back\n        </Button>\n      </div>\n\n      <Tabs value={activeDocTab} onValueChange={setActiveDocTab}>\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"product\" data-testid=\"tab-product\">\n            <Store className=\"h-4 w-4 mr-2\" />\n            Product\n          </TabsTrigger>\n          <TabsTrigger value=\"team\" data-testid=\"tab-team\">\n            <Users className=\"h-4 w-4 mr-2\" />\n            Team\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value=\"product\" className=\"mt-4 space-y-4\">\n          {DOCUMENTATION_SECTIONS.slice(0, 2).map(section => (\n            <Collapsible \n              key={section.id}\n              open={expandedDocs[section.id]}\n              onOpenChange={(open) => {\n                if (open) handleDocRead(section.id);\n                setExpandedDocs(prev => ({ ...prev, [section.id]: open }));\n              }}\n            >\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid={`section-${section.id}`}>\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <section.icon className=\"h-4 w-4 text-blue-600\" />\n                        {section.title}\n                        {progress.docsRead[section.id] && (\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                        )}\n                      </CardTitle>\n                      {expandedDocs[section.id] ? (\n                        <ChevronDown className=\"h-4 w-4\" />\n                      ) : (\n                        <ChevronRight className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <CardDescription>{section.description}</CardDescription>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0\">\n                    <Separator className=\"my-3\" />\n                    <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n                      {section.id === 'product' && (\n                        <div className=\"space-y-3 text-gray-700 dark:text-gray-300\">\n                          <p>\n                            {companyName} builds payment infrastructure for small and medium businesses.\n                            Our Merchant Dashboard helps business owners track transactions, manage refunds,\n                            and understand their revenue patterns.\n                          </p>\n                          <p>\n                            As a {role}, you'll be working on features that help merchants manage their\n                            daily operations more efficiently.\n                          </p>\n                        </div>\n                      )}\n                      {section.id === 'users' && (\n                        <div className=\"space-y-3 text-gray-700 dark:text-gray-300\">\n                          <p>\n                            Our primary users are small business owners who use the dashboard daily\n                            to check their sales, process refunds, and reconcile payments.\n                          </p>\n                          <p>\n                            They value reliability and simplicity - downtime or confusing UX directly\n                            impacts their business operations.\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n          ))}\n        </TabsContent>\n\n        <TabsContent value=\"team\" className=\"mt-4 space-y-4\">\n          {DOCUMENTATION_SECTIONS.slice(2).map(section => (\n            <Collapsible \n              key={section.id}\n              open={expandedDocs[section.id]}\n              onOpenChange={(open) => {\n                if (open) handleDocRead(section.id);\n                setExpandedDocs(prev => ({ ...prev, [section.id]: open }));\n              }}\n            >\n              <Card>\n                <CollapsibleTrigger className=\"w-full\" data-testid={`section-${section.id}`}>\n                  <CardHeader className=\"pb-2\">\n                    <div className=\"flex items-center justify-between\">\n                      <CardTitle className=\"text-base flex items-center gap-2\">\n                        <section.icon className=\"h-4 w-4 text-purple-600\" />\n                        {section.title}\n                        {progress.docsRead[section.id] && (\n                          <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                        )}\n                      </CardTitle>\n                      {expandedDocs[section.id] ? (\n                        <ChevronDown className=\"h-4 w-4\" />\n                      ) : (\n                        <ChevronRight className=\"h-4 w-4\" />\n                      )}\n                    </div>\n                    <CardDescription>{section.description}</CardDescription>\n                  </CardHeader>\n                </CollapsibleTrigger>\n                <CollapsibleContent>\n                  <CardContent className=\"pt-0\">\n                    <Separator className=\"my-3\" />\n                    <div className=\"prose prose-sm dark:prose-invert max-w-none\">\n                      {section.id === 'norms' && (\n                        <div className=\"space-y-3 text-gray-700 dark:text-gray-300\">\n                          <p>We have daily standups at 10am - quick 15-minute syncs where you share what you're working on.</p>\n                          <p>Communication is mostly async via Slack. Don't hesitate to ask questions!</p>\n                          <p>Code reviews are collaborative - expect feedback and provide it respectfully.</p>\n                        </div>\n                      )}\n                      {section.id === 'workflow' && (\n                        <div className=\"space-y-3 text-gray-700 dark:text-gray-300\">\n                          <p>We work in 2-week sprints with planning, daily standups, and retrospectives.</p>\n                          <p>All code goes through PR review before merging to main.</p>\n                          <p>We use feature branches and squash merges.</p>\n                        </div>\n                      )}\n                    </div>\n                  </CardContent>\n                </CollapsibleContent>\n              </Card>\n            </Collapsible>\n          ))}\n        </TabsContent>\n      </Tabs>\n\n      {/* Progress indicator and Continue button */}\n      <Card className={cn(\n        \"mt-6 transition-all\",\n        allDocsRead \n          ? \"bg-gradient-to-r from-green-50 to-teal-50 dark:from-green-900/20 dark:to-teal-900/20 border-green-200\" \n          : \"bg-gray-50 dark:bg-gray-800/50\"\n      )}>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-3\">\n              {allDocsRead ? (\n                <div className=\"h-10 w-10 rounded-full bg-green-100 flex items-center justify-center\">\n                  <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                </div>\n              ) : (\n                <div className=\"h-10 w-10 rounded-full bg-gray-200 flex items-center justify-center\">\n                  <FileText className=\"h-5 w-5 text-gray-500\" />\n                </div>\n              )}\n              <div>\n                <p className={cn(\"font-medium\", allDocsRead ? \"text-green-800 dark:text-green-200\" : \"text-gray-600\")}>\n                  {allDocsRead ? \"All documentation reviewed!\" : \"Keep reading...\"}\n                </p>\n                <p className=\"text-sm text-gray-500\">\n                  {Object.values(progress.docsRead).filter(Boolean).length} of {DOCUMENTATION_SECTIONS.length} sections complete\n                </p>\n              </div>\n            </div>\n            {allDocsRead && (\n              <Button \n                onClick={() => setCurrentStep('team-intro')}\n                className=\"bg-teal-600 hover:bg-teal-700\"\n                data-testid=\"button-continue-to-team\"\n              >\n                Meet Your Team\n                <ArrowRight className=\"h-4 w-4 ml-2\" />\n              </Button>\n            )}\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  const renderComprehension = () => (\n    <div className=\"space-y-4 h-full flex flex-col\">\n      <div className=\"flex items-center justify-between mb-2\">\n        <div>\n          <h3 className=\"text-lg font-semibold\">Check in with Sarah</h3>\n          <p className=\"text-sm text-gray-500\">Share what you've learned from the documentation</p>\n        </div>\n        <Button variant=\"outline\" size=\"sm\" onClick={() => setCurrentStep('overview')} data-testid=\"button-back-to-overview\">\n          <ArrowLeft className=\"h-4 w-4 mr-1\" />\n          Back\n        </Button>\n      </div>\n\n      <Card className=\"flex-1 flex flex-col\">\n        <CardHeader className=\"pb-2 border-b\">\n          <div className=\"flex items-center gap-3\">\n            <Avatar className=\"h-10 w-10 ring-2 ring-indigo-100\">\n              <AvatarImage src={getAvatarUrl('Sarah')} alt=\"Sarah\" />\n              <AvatarFallback className=\"bg-indigo-500 text-white\">S</AvatarFallback>\n            </Avatar>\n            <div>\n              <CardTitle className=\"text-base\">Sarah</CardTitle>\n              <CardDescription className=\"text-xs\">Tech Lead</CardDescription>\n            </div>\n            <div className=\"ml-auto flex gap-1\">\n              <Badge variant=\"outline\" className=\"text-xs\">Documentation</Badge>\n              <Badge variant=\"outline\" className=\"text-xs\">Mentorship</Badge>\n            </div>\n          </div>\n        </CardHeader>\n        <CardContent className=\"flex-1 flex flex-col p-4\">\n          <div className=\"flex items-center gap-2 mb-3\">\n            <MessageCircle className=\"h-4 w-4 text-indigo-600\" />\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">Chat with Sarah</span>\n          </div>\n          <CardDescription className=\"text-xs mb-3\">\n            Share what you understood from the docs - this is a casual chat, not a test!\n          </CardDescription>\n\n          <div ref={chatScrollRef} className=\"min-h-[320px] max-h-[480px] overflow-y-auto pr-4 mb-4\">\n            <div className=\"space-y-3\">\n              {chatHistory.length === 0 && (\n                <div className=\"text-center py-6 text-gray-400 text-sm\">\n                  <p>Start a conversation! Try sharing:</p>\n                  <div className=\"flex flex-wrap gap-2 justify-center mt-2\">\n                    <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\">What the dashboard does</Badge>\n                    <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\">Key features</Badge>\n                    <Badge variant=\"outline\" className=\"text-xs cursor-pointer hover:bg-gray-100\">Questions</Badge>\n                  </div>\n                </div>\n              )}\n\n              {chatHistory.map((msg, idx) => (\n                <div \n                  key={idx} \n                  className={cn(\"flex\", msg.sender === 'You' ? \"justify-end\" : \"items-start gap-2\")}\n                >\n                  {msg.sender !== 'You' && (\n                    <Avatar className=\"h-7 w-7 flex-shrink-0\">\n                      <AvatarImage src={getAvatarUrl('Sarah')} alt=\"Sarah\" />\n                      <AvatarFallback className=\"bg-indigo-500 text-white text-xs\">S</AvatarFallback>\n                    </Avatar>\n                  )}\n                  <div className={cn(\n                    \"px-3 py-2 rounded-2xl max-w-[85%]\",\n                    msg.sender === 'You' \n                      ? \"bg-indigo-600 text-white rounded-br-sm\" \n                      : \"bg-gray-100 dark:bg-gray-800 rounded-tl-sm\"\n                  )}>\n                    <p className=\"text-sm\">{msg.message}</p>\n                  </div>\n                </div>\n              ))}\n\n              {isSarahResponding && (\n                <div className=\"flex items-start gap-2\">\n                  <Avatar className=\"h-7 w-7 flex-shrink-0\">\n                    <AvatarImage src={getAvatarUrl('Sarah')} alt=\"Sarah\" />\n                    <AvatarFallback className=\"bg-indigo-500 text-white text-xs\">S</AvatarFallback>\n                  </Avatar>\n                  <div className=\"bg-gray-100 dark:bg-gray-800 rounded-2xl rounded-tl-sm px-4 py-3\">\n                    <div className=\"flex gap-1\">\n                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '0ms' }}></span>\n                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '150ms' }}></span>\n                      <span className=\"w-2 h-2 bg-gray-400 rounded-full animate-bounce\" style={{ animationDelay: '300ms' }}></span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {chatHistory.length > 0 && (\n            <div className=\"flex items-center gap-3 text-xs text-gray-500 bg-gray-50 dark:bg-gray-800/50 rounded-lg p-3 mb-3\">\n              <span className=\"font-medium\">Check-in progress:</span>\n              <div className=\"flex gap-2 flex-wrap\">\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  sarahTopicsCovered.userShowedUnderstanding \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Understanding {sarahTopicsCovered.userShowedUnderstanding && \"\"}\n                </span>\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  sarahTopicsCovered.userAskedQuestions \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Questions {sarahTopicsCovered.userAskedQuestions && \"\"}\n                </span>\n                <span className={cn(\n                  \"px-2 py-0.5 rounded\",\n                  sarahTopicsCovered.sarahOfferedNextSteps \n                    ? \"bg-green-100 text-green-700\" \n                    : \"bg-gray-100 text-gray-400\"\n                )}>\n                  Next steps {sarahTopicsCovered.sarahOfferedNextSteps && \"\"}\n                </span>\n              </div>\n            </div>\n          )}\n\n          {sarahConversationClosed ? (\n            <div className=\"bg-green-50 dark:bg-green-900/20 border border-green-200 rounded-lg p-3 mt-auto\">\n              <div className=\"flex items-center gap-3\">\n                <CheckCircle2 className=\"h-5 w-5 text-green-600\" />\n                <div>\n                  <p className=\"font-medium text-green-800 dark:text-green-200 text-sm\">Great chat!</p>\n                  <p className=\"text-xs text-green-600 dark:text-green-300\">You're ready to move on</p>\n                </div>\n              </div>\n            </div>\n          ) : (\n            <div className=\"flex gap-2 mt-auto\">\n              <Input\n                value={chatMessage}\n                onChange={(e) => setChatMessage(e.target.value)}\n                placeholder=\"Say hi to Sarah...\"\n                className=\"flex-1\"\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && !e.shiftKey) {\n                    e.preventDefault();\n                    handleSendMessage();\n                  }\n                }}\n                disabled={isSarahResponding}\n                data-testid=\"input-comprehension-message\"\n              />\n              <Button \n                size=\"icon\"\n                onClick={handleSendMessage}\n                disabled={!chatMessage.trim() || isSarahResponding}\n                className=\"bg-indigo-600 hover:bg-indigo-700\"\n                data-testid=\"button-send-message\"\n              >\n                <Send className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n\n  return (\n    <div className=\"h-full\" data-testid=\"onboarding-module\">\n      {currentStep === 'overview' && renderOverview()}\n      {currentStep === 'team-intro' && renderTeamIntro()}\n      {currentStep === 'documentation' && renderDocumentation()}\n      {currentStep === 'comprehension' && renderComprehension()}\n    </div>\n  );\n}\n","path":null,"size_bytes":52880,"size_tokens":null},"shared/adapters/planning/levels/mid.ts":{"content":"/**\n * Mid-Level Planning Overlay\n * \n * Active contributor mode - expected to drive estimation and challenge trade-offs.\n * PM sets context briefly, then mid-level leads technical discussion.\n * Low scaffolding, peer-level interaction with some pushback.\n */\n\nimport type { LevelPlanningOverlay } from '../types';\n\nexport const midLevelOverlay: LevelPlanningOverlay = {\n  level: 'mid',\n  displayName: 'Mid-Level',\n  scaffoldingLevel: 'low',\n  \n  promptModifiers: {\n    guidanceLevel: `This is a mid-level professional who should DRIVE the technical discussion.\nPriya sets context, then expects the mid-level to lead estimation and raise concerns.\nOther team members (Marcus, Alex) respond to the mid-level's input.\nChallenge their assumptions when appropriate - they should defend their estimates.`,\n    \n    toneAdjustment: `Be professional and peer-level. Keep explanations concise.\nPush back when estimates seem off or scope unclear.\nExpect them to proactively identify risks and dependencies.\nTreat disagreements as collaborative problem-solving.`\n  },\n  \n  engagement: {\n    mode: 'active',\n    autoStartConversation: true,\n    teamTalkRatio: 0.45,\n    phaseEngagement: {\n      context: 'respond',\n      discussion: 'lead',\n      commitment: 'lead'\n    },\n    autoStartMessage: `Hey team, let's get into planning. I'll quickly share what's on the priority list from stakeholders, but I want us to dig into the details together.\n\nHere's what we're looking at...`\n  },\n  \n  uiOverrides: {\n    showLearningObjectives: false,\n    showKnowledgeCheck: false,\n    requireDiscussionBeforeNext: false,\n    canSkipPhases: true,\n    showMeetingTimer: true\n  },\n  \n  difficultyOverrides: {\n    ticketComplexity: 'medium',\n    ambiguityLevel: 0.5,\n    conflictScenarios: true,\n    aiPushbackIntensity: 'moderate',\n    estimationAccuracy: 'independent'\n  },\n  \n  evaluationOverrides: {\n    passingThreshold: 70,\n    requiredInteractions: 3\n  }\n};\n","path":null,"size_bytes":1939,"size_tokens":null},"shared/adapters/planning/roles/pm.ts":{"content":"/**\n * Product Manager Role Planning Adapter\n * \n * For PMs, the user leads/facilitates the planning session.\n * AI dev team responds with concerns, questions, and estimates.\n * Focus is on communication, prioritization defense, and team alignment.\n */\n\nimport type { RolePlanningAdapter } from '../types';\n\nexport const pmPlanningAdapter: RolePlanningAdapter = {\n  role: 'pm',\n  displayName: 'Product Manager',\n  description: 'Lead sprint planning, present priorities to the team, and facilitate scope agreement',\n  competencies: [\n    'sprint-facilitation',\n    'priority-communication',\n    'stakeholder-management',\n    'scope-negotiation',\n    'team-alignment'\n  ],\n  \n  prompts: {\n    baseSystemPrompt: `You are participating in a sprint planning meeting as a development team member.\nThe user is the Product Manager who is leading this planning session.\nYour role is to respond realistically as developers would - asking clarifying questions, \nraising concerns about scope/complexity, and providing estimation input.`,\n    \n    contextPhasePrompt: `The PM is presenting the sprint priorities. As a team member:\n- Ask clarifying questions about requirements or user impact\n- Seek to understand the business reasoning\n- Express initial reactions to the proposed priorities\n\nRespond naturally as a developer receiving this information.\nKeep responses to 2-3 sentences.`,\n    \n    discussionPhasePrompt: `Engage in discussion with the PM about the proposed items:\n- Raise technical concerns or complexity issues\n- Ask about dependencies and blockers\n- Provide estimation input (story points)\n- Negotiate scope if items seem too ambitious\n\nBe professional but realistic - push back gently when scope seems unrealistic.\nDifferent team members should have different perspectives.`,\n    \n    commitmentPhasePrompt: `The PM is wrapping up planning. As the team:\n- Confirm understanding of the sprint goal\n- Express commitment (or concerns) about the scope\n- Ask any final clarifying questions\n- Acknowledge readiness to begin the sprint\n\nBe supportive but ensure the commitment is realistic.`,\n    \n    personas: [\n      {\n        name: 'Marcus',\n        role: 'Senior Developer',\n        personality: 'Detail-oriented, often raises technical concerns, but supportive',\n        avatarSeed: 'marcus-senior-dev',\n        color: 'bg-green-500'\n      },\n      {\n        name: 'Sarah',\n        role: 'Tech Lead',\n        personality: 'Big-picture thinker, balances technical and business needs',\n        avatarSeed: 'sarah-tech-lead',\n        color: 'bg-blue-500'\n      },\n      {\n        name: 'Alex',\n        role: 'QA Engineer',\n        personality: 'Quality-focused, asks about test coverage and edge cases',\n        avatarSeed: 'alex-qa-engineer',\n        color: 'bg-orange-500'\n      }\n    ],\n    facilitator: 'user'\n  },\n  \n  uiControls: {\n    showPriorityEditor: true,\n    showEstimationSliders: false,\n    showCapacityIndicator: true,\n    showMeetingTimer: true\n  },\n  \n  difficulty: {\n    estimationAccuracy: 'independent'\n  },\n  \n  evaluation: {\n    rubricWeights: {\n      participation: 0.15,\n      understanding: 0.15,\n      collaboration: 0.25,\n      goalClarity: 0.25,\n      scopeRealism: 0.20\n    }\n  },\n  \n  learningObjectives: [\n    {\n      phase: 'context',\n      objectives: [\n        'Clearly communicate sprint priorities',\n        'Explain business context and user value',\n        'Set the tone for a productive discussion'\n      ],\n      tips: [\n        'Start with the \"why\" before the \"what\"',\n        'Be prepared to answer questions about priorities',\n        'Keep the opening concise but informative'\n      ]\n    },\n    {\n      phase: 'discussion',\n      objectives: [\n        'Facilitate healthy team debate',\n        'Address technical concerns constructively',\n        'Guide toward realistic scope'\n      ],\n      tips: [\n        'Listen to technical concerns seriously',\n        'Be willing to adjust scope if needed',\n        'Keep the discussion focused and productive'\n      ]\n    },\n    {\n      phase: 'commitment',\n      objectives: [\n        'Articulate a clear sprint goal',\n        'Ensure team alignment and buy-in',\n        'Confirm realistic commitment'\n      ],\n      tips: [\n        'The sprint goal should be outcome-focused',\n        'Make sure everyone is on the same page',\n        'Leave room for questions before committing'\n      ]\n    }\n  ]\n};\n","path":null,"size_bytes":4394,"size_tokens":null},"shared/adapters/planning/roles/developer.ts":{"content":"/**\n * Developer Role Planning Adapter\n * \n * For developers (including QA, DevOps, Data Science), the user participates\n * in planning led by the AI PM (Priya). Focus is on understanding priorities,\n * contributing to estimation, and committing to realistic scope.\n */\n\nimport type { RolePlanningAdapter, PlanningPhase } from '../types';\n\nexport const developerPlanningAdapter: RolePlanningAdapter = {\n  role: 'developer',\n  displayName: 'Developer',\n  description: 'Participate in sprint planning led by the PM, contribute to estimation and scope discussions',\n  competencies: [\n    'sprint-planning-participation',\n    'estimation',\n    'scope-negotiation',\n    'team-collaboration',\n    'priority-understanding'\n  ],\n  \n  prompts: {\n    baseSystemPrompt: `You are a team member in a sprint planning meeting for a development team.\nThe user is a developer participating in the planning session.\n\nCRITICAL RESPONSE RULES:\n- You are responding as ONE specific persona only (you will be told which one)\n- Write in first-person as that persona\n- NEVER include other team members' dialogue in your response\n- NEVER use stage directions like \"(nods)\", \"(thinking)\", or narrator descriptions\n- NEVER prefix your message with your name or role - the UI already shows this\n- Keep responses conversational and natural, 2-4 sentences max\n- Only include what YOUR persona would say, not what others would say`,\n    \n    contextPhasePrompt: `Present the sprint priorities to the developer. Explain:\n- What the top priority items are and WHY they matter (business context)\n- Any dependencies or blockers to be aware of\n\nBe conversational and welcoming. Invite questions about the priorities.\nKeep your response to 2-4 sentences max. Respond only as yourself.`,\n    \n    discussionPhasePrompt: `Respond to the developer's input about the backlog items.\n- Acknowledge their perspective on estimation or concerns\n- Share YOUR technical perspective as this persona\n- Address any questions about requirements or technical approach\n\nKeep your response to 2-4 sentences. Only speak as yourself - other team members will respond separately.`,\n    \n    commitmentPhasePrompt: `Wrap up your part of the planning discussion:\n- React to the agreed scope\n- Confirm understanding of the sprint goal\n- Share any final thoughts or concerns\n\nBe encouraging. Keep your response to 2-4 sentences. Only speak as yourself.`,\n    \n    personas: [\n      {\n        name: 'Priya',\n        role: 'Product Manager',\n        personality: 'Energetic, clear communicator, always explains the \"why\"',\n        avatarSeed: 'priya-product-mgr',\n        color: 'bg-purple-500'\n      },\n      {\n        name: 'Marcus',\n        role: 'Senior Developer',\n        personality: 'Detail-oriented, raises technical concerns, helpful',\n        avatarSeed: 'marcus-senior-dev',\n        color: 'bg-green-500'\n      },\n      {\n        name: 'Alex',\n        role: 'QA Engineer',\n        personality: 'Thorough, asks about edge cases and test coverage',\n        avatarSeed: 'alex-qa-engineer',\n        color: 'bg-orange-500'\n      }\n    ],\n    facilitator: 'ai'\n  },\n  \n  uiControls: {\n    showPriorityEditor: false,\n    showEstimationSliders: true,\n    showCapacityIndicator: true,\n    showMeetingTimer: true\n  },\n  \n  difficulty: {\n    estimationAccuracy: 'assisted'\n  },\n  \n  evaluation: {\n    rubricWeights: {\n      participation: 0.25,\n      understanding: 0.30,\n      collaboration: 0.20,\n      goalClarity: 0.15,\n      scopeRealism: 0.10\n    }\n  },\n  \n  learningObjectives: [\n    {\n      phase: 'context',\n      objectives: [\n        'Understand why certain items are prioritized',\n        'Recognize the business context behind technical work'\n      ],\n      tips: [\n        'Ask \"why\" questions to understand priorities',\n        'Connect technical work to user/business value'\n      ]\n    },\n    {\n      phase: 'discussion',\n      objectives: [\n        'Contribute to effort estimation discussions',\n        'Raise concerns about scope or complexity',\n        'Collaborate with teammates on planning'\n      ],\n      tips: [\n        'Share your perspective on effort honestly',\n        'Mention any risks or dependencies you see',\n        'Listen to senior team members\\' input'\n      ]\n    },\n    {\n      phase: 'commitment',\n      objectives: [\n        'Understand the sprint goal',\n        'Know what you\\'re committing to',\n        'Feel confident about the scope'\n      ],\n      tips: [\n        'Make sure you understand what success looks like',\n        'Don\\'t commit to more than you can deliver',\n        'Ask questions before committing, not after'\n      ]\n    }\n  ]\n};\n\nexport const qaPlanningAdapter: RolePlanningAdapter = {\n  ...developerPlanningAdapter,\n  role: 'qa',\n  displayName: 'QA Engineer',\n  description: 'Participate in sprint planning with focus on test planning and quality considerations',\n  competencies: [\n    'sprint-planning-participation',\n    'test-estimation',\n    'quality-advocacy',\n    'risk-identification',\n    'team-collaboration'\n  ],\n  learningObjectives: [\n    {\n      phase: 'context',\n      objectives: [\n        'Identify testing implications of prioritized items',\n        'Understand acceptance criteria needs'\n      ],\n      tips: [\n        'Think about how each item will be tested',\n        'Consider edge cases and quality risks'\n      ]\n    },\n    {\n      phase: 'discussion',\n      objectives: [\n        'Raise quality and testing concerns',\n        'Contribute test effort estimates',\n        'Identify items needing clarification'\n      ],\n      tips: [\n        'Ask about acceptance criteria upfront',\n        'Factor in regression testing time',\n        'Highlight items with high quality risk'\n      ]\n    },\n    {\n      phase: 'commitment',\n      objectives: [\n        'Understand the testing scope',\n        'Commit to achievable test coverage',\n        'Align with development timeline'\n      ],\n      tips: [\n        'Ensure test time is included in estimates',\n        'Know which items need the most testing focus',\n        'Plan for test automation where appropriate'\n      ]\n    }\n  ]\n};\n\nexport const devopsPlanningAdapter: RolePlanningAdapter = {\n  ...developerPlanningAdapter,\n  role: 'devops',\n  displayName: 'DevOps Engineer',\n  description: 'Participate in sprint planning with focus on infrastructure and deployment needs',\n  competencies: [\n    'sprint-planning-participation',\n    'infrastructure-planning',\n    'deployment-awareness',\n    'reliability-advocacy',\n    'team-collaboration'\n  ]\n};\n\nexport const dataSciencePlanningAdapter: RolePlanningAdapter = {\n  ...developerPlanningAdapter,\n  role: 'data_science',\n  displayName: 'Data Scientist',\n  description: 'Participate in sprint planning with focus on data and analytics work',\n  competencies: [\n    'sprint-planning-participation',\n    'experiment-planning',\n    'data-requirements',\n    'analysis-scoping',\n    'team-collaboration'\n  ]\n};\n","path":null,"size_bytes":6925,"size_tokens":null},"shared/adapters/planning/index.ts":{"content":"/**\n * Sprint Planning Adapter Factory\n * \n * Merges role adapters with level overlays to create complete\n * SprintPlanningAdapter configurations for each role/level combination.\n */\n\nimport type { Role, Level } from '../index';\nimport type { \n  SprintPlanningAdapter, \n  RolePlanningAdapter, \n  LevelPlanningOverlay,\n  LevelEngagement,\n  PlanningUIControls,\n  PlanningDifficulty,\n  PlanningEvaluation,\n  PlanningPrompts\n} from './types';\n\nimport { developerPlanningAdapter, qaPlanningAdapter, devopsPlanningAdapter, dataSciencePlanningAdapter } from './roles/developer';\nimport { pmPlanningAdapter } from './roles/pm';\nimport { internLevelOverlay } from './levels/intern';\nimport { juniorLevelOverlay } from './levels/junior';\nimport { midLevelOverlay } from './levels/mid';\nimport { seniorLevelOverlay } from './levels/senior';\n\nexport * from './types';\n\nconst roleAdapters: Record<Role, RolePlanningAdapter> = {\n  developer: developerPlanningAdapter,\n  pm: pmPlanningAdapter,\n  qa: qaPlanningAdapter,\n  devops: devopsPlanningAdapter,\n  data_science: dataSciencePlanningAdapter\n};\n\nconst levelOverlays: Record<Level, LevelPlanningOverlay> = {\n  intern: internLevelOverlay,\n  junior: juniorLevelOverlay,\n  mid: midLevelOverlay,\n  senior: seniorLevelOverlay\n};\n\nconst defaultUIControls: PlanningUIControls = {\n  showPriorityEditor: false,\n  showEstimationSliders: false,\n  requireDiscussionBeforeNext: true,\n  showLearningObjectives: false,\n  showKnowledgeCheck: false,\n  canSkipPhases: false,\n  showMeetingTimer: true,\n  showCapacityIndicator: true\n};\n\nconst defaultDifficulty: PlanningDifficulty = {\n  ticketComplexity: 'medium',\n  ambiguityLevel: 0.3,\n  conflictScenarios: false,\n  aiPushbackIntensity: 'gentle',\n  estimationAccuracy: 'assisted'\n};\n\nconst defaultEvaluation: PlanningEvaluation = {\n  rubricWeights: {\n    participation: 0.20,\n    understanding: 0.25,\n    collaboration: 0.20,\n    goalClarity: 0.20,\n    scopeRealism: 0.15\n  },\n  passingThreshold: 60,\n  requiredInteractions: 3\n};\n\nconst defaultEngagement: LevelEngagement = {\n  mode: 'guided',\n  autoStartConversation: true,\n  teamTalkRatio: 0.5,\n  phaseEngagement: {\n    context: 'respond',\n    discussion: 'respond',\n    commitment: 'respond'\n  },\n  autoStartMessage: 'Good morning team! Let\\'s get started with our sprint planning.'\n};\n\nfunction buildSystemPrompt(\n  roleAdapter: RolePlanningAdapter,\n  levelOverlay: LevelPlanningOverlay\n): string {\n  return `${roleAdapter.prompts.baseSystemPrompt}\n\n${levelOverlay.promptModifiers.guidanceLevel}\n\n${levelOverlay.promptModifiers.toneAdjustment}`;\n}\n\nfunction mergeUIControls(\n  roleControls: Partial<PlanningUIControls>,\n  levelOverrides: Partial<PlanningUIControls>\n): PlanningUIControls {\n  return {\n    ...defaultUIControls,\n    ...roleControls,\n    ...levelOverrides\n  };\n}\n\nfunction mergeDifficulty(\n  roleDifficulty: Partial<PlanningDifficulty>,\n  levelOverrides: Partial<PlanningDifficulty>\n): PlanningDifficulty {\n  return {\n    ...defaultDifficulty,\n    ...roleDifficulty,\n    ...levelOverrides\n  };\n}\n\nfunction mergeEvaluation(\n  roleEval: Partial<PlanningEvaluation>,\n  levelOverrides: Partial<PlanningEvaluation>\n): PlanningEvaluation {\n  const mergedWeights = {\n    ...defaultEvaluation.rubricWeights,\n    ...(roleEval.rubricWeights || {})\n  };\n  \n  return {\n    rubricWeights: mergedWeights,\n    passingThreshold: levelOverrides.passingThreshold ?? roleEval.passingThreshold ?? defaultEvaluation.passingThreshold,\n    requiredInteractions: levelOverrides.requiredInteractions ?? roleEval.requiredInteractions ?? defaultEvaluation.requiredInteractions\n  };\n}\n\nexport function getSprintPlanningAdapter(role: Role, level: Level): SprintPlanningAdapter {\n  const roleAdapter = roleAdapters[role] || roleAdapters.developer;\n  const levelOverlay = levelOverlays[level] || levelOverlays.intern;\n  \n  const prompts: PlanningPrompts = {\n    systemPrompt: buildSystemPrompt(roleAdapter, levelOverlay),\n    contextPhasePrompt: roleAdapter.prompts.contextPhasePrompt,\n    discussionPhasePrompt: roleAdapter.prompts.discussionPhasePrompt,\n    commitmentPhasePrompt: roleAdapter.prompts.commitmentPhasePrompt,\n    personas: roleAdapter.prompts.personas,\n    facilitator: roleAdapter.prompts.facilitator\n  };\n  \n  const engagement: LevelEngagement = levelOverlay.engagement || defaultEngagement;\n  \n  return {\n    metadata: {\n      role,\n      level,\n      displayName: `${levelOverlay.displayName} ${roleAdapter.displayName}`,\n      description: roleAdapter.description,\n      competencies: roleAdapter.competencies\n    },\n    prompts,\n    uiControls: mergeUIControls(roleAdapter.uiControls, levelOverlay.uiOverrides),\n    difficulty: mergeDifficulty(roleAdapter.difficulty, levelOverlay.difficultyOverrides),\n    evaluation: mergeEvaluation(roleAdapter.evaluation, levelOverlay.evaluationOverrides),\n    engagement,\n    learningObjectives: roleAdapter.learningObjectives\n  };\n}\n\nexport function getAvailableRoles(): Role[] {\n  return Object.keys(roleAdapters) as Role[];\n}\n\nexport function getAvailableLevels(): Level[] {\n  return Object.keys(levelOverlays) as Level[];\n}\n\nexport function getRoleAdapter(role: Role): RolePlanningAdapter {\n  return roleAdapters[role] || roleAdapters.developer;\n}\n\nexport function getLevelOverlay(level: Level): LevelPlanningOverlay {\n  return levelOverlays[level] || levelOverlays.intern;\n}\n","path":null,"size_bytes":5347,"size_tokens":null},"shared/adapters/planning/levels/senior.ts":{"content":"/**\n * Senior Level Planning Overlay\n * \n * Facilitator mode - senior can take over parts of the meeting.\n * PM may hand off facilitation, strategic questioning expected.\n * Complex scenarios with competing priorities and strong pushback.\n */\n\nimport type { LevelPlanningOverlay } from '../types';\n\nexport const seniorLevelOverlay: LevelPlanningOverlay = {\n  level: 'senior',\n  displayName: 'Senior',\n  scaffoldingLevel: 'none',\n  \n  promptModifiers: {\n    guidanceLevel: `This is a senior professional who should FACILITATE the discussion.\nPriya may hand off parts of the meeting to them. They should challenge assumptions.\nPresent complex scenarios with trade-offs and competing priorities.\nTeam members look to them for technical guidance and decision-making.`,\n    \n    toneAdjustment: `Be direct and strategic. Treat them as a peer leader.\nChallenge their thinking with \"What assumptions are we making here?\"\nExpect them to push back on unrealistic scope and unclear goals.\nThey should mentor the team through the planning process.`\n  },\n  \n  engagement: {\n    mode: 'facilitator',\n    autoStartConversation: true,\n    teamTalkRatio: 0.30,\n    phaseEngagement: {\n      context: 'lead',\n      discussion: 'lead',\n      commitment: 'lead'\n    },\n    autoStartMessage: `Alright, let's kick off planning. I've got the priority list from stakeholders - we need to make some tough calls this sprint.\n\nBefore I go through the items, any context from last sprint we should factor in?`\n  },\n  \n  uiOverrides: {\n    showLearningObjectives: false,\n    showKnowledgeCheck: false,\n    requireDiscussionBeforeNext: false,\n    canSkipPhases: true,\n    showMeetingTimer: true\n  },\n  \n  difficultyOverrides: {\n    ticketComplexity: 'high',\n    ambiguityLevel: 0.7,\n    conflictScenarios: true,\n    aiPushbackIntensity: 'strong',\n    estimationAccuracy: 'independent'\n  },\n  \n  evaluationOverrides: {\n    passingThreshold: 75,\n    requiredInteractions: 4\n  }\n};\n","path":null,"size_bytes":1949,"size_tokens":null},"shared/adapters/planning/types.ts":{"content":"/**\n * Sprint Planning Adapter Types\n * \n * Defines the interface for role-aware, level-adjusted sprint planning experiences.\n * Adapters control prompts, UI behavior, difficulty, and evaluation for each role/level combination.\n */\n\nimport type { Role, Level } from '../index';\n\nexport type PlanningPhase = 'context' | 'discussion' | 'commitment';\n\nexport interface AIPersona {\n  name: string;\n  role: string;\n  personality: string;\n  avatarSeed: string;\n  color: string;\n}\n\nexport interface PlanningPrompts {\n  systemPrompt: string;\n  contextPhasePrompt: string;\n  discussionPhasePrompt: string;\n  commitmentPhasePrompt: string;\n  personas: AIPersona[];\n  facilitator: 'user' | 'ai';\n}\n\nexport interface PlanningUIControls {\n  showPriorityEditor: boolean;\n  showEstimationSliders: boolean;\n  requireDiscussionBeforeNext: boolean;\n  showLearningObjectives: boolean;\n  showKnowledgeCheck: boolean;\n  canSkipPhases: boolean;\n  showMeetingTimer: boolean;\n  showCapacityIndicator: boolean;\n}\n\nexport interface PlanningDifficulty {\n  ticketComplexity: 'low' | 'medium' | 'high';\n  ambiguityLevel: number;\n  conflictScenarios: boolean;\n  aiPushbackIntensity: 'none' | 'gentle' | 'moderate' | 'strong';\n  estimationAccuracy: 'guided' | 'assisted' | 'independent';\n}\n\nexport interface PlanningEvaluation {\n  rubricWeights: {\n    participation: number;\n    understanding: number;\n    collaboration: number;\n    goalClarity: number;\n    scopeRealism: number;\n  };\n  passingThreshold: number;\n  requiredInteractions: number;\n}\n\nexport interface PlanningLearningObjectives {\n  phase: PlanningPhase;\n  objectives: string[];\n  tips: string[];\n}\n\nexport interface SprintPlanningAdapter {\n  metadata: {\n    role: Role;\n    level: Level;\n    displayName: string;\n    description: string;\n    competencies: string[];\n  };\n  \n  prompts: PlanningPrompts;\n  uiControls: PlanningUIControls;\n  difficulty: PlanningDifficulty;\n  evaluation: PlanningEvaluation;\n  engagement: LevelEngagement;\n  learningObjectives: PlanningLearningObjectives[];\n}\n\nexport interface RolePlanningAdapter {\n  role: Role;\n  displayName: string;\n  description: string;\n  competencies: string[];\n  prompts: Omit<PlanningPrompts, 'systemPrompt'> & {\n    baseSystemPrompt: string;\n  };\n  uiControls: Partial<PlanningUIControls>;\n  difficulty: Partial<PlanningDifficulty>;\n  evaluation: Partial<PlanningEvaluation>;\n  learningObjectives: PlanningLearningObjectives[];\n}\n\nexport type EngagementMode = 'shadow' | 'guided' | 'active' | 'facilitator';\nexport type PhaseEngagement = 'observe' | 'respond' | 'lead';\n\nexport interface AutoStartStep {\n  personaId: 'priya' | 'marcus' | 'alex';\n  personaName: string;\n  personaRole: string;\n  message: string;\n  phase: PlanningPhase;\n  requiresUserResponse?: boolean;\n}\n\nexport interface MessageStaggerConfig {\n  enabled: boolean;\n  baseDelayMs: number;\n  perCharacterDelayMs: number;\n  maxDelayMs: number;\n}\n\nexport interface PhaseTransitionSequence {\n  phase: PlanningPhase;\n  steps: AutoStartStep[];\n}\n\nexport type SelectionGuidanceMode = 'autoAssign' | 'prompted' | 'selfManaged';\n\nexport interface SelectionGuidance {\n  mode: SelectionGuidanceMode;\n  suggestedItemIds?: string[];\n  confirmationPrompt?: string;\n  visualCueCopy?: string;\n  backlogPanelHighlight?: boolean;\n  nextStepHint?: string;\n}\n\nexport interface CommitmentGuidance {\n  mode: 'autoSet' | 'userDefined';\n  suggestedGoal?: string;\n}\n\nexport interface LevelEngagement {\n  mode: EngagementMode;\n  autoStartConversation: boolean;\n  teamTalkRatio: number;\n  phaseEngagement: {\n    context: PhaseEngagement;\n    discussion: PhaseEngagement;\n    commitment: PhaseEngagement;\n  };\n  promptSuggestions?: {\n    context: string[];\n    discussion: string[];\n    commitment: string[];\n  };\n  autoStartMessage: string;\n  autoStartSequence?: AutoStartStep[];\n  phaseTransitionSequences?: PhaseTransitionSequence[];\n  messageStagger?: MessageStaggerConfig;\n  selectionGuidance?: SelectionGuidance;\n  commitmentGuidance?: CommitmentGuidance;\n}\n\nexport interface LevelPlanningOverlay {\n  level: Level;\n  displayName: string;\n  scaffoldingLevel: 'high' | 'medium' | 'low' | 'none';\n  promptModifiers: {\n    guidanceLevel: string;\n    toneAdjustment: string;\n  };\n  engagement: LevelEngagement;\n  uiOverrides: Partial<PlanningUIControls>;\n  difficultyOverrides: Partial<PlanningDifficulty>;\n  evaluationOverrides: Partial<PlanningEvaluation>;\n}\n\nexport interface PlanningSessionContext {\n  workspaceId: number;\n  sprintId?: number;\n  role: Role;\n  level: Level;\n  companyName: string;\n  backlogItems: BacklogItem[];\n  capacity: number;\n}\n\nexport interface BacklogItem {\n  id: string;\n  title: string;\n  description: string;\n  type: 'bug' | 'feature' | 'improvement';\n  priority: 'high' | 'medium' | 'low';\n  points: number;\n  selected?: boolean;\n}\n\nexport interface PlanningMessage {\n  id: string;\n  sender: string;\n  senderRole: string;\n  message: string;\n  phase: PlanningPhase;\n  timestamp: Date;\n  isUser: boolean;\n}\n\nexport interface PlanningSessionState {\n  currentPhase: PlanningPhase;\n  phaseCompletions: Record<PlanningPhase, boolean>;\n  selectedItems: string[];\n  capacityUsed: number;\n  goalStatement: string;\n  commitmentSummary: string;\n  messages: PlanningMessage[];\n  knowledgeCheckPassed: boolean;\n}\n","path":null,"size_bytes":5260,"size_tokens":null},"shared/adapters/planning/levels/intern.ts":{"content":"/**\n * Intern Level Planning Overlay\n * \n * Shadow/Observer mode - intern primarily observes the team discussion.\n * PM kicks off meeting, team discusses naturally, intern asked for questions at the end.\n * Heavy scaffolding, guided experience, learning by watching experienced team members.\n */\n\nimport type { LevelPlanningOverlay } from '../types';\n\nexport const internLevelOverlay: LevelPlanningOverlay = {\n  level: 'intern',\n  displayName: 'Intern',\n  scaffoldingLevel: 'high',\n  \n  promptModifiers: {\n    guidanceLevel: `This is an intern's first sprint planning experience. They are primarily OBSERVING.\nThe team (Priya, Marcus, Alex) should have a natural discussion among themselves.\nExplain concepts as the team discusses them naturally. The intern is learning by watching.\nOnly directly address the intern occasionally to check understanding or invite questions.\nToward the end of each phase, turn to the intern and ask if they have any questions.`,\n    \n    toneAdjustment: `Be warm and welcoming. Create a safe space for the intern to observe and learn.\nWhen addressing the intern, be encouraging and patient.\nModel good team collaboration so the intern sees healthy planning dynamics.\nCelebrate when they do ask questions or share observations.`\n  },\n  \n  engagement: {\n    mode: 'shadow',\n    autoStartConversation: true,\n    teamTalkRatio: 0.85,\n    phaseEngagement: {\n      context: 'observe',\n      discussion: 'observe',\n      commitment: 'respond'\n    },\n    promptSuggestions: {\n      context: [\n        \"I have a question about that\",\n        \"Could you explain what that means?\",\n        \"That makes sense, thanks\"\n      ],\n      discussion: [\n        \"How do you estimate that?\",\n        \"What happens if we can't finish everything?\",\n        \"I'm following along\"\n      ],\n      commitment: [\n        \"I understand the sprint goal\",\n        \"I have a question before we commit\",\n        \"This is helpful to see how planning works\"\n      ]\n    },\n    autoStartMessage: `Good morning everyone! Thanks for joining our sprint planning. Before we dive in, I want to welcome {{userName}} who's joining us as our new {{userRole}}. Great to have you on the team!\n\nFeel free to observe how we run these meetings - I'll check in with you as we go. Let's get started by reviewing what's in our backlog.`,\n    autoStartSequence: [\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `Good morning everyone! Thanks for joining our sprint planning. Before we dive in, I want to welcome {{userName}} who's joining us as our new {{userRole}}. Great to have you on the team!\n\nFeel free to observe how we run these meetings - I'll check in with you as we go. Let's get started by reviewing what's in our backlog.`\n      },\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `Alright, let me walk through everything we have in the backlog right now. Looking at our board, we've got:\n\n- A timezone display bug affecting users in different regions\n- The user notifications feature that's been requested\n- A null check issue in the payment flow\n- A request to add pagination to the user list\n- Some technical debt items around test coverage\n\nBased on stakeholder feedback and support tickets, I'd recommend we prioritize the timezone bug first - it's been escalated. The notifications feature is also high priority for user engagement.`\n      },\n      {\n        personaId: 'marcus',\n        personaName: 'Marcus',\n        personaRole: 'Senior Developer',\n        phase: 'context',\n        message: `Makes sense on the timezone bug - I've seen similar issues before. Usually comes down to storing everything in UTC and converting on display. Should be a targeted fix.\n\nQuick question on notifications - are we talking push notifications or just in-app? That would significantly change the scope.`\n      },\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `Good question. For now, we're scoping it to in-app notifications only. Push notifications are on the roadmap for next quarter.\n\nGiven our velocity, I think we can realistically fit the timezone fix, the notifications feature, and maybe the payment bug. The pagination might need to wait unless we have extra capacity.`\n      },\n      {\n        personaId: 'alex',\n        personaName: 'Alex',\n        personaRole: 'QA Engineer',\n        phase: 'context',\n        message: `I'd prioritize the payment bug over pagination if we have room. Failed payments directly impact revenue, and I was working in that area last sprint so the context is fresh.\n\nThe pagination can wait - it's more of a performance nice-to-have at this point.`\n      },\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `Good point, Alex. Let's tentatively plan for timezone, notifications, and payment bug as our core scope.\n\n{{userName}}, you've been listening to how we prioritize - any questions so far about the backlog or how we're deciding what to work on?`,\n        requiresUserResponse: true\n      }\n    ],\n    messageStagger: {\n      enabled: true,\n      baseDelayMs: 800,\n      perCharacterDelayMs: 8,\n      maxDelayMs: 3000\n    },\n    phaseTransitionSequences: [\n      {\n        phase: 'discussion',\n        steps: [\n          {\n            personaId: 'priya',\n            personaName: 'Priya',\n            personaRole: 'Product Manager',\n            phase: 'discussion',\n            message: `Alright team, let's dive into the backlog! Take a look at the items on the right panel.`\n          },\n          {\n            personaId: 'marcus',\n            personaName: 'Marcus',\n            personaRole: 'Senior Developer',\n            phase: 'discussion',\n            message: `I see that timezone bug at the top - TICK-001. That's been causing customer complaints. Should probably prioritize that.`\n          },\n          {\n            personaId: 'alex',\n            personaName: 'Alex',\n            personaRole: 'QA Engineer',\n            phase: 'discussion',\n            message: `Agreed on the timezone fix. And I'd suggest we look at TICK-004 too - that null check in the payment flow is a risk. Both are quick wins at 2-3 points each.`\n          }\n        ]\n      },\n      {\n        phase: 'commitment',\n        steps: [\n          {\n            personaId: 'priya',\n            personaName: 'Priya',\n            personaRole: 'Product Manager',\n            phase: 'commitment',\n            message: `Great discussion everyone! Now let's finalize our sprint commitment.`\n          },\n          {\n            personaId: 'marcus',\n            personaName: 'Marcus',\n            personaRole: 'Senior Developer',\n            phase: 'commitment',\n            message: `We've got the timezone fix and payment null check - both are critical bugs affecting users.`\n          },\n          {\n            personaId: 'priya',\n            personaName: 'Priya',\n            personaRole: 'Product Manager',\n            phase: 'commitment',\n            message: `Right. Our sprint goal will be: \"Improve payment reliability and fix user-facing timezone issues.\"\n\n{{userName}}, as a developer you'd typically help estimate and commit to the work, but the PM usually defines the goal. Does this goal make sense given what we've selected? Any questions before we start the sprint?`,\n            requiresUserResponse: true\n          }\n        ]\n      }\n    ],\n    selectionGuidance: {\n      mode: 'autoAssign',\n      suggestedItemIds: ['TICK-001', 'TICK-004'],\n      confirmationPrompt: `Good thinking, team. I've selected TICK-001 and TICK-004 based on what Marcus and Alex recommended - you can see them highlighted in the backlog panel on the right.\n\n{{userName}}, take a moment to review the selected items. Feel free to ask questions about them, or if everything looks good, click Continue to move forward.`,\n      visualCueCopy: 'Items selected by team',\n      backlogPanelHighlight: true,\n      nextStepHint: 'Review selected items, then click Continue when ready'\n    }\n  },\n  \n  uiOverrides: {\n    showLearningObjectives: true,\n    showKnowledgeCheck: true,\n    requireDiscussionBeforeNext: true,\n    canSkipPhases: false,\n    showMeetingTimer: true\n  },\n  \n  difficultyOverrides: {\n    ticketComplexity: 'low',\n    ambiguityLevel: 0.2,\n    conflictScenarios: false,\n    aiPushbackIntensity: 'none',\n    estimationAccuracy: 'guided'\n  },\n  \n  evaluationOverrides: {\n    passingThreshold: 50,\n    requiredInteractions: 2\n  }\n};\n","path":null,"size_bytes":8747,"size_tokens":null},"shared/adapters/planning/levels/junior.ts":{"content":"/**\n * Junior Level Planning Overlay\n * \n * Guided participation mode - junior prompted to contribute at specific points.\n * PM kicks off, team discusses, but junior is directly asked for input.\n * Moderate scaffolding with coaching nudges and suggested talking points.\n */\n\nimport type { LevelPlanningOverlay } from '../types';\n\nexport const juniorLevelOverlay: LevelPlanningOverlay = {\n  level: 'junior',\n  displayName: 'Junior',\n  scaffoldingLevel: 'medium',\n  \n  promptModifiers: {\n    guidanceLevel: `This is a junior developer who should be ACTIVELY PARTICIPATING.\nAfter discussing key points with the team, directly ask the junior for their input.\nPrompt them with specific questions: \"What do you think about this estimate?\" or \"Any concerns from your perspective?\"\nGuide their contributions but expect them to engage with the discussion.`,\n    \n    toneAdjustment: `Be collegial and treat them as a developing professional.\nWhen they contribute, build on their ideas and acknowledge good insights.\nGently correct misunderstandings as teaching moments.\nCreate opportunities for them to practice contributing in a safe environment.`\n  },\n  \n  engagement: {\n    mode: 'guided',\n    autoStartConversation: true,\n    teamTalkRatio: 0.65,\n    phaseEngagement: {\n      context: 'respond',\n      discussion: 'respond',\n      commitment: 'respond'\n    },\n    promptSuggestions: {\n      context: [\n        \"I think I understand - this is about...\",\n        \"Quick question about the priority\",\n        \"How does this connect to what we did last sprint?\"\n      ],\n      discussion: [\n        \"I think that might take longer because...\",\n        \"Could we break that into smaller pieces?\",\n        \"What about testing time?\"\n      ],\n      commitment: [\n        \"I feel good about this scope\",\n        \"I'm a bit concerned about...\",\n        \"Can I take ownership of one of these?\"\n      ]\n    },\n    autoStartMessage: `Morning team! Let's dive into our sprint planning. Good to have you here, {{userName}}.\n\nWe've got some interesting work lined up. Let me walk through the backlog and then get everyone's thoughts on priorities.`,\n    autoStartSequence: [\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `Morning team! Let's dive into our sprint planning. Good to have you here, {{userName}}.\n\nLooking at our backlog, we've got a timezone display bug that's been escalated, the user notifications feature product has been waiting for, a null check issue in payments, and a pagination request. I'm thinking timezone and notifications should be our focus this sprint.`\n      },\n      {\n        personaId: 'marcus',\n        personaName: 'Marcus',\n        personaRole: 'Senior Developer',\n        phase: 'context',\n        message: `Makes sense. The timezone bug should be straightforward - probably a UTC conversion issue. Notifications is the bigger piece but we've done similar work before.`\n      },\n      {\n        personaId: 'priya',\n        personaName: 'Priya',\n        personaRole: 'Product Manager',\n        phase: 'context',\n        message: `{{userName}}, before we dive into estimates, I'd love to hear your initial thoughts. Any questions about the priorities or concerns that stand out to you?`,\n        requiresUserResponse: true\n      }\n    ],\n    messageStagger: {\n      enabled: true,\n      baseDelayMs: 600,\n      perCharacterDelayMs: 6,\n      maxDelayMs: 2500\n    }\n  },\n  \n  uiOverrides: {\n    showLearningObjectives: true,\n    showKnowledgeCheck: false,\n    requireDiscussionBeforeNext: true,\n    canSkipPhases: false,\n    showMeetingTimer: true\n  },\n  \n  difficultyOverrides: {\n    ticketComplexity: 'medium',\n    ambiguityLevel: 0.4,\n    conflictScenarios: false,\n    aiPushbackIntensity: 'gentle',\n    estimationAccuracy: 'assisted'\n  },\n  \n  evaluationOverrides: {\n    passingThreshold: 60,\n    requiredInteractions: 3\n  }\n};\n","path":null,"size_bytes":3949,"size_tokens":null}},"version":2}